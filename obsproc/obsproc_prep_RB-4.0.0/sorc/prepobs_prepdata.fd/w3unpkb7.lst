Page 1           Source Listing                  W3UNPKB7
2017-04-18 11:09                                 w3unpkb7.f

      1 C$$$  SUBPROGRAM DOCUMENTATION BLOCK
      2 C
      3 C SUBPROGRAM:  W3UNPKB7
      4 C   PRGMMR: KEYSER           ORG: NP22        DATE: 2016-11-30
      5 C
      6 C ABSTRACT: THIS SUBROUTINE DECODES A SINGLE REPORT FROM BUFR MESSAGES
      7 C   IN AN NCEP BUFR DATA FILE.  CURRENTLY WIND PROFILER {EXCEPT FOR,
      8 C   THOSE ORIGINATING FROM PILOT (PIBAL) FORMAT BULLETINS, SEE
      9 C   SUBROUTINE IW3UNPBF FOR THESE}, NEXRAD (VAD) WIND (FROM BOTH RADAR
     10 C   CODED MESSAGE AND FROM LEVEL 2 DECODER), GOES SOUNDING/RADIANCE,
     11 C   ERS SCATTEROMETER WIND, QUIKSCAT SCATTEROMETER WIND, WINDSAT
     12 C   SCATTEROMETER WIND (NAVY OR NESDIS), ASCAT SCATTEROMETER WIND, RASS
     13 C   AND GPS-IPW DATA TYPES ARE VALID.  REPORT IS RETURNED IN QUASI-
     14 C   IW3UNPBF UNPACKED FORMAT (SEE REMARKS 5) AND DIRECTLY FROM BUFR
     15 C   FORMAT (SEE REMARKS 6).  IN ADDITION THE ASCII STATION ID IS
     16 C   RETURNED FOR EACH DECODED REPORT.  ALSO, INFORMATION ABOUT THE
     17 C   INPUT DATA SET ITSELF (NAME, CENTER DATE, DUMP TIME) AND THE BUFR
     18 C   MESSAGE TYPE IS RETURNED.
     19 C
     20 C PROGRAM HISTORY LOG:
     21 C 1998-02-17  D. A. KEYSER -- ORIGINAL AUTHOR (BASED ON W3LIB ROUTINE
     22 C     W3UNPK77)
     23 C 1998-06-14  D. A. KEYSER -- MODIFIED WIND PROFILER CAT. 11 (HEIGHT,
     24 C     HORIZ. SIGNIFICANCE, VERT. SIGNIFICANCE) AND VAD WIND HEADER
     25 C     (STATION ID) PROCESSING TO ACCOUNT FOR UPDATES TO BUFRTABLE
     26 C     MNEMONICS IN /dcom; CHANGED CHAR. 6 OF GOES STNID TO BE UNIQUE
     27 C     FOR TWO DIFFERENT EVEN OR ODD SATELLITE ID'S (EVERY OTHER EVEN OR
     28 C     ODD SAT. ID NOW GETS SAME CHAR. 6 TAG)
     29 C 1998-06-15  D. A. KEYSER -- REDEFINED UNITS FOR UNPACKED WORDS 1
     30 C     (LATITUDE), 2 (LONGITUDE), 4 (OBS. TIME) AND 11 (RECEIPT TIME) -
     31 C     ALL TO CONFORM WITH UNPACKED IW3UNPBF FORMAT AND TO STREAMLINE
     32 C     PROCESSING IN PREPDATA PROGRAM
     33 C 1998-09-21  D. A. KEYSER -- SUBROUTINE NOW Y2K AND FORTRAN 90
     34 C     COMPLIANT
     35 C 1998-10-09  D. A. KEYSER -- CORRECTED ERROR IN RETURNING GOES
     36 C     CAT. 8 DATA WHEN GREATER THAN 9 "LEVELS" ARE PRESENT
     37 C 1999-01-20  D. A. KEYSER -- INCORPORATED BOB KISTLER'S CHANGES NEEDED
     38 C     TO PORT THE CODE TO THE IBM SP
     39 C 1999-02-12  D. A. KEYSER -- ADDED ERS SCATTEROMETER WINDS HERE NOW
     40 C     THAT THEY ARE PACKED IN AN NCEP BUFR FILE
     41 C 1999-05-17  D. A. KEYSER -- MADE FURTHER CHANGES NECESSARY TO PORT
     42 C     THIS ROUTINE TO THE IBM SP
     43 C 1999-11-02  D. A. KEYSER -- CHANGES TO MAKE CODE MORE PORTABLE
     44 C 2000-03-30  D. A. KEYSER -- CHANGE TO BY-PASS TIME-WINDOW CHECKS ON
     45 C     BUFR MESSAGES IF TIME WINDOW VALUES ARE -6 AND +6 HOURS, RESP.
     46 C 2000-09-22  D. A. KEYSER -- ADDED QUIKSCAT SCATTEROMETER WINDS HERE
     47 C     NOW THAT THEY ARE PACKED IN A NCEP BUFR FILE; CORRECTED VALUE
     48 C     FOR RETURNED RAINFALL RATE IN CAT. 10 FOR WIND PROFILER REPORTS
     49 C 2000-12-05  D. A. KEYSER -- CHANGE TO BY-PASS TIME-WINDOW CHECKS ON
     50 C     BUFR MESSAGES IF TIME WINDOW VALUES ARE .LE. -3 AND .GE. +2
     51 C     HOURS, RESP. (WAS .LE. -6 AND .GE. +6) SINCE NO DATA DUMPS WILL
     52 C     EVER BE GREATER THAN THIS TIME WINDOW SPAN; GOES SOUNDING
     53 C     PROCESSING MODIFIED TO NOT CREATE STN. ID IF IT HAS ALREADY BEEN
     54 C     CREATED BY BUFR_DUPSAT, ERS SCATTEROMETER PROCESSING MODIFIED TO
     55 C     NOT CREATE STN. IF IT HAS ALREADY BEEN CREATED BY WAVE_DATASORT
     56 C     AND QUIKSCAT SCATTEROMETER PROCESSING MODIFIED TO NOT CREATE STN.
     57 C     ID IF IT HAS ALREADY BEEN CREATED BY WAVE_DCODQUIKSCAT

Page 2           Source Listing                  W3UNPKB7
2017-04-18 11:09                                 w3unpkb7.f

     58 C     (OTHERWISE, MODIFIED TO CREATE AN 8-CHARACTER STN. ID FOR ALL 3
     59 C     TYPES)
     60 C 2001-04-06  D. A. KEYSER -- RETURNS WITH IRET = 8 IF A BUFR MESSAGE
     61 C     READ IN HAS THE SUBSET "NC002009" - THIS INDICATES THE MESSAGE
     62 C     CONTAINS WIND PROFILER REPORTS ORIGINATING FROM PILOT (PIBAL)
     63 C     FORMAT BULLETINS WHICH THIS SUBR. CANNOT PROCESS; ADDED "SUBSET"
     64 C     (BUFR MESSAGE TYPE) AS AN OUTPUT ARGUMENT; THE GOES SOUNDING/
     65 C     RADIANCE CAT. 8 TYPES ARE NO LONGER SCALED, BUT STORED IN THE
     66 C     SAME UNITS/ SCALING AS FOUND UPON INPUT; THE GOES SOUNDING/
     67 C     RADIANCE CAT. 13 BRIGHTNESS TEMPERATURES ARE NOW STORED AS DEG.
     68 C     K (PRECISE TO 10**2) RATHER THAN AS DEG. K X 100; HEADER WORD 5
     69 C     NOW RETURNS COMPLETE DATE (YYYYMMDDHH) AND HEADER WORD 6 (WAS
     70 C     DDHH) NOW RETURNS SATELLITE ID FOR GOES, ERS AND QUIKSCAT REPORTS
     71 C     (FOR OTHERS IT'S MISSING); FOR GOES SOUNDINGS NOW SKIPS CAT. 12
     72 C     LEVELS WHERE RETRIEVED GEOPOTENTIAL HGHT IS .LE. ELEVATION
     73 C     (LOWEST RETRIEVED HEIGHT); FOR GOES SOUNDINGS NOW UNPACKS SURFACE
     74 C     PRESSURE INTO CAT. 8 CODE FIGURE 262
     75 C 2001-06-19  D. A. KEYSER -- RECOGNIZES BUFR TYPE/SUBTYPE 003/002 AS
     76 C     GOES 1x1 (HI-RES) DATA, PART OF THE "GOESND" DUMP FILE; STORES
     77 C     CLOUD COVER RATHER THAN CLOUD AMOUNT IN OUTPUT CAT. 8, C.F. 258
     78 C     FOR GOES HI-RES REPORTS; GOES HI-RES REPORTS HAVE UNKNOWN PATH
     79 C     AND GET PROPER STNID CHAR. 8 CHARACTER IDENTIFYING THE SAT.
     80 C     NUMBER AND GET "H" IN STNID CHAR. 1 TO UNIQUELY IDENTIFY THEM
     81 C     (IF STNID IS GENERATED HERE)
     82 C 2001-07-10  D. A. KEYSER -- FOR GOESND REPORTS, NOW KEEPS SEPARATE
     83 C     COUNT OF REPORTS WITH MISSING # FOV (E.G., CLOUD-TOP REPORTS),
     84 C     BEFORE THESE WERE GROUPED WITH # FOV 10-25
     85 C 2001-08-20  D. A. KEYSER -- FOR QUIKSCAT REPORTS, HEADER WORD 10
     86 C     NOW RETURNS NUMBER OF ORIGINAL REPORTS USED TO GENERATE SUPEROBS
     87 C     SINCE THIS IS NOW AVAILABLE IN INPUT REPROCESSED QKSWND DUMP
     88 C     FILE (FOR NON-SUPEROBS, HARDWIRED TO 1)
     89 C 2002-01-28  D. A. KEYSER -- THE QUALITY CODE FOR WIND PROFILER LEVELS
     90 C     IS NOW SET TO 14 IF THE DECODED QN29 WIND QUALITY MARKER IS 12
     91 C     (REJECT LIST) OR 14 (SDM PURGE), OTHERWISE IT IS SET TO THE
     92 C     DECODED QUALITY CODE VALUE (BEFORE THE ON29 Q.M. WAS IGNORED);
     93 C     THE WIND Q.M. FOR VAD WINDS LEVELS IS NOW SET TO THE DECODED QN29
     94 C     WIND QUALITY MARKER IF IT IS 12 (REJECT LIST) OR 14 (SDM PURGE),
     95 C     OTHERWISE IT IS SET TO THE NUMERICAL INDICATOR FOR THE DECODED
     96 C     RMS VECTOR WIND ERROR (BEFORE THE ON29 Q.M. WAS IGNORED)
     97 C 2002-03-05  D. A. KEYSER -- ACCOUNTS FOR CHANGES IN INPUT PROFLR
     98 C     (WIND PROFILER BUFR DUMP FILE AFTER 5/2002: CAT. 10 SURFACE DATA
     99 C     NOW ALL MISSING (MNEMONICS "PMSL","WDIR1","WSPD1", "TMDB",
    100 C     "REHU", "REQV" NO LONGER AVAILABLE); CAT. 11 MNEMONICS "ACAVH",
    101 C     "ACAVV", "SPP0", AND "NPHL" NO LONGER AVAILABLE; HEADER MNEMONIC
    102 C     "NPSM" IS NO LONGER AVAILABLE; HEADER MNEMONIC "TPSE" REPLACES
    103 C     "TPMI" (AVG. TIME IN MINUTES STILL OUTPUT); NUMBER OF UPPER-AIR
    104 C     LEVELS INCR. FROM 43 TO UP TO 64 (SIZE OF OUTPUT "RDATA" ARRAY
    105 C     INCR. FROM 720 TO 1200 TO ACCOUNT FOR THIS) (WILL STILL WORK
    106 C     PROPERLY FOR INPUT PROFLR DUMP FILES PRIOR TO 5/2002)
    107 C 2002-07-03  D. A. KEYSER -- COMBINED INDIVIDUAL SUBROUTINES FOR
    108 C     PROCESSING HEADER INFORMATION FOR ALL TYPES INTO A SINGLE NEW
    109 C     SUBROUTINE SINCE ALL WERE VERY SIMILAR; ADDED PROCESSING OF GPS-
    110 C     IPW REPORTS HERE NOW THAT THEY ARE PACKED IN AN NCEP BUFR FILE
    111 C     (GPSIPW - RETURNED IN NEW CATEGORY 14)
    112 C 2004-02-02  D. A. KEYSER -- ADDED COOPERATIVE AGENCY (002/011) AND
    113 C     JAPANESE (002/013) WIND PROFILERS TO PROCESSING FOR WIND
    114 C     PROFILERS NOT ORIGINATING FROM PILOT (PIBAL) BULLETINS; ADDED

Page 3           Source Listing                  W3UNPKB7
2017-04-18 11:09                                 w3unpkb7.f

    115 C     PROCESSING OF NPN AND CAP RASS REPORTS HERE (002/012) NOW THAT
    116 C     THEY ARE PACKED IN AN NCEP BUFR FILE (RASSDA - RETURNED IN NEW
    117 C     DATA LEVEL CATEGORY 15); ADDED NEW INPUT ARGUMENT "SUBSKP" - SEE
    118 C     DESCRIPTION BELOW
    119 C 2004-09-09  D. A. KEYSER -- ADDED LOGIC TO HANDLE GOES 1x1 (SFOV)
    120 C     SOUNDING (RADIANCE/RETRIEVAL) DATA: DOES NOT Q.C. ANY 1x1 DATA
    121 C     (CLOUD AS BEFORE, BUT NOW ALSO SNDGS) BY NUMBER OF FOV's (STILL
    122 C     DOES SO FOR NON-RADIANCE 5x5 DATA); FOR GOES PW RETRIEVALS, IF
    123 C     TPW IS NOT FOUND UNDER LOCAL MNEMONIC "PH2O", NOW LOOKS FOR IT IN
    124 C     WMO MNEMONIC "TPWT", THIS ALLOWS FOR TRANSITION FROM "PH2O" TO
    125 C     "TPWT" IN REPORTS IN DUMP FILES (~ MID-2004) AND ALSO ALLOWS
    126 C     HISTORICAL RERUNS TO READ OLD DUMP FILES
    127 C 2005-03-14  D. A. KEYSER (THIS FUNCTION IN PROGRAM BUFR_LISTDUMPS):
    128 C 2007-09-14  D. A. KEYSER (THIS FUNCTION IN PROGRAM PREPOBS_PREPDATA):
    129 C     BUG FIX: REMOVED THIRD ARG. IN CALLS TO UNPKB709 AND UNPKB710
    130 C     (SUBROUTINES ONLY HAVE TWO ARG.)
    131 C 2006-07-14  D. A. KEYSER (THIS FUNCTION IN PROGRAM BUFR_LISTDUMPS):
    132 C 2007-09-14  D. A. KEYSER (THIS FUNCTION IN PROGRAM PREPOBS_PREPDATA):
    133 C     MODIFIED TO HANDLE NAVY WINDSAT SCATTEROMETER WINDS (READ FROM
    134 C     MESSAGE TYPES NC012138, GETS DUMP REPORT TYPE 583, OUTPUT IN
    135 C     "RDATA" CAT. 10 AND SOME ELEMENTS IN "RDATA2"); ADDED RETURN
    136 C     ARGUMENT "RDATA2", 1-DIM 21-WORD ARRAY WHICH HOLDS ADDITIONAL
    137 C     VALUES DECODED DIRECTLY FROM BUFR (AND NOT IN "RDATA" ARRAY);
    138 C     MOVED REPORT-TYPE SPECIFIC VALUES OUT OF RETURNED HEADER IN
    139 C     "RDATA" TO NEW "RDATA2" ARRAY (CLEANS UP HEADER PROCESSING);
    140 C     RAINFALL RATE IN CAT. 10 NOW RETURNED IN ORIGINAL BUFR UNITS OF
    141 C     KG/((M**2)*SEC) INSTEAD OF MM/HOUR (WINDSAT IS ONLY TYPE TO
    142 C     RETURN THIS); FOLDED SUBROUTINE UNPKB708 INTO UNPKB704 SINCE BOTH
    143 C     HAD PROCESSED DATA INTO CATEGORY 10 (UNPKB708 HANDLED
    144 C     SCATTEROMETER REPORTS, UNPKB704 HANDLED WIND PROFILER REPORTS)
    145 C 2007-09-14  D. A. KEYSER (THIS FUNCTION IN PROGRAM BUFR_LISTDUMPS):
    146 C 2007-09-14  D. A. KEYSER (THIS FUNCTION IN PROGRAM PREPOBS_PREPDATA):
    147 C     MODIFIED TO HANDLE NESDIS WINDSAT SCATTEROMETER WINDS (READ FROM
    148 C     MESSAGE TYPE NC012139), PROCESSING IS IDENTICAL TO NAVY WINDSAT
    149 C     SCATTEROMETER WINDS; HANDLES GOES 1x1 F-O-V SNDGS/RADIANCES IN
    150 C     DUMP FILE "GOESFV" (SUBSET "NC003003"); CODE FIGURE 258 REFERS
    151 C     ONLY TO CLOUD AMOUNT (HAD ALSO PREVIOUSLY REFERRED TO CLOUD COVER
    152 C     FOR GOES 1x1 SNDGS - GOES 1x1 AND 5x5 SNDGS NOW BOTH PROCESS
    153 C     CLOUD AMOUNT)
    154 C 2008-09-25  D. A. KEYSER -- ADDED ASCAT SCATTEROMETER WINDS HERE NOW
    155 C     THAT THEY ARE PACKED IN A NCEP BUFR FILE (GET DUMP REPORT TYPE
    156 C     584), RETURNED IN CATEGORY 10, EXPANDED 1-DIM OUTPUT ARRAY RDATA2
    157 C     FROM 21 TO 24 WORDS TO HOLD NEW ANCILLARY INFO FOR ASCAT REPORTS
    158 C     {WIND VECTOR CELL QUALITY (MNEMONIC WVCQ, BUFR F.T. 0-21-155),
    159 C     BACKSCATTER DISTANCE (MNEMONIC BSCD, NUMERIC), LIKELIHOOD
    160 C     COMPUTED FOR SOLUTION (MNEMONIC LKCS, NUMERIC)
    161 C 2012-11-30  J. WOOLLEN   -- INITIAL PORT TO WCOSS; RESET BMISS TO
    162 C     A VALUE (10E08) WHICH WILL NOT CAUSE INTEGER OVERFLOW WHICH CAN
    163 C     BE UNPREDICTABLE (PRIOR BMISS VALUE WAS 10E10)
    164 C 2013-02-14  D. A. KEYSER -- FINAL CHANGES TO RUN ON WCOSS; OBTAIN
    165 C     VALUE OF BMISS SET IN CALLING PROGRAM VIA CALL TO BUFRLIB ROUTINE
    166 C     GETBMISS RATHER THAN HARDWIRING IT TO 10E08 (OR 10E10); USE
    167 C     BUFRLIB FUNCTION IBFMS TO DETERMINE IF A VARIABLE READ FROM BUFR
    168 C     FILE IS MISSING (I.E. RETURNED AS BMISS);  USE FORMATTED PRINT
    169 C     STATEMENTS WHERE PREVIOUSLY UNFORMATTED PRINT WAS USED (WCOSS
    170 C     SPLITS UNFORMATTED PRINT AT 80 CHARACTERS); MAXIMUM NUMBER OF
    171 C     CAT. 11 WIND PROFILER LEVELS THAT CAN BE PROCESSED (EXCLUDING

Page 4           Source Listing                  W3UNPKB7
2017-04-18 11:09                                 w3unpkb7.f

    172 C     BOTTOM SURFACE LEVEL) REDUCED FROM 103 TO 102 AS FORMER CAUSED AN
    173 C     OVERFLOW OF THE CURRENT 1200 WORD LIMIT IN RDATA ARRAY; FOR ANY
    174 C     "GOESND" OR "GOESFV" DUMP FILES WITH CENTER TIME 2013022512 OR
    175 C     LATER, NO ATTEMPT IS MADE TO DECODE GOES SOUNDINGS (PROFILES) AS
    176 C     THESE WERE REMOVED AT THIS TIME FROM THE 1X1 GOES RADIANCE FILES
    177 C     PROVIDED BY NESDIS (INGESTED INTO FROM TANK b003/xx003)
    178 C 2014-03-13  D. A. KEYSER -- MODIFIED TO HANDLE VAD WINDS FROM LEVEL
    179 C     2 DECODER (SUBSET "NC002017") {IN ADDITION TO THOSE FROM RADAR
    180 C     CODED MESSAGE (SUBSET "NC002008")}; PARAMETERIZED MAXIMUM NUMBER
    181 C     OF LEVELS ALLOWED FOR EACH CATEGORY AND CALCULATED PARAMETER
    182 C     "IDMAX" (SIZE OF OUTPUT "RDATA" ARRAY) BASED ON THESE, ALL ARE
    183 C     NOW PLACED IN INCLUDE FILE 'inc_w3unpkb7.inc' {IN HERE, MAXIMUM
    184 C     NUMBER OF CAT. 04 WINDS-BY-HEIGHT LEVELS (EXCLUDING FIRST,
    185 C     SURFACE, LEVEL), "ILVLMX_04", INCREASED FROM 64 TO 254 TO ACCOUNT
    186 C     FOR MORE LEVELS IN NEW VAD WINDS FROM LEVEL 2 DECODER, AND
    187 C     MAXIMUM NUMBER OF CAT. 11 WIND PROFILER LEVELS (EXCLUDING FIRST,
    188 C     SURFACE, LEVEL), "ILVLMX_11", INCREASED FROM 102 TO 200 TO
    189 C     ACCOUNT FOR SOME MAP PROFILERS WITH MORE LEVELS THAN BEFORE, THE
    190 C     RESULTING "IDMAX" IS NOW 2270, UP FROM 1200 BEFORE}
    191 C 2015-04-16 JWhiting --  RDATA2 is expanded to size 25 in order to
    192 C     store total cloud cover (TOCC) (present in dumps of GOES cloud
    193 C     reports) (stored in subr. UNPKB707).
    194 C 2015-12-18 D. A. Keyser -- Updated to decode variables specific to 
    195 C     the new WMO BUFR format for GNSS ground-based data (in dump file 
    196 C     "gpsipw" under subset "NC012004") in order to process GPS-Met 
    197 C     reports from this feed. Namely:
    198 C       CLATH (high-res lat) --> stored as lat in header array returned
    199 C        to calling program
    200 C       CLONH (high-res lon) --> stored as lon in header array returned
    201 C        to calling program
    202 C       STSN (station name) --> stored as STNID returned to calling
    203 C        program
    204 C       TMDBST (dry-bulb temperature to nearest 0.1K) --> stored in 
    205 C        cat. 14 returned to calling program
    206 C       APDS (atmospheric path delay in satellite signal, m, from
    207 C        replication where azimuth angle is zero deg. and elevation
    208 C        angle is 90 deg.) --> this is defined as ZENITH TOTAL DELAY and
    209 C        is stored in cat. 14 returned to calling program
    210 C       APDE (error in atmospheric path delay in satellite signal, m,
    211 C        from replication where azimuth angle is zero deg. and elevation
    212 C        angle is 90 deg.) --> this is defined as ERROR IN ZENITH TOTAL
    213 C        DELAY and is stored in cat. 14 returned to calling program
    214 C     (Note: will still also properly decode variables in current
    215 C     production non-standard BUFR format GPS ground-based data (in dump 
    216 C     file "gpsipw" under subset "NC012003").
    217 C 2016-08-15 JWhiting -- Added variable 'subset' to UNPKB709 argument
    218 C     list so as to allow its use in testing for whether reports are 
    219 C     from new GNSS ground-based data streams (subset=NC012004); this 
    220 C     replaces potentially ambiguous test on missing TDEL data from 
    221 C     previous GPS-IPW data streams.
    222 C 2016-11-30  D. A. KEYSER --
    223 C     Added new output real, double-precision argument array RDATA8_8 of
    224 C     length 2 to return full-precision latitude and longitude for a
    225 C     report.
    226 C     BENEFIT: Although lat and lon are returned in RDATA(1:2) these are
    227 C              at machine precison, which is normally R*4.  Now that
    228 C              many reports in the dumps store lat/lon at 0.001 or even

Page 5           Source Listing                  W3UNPKB7
2017-04-18 11:09                                 w3unpkb7.f

    229 C              0.00001 degree precision, and now that PREPBUFR encodes
    230 C              YOB (lat) and XOB (lon) at 0.00001 degree precision, this
    231 C              change will ensure that lat/lon is always accurate to
    232 C              0.00001 degrees in all downstream processing.
    233 C
    234 C
    235 C
    236 C USAGE:    CALL W3UNPKB7(IDATE,IHE,IHL,LUNIT,RDATA,STNID,DSNAME,
    237 C                         RDATA2,RDATA8_8,IDSDAT,IDSDMP_8,SUBSET,SUBSKP,
    238 C                         IRET)
    239 C   INPUT ARGUMENT LIST:
    240 C     IDATE    - 4-WORD ARRAY HOLDING "CENTRAL" DATE TO PROCESS
    241 C              - (YYYY, MM, DD, HH)
    242 C     IHE      - NUMBER OF WHOLE HOURS RELATIVE TO "IDATE" FOR DATE OF
    243 C              - EARLIEST BUFR MESSAGE THAT IS TO BE DECODED; EARLIEST
    244 C              - DATE IS "IDATE" + "IHE" HOURS (IF "IHE" IS POSITIVE,
    245 C              - EARLIEST MESSAGE DATE IS AFTER "IDATE"; IF "IHE" IS
    246 C              - NEGATIVE, EARLIEST MESSAGE DATE IS PRIOR TO "IDATE")
    247 C              - EXAMPLE: IF IHE=1, THEN EARLIEST DATE IS 1-HR AFTER
    248 C              - IDATE; IF IHE=-2, THEN EARLIEST DATE IS 2-HR PRIOR
    249 C              - TO IDATE
    250 C     IHL      - NUMBER OF WHOLE HOURS RELATIVE TO "IDATE" FOR DATE OF
    251 C              - LATEST BUFR MESSAGE THAT IS TO BE DECODED; LATEST
    252 C              - DATE IS "IDATE" + ("IHL" HOURS PLUS 59 MIN) IF "IHL"
    253 C              - IS POSITIVE (LATEST MESSAGE DATE IS AFTER "IDATE"),
    254 C              - AND "IDATE" + ("IHL"+1 HOURS MINUS 1 MIN) IF "IHL"
    255 C              - IS NEGATIVE (LATEST MESSAGE DATE IS PRIOR TO "IDATE")
    256 C              - EXAMPLE: IF IHL=2, THEN LATEST DATE IS 2-HR 59-MIN
    257 C              - AFTER IDATE; IF IHL=-2, THEN LATEST DATE IS 1-HR 1-MIN
    258 C              - PRIOR TO IDATE
    259 C       NOTE: THERE IS NO LIMIT ON THE VALUES FOR "IHE" AND "IHL",
    260 C              HOWEVER IF IHE IS .LE. -3 AND IHL IS .GE. +2, THEN IT
    261 C              IS ASSUMED THAT ALL BUFR MESSAGES IN THE FILE ARE TO BE
    262 C              PROCESSED REGARDLESS OF THEIR TIME SO IT DOESN'T MAKE
    263 C              ANY SENSE TO SPECIFY VALUES OUTSIDE THIS RANGE.
    264 C     LUNIT    - FORTRAN UNIT NUMBER FOR INPUT DATA FILE
    265 C     SUBSKP   - TWO-DIMENSIONAL LOGICAL ARRAY WHERE ELEMENT 1 REFERS
    266 C              - TO A PARTICULAR BUFR TYPE (RANGE 0-255) AND ELEMENT 2
    267 C              - REFERS TO A PARTICULAR BUFR SUBTYPE (RANGE 0-200). IF
    268 C              - SUBSKP IS SET TO TRUE FOR A PARTICULAR BUFR TYPE AND
    269 C              - SUBTYPE, THEN ANY BUFR MESSAGE OF THIS TYPE READ IN
    270 C              - WILL BE SKIPPED OVER {NO SUBSETS (REPORTS) WILL BE
    271 C              - DECODED OUT OF IT AND RETURNED TO THE CALLING PROGRAM,
    272 C              - INSTEAD THIS SUBROUTINE WILL MOVE ON TO READ THE NEXT
    273 C              - BUFR MESSAGE IN THE FILE AND AGAIN USE SUBSKP TO SEE
    274 C              - IF ANY SUBSETS SHOULD BE DECODED OUT OF IT}. THIS
    275 C              - ALLOWS THIS SUBROUTINE TO QUICKLY PASS BY ANY BUFR
    276 C              - MESSAGES WITH A TYPE/SUBTYPE THAT THE CALLING PROGRAM
    277 C              - DOES NOT WANT DECODED.  THE LENGTH OF THIS ARRAY
    278 C              - SHOULD ALWAYS BE HARDWIRED TO (0:255,0:200).
    279 C     IRET     - CONTROLS DEGREE OF UNIT 6 PRINTOUT (.GE. 0 -LIMITED
    280 C              - PRINTOUT; = -1 SOME ADDITIONAL DIAGNOSTIC PRINTOUT;
    281 C              = .LT. -1 -EXTENSIVE PRINTOUT) (SEE REMARKS 3)
    282 C
    283 C   OUTPUT ARGUMENT LIST:
    284 C     RDATA    - SINGLE REPORT RETURNED AN A QUASI-IW3UNPBF
    285 C              - UNPACKED FORMAT (SEE REMARKS 5) (MINIMUM SIZE IS

Page 6           Source Listing                  W3UNPKB7
2017-04-18 11:09                                 w3unpkb7.f

    286 C              - 1500 WORDS) (NOTE: DOES NOT INCLUDE STATION ID)
    287 C     STNID    - CHARACTER*8 SINGLE REPORT STATION IDENTIFICATION (UP
    288 C              - TO 8 CHARACTERS, LEFT-JUSTIFIED) (SEE REMARKS 4 FOR
    289 C              - INFORMATION ON STRUCTURE OF GOES SOUNDING STNID)
    290 C     DSNAME   - CHARACTER*8 DATA SET NAME (SAME FOR ALL REPORTS IN
    291 C              - A COMMON INPUT DATA SET - SEE OUTPUT ARGUMENT LIST
    292 C              - BELOW FOR IRET=1 CASE)
    293 C     RDATA2   - 25-WORD ARRAY CONTAINING ADDITIONAL REPORT DATA NOT
    294 C              - PRESENT IN RDATA ARRAY (DECODED DIRECTLY FROM BUFR)
    295 C              - (SEE REMARKS 6 FOR CONTENT)
    296 C     RDATA8_8 - 2-WORD REAL*8 ARRAY CONTAINING ADDITIONAL REPORT DATA
    297 C                (LATITUDE AND LONGITUDE) (SEE REMARKS 7 FOR CONTENT)
    298 C     IDSDAT   - INTEGER DATA SET CENTER DATE IN FORM YYYYMMDDHH (SAME
    299 C              - FOR ALL REPORTS IN A COMMON INPUT DATA SET - SEE
    300 C              - OUTPUT ARGUMENT LIST BELOW FOR IRET=1 CASE)
    301 C     IDSDMP_8 - INTEGER*8 DATA SET DUMP TIME IN FORM YYYYMMDDHHMM
    302 C              - (SAME FOR ALL REPORTS IN A COMMON INPUT DATA SET - SEE
    303 C              - OUTPUT ARGUMENT LIST BELOW FOR IRET=1 CASE)
    304 C     SUBSET   - CHARACTER*8 BUFR MESSAGE TYPE (SAME FOR ALL REPORTS
    305 C              - IN A COMMON BUFR MESSAGE)
    306 C     IRET     - RETURN CODE AS FOLLOWS:
    307 C            =  0 OBSERVATION READ AND UNPACKED INTO OUTPUT ARGUMENT
    308 C                 LOCATIONS (SEE ABOVE).  SEE REMARKS FOR CONTENTS.
    309 C                 NEXT CALL TO W3UNPKB7 WILL RETURN NEXT OBSERVATION
    310 C                 IN DATA SET.
    311 C            =  1 INFORMATION ABOUT THE BUFR DATASET IS RETURNED IN
    312 C                 THE OUTPUT ARGUMENTS DSNAME, IDSDAT, IDSDMP_8 (SEE
    313 C                 OUTPUT ARGUMENT LIST ABOVE)
    314 C
    315 C                 THIS SHOULD ALWAYS OCCUR AFTER THE FIRST CALL TO
    316 C                 THIS SUBROUTINE FOR A NEW UNIT NUMBER (I.E., A NEW
    317 C                 DATA SET) OR IF THE INPUT DATE/TIME OR RANGE IN TIME
    318 C                 HAS BEEN CHANGED FROM LAST CALL (I.E., A DATA SET
    319 C                 IS ABOUT TO BE READ FROM THE TOP).  NO REPORT IS
    320 C                 UNPACKED AT THIS POINT, AND ONLY DSNAME, IDSDAT, AND
    321 C                 IDSDMP_8 CONTAIN INFORMATION.  ALL SUBSEQUENT CALLS
    322 C                 TO W3UNPKB7 SHOULD RETURN THE OBSERVATIONS IN THIS
    323 C                 DATA SET, SEQUENTIALLY, (IRET=0) UNTIL THE END OF
    324 C                 FILE IS ENCOUNTERED (IRET=2).  THE VALUES STORED IN
    325 C                 DSNAME, IDSDAT, AND IDSDMP_8 WILL CONTINUE TO BE
    326 C                 RETURNED ALONG WITH EACH REPORT WHEN IRET = 0.
    327 C            =  2 FOR NORMAL END-OF-FILE ENCOUNTERED.
    328 C            =  3 LAT AND/OR LON DATA MISSING -- NO REPORT RETURNED.
    329 C            =  4 SOME/ALL DATE INFORMATION MISSING -- NO REPORT
    330 C                 RETURNED.
    331 C            =  5 NO "CATEGORY" DATA LEVELS PROCESSED (ALL LEVELS ARE
    332 C                 MISSING) -- NO REPORT RETURNED.
    333 C            =  6 NUMBER OF LEVELS IN REPORT HEADER IS NOT 1 -- NO
    334 C                 REPORT RETURNED.
    335 C            =  7 NUMBER OF LEVELS IN ANOTHER SINGLE LEVEL SEQUENCE IS
    336 C                 NOT 1 -- NO REPORT RETURNED.
    337 C            =  8 REPORT IS A WIND PROFILER ORIGINATING FROM PILOT
    338 C                 (PIBAL) FORMAT BULLETINS -- NO REPORT RETURNED.
    339 C
    340 C   INPUT FILES:
    341 C     UNIT AA  - (WHERE AA IS LUNIT ABOVE) FILE HOLDING THE DATA
    342 C              - IN THE FORM OF BUFR MESSAGES

Page 7           Source Listing                  W3UNPKB7
2017-04-18 11:09                                 w3unpkb7.f

    343 C
    344 C   OUTPUT FILES:
    345 C     UNIT 06  - STANDARD OUTPUT PRINT
    346 C
    347 C   SUBPROGRAMS CALLED:
    348 C     UNIQUE        - UNPKB701 UNPKB702 UNPKB703 UNPKB704 UNPKB705
    349 C                   - UNPKB706 UNPKB707 UNPKB709 UNPKB710
    350 C     LIBRARY:
    351 C       W3NCO       - W3FI04   W3MOVDAT W3DIFDAT ERREXIT
    352 C       BUFRLIB     - DATELEN  DUMPBF   OPENBF   READMG   UFBCNT
    353 C                   - READSB   UFBINT   CLOSBF   NMSUB    GETBMISS
    354 C                   - IBFMS    CBFMS    READLC   UFBREP
    355 C
    356 C REMARKS:
    357 C    1) A CONDITION CODE (STOP) OF 15 WILL OCCUR IF THE INPUT DATES FOR
    358 C       START AND/OR STOP TIME ARE SPECIFIED INCORRECTLY.
    359 C
    360 C
    361 C
    362 C    2) A CONDITION CODE (STOP) OF 22 WILL OCCUR IF THE CHARACTERS ON
    363 C       THIS MACHINE ARE NEITHER ASCII NOR EBCDIC.
    364 C
    365 C
    366 C
    367 C    3) THE INPUT ARGUMENT "IRET" SHOULD BE SET PRIOR TO EACH CALL TO
    368 C       THIS SUBROUTINE.
    369 C      
    370 C      
    371 C      
    372 C    4) FOR GOES SOUNDING/RADIANCE REPORTS, THE EIGHTH CHARACTER OF
    373 C       STATION ID (stnid) IS A TAGGED AS FOLLOWS:
    374 C          "I" - GOES-EVEN-1 (252, 256, ...) SAT. , CLEAR COLUMN  RETR.
    375 C          "J" - GOES-EVEN-1 (252, 256, ...) SAT. , CLOUDY RETRIEVAL
    376 C          "K" - GOES-EVEN-1 (252, 256, ...) SAT. , UNKNOWN PATH
    377 C
    378 C          "L" - GOES-ODD-1  (253, 257, ...) SAT. , CLEAR COLUMN  RETR.
    379 C          "M" - GOES-ODD-1  (253, 257, ...) SAT. , CLOUDY RETRIEVAL
    380 C          "N" - GOES-ODD-1  (253, 257, ...) SAT. , UNKNOWN PATH
    381 C
    382 C          "O" - GOES-EVEN-2 (254, 258, ...) SAT. , CLEAR COLUMN  RETR.
    383 C          "P" - GOES-EVEN-2 (254, 258, ...) SAT. , CLOUDY RETRIEVAL
    384 C          "S" - GOES-EVEN-2 (254, 258, ...) SAT. , UNKNOWN PATH
    385 C
    386 C          "Q" - GOES-ODD-2  (251, 255, ...) SAT. , CLEAR COLUMN  RETR.
    387 C          "R" - GOES-ODD-2  (251, 255, ...) SAT. , CLOUDY RETRIEVAL
    388 C          "T" - GOES-ODD-2  (251, 255, ...) SAT. , UNKNOWN PATH
    389 C
    390 C          "?" - SATELLITE UNKNOWN
    391 C
    392 C
    393 C
    394 C    5) CONTENTS OF AN UNPACKED REPORT IN THE "RDATA" ARRAY (MISSING
    395 C       INTEGER DATA ARE SET TO IMISS (99999); MISSING REAL DATA ARE
    396 C       SET TO XMISS (99999.)
    397 C
    398 C     (NOTE: DOES NOT INCLUDE STATION IDENTIFICATION AND "RDATA2" ARRAY
    399 C            OUTPUT; LATITUDE AND LONGITUDE IN RDATA(1:2) ARE ALSO

Page 8           Source Listing                  W3UNPKB7
2017-04-18 11:09                                 w3unpkb7.f

    400 C            OUTPUT IN REAL*8 IN "RDATA8_8" - SEE OUTPUT ARGUMENT
    401 C            "STNID" ABOVE, "RDATA2" CONTENTS IN REMARKS 6. BELOW AND
    402 C            "RDATA8_8" CONTENTS IN REMARKS 7. BELOW)
    403 C
    404 C   ***************************************************************
    405 C   WORD   CONTENT                   UNIT                 FORMAT
    406 C   ----   ----------------------    -------------------  ---------
    407 C     1    LATITUDE                  DEGREES (N+,S-)      REAL
    408 C     2    LONGITUDE                 DEGREES EAST         REAL
    409 C     3    NOT USED                  MISSING              REAL
    410 C     4    OBSERVATION TIME          HOURS (UTC)          REAL
    411 C     5    DATE                      YYYYMMDDHH           INTEGER
    412 C     6    SATELLITE ID      (BUFR CODE TABLE 0-01-007)   INTEGER
    413 C                                    (SEE @)
    414 C     7    STATION ELEVATION         METERS               REAL
    415 C     8    INSTRUMENT TYPE           (SEE $)              INTEGER
    416 C     9    DUMP REPORT TYPE          (SEE &)              INTEGER
    417 C    10    DUMP REPORT SUBTYPE       MISSING              INTEGER
    418 C    11    RECEIPT TIME              HOURS (UTC)          REAL
    419 C    12    NOT USED                  MISSING              REAL
    420 C
    421 C 13-18    ZEROED OUT - NOT USED
    422 C    19    CATEGORY  4, NO. LEVELS   COUNT                INTEGER
    423 C    20    CATEGORY  4, DATA INDEX   COUNT                INTEGER
    424 C 21-26    ZEROED OUT - NOT USED
    425 C    27    CATEGORY  8, NO. LEVELS   COUNT                INTEGER
    426 C    28    CATEGORY  8, DATA INDEX   COUNT                INTEGER
    427 C 29-34    ZEROED OUT - NOT USED                          INTEGER
    428 C    35    CATEGORY 10, NO. LEVELS   COUNT                INTEGER
    429 C    36    CATEGORY 10, DATA INDEX   COUNT                INTEGER
    430 C    37    CATEGORY 11, NO. LEVELS   COUNT                INTEGER
    431 C    38    CATEGORY 11, DATA INDEX   COUNT                INTEGER
    432 C    39    CATEGORY 12, NO. LEVELS   COUNT                INTEGER
    433 C    40    CATEGORY 12, DATA INDEX   COUNT                INTEGER
    434 C    41    CATEGORY 13, NO. LEVELS   COUNT                INTEGER
    435 C    42    CATEGORY 13, DATA INDEX   COUNT                INTEGER
    436 C    43    CATEGORY 14, NO. LEVELS   COUNT                INTEGER
    437 C    44    CATEGORY 14, DATA INDEX   COUNT                INTEGER
    438 C    45    CATEGORY 15, NO. LEVELS   COUNT                INTEGER
    439 C    46    CATEGORY 15, DATA INDEX   COUNT                INTEGER
    440 C 47-52    ZEROED OUT - NOT USED                          INTEGER
    441 C
    442 C 53-END   UNPACKED DATA GROUPS      (SEE BELOW)          MIXED
    443 C
    444 C    @ - WORD  6, SATELLITE ID, IS CURRENTLY SET TO MISSING FOR
    445 C         ALL TYPES EXCEPT:
    446 C             GOES SOUNDING/RADIANCE                 (DUMP RPT TYPE 061)
    447 C             ERS SCATTEROMETER                      (DUMP RPT TYPE 581)
    448 C             QUIKSCAT SCATTEROMETER                 (DUMP RPT TYPE 582)
    449 C             WINDSAT SCATTEROMETER (NAVY or NESDIS) (DUMP RPT TYPE 583)
    450 C             ASCAT SCATTEROMETER                    (DUMP RPT TYPE 584)
    451 C
    452 C    $ - WORD  8, INSTRUMENT TYPE, IS CURRENTLY SET TO MISSING FOR
    453 C         ALL TYPES EXCEPT:
    454 C             GOES SOUNDING/RADIANCE (DUMP REPORT TYPE 061)
    455 C               Processing technique
    456 C                  21       Clear

Page 9           Source Listing                  W3UNPKB7
2017-04-18 11:09                                 w3unpkb7.f

    457 C                  23       Cloudy
    458 C
    459 C    & - DUMP REPORT TYPES:
    460 C          061 - GOES sounding/radiance
    461 C          071 - NOAA Profiler Network (NPN) wind
    462 C          072 - NEXRAD (VAD) wind (from both Radar Coded Message and
    463 C                from Level 2 decoder)
    464 C          074 - GPS-IPW
    465 C          075 - Cooperative Agency Profiler (CAP) wind
    466 C          076 - Japanese Meteological Agency (JMA) profiler wind
    467 C          077 - NOAA Profiler Network (NPN) or Cooperative Agency
    468 C                Profiler (CAP) RASS temperature
    469 C          581 - ERS scatterometer
    470 C          582 - QuikSCAT scatterometer
    471 C          583 - WindSat scatterometer (NAVY or NESDIS)
    472 C          584 - ASCAT scatterometer
    473 C
    474 C   ***************************************************************
    475 C
    476 C     DATA ARE UNPACKED INTO FIXED LOCATIONS IN WORDS 1-12 AND INTO
    477 C     INDEXED LOCATIONS IN WORD 53 AND FOLLOWING.  EACH LEVEL IN
    478 C     THE INPUT BUFR REPORT IS STORED IN THE "DATA LEVEL CATEGORIES"
    479 C     DESCRIBED BELOW, BASED ON THE TYPE OF DATA.  EACH DATA LEVEL
    480 C     CATEGORY HAS A LAYOUT IN LOCATIONS IN ARRAY RDATA THAT MAY BE
    481 C     FOUND BY USING THE CORRESPONDING INDEX AMOUNT FROM WORDS 14,
    482 C     16, ..., 46, IN ARRAY RDATA.  FOR INSTANCE, IF A REPORT IS
    483 C     UNPACKED INTO ONE OR MORE CATEGORY 4 DATA LEVEL GROUPS (WIND
    484 C     DATA AT VARIABLE HEIGHT LEVELS) THAT DATA WILL BE SPECIFIED IN
    485 C     THE UNPACKED BINARY FORMAT AS DESCRIBED BELOW UNDER DATA LEVEL
    486 C     CATEGORY 4.  THE NUMBER OF LEVELS WILL BE STORED IN WORD
    487 C     19 OF OBS AND THE INDEX OF THE FIRST LEVEL OF UNPACKED DATA IN
    488 C     THE OUTPUT ARRAY WILL BE STORED IN WORD 20.  THE SECOND LEVEL,
    489 C     IF ANY, WILL BE STORED BEGINNING FIVE WORDS FURTHER ON, AND SO
    490 C     FORTH UNTIL THE COUNT IN WORD 19 IS EXHAUSTED.  THE FIELD
    491 C     LAYOUT IN EACH DATA LEVEL CATEGORY IS GIVEN BELOW...
    492 C
    493 C
    494 C     DATA LEVEL CATEGORY 4 - WINDS AT VARIABLE HEIGHTS (FIRST LEVEL
    495 C                             IS SURFACE) (EACH LEVEL, SEE WORD 19
    496 C                             ABOVE)
    497 C      (Currently used only by VAD wind reports)
    498 C
    499 C     WORD   PARAMETER            UNITS               FORMAT
    500 C     ----   ---------            -----------------   -------------
    501 C       1    HEIGHT ABOVE SEA     METERS              REAL
    502 C            LEVEL
    503 C       2    HORIZONTAL WIND      DEGREES             REAL
    504 C            DIRECTION (VAD FROM RADAR CODED MESSAGE)
    505 C            U-COMPONENT WIND     METERS/SEC          REAL
    506 C            (VAD FROM LEVEL 2 DECODER)
    507 C       3    HORIZONTAL WIND      0.1 METERS/SEC      REAL
    508 C            SPEED (VAD FROM RADAR CODED MESSAGE)
    509 C            V-COMPONENT WIND     METERS/SEC          REAL
    510 C            (VAD FROM LEVEL 2 DECODER)
    511 C       4    QUALITY MARKER FOR   (hardwired to 2.)   REAL
    512 C            HEIGHT
    513 C       5    QUALITY MARKER FOR   (SEE %)             REAL

Page 10          Source Listing                  W3UNPKB7
2017-04-18 11:09                                 w3unpkb7.f

    514 C            WIND
    515 C
    516 C  %-  VALUES FROM 1-7 INDICATE A "CONFIDENCE LEVEL" WHICH IS RELATED
    517 C       TO THE ROOT-MEAN-SQUARE VECTOR ERROR FOR THE HORIZONTAL WIND.
    518 C       IT IS DEFINED AS FOLLOWS:
    519 C                1.0  = RMS OF  1.9 KNOTS
    520 C                2.0  = RMS OF  3.9 KNOTS
    521 C                3.0  = RMS OF  5.8 KNOTS
    522 C                4.0  = RMS OF  7.8 KNOTS (DEFAULT)
    523 C                5.0  = RMS OF  9.7 KNOTS
    524 C                6.0  = RMS OF 11.7 KNOTS
    525 C                7.0  = RMS  > 13.6 KNOTS
    526 C      VALUE 12 INDICATES THE WIND IS FLAGGED DUE TO ITS BEING ON THE
    527 C               REJECT LIST
    528 C      VALUE 14 INDICATES THE WIND IS FLAGGED DUE TO ITS BEING PURGED
    529 C               MANUALLY BY THE NCEP SDM
    530 C
    531 C
    532 C     DATA LEVEL CATEGORY 10 - SURFACE LEVEL (EACH LEVEL, SEE WORD 35
    533 C                              ABOVE)
    534 C      (Currently used by wind profiler, ERS scatterometer, QuikSCAT
    535 C       scatterometer, WindSat scatterometer and ASCAT scatterometer
    536 C       reports)
    537 C
    538 C     WORD   PARAMETER            UNITS               FORMAT
    539 C     ----   ---------            -----------------   -------------
    540 C       1    SEA-LEVEL PRESSURE   0.1 MILLIBARS       REAL
    541 C       2    STATION PRESSURE     0.1 MILLIBARS       REAL
    542 C       3    HORIZ. WIND DIR.     DEGREES             REAL
    543 C       4    HORIZ. WIND SPEED    0.1 METERS/SEC      REAL
    544 C       5    AIR TEMPERATURE      0.1 KELVIN          REAL
    545 C       6    RELATIVE HUMIDITY    PERCENT             REAL
    546 C       7    RAINFALL RATE        KG/((METER**2)*SEC) REAL
    547 C
    548 C  Note: For wind profiler, word 2 always missing; words 1, 3-7
    549 C         no longer available after 5/2002 (missing)
    550 C        For ERS, QuikSCAT and ASCAT scatterometer, words 1,2, 5-7
    551 C         always missing
    552 C        For WindSat scatterometer, words 1,2, 5-6 always missing
    553 C
    554 C
    555 C     DATA LEVEL CATEGORY 11 - UPPER-AIR LEVEL (FIRST LEVEL IS SURFACE)
    556 C                              (EACH LEVEL, SEE WORD 37 ABOVE)
    557 C      (Currently used only by wind profiler reports)
    558 C
    559 C     WORD   PARAMETER            UNITS               FORMAT
    560 C     ----   ---------            -----------------   -------------
    561 C       1    HEIGHT ABOVE SEA-LVL METERS              REAL
    562 C       2    HORIZ. WIND DIR.     DEGREES             REAL
    563 C       3    HORIZ. WIND SPEED    0.1 METERS/SEC      REAL
    564 C       4    QUALITY CODE         (SEE %)             INTEGER
    565 C       5    VERT. WIND COMP. (W) 0.01 METERS/SEC     REAL
    566 C(SEE @)6    HORIZ. CONSENSUS NO. (SEE $)             INTEGER
    567 C(SEE @)7    VERT.  CONSENSUS NO. (SEE $)             INTEGER
    568 C       8 - NOAA Profiler Network (NPN) and Cooperative Agency (CAP):
    569 C    (SEE @) SPECTRAL PEAK POWER  DB                  REAL
    570 C         - Japanese:

Page 11          Source Listing                  W3UNPKB7
2017-04-18 11:09                                 w3unpkb7.f

    571 C            SIG-TO-NOISE RATIO   DB                  REAL
    572 C       9    HORIZ. WIND SPEED    0.1 METERS/SEC      REAL
    573 C            STANDARD DEVIATION
    574 C      10    VERT. WIND COMPONENT 0.1 METERS/SEC      REAL
    575 C            STANDARD DEVIATION
    576 C(SEE @)11   MODE                 (SEE #)             INTEGER
    577 C
    578 C  *-  ALWAYS MISSING
    579 C  %-  0 - MEDIAN AND SHEAR CHECKS BOTH PASSED (NPN and CAP)
    580 C        - DATA NOT SUSPECT (JAPANESE)
    581 C      1 - DATA SUSPECT (JAPANESE)
    582 C      2 - MEDIAN AND SHEAR CHECK RESULTS INCONCLUSIVE (NPN and CAP)
    583 C      3 - QUALITY INFORMATION NOT GIVEN (JAPANESE)
    584 C      4 - MEDIAN CHECK PASSED; SHEAR CHECK FAILED (NPN and CAP)
    585 C      8 - MEDIAN CHECK FAILED; SHEAR CHECK PASSED (NPN and CAP)
    586 C     12 - MEDIAN AND SHEAR CHECKS BOTH FAILED (NPN and CAP)
    587 C     14 - THE WIND IS FLAGGED DUE TO EITHER:
    588 C               BEING ON THE REJECT LIST, OR
    589 C               BEING PURGED MANUALLY BY THE NCEP SDM
    590 C  $-  NO. OF INDIVIDUAL 6-MINUTE AVERAGE MEASUREMENTS THAT WERE
    591 C      INCLUDED IN FINAL ESTIMATE OF AVERAGED WIND (RANGE: 0, 2-10)
    592 C      (BASED ON A ONE-HOUR AVERAGE)
    593 C  #-  1 - DATA FROM LOW MODE
    594 C      2 - DATA FROM HIGH MODE
    595 C      3 - MISSING
    596 C  @-  THIS PARAMETER IS NO LONGER AVAILABLE AFTER 5/2002 AND IS SET
    597 C      TO MISSING
    598 C
    599 C
    600 C     DATA LEVEL CATEGORY 12 - SATELLITE SOUNDING LEVEL (FIRST LEVEL IS
    601 C                              SURFACE) (EACH LEVEL, SEE WORD 39 ABOVE)
    602 C      (Currently used only by GOES sounding/radiance reports)
    603 C
    604 C     WORD   PARAMETER            UNITS               FORMAT
    605 C     ----   ---------            -----------------   -------------
    606 C       1    PRESSURE             0.1 MILLIBARS       REAL
    607 C       2    GEOPOTENTIAL         METERS              REAL
    608 C       3    TEMPERATURE          0.1 DEGREES C       REAL
    609 C       4    DEWPOINT TEMPERATURE 0.1 DEGREES C       REAL
    610 C       5    NOT USED             SET TO MISSING      REAL
    611 C       6    NOT USED             SET TO MISSING      REAL
    612 C       7    Q.M. FOR GEOPOT      (SEE &)             REAL
    613 C       8    Q.M. FOR TEMPERATURE (SEE &)             REAL
    614 C       9    Q.M. FOR DEWPT TEMP  (SEE &)             REAL
    615 C
    616 C  &-  2.0 - INDICATES DATA NOT SUSPECT
    617 C      3.0 - INDICATES DATA ARE SUSPECT
    618 C     13.0 - INDICATES DATA ARE BAD
    619 C
    620 C
    621 C     DATA LEVEL CATEGORY 13 - SATELLITE RADIANCE "LEVEL" (EACH
    622 C                              "LEVEL", SEE WORD 41 ABOVE)
    623 C      (Currently used only by GOES sounding/radiance reports)
    624 C
    625 C     WORD   PARAMETER            UNITS               FORMAT
    626 C     ----   ---------            -----------------   -------------
    627 C       1    CHANNEL NUMBER       NUMERIC             INTEGER

Page 12          Source Listing                  W3UNPKB7
2017-04-18 11:09                                 w3unpkb7.f

    628 C       2    BRIGHTNESS TEMP.     KELVIN              REAL
    629 C       3    Q.M. FOR BTEMP       (SEE &)             REAL
    630 C
    631 C  &-  2.0 - INDICATES DATA NOT SUSPECT
    632 C      3.0 - INDICATES DATA ARE SUSPECT
    633 C     13.0 - INDICATES DATA ARE BAD
    634 C
    635 C
    636 C     DATA LEVEL CATEGORY 14 - GPS-IPW DATA (FIRST LEVEL IS SURFACE)
    637 C                              (EACH LEVEL, SEE WORD 43 ABOVE)
    638 C      (Currently used only by GPS-IPW reports)
    639 C
    640 C     WORD   PARAMETER            UNITS               FORMAT
    641 C     ----   ---------            -----------------   -------------
    642 C       1    STATION PRESSURE     MILLIBARS           REAL
    643 C       2    AIR TEMPERATURE      KELVIN              REAL
    644 C       3    RELATIVE HUMIDITY    PERCENT             REAL
    645 C       4    TOTAL PRECIP. WATER  MILLIMETERS         REAL
    646 C       5    ZENITH TOTAL DELAY   METERS              REAL
    647 C       6    ERROR IN ZENITH      METERS              REAL
    648 C            TOTAL DELAY
    649 C       7    HYDROSTATIC DELAY    METERS              REAL
    650 C       8    ERROR IN HYDROSTATIC METERS              REAL
    651 C            DELAY
    652 C       9    WEIGHTED MEAN        KELVIN              REAL
    653 C            TEMPERATURE
    654 C      10    WET DELAY MAPPING    NUMERIC             REAL
    655 C            FUNCTION    
    656 C
    657 C
    658 C     DATA LEVEL CATEGORY 15 - RASS DATA (FIRST LEVEL IS SURFACE)
    659 C                              (EACH LEVEL, SEE WORD 45 ABOVE)
    660 C      (Currently used only by RASS reports)
    661 C
    662 C     WORD   PARAMETER            UNITS               FORMAT
    663 C     ----   ---------            -----------------   -------------
    664 C       1    HEIGHT ABOVE SEA-LVL METERS              REAL
    665 C       2    VIRTUAL TEMPERATURE  KELVIN              REAL
    666 C       3    QUALITY CODE         (SEE %)             INTEGER
    667 C
    668 C  %-  0 - MEDIAN AND SHEAR CHECKS BOTH PASSED
    669 C      2 - MEDIAN AND SHEAR CHECK RESULTS INCONCLUSIVE
    670 C      4 - MEDIAN CHECK PASSED; SHEAR CHECK FAILED
    671 C      8 - MEDIAN CHECK FAILED; SHEAR CHECK PASSED
    672 C     12 - MEDIAN AND SHEAR CHECKS BOTH FAILED
    673 C     14 - THE WIND IS FLAGGED DUE TO EITHER:
    674 C               BEING ON THE REJECT LIST, OR
    675 C               BEING PURGED MANUALLY BY THE NCEP SDM
    676 C
    677 C
    678 C     DATA LEVEL CATEGORY 08 - ADDITIONAL (MISCELLANEOUS) DATA (EACH
    679 C                              "LEVEL", SEE @ BELOW)
    680 C      (Currently used only by GOES sounding/radiance reports)
    681 C
    682 C     WORD   PARAMETER            UNITS               FORMAT
    683 C     ----   ---------            -----------------   -------------
    684 C       1    VARIABLE             (SEE @)             REAL

Page 13          Source Listing                  W3UNPKB7
2017-04-18 11:09                                 w3unpkb7.f

    685 C       2    CODE FIGURE          (SEE @)             REAL
    686 C       3    Q.M. FOR THE DATUM   (SEE &)             REAL
    687 C       4    NOT USED                                 REAL
    688 C
    689 C  @-  NUMBER OF "LEVELS" FROM WORD 27.  MAXIMUM IS "ILVLMX_08"
    690 C       (CURRENTLY SET TO 13), AND ARE ORDERED AS FOLLOWS (IF A DATUM
    691 C        ARE MISSING THAT LEVEL NOT STORED)
    692 C           1 - LIFTED INDEX ---------- KELVIN ----------- C. FIG. 250.
    693 C           2 - TOTAL PRECIP. WATER  -- MILLIMETERS ------ C. FIG. 251.
    694 C           3 - 1. TO .9 SIGMA P.WATER- MILLIMETERS ------ C. FIG. 252.
    695 C           4 - .9 TO .7 SIGMA P.WATER- MILLIMETERS ------ C. FIG. 253.
    696 C           5 - .7 TO .3 SIGMA P.WATER- MILLIMETERS ------ C. FIG. 254.
    697 C           6 -  SKIN TEMPERATURE ----- KELVIN ----------- C. FIG. 255.
    698 C           7 -  CLOUD TOP TEMPERATURE- KELVIN ----------- C. FIG. 256.
    699 C           8 -  CLOUD TOP PRESSURE --- MILLIBARS -------- C. FIG. 257.
    700 C           9 -  CLOUD AMOUNT (BUFR TBL. C.T. 0-20-011) -- C. FIG. 258.
    701 C          10 -  INSTR. DATA USED IN PROC.
    702 C                             (BUFR TBL. C.T. 0-02-021) -- C. FIG. 259.
    703 C          11 -  SOLAR ZENITH ANGLE --- DEGREE ----------- C. FIG. 260.
    704 C          12 -  SAT. ZENITH ANGLE ---- DEGREE ----------- C. FIG. 261.
    705 C          13 -  SURFACE PRESSURE ----- MILLIBARS -------- C. FIG. 262.
    706 C
    707 C  &-  2.0 - INDICATES DATA NOT SUSPECT
    708 C      3.0 - INDICATES DATA ARE SUSPECT
    709 C     13.0 - INDICATES DATA ARE BAD
    710 C
    711 C
    712 C
    713 C    6) CONTENTS OF AN UNPACKED REPORT IN THE "RDATA2" ARRAY (DECODED
    714 C       DIRECTLY FROM BUFR, ALL VALUES ARE IN REAL FORMAT; MISSING DATA
    715 C       ARE SET TO "BMISS", AS IN BUFR)
    716 C
    717 C   WORD   CONTENT                                  BUFR FXY UNIT
    718 C   ----   ---------------------------------------- -------- ----------
    719 C     1    TIME SIGNIFICANCE                        0-08-021 CODE TABLE
    720 C     2    TOTAL NUMBER (WITH RESPECT TO            0-08-022 NUMERIC
    721 C          ACCUMULATION OR AVERAGE) (i.e., F-O-V
    722 C          number for GOES sounding/radiance; # of
    723 C          orig. reports used to generate superob
    724 C          for QuikSCAT, WindSAT and ASCAT - for
    725 C          non-superobs, hardwired to 1)
    726 C     3    ACROSS-SWATH CELL NUMBER                 0-06-034 NUMERIC
    727 C     4    ALONG-TRACK ROW NUMBER                   0-05-034 NUMERIC
    728 C     5    WIND PROFILER SUBMODE INFORMATION        0-25-033 CODE TABLE
    729 C            Note: Submode is missing after 5/2002
    730 C                  (no longer available)
    731 C     6    TIME PERIOD OR DISPLACEMENT              0-04-025 MINUTE
    732 C            (i.e., AVERAGING TIME)
    733 C            Note: A negative number means prior to
    734 C                  observation time
    735 C     7    QUALITY INFORMATION                      0-33-002 CODE TABLE
    736 C     8    SEAWINDS PROBABILITY OF RAIN             0-21-120 NUMERIC
    737 C
    738 C     9    SEA SURFACE TEMPERATURE                  0-22-043 KELVIN
    739 C    10    TOTAL WATER VAPOR                        0-13-096 KG/METER**2
    740 C    11    TOTAL CLOUD LIQUID WATER                 0-13-097 KG/METER**2
    741 C    12    WINDSAT SURFACE TYPE                     0-20-219 CODE TABLE

Page 14          Source Listing                  W3UNPKB7
2017-04-18 11:09                                 w3unpkb7.f

    742 C    13    MODEL WIND DIRECTION AT 10 METERS        0-11-081 DEGREES
    743 C    14    MODEL WIND SPEED AT 10 METERS            0-11-082 METERS/SEC
    744 C    15    WINDSAT EDR Q.C. FLAG # 1                0-33-200 FLAG TABLE
    745 C    16    CHI-SQUARED (OF THE WIND VECTOR          0-33-199 NUMERIC
    746 C          RETRIEVAL)
    747 C    17    ESTIMATED ERROR COVARIANCE FOR WIND      0-33-201 DEGREES
    748 C          DIRECTION RETRIEVAL
    749 C    18    ESTIMATED ERROR COVARIANCE FOR WIND      0-33-246 METERS/SEC
    750 C          SPEED RETRIEVAL
    751 C    19    ESTIMATED ERROR COVARIANCE FOR SEA       0-33-245 KELVIN
    752 C          SURFACE TEMPERATURE RETRIEVAL
    753 C    20    ESTIMATED ERROR COVARIANCE FOR TOTAL     0-33-248 KG/METER**2
    754 C          CLOUD LIQUID WATER RETRIEVAL
    755 C    21    ESTIMATED ERROR COVARIANCE FOR TOTAL     0-33-247 KG/METER**2
    756 C          WATER VAPOR RETRIEVAL
    757 C    22    WIND VECTOR CELL QUALITY                 0-21-155 FLAG TABLE
    758 C    23    BACKSCATTER DISTANCE                     0-21-156 NUMERIC
    759 C    24    LIKELIHOOD COMPUTED FOR SOLUTION         0-21-104 NUMERIC
    760 C    25    TOTAL CLOUD COVER                        0-21-010 PERCENT
    761 C
    762 C
    763 C
    764 C    7) CONTENTS OF AN UNPACKED REPORT IN THE "RDATA8_8" ARRAY
    765 C       (ALL VALUES ARE IN REAL*8`FORMAT; MISSING DATA ARE SET TO
    766 C        "BMISS")
    767 C
    768 C   WORD   CONTENT                            UNIT
    769 C   ----   --------------------------------   -------------------
    770 C     1    LATITUDE                           DEGREES (N+,S-)
    771 C     2    LONGITUDE                          DEGREES (E+,W-)
    772 C
    773 C
    774 C
    775 C ATTRIBUTES:
    776 C   LANGUAGE: FORTRAN 90
    777 C   MACHINE:  NCEP WCOSS
    778 C
    779 C$$$
    780       SUBROUTINE W3UNPKB7(IDATE,IHE,IHL,LUNIT,RDATA,STNID,DSNAME,RDATA2,
    781      $ rdata8_8,IDSDAT,IDSDMP_8,SUBSET,SUBSKP,IRET)
    782 
    783 C  Include parameters common to more than one subroutine
    784 C  -----------------------------------------------------
    785 
    786       include 'inc_w3unpkb7.inc'
    787 
    853       CHARACTER*8 STNID,SUBSET,DSNAME,CBUFR
    854 
    855       REAL        RINC_O(5),RINC_I(5),RDATA2(25),RDATA(*),RDATX(IDMAX)
    856       REAL(8)     RDATA2_8(25),rdata8_8(2)
    857       REAL(8)     BMISS,GETBMISS
    858 
    859       INTEGER     IDATE(4),LSDATE(4),IDATA(IDMAX),JDATE(8)
    860       INTEGER(8)  IDSDMP_8,IDDATE_8(5)
    861 
    862       LOGICAL     SUBSKP(0:255,0:200),SKIP_CAT12
    863 

Page 15          Source Listing                  W3UNPKB7
2017-04-18 11:09                                 w3unpkb7.f

    864       COMMON /PKB7AA/BMISS
    865       COMMON /PKB7BB/KDATE(8),LDATE(8),KTIMCH,IPRINT,SKIP_CAT12
    866       COMMON /PKB7CC/INDEX
    867       COMMON /PKB7DD/LSHE,LSHL,ICDATE(5),IDDATE(5)
    868       COMMON /PKB7FF/IFOV(4,2),KNTSAT(250:260)
    869       COMMON /PKB7HH/NPRINT(0:255,0:200)
    870 
    871       SAVE
    872  
    873       EQUIVALENCE (RDATX,IDATA)
    874 
    875       DATA ITM/0/,LUNITL/-99/
    876 
    877       IPRINT = 0
    878       IF(IRET.LT.0)  IPRINT = IABS(IRET)
    879       IRET = 0
    880       IF(ITM.EQ.0)  THEN
    881 C-----------------------------------------------------------------------
    882 
    883 C FIRST AND ONLY TIME INTO THIS SUBROUTINE DO A FEW THINGS....
    884 
    885          ITM = 1
    886          IFOV = 0
    887          KNTSAT = 0
    888 C DETERMINE MACHINE WORD LENGTH IN BYTES AND TYPE OF CHARACTER SET
    889 C  {ASCII(ICHTP=0) OR EBCDIC(ICHTP=1)}
    890          CALL W3FI04(IENDN,ICHTP,LW)
    891          PRINT 2213, LW, ICHTP, IENDN
    892  2213    FORMAT(/' ---> W3UNPKB7: CALL TO W3FI04 RETURNS: LW = ',I3,
    893      $    ', ICHTP = ',I3,', IENDN = ',I3/)
    894          IF(ICHTP.GT.1)  THEN
    895 C CHARACTERS ON THIS MACHINE ARE NEITHER ASCII OR EBCDIC!! -- STOP 22
    896             PRINT 217
    897   217       FORMAT(' *** W3UNPKB7 ERROR: CHARACTERS ON THIS MACHINE ',
    898      $       'ARE NEITHER ASCII NOR EBCDIC - STOP 22'/)
    899             CALL ERREXIT(22)
    900          END IF
    901          IDAT10 = 1000000*IDATE(1)+10000*IDATE(2)+100*IDATE(3)+IDATE(4)
    902          SKIP_CAT12 = IDAT10.GE.2013022512
    903 C-----------------------------------------------------------------------
    904       END IF
    905       IF(LUNIT.NE.LUNITL)  THEN
    906 C-----------------------------------------------------------------------
    907 
    908 C IF THE INPUT DATA UNIT NUMBER ARGUMENT IS DIFFERENT THAN THE LAST TIME
    909 C  THIS SUBR. WAS CALLED, PRINT NEW HEADER, SET JRET = 1
    910 
    911          LUNITL = LUNIT
    912          JRET = 1
    913          PRINT 101, LUNIT
    914   101    FORMAT(//' ---> W3UNPKB7: WCOSS VERSION 11/30/2016: NCEP ',
    915      $    'BUFR DATA SET READ FROM UNIT ',I4/)
    916 
    917          BMISS = GETBMISS()
    918          print'(1X)'
    919          print'(" BUFRLIB value for missing passed into W3UNPKB7 is: ",
    920      $    G0)', bmiss

Page 16          Source Listing                  W3UNPKB7
2017-04-18 11:09                                 w3unpkb7.f

    921          print'(1X)'
    922          IF(IPRINT.GE.1)  THEN
    923             print *, 'IDATS= ',IDATS
    924             print *, 'ILVLMX_04= ',ILVLMX_04
    925             print *, 'ILVLMX_08= ',ILVLMX_08
    926             print *, 'ILVL_10  = ',ILVL_10
    927             print *, 'ILVLMX_11= ',ILVLMX_11
    928             print *, 'ILVLMX_12= ',ILVLMX_12
    929             print *, 'ILVLMX_13= ',ILVLMX_13
    930             print *, 'ILVL_14  = ',ILVL_14
    931             print *, 'ILVLMX_15= ',ILVLMX_15
    932             print *, 'IDMAX_VAD= ',IDMAX_VAD
    933             print *, 'IDMAX_PROF= ',IDMAX_PROF
    934             print *, 'IDMAX_SCAT= ',IDMAX_SCAT
    935             print *, 'IDMAX_GOES= ',IDMAX_GOES
    936             print *, 'IDMAX_GPS= ',IDMAX_GPS
    937             print *, 'IDMAX_RASS= ',IDMAX_RASS
    938             print *, 'IDMAX= ',IDMAX
    939          END IF
    940 
    941 C-----------------------------------------------------------------------
    942       ELSE
    943 
    944 C FOR SUBSEQUENT TIMES INTO THIS SUBR. W/ SAME LUNIT AS LAST TIME,
    945 C  TEST INPUT DATE & HR RANGE ARGUMENTS AGAINST THEIR VALUES THE LAST
    946 C  TIME SUBR. CALLED -- IF THEY ARE DIFFERENT, SET JRET = 1 (ELSE
    947 C  JRET = 0), WILL TEST JRET SOON
    948 
    949          JRET = 1
    950          DO I = 4,1,-1
    951             IF(IDATE(I).NE.LSDATE(I))  GO TO 88
    952          ENDDO
    953          IF(IHE.NE.LSHE.OR.IHL.NE.LSHL)  GO TO 88
    954          JRET = 0
    955    88    CONTINUE
    956 C-----------------------------------------------------------------------
    957       END IF
    958       IF(JRET.EQ.1)  THEN
    959          PRINT 6680
    960  6680 FORMAT(/' JRET = 1 - REWIND DATA FILE & SET-UP TO DO DATE CHECK'/)
    961 C-----------------------------------------------------------------------
    962 
    963 C COME HERE IF FIRST CALL TO SUBROUTINE OR IF INPUT DATA UNIT NUMBER OR
    964 C  IF INPUT DATE/TIME OR RANGE IN TIME HAS BEEN CHANGED FROM LAST CALL
    965  
    966 C           CLOSE BUFR DATA SET (IN CASE OPEN FROM PREVIOUS RUN)
    967 C                     REWIND INPUT BUFR DATA SET
    968 
    969 C          TEST THAT THE DATA SET IS NOT-NULL AND THAT IT IS BUFR
    970 
    971 C         GET CENTER TIME, DUMP TIME, AND DATA SET NAME FOR RETURN
    972 
    973 C                          OPEN BUFR DATA SET
    974 
    975 C        SET INDEX=0, FORCES THE NEXT CALL TO THIS SUBROUTINE TO
    976 C         READ IN A BUFR MESSAGE BEFORE ANY REPORTS ARE DECODED)
    977 

Page 17          Source Listing                  W3UNPKB7
2017-04-18 11:09                                 w3unpkb7.f

    978 C     SET-UP TO DETERMINE IF BUFR MESSAGE IS WITHIN REQUESTED DATES
    979 
    980 C       RETURN WITH IRET = 1 (NO REPORTS RETURNED UNTIL NEXT CALL)
    981 
    982 C-----------------------------------------------------------------------
    983 
    984          CALL CLOSBF(LUNIT)
    985 
    986          REWIND LUNIT
    987 
    988          READ(LUNIT,END=9999,ERR=8888,FMT='(A8)') CBUFR
    989          IF(CBUFR(1:4).EQ.'BUFR') THEN
    990 C COME HERE IF UNBLOCKED BUFR FILE IS INPUT
    991             PRINT'(" W3UNPKB7 - INPUT FILE ON UNIT ",I0, " IS",
    992      $      " UNBLOCKED NCEP BUFR"/)', LUNIT
    993          ELSE  IF(CBUFR(5:8).EQ.'BUFR') THEN
    994 C COME HERE IF BLOCKED BUFR FILE IS INPUT
    995             PRINT'(" W3UNPKB7 - INPUT FILE ON UNIT ",I0, " IS",
    996      $      " BLOCKED NCEP BUFR"/)', LUNIT
    997          ELSE
    998 C COME HERE IF NON-BUFR FILE IS INPUT - RETURN WITH IRET = 2
    999             PRINT 8764, LUNIT
   1000  8764 FORMAT(' *** W3UNPKB7 ERROR: INPUT FILE ON UNIT  ',I2,'  IS ',
   1001      $ 'NOT BUFR -- ALL DONE WITH THIS FILE (IRET = 2)')
   1002             GO TO 9998
   1003          END IF
   1004 
   1005          CALL DATELEN(10)
   1006 
   1007          CALL DUMPBF(LUNIT,ICDATE,IDDATE)
   1008          print'(" CENTER DATE (ICDATE) = ",5(I0,1X))', icdate
   1009          print'(" DUMP DATE (IDDATE)   = ",5(I0,1X))', iddate
   1010 
   1011          IF(ICDATE(1).LE.0)  THEN
   1012 C COME HERE IF CENTER DATE COULD NOT BE READ FROM FIRST DUMMY MESSAGE
   1013 C  - RETURN WITH IRET = 2
   1014             PRINT'(" *** W3UNPKB7 ERROR: CENTER DATE COULD NOT BE ",
   1015      $       "OBTAINED FROM INPUT FILE ON UNIT ",I0)', LUNIT
   1016             GO TO 9998
   1017          END IF
   1018          IF(IDDATE(1).LE.0)  THEN
   1019 C COME HERE IF DUMP DATE COULD NOT BE READ FROM SECOND DUMMY MESSAGE
   1020 C  - RETURN WITH IRET = 2
   1021             PRINT'(" *** W3UNPKB7 ERROR: DUMP DATE COULD NOT BE ",
   1022      $       "OBTAINED FROM INPUT FILE ON UNIT ",I0)', LUNIT
   1023             GO TO 9998
   1024          END IF
   1025          IF(ICDATE(1).LT.100)  THEN
   1026 
   1027 C IF 2-DIGIT YEAR RETURNED IN ICDATE(1), MUST USE "WINDOWING" TECHNIQUE
   1028 C  TO CREATE A 4-DIGIT YEAR
   1029 
   1030 C IMPORTANT: IF DATELEN(10) IS CALLED, THE DATE HERE SHOULD ALWAYS
   1031 C            CONTAIN A 4-DIGIT YEAR, EVEN IF INPUT FILE IS NOT
   1032 C            Y2K COMPLIANT (BUFRLIB DOES THE WINDOWING HERE)
   1033 
   1034             PRINT'(" ##W3UNPKB7 - THE FOLLOWING SHOULD NEVER ",

Page 18          Source Listing                  W3UNPKB7
2017-04-18 11:09                                 w3unpkb7.f

   1035      $       "HAPPEN!!!!!")'
   1036             PRINT'(" ##W3UNPKB7 - 2-DIGIT YEAR IN ICDATE(1) RETURNED ",
   1037      $       "FROM DUMPBF (ICDATE IS: ",I5,4I3.2,") - USE WINDOWING ",
   1038      $       "TECHNIQUE TO OBTAIN 4-DIGIT YEAR")', ICDATE
   1039             IF(ICDATE(1).GT.20)  THEN
   1040                ICDATE(1) = 1900 + ICDATE(1)
   1041             ELSE
   1042                ICDATE(1) = 2000 + ICDATE(1)
   1043             ENDIF
   1044             PRINT'(" ##W3UNPKB7 - CORRECTED ICDATE(1) WITH 4-DIGIT ",
   1045      $       "YEAR, ICDATE NOW IS: ",I5,4I3.2)', ICDATE
   1046          ENDIF
   1047          IDSDAT = ICDATE(1)*1000000+ICDATE(2)*10000+ICDATE(3)*100+
   1048      $    ICDATE(4)
   1049 
   1050          IF(IDDATE(1).LT.100)  THEN
   1051 
   1052 C IF 2-DIGIT YEAR RETURNED IN IDDATE(1), MUST USE "WINDOWING" TECHNIQUE
   1053 C  TO CREATE A 4-DIGIT YEAR
   1054 
   1055 C IMPORTANT: IF DATELEN(10) IS CALLED, THE DATE HERE SHOULD ALWAYS
   1056 C            CONTAIN A 4-DIGIT YEAR, EVEN IF INPUT FILE IS NOT
   1057 C            Y2K COMPLIANT (BUFRLIB DOES THE WINDOWING HERE)
   1058 
   1059             PRINT'(" ##W3UNPKB7 - THE FOLLOWING SHOULD NEVER ",
   1060      $       "HAPPEN!!!!!")'
   1061             PRINT'(" ##W3UNPKB7 - 2-DIGIT YEAR IN IDDATE(1) RETURNED ",
   1062      $       "FROM DUMPBF (IDDATE IS: ",I5,4I3.2,") - USE WINDOWING ",
   1063      $       "TECHNIQUE TO OBTAIN 4-DIGIT YEAR")', IDDATE
   1064             IF(IDDATE(1).GT.20)  THEN
   1065                IDDATE(1) = 1900 + IDDATE(1)
   1066             ELSE
   1067                IDDATE(1) = 2000 + IDDATE(1)
   1068             ENDIF
   1069             PRINT'(" ##W3UNPKB7 - CORRECTED IDDATE(1) WITH 4-DIGIT ",
   1070      $       "YEAR, IDDATE NOW IS: ",I5,4I3.2)', IDDATE
   1071          END IF
   1072          IDDATE_8 = IDDATE
   1073          IDSDMP_8 = IDDATE_8(1)*100000000+IDDATE_8(2)*1000000+
   1074      $    IDDATE_8(3)*10000+IDDATE_8(4)*100+IDDATE_8(5)
   1075  
   1076 C  OPEN BUFR FILE - READ IN DICTIONARY MESSAGES (TABLE A, B, D ENTRIES)
   1077  
   1078          CALL OPENBF(LUNIT,'IN',LUNIT)
   1079          PRINT 100, LUNIT
   1080   100    FORMAT(/5X,'===> BUFR DATA SET IN UNIT',I3,' SUCCESSFULLY ',
   1081      $    'OPENED FOR INPUT; DCTNY MESSAGES CONTAIN BUFR TABLES A,B,D'/)
   1082  
   1083 c.......................................................................
   1084 C This next call, I believe, is needed only because SUBSET is not
   1085 C  returned in DUMPBF and we need it in order to return dsname -
   1086 C  after dsname is retrieved then close and reopen data set ..
   1087  
   1088          call readmg(lunit,subset,ibdate,kret)
   1089          if(subset.eq.'NC002007' .or. subset.eq.'NC002009' .or. 
   1090      $      subset.eq.'NC002011' .or. subset.eq.'NC002013')  then
   1091             dsname = 'PROFLR  '

Page 19          Source Listing                  W3UNPKB7
2017-04-18 11:09                                 w3unpkb7.f

   1092          else  if(subset.eq.'NC002008' .or. subset.EQ.'NC002017')  then
   1093             dsname = 'VADWND  '
   1094          else  if(subset.EQ.'NC003001' .or. subset.EQ.'NC003002')  then
   1095             dsname = 'GOESND  '
   1096          else  if(subset.EQ.'NC003003')  then
   1097             dsname = 'GOESFV  '
   1098          else  if(subset.EQ.'NC012008')  then
   1099             dsname = 'ERS1DA  '
   1100          else  if(subset.EQ.'NC012137')  then
   1101             dsname = 'QKSWND  '
   1102          else  if(subset.EQ.'NC012003' .or. subset.EQ.'NC012004')  then
   1103             dsname = 'GPSIPW  '
   1104          else  if(subset.EQ.'NC002012')  then
   1105             dsname = 'RASSDA  '
   1106          else  if(subset.EQ.'NC012138' .or. subset.EQ.'NC012139')  then
   1107             dsname = 'WDSATR  '
   1108          else  if(subset.EQ.'NC012122')  then
   1109             dsname = 'ASCATW  '
   1110          else
   1111             dsname = '????????'
   1112          end if
   1113          call closbf(lunit)
   1114          call openbf(lunit,'IN',lunit)
   1115 ccccc    CALL OPENBF(0,'QUIET',1) ! will generate diagnostic print if
   1116 ccccc                             ! an embedded BUFR table is read
   1117 c.......................................................................
   1118 
   1119          INDEX = 0
   1120          JDATE(1:3) = IDATE(1:3)
   1121          JDATE(4) = 0
   1122          JDATE(5) = IDATE(4)
   1123          JDATE(6:8) = 0
   1124          PRINT 6681, IDATE
   1125  6681 FORMAT(/' %%% REQUESTED "CENTRAL" DATE IS :',I5,3I3,'  0'/)
   1126 
   1127          IF(IHE.LE.-3.AND.IHL.GE.2)  THEN
   1128             KTIMCH = 0
   1129             PRINT 6998
   1130  6998 FORMAT(/' --> W3UNPKB7: THERE IS NO TIME WINDOW CONSTRAINT FOR ',
   1131      $ 'ACCEPTING BUFR MESSAGES'/)
   1132             KDATE = 0
   1133             LDATE = 0
   1134          ELSE
   1135             KTIMCH    = 1
   1136             RINC_I    = 0.
   1137             RINC_I(2) = REAL(IHE)
   1138 C DETERMINE EARLIEST DATE FOR ACCEPTING BUFR MESSAGES FOR DECODING
   1139             CALL W3MOVDAT(RINC_I,JDATE,KDATE)
   1140             PRINT 6682, (KDATE(I),I=1,3),KDATE(5),KDATE(6)
   1141  6682 FORMAT(/' --> EARLIEST DATE FOR ACCEPTING BUFR MSGS IS:',I5,4I3/)
   1142 C DETERMINE LATEST   DATE FOR ACCEPTING BUFR MESSAGES FOR DECODING
   1143             IF(IHL.GE.0)  THEN
   1144               XMINL = (IHL * 60) + 59
   1145             ELSE
   1146               XMINL = ((IHL + 1) * 60) - 1
   1147             END IF
   1148             RINC_I    = 0.

Page 20          Source Listing                  W3UNPKB7
2017-04-18 11:09                                 w3unpkb7.f

   1149             RINC_I(3) = XMINL
   1150             CALL W3MOVDAT(RINC_I,jdate,ldate)
   1151             PRINT 6683, (LDATE(I),I=1,3),LDATE(5),LDATE(6)
   1152  6683 FORMAT(/' -->  LATEST  DATE FOR ACCEPTING BUFR MSGS IS:',I5,4I3/)
   1153             CALL W3DIFDAT(LDATE,KDATE,3,RINC_O)
   1154             IF(RINC_O(3).LT.0)  THEN
   1155                PRINT 104
   1156   104 FORMAT(' *** W3UNPKB7 ERROR: DATES SPECIFIED INCORRECTLY - STOP ',
   1157      $ '15'/)
   1158                CALL ERREXIT(15)
   1159             END IF
   1160             NPRINT = 0
   1161          END IF
   1162          IRET = 1
   1163          GO TO 99
   1164 
   1165 C-----------------------------------------------------------------------
   1166       END IF
   1167 C SUBR. UNPKB701 RETURNS A SINGLE DECODED REPORT FROM BUFR MESSAGE
   1168       CALL UNPKB701(LUNIT,ITP,SUBSET,SUBSKP,IRET)
   1169       IF(IRET.EQ.2)  THEN
   1170 C IRET=2 MEANS ALL DATA HAVE BEEN DECODED FOR SPECIFIED TIME PERIOD
   1171 C  (REWIND DATA FILE AND RETURN W/ IRET=2)
   1172          REWIND LUNIT
   1173          IF(ITP.EQ.4)  THEN
   1174             IF(MAX(IFOV(1,1),IFOV(2,1),IFOV(3,1),IFOV(4,1)).GT.0)  THEN
   1175                PRINT 8101, (IFOV(III,1),III=1,4)
   1176  8101 FORMAT(/' ---> W3UNPKB7: SUMMARY OF GOES 5X5 REPORT COUNTS ',
   1177      $ 'GROUPED BY F-O-V NO. (PRIOR TO ANY FILTERING BY CALLING ',
   1178      $ 'PROGRAM)'/15X,
   1179      $ '# WITH F-O-V NO. 00 TO 02:',I8,' - GET "BAD" Q.MARK'/15X,
   1180      $ '# WITH F-O-V NO. 03 TO 09:',I8,' - GET "SUSPECT" Q.MARK'/15X,
   1181      $ '# WITH F-O-V NO. 10 TO 25:',I8,' - GET "NEUTRAL" Q.MARK'/15X,
   1182      $ '# WITH MISSING F-O-V:     ',I8,' - GET "NEUTRAL" Q.MARK'/20X,
   1183      $ '(NOTE: RADIANCES ALWAYS HAVE NEUTRAL Q.MARK REGARDLESS OF FOV ',
   1184      $ 'NUMBER)'/)
   1185             END IF
   1186             IF(MAX(IFOV(1,2),IFOV(2,2),IFOV(3,2),IFOV(4,2)).GT.0)  THEN
   1187                PRINT 8201, (IFOV(III,2),III=1,4)
   1188  8201 FORMAT(/' ---> W3UNPKB7: SUMMARY OF GOES 1X1 REPORT COUNTS ',
   1189      $ 'GROUPED BY F-O-V NO. (PRIOR TO ANY FILTERING BY CALLING ',
   1190      $ 'PROGRAM)'/15X,'(ALL GET "NEUTRAL" Q. MARK)'/15X,
   1191      $ '# WITH F-O-V NO. 01:             ',I8/15X,
   1192      $ '# WITH F-O-V NO. 02:             ',I8/15X,
   1193      $ '# WITH F-O-V NO. 03:             ',I8/15X,
   1194      $ '# WITH F-O-V > 3 (INCL. MISSING):',I8,/20X,
   1195      $ '(NOTE: RADIANCES ALWAYS HAVE NEUTRAL Q.MARK REGARDLESS OF FOV ',
   1196      $ 'NUMBER)'/)
   1197             END IF
   1198             PRINT 8102
   1199  8102 FORMAT(/' ---> W3UNPKB7: SUMMARY OF GOES REPORT COUNTS GROUPED',
   1200      $ ' BY SATELLITE ID (PRIOR TO ANY FILTERING BY CALLING PROGRAM)'/)
   1201             DO  IDSAT = 250,259
   1202                IF(KNTSAT(IDSAT).GT.0) PRINT 8103, IDSAT,KNTSAT(IDSAT)
   1203             ENDDO
   1204  8103 FORMAT(15X,'NUMBER FROM SAT. ID ',I4,' :  ',I8)
   1205             IF(KNTSAT(260).GT.0)  PRINT 8104, KNTSAT(260)

Page 21          Source Listing                  W3UNPKB7
2017-04-18 11:09                                 w3unpkb7.f

   1206  8104 FORMAT(15X,'NUMBER FROM UNKNOWN SAT. ID:',I8)
   1207             PRINT 8105
   1208  8105       FORMAT(/)
   1209          END IF
   1210          GO TO 99
   1211       ELSE  IF(IRET.EQ.8)  THEN
   1212          GO TO 99
   1213       END IF
   1214 C INITIALIZE THE OUTPUT ARRAY
   1215       CALL UNPKB702(RDATA,STNID,ITP)
   1216 C STORE THE HEADER INFORMATION INTO UNPACKED QUASI-IW3UNPBF FORMAT
   1217       rdata8_8 = bmiss
   1218       CALL UNPKB703(LUNIT,RDATA,rdata8_8,STNID,SUBSET,ITP,IRET)
   1219 C IRET.GE.3 MEANS RPT NOT RETURNED DUE TO MISSING DATA IN HEADR (RETURN)
   1220       IF(IRET.GE.3)  GO TO 99
   1221       IF(ITP.EQ.1.OR.ITP.EQ.2.OR.ITP.EQ.3)  THEN
   1222 C-----------------------------------------------------------------------
   1223 C   THE FOLLOWING PERTAINS TO WIND PROFILER REPORTS NOT ORIGINATING
   1224 C                 FROM PILOT (PIBAL) FORMAT BULLETINS)
   1225 C-----------------------------------------------------------------------
   1226 C STORE THE SURFACE DATA INTO UNPACKED QUASI-IW3UNPBF FORMAT (CAT. 10)
   1227          CALL UNPKB704(LUNIT,RDATA,ITP,IRET)
   1228 C STORE THE UPPER-AIR DATA INTO UNPACKED QUASI-IW3UNPBF FORMAT (CAT. 11)
   1229          CALL UNPKB705(LUNIT,RDATA,ITP)
   1230          RDATX(1:IDMAX) = RDATA(1:IDMAX)
   1231          IF(IDATA(35)+IDATA(37).EQ.0)  THEN
   1232             IRET = 5
   1233             GO TO 99
   1234          END IF
   1235 C STORE BUFR DATA DIRECTLY INTO RDATA2 ARRAY
   1236          RDATA2_8 = BMISS
   1237          CALL UFBINT(LUNIT,RDATA2_8(1),1,1,NLEV,'TSIG')
   1238          IF(NLEV.GT.1)  THEN
   1239             IRET = 7
   1240             GO TO 99
   1241          END IF
   1242          CALL UFBINT(LUNIT,RDATA2_8(5),2,1,NLEV,'NPSM TPSE')
   1243          IF(NLEV.GT.1)  THEN
   1244             IRET = 7
   1245             GO TO 99
   1246          END IF
   1247 C For NPN and CAP wind profilers prior to 5/2002, AVERAGING TIME is
   1248 C  decoded in minutes, after 5/2002 it is decoded in seconds (in either
   1249 C  case it is stored in minutes)
   1250          IF(IBFMS(RDATA2_8(6)).EQ.0)  THEN
   1251             RDATA2_8(6) = NINT(RDATA2_8(6)/60.)
   1252          ELSE
   1253             CALL UFBINT(LUNIT,RDATA2_8(6),1,1,NLEV,'TPMI')
   1254             IF(NLEV.GT.1)  THEN
   1255                IRET = 7
   1256                GO TO 99
   1257             END IF
   1258          END IF
   1259          RDATA2 = RDATA2_8
   1260       ELSE  IF(ITP.EQ.4)  THEN
   1261 C-----------------------------------------------------------------------
   1262 C        THE FOLLOWING PERTAINS TO GOES SOUNDING/RADIANCE REPORTS

Page 22          Source Listing                  W3UNPKB7
2017-04-18 11:09                                 w3unpkb7.f

   1263 C-----------------------------------------------------------------------
   1264 C STORE BUFR DATA DIRECTLY INTO RDATA2 ARRAY
   1265          RDATA2_8 = BMISS
   1266          CALL UFBINT(LUNIT,RDATA2_8(2),1,1,NLEV,'ACAV')
   1267          IF(NLEV.GT.1)  THEN
   1268             IRET = 7
   1269             GO TO 99
   1270          END IF
   1271          CALL UFBINT(LUNIT,RDATA2_8(7),1,1,NLEV,'QMRK')
   1272          IF(NLEV.GT.1)  THEN
   1273             IRET = 7
   1274             GO TO 99
   1275          END IF
   1276          RDATA2 = RDATA2_8
   1277 C STORE THE UPPER-AIR DATA/RADIANCES/RETRIEVALS INTO UNPACKED QUASI-
   1278 C  IW3UNPBF FORMAT (CATEGORY 12, 13, 08)
   1279          CALL UNPKB707(LUNIT,RDATA,RDATA2,subset,IRET)
   1280          IF(IRET.GE.5) THEN
   1281             RDATA2 = BMISS
   1282             GO TO 99
   1283          END IF
   1284       ELSE  IF(ITP.EQ.5 .OR. ITP.EQ.12)  THEN
   1285 C-----------------------------------------------------------------------
   1286 C       THE FOLLOWING PERTAINS TO NEXRAD (VAD) WIND REPORTS
   1287 C           ITP =  5 - VAD WINDS FROM RADAR CODED MESSAGE
   1288 C             ITP = 12 - VAD WINDS FROM LEVEL 2 DECODER
   1289 C-----------------------------------------------------------------------
   1290 C STORE THE UPPER-AIR DATA INTO UNPACKED QUASI-IW3UNPBF FORMAT (CAT. 4)
   1291          CALL UNPKB706(LUNIT,RDATA,ITP,IRET)
   1292       ELSE  IF(ITP.EQ.6)  THEN
   1293 C-----------------------------------------------------------------------
   1294 C     THE FOLLOWING PERTAINS TO ERS SCATTEROMETER WIND REPORTS
   1295 C-----------------------------------------------------------------------
   1296 C STORE THE SURFACE DATA INTO UNPACKED QUASI-IW3UNPBF FORMAT (CAT. 10)
   1297          CALL UNPKB704(LUNIT,RDATA,ITP,IRET)
   1298       ELSE  IF(ITP.EQ.7)  THEN
   1299 C-----------------------------------------------------------------------
   1300 C   THE FOLLOWING PERTAINS TO QUIKSCAT SCATTEROMETER WIND REPORTS
   1301 C-----------------------------------------------------------------------
   1302 C STORE THE SURFACE DATA INTO UNPACKED QUASI-IW3UNPBF FORMAT (CAT. 10)
   1303          CALL UNPKB704(LUNIT,RDATA,ITP,IRET)
   1304          IF(IRET.GE.5) GO TO 99
   1305 C STORE BUFR DATA DIRECTLY INTO RDATA2 ARRAY
   1306          RDATA2_8 = BMISS
   1307          CALL UFBINT(LUNIT,RDATA2_8(2),1,1,NLEV,'ACAV')
   1308          IF(NLEV.GT.1)  THEN
   1309             IRET = 7
   1310             GO TO 99
   1311          END IF
   1312          CALL UFBINT(LUNIT,RDATA2_8(3),2,1,NLEV,'CTCN ATRN')
   1313          IF(NLEV.GT.1)  THEN
   1314             IRET = 7
   1315             GO TO 99
   1316          END IF
   1317          CALL UFBINT(LUNIT,RDATA2_8(8),1,1,NLEV,'SPRR')
   1318          IF(NLEV.GT.1)  THEN
   1319             IRET = 7

Page 23          Source Listing                  W3UNPKB7
2017-04-18 11:09                                 w3unpkb7.f

   1320             GO TO 99
   1321          END IF
   1322          RDATA2 = RDATA2_8
   1323       ELSE  IF(ITP.EQ.8)  THEN
   1324 C-----------------------------------------------------------------------
   1325 C   THE FOLLOWING PERTAINS TO GPS INTEGRATED PRECIPITABLE WATER REPORTS
   1326 C-----------------------------------------------------------------------
   1327 C STORE THE GPS-IPW DATA INTO UNPACKED QUASI-IW3UNPBF FORMAT (CAT. 14)
   1328          CALL UNPKB709(LUNIT,RDATA,subset)
   1329          RDATX(1:IDMAX) = RDATA(1:IDMAX)
   1330          IF(IDATA(43).EQ.0)  THEN
   1331             IRET = 5
   1332             GO TO 99
   1333          END IF
   1334       ELSE  IF(ITP.EQ.9)  THEN
   1335 C-----------------------------------------------------------------------
   1336 C        THE FOLLOWING PERTAINS TO NPN AND CAP RASS REPORTS
   1337 C-----------------------------------------------------------------------
   1338 C STORE THE RASS DATA INTO UNPACKED QUASI-IW3UNPBF FORMAT (CAT. 15)
   1339          CALL UNPKB710(LUNIT,RDATA)
   1340          RDATX(1:IDMAX) = RDATA(1:IDMAX)
   1341          IF(IDATA(45).EQ.0)  THEN
   1342             IRET = 5
   1343             GO TO 99
   1344          END IF
   1345 C STORE BUFR DATA DIRECTLY INTO RDATA2 ARRAY
   1346          RDATA2_8 = BMISS
   1347          CALL UFBINT(LUNIT,RDATA2_8(1),1,1,NLEV,'TSIG')
   1348          IF(NLEV.GT.1)  THEN
   1349             IRET = 7
   1350             GO TO 99
   1351          END IF
   1352          CALL UFBINT(LUNIT,RDATA2_8(6),1,1,NLEV,'TPSE')
   1353          IF(NLEV.GT.1)  THEN
   1354             IRET = 7
   1355             GO TO 99
   1356          END IF
   1357 C For NPN and CAP RASS prior to 5/2002, AVERAGING TIME is decoded in
   1358 C  minutes, after 5/2002 it is decoded in seconds (in either case it is
   1359 C  stored in minutes)
   1360          IF(IBFMS(RDATA2_8(6)).EQ.0)  THEN
   1361             RDATA2_8(6) = NINT(RDATA2_8(6)/60.)
   1362          ELSE
   1363             CALL UFBINT(LUNIT,RDATA2_8(6),1,1,NLEV,'TPMI')
   1364             IF(NLEV.GT.1)  THEN
   1365                IRET = 7
   1366                GO TO 99
   1367             END IF
   1368          END IF
   1369          RDATA2 = RDATA2_8
   1370       ELSE  IF(ITP.EQ.10)  THEN
   1371 C-----------------------------------------------------------------------
   1372 C   THE FOLLOWING PERTAINS TO WINDSAT SCATTEROMETER WIND REPORTS
   1373 C                         (NAVY OR NESDIS)
   1374 C-----------------------------------------------------------------------
   1375 C STORE THE SURFACE DATA INTO UNPACKED QUASI-IW3UNPBF FORMAT (CAT. 10)
   1376          CALL UNPKB704(LUNIT,RDATA,ITP,IRET)

Page 24          Source Listing                  W3UNPKB7
2017-04-18 11:09                                 w3unpkb7.f

   1377          IF(IRET.GE.5) GO TO 99
   1378 C STORE BUFR DATA DIRECTLY INTO RDATA2 ARRAY
   1379          RDATA2_8 = BMISS
   1380          CALL UFBINT(LUNIT,RDATA2_8(2), 1,1,NLEV,'ACAV')
   1381          IF(NLEV.GT.1)  THEN
   1382             IRET = 7
   1383             GO TO 99
   1384          END IF
   1385          CALL UFBINT(LUNIT,RDATA2_8(9), 6,1,NLEV,
   1386      $    'SST1 MRWVC MRLWC WSST MWD10 MWS10')
   1387          IF(NLEV.GT.1)  THEN
   1388             IRET = 7
   1389             GO TO 99
   1390          END IF
   1391          CALL UFBINT(LUNIT,RDATA2_8(15),7,1,NLEV,
   1392      $    'WSEQC1 CHSQ PHER SPDE SSTE CLDE VPRE')
   1393          IF(NLEV.GT.1)  THEN
   1394             IRET = 7
   1395             GO TO 99
   1396          END IF
   1397          RDATA2 = RDATA2_8
   1398       ELSE  IF(ITP.EQ.11)  THEN
   1399 C-----------------------------------------------------------------------
   1400 C     THE FOLLOWING PERTAINS TO ASCAT SCATTEROMETER WIND REPORTS
   1401 C-----------------------------------------------------------------------
   1402 C STORE THE SURFACE DATA INTO UNPACKED QUASI-IW3UNPBF FORMAT (CAT. 10)
   1403          CALL UNPKB704(LUNIT,RDATA,ITP,IRET)
   1404          IF(IRET.GE.5) GO TO 99
   1405 C STORE BUFR DATA DIRECTLY INTO RDATA2 ARRAY
   1406          RDATA2_8 = BMISS
   1407          CALL UFBINT(LUNIT,RDATA2_8(2),1,1,NLEV,'ACAV')
   1408          IF(NLEV.GT.1)  THEN
   1409             IRET = 7
   1410             GO TO 99
   1411          END IF
   1412          CALL UFBINT(LUNIT,RDATA2_8(3),1,1,NLEV,'CTCN')
   1413          IF(NLEV.GT.1)  THEN
   1414             IRET = 7
   1415             GO TO 99
   1416          END IF
   1417          CALL UFBINT(LUNIT,RDATA2_8(22),3,1,NLEV,'WVCQ BSCD LKCS')
   1418          IF(NLEV.GT.1)  THEN
   1419             IRET = 7
   1420             GO TO 99
   1421          END IF
   1422          RDATA2 = RDATA2_8
   1423 C-----------------------------------------------------------------------
   1424       END IF
   1425    99 CONTINUE
   1426 C PRIOR TO RETURNING SAVE INPUT DATE & HR RANGE ARGUMENTS FROM THIS CALL
   1427       LSDATE = IDATE
   1428       LSHE = IHE
   1429       LSHL = IHL
   1430       RETURN
   1431 C-----------------------------------------------------------------------
   1432  8888 CONTINUE
   1433 C COME HERE IF ERROR READING 1ST RECORD OF INPUT FILE- RETURN W/ IRET= 2

Page 25          Source Listing                  W3UNPKB7
2017-04-18 11:09                                 w3unpkb7.f

   1434       PRINT 7765, LUNIT
   1435  7765 FORMAT(' *** W3UNPKB7 ERROR: ERROR READING FIRST RECORD OF INPUT',
   1436      $ ' FILE ON UNIT  ',I2,' -- ALL DONE WITH THIS FILE (IRET = 2)')
   1437       GO TO 9998
   1438 C-----------------------------------------------------------------------
   1439  9999 CONTINUE
   1440 C COME HERE IF NULL FILE IS INPUT - RETURN WITH IRET = 2
   1441       PRINT 8765, LUNIT
   1442  8765 FORMAT(' *** W3UNPKB7 ERROR: INPUT FILE ON UNIT  ',I2,'  IS ',
   1443      $ 'EMPTY (NULL) -- ALL DONE WITH THIS FILE (IRET = 2)')
   1444 C-----------------------------------------------------------------------
   1445  9998 CONTINUE
   1446       REWIND LUNIT
   1447       IRET = 2
   1448       LSDATE = IDATE
   1449       LSHE = IHE
   1450       LSHL = IHL
   1451       RETURN
   1452       END


ENTRY POINTS

  Name                 
                       
 w3unpkb7_             


SYMBOL CROSS REFERENCE

 Name                       Object Declared Type            Bytes Dimen Elements Attributes       References                        
                                                                                                                                    
 100                        Label  1015                                                           1014                              
 101                        Label  849                                                            848                               
 104                        Label  1091                                                           1090                              
 217                        Label  832                                                            831                               
 2213                       Label  827                                                            826                               
 6680                       Label  895                                                            894                               
 6681                       Label  1060                                                           1059                              
 6682                       Label  1076                                                           1075                              
 6683                       Label  1087                                                           1086                              
 6998                       Label  1065                                                           1064                              
 7765                       Label  1370                                                           1369                              
 8101                       Label  1111                                                           1110                              
 8102                       Label  1134                                                           1133                              
 8103                       Label  1139                                                           1137                              
 8104                       Label  1141                                                           1140                              
 8105                       Label  1143                                                           1142                              
 8201                       Label  1123                                                           1122                              
 8764                       Label  935                                                            934                               
 8765                       Label  1377                                                           1376                              
 88                         Label  890                                                            886,888                           
 8888                       Label  1367                                                           923                               
 99                         Label  1360                                                           1098,1145,1147,1155,1168,1175,1180
                                                                                                  ,1191,1204,1209,1217,1239,1245,125
                                                                                                  0,1255,1267,1278,1285,1290,1301,13
                                                                                                  12,1318,1324,1330,1339,1345,1350,1

Page 26          Source Listing                  W3UNPKB7
2017-04-18 11:09 Symbol Table                    w3unpkb7.f

 Name                       Object Declared Type            Bytes Dimen Elements Attributes       References                        
                                                                                                                                    
                                                                                                  355                               
 9998                       Label  1380                                                           937,951,958,1372                  
 9999                       Label  1374                                                           923                               
 BMISS                      Scalar 792      R(8)            8           scalar   COM              852,855,1152,1171,1200,1216,1241,1
                                                                                                  281,1314,1341                     
 CBUFR                      Local  788      CHAR            8           scalar   SAVE             923,924,928                       
 CLOSBF                     Subr   919                                                            919,1048                          
 DATELEN                    Subr   940                                                            940                               
 DSNAME                     Dummy  780      CHAR            8           scalar   ARG,INOUT        1026,1028,1030,1032,1034,1036,1038
                                                                                                  ,1040,1042,1044,1046              
 DUMPBF                     Subr   942                                                            942                               
 ERREXIT                    Subr   834                                                            834,1093                          
 GETBMISS                   Func   792      R(8)            8           scalar                    852                               
 I                          Local  885      I(4)            4           scalar   SAVE             885,886,1075,1086                 
 IABS                       Func   813                                  scalar                    813                               
 IBDATE                     Local  1023     I(4)            4           scalar   SAVE             1023                              
 IBFMS                      Func   1185     I(4)            4           scalar                    1185,1295                         
 ICDATE                     Scalar 802      I(4)            4     1     5        COM              942,943,946,960,973,974,975,977,98
                                                                                                  0,982,983                         
 ICHTP                      Local  825      I(4)            4           scalar   SAVE             825,826,829                       
 IDAT10                     Local  836      I(4)            4           scalar   SAVE             836,837                           
 IDATA                      Local  794      I(4)            4     1     2270     SAVE             1166,1265,1276                    
 IDATE                      Dummy  780      I(4)            4     1     4        ARG,INOUT        836,886,1055,1057,1059,1362,1383  
 IDATS                      Param  40       I(4)            4           scalar                    43,46,49,52,56,59,858             
 IDDATE                     Scalar 802      I(4)            4     1     5        COM              942,944,953,985,998,999,1000,1002,
                                                                                                  1005,1007                         
 IDDATE_8                   Local  795      I(8)            8     1     5        SAVE             1007,1008,1009                    
 IDMAX                      Param  63       I(4)            4           scalar                    790,794,873,1165,1264,1275        
 IDMAX_GOES                 Param  52       I(4)            4           scalar                    63,870                            
 IDMAX_GPS                  Param  56       I(4)            4           scalar                    64,871                            
 IDMAX_PROF                 Param  46       I(4)            4           scalar                    63,868                            
 IDMAX_RASS                 Param  59       I(4)            4           scalar                    64,872                            
 IDMAX_SCAT                 Param  49       I(4)            4           scalar                    63,869                            
 IDMAX_VAD                  Param  43       I(4)            4           scalar                    63,867                            
 IDSAT                      Local  1136     I(4)            4           scalar   SAVE             1136,1137                         
 IDSDAT                     Dummy  781      I(4)            4           scalar   ARG,INOUT        982                               
 IDSDMP_8                   Dummy  781      I(8)            8           scalar   ARG,INOUT        1008                              
 IENDN                      Local  825      I(4)            4           scalar   SAVE             825,826                           
 IFOV                       Scalar 803      I(4)            4     2     8        COM              821,1109,1110,1121,1122           
 IHE                        Dummy  780      I(4)            4           scalar   ARG,INOUT        888,1062,1072,1363,1384           
 IHL                        Dummy  780      I(4)            4           scalar   ARG,INOUT        888,1062,1078,1079,1081,1364,1385 
 III                        Local  1110     I(4)            4           scalar   SAVE             1110,1122                         
 ILVLMX_04                  Param  15       I(4)            4           scalar                    43,859                            
 ILVLMX_08                  Param  8        I(4)            4           scalar                    52,860                            
 ILVLMX_11                  Param  19       I(4)            4           scalar                    46,862                            
 ILVLMX_12                  Param  22       I(4)            4           scalar                    52,863                            
 ILVLMX_13                  Param  25       I(4)            4           scalar                    53,864                            
 ILVLMX_15                  Param  29       I(4)            4           scalar                    59,866                            
 ILVL_10                    Param  34       I(4)            4           scalar                    46,49,861                         
 ILVL_14                    Param  37       I(4)            4           scalar                    56,865                            
 INDEX                      Scalar 801      I(4)            4           scalar   COM              1054                              
 IPRINT                     Scalar 800      I(4)            4           scalar   COM              812,813,857                       
 IRET                       Dummy  781      I(4)            4           scalar   ARG,INOUT        813,814,1097,1103,1104,1146,1153,1
                                                                                                  155,1162,1167,1174,1179,1190,1203,
                                                                                                  1208,1214,1215,1226,1232,1238,1239

Page 27          Source Listing                  W3UNPKB7
2017-04-18 11:09 Symbol Table                    w3unpkb7.f

 Name                       Object Declared Type            Bytes Dimen Elements Attributes       References                        
                                                                                                                                    
                                                                                                  ,1244,1249,1254,1266,1277,1284,128
                                                                                                  9,1300,1311,1312,1317,1323,1329,13
                                                                                                  38,1339,1344,1349,1354,1382       
 ITM                        Local  810      I(4)            4           scalar   SAVE             810,815,820                       
 ITP                        Local  1103     I(4)            4           scalar   SAVE             1103,1108,1150,1153,1156,1162,1164
                                                                                                  ,1195,1219,1226,1227,1232,1233,123
                                                                                                  8,1258,1269,1305,1311,1333,1338   
 JDATE                      Local  794      I(4)            4     1     8        SAVE             1055,1056,1057,1058,1074,1085     
 JRET                       Local  847      I(4)            4           scalar   SAVE             847,884,889,893                   
 KDATE                      Scalar 800      I(4)            4     1     8        COM              1067,1074,1075,1088               
 KNTSAT                     Scalar 803      I(4)            4     1     11       COM              822,1137,1140                     
 KRET                       Local  1023     I(4)            4           scalar   SAVE             1023                              
 KTIMCH                     Scalar 800      I(4)            4           scalar   COM              1063,1070                         
 LDATE                      Scalar 800      I(4)            4     1     8        COM              1068,1085,1086,1088               
 LSDATE                     Local  794      I(4)            4     1     4        SAVE             886,1362,1383                     
 LSHE                       Scalar 802      I(4)            4           scalar   COM              888,1363,1384                     
 LSHL                       Scalar 802      I(4)            4           scalar   COM              888,1364,1385                     
 LUNIT                      Dummy  780      I(4)            4           scalar   ARG,INOUT        840,846,848,919,921,923,927,931,93
                                                                                                  4,942,950,957,1013,1014,1023,1048,
                                                                                                  1049,1103,1107,1153,1162,1164,1172
                                                                                                  ,1177,1188,1201,1206,1214,1226,123
                                                                                                  2,1238,1242,1247,1252,1263,1274,12
                                                                                                  82,1287,1298,1311,1315,1320,1326,1
                                                                                                  338,1342,1347,1352,1369,1376,1381 
 LUNITL                     Local  810      I(4)            4           scalar   SAVE             810,840,846                       
 LW                         Local  825      I(4)            4           scalar   SAVE             825,826                           
 MAX                        Func   63                                   scalar                    63,1109,1121                      
 NINT                       Func   1186                                 scalar                    1186,1296                         
 NLEV                       Local  1172     I(4)            4           scalar   SAVE             1172,1173,1177,1178,1188,1189,1201
                                                                                                  ,1202,1206,1207,1242,1243,1247,124
                                                                                                  8,1252,1253,1282,1283,1287,1288,12
                                                                                                  98,1299,1315,1316,1320,1322,1326,1
                                                                                                  328,1342,1343,1347,1348,1352,1353 
 NPRINT                     Scalar 804      I(4)            4     2     51456    COM              1095                              
 OPENBF                     Subr   1013                                                           1013,1049                         
 PKB7AA                     Common 799                                  8        SAVE                                               
 PKB7BB                     Common 800                                  76       SAVE                                               
 PKB7CC                     Common 801                                  4        SAVE                                               
 PKB7DD                     Common 802                                  48       SAVE                                               
 PKB7FF                     Common 803                                  76       SAVE                                               
 PKB7HH                     Common 804                                  205824   SAVE                                               
 RDATA                      Dummy  780      R(4)            4     1     0        ARG,INOUT        1150,1153,1162,1164,1165,1214,1226
                                                                                                  ,1232,1238,1263,1264,1274,1275,131
                                                                                                  1,1338                            
 RDATA2                     Dummy  780      R(4)            4     1     25       ARG,INOUT        1194,1211,1214,1216,1257,1304,1332
                                                                                                  ,1357                             
 RDATA2_8                   Local  791      R(8)            8     1     25       SAVE             1171,1172,1177,1185,1186,1188,1194
                                                                                                  ,1200,1201,1206,1211,1241,1242,124
                                                                                                  7,1252,1257,1281,1282,1287,1295,12
                                                                                                  96,1298,1304,1314,1315,1320,1326,1
                                                                                                  332,1341,1342,1347,1352,1357      
 RDATA8_8                   Dummy  781      R(8)            8     1     2        ARG,INOUT        1152,1153                         
 RDATX                      Local  790      R(4)            4     1     2270     SAVE             1165,1264,1275                    
 READMG                     Subr   1023                                                           1023                              
 REAL                       Func   1072                                 scalar                    1072                              

Page 28          Source Listing                  W3UNPKB7
2017-04-18 11:09 Symbol Table                    w3unpkb7.f

 Name                       Object Declared Type            Bytes Dimen Elements Attributes       References                        
                                                                                                                                    
 RINC_I                     Local  790      R(4)            4     1     5        SAVE             1071,1072,1074,1083,1084,1085     
 RINC_O                     Local  790      R(4)            4     1     5        SAVE             1088,1089                         
 SKIP_CAT12                 Scalar 797      L(4)            4           scalar   COM              837                               
 STNID                      Dummy  780      CHAR            8           scalar   ARG,INOUT        1150,1153                         
 SUBSET                     Dummy  781      CHAR            8           scalar   ARG,INOUT        1023,1024,1025,1027,1029,1031,1033
                                                                                                  ,1035,1037,1039,1041,1043,1103,115
                                                                                                  3,1214,1263                       
 SUBSKP                     Dummy  781      L(4)            4     2     51456    ARG,INOUT        1103                              
 UFBINT                     Subr   1172                                                           1172,1177,1188,1201,1206,1242,1247
                                                                                                  ,1252,1282,1287,1298,1315,1320,132
                                                                                                  6,1342,1347,1352                  
 UNPKB701                   Subr   1103                                                           1103                              
 UNPKB702                   Subr   1150                                                           1150                              
 UNPKB703                   Subr   1153                                                           1153                              
 UNPKB704                   Subr   1162                                                           1162,1232,1238,1311,1338          
 UNPKB705                   Subr   1164                                                           1164                              
 UNPKB706                   Subr   1226                                                           1226                              
 UNPKB707                   Subr   1214                                                           1214                              
 UNPKB709                   Subr   1263                                                           1263                              
 UNPKB710                   Subr   1274                                                           1274                              
 W3DIFDAT                   Subr   1088                                                           1088                              
 W3FI04                     Subr   825                                                            825                               
 W3MOVDAT                   Subr   1074                                                           1074,1085                         
 W3UNPKB7                   Subr   780                                                                                              
 XMINL                      Local  1079     R(4)            4           scalar   SAVE             1079,1081,1084                    

Page 29          Source Listing                  W3UNPKB7
2017-04-18 11:09                                 w3unpkb7.f

   1453 C$$$  SUBPROGRAM DOCUMENTATION BLOCK
   1454 C
   1455 C SUBPROGRAM:    UNPKB701
   1456 C   PRGMMR: D. A. KEYSER     ORG: NP22       DATE: 2014-03-13
   1457 C
   1458 C ABSTRACT: CALLS BUFRLIB ROUTINES TO READ IN A BUFR MESSAGE AND THEN
   1459 C   READ A SINGLE REPORT (SUBSET) OUT OF THE MESSAGE.
   1460 C
   1461 C PROGRAM HISTORY LOG:
   1462 C 1996-12-16  D. A. KEYSER NP22 - ORIGINAL AUTHOR
   1463 C 1999-02-12  D. A. KEYSER NP22-- ADDED ERS SCATTEROMETER WINDS HERE
   1464 C     NOW THAT THEY ARE PACKED IN A NCEP BUFR FILE
   1465 C 2000-09-22  D. A. KEYSER NP22-- ADDED QUIKSCAT SCATTEROMETER WINDS
   1466 C     HERE NOW THAT THEY ARE PACKED IN A NCEP BUFR FILE
   1467 C 2002-07-03  D. A. KEYSER NP22 -- ADDED PROCESSING OF GPS-IPW REPORTS
   1468 C     HERE NOW THAT THEY ARE PACKED IN AN NCEP BUFR FILE (GPSIPW -
   1469 C     RETURNED IN NEW CATEGORY 14)
   1470 C 2004-02-02  D. A. KEYSER -- ADDED NEW INPUT "SUBSKP" - SEE
   1471 C     DESCRIPTION BELOW
   1472 C 2006-07-14  D. A. KEYSER (THIS FUNCTION IN PROGRAM BUFR_LISTDUMPS):
   1473 C 2007-09-14  D. A. KEYSER (THIS FUNCTION IN PROGRAM PREPOBS_PREPDATA):
   1474 C     MODIFIED TO HANDLE NAVY WINDSAT SCATTEROMETER WINDS (READ FROM
   1475 C     MESSAGE TYPE NC012138)
   1476 C 2007-09-14  D. A. KEYSER (THIS FUNCTION IN PROGRAM BUFR_LISTDUMPS):
   1477 C 2007-09-14  D. A. KEYSER (THIS FUNCTION IN PROGRAM PREPOBS_PREPDATA):
   1478 C     MODIFIED TO HANDLE NESDIS WINDSAT SCATTEROMETER WINDS (READ FROM
   1479 C     MESSAGE TYPE NC012139), PROCESSING IS IDENTICAL TO NAVY WINDSAT
   1480 C     SCATTEROMETER WINDS; HANDLES GOES 1x1 F-O-V SNDGS RADIANCES IN
   1481 C     SUBSET "NC003003"
   1482 C 2008-09-25  D. A. KEYSER -- ADDED ASCAT SCATTEROMETER WINDS HERE NOW
   1483 C     THAT THEY ARE PACKED IN A NCEP BUFR FILE
   1484 C 2014-03-13  D. A. KEYSER -- MODIFIED TO HANDLE VAD WINDS FROM LEVEL
   1485 C     2 DECODER (SUBSET "NC002017") {IN ADDITION TO THOSE FROM RADAR
   1486 C     CODED MESSAGE (SUBSET "NC002008")}
   1487 C
   1488 C USAGE:    CALL UNPKB701(LUNIT,ITP,SUBSET,SUBSKP,IRET)
   1489 C   INPUT ARGUMENT LIST:
   1490 C     LUNIT    - FORTRAN UNIT NUMBER FOR INPUT DATA FILE
   1491 C     SUBSKP   - TWO-DIMENSIONAL LOGICAL ARRAY WHERE ELEMENT 1 REFERS
   1492 C              - TO A PARTICULAR BUFR TYPE (RANGE 0-255) AND ELEMENT 2
   1493 C              - REFERS TO A PARTICULAR BUFR SUBTYPE (RANGE 0-200). IF
   1494 C              - SUBSKP IS SET TO TRUE FOR A PARTICULAR BUFR TYPE AND
   1495 C              - SUBTYPE, THEN ANY BUFR MESSAGE OF THIS TYPE READ IN
   1496 C              - WILL BE SKIPPED OVER {NO SUBSETS (REPORTS) WILL BE
   1497 C              - DECODED OUT OF IT AND RETURNED TO THE CALLING PROGRAM,
   1498 C              - INSTEAD THIS SUBROUTINE WILL MOVE ON TO READ THE NEXT
   1499 C              - BUFR MESSAGE IN THE FILE AND AGAIN USE SUBSKP TO SEE
   1500 C              - IF ANY SUBSETS SHOULD BE DECODED OUT OF IT}. THIS
   1501 C              - ALLOWS THIS SUBROUTINE TO QUICKLY PASS BY ANY BUFR
   1502 C              - MESSAGES WITH A TYPE/SUBTYPE THAT THE CALLING PROGRAM
   1503 C              - DOES NOT WANT DECODED.  THE LENGTH OF THIS ARRAY
   1504 C              - SHOULD ALWAYS BE HARDWIRED TO (0:255,0:200).
   1505 C
   1506 C   OUTPUT ARGUMENT LIST:
   1507 C     ITP      - THE TYPE OF REPORT THAT HAS BEEN DECODED {=1 - NPN
   1508 C              - WIND PROFILER, =2 - CAP WIND PROFILER, =3 - JMA WIND
   1509 C              - PROFILER, =4 - GOES SNDG, =5 - NEXRAD (VAD) WIND FROM

Page 30          Source Listing                  W3UNPKB7
2017-04-18 11:09                                 w3unpkb7.f

   1510 C              - RADAR CODED MESSAGE; =6 - ERS SCATTEROMETER WIND, =7 -
   1511 C              - QUIKSCAT SCATTEROMETER WIND, =8 - GPS-IPW, =9 - NPN
   1512 C              - or CAP RASS, =10 - WINDSAT SCATTEROMETER WIND (NAVY OR
   1513 C              - NESDIS), =11 - ASCAT SCATTEROMETER WIND; =12 - NEXRAD
   1514 C              - (VAD) WIND FROM LEVEL 2 DECODER}
   1515 C     SUBSET   - CHARACTER*8 BUFR MESSAGE TYPE (SAME FOR ALL REPORTS
   1516 C              - IN A COMMON BUFR MESSAGE)
   1517 C     IRET     - RETURN CODE AS DESCRIBED IN W3UNPKB7 DOCBLOCK
   1518 C
   1519 C   INPUT FILES:
   1520 C     UNIT AA  - (WHERE AA IS LUNIT ABOVE) FILE HOLDING THE DATA
   1521 C              - IN THE FORM OF BUFR MESSAGES
   1522 C
   1523 C   OUTPUT FILES:
   1524 C     UNIT 06  - PRINTOUT
   1525 C
   1526 C REMARKS: CALLED BY SUBROUTINE W3UNPKB7.
   1527 C
   1528 C ATTRIBUTES:
   1529 C   LANGUAGE: FORTRAN 90
   1530 C   MACHINE:  NCEP WCOSS
   1531 C
   1532 C$$$
   1533       SUBROUTINE UNPKB701(LUNIT,ITP,SUBSET,SUBSKP,IRET)
   1534       CHARACTER*8   SUBSET,SUBSET_LAST
   1535       INTEGER  MDATE(4),NDATE(8)
   1536       LOGICAL  SUBSKP(0:255,0:200),SKIP_CAT12
   1537       DIMENSION  RINC_O(5)
   1538       COMMON /PKB7BB/KDATE(8),LDATE(8),KTIMCH,IPRINT,SKIP_CAT12
   1539       COMMON /PKB7CC/INDEX
   1540       COMMON /PKB7DD/LSHE,LSHL,ICDATE(5),IDDATE(5)
   1541       COMMON /PKB7HH/NPRINT(0:255,0:200)
   1542  
   1543       SAVE
   1544 
   1545       DATA  IREC/0/,JREC/0/,SUBSET_LAST/'xxxxxxxx'/
   1546 
   1547    10 CONTINUE
   1548 C=======================================================================
   1549       IF(INDEX.EQ.0)  THEN
   1550  
   1551 C  READ IN NEXT BUFR MESSAGE
   1552  
   1553          CALL READMG(LUNIT,SUBSET,IBDATE,KRET)
   1554          IF(KRET.NE.0)  THEN
   1555 C-----------------------------------------------------------------------
   1556             PRINT 101
   1557   101   FORMAT(' ---> W3UNPKB7: ALL BUFR MESSAGES READ IN AND DECODED'/)
   1558             IRET = 2
   1559             RETURN
   1560 C-----------------------------------------------------------------------
   1561          END IF
   1562          IF(IBDATE.LT.100000000)  THEN
   1563 C IF INPUT BUFR FILE DOES NOT RETURN MESSAGES WITH A 4-DIGIT YEAR,
   1564 C  SOMETHING IS WRONG (EVEN NON-COMPLIANT BUFR MESSAGES SHOULD
   1565 C  CONSTRUCT A 4-DIGIT YEAR AS LONG AS DATELEN(10) HAS BEEN CALLED
   1566             PRINT'(" ##W3UNPKB7/UNPKB701 - A 10-DIGIT SECT. 1 BUFR ",

Page 31          Source Listing                  UNPKB701
2017-04-18 11:09                                 w3unpkb7.f

   1567      $       "MESSAGE DATE WAS NOT RETURNED IN UNIT ",I0," - PROBLEM ",
   1568      $       "WITH BUFR FILE - IRET = 2")', LUNIT
   1569             IRET = 2
   1570             RETURN
   1571          END IF
   1572          IF(SUBSET.NE.SUBSET_LAST)   THEN
   1573             JREC = 0
   1574             SUBSET_LAST = SUBSET
   1575          END IF
   1576          CALL UFBCNT(LUNIT,IREC,ISUB)
   1577          JREC = JREC + 1
   1578          MDATE(1) = IBDATE/1000000
   1579          MDATE(2) = MOD((IBDATE/10000),100)
   1580          MDATE(3) = MOD((IBDATE/100),100)
   1581          MDATE(4) = MOD(IBDATE,100)
   1582          IF(IPRINT.GE.1)  THEN
   1583             PRINT'(" HAVE SUCCESSFULLY READ IN A BUFR MESSAGE")'
   1584             PRINT 103
   1585   103       FORMAT(' BUFR FOUND BEGINNING AT BYTE    1 OF MESSAGE')
   1586             PRINT 105, IREC,MDATE,SUBSET
   1587   105       FORMAT(8X,'HAVE READ IN A BUFR MESSAGE NO.',I3,', DATE: ',
   1588      $      I6,3I4,'   0; TABLE A ENTRY = ',A8,' AND EDIT. NO. =    2'/)
   1589          END IF
   1590          IF(SUBSET.EQ.'NC002007')  THEN
   1591             IF(IPRINT.GE.1)  PRINT'(" THIS MESSAGE CONTAINS NOAA ",
   1592      $       "PROFILER NETWORK WIND REPORTS")'
   1593             ITP = 1
   1594          ELSE  IF(SUBSET.EQ.'NC002011')  THEN
   1595             IF(IPRINT.GE.1)  PRINT'(" THIS MESSAGE CONTAINS ",
   1596      $       "COOPERATIVE AGENCY PROFILER WIND REPORTS")'
   1597             ITP = 2
   1598          ELSE  IF(SUBSET.EQ.'NC002013')  THEN
   1599             IF(IPRINT.GE.1)  PRINT'(" THIS MESSAGE CONTAINS JAPANESE ",
   1600      $       "METEOROLOGICAL AGENCY PROFILER WIND REPORTS")'
   1601             ITP = 3
   1602          ELSE  IF(SUBSET.EQ.'NC002008')  THEN
   1603             IF(IPRINT.GE.1)  PRINT'(" THIS MESSAGE CONTAINS NEXRAD ",
   1604      $       "(VAD) WIND REPORTS FROM RADAR CODED MESSAGE")'
   1605             ITP = 5
   1606          ELSE  IF(SUBSET.EQ.'NC002017')  THEN
   1607             IF(IPRINT.GE.1)  PRINT'(" THIS MESSAGE CONTAINS NEXRAD ",
   1608      $       "(VAD) WIND REPORTS FROM LEVEL 2 DECODER")'
   1609             ITP = 12
   1610          ELSE  IF(SUBSET.EQ.'NC003001' .or. SUBSET.EQ.'NC003002' .or.
   1611      $            SUBSET.EQ.'NC003003')  THEN
   1612             IF(IPRINT.GE.1)  PRINT'(" THIS MESSAGE CONTAINS GOES ",
   1613      $       "SOUNDING/RADIANCE REPORTS")'
   1614             ITP = 4
   1615          ELSE  IF(SUBSET.EQ.'NC012008')  THEN
   1616             IF(IPRINT.GE.1)  PRINT'(" THIS MESSAGE CONTAINS ERS ",
   1617      $       "SCATTEROMETER WIND REPORTS")'
   1618             ITP = 6
   1619          ELSE  IF(SUBSET.EQ.'NC012137')  THEN
   1620             IF(IPRINT.GE.1)  PRINT'(" THIS MESSAGE CONTAINS QUIKSCAT ",
   1621      $       "SCATTEROMETER WIND REPORTS")'
   1622             ITP = 7
   1623          ELSE  IF(SUBSET.EQ.'NC002009')  THEN

Page 32          Source Listing                  UNPKB701
2017-04-18 11:09                                 w3unpkb7.f

   1624             PRINT 217
   1625   217 FORMAT(/'##W3UNPKB7: THIS MESSAGE CONTAINS WIND PROFILER ',
   1626      $ 'REPORTS ORIGINATING FROM PILOT (PIBAL) BULLETINS - IRET = 8'/)
   1627             IRET = 8
   1628             RETURN
   1629          ELSE  IF(SUBSET.EQ.'NC012003' .OR. SUBSET.EQ.'NC012004')  then
   1630             IF(IPRINT.GE.1)  PRINT'(" THIS MESSAGE CONTAINS GPS-IPW ",
   1631      $       "REPORTS")'
   1632             ITP = 8
   1633          ELSE  IF(SUBSET.EQ.'NC002012')  THEN
   1634             IF(IPRINT.GE.1)  PRINT'(" THIS MESSAGE CONTAINS NOAA ",
   1635      $       "PROFILER NETWORK AND COOPERATIVE AGENCY RASS TEMPERATURE",
   1636      $       " REPORTS")'
   1637             ITP = 9
   1638          ELSE  IF(SUBSET.EQ.'NC012138' .OR. SUBSET.EQ.'NC012139')  THEN
   1639             IF(IPRINT.GE.1)  PRINT'(" THIS MESSAGE CONTAINS WINDSAT ",
   1640      $       "SCATTEROMETER WIND REPORTS FROM THE NAVY OR NESDIS")'
   1641             ITP = 10
   1642          ELSE  IF(SUBSET.EQ.'NC012122')  THEN
   1643             IF(IPRINT.GE.1)  PRINT'(" THIS MESSAGE CONTAINS ASCAT ",
   1644      $       "SCATTEROMETER WIND REPORTS")'
   1645             ITP = 11
   1646          ELSE
   1647             PRINT 107, IREC,SUBSET
   1648   107 FORMAT(' *** W3UNPKB7 WARNING: BUFR MESSAGE NO.',I3,' CONTAINS ',
   1649      $ 'REPORTS THAT CANNOT BE DECODED (SUBSET = ',A8,'), TRY READING ',
   1650      $ 'NEXT MSG'/)
   1651             INDEX = 0
   1652             GO TO 10
   1653          END IF
   1654 
   1655          JSUB = NMSUB(LUNIT)
   1656          READ(SUBSET(3:5),'(I3)') IINDEX
   1657          READ(SUBSET(6:8),'(I3)') JINDEX
   1658          IF(IINDEX.LE.255 .AND. JINDEX.LE.200) THEN
   1659             IF(SUBSKP(IINDEX,JINDEX))  THEN
   1660                IF(JSUB.GT.0.AND.NPRINT(IINDEX,JINDEX).EQ.0)  THEN
   1661 
   1662 C  There may be messages with no reports present (e.g., the center time
   1663 C   and dump time messages which may be present even if no reports are
   1664 C   present in subsequent messages), so key on the FIRST message of
   1665 C   this type/subtype with reports present for the diagnostic print
   1666 
   1667                   PRINT 1234, SUBSET
   1668  1234 FORMAT(/' ---> W3UNPKB7: BUFR MESSAGE WITH TABLE ENTRY "',A8,
   1669      $ '" (AND CONTAINING SUBSETS) READ - ALL MESSAGES WITH THIS BUFR ',
   1670      $ 'TYPE/SUBTYPE'/20X,'ARE SKIPPED AS DIRECTED BY CALLING PROGRAM'/)
   1671                NPRINT(IINDEX,JINDEX) = 1
   1672                END IF
   1673                INDEX = 0
   1674                GO TO 10
   1675             END IF
   1676          END IF
   1677 
   1678          IF(KTIMCH.EQ.1)  THEN
   1679 
   1680 C CHECK DATE OF MESSAGE AGAINST SPEC. TIME RANGES IF DOING TIME CHECK

Page 33          Source Listing                  UNPKB701
2017-04-18 11:09                                 w3unpkb7.f

   1681 
   1682 C ALL NCEP BUFR MESSAGES CURRENTLY HAVE "00" FOR MINUTES IN SECTION 1
   1683             NDATE(1:3) = MDATE(1:3)
   1684             NDATE(4) = 0
   1685             NDATE(5) = MDATE(4)
   1686             NDATE(6:8) = 0
   1687             CALL W3DIFDAT(KDATE,NDATE,3,RINC_O)
   1688             KMIN = RINC_O(3)
   1689             CALL W3DIFDAT(LDATE,NDATE,3,RINC_O)
   1690             LMIN = RINC_O(3)
   1691             IF((KMIN.GT.0.OR.LMIN.LT.0).AND.IREC.GT.2)  THEN
   1692                PRINT 106, IREC,MDATE
   1693   106 FORMAT('  BUFR MESSAGE NO.',I3,' WITH DATE:',I5,3I3,'  0 NOT W/I',
   1694      $ ' REQ. TIME RANGE, TRY READING NEXT MSG'/)
   1695                INDEX = 0
   1696                GO TO 10
   1697             END IF
   1698 
   1699          END IF
   1700 
   1701       END IF
   1702 C=======================================================================
   1703 C  READ NEXT SUBSET (REPORT) IN MESSAGE
   1704  
   1705       IF(IPRINT.GT.1)  PRINT'(" CALL READSB")'
   1706       CALL READSB(LUNIT,KRET)
   1707       IF(IPRINT.GT.1)  PRINT'(" BACK FROM READSB")'
   1708       IF(KRET.NE.0) THEN
   1709          IF(INDEX.GT.0)  THEN
   1710  
   1711 C ALL SUBSETS IN THIS MESSAGE PROCESSED, READ IN NEXT MESSAGE (IF ALL
   1712 C  MESSAGES READ IN NO MORE DATA TO PROCESS)
   1713  
   1714             IF(IPRINT.GT.1)  PRINT'(" ALL REPORTS IN THIS MESSAGE ",
   1715      $       "DECODED, GO ON TO NEXT MESSAGE")'
   1716          ELSE
   1717  
   1718 C THERE WERE NO SUBSETS FOUND IN THIS BUFR MESSAGE, GOOD CHANCE IT IS
   1719 C  ONE OF TWO DUMMY MESSAGES AT TOP OF FILE INDICATING CENTER TIME AND
   1720 C  DATA DUMP TIME ONLY; READ IN NEXT MESSAGE
   1721  
   1722             IF(JREC.EQ.1)  THEN
   1723                PRINT 4567, IREC,ICDATE,SUBSET
   1724  4567 FORMAT(/'===> BUFR MESSAGE NO. ',I4,' IS A DUMMY CONTAINING ONLY',
   1725      $ ' CENTER DATE (',I4,4I3.2,') FOR MSG TYPE ',A8,' - GO ON TO ',
   1726      $ 'NEXT MESSAGE'/)
   1727             ELSE IF(JREC.EQ.2)  THEN
   1728                PRINT 4568, IREC,IDDATE,SUBSET
   1729  4568 FORMAT(/'===> BUFR MESSAGE NO. ',I4,' IS A DUMMY CONTAINING ONLY',
   1730      $ '  DUMP  DATE (',I4,4I3.2,') FOR MSG TYPE ',A8,' - GO ON TO ',
   1731      $ 'NEXT MESSAGE'/)
   1732             ELSE
   1733                PRINT 4569, IREC,MDATE
   1734  4569 FORMAT(/'===> BUFR MESSAGE NO.',I3,' (DATE:',I5,3I3,'  0) ',
   1735      $ 'CONTAINS ZERO REPORTS FOR SOME UNEXPLAINED REASON - GO ON TO ',
   1736      $ 'NEXT MESSAGE'/)
   1737             END IF

Page 34          Source Listing                  UNPKB701
2017-04-18 11:09                                 w3unpkb7.f

   1738          END IF
   1739          INDEX = 0
   1740          GO TO 10
   1741       END IF
   1742 C-----------------------------------------------------------------------
   1743       IF(IPRINT.GT.1)  PRINT'(" READY TO PROCESS NEW DECODED REPORT")'
   1744 C***********************************************************************
   1745 C            A SINGLE REPORT HAS BEEN SUCCESSFULLY DECODED
   1746 C***********************************************************************
   1747       INDEX = INDEX + 1
   1748       IF(IPRINT.GE.1)  PRINT'(" WORKING WITH SUBSET NUMBER ",I0)', INDEX
   1749       RETURN
   1750       END


ENTRY POINTS

  Name                 
                       
 unpkb701_             


SYMBOL CROSS REFERENCE

 Name                       Object Declared Type            Bytes Dimen Elements Attributes       References                        
                                                                                                                                    
 10                         Label  1482                                                           1587,1609,1631,1675               
 101                        Label  1492                                                           1491                              
 103                        Label  1520                                                           1519                              
 105                        Label  1522                                                           1521                              
 106                        Label  1628                                                           1627                              
 107                        Label  1583                                                           1582                              
 1234                       Label  1603                                                           1602                              
 217                        Label  1560                                                           1559                              
 4567                       Label  1659                                                           1658                              
 4568                       Label  1664                                                           1663                              
 4569                       Label  1669                                                           1668                              
 IBDATE                     Local  1488     I(4)            4           scalar   SAVE             1488,1497,1513,1514,1515,1516     
 ICDATE                     Scalar 1475     I(4)            4     1     5        COM              1658                              
 IDDATE                     Scalar 1475     I(4)            4     1     5        COM              1663                              
 IINDEX                     Local  1591     I(4)            4           scalar   SAVE             1591,1593,1594,1595,1606          
 INDEX                      Scalar 1474     I(4)            4           scalar   COM              1484,1586,1608,1630,1644,1674,1682
                                                                                                  ,1683                             
 IPRINT                     Scalar 1473     I(4)            4           scalar   COM              1517,1526,1530,1534,1538,1542,1547
                                                                                                  ,1551,1555,1565,1569,1574,1578,164
                                                                                                  0,1642,1649,1678,1683             
 IREC                       Local  1480     I(4)            4           scalar   SAVE             1480,1511,1521,1582,1626,1627,1658
                                                                                                  ,1663,1668                        
 IRET                       Dummy  1468     I(4)            4           scalar   ARG,INOUT        1493,1504,1562                    
 ISUB                       Local  1511     I(4)            4           scalar   SAVE             1511                              
 ITP                        Dummy  1468     I(4)            4           scalar   ARG,INOUT        1528,1532,1536,1540,1544,1549,1553
                                                                                                  ,1557,1567,1572,1576,1580         
 JINDEX                     Local  1592     I(4)            4           scalar   SAVE             1592,1593,1594,1595,1606          
 JREC                       Local  1480     I(4)            4           scalar   SAVE             1480,1508,1512,1657,1662          
 JSUB                       Local  1590     I(4)            4           scalar   SAVE             1590,1595                         
 KDATE                      Scalar 1473     I(4)            4     1     8        COM              1622                              
 KMIN                       Local  1623     I(4)            4           scalar   SAVE             1623,1626                         

Page 35          Source Listing                  UNPKB701
2017-04-18 11:09 Symbol Table                    w3unpkb7.f

 Name                       Object Declared Type            Bytes Dimen Elements Attributes       References                        
                                                                                                                                    
 KRET                       Local  1488     I(4)            4           scalar   SAVE             1488,1489,1641,1643               
 KTIMCH                     Scalar 1473     I(4)            4           scalar   COM              1613                              
 LDATE                      Scalar 1473     I(4)            4     1     8        COM              1624                              
 LMIN                       Local  1625     I(4)            4           scalar   SAVE             1625,1626                         
 LSHE                       Scalar 1475     I(4)            4           scalar   COM                                                
 LSHL                       Scalar 1475     I(4)            4           scalar   COM                                                
 LUNIT                      Dummy  1468     I(4)            4           scalar   ARG,INOUT        1488,1503,1511,1590,1641          
 MDATE                      Local  1470     I(4)            4     1     4        SAVE             1513,1514,1515,1516,1521,1618,1620
                                                                                                  ,1627,1668                        
 MOD                        Func   1514                                 scalar                    1514,1515,1516                    
 NDATE                      Local  1470     I(4)            4     1     8        SAVE             1618,1619,1620,1621,1622,1624     
 NMSUB                      Func   1590     I(4)            4           scalar                    1590                              
 NPRINT                     Scalar 1476     I(4)            4     2     51456    COM              1595,1606                         
 PKB7BB                     Common 1473                                 76       SAVE                                               
 PKB7CC                     Common 1474                                 4        SAVE                                               
 PKB7DD                     Common 1475                                 48       SAVE                                               
 PKB7HH                     Common 1476                                 205824   SAVE                                               
 READMG                     Subr   1488                                                           1488                              
 READSB                     Subr   1641                                                           1641                              
 RINC_O                     Local  1472     R(4)            4     1     5        SAVE             1622,1623,1624,1625               
 SKIP_CAT12                 Scalar 1471     L(4)            4           scalar   COM                                                
 SUBSET                     Dummy  1468     CHAR            8           scalar   ARG,INOUT        1488,1507,1509,1521,1525,1529,1533
                                                                                                  ,1537,1541,1545,1546,1550,1554,155
                                                                                                  8,1564,1568,1573,1577,1582,1591,15
                                                                                                  92,1602,1658,1663                 
 SUBSET_LAST                Local  1469     CHAR            8           scalar   SAVE             1480,1507,1509                    
 SUBSKP                     Dummy  1468     L(4)            4     2     51456    ARG,INOUT        1594                              
 UFBCNT                     Subr   1511                                                           1511                              
 UNPKB701                   Subr   1468                                                                                             
 W3DIFDAT                   Subr   1622                                                           1622,1624                         

Page 36          Source Listing                  UNPKB701
2017-04-18 11:09                                 w3unpkb7.f

   1751 C$$$  SUBPROGRAM DOCUMENTATION BLOCK
   1752 C
   1753 C SUBPROGRAM:    UNPKB702
   1754 C   PRGMMR: D. A. KEYSER     ORG: NP22       DATE: 2014-03-13
   1755 C
   1756 C ABSTRACT: INITIALIZES THE OUTPUT ARRAY WHICH HOLDS A SINGLE REPORT
   1757 C   IN THE QUASI-IW3UNPBF UNPACKED FORMAT TO ALL MISSING.
   1758 C
   1759 C PROGRAM HISTORY LOG:
   1760 C 1996-12-16  D. A. KEYSER NP22 - ORIGINAL AUTHOR
   1761 C 1999-02-12  D. A. KEYSER NP22-- ADDED ERS SCATTEROMETER WINDS HERE
   1762 C     NOW THAT THEY ARE PACKED IN A NCEP BUFR FILE
   1763 C 2000-09-22  D. A. KEYSER NP22-- ADDED QUIKSCAT SCATTEROMETER WINDS
   1764 C     HERE NOW THAT THEY ARE PACKED IN A NCEP BUFR FILE
   1765 C 2002-07-03  D. A. KEYSER NP22 -- ADDED PROCESSING OF GPS-IPW REPORTS
   1766 C     HERE NOW THAT THEY ARE PACKED IN AN NCEP BUFR FILE (GPSIPW -
   1767 C     RETURNED IN NEW CATEGORY 14)
   1768 C 2004-02-02  D. A. KEYSER NP22 -- ADDED PROCESSING OF RASS REPORTS
   1769 C     HERE NOW THAT THEY ARE PACKED IN AN NCEP BUFR FILE (RASSDA -
   1770 C     RETURNED IN NEW DATA LEVEL CATEGORY 15)
   1771 C 2008-09-25  D. A. KEYSER -- ADDED ASCAT SCATTEROMETER WINDS HERE NOW
   1772 C     THAT THEY ARE PACKED IN A NCEP BUFR FILE
   1773 C 2014-03-13  D. A. KEYSER -- MODIFIED TO HANDLE VAD WINDS FROM LEVEL
   1774 C     2 DECODER (SUBSET "NC002017") {IN ADDITION TO THOSE FROM RADAR
   1775 C     CODED MESSAGE (SUBSET "NC002008")}; PARAMETERIZED MAXIMUM NUMBER
   1776 C     OF LEVELS ALLOWED FOR EACH CATEGORY AND CALCULATED PARAMETER
   1777 C     "IDMAX" (SIZE OF OUTPUT "RDATA" ARRAY) BASED ON THESE, ALL ARE
   1778 C     NOW PLACED IN INCLUDE FILE 'inc_w3unpkb7.inc' {IN HERE, MAXIMUM
   1779 C     NUMBER OF CAT. 04 WINDS-BY-HEIGHT LEVELS (EXCLUDING FIRST,
   1780 C     SURFACE, LEVEL), "ILVLMX_04", INCREASED FROM 64 TO 254 TO ACCOUNT
   1781 C     FOR MORE LEVELS IN NEW VAD WINDS FROM LEVEL 2 DECODER, AND
   1782 C     MAXIMUM NUMBER OF CAT. 11 WIND PROFILER LEVELS (EXCLUDING FIRST,
   1783 C     SURFACE, LEVEL), "ILVLMX_11", INCREASED FROM 102 TO 200 TO
   1784 C     ACCOUNT FOR SOME MAP PROFILERS WITH MORE LEVELS THAN BEFORE, THE
   1785 C     RESULTING "IDMAX" IS NOW 2270, UP FROM 1200 BEFORE}
   1786 C
   1787 C USAGE:    CALL UNPKB702(RDATA,STNID,ITP)
   1788 C   INPUT ARGUMENT LIST:
   1789 C     ITP      - THE TYPE OF REPORT THAT HAS BEEN DECODED {=1 - NPN
   1790 C              - WIND PROFILER, =2 - CAP WIND PROFILER, =3 - JMA WIND
   1791 C              - PROFILER, =4 - GOES SNDG, =5 - NEXRAD (VAD) WIND FROM
   1792 C              - RADAR CODED MESSAGE; =6 - ERS SCATTEROMETER WIND, =7 -
   1793 C              - QUIKSCAT SCATTEROMETER WIND, =8 - GPS-IPW, =9 - NPN
   1794 C              - or CAP RASS, =10 - WINDSAT SCATTEROMETER WIND (NAVY OR
   1795 C              - NESDIS), =11 - ASCAT SCATTEROMETER WIND; =12 - NEXRAD
   1796 C              - (VAD) WIND FROM LEVEL 2 DECODER}
   1797 C   OUTPUT ARGUMENT LIST:
   1798 C     RDATA    - SINGLE REPORT RETURNED AN A QUASI-IW3UNPBF
   1799 C              - UNPACKED FORMAT; ALL DATA ARE MISSING (NOTE: DOES NOT
   1800 C              - INCLUDE STATION ID)
   1801 C     STNID    - CHARACTER*8 SINGLE REPORT STATION IDENTIFICATION (UP
   1802 C              - TO 8 CHARACTERS, LEFT-JUSTIFIED - HERE INITIALIZED AS
   1803 C              - "????????" FOR GOES SOUNDINGS, ERS SCATTEROMETER,
   1804 C              - QUIKSCAT SCATTEROMETER, WINDSAT SCATTEROMETER AND
   1805 C              - ASCAT SCATTEROMETER AND AS BLANKS FOR ALL OTHER TYPES)
   1806 C
   1807 C REMARKS: CALLED BY SUBROUTINE W3UNPKB7.

Page 37          Source Listing                  UNPKB701
2017-04-18 11:09                                 w3unpkb7.f

   1808 C
   1809 C ATTRIBUTES:
   1810 C   LANGUAGE: FORTRAN 90
   1811 C   MACHINE:  NCEP WCOSS
   1812 C
   1813 C$$$
   1814       SUBROUTINE UNPKB702(RDATA,STNID,ITP)
   1815 
   1816 C  Include parameters common to more than one subroutine
   1817 C  -----------------------------------------------------
   1818 
   1819       include 'inc_w3unpkb7.inc'
   1820 
   1886       REAL  RDATA(*),RDATX(IDMAX)
   1887       INTEGER  IDATA(IDMAX)
   1888       CHARACTER*8  STNID
   1889 
   1890       COMMON /PKB7GG/IDATS_04,IDATS_08,IDATS_10,IDATS_11,IDATS_12,
   1891      $ IDATS_13,IDATS_14,IDATS_15
   1892 
   1893       SAVE
   1894 
   1895       EQUIVALENCE (RDATX,IDATA)
   1896 
   1897       DATA  XMISS/99999./,IMISS/99999/
   1898 
   1899       IDATS_04 = 0
   1900       IDATS_08 = 0
   1901       IDATS_10 = 0
   1902       IDATS_11 = 0
   1903       IDATS_12 = 0
   1904       IDATS_13 = 0
   1905       IDATS_14 = 0
   1906       IDATS_15 = 0
   1907 
   1908       RDATX(1)  = XMISS
   1909       RDATX(2)  = XMISS
   1910       RDATA(3)  = XMISS
   1911       RDATX(4)  = XMISS
   1912       IDATA(5)  = 999999
   1913       IDATA(6)  = 999999
   1914       RDATX(7)  = XMISS
   1915       IDATA(8)  = IMISS
   1916       IDATA(9)  = IMISS
   1917       IDATA(10) = IMISS
   1918       RDATX(11) = XMISS
   1919       RDATX(12) = XMISS
   1920       STNID = '        '
   1921  
   1922 C  ALL TYPES -- LOAD ZEROS INTO THE DEFINING WORD PAIRS
   1923  
   1924       IDATA(13:IDATS-1) = 0
   1925  
   1926 C  ALL TYPES -- LOAD MISSINGS INTO THE DATA PORTION
   1927  
   1928       RDATX(IDATS:IDMAX) = XMISS
   1929 

Page 38          Source Listing                  UNPKB702
2017-04-18 11:09                                 w3unpkb7.f

   1930       IF(ITP.EQ.1.OR.ITP.EQ.2.OR.ITP.EQ.3)  THEN
   1931 
   1932 C  WIND PROFILER -- LOAD INTEGER MISSING WHERE APPROPRIATE
   1933 C                   {Current limit of "ILVLMX_11" Cat. 11 levels, not
   1934 C                     counting first (surface) level}
   1935 C                   (if this is expanded, "IDMAX" will increase)
   1936 
   1937          IDATS_10 = IDATS
   1938          IDATS_11 = IDATS_10 + (ILVL_10 * 7)
   1939          IDATA(IDATS_11+ 3:IDMAX:11) = IMISS
   1940          IDATA(IDATS_11+ 5:IDMAX:11) = IMISS
   1941          IDATA(IDATS_11+ 6:IDMAX:11) = IMISS
   1942          IDATA(IDATS_11+10:IDMAX:11) = IMISS
   1943 
   1944       ELSE  IF(ITP.EQ.4)  THEN
   1945 
   1946 C  GOES -- LOAD DEFAULT OF "????????" FOR STN. ID.
   1947 
   1948          STNID = '????????'
   1949 
   1950 C  GOES -- LOAD DEFAULT OF 2.0 INTO CAT. 12 LEVEL QUALITY MARKERS
   1951 C          (Current limit of "ILVLMX_12" Cat. 12 levels)
   1952 C          (could be expanded somewhat w/o changing "IDMAX" if need be)
   1953 
   1954          IDATS_12 = IDATS
   1955          RDATA(IDATS_12+6:IDATS_12+6+((ILVLMX_12-1)*9):9) = 2.0
   1956          RDATA(IDATS_12+7:IDATS_12+7+((ILVLMX_12-1)*9):9) = 2.0
   1957          RDATA(IDATS_12+8:IDATS_12+8+((ILVLMX_12-1)*9):9) = 2.0
   1958 
   1959 C  GOES -- LOAD DEFAULT OF 2.0 INTO FIRST CAT. 08 LEVEL QUALITY MARKER
   1960 C          (Current limit of "ILVLMX_08" Cat. 08 levels)
   1961 C          (could be expanded somewhat w/o changing "IDMAX" if need be
   1962 C           but source in w3unpkb7.f would have to be changed!!)
   1963 
   1964          IDATS_08 = IDATS_12 + (ILVLMX_12 * 9)
   1965          RDATA(IDATS_08+2:IDATS_08+2+((ILVLMX_08-1)*4):4) = 2.0
   1966 
   1967 C  GOES -- LOAD INTEGER MISSING INTO CAT. 13 LEVEL CHANNEL NUMBER
   1968 C       -- LOAD DEFAULT OF 2.0 INTO CAT. 13 LEVEL QUALITY MARKER
   1969 C          (Current limit of "ILVLMX_13" Cat. 13 levels)
   1970 C          (could be expanded somewhat w/o changing "IDMAX" if need be)
   1971 
   1972          IDATS_13 = IDATS_08 + (ILVLMX_08 * 4)
   1973          IDATA(IDATS_13+0:IDATS_13+0+((ILVLMX_13-1)*3):3) = IMISS
   1974          RDATA(IDATS_13+2:IDATS_13+2+((ILVLMX_13-1)*3):3) = 2.0
   1975 
   1976       ELSE  IF(ITP.EQ.5 .OR. ITP.EQ.12)  THEN
   1977 
   1978 C  VADWND -- LOAD DEFAULT OF 2.0 INTO HGHT CAT. 04 LEVEL QUALITY MARKER
   1979 C         -- LOAD DEFAULT OF 4.0 INTO WIND CAT. 04 LEVEL QUALITY MARKER
   1980 C            {Current limit of "ILVLMX_04" Cat. 04 levels, not counting
   1981 C             first (surface) level}
   1982 C          (could be expanded somewhat w/o changing "IDMAX" if need be)
   1983 
   1984          IDATS_04 = IDATS
   1985          RDATA(IDATS_04+3:IDMAX:5)   = 2.0
   1986          RDATA(IDATS_04+4:IDMAX:5)   = 4.0

Page 39          Source Listing                  UNPKB702
2017-04-18 11:09                                 w3unpkb7.f

   1987 
   1988       ELSE  IF(ITP.EQ.6.OR.ITP.EQ.7.OR.ITP.EQ.10.OR.ITP.EQ.11)  THEN
   1989 
   1990 C  ERS, QUIKSCAT, WINDSAT OR ASCAT -- LOAD DEFAULT OF "????????" FOR
   1991 C   STN. ID.
   1992 
   1993          IDATS_10 = IDATS
   1994          STNID    = '????????'
   1995 
   1996       ELSE  IF(ITP.EQ.8)  THEN
   1997 
   1998 C  GPS-IPW -- 
   1999 
   2000          IDATS_14 = IDATS
   2001 
   2002       ELSE IF(ITP.EQ.9)  THEN
   2003 
   2004 C          {Current limit of "ILVLMX_15" Cat. 15 levels, not counting
   2005 C           first (surface) level}
   2006 C          (could be expanded somewhat w/o changing "IDMAX" if need be)
   2007 
   2008          IDATS_15 = IDATS
   2009          IDATA(IDATS_15+2:IDMAX:3) = IMISS
   2010       END IF
   2011 
   2012       RDATA(1:IDMAX) = RDATX(1:IDMAX)
   2013 
   2014       RETURN
   2015       END

Page 40          Source Listing                  UNPKB702
2017-04-18 11:09 Entry Points                    w3unpkb7.f



ENTRY POINTS

  Name                 
                       
 unpkb702_             


SYMBOL CROSS REFERENCE

 Name                       Object Declared Type            Bytes Dimen Elements Attributes       References                        
                                                                                                                                    
 IDATA                      Local  1757     I(4)            4     1     2270     SAVE             1782,1783,1785,1786,1787,1794,1809
                                                                                                  ,1810,1811,1812,1843,1879         
 IDATS                      Param  40       I(4)            4           scalar                    43,46,49,52,56,59,1794,1798,1807,1
                                                                                                  824,1854,1863,1870,1878           
 IDATS_04                   Scalar 1760     I(4)            4           scalar   COM              1769,1854,1855,1856               
 IDATS_08                   Scalar 1760     I(4)            4           scalar   COM              1770,1834,1835,1842               
 IDATS_10                   Scalar 1760     I(4)            4           scalar   COM              1771,1807,1808,1863               
 IDATS_11                   Scalar 1760     I(4)            4           scalar   COM              1772,1808,1809,1810,1811,1812     
 IDATS_12                   Scalar 1760     I(4)            4           scalar   COM              1773,1824,1825,1826,1827,1834     
 IDATS_13                   Scalar 1761     I(4)            4           scalar   COM              1774,1842,1843,1844               
 IDATS_14                   Scalar 1761     I(4)            4           scalar   COM              1775,1870                         
 IDATS_15                   Scalar 1761     I(4)            4           scalar   COM              1776,1878,1879                    
 IDMAX                      Param  63       I(4)            4           scalar                    1756,1757,1798,1809,1810,1811,1812
                                                                                                  ,1855,1856,1879,1882              
 IDMAX_GOES                 Param  52       I(4)            4           scalar                    63                                
 IDMAX_GPS                  Param  56       I(4)            4           scalar                    64                                
 IDMAX_PROF                 Param  46       I(4)            4           scalar                    63                                
 IDMAX_RASS                 Param  59       I(4)            4           scalar                    64                                
 IDMAX_SCAT                 Param  49       I(4)            4           scalar                    63                                
 IDMAX_VAD                  Param  43       I(4)            4           scalar                    63                                
 ILVLMX_04                  Param  15       I(4)            4           scalar                    43                                
 ILVLMX_08                  Param  8        I(4)            4           scalar                    52,1835,1842                      
 ILVLMX_11                  Param  19       I(4)            4           scalar                    46                                
 ILVLMX_12                  Param  22       I(4)            4           scalar                    52,1825,1826,1827,1834            
 ILVLMX_13                  Param  25       I(4)            4           scalar                    53,1843,1844                      
 ILVLMX_15                  Param  29       I(4)            4           scalar                    59                                
 ILVL_10                    Param  34       I(4)            4           scalar                    46,49,1808                        
 ILVL_14                    Param  37       I(4)            4           scalar                    56                                
 IMISS                      Local  1767     I(4)            4           scalar   SAVE             1767,1785,1786,1787,1809,1810,1811
                                                                                                  ,1812,1843,1879                   
 ITP                        Dummy  1749     I(4)            4           scalar   ARG,INOUT        1800,1814,1846,1858,1866,1872     
 MAX                        Func   63                                   scalar                    63                                
 PKB7GG                     Common 1760                                 32       SAVE                                               
 RDATA                      Dummy  1749     R(4)            4     1     0        ARG,INOUT        1780,1825,1826,1827,1835,1844,1855
                                                                                                  ,1856,1882                        
 RDATX                      Local  1756     R(4)            4     1     2270     SAVE             1778,1779,1781,1784,1788,1789,1798
                                                                                                  ,1882                             
 STNID                      Dummy  1749     CHAR            8           scalar   ARG,INOUT        1790,1818,1864                    
 UNPKB702                   Subr   1749                                                                                             
 XMISS                      Local  1767     R(4)            4           scalar   SAVE             1767,1778,1779,1780,1781,1784,1788
                                                                                                  ,1789,1798                        

Page 41          Source Listing                  UNPKB702
2017-04-18 11:09                                 w3unpkb7.f

   2016 
   2017 C$$$  SUBPROGRAM DOCUMENTATION BLOCK
   2018 C
   2019 C SUBPROGRAM:    UNPKB703
   2020 C   PRGMMR: D. A. KEYSER     ORG: NP22       DATE: 2016-11-30
   2021 C
   2022 C ABSTRACT: FOR REPORT (SUBSET) READ OUT OF BUFR MESSAGE (PASSED IN
   2023 C   INTERNALLY VIA BUFRLIB STORAGE), CALLS BUFRLIB ROUTINE TO DECODE
   2024 C   HEADER DATA FOR ALL REPORTS.  THE HEADER IS THEN FILLED INTO THE
   2025 C   OUTPUT ARRAY WHICH HOLDS A SINGLE REPORT IN THE QUASI-IW3UNPBF
   2026 C   UNPACKED FORMAT.
   2027 C
   2028 C PROGRAM HISTORY LOG:
   2029 C 1996-12-16  D. A. KEYSER NP22 - ORIGINAL AUTHOR (HANDLED PROFILER
   2030 C     REPORTS ONLY
   2031 C 1997-06-02  D. A. KEYSER NP22 - WROTE SIMILAR SUBROUTINE TO HANDLE
   2032 C     VAD WINDS ONLY
   2033 C 1997-06-05  D. A. KEYSER NP22 - WROTE SIMILAR SUBROUTINE TO HANDLE
   2034 C     GOES SOUNDINGS ONLY
   2035 C 1998-06-14  D. A. KEYSER -- MODIFIED VAD WIND HEADER (STATION ID)
   2036 C     PROCESSING TO ACCOUNT FOR UPDATES TO BUFRTABLE MNEMONICS IN /dcom
   2037 C 1998-06-15  D. A. KEYSER NP22 - CHANGED CHAR. 6 OF GOES STNID TO BE
   2038 C     UNIQUE FOR TWO DIFFERENT EVEN OR ODD SATELLITE ID'S (EVERY OTHER
   2039 C     EVEN OR ODD SAT. ID NOW GETS SAME CHAR. 6 TAG)
   2040 C 1999-02-12  D. A. KEYSER NP22 - WROTE SIMILAR SUBROUTINE TO HANDLE
   2041 C     ERS SCATTEROMETER WINDS ONLY
   2042 C 2000-09-22  D. A. KEYSER NP22-- ADDED QUIKSCAT SCATTEROMETER WINDS
   2043 C     TO ERS SCATTEROMETER SUBROUTINE NOW THAT THEY ARE PACKED IN BUFR
   2044 C 2000-12-05  D. A. KEYSER -- MODIFIED GOES, ERS AND QUIKSCAT TO NOT
   2045 C     CREATE STN. ID IF IT HAS ALREADY BEEN CREATED BY BUFR_DUPSAT
   2046 C     (GOES), WAVE_DATASORT (ERS), OR WAVE_DCODQUIKSCAT (QUIKSCAT)
   2047 C     (LOOKS FOR "RPID" IN INPUT FILE) (OTHERWISE, MODIFIED TO CREATE
   2048 C     AN 8-CHARACTER STN. ID)
   2049 C 2001-04-06  D. A. KEYSER NP22 - HEADER WORD 5 NOW RETURNS COMPLETE
   2050 C     DATE (YYYYMMDDHH) AND HEADER WORD 6 IS NOW MISSING EXCEPT FOR
   2051 C     GOES, ERS AND QUIKSCAT WHERE WORD 6 NOW RETURNS SATELLITE ID
   2052 C 2001-06-19  D. A. KEYSER -- FOR GOES, RECOGNIZES BUFR TYPE/SUBTYPE
   2053 C     003/002 AS GOES 1x1 (HI-RES) DATA, PART OF THE "GOESND" DUMP FILE
   2054 C     ("SUBSET" ADDED TO INPUT ARGUMENT LIST); GOES HI-RES REPORTS HAVE
   2055 C     UNKNOWN PATH AND GET PROPER STNID CHAR. 8 CHARACTER IDENTIFYING
   2056 C     THE SAT. NUMBER (IF STNID IS GENERATED HERE)
   2057 C 2001-08-20  D. A. KEYSER -- FOR QUIKSCAT, HEADER WORD 10 NOW RETURNS
   2058 C     NUMBER OF ORIGINAL REPORTS USED TO GENERATE SUPEROBS SINCE THIS
   2059 C     IS NOW AVAILABLE IN INPUT REPROCESSED QKSWND DUMP FILE (FOR
   2060 C     NON-SUPEROBS, HARDWIRED TO 1)
   2061 C 2002-03-05  D. A. KEYSER -- ACCOUNTS FOR CHANGES IN INPUT PROFLR
   2062 C     (WIND PROFILER BUFR DUMP FILE AFTER 5/2002: MNEMONIC "NPSM" IS NO
   2063 C     LONGER AVAILABLE; MNEMONIC "TPSE" REPLACES "TPMI" (AVG. TIME IN
   2064 C     MINUTES STILL OUTPUT) (WILL STILL WORK PROPERLY FOR INPUT PROFLR
   2065 C     DUMP FILES PRIOR TO 5/2002)
   2066 C 2002-07-03  D. A. KEYSER -- COMBINED INDIVIDUAL SUBROUTINES FOR
   2067 C     PROCESSING HEADER INFORMATION FOR ALL TYPES INTO THIS SINGLE NEW
   2068 C     SUBROUTINE SINCE ALL WERE VERY SIMILAR; ADDED PROCESSING OF GPS-
   2069 C     IPW REPORTS HERE NOW THAT THEY ARE PACKED IN AN NCEP BUFR FILE
   2070 C     (GPSIPW - RETURNED IN NEW CATEGORY 14)
   2071 C 2004-02-02  D. A. KEYSER -- ADDED COOPERATIVE AGENCY (002/011) AND
   2072 C     JAPANESE (002/013) WIND PROFILERS TO PROCESSING FOR WIND

Page 42          Source Listing                  UNPKB702
2017-04-18 11:09                                 w3unpkb7.f

   2073 C     PROFILERS NOT ORIGINATING FROM PILOT (PIBAL) BULLETINS; ADDED
   2074 C     PROCESSING OF NPN AND CAP RASS REPORTS HERE (002/012) NOW THAT
   2075 C     THEY ARE PACKED IN AN NCEP BUFR FILE (RASSDA - RETURNED IN NEW
   2076 C     DATA LEVEL CATEGORY 15)
   2077 C 2006-07-14  D. A. KEYSER (THIS FUNCTION IN PROGRAM BUFR_LISTDUMPS):
   2078 C 2007-09-14  D. A. KEYSER (THIS FUNCTION IN PROGRAM PREPOBS_PREPDATA):
   2079 C     MOVED REPORT-TYPE SPECIFIC VALUES OUT OF RETURNED HEADER IN
   2080 C     "RDATA" TO NEW "RDATA2" ARRAY (CLEANS UP HEADER PROCESSING)
   2081 C 2007-09-14  D. A. KEYSER (THIS FUNCTION IN PROGRAM BUFR_LISTDUMPS):
   2082 C 2007-09-14  D. A. KEYSER (THIS FUNCTION IN PROGRAM PREPOBS_PREPDATA):
   2083 C     HANDLES GOES 1x1 F-O-V SNDGS RADIANCES IN SUBSET "NC003003"
   2084 C 2008-09-25  D. A. KEYSER -- ADDED ASCAT SCATTEROMETER WINDS HERE NOW
   2085 C     THAT THEY ARE PACKED IN A NCEP BUFR FILE (GET DUMP REPORT TYPE
   2086 C     584)
   2087 C 2014-03-13  D. A. KEYSER -- MODIFIED TO HANDLE VAD WINDS FROM LEVEL
   2088 C     2 DECODER (SUBSET "NC002017") {IN ADDITION TO THOSE FROM RADAR
   2089 C     CODED MESSAGE (SUBSET "NC002008")}
   2090 C 2016-11-30  D. A. KEYSER --
   2091 C     Added new output real, double-precision argument array RDATA8_8 of
   2092 C     length 2 to return full-precision latitude and longitude for a
   2093 C     report.
   2094 C     BENEFIT: Although lat and lon are returned in RDATA(1:2) these are
   2095 C              at machine precison, which is normally R*4.  Now that
   2096 C              many reports in the dumps store lat/lon at 0.001 or even
   2097 C              0.00001 degree precision, and now that PREPBUFR encodes
   2098 C              YOB (lat) and XOB (lon) at 0.00001 degree precision, this
   2099 C              change will ensure that lat/lon is always accurate to
   2100 C              0.00001 degrees in all downstream processing.
   2101 C
   2102 C USAGE:    CALL UNPKB703(LUNIT,RDATA,RDATA8_8,STNID,SUBSET,ITP,IRET)
   2103 C   INPUT ARGUMENT LIST:
   2104 C     LUNIT    - FORTRAN UNIT NUMBER FOR INPUT DATA FILE
   2105 C     RDATA    - SINGLE REPORT IN A QUASI-IW3UNPBF UNPACKED FORMAT WITH
   2106 C              - ALL DATA INITIALIZED AS MISSING (NOTE: DOES NOT
   2107 C              - INCLUDE STATION ID)
   2108 C     RDATA8_8 - 2-WORD REAL*8 ARRAY CONTAINING ADDITIONAL REPORT DATA
   2109 C                (LATITUDE AND LONGITUDE) (SEE REMARKS 7 FOR CONTENT)
   2110 C     STNID    - CHARACTER*8 SINGLE REPORT STATION IDENTIFICATION (UP
   2111 C              - TO 8 CHARACTERS, LEFT-JUSTIFIED - HERE INITIALIZED AS
   2112 C              - EITHER BLANKS OR "????????")
   2113 C     SUBSET   - CHARACTER*8 BUFR MESSAGE TYPE (SAME FOR ALL REPORTS
   2114 C              - IN A COMMON BUFR MESSAGE)
   2115 C     ITP      - THE TYPE OF REPORT THAT HAS BEEN DECODED {=1 - NPN
   2116 C              - WIND PROFILER, =2 - CAP WIND PROFILER, =3 - JMA WIND
   2117 C              - PROFILER, =4 - GOES SNDG, =5 - NEXRAD (VAD) WIND FROM
   2118 C              - RADAR CODED MESSAGE; =6 - ERS SCATTEROMETER WIND, =7 -
   2119 C              - QUIKSCAT SCATTEROMETER WIND, =8 - GPS-IPW, =9 - NPN
   2120 C              - or CAP RASS, =10 - WINDSAT SCATTEROMETER WIND (NAVY OR
   2121 C              - NESDIS), =11 - ASCAT SCATTEROMETER WIND; =12 - NEXRAD
   2122 C              - (VAD) WIND FROM LEVEL 2 DECODER}
   2123 C
   2124 C   OUTPUT ARGUMENT LIST:
   2125 C     RDATA    - SINGLE REPORT IN A QUASI-IW3UNPBF UNPACKED FORMAT WITH
   2126 C              - HEADER INFORMATION FILLED IN (ALL OTHER DATA REMAINS
   2127 C              - MISSING) (NOTE: DOES NOT INCLUDE - STATION ID)
   2128 C     STNID    - CHARACTER*8 SINGLE REPORT STATION IDENTIFICATION (UP
   2129 C              - TO 8 CHARACTERS, LEFT-JUSTIFIED - HERE FILLED IN)

Page 43          Source Listing                  UNPKB702
2017-04-18 11:09                                 w3unpkb7.f

   2130 C     IRET     - RETURN CODE AS DESCRIBED IN W3UNPKB7 DOCBLOCK
   2131 C
   2132 C   OUTPUT FILES:
   2133 C     UNIT 06  - PRINTOUT
   2134 C
   2135 C REMARKS: CALLED BY SUBROUTINE W3UNPKB7.
   2136 C
   2137 C ATTRIBUTES:
   2138 C   LANGUAGE: FORTRAN 90
   2139 C   MACHINE:  NCEP WCOSS
   2140 C
   2141 C$$$
   2142       SUBROUTINE UNPKB703(LUNIT,RDATA,rdata8_8,STNID,SUBSET,ITP,IRET)
   2143 
   2144 C  Include parameters common to more than one subroutine
   2145 C  -----------------------------------------------------
   2146 
   2147       include 'inc_w3unpkb7.inc'
   2148 
   2214       CHARACTER*1  C8TAG(3,0:3)
   2215       CHARACTER*8  STNID,SID,SUBSET
   2216       character*20 sid_gnss
   2217       CHARACTER*60 HDRSTR
   2218       INTEGER  IDATA(IDMAX),KOUNTG(3,0:3),IRPTYP(12)
   2219       LOGICAL  SKIP_CAT12
   2220       REAL(8) HDR_8(12),RPID_8,VAR_8,BMISS,rdata8_8(2)
   2221       REAL  HDR(12),RDATA(*),RDATX(IDMAX)
   2222       COMMON /PKB7AA/BMISS
   2223       COMMON /PKB7BB/KDATE(8),LDATE(8),KTIMCH,IPRINT,SKIP_CAT12
   2224       COMMON /PKB7FF/IFOV(4,2),KNTSAT(250:260)
   2225  
   2226       SAVE
   2227  
   2228       EQUIVALENCE  (RDATX,IDATA),(RPID_8,SID)
   2229 
   2230       DATA  XMISS/99999./,YMISS/99999.8/,IRPTYP/71,75,76,61,72,581,582,
   2231      $ 74,77,583,584,72/
   2232       DATA  HDRSTR/
   2233      $ 'CLAT CLON SELV YEAR MNTH DAYS HOUR MINU SECO RCHR RCMI SAID '/
   2234       DATA  ITIMESG/0/,KOUNTG/12*0/,ITIMESS/0/,KOUNTS/0/
   2235 
   2236 C-----------------------------------------------------------------------
   2237 C     FOR GOES SOUNDING DATA ONLY:
   2238 C     CURRENT LIST OF  SATELLITE IDENTIFIERS (BUFR C.F. 0-01-007)
   2239 C     -----------------------------------------------------------
   2240 C
   2241 C       GOES  6 -- 250     GOES  9 -- 253     GOES 12 -- 256
   2242 C       GOES  7 -- 251     GOES 10 -- 254     GOES 13 -- 257
   2243 C       GOES  8 -- 252     GOES 11 -- 255     GOES 14 -- 258
   2244 C
   2245 C  IDSAT =       -- EVEN1 --   --- ODD1 --   -- EVEN2 --   --- ODD2 --
   2246 C   Sat. No. -   252,256,...   253,257,...   250,254,...   251,255,...
   2247 C  IRTYP =       CLR COR UNKN  CLR COR UNKN  CLR COR UNKN  CLR COR UNKN
   2248 C                --- --- ----  --- --- ----  --- --- ----  --- --- ----
   2249 C
   2250       DATA C8TAG/'I','J','K',  'L','M','N',  'O','P','S',  'Q','R','T' /
   2251 C-----------------------------------------------------------------------

Page 44          Source Listing                  UNPKB703
2017-04-18 11:09                                 w3unpkb7.f

   2252 
   2253       IF(ITP.EQ.4)  THEN
   2254          IF(ITIMESG.EQ.0)  THEN
   2255             KOUNTG = 0
   2256             ITIMESG = 1
   2257          END IF
   2258       ELSE IF(ITP.EQ.6.OR.ITP.EQ.7.OR.ITP.EQ.10.OR.ITP.EQ.11)  THEN
   2259          IF(ITIMESS.EQ.0)  THEN
   2260             KOUNTS = 0
   2261             ITIMESS = 1
   2262          END IF
   2263       END IF
   2264 
   2265       RDATX(1:IDMAX) = RDATA(1:IDMAX)
   2266       HDR_8 = BMISS
   2267       CALL UFBINT(LUNIT,HDR_8,12,1,NLEV,HDRSTR);HDR=HDR_8
   2268       IF(NLEV.NE.1)  GO TO 9999
   2269 
   2270 C-----------------------------------------
   2271 C Output header - Word 1 (Stored as Real)
   2272 C-----------------------------------------
   2273 
   2274 C  LATITUDE
   2275  
   2276       M = 1
   2277       N = 1
   2278       if(hdr_8(m).ge.bmiss)  then
   2279          call ufbint(lunit,HDR_8(m),12,1,nlev,'CLATH')
   2280          hdr(m) = hdr_8(m)
   2281       end if
   2282       IF(IPRINT.GT.1)  PRINT 199, hdr_8(M),M
   2283   199 FORMAT(5X,'HDR_8 HERE IS: ',F18.5,'; INDEX IS: ',I3)
   2284       IF(hdr_8(M).LT.bmiss)  THEN
   2285          RDATX(N) = HDR(M)
   2286          IF(IPRINT.GT.1)  PRINT 198, N,RDATX(N)
   2287   198 FORMAT(5X,'RDATA(',I5,') STORED AS: ',F10.2)
   2288          rdata8_8(1) = hdr_8(M)
   2289          if(iprint.gt.1)  print *, 'RDATA8_8(1) STORED AS: ',rdata8_8(1)
   2290       ELSE
   2291          IRET = 3
   2292          PRINT 102
   2293   102    FORMAT(' *** W3UNPKB7 ERROR: LAT MISSING'/)
   2294          RETURN
   2295       END IF
   2296 
   2297 C-----------------------------------------
   2298 C Output header - Word 2 (Stored as Real)
   2299 C-----------------------------------------
   2300 
   2301 C  LONGITUDE
   2302  
   2303       M = 2
   2304       N = 2
   2305       if(hdr_8(m).ge.bmiss)  then
   2306          call ufbint(lunit,HDR_8(m),12,1,nlev,'CLONH')
   2307          hdr(m) = hdr_8(m)
   2308       end if

Page 45          Source Listing                  UNPKB703
2017-04-18 11:09                                 w3unpkb7.f

   2309       IF(IPRINT.GT.1)  PRINT 199, hdr_8(M),M
   2310       IF(hdr_8(M).LT.bmiss)  THEN
   2311 
   2312 C Important: According to BUFR Manual, CLON (0-06-002) - represented
   2313 C  here by "HDR(M)" - should be in units of Degrees West - and East +
   2314 C  (-180.0 to +180.0); however some BUFR data sets (e.g., PREPBUFR) are
   2315 C  known to encode 0-06-002 in units of Degrees East (0.0 to 359.99) --
   2316 C  So we use the following conversion to work in either case ...
   2317          RDATX(N) = 360. - MOD(360.-HDR(M),360.)
   2318          IF(RDATX(N).EQ.360.0)  RDATX(N) = 0.0
   2319          IF(IPRINT.GT.1)  PRINT 198, N,RDATX(N)
   2320          rdata8_8(2) = hdr_8(M)
   2321          if(iprint.gt.1)  print *, 'RDATA8_8(2) STORED AS: ',rdata8_8(2)
   2322       ELSE
   2323          IRET = 3
   2324          PRINT 104
   2325   104    FORMAT(' *** W3UNPKB7 ERROR: LON MISSING'/)
   2326          RETURN
   2327       END IF
   2328  
   2329 C-------------------------------------------
   2330 C Output header - Word 6 (Stored as Integer)
   2331 C-------------------------------------------
   2332 
   2333 C  SATELLITE ID (GOES Soundings/Radiances, ERS Scatterometer,
   2334 C                QuikSCAT Scatterometer, WindSat Scatterometer,
   2335 C                ASCAT Scatterometer)
   2336 
   2337       M = 12
   2338       N = 6
   2339       IF(ITP.EQ.4.OR.ITP.EQ.6.OR.ITP.EQ.7.OR.ITP.EQ.10.OR.ITP.EQ.11)THEN
   2340          IF(IPRINT.GT.1)  PRINT 199, HDR(M),M
   2341          IF(ITP.EQ.4)  THEN
   2342             IDSAT = 2
   2343             IF(HDR(M).LT.XMISS)  THEN
   2344 cfix?       IF(HDR(M).LT.YMISS)  THEN
   2345                IDATA(N) = NINT(HDR(M))
   2346                IDSAT = MOD(IDATA(N),4)
   2347                IF(IDATA(N).GT.249.AND.IDATA(N).LT.260)  THEN
   2348                   KNTSAT(IDATA(N)) = KNTSAT(IDATA(N)) + 1
   2349                ELSE
   2350                   KNTSAT(260) = KNTSAT(260) + 1
   2351                END IF
   2352             END IF
   2353          ELSE
   2354             IF(HDR(M).LT.XMISS)  IDATA(N) = NINT(HDR(M))
   2355 cfix?       IF(HDR(M).LT.YMISS)  IDATA(N) = NINT(HDR(M))
   2356          END IF
   2357          IF(IPRINT.GT.1)  PRINT 197, N,IDATA(N)
   2358   197 FORMAT(5X,'IDATA(',I5,') STORED AS: ',I10)
   2359       END IF
   2360 
   2361 C-----------------------------------------
   2362 C Output header - Word 7 (Stored as Real)
   2363 C-----------------------------------------
   2364 
   2365 C  STATION ELEVATION

Page 46          Source Listing                  UNPKB703
2017-04-18 11:09                                 w3unpkb7.f

   2366 
   2367 C   GOES Soundings:                 Obtained from height of first 
   2368 C                                   (surface) level, stored later in
   2369 C                                   subroutine UNPKB707
   2370 C   ERS, QuikSCAT, WindSat or ASCAT
   2371 C                   Scatterometer:  Hardwired to 10 meters
   2372 C   All other types:                Obtained from reported station
   2373 C                                   height and stored here
   2374 
   2375       M = 3
   2376       N = 7
   2377       IF(ITP.EQ.6.OR.ITP.EQ.7.OR.ITP.EQ.10.OR.ITP.EQ.11)  THEN
   2378          RDATX(N)  = 10.
   2379          IF(IPRINT.GT.1)  PRINT 198, N,RDATX(N)
   2380       ELSE IF(ITP.NE.4)  THEN
   2381          IF(HDR(M).LT.XMISS)  RDATX(N) = NINT(HDR(M))
   2382 cfix?    IF(HDR(M).LT.YMISS)  RDATX(N) = NINT(HDR(M))
   2383          IF(IPRINT.GT.1)  PRINT 199, HDR(M),M
   2384          IF(IPRINT.GT.1)  PRINT 198, N,RDATX(N)
   2385       END IF
   2386 
   2387 C--------------------------------------------
   2388 C Output header - Word 8 (Stored as Integer)
   2389 C--------------------------------------------
   2390 
   2391 C  INSTRUMENT TYPE
   2392 
   2393 C  GOES Soundings:         RETRIEVAL TYPE (GEOSTATIONARY SATELLITE
   2394 C                          DATA-PROCESSING TECHNIQUE USED)
   2395  
   2396       M = 13
   2397       N = 8
   2398       IF(ITP.EQ.4)  THEN
   2399          CALL UFBINT(LUNIT,VAR_8,1,1,NLEV,'GSDP')
   2400          VAR = VAR_8
   2401          IF(NLEV.GT.1)  GO TO 9999
   2402          IF(VAR.LT.XMISS)  IDATA(N) = NINT(VAR)
   2403 cfix?    IF(VAR.LT.YMISS)  IDATA(N) = NINT(VAR)
   2404          IF(IPRINT.GT.1)  PRINT 199, VAR,M
   2405          IF(IPRINT.GT.1)  PRINT 197, N,IDATA(N)
   2406       END IF
   2407 
   2408 C-------------------------------------------
   2409 C Output header - Word 9 (Stored as Integer)
   2410 C-------------------------------------------
   2411 
   2412 C  REPORT TYPE
   2413  
   2414       N = 9
   2415       IDATA(N)  = IRPTYP(ITP)
   2416       IF(IPRINT.GT.1)  PRINT 197, N,IDATA(N)
   2417  
   2418 C-------------------------------------------------
   2419 C Output argument - "STNID" (Stored as Character)
   2420 C-------------------------------------------------
   2421 
   2422 C  STATION IDENTIFICATION

Page 47          Source Listing                  UNPKB703
2017-04-18 11:09                                 w3unpkb7.f

   2423 
   2424       M = 14
   2425       if(subset.eq.'NC012004') then
   2426 C.......................................................................
   2427 C  GPS Integrated Precipitable Water from new "GNSS" BUFR feed:
   2428 C.......................................................................
   2429          call readlc(lunit,sid_gnss,'STSN')
   2430          if(sid_gnss.eq.'                    ')  nlev = 0
   2431          if(nlev.eq.0)  go to 9999
   2432          sid = sid_gnss(1:4)//sid_gnss(6:9)
   2433          if(iprint.gt.1)  print 299, sid,m
   2434 C    STNID is stored directly from STSN(1:4)//STSN(6:9)
   2435          stnid = sid
   2436       else
   2437 
   2438       CALL UFBINT(LUNIT,RPID_8,1,1,NLEV,'RPID ')
   2439 
   2440 cpppppppppp
   2441 cc    print'(" rpid_8,icbfms(sid,8): ",G0,1X,I0)', rpid_8,icbfms(sid,8)
   2442 cpppppppppp
   2443       IF(ICBFMS(SID,8).NE.0) NLEV = 0
   2444 C above line not working right - may return 0 when missing, so use next
   2445 C  two lines below temporarily until this is fixed (readlc will return
   2446 C  all blanks for sid when mnemonic "RPID" not found) - dak 2/19/13
   2447          call readlc(lunit,sid,'RPID')
   2448 cpppppppppp
   2449 cc    print'(" sid = ",A)', sid
   2450 cpppppppppp
   2451          if(sid.eq.'        ')  nlev = 0
   2452 
   2453       IF(ITP.LE.3)  THEN
   2454 
   2455 C.......................................................................
   2456 C  Wind Profiler:
   2457 C.......................................................................
   2458 
   2459          IF(NLEV.EQ.1)  THEN
   2460 C. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .
   2461 C            If decoded RPID is not missing set STNID to it
   2462 C   (test on "NLEV" for missing "RPID" - valid RPID_8 can be > BMISS!)
   2463 C. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .
   2464             IF(IPRINT.GT.1)  PRINT 299, SID,M
   2465   299 FORMAT(5X,'RPID HERE IS: ',9X,A8,'; INDEX IS: ',I3)
   2466             IF(IPRINT.GT.1)  PRINT 2198
   2467  2198 FORMAT(5X,'STN. ID PRESENT IN INPUT FILE, DO NOT GENERATE HERE')
   2468             STNID = SID
   2469          ELSE
   2470 C. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .
   2471 C       If decoded RPID is missing then generate STNID from
   2472 C                   decoded WMO block/stn numbers
   2473 C. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .
   2474             IF(IPRINT.GT.1)  PRINT 2188
   2475  2188 FORMAT(5X,'STN. ID NOT PRESENT IN INPUT FILE, USE WMO BLOCK/',
   2476      $ 'STATION NUMBER TO GENERATE IT HERE'/)
   2477             CALL UFBINT(LUNIT,VAR_8,1,1,NLEV,'WMOB') ! Block Number
   2478             VAR = VAR_8
   2479             IF(NLEV.GT.1)  GO TO 9999

Page 48          Source Listing                  UNPKB703
2017-04-18 11:09                                 w3unpkb7.f

   2480             IF(IPRINT.GT.1)  PRINT 199, VAR,M
   2481             IF(VAR.LT.XMISS)  WRITE(STNID(1:2),'(I2.2)') NINT(VAR)
   2482 cfix?       IF(VAR.LT.YMISS)  WRITE(STNID(1:2),'(I2.2)') NINT(VAR)
   2483             CALL UFBINT(LUNIT,VAR_8,1,1,NLEV,'WMOS') ! Station Number
   2484             VAR = VAR_8
   2485             IF(NLEV.GT.1)  GO TO 9999
   2486             IF(IPRINT.GT.1)  PRINT 199, VAR,M
   2487             IF(VAR.LT.XMISS)  WRITE(STNID(3:5),'(I3.3)') NINT(VAR)
   2488 cfix?       IF(VAR.LT.YMISS)  WRITE(STNID(3:5),'(I3.3)') NINT(VAR)
   2489          END IF
   2490 
   2491       ELSE IF(ITP.EQ.5 .OR. ITP.EQ.12)  THEN
   2492 
   2493 C.......................................................................
   2494 C  NEXRAD (VAD) Wind:
   2495 C.......................................................................
   2496 
   2497          IF(NLEV.NE.1)  GO TO 9999
   2498          IF(IPRINT.GT.1)  PRINT 299, SID,M
   2499          IF(ITP.EQ.5 .AND. SID(5:7).EQ.'   ')  THEN
   2500 C. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .
   2501 C   RCM VAD Winds Before 02/18/1999 -->
   2502 C    Decoded RPID contains only the 4-character Product Source ID
   2503 C    STNID is stored as:
   2504 C               '99'//last 3-characters of Product Source ID//'   '
   2505 C. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .
   2506             STNID = '99'//SID(2:4)//'   '
   2507          ELSE
   2508 C. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .
   2509 C   After  02/18/1999 -->
   2510 C    STNID is stored directly from RPID as:
   2511 C        RCM VAD: 4-character Product Source ID//3-character RCM ID//' '
   2512 C        NEW VAD: 4-character Product Source ID//'    '
   2513 C. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .
   2514             STNID = SID
   2515          END IF
   2516       ELSE IF(ITP.EQ.4)  THEN
   2517 
   2518 C.......................................................................
   2519 C  GOES Soundings:
   2520 C.......................................................................
   2521 
   2522          IF(NLEV.NE.1.OR.(SID(8:8).LT.'A'.OR.SID(8:8).GT.'Z'))  THEN
   2523 C. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .
   2524 C  If decoded RPID is missing or if the eighth character of RPID is not
   2525 C             "A"-"Z", then this subr. must generate STNID
   2526 C       (indicates an input data dump file prior to Dec. 2000)
   2527 C   (test on "NLEV" for missing "RPID" - valid RPID_8 can be > BMISS!)
   2528 C
   2529 C         STNID Generated as Follows:
   2530 C          Characters 1-7 obtained from 7-digit count number (specific
   2531 C            to Satellite ID/Retrieval Type)
   2532 C            (For SFOV retrievals, character 1 replaced with "H")
   2533 C          Character 8 obtained from Satellite ID/Retrieval Type Tag
   2534 C. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .
   2535             IRTYP = 3      ! Unknown retrieval type (default)
   2536             IF(IDATA(8).EQ.21)  THEN

Page 49          Source Listing                  UNPKB703
2017-04-18 11:09                                 w3unpkb7.f

   2537                IRTYP = 1   ! Clear retrieval type
   2538             ELSE  IF(IDATA(8).EQ.23)  THEN
   2539                IRTYP = 2   ! Cloudy retrieval type
   2540             END IF
   2541             IF(IPRINT.GT.1)  PRINT 2197, IDSAT,IRTYP
   2542  2197 FORMAT(5X,'STN. ID NOT PRESENT IN INPUT FILE, MUST GENERATE HERE'/
   2543      $       5X,'IDSAT IS: ',I10,', IRTYP IS: ',I10)
   2544             STNID(8:8) = C8TAG(IRTYP,IDSAT)
   2545             KOUNTG(IRTYP,IDSAT) = MIN(KOUNTG(IRTYP,IDSAT)+1,9999999)
   2546             WRITE(STNID(1:7),'(I7.7)')  KOUNTG(IRTYP,IDSAT)
   2547             IF(SUBSET.EQ.'NC003002' .or. SUBSET.EQ.'NC003003')
   2548      $       STNID(1:1) = 'H'
   2549          ELSE
   2550 C. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .
   2551 C     If decoded RPID is NOT missing AND if the eighth character of
   2552 C    RPID is "A"-"Z", then the dump program BUFR_DUPSAT has already
   2553 C   created the proper Station ID in RPID - generate STNID from RPID
   2554 C         (indicates an input data dump file after Dec. 2000)
   2555 C. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .
   2556             IF(IPRINT.GT.1)  PRINT 2198
   2557             STNID = SID
   2558          END IF
   2559       ELSE IF(ITP.EQ.6.OR.ITP.EQ.7.OR.ITP.EQ.10.OR.ITP.EQ.11)  THEN
   2560 
   2561 C.......................................................................
   2562 C  ERS, QuikSCAT, WindSat or ASCAT Scatterometer:
   2563 C.......................................................................
   2564 
   2565          IF(NLEV.NE.1.OR.(SID(8:8).LT.'A'.OR.SID(8:8).GT.'Z'))  THEN
   2566 C. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .
   2567 C  If decoded RPID is missing or if the eighth character of RPID is not
   2568 C             "A"-"Z", then this subr. must generate STNID
   2569 C   (indicates an input reprocessed data dump file prior to Dec. 2000)
   2570 C   (test on "NLEV" for missing "RPID" - valid RPID_8 can be > BMISS!)
   2571 C
   2572 C         STNID Generated as Follows:
   2573 C          Characters 1-7 obtained from 7-digit count number
   2574 C          Character 8 is "E" for ERS, "Q" for QuikSCAT, "W" for
   2575 C           WindSat or "A" for ASCAT
   2576 C            (Note: Reprocessed QuikSCAT data dumps never contained
   2577 C                   SUPERobs and reports were always from Satellite ID
   2578 C                   281 prior to Dec. 2000 - this means 2'nd character
   2579 C                   was never "S" and 8'th character was always "Q")
   2580 C. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .
   2581             IF(IPRINT.GT.1)  PRINT 2197
   2582             IF(ITP.EQ.6)  THEN
   2583                STNID(8:8) = 'E'
   2584             ELSE IF(ITP.EQ.7)  THEN
   2585                STNID(8:8) = 'Q'
   2586             ELSE IF(ITP.EQ.10)  THEN
   2587                STNID(8:8) = 'W'
   2588             ELSE IF(ITP.EQ.11)  THEN
   2589                STNID(8:8) = 'A'
   2590             END IF
   2591             KOUNTS = MIN(KOUNTS+1,9999999)
   2592             WRITE(STNID(1:7),'(I7.7)')  KOUNTS
   2593          ELSE

Page 50          Source Listing                  UNPKB703
2017-04-18 11:09                                 w3unpkb7.f

   2594 C. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .
   2595 C     If decoded RPID is NOT missing AND if the eighth character of
   2596 C     RPID is "A"-"Z", then the dump program WAVE_DATASORT (ERS),
   2597 C      WAVE_DCODQUIKSCAT (QuikSCAT, ASCAT) or BUFR_DCODWINDSAT
   2598 C      (WindSat) has already created the proper Station ID in RPID -
   2599 C      generate STNID from RPID (indicates an input reprocessed dump
   2600 C      file after Dec. 2000)
   2601 C. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .
   2602             IF(IPRINT.GT.1)  PRINT 2198
   2603             STNID = SID
   2604          END IF
   2605       ELSE IF(ITP.EQ.8.OR.ITP.EQ.9)  THEN
   2606 
   2607 C.......................................................................
   2608 C  GPS Integrated Precipitable Water or RASS:
   2609 C.......................................................................
   2610 
   2611          IF(NLEV.NE.1)  GO TO 9999
   2612          IF(IPRINT.GT.1)  PRINT 299, SID,M
   2613 C    STNID is stored directly from RPID
   2614          STNID = SID
   2615 C.......................................................................
   2616       END IF
   2617       end if
   2618       IF(IPRINT.GT.1)  PRINT 196, STNID
   2619   196 FORMAT(5X,'STNID STORED IN CHARACTER AS: "',A8,'"')
   2620  
   2621 C---------------------------------------------
   2622 C Output header - Word  4 (Stored as Real)
   2623 C  OBSERVATION TIME
   2624 C Output header - Word  5 (Stored as Integer)
   2625 C  DATE (STORED IN FORM YYYYMMDDHH)
   2626 C---------------------------------------------
   2627  
   2628       M = 4
   2629       IF(IPRINT.GT.1)  PRINT 199, HDR(M),M
   2630       M = 5
   2631       IF(IPRINT.GT.1)  PRINT 199, HDR(M),M
   2632       M = 6
   2633       IF(IPRINT.GT.1)  PRINT 199, HDR(M),M
   2634       M = 7
   2635       IF(IPRINT.GT.1)  PRINT 199, HDR(M),M
   2636       M = 8
   2637       IF(IPRINT.GT.1)  PRINT 199, HDR(M),M
   2638       M = 9
   2639       IF(IPRINT.GT.1)  PRINT 199, HDR(M),M
   2640       IF(HDR(9).GE.XMISS)  HDR(9) = 0.
   2641       IF(MIN(HDR(4),HDR(5),HDR(6),HDR(7),HDR(8)).GE.XMISS)  GO TO 30
   2642 cfix? IF(HDR(9).GE.YMISS)  HDR(9) = 0.
   2643 cfix? IF(MIN(HDR(4),HDR(5),HDR(6),HDR(7),HDR(8)).GE.YMISS)  GO TO 30
   2644       N = 4
   2645       RDATX(N) = (HDR(7) + ((HDR(8) * 60.) + HDR(9))/3600.)
   2646 cdak $ + 0.0001 ! don't make this adjustment now that we store obs time
   2647                 ! to 10**5 in PREPBUFR
   2648       IF(IPRINT.GT.1)  PRINT 198, N,RDATX(N)
   2649       N = 5
   2650       IDATA(N) = (NINT(HDR(4)) * 1000000) + (NINT(HDR(5)) * 10000) +

Page 51          Source Listing                  UNPKB703
2017-04-18 11:09                                 w3unpkb7.f

   2651      $ (NINT(HDR(6)) * 100) + NINT(HDR(7))
   2652       IF(IPRINT.GT.1)  PRINT 197, N,IDATA(5)
   2653 
   2654 C---------------------------------------------
   2655 C Output header - Word  11 (Stored as Real)
   2656 C  RECEIPT TIME
   2657 C---------------------------------------------
   2658 
   2659       M = 10
   2660       IF(IPRINT.GT.1)  PRINT 199, HDR(M),M
   2661       M = 11
   2662       IF(IPRINT.GT.1)  PRINT 199, HDR(M),M
   2663       IF(MAX(HDR(10),HDR(11)).LT.XMISS)  THEN
   2664          N = 11
   2665          RDATX(N) = (HDR(10) + ((HDR(11) * 60.))/3600.) + 0.0001
   2666          IF(IPRINT.GT.1)  PRINT 198, N,RDATX(N)
   2667       END IF
   2668 
   2669       RDATA(1:IDMAX) = RDATX(1:IDMAX)
   2670 
   2671       RETURN
   2672 
   2673 C-----------------------------------------------------------------------
   2674    30 CONTINUE
   2675 C PROBLEM: SOME OR ALL DATE INFORMATION IS MISSING --
   2676 C  SET IRET = 4 AND RETURN
   2677       PRINT 317
   2678   317 FORMAT(/'##W3UNPKB7: SOME OR ALL DATE INFORMATION IS MISSING - ',
   2679      $ 'IRET = 4'/)
   2680       IRET = 4
   2681       RETURN
   2682 C-----------------------------------------------------------------------
   2683  9999 CONTINUE
   2684 C PROBLEM: THE NUMBER OF DECODED "LEVELS" IS NOT WHAT IS EXPECTED --
   2685 C  SET IRET = 6 AND RETURN
   2686       PRINT 217, NLEV
   2687   217 FORMAT(/'##W3UNPKB7: THE NUMBER OF DECODED "LEVELS" (=',I5,') ',
   2688      $ 'IS NOT WHAT IS EXPECTED (1) - IRET = 6'/)
   2689       IRET = 6
   2690       RETURN
   2691 C-----------------------------------------------------------------------
   2692 
   2693       END

Page 52          Source Listing                  UNPKB703
2017-04-18 11:09 Entry Points                    w3unpkb7.f



ENTRY POINTS

  Name                 
                       
 unpkb703_             


SYMBOL CROSS REFERENCE

 Name                       Object Declared Type            Bytes Dimen Elements Attributes       References                        
                                                                                                                                    
 102                        Label  2098                                                           2097                              
 104                        Label  2130                                                           2129                              
 196                        Label  2424                                                           2423                              
 197                        Label  2163                                                           2162,2210,2221,2457               
 198                        Label  2092                                                           2091,2124,2184,2189,2453,2471     
 199                        Label  2088                                                           2087,2114,2145,2188,2209,2285,2291
                                                                                                  ,2434,2436,2438,2440,2442,2444,246
                                                                                                  5,2467                            
 217                        Label  2492                                                           2491                              
 2188                       Label  2280                                                           2279                              
 2197                       Label  2347                                                           2346,2386                         
 2198                       Label  2272                                                           2271,2361,2407                    
 299                        Label  2270                                                           2238,2269,2303,2417               
 30                         Label  2479                                                           2446                              
 317                        Label  2483                                                           2482                              
 9999                       Label  2488                                                           2073,2206,2236,2284,2290,2302,2416
 BMISS                      Scalar 2025     R(8)            8           scalar   COM              2071,2083,2089,2110,2115          
 C8TAG                      Local  2019     CHAR            1     2     12       SAVE             2055,2349                         
 HDR                        Local  2026     R(4)            4     1     12       SAVE             2072,2085,2090,2112,2122,2145,2148
                                                                                                  ,2150,2159,2186,2188,2434,2436,243
                                                                                                  8,2440,2442,2444,2445,2446,2450,24
                                                                                                  55,2456,2465,2467,2468,2470       
 HDRSTR                     Local  2022     CHAR            60          scalar   SAVE             2037,2072                         
 HDR_8                      Local  2025     R(8)            8     1     12       SAVE             2071,2072,2083,2084,2085,2087,2089
                                                                                                  ,2093,2110,2111,2112,2114,2115,212
                                                                                                  5                                 
 ICBFMS                     Func   2248     I(4)            4           scalar                    2248                              
 IDATA                      Local  2023     I(4)            4     1     2270     SAVE             2150,2151,2152,2153,2159,2162,2207
                                                                                                  ,2210,2220,2221,2341,2343,2455,245
                                                                                                  7                                 
 IDATS                      Param  40       I(4)            4           scalar                    43,46,49,52,56,59                 
 IDMAX                      Param  63       I(4)            4           scalar                    2023,2026,2070,2474               
 IDMAX_GOES                 Param  52       I(4)            4           scalar                    63                                
 IDMAX_GPS                  Param  56       I(4)            4           scalar                    64                                
 IDMAX_PROF                 Param  46       I(4)            4           scalar                    63                                
 IDMAX_RASS                 Param  59       I(4)            4           scalar                    64                                
 IDMAX_SCAT                 Param  49       I(4)            4           scalar                    63                                
 IDMAX_VAD                  Param  43       I(4)            4           scalar                    63                                
 IDSAT                      Local  2147     I(4)            4           scalar   SAVE             2147,2151,2346,2349,2350,2351     
 IFOV                       Scalar 2029     I(4)            4     2     8        COM                                                
 ILVLMX_04                  Param  15       I(4)            4           scalar                    43                                
 ILVLMX_08                  Param  8        I(4)            4           scalar                    52                                
 ILVLMX_11                  Param  19       I(4)            4           scalar                    46                                
 ILVLMX_12                  Param  22       I(4)            4           scalar                    52                                

Page 53          Source Listing                  UNPKB703
2017-04-18 11:09 Symbol Table                    w3unpkb7.f

 Name                       Object Declared Type            Bytes Dimen Elements Attributes       References                        
                                                                                                                                    
 ILVLMX_13                  Param  25       I(4)            4           scalar                    53                                
 ILVLMX_15                  Param  29       I(4)            4           scalar                    59                                
 ILVL_10                    Param  34       I(4)            4           scalar                    46,49                             
 ILVL_14                    Param  37       I(4)            4           scalar                    56                                
 IPRINT                     Scalar 2028     I(4)            4           scalar   COM              2087,2091,2094,2114,2124,2126,2145
                                                                                                  ,2162,2184,2188,2189,2209,2210,222
                                                                                                  1,2238,2269,2271,2279,2285,2291,23
                                                                                                  03,2346,2361,2386,2407,2417,2423,2
                                                                                                  434,2436,2438,2440,2442,2444,2453,
                                                                                                  2457,2465,2467,2471               
 IRET                       Dummy  2012     I(4)            4           scalar   ARG,INOUT        2096,2128,2485,2494               
 IRPTYP                     Local  2023     I(4)            4     1     12       SAVE             2035,2220                         
 IRTYP                      Local  2340     I(4)            4           scalar   SAVE             2340,2342,2344,2346,2349,2350,2351
 ITIMESG                    Local  2039     I(4)            4           scalar   SAVE             2039,2059,2061                    
 ITIMESS                    Local  2039     I(4)            4           scalar   SAVE             2039,2064,2066                    
 ITP                        Dummy  2012     I(4)            4           scalar   ARG,INOUT        2058,2063,2144,2146,2182,2185,2203
                                                                                                  ,2220,2258,2296,2304,2321,2364,238
                                                                                                  7,2389,2391,2393,2410             
 KDATE                      Scalar 2028     I(4)            4     1     8        COM                                                
 KNTSAT                     Scalar 2029     I(4)            4     1     11       COM              2153,2155                         
 KOUNTG                     Local  2023     I(4)            4     2     12       SAVE             2039,2060,2350,2351               
 KOUNTS                     Local  2039     I(4)            4           scalar   SAVE             2039,2065,2396,2397               
 KTIMCH                     Scalar 2028     I(4)            4           scalar   COM                                                
 LDATE                      Scalar 2028     I(4)            4     1     8        COM                                                
 LUNIT                      Dummy  2012     I(4)            4           scalar   ARG,INOUT        2072,2084,2111,2204,2234,2243,2252
                                                                                                  ,2282,2288                        
 M                          Local  2081     I(4)            4           scalar   SAVE             2081,2083,2084,2085,2087,2089,2090
                                                                                                  ,2093,2108,2110,2111,2112,2114,211
                                                                                                  5,2122,2125,2142,2145,2148,2150,21
                                                                                                  59,2180,2186,2188,2201,2209,2229,2
                                                                                                  238,2269,2285,2291,2303,2417,2433,
                                                                                                  2434,2435,2436,2437,2438,2439,2440
                                                                                                  ,2441,2442,2443,2444,2464,2465,246
                                                                                                  6,2467                            
 MAX                        Func   63                                   scalar                    63,2468                           
 MIN                        Func   2350                                 scalar                    2350,2396,2446                    
 MOD                        Func   2122                                 scalar                    2122,2151                         
 N                          Local  2082     I(4)            4           scalar   SAVE             2082,2090,2091,2109,2122,2123,2124
                                                                                                  ,2143,2150,2151,2152,2153,2159,216
                                                                                                  2,2181,2183,2184,2186,2189,2202,22
                                                                                                  07,2210,2219,2220,2221,2449,2450,2
                                                                                                  453,2454,2455,2457,2469,2470,2471 
 NINT                       Func   2150                                 scalar                    2150,2159,2186,2207,2286,2292,2455
                                                                                                  ,2456                             
 NLEV                       Local  2072     I(4)            4           scalar   SAVE             2072,2073,2084,2111,2204,2206,2235
                                                                                                  ,2236,2243,2248,2256,2264,2282,228
                                                                                                  4,2288,2290,2302,2327,2370,2416,24
                                                                                                  91                                
 PKB7AA                     Common 2027                                 8        SAVE                                               
 PKB7BB                     Common 2028                                 76       SAVE                                               
 PKB7FF                     Common 2029                                 76       SAVE                                               
 RDATA                      Dummy  2012     R(4)            4     1     0        ARG,INOUT        2070,2474                         
 RDATA8_8                   Dummy  2012     R(8)            8     1     2        ARG,INOUT        2093,2094,2125,2126               
 RDATX                      Local  2026     R(4)            4     1     2270     SAVE             2070,2090,2091,2122,2123,2124,2183
                                                                                                  ,2184,2186,2189,2450,2453,2470,247

Page 54          Source Listing                  UNPKB703
2017-04-18 11:09 Symbol Table                    w3unpkb7.f

 Name                       Object Declared Type            Bytes Dimen Elements Attributes       References                        
                                                                                                                                    
                                                                                                  1,2474                            
 READLC                     Subr   2234                                                           2234,2252                         
 RPID_8                     Local  2025     R(8)            8           scalar   SAVE             2243                              
 SID                        Local  2020     CHAR            8           scalar   SAVE             2237,2238,2240,2248,2252,2256,2269
                                                                                                  ,2273,2303,2304,2311,2319,2327,236
                                                                                                  2,2370,2408,2417,2419             
 SID_GNSS                   Local  2021     CHAR            20          scalar   SAVE             2234,2235,2237                    
 SKIP_CAT12                 Scalar 2024     L(4)            4           scalar   COM                                                
 STNID                      Dummy  2012     CHAR            8           scalar   ARG,INOUT        2240,2273,2286,2292,2311,2319,2349
                                                                                                  ,2351,2353,2362,2388,2390,2392,239
                                                                                                  4,2397,2408,2419,2423             
 SUBSET                     Dummy  2012     CHAR            8           scalar   ARG,INOUT        2230,2352                         
 UFBINT                     Subr   2072                                                           2072,2084,2111,2204,2243,2282,2288
 UNPKB703                   Subr   2012                                                                                             
 VAR                        Local  2205     R(4)            4           scalar   SAVE             2205,2207,2209,2283,2285,2286,2289
                                                                                                  ,2291,2292                        
 VAR_8                      Local  2025     R(8)            8           scalar   SAVE             2204,2205,2282,2283,2288,2289     
 XMISS                      Local  2035     R(4)            4           scalar   SAVE             2035,2148,2159,2186,2207,2286,2292
                                                                                                  ,2445,2446,2468                   
 YMISS                      Local  2035     R(4)            4           scalar   SAVE             2035                              

Page 55          Source Listing                  UNPKB703
2017-04-18 11:09                                 w3unpkb7.f

   2694 
   2695 C$$$  SUBPROGRAM DOCUMENTATION BLOCK
   2696 C
   2697 C SUBPROGRAM:    UNPKB704
   2698 C   PRGMMR: D. A. KEYSER     ORG: NP22       DATE: 2008-09-25
   2699 C
   2700 C ABSTRACT: FOR REPORT (SUBSET) READ OUT OF BUFR MESSAGE (PASSED IN
   2701 C   INTERNALLY VIA BUFRLIB STORAGE), CALLS BUFRLIB ROUTINE TO DECODE
   2702 C   SURFACE DATA FOR WIND PROFILER REPORTS NOT ORIGINATING FROM PILOT
   2703 C   (PIBAL) FORMAT BULLETINS, AND 10 METER DATA FOR ERS SCATTEROMETER,
   2704 C   QUIKSCAT SCATTEROMETER, WINDSAT (NAVY OR NESDIS) SCATTEROMETER OR
   2705 C   ASCAT SCATTEROMETER WIND REPORTS.  SURFACE DATA ARE THEN FILLED
   2706 C   INTO THE OUTPUT ARRAY AS DATA LEVEL CATEGORY 10.  THE OUTPUT ARRAY
   2707 C   HOLDS A SINGLE WIND PROFILER, ERS SCATTEROMETER, QUIKSCAT
   2708 C   SCATTEROMETER, WINDSAT SCATTEROMETER OR ASCAT SCATTEROMETER REPORT
   2709 C   IN THE QUASI-IW3UNPBF UNPACKED FORMAT.
   2710 C
   2711 C PROGRAM HISTORY LOG:
   2712 C 1996-12-16  D. A. KEYSER NP22 - ORIGINAL AUTHOR (WIND PROFILER ONLY)
   2713 C 1999-02-12  D. A. KEYSER -- ADDED ERS SCATTEROMETER WINDS HERE NOW
   2714 C     THAT THEY ARE PACKED IN A NCEP BUFR FILE
   2715 C 2000-09-22  D. A. KEYSER -- CORRECTED VALUE FOR RETURNED RAINFALL;
   2716 C     ADDED QUIKSCAT SCATTEROMETER WINDS HERE NOW THAT THEY ARE PACKED
   2717 C     IN A NCEP BUFR FILE
   2718 C 2002-03-05  D. A. KEYSER -- ACCOUNTS FOR CHANGES IN INPUT PROFLR
   2719 C     (WIND PROFILER BUFR DUMP FILE AFTER 5/2002: SURFACE DATA NOW ALL
   2720 C     MISSING (MNEMONICS "PMSL","WDIR1","WSPD1", "TMDB", "REHU", "REQV"
   2721 C     NO LONGER AVAILABLE) (WILL STILL WORK PROPERLY FOR INPUT PROFLR
   2722 C     DUMP FILES PRIOR TO 5/2002)
   2723 C 2006-07-14  D. A. KEYSER (THIS FUNCTION IN PROGRAM BUFR_LISTDUMPS):
   2724 C 2007-09-14  D. A. KEYSER (THIS FUNCTION IN PROGRAM PREPOBS_PREPDATA):
   2725 C     ADDED WINDSAT SCATTEROMETER WINDS HERE NOW THAT THEY ARE PACKED
   2726 C     IN A NCEP BUFR FILE; RAINFALL RATE NOW RETURNED IN ORIGINAL BUFR
   2727 C     UNITS OF KG/((M**2)*SEC) INSTEAD OF MM/HOUR (WINDSAT IS ONLY TYPE
   2728 C     TO RETURN THIS)
   2729 C 2008-09-25  D. A. KEYSER -- ADDED ASCAT SCATTEROMETER WINDS HERE NOW
   2730 C     THAT THEY ARE PACKED IN A NCEP BUFR FILE
   2731 C
   2732 C USAGE:    CALL UNPKB704(LUNIT,RDATA,ITP,IRET)
   2733 C   INPUT ARGUMENT LIST:
   2734 C     LUNIT    - FORTRAN UNIT NUMBER FOR INPUT DATA FILE
   2735 C     RDATA    - SINGLE WIND PROFILER, ERS SCATTEROMETER, QUIKSCAT
   2736 C              - SCATTEROMETER, WINDSAT SCATTEROMETER OR ASCAT
   2737 C              - SCATTEROMETER REPORT IN A QUASI-IW3UNPBF UNPACKED
   2738 C              - FORMAT WITH ONLY HEADER INFORMATION FILLED IN (ALL
   2739 C              - OTHER DATA REMAINS MISSING)
   2740 C     ITP      - THE TYPE OF REPORT THAT HAS BEEN DECODED {=1 - NPN
   2741 C              - WIND PROFILER, =2 - CAP WIND PROFILER, =3 - JMA WIND
   2742 C              - PROFILER, =6 - ERS SCATTEROMETER WIND, =7 - QUIKSCAT
   2743 C              - SCATTEROMETER WIND, =10 - WINDSAT SCATTEROMETER WIND
   2744 C              - (NAVY OR NESDIS), =11 - ASCAT SCATTEROMETER WIND}
   2745 C
   2746 C   OUTPUT ARGUMENT LIST:
   2747 C     RDATA    - SINGLE WIND PROFILER, ERS SCATTEROMETER, QUIKSCAT
   2748 C              - SCATTEROMETER, WINDSAT SCATTEROMETER OR ASCAT
   2749 C              - SCATTEROMETER REPORT IN A QUASI-IW3UNPBF UNPACKED
   2750 C              - FORMAT WITH SURFACE INFORMATION FILLED IN (AS WELL AS

Page 56          Source Listing                  UNPKB703
2017-04-18 11:09                                 w3unpkb7.f

   2751 C              - HEADER INFORMATION)
   2752 C     IRET     - RETURN CODE AS DESCRIBED IN W3UNPKB7 DOCBLOCK
   2753 C
   2754 C   OUTPUT FILES:
   2755 C     UNIT 06  - PRINTOUT
   2756 C
   2757 C REMARKS: CALLED BY SUBROUTINE W3UNPKB7.
   2758 C
   2759 C ATTRIBUTES:
   2760 C   LANGUAGE: FORTRAN 90
   2761 C   MACHINE:  NCEP WCOSS
   2762 C
   2763 C$$$
   2764       SUBROUTINE UNPKB704(LUNIT,RDATA,ITP,IRET)
   2765 
   2766 C  Include parameters common to more than one subroutine
   2767 C  -----------------------------------------------------
   2768 
   2769       include 'inc_w3unpkb7.inc'
   2770 
   2836       CHARACTER*40  SRFCP,SRFCS
   2837       INTEGER  IDATA(IDMAX)
   2838       REAL(8) SFC_8(8),BMISS
   2839       REAL  SFC(8),RDATA(*),RDATX(IDMAX)
   2840       LOGICAL  SKIP_CAT12
   2841       COMMON /PKB7AA/BMISS
   2842       COMMON /PKB7BB/kdate(8),ldate(8),KTIMCH,IPRINT,SKIP_CAT12
   2843       COMMON /PKB7GG/IDATS_04,IDATS_08,IDATS_10,IDATS_11,IDATS_12,
   2844      $ IDATS_13,IDATS_14,IDATS_15
   2845  
   2846       SAVE
   2847  
   2848       EQUIVALENCE (RDATX,IDATA)
   2849       DATA  XMISS/99999./
   2850       DATA  SRFCP/'PMSL WDIR1 WSPD1 TMDB REHU REQV         '/
   2851       DATA  SRFCS/'PMSL WD10  WS10  TMDB REHU REQV         '/
   2852       RDATX(1:IDMAX) = RDATA(1:IDMAX)
   2853       SFC_8 = BMISS
   2854       IF(ITP.LE.3)  THEN ! wind profiler
   2855          CALL UFBINT(LUNIT,SFC_8,8,1,NLEV,SRFCP);SFC=SFC_8
   2856          ILVL = 1
   2857       ELSE               ! scatterometer
   2858          CALL UFBINT(LUNIT,SFC_8,8,1,NLEV,SRFCS);SFC=SFC_8
   2859          ILVL = 0
   2860       END IF
   2861       IF(NLEV.NE.1)  THEN
   2862 C.......................................................................
   2863 C PROBLEM: THE NUMBER OF DECODED "LEVELS" IS NOT WHAT IS EXPECTED --
   2864          IF(ITP.LE.3)  THEN ! for wind profiler return but don't
   2865                             ! reset iret
   2866             PRINT 217, NLEV
   2867   217 FORMAT(/'##W3UNPKB7: THE NUMBER OF DECODED "LEVELS" (=',I5,') ',
   2868      $ 'IS NOT WHAT IS EXPECTED (1) - NO SFC DATA PROCESSED'/)
   2869             GO TO 99
   2870          ELSE               ! for scatterometer set iret = 7 and return
   2871             PRINT 218, NLEV
   2872   218 FORMAT(/'##W3UNPKB7: THE NUMBER OF DECODED "LEVELS" (=',I5,') ',

Page 57          Source Listing                  UNPKB704
2017-04-18 11:09                                 w3unpkb7.f

   2873      $ 'IS NOT WHAT IS EXPECTED (1) - IRET = 7'/)
   2874             IRET = 7
   2875             RETURN
   2876          END IF
   2877 C.......................................................................
   2878       END IF
   2879  
   2880 
   2881 C       MSL PRESSURE (STORED AS REAL)
   2882  
   2883       M = 1
   2884       IF(IPRINT.GT.1)  PRINT 199, SFC(1),M
   2885   199 FORMAT(5X,'SFC HERE IS: ',F17.4,'; INDEX IS: ',I3)
   2886       IF((SFC(1)*0.1).LT.XMISS)  THEN
   2887          ILVL = 1
   2888          RDATX(IDATS_10) = NINT(SFC(1) * 0.1)
   2889       END IF
   2890       NNNNN = IDATS_10
   2891       IF(IPRINT.GT.1)  PRINT 198, NNNNN,RDATX(IDATS_10)
   2892   198 FORMAT(5X,'RDATA(',I5,') STORED AS: ',F10.2)
   2893  
   2894 C       SURFACE HORIZONTAL WIND DIRECTION (STORED AS REAL)
   2895  
   2896       M = 2
   2897       IF(IPRINT.GT.1)  PRINT 199, SFC(2),M
   2898       IF(SFC(2).LT.XMISS)  THEN
   2899          ILVL = 1
   2900          RDATX(IDATS_10+2) = NINT(SFC(2))
   2901       END IF
   2902       NNNNN = IDATS_10 + 2
   2903       IF(IPRINT.GT.1)  PRINT 198, NNNNN,RDATX(IDATS_10+2)
   2904  
   2905 C       SURFACE HORIZONTAL WIND SPEED (STORED AS REAL)
   2906  
   2907       M = 3
   2908       IF(IPRINT.GT.1)  PRINT 199, SFC(3),M
   2909       IF(SFC(3).LT.XMISS)  THEN
   2910          ILVL = 1
   2911          RDATX(IDATS_10+3) = NINT(SFC(3) * 10.)
   2912       END IF
   2913       NNNNN = IDATS_10 + 3
   2914       IF(IPRINT.GT.1)  PRINT 198, NNNNN,RDATX(IDATS_10+3)
   2915  
   2916 C       SURFACE TEMPERATURE (STORED AS REAL)
   2917  
   2918       M = 4
   2919       IF(IPRINT.GT.1)  PRINT 199, SFC(4),M
   2920       IF(SFC(4).LT.XMISS)  THEN
   2921          ILVL = 1
   2922          RDATX(IDATS_10+4) = NINT(SFC(4) * 10.)
   2923       END IF
   2924       NNNNN = IDATS_10 + 4
   2925       IF(IPRINT.GT.1)  PRINT 198, NNNNN,RDATX(IDATS_10+4)
   2926  
   2927 C       RELATIVE HUMIDITY (STORED AS REAL)
   2928  
   2929       M = 5

Page 58          Source Listing                  UNPKB704
2017-04-18 11:09                                 w3unpkb7.f

   2930       IF(IPRINT.GT.1)  PRINT 199, SFC(5),M
   2931       IF(SFC(5).LT.XMISS)  THEN
   2932          ILVL = 1
   2933          RDATX(IDATS_10+5) = NINT(SFC(5))
   2934       END IF
   2935       NNNNN = IDATS_10 + 5
   2936       IF(IPRINT.GT.1)  PRINT 198, NNNNN,RDATX(IDATS_10+5)
   2937  
   2938 C       RAINFALL RATE (STORED AS REAL)
   2939  
   2940       M = 6
   2941       IF(IPRINT.GT.1)  PRINT 199, SFC(6),M
   2942       IF(SFC(6).LT.XMISS)  THEN
   2943          ILVL = 1
   2944          RDATX(IDATS_10+6) = SFC(6)
   2945       END IF
   2946       NNNNN = IDATS_10 + 6
   2947       IF(IPRINT.GT.1)  PRINT 198, NNNNN,(RDATX(IDATS_10+6)*3600.)
   2948  
   2949 C       SET DATA LEVEL CATEGORY COUNTERS FOR SURFACE DATA
   2950  
   2951       IDATA(35) = ILVL
   2952       IF(IPRINT.GT.1)  PRINT'(1X,I0," CAT. 10 LEVELS PROCESSED")',
   2953      $ IDATA(35)
   2954       IF(IDATA(35).GT.0)  IDATA(36) = IDATS_10
   2955 
   2956       IF(IDATA(35).EQ.0)  IRET = 5 ! Can only happen for scatterometer
   2957                                    ! because for wind profiler
   2958                                    ! IDATA(35)=1 even if all parameters
   2959                                    ! here are missing
   2960 
   2961    99 CONTINUE
   2962       IF(IPRINT.GT.1)  PRINT'(" IDATA(35)=",I0,"; IDATA(36)=",I0)',
   2963      $ IDATA(35),IDATA(36)
   2964       RDATA(1:IDMAX) = RDATX(1:IDMAX)
   2965       RETURN
   2966       END

Page 59          Source Listing                  UNPKB704
2017-04-18 11:09 Entry Points                    w3unpkb7.f



ENTRY POINTS

  Name                 
                       
 unpkb704_             


SYMBOL CROSS REFERENCE

 Name                       Object Declared Type            Bytes Dimen Elements Attributes       References                        
                                                                                                                                    
 198                        Label  2632                                                           2631,2643,2654,2665,2676,2687     
 199                        Label  2625                                                           2624,2637,2648,2659,2670,2681     
 217                        Label  2607                                                           2606                              
 218                        Label  2612                                                           2611                              
 99                         Label  2701                                                           2609                              
 BMISS                      Scalar 2578     R(8)            8           scalar   COM              2593                              
 IDATA                      Local  2577     I(4)            4     1     2270     SAVE             2691,2693,2694,2696,2703          
 IDATS                      Param  40       I(4)            4           scalar                    43,46,49,52,56,59                 
 IDATS_04                   Scalar 2583     I(4)            4           scalar   COM                                                
 IDATS_08                   Scalar 2583     I(4)            4           scalar   COM                                                
 IDATS_10                   Scalar 2583     I(4)            4           scalar   COM              2628,2630,2631,2640,2642,2643,2651
                                                                                                  ,2653,2654,2662,2664,2665,2673,267
                                                                                                  5,2676,2684,2686,2687,2694        
 IDATS_11                   Scalar 2583     I(4)            4           scalar   COM                                                
 IDATS_12                   Scalar 2583     I(4)            4           scalar   COM                                                
 IDATS_13                   Scalar 2584     I(4)            4           scalar   COM                                                
 IDATS_14                   Scalar 2584     I(4)            4           scalar   COM                                                
 IDATS_15                   Scalar 2584     I(4)            4           scalar   COM                                                
 IDMAX                      Param  63       I(4)            4           scalar                    2577,2579,2592,2704               
 IDMAX_GOES                 Param  52       I(4)            4           scalar                    63                                
 IDMAX_GPS                  Param  56       I(4)            4           scalar                    64                                
 IDMAX_PROF                 Param  46       I(4)            4           scalar                    63                                
 IDMAX_RASS                 Param  59       I(4)            4           scalar                    64                                
 IDMAX_SCAT                 Param  49       I(4)            4           scalar                    63                                
 IDMAX_VAD                  Param  43       I(4)            4           scalar                    63                                
 ILVL                       Local  2596     I(4)            4           scalar   SAVE             2596,2599,2627,2639,2650,2661,2672
                                                                                                  ,2683,2691                        
 ILVLMX_04                  Param  15       I(4)            4           scalar                    43                                
 ILVLMX_08                  Param  8        I(4)            4           scalar                    52                                
 ILVLMX_11                  Param  19       I(4)            4           scalar                    46                                
 ILVLMX_12                  Param  22       I(4)            4           scalar                    52                                
 ILVLMX_13                  Param  25       I(4)            4           scalar                    53                                
 ILVLMX_15                  Param  29       I(4)            4           scalar                    59                                
 ILVL_10                    Param  34       I(4)            4           scalar                    46,49                             
 ILVL_14                    Param  37       I(4)            4           scalar                    56                                
 IPRINT                     Scalar 2582     I(4)            4           scalar   COM              2624,2631,2637,2643,2648,2654,2659
                                                                                                  ,2665,2670,2676,2681,2687,2692,270
                                                                                                  2                                 
 IRET                       Dummy  2569     I(4)            4           scalar   ARG,INOUT        2614,2696                         
 ITP                        Dummy  2569     I(4)            4           scalar   ARG,INOUT        2594,2604                         
 KDATE                      Scalar 2582     I(4)            4     1     8        COM                                                
 KTIMCH                     Scalar 2582     I(4)            4           scalar   COM                                                
 LDATE                      Scalar 2582     I(4)            4     1     8        COM                                                
 LUNIT                      Dummy  2569     I(4)            4           scalar   ARG,INOUT        2595,2598                         

Page 60          Source Listing                  UNPKB704
2017-04-18 11:09 Symbol Table                    w3unpkb7.f

 Name                       Object Declared Type            Bytes Dimen Elements Attributes       References                        
                                                                                                                                    
 M                          Local  2623     I(4)            4           scalar   SAVE             2623,2624,2636,2637,2647,2648,2658
                                                                                                  ,2659,2669,2670,2680,2681         
 MAX                        Func   63                                   scalar                    63                                
 NINT                       Func   2628                                 scalar                    2628,2640,2651,2662,2673          
 NLEV                       Local  2595     I(4)            4           scalar   SAVE             2595,2598,2601,2606,2611          
 NNNNN                      Local  2630     I(4)            4           scalar   SAVE             2630,2631,2642,2643,2653,2654,2664
                                                                                                  ,2665,2675,2676,2686,2687         
 PKB7AA                     Common 2581                                 8        SAVE                                               
 PKB7BB                     Common 2582                                 76       SAVE                                               
 PKB7GG                     Common 2583                                 32       SAVE                                               
 RDATA                      Dummy  2569     R(4)            4     1     0        ARG,INOUT        2592,2704                         
 RDATX                      Local  2579     R(4)            4     1     2270     SAVE             2592,2628,2631,2640,2643,2651,2654
                                                                                                  ,2662,2665,2673,2676,2684,2687,270
                                                                                                  4                                 
 SFC                        Local  2579     R(4)            4     1     8        SAVE             2595,2598,2624,2626,2628,2637,2638
                                                                                                  ,2640,2648,2649,2651,2659,2660,266
                                                                                                  2,2670,2671,2673,2681,2682,2684   
 SFC_8                      Local  2578     R(8)            8     1     8        SAVE             2593,2595,2598                    
 SKIP_CAT12                 Scalar 2580     L(4)            4           scalar   COM                                                
 SRFCP                      Local  2576     CHAR            40          scalar   SAVE             2590,2595                         
 SRFCS                      Local  2576     CHAR            40          scalar   SAVE             2591,2598                         
 UFBINT                     Subr   2595                                                           2595,2598                         
 UNPKB704                   Subr   2569                                                                                             
 XMISS                      Local  2589     R(4)            4           scalar   SAVE             2589,2626,2638,2649,2660,2671,2682

Page 61          Source Listing                  UNPKB704
2017-04-18 11:09                                 w3unpkb7.f

   2967 C$$$  SUBPROGRAM DOCUMENTATION BLOCK
   2968 C
   2969 C SUBPROGRAM:    UNPKB705
   2970 C   PRGMMR: D. A. KEYSER     ORG: NP22       DATE: 2014-03-13
   2971 C
   2972 C ABSTRACT: FOR REPORT (SUBSET) READ OUT OF BUFR MESSAGE (PASSED IN
   2973 C   INTERNALLY VIA BUFRLIB STORAGE), CALLS BUFRLIB ROUTINE TO DECODE
   2974 C   UPPER-AIR DATA FOR WIND PROFILER REPORT NOT ORIGINATING FROM PILOT
   2975 C   (PIBAL) FORMAT BULLETINS.  UPPER-AIR DATA ARE THEN FILLED INTO THE
   2976 C   OUTPUT ARRAY AS DATA LEVEL CATEGORY 11.  THE OUTPUT ARRAY HOLDS A
   2977 C   SINGLE WIND PROFILER REPORT IN THE QUASI-IW3UNPBF UNPACKED FORMAT.
   2978 C
   2979 C PROGRAM HISTORY LOG:
   2980 C 1996-12-16  D. A. KEYSER NP22 - ORIGINAL AUTHOR
   2981 C 1998-06-14  D. A. KEYSER -- MODIFIED WIND PROFILER CAT. 11 (HEIGHT,
   2982 C     HORIZ. SIGNIFICANCE, VERT. SIGNIFICANCE) PROCESSING TO ACCOUNT
   2983 C     FOR UPDATES TO BUFRTABLE MNEMONICS IN /dcom
   2984 C 2002-01-28  D. A. KEYSER -- THE QUALITY CODE FOR WIND PROFILER LEVELS
   2985 C     IS NOW SET TO 14 IF THE DECODED QN29 WIND QUALITY MARKER IS 12
   2986 C     (REJECT LIST) OR 14 (SDM PURGE), OTHERWISE IT IS SET TO THE
   2987 C     DECODED QUALITY CODE VALUE (BEFORE THE ON29 Q.M. WAS IGNORED)
   2988 C 2002-03-05  D. A. KEYSER -- ACCOUNTS FOR CHANGES IN INPUT PROFLR
   2989 C     (WIND PROFILER BUFR DUMP FILE AFTER 5/2002: MNEMONICS "ACAVH",
   2990 C     "ACAVV", "SPP0", AND "NPHL" NO LONGER AVAILABLE (WILL STILL WORK
   2991 C     PROPERLY FOR INPUT PROFLR DUMP FILES PRIOR TO 5/2002)
   2992 C 2014-03-13  D. A. KEYSER -- MAXIMUM NUMBER OF CAT. 11 WIND PROFILER
   2993 C     LEVELS ALLOWED (EXCLUDING FIRST, SURFACE, LEVEL), "ILVLMX_11",
   2994 C     INCREASED FROM 102 TO 200 TO ACCOUNT FOR SOME MAP PROFILERS WITH
   2995 C     MORE LEVELS THAN BEFORE
   2996 C
   2997 C USAGE:    CALL UNPKB705(LUNIT,RDATA,ITP)
   2998 C   INPUT ARGUMENT LIST:
   2999 C     LUNIT    - FORTRAN UNIT NUMBER FOR INPUT DATA FILE
   3000 C     RDATA    - SINGLE WIND PROFILER REPORT IN A QUASI-IW3UNPBF
   3001 C              - UNPACKED FORMAT WITH ONLY HEADER AND SURFACE
   3002 C              - INFORMATION FILLED IN (UPPER-AIR DATA MISSING)
   3003 C     ITP      - THE TYPE OF WIND PROFILER REPORT THAT HAS BEEN
   3004 C              - DECODED {=1 - NOAA Profiler Network (NPN),
   3005 C              -  =2 - COOPERATIVE AGENCY PROFILERS (CAP), =3 - JAPAN)}
   3006 C
   3007 C   OUTPUT ARGUMENT LIST:
   3008 C     RDATA    - SINGLE WIND PROFILER REPORT IN A QUASI-IW3UNPBF
   3009 C              - UNPACKED FORMAT WITH UPPER-AIR INFORMATION FILLED IN
   3010 C              - (ALL DATA FOR REPORT NOW FILLED)
   3011 C
   3012 C   OUTPUT FILES:
   3013 C     UNIT 06  - PRINTOUT
   3014 C
   3015 C REMARKS: CALLED BY SUBROUTINE W3UNPKB7.
   3016 C
   3017 C ATTRIBUTES:
   3018 C   LANGUAGE: FORTRAN 90
   3019 C   MACHINE:  NCEP WCOSS
   3020 C
   3021 C$$$
   3022       SUBROUTINE UNPKB705(LUNIT,RDATA,ITP)
   3023 

Page 62          Source Listing                  UNPKB705
2017-04-18 11:09                                 w3unpkb7.f

   3024 C  Include parameters common to more than one subroutine
   3025 C  -----------------------------------------------------
   3026 
   3027       include 'inc_w3unpkb7.inc'
   3028 
   3094       CHARACTER*33  UAIR1,UAIR2,UAIR3
   3095       INTEGER  IDATA(IDMAX)
   3096       LOGICAL  SKIP_CAT12
   3097       REAL(8) UAIR1_8(6,255),UAIR2_8(6,255),UAIR3_8(5,255),BMISS
   3098       REAL  UAIR(17,255),RDATA(*),RDATX(IDMAX)
   3099       COMMON /PKB7AA/BMISS
   3100       COMMON /PKB7BB/kdate(8),ldate(8),KTIMCH,IPRINT,SKIP_CAT12
   3101       COMMON /PKB7GG/IDATS_04,IDATS_08,IDATS_10,IDATS_11,IDATS_12,
   3102      $ IDATS_13,IDATS_14,IDATS_15
   3103  
   3104       SAVE
   3105  
   3106       EQUIVALENCE (RDATX,IDATA)
   3107       DATA  XMISS/99999./
   3108       DATA  UAIR1/'HEIT  WDIR  WSPD  QMWN NPQC WCMP '/
   3109       DATA  UAIR2/'ACAVH ACAVV SPP0  SDHS SDVS NPHL '/
   3110       DATA  UAIR3/'HAST  ACAV1 ACAV2 QMRK STNR      '/
   3111       RDATX(1:IDMAX) = RDATA(1:IDMAX)
   3112       NSFC = 0
   3113       ILVL = 0
   3114       ILC =  0
   3115 C FIRST UPPER-AIR LEVEL IS THE SURFACE INFORMATION
   3116       IF(IPRINT.GT.1)  PRINT 1078, ILC,ILVL
   3117  1078 FORMAT(' ATTEMPTING 1ST (SFC) LVL WITH ILC =',I5,'; NO. LEVELS ',
   3118      $ 'PROCESSED TO NOW =',I5)
   3119       RDATX(IDATS_11+ILC) = RDATX(7)
   3120       IF(IPRINT.GT.1)  PRINT 198, IDATS_11+ILC,RDATX(IDATS_11+ILC)
   3121   198 FORMAT(5X,'RDATA(',I5,') STORED AS: ',F10.2)
   3122       IF(RDATX(IDATS_11+ILC).LT.XMISS)  NSFC = 1
   3123       IF(IDATA(35).GE.1)  THEN
   3124          RDATX(IDATS_11+ILC+1) = RDATX(IDATA(36)+2)
   3125          RDATX(IDATS_11+ILC+2) = RDATX(IDATA(36)+3)
   3126       END IF
   3127       IF(IPRINT.GT.1)  PRINT 198, IDATS_11+ILC+1,RDATX(IDATS_11+ILC+1)
   3128       IF(RDATX(IDATS_11+ILC+1).LT.XMISS)  NSFC = 1
   3129       IF(IPRINT.GT.1)  PRINT 198, IDATS_11+ILC+2,RDATX(IDATS_11+ILC+2)
   3130       IF(RDATX(IDATS_11+ILC+2).LT.XMISS)  NSFC = 1
   3131       ILVL = ILVL + 1
   3132       ILC = ILC + 11
   3133       IF(IPRINT.GT.1) PRINT'(" HAVE COMPLETED LEVEL ",I0," WITH NSFC=",
   3134      $ I0,"; GOING INTO NEXT LEVEL WITH ILC=",I0)', ILVL,NSFC,ILC
   3135       UAIR1_8 = BMISS
   3136       UAIR2_8 = BMISS
   3137       UAIR3_8 = BMISS
   3138       CALL UFBINT(LUNIT,UAIR1_8,6,255,NLEV1,UAIR1)
   3139       CALL UFBINT(LUNIT,UAIR2_8,6,255,NLEV2,UAIR2)
   3140       CALL UFBINT(LUNIT,UAIR3_8,5,255,NLEV3,UAIR3)
   3141       NLEV = MAX(NLEV1,NLEV2,NLEV3)
   3142       UAIR( 1: 6,:) = UAIR1_8(:,:)
   3143       UAIR( 7:12,:) = UAIR2_8(:,:)
   3144       UAIR(13:17,:) = UAIR3_8(:,:)
   3145       IF(IPRINT.GT.1)  PRINT 1068, NLEV

Page 63          Source Listing                  UNPKB705
2017-04-18 11:09                                 w3unpkb7.f

   3146  1068 FORMAT(' THIS REPORT CONTAINS ',I3,' LEVELS OF DATA (NOT ',
   3147      $ 'INCLUDING BOTTOM -SURFACE- LEVEL)')
   3148       IF(NLEV.EQ.0)  THEN
   3149 C.......................................................................
   3150 C PROBLEM: THE NUMBER OF DECODED "LEVELS" IS ZERO --
   3151          IF(NSFC.EQ.0)  THEN
   3152 C ... NO UPPER AIR DATA PROCESSED
   3153             PRINT 217
   3154   217       FORMAT(/'##W3UNPKB7: NO UPPER-AIR DATA PROCESSED FOR THIS',
   3155      $       ' REPORT -- NLEV = 0 AND NSFC = 0'/)
   3156             GO TO 99
   3157          ELSE
   3158 C ... ONLY FIRST (SURFACE) UPPER AIR LEVEL DATA PROCESSED
   3159             PRINT 218
   3160   218 FORMAT(/'##W3UNPKB7: NO UPPER-AIR DATA ABOVE FIRST (SURFACE) ',
   3161      $ 'LEVEL PROCESSED FOR THIS REPORT -- NLEV = 0 AND NSFC > 0'/)
   3162             GO TO 98
   3163          END IF
   3164 C.......................................................................
   3165       ELSE  IF(NLEV.GT.ILVLMX_11)  THEN
   3166 C PROBLEM: THE NUMBER OF DECODED "LEVELS" {EXCLUDING BOTTOM (SURFACE)
   3167 C  LEVEL} IS .GT. LIMIT OF "ILVLMX_11" --
   3168          PRINT 2186, NLEV,ILVLMX_11,ILVLMX_11
   3169  2186    FORMAT(/'##W3UNPKB7: NUMBER OF UPPER-AIR LEVELS FOR THIS ',
   3170      $    'REPORT (=',I3,') EXCEEDS LIMIT OF ',I0,' CAT. 11 LEVELS ',
   3171      $    '(EXCLUDING BOTTOM, SFC, LVL) -- '/'     ONLY FIRST ',I0,
   3172      $    ' UPPER-AIR LEVELS PLUS THE SURFACE LEVEL WILL BE PROCESSED'/)
   3173          NLEV = ILVLMX_11
   3174 C.......................................................................
   3175       END IF
   3176       DO I = 1,NLEV
   3177          IF(IPRINT.GT.1)  PRINT 1079, ILC,ILVL
   3178  1079 FORMAT(' ATTEMPTING NEW LEVEL WITH ILC =',I5,'; NO. LEVELS ',
   3179      $ 'PROCESSED TO NOW =',I5)
   3180  
   3181 C       HEIGHT ABOVE SEA-LEVEL (STORED AS REAL)
   3182 C        (NOTE: Prior to 2/18/1999, the height above sea level was
   3183 C               erroneously stored under mnemonic "HAST" when it should
   3184 C               have been stored under mnemonic "HEIT". This was
   3185 C               corrected after this date.  ("HAST" is defined as the
   3186 C               height above the station.)
   3187 C               Will test first for valid data in "HEIT" - if missing,
   3188 C               then will use data in "HAST" - this will allow this
   3189 C               routine to work properly with historical data.
   3190  
   3191          IF(UAIR(1,I).LT.XMISS)  THEN
   3192             M = 1
   3193             IF(IPRINT.GT.1)  PRINT 199, UAIR(1,I),M
   3194   199 FORMAT(5X,'UAIR HERE IS: ',F17.4,'; INDEX IS: ',I3)
   3195             RDATX(IDATS_11+ILC) = NINT(UAIR(1,I))
   3196          ELSE
   3197             M = 13
   3198             IF(IPRINT.GT.1)  PRINT 199, UAIR(13,I),M
   3199             IF(UAIR(13,I).LT.XMISS) RDATX(IDATS_11+ILC)=NINT(UAIR(13,I))
   3200          END IF
   3201          IF(IPRINT.GT.1)  PRINT 198, IDATS_11+ILC,RDATX(IDATS_11+ILC)
   3202          ILVL = ILVL + 1

Page 64          Source Listing                  UNPKB705
2017-04-18 11:09                                 w3unpkb7.f

   3203  
   3204 C       HORIZONTAL WIND DIRECTION (STORED AS REAL)
   3205  
   3206          M = 2
   3207          IF(IPRINT.GT.1)  PRINT 199, UAIR(2,I),M
   3208          IF(UAIR(2,I).LT.XMISS)  RDATX(IDATS_11+ILC+1) = NINT(UAIR(2,I))
   3209          IF(IPRINT.GT.1) PRINT 198, IDATS_11+ILC+1,RDATX(IDATS_11+ILC+1)
   3210  
   3211 C       HORIZONTAL WIND SPEED (STORED AS REAL)
   3212  
   3213          M = 3
   3214          IF(IPRINT.GT.1)  PRINT 199, UAIR(3,I),M
   3215          IF(UAIR(3,I).LT.XMISS)RDATX(IDATS_11+ILC+2)=NINT(UAIR(3,I)*10.)
   3216          IF(IPRINT.GT.1) PRINT 198, IDATS_11+ILC+2,RDATX(IDATS_11+ILC+2)
   3217  
   3218 C       QUALITY CODE (STORED AS INTEGER)
   3219 C          IF SDMEDIT/QUIPS WIND QUALITY MARKER IS 12 (REJECT LIST) OR
   3220 C          14 (SDM PURGE) THEN A VALUE OF 14 IS STORED FOR THE QUALITY
   3221 C          CODE; OTHERWISE THE DECODED QUALITY CODE IS STORED DIRECTLY
   3222  
   3223          M = 4
   3224          IF(IPRINT.GT.1)  PRINT 199, UAIR(4,I),M
   3225          M = 5
   3226          IF(IPRINT.GT.1)  PRINT 199, UAIR(5,I),M
   3227          M = 16
   3228          IF(IPRINT.GT.1)  PRINT 199, UAIR(16,I),M
   3229          IF(UAIR(4,I).EQ.12.OR.UAIR(4,I).EQ.14)  THEN
   3230             IDATA(IDATS_11+ILC+3) = 14
   3231          ELSE  IF(UAIR(5,I).LT.XMISS) THEN   ! NPN or CAP
   3232             IDATA(IDATS_11+ILC+3) = NINT(UAIR(5,I))
   3233          ELSE  IF(UAIR(16,I).LT.XMISS) THEN  ! Japanese
   3234             IDATA(IDATS_11+ILC+3) = NINT(UAIR(16,I))
   3235          END IF
   3236          IF(IPRINT.GT.1) PRINT 197, IDATS_11+ILC+3,IDATA(IDATS_11+ILC+3)
   3237   197 FORMAT(5X,'IDATA(',I5,') STORED AS: ',I10)
   3238  
   3239 C       VERTICAL WIND COMPONENT (W) (STORED AS REAL)
   3240  
   3241          M = 6
   3242          IF(IPRINT.GT.1)  PRINT 199, UAIR(6,I),M
   3243         IF(UAIR(6,I).LT.XMISS)RDATX(IDATS_11+ILC+4)=NINT(UAIR(6,I)*100.)
   3244          IF(IPRINT.GT.1) PRINT 198, IDATS_11+ILC+4,RDATX(IDATS_11+ILC+4)
   3245  
   3246 C       HORIZONTAL CONSENSUS NUMBER (STORED AS INTEGER)
   3247 C        (NOTE: Prior to 2/18/1999, the horizonal consensus number was
   3248 C                stored under mnemonic "ACAV1".
   3249 C               From 2/18/1999 through 5/2002, the horizontal consensus
   3250 C                number was stored under mnemonic "ACAVH".
   3251 C               After 5/2002, the horizontal consensus number is no
   3252 C                longer stored.
   3253 C               Will test first for valid data in "ACAVH" - if missing,
   3254 C                then will test for data in "ACAV1" - this will allow
   3255 C                this routine to work properly with historical data.)
   3256  
   3257          IF(IPRINT.GT.1)  PRINT 199, UAIR(7,I),M
   3258          IF(IPRINT.GT.1)  PRINT 199, UAIR(14,I),M
   3259          IF(UAIR(7,I).LT.XMISS)  THEN

Page 65          Source Listing                  UNPKB705
2017-04-18 11:09                                 w3unpkb7.f

   3260             M = 7
   3261             IDATA(IDATS_11+ILC+5) = NINT(UAIR(7,I))
   3262          ELSE
   3263             M = 14
   3264            IF(UAIR(14,I).LT.XMISS)IDATA(IDATS_11+ILC+5)=NINT(UAIR(14,I))
   3265          END IF
   3266          IF(IPRINT.GT.1) PRINT 197, IDATS_11+ILC+5,IDATA(IDATS_11+ILC+5)
   3267  
   3268 C       VERTICAL CONSENSUS NUMBER (STORED AS INTEGER)
   3269 C        (NOTE: Prior to 2/18/1999, the vertical consensus number was
   3270 C                stored under mnemonic "ACAV2".
   3271 C               From 2/18/1999 through 5/2002, the vertical consensus
   3272 C                number was stored under mnemonic "ACAVV".
   3273 C               After 5/2002, the vertical consensus number is no
   3274 C                longer stored.
   3275 C               Will test first for valid data in "ACAVV" - if missing,
   3276 C                then will test for data in "ACAV2" - this will allow
   3277 C                this routine to work properly with historical data.)
   3278  
   3279          IF(UAIR(8,I).LT.XMISS)  THEN
   3280             M = 8
   3281             IF(IPRINT.GT.1)  PRINT 199, UAIR(8,I),M
   3282             IDATA(IDATS_11+ILC+6) = NINT(UAIR(8,I))
   3283          ELSE  IF(UAIR(15,I).LT.XMISS)  THEN
   3284             M = 15
   3285             IF(IPRINT.GT.1)  PRINT 199, UAIR(15,I),M
   3286             IDATA(IDATS_11+ILC+6)=NINT(UAIR(15,I))
   3287          END IF
   3288          IF(IPRINT.GT.1) PRINT 197, IDATS_11+ILC+6,IDATA(IDATS_11+ILC+6)
   3289  
   3290          IF(ITP.NE.3)   THEN
   3291 
   3292 C       NPN AND CAP: SPECTRAL PEAK POWER (STORED AS REAL)
   3293 C        (NOTE: After 5/2002, the spectral peak power is no longer
   3294 C                stored.)
   3295  
   3296             M = 9
   3297          ELSE
   3298 
   3299 C       JAPANESE: SIGNAL-TO-NOISE RATIO (STORED AS REAL)
   3300  
   3301             M = 17
   3302          END IF
   3303          IF(IPRINT.GT.1)  PRINT 199, UAIR(M,I),M
   3304          IF(UAIR(M,I).LT.XMISS)  RDATX(IDATS_11+ILC+7) = NINT(UAIR(M,I))
   3305          IF(IPRINT.GT.1) PRINT 198, IDATS_11+ILC+7,RDATX(IDATS_11+ILC+7)
   3306 
   3307 C       HORIZONTAL WIND SPEED STANDARD DEVIATION (STORED AS REAL)
   3308  
   3309          M = 10
   3310          IF(IPRINT.GT.1)  PRINT 199, UAIR(10,I),M
   3311        IF(UAIR(10,I).LT.XMISS)RDATX(IDATS_11+ILC+8)=NINT(UAIR(10,I)*10.)
   3312          IF(IPRINT.GT.1) PRINT 198, IDATS_11+ILC+8,RDATX(IDATS_11+ILC+8)
   3313  
   3314 C       VERTICAL WIND COMPONENT STANDARD DEVIATION (STORED AS REAL)
   3315  
   3316          M = 11

Page 66          Source Listing                  UNPKB705
2017-04-18 11:09                                 w3unpkb7.f

   3317          IF(IPRINT.GT.1)  PRINT 199, UAIR(11,I),M
   3318        IF(UAIR(11,I).LT.XMISS)RDATX(IDATS_11+ILC+9)=NINT(UAIR(11,I)*10.)
   3319          IF(IPRINT.GT.1) PRINT 198, IDATS_11+ILC+9,RDATX(IDATS_11+ILC+9)
   3320  
   3321 C       MODE INFORMATION (STORED AS INTEGER)
   3322 C        (NOTE: After 5/2002, the mode information is no longer stored.)
   3323  
   3324          M = 12
   3325          IF(IPRINT.GT.1)  PRINT 199, UAIR(12,I),M
   3326          IF(UAIR(12,I).LT.XMISS) IDATA(IDATS_11+ILC+10)=NINT(UAIR(12,I))
   3327          IF(IPRINT.GT.1)PRINT 197,IDATS_11+ILC+10,IDATA(IDATS_11+ILC+10)
   3328 C.......................................................................
   3329          ILC = ILC + 11
   3330          IF(IPRINT.GT.1)  PRINT'(" HAVE COMPLETED LEVEL ",I0,"; GOING ",
   3331      $    "INTO NEXT LEVEL WITH ILC=",I0)', ILVL,ILC
   3332       ENDDO    
   3333  
   3334 C       SET DATA LEVEL CATEGORY COUNTERS FOR UPPER-AIR DATA
   3335  
   3336    98 CONTINUE
   3337       IDATA(37) = ILVL
   3338       IDATA(38) = IDATS_11
   3339    99 CONTINUE
   3340       IF(IPRINT.GT.1)  PRINT'(" NSFC=",I0,"; IDATA(37)=",I0,
   3341      $ "; IDATA(38)=",I0)', NSFC,IDATA(37),IDATA(38)
   3342       RDATA(1:IDMAX) = RDATX(1:IDMAX)
   3343       RETURN
   3344       END

Page 67          Source Listing                  UNPKB705
2017-04-18 11:09 Entry Points                    w3unpkb7.f



ENTRY POINTS

  Name                 
                       
 unpkb705_             


SYMBOL CROSS REFERENCE

 Name                       Object Declared Type            Bytes Dimen Elements Attributes       References                        
                                                                                                                                    
 1068                       Label  2821                                                           2820                              
 1078                       Label  2792                                                           2791                              
 1079                       Label  2853                                                           2852                              
 197                        Label  2912                                                           2911,2941,2963,3002               
 198                        Label  2796                                                           2795,2802,2804,2876,2884,2891,2919
                                                                                                  ,2980,2987,2994                   
 199                        Label  2869                                                           2868,2873,2882,2889,2899,2901,2903
                                                                                                  ,2917,2932,2933,2956,2960,2978,298
                                                                                                  5,2992,3000                       
 217                        Label  2829                                                           2828                              
 218                        Label  2835                                                           2834                              
 2186                       Label  2844                                                           2843                              
 98                         Label  3011                                                           2837                              
 99                         Label  3014                                                           2831                              
 BMISS                      Scalar 2772     R(8)            8           scalar   COM              2810,2811,2812                    
 I                          Local  2851     I(4)            4           scalar   SAVE             2851,2866,2868,2870,2873,2874,2882
                                                                                                  ,2883,2889,2890,2899,2901,2903,290
                                                                                                  4,2906,2907,2908,2909,2917,2918,29
                                                                                                  32,2933,2934,2936,2939,2954,2956,2
                                                                                                  957,2958,2960,2961,2978,2979,2985,
                                                                                                  2986,2992,2993,3000,3001          
 IDATA                      Local  2770     I(4)            4     1     2270     SAVE             2798,2799,2800,2905,2907,2909,2911
                                                                                                  ,2936,2939,2941,2957,2961,2963,300
                                                                                                  1,3002,3012,3013,3016             
 IDATS                      Param  40       I(4)            4           scalar                    43,46,49,52,56,59                 
 IDATS_04                   Scalar 2776     I(4)            4           scalar   COM                                                
 IDATS_08                   Scalar 2776     I(4)            4           scalar   COM                                                
 IDATS_10                   Scalar 2776     I(4)            4           scalar   COM                                                
 IDATS_11                   Scalar 2776     I(4)            4           scalar   COM              2794,2795,2797,2799,2800,2802,2803
                                                                                                  ,2804,2805,2870,2874,2876,2883,288
                                                                                                  4,2890,2891,2905,2907,2909,2911,29
                                                                                                  18,2919,2936,2939,2941,2957,2961,2
                                                                                                  963,2979,2980,2986,2987,2993,2994,
                                                                                                  3001,3002,3013                    
 IDATS_12                   Scalar 2776     I(4)            4           scalar   COM                                                
 IDATS_13                   Scalar 2777     I(4)            4           scalar   COM                                                
 IDATS_14                   Scalar 2777     I(4)            4           scalar   COM                                                
 IDATS_15                   Scalar 2777     I(4)            4           scalar   COM                                                
 IDMAX                      Param  63       I(4)            4           scalar                    2770,2773,2786,3017               
 IDMAX_GOES                 Param  52       I(4)            4           scalar                    63                                
 IDMAX_GPS                  Param  56       I(4)            4           scalar                    64                                
 IDMAX_PROF                 Param  46       I(4)            4           scalar                    63                                
 IDMAX_RASS                 Param  59       I(4)            4           scalar                    64                                
 IDMAX_SCAT                 Param  49       I(4)            4           scalar                    63                                

Page 68          Source Listing                  UNPKB705
2017-04-18 11:09 Symbol Table                    w3unpkb7.f

 Name                       Object Declared Type            Bytes Dimen Elements Attributes       References                        
                                                                                                                                    
 IDMAX_VAD                  Param  43       I(4)            4           scalar                    63                                
 ILC                        Local  2789     I(4)            4           scalar   SAVE             2789,2791,2794,2795,2797,2799,2800
                                                                                                  ,2802,2803,2804,2805,2807,2809,285
                                                                                                  2,2870,2874,2876,2883,2884,2890,28
                                                                                                  91,2905,2907,2909,2911,2918,2919,2
                                                                                                  936,2939,2941,2957,2961,2963,2979,
                                                                                                  2980,2986,2987,2993,2994,3001,3002
                                                                                                  ,3004,3006                        
 ILVL                       Local  2788     I(4)            4           scalar   SAVE             2788,2791,2806,2809,2852,2877,3006
                                                                                                  ,3012                             
 ILVLMX_04                  Param  15       I(4)            4           scalar                    43                                
 ILVLMX_08                  Param  8        I(4)            4           scalar                    52                                
 ILVLMX_11                  Param  19       I(4)            4           scalar                    46,2840,2843,2848                 
 ILVLMX_12                  Param  22       I(4)            4           scalar                    52                                
 ILVLMX_13                  Param  25       I(4)            4           scalar                    53                                
 ILVLMX_15                  Param  29       I(4)            4           scalar                    59                                
 ILVL_10                    Param  34       I(4)            4           scalar                    46,49                             
 ILVL_14                    Param  37       I(4)            4           scalar                    56                                
 IPRINT                     Scalar 2775     I(4)            4           scalar   COM              2791,2795,2802,2804,2808,2820,2852
                                                                                                  ,2868,2873,2876,2882,2884,2889,289
                                                                                                  1,2899,2901,2903,2911,2917,2919,29
                                                                                                  32,2933,2941,2956,2960,2963,2978,2
                                                                                                  980,2985,2987,2992,2994,3000,3002,
                                                                                                  3005,3015                         
 ITP                        Dummy  2762     I(4)            4           scalar   ARG,INOUT        2965                              
 KDATE                      Scalar 2775     I(4)            4     1     8        COM                                                
 KTIMCH                     Scalar 2775     I(4)            4           scalar   COM                                                
 LDATE                      Scalar 2775     I(4)            4     1     8        COM                                                
 LUNIT                      Dummy  2762     I(4)            4           scalar   ARG,INOUT        2813,2814,2815                    
 M                          Local  2867     I(4)            4           scalar   SAVE             2867,2868,2872,2873,2881,2882,2888
                                                                                                  ,2889,2898,2899,2900,2901,2902,290
                                                                                                  3,2916,2917,2932,2933,2935,2938,29
                                                                                                  55,2956,2959,2960,2971,2976,2978,2
                                                                                                  979,2984,2985,2991,2992,2999,3000 
 MAX                        Func   63                                   scalar                    63,2816                           
 NINT                       Func   2870                                 scalar                    2870,2874,2883,2890,2907,2909,2918
                                                                                                  ,2936,2939,2957,2961,2979,2986,299
                                                                                                  3,3001                            
 NLEV                       Local  2816     I(4)            4           scalar   SAVE             2816,2820,2823,2840,2843,2848,2851
 NLEV1                      Local  2813     I(4)            4           scalar   SAVE             2813,2816                         
 NLEV2                      Local  2814     I(4)            4           scalar   SAVE             2814,2816                         
 NLEV3                      Local  2815     I(4)            4           scalar   SAVE             2815,2816                         
 NSFC                       Local  2787     I(4)            4           scalar   SAVE             2787,2797,2803,2805,2809,2826,3016
 PKB7AA                     Common 2774                                 8        SAVE                                               
 PKB7BB                     Common 2775                                 76       SAVE                                               
 PKB7GG                     Common 2776                                 32       SAVE                                               
 RDATA                      Dummy  2762     R(4)            4     1     0        ARG,INOUT        2786,3017                         
 RDATX                      Local  2773     R(4)            4     1     2270     SAVE             2786,2794,2795,2797,2799,2800,2802
                                                                                                  ,2803,2804,2805,2870,2874,2876,288
                                                                                                  3,2884,2890,2891,2918,2919,2979,29
                                                                                                  80,2986,2987,2993,2994,3017       
 SKIP_CAT12                 Scalar 2771     L(4)            4           scalar   COM                                                
 UAIR                       Local  2773     R(4)            4     2     4335     SAVE             2817,2818,2819,2866,2868,2870,2873
                                                                                                  ,2874,2882,2883,2889,2890,2899,290
                                                                                                  1,2903,2904,2906,2907,2908,2909,29

Page 69          Source Listing                  UNPKB705
2017-04-18 11:09 Symbol Table                    w3unpkb7.f

 Name                       Object Declared Type            Bytes Dimen Elements Attributes       References                        
                                                                                                                                    
                                                                                                  17,2918,2932,2933,2934,2936,2939,2
                                                                                                  954,2956,2957,2958,2960,2961,2978,
                                                                                                  2979,2985,2986,2992,2993,3000,3001
 UAIR1                      Local  2769     CHAR            33          scalar   SAVE             2783,2813                         
 UAIR1_8                    Local  2772     R(8)            8     2     1530     SAVE             2810,2813,2817                    
 UAIR2                      Local  2769     CHAR            33          scalar   SAVE             2784,2814                         
 UAIR2_8                    Local  2772     R(8)            8     2     1530     SAVE             2811,2814,2818                    
 UAIR3                      Local  2769     CHAR            33          scalar   SAVE             2785,2815                         
 UAIR3_8                    Local  2772     R(8)            8     2     1275     SAVE             2812,2815,2819                    
 UFBINT                     Subr   2813                                                           2813,2814,2815                    
 UNPKB705                   Subr   2762                                                                                             
 XMISS                      Local  2782     R(4)            4           scalar   SAVE             2782,2797,2803,2805,2866,2874,2883
                                                                                                  ,2890,2906,2908,2918,2934,2939,295
                                                                                                  4,2958,2979,2986,2993,3001        

Page 70          Source Listing                  UNPKB705
2017-04-18 11:09                                 w3unpkb7.f

   3345 
   3346 C$$$  SUBPROGRAM DOCUMENTATION BLOCK
   3347 C
   3348 C SUBPROGRAM:    UNPKB706
   3349 C   PRGMMR: D. A. KEYSER     ORG: NP22       DATE: 2014-03-13
   3350 C
   3351 C ABSTRACT: FOR REPORT (SUBSET) READ OUT OF BUFR MESSAGE (PASSED IN
   3352 C   INTERNALLY VIA BUFRLIB STORAGE), CALLS BUFRLIB ROUTINE TO DECODE
   3353 C   UPPER-AIR DATA FOR NEXRAD (VAD) WIND REPORT (FROM BOTH RADAR CODED
   3354 C   MESSAGE AND FROM LEVEL 2 DECODER).  UPPER-AIR DATA ARE THEN FILLED
   3355 C   INTO THE OUTPUT ARRAY AS DATA LEVEL CATEGORY 4.  THE OUTPUT ARRAY
   3356 C   HOLDS A SINGLE VAD WIND REPORT IN THE QUASI-IW3UNPBF UNPACKED
   3357 C   FORMAT.
   3358 C
   3359 C PROGRAM HISTORY LOG:
   3360 C 1997-06-02  D. A. KEYSER NP22 - ORIGINAL AUTHOR
   3361 C 2002-01-28  D. A. KEYSER -- THE WIND Q.M. FOR VAD WINDS LEVELS IS
   3362 C     NOW SET TO THE DECODED QN29 WIND QUALITY MARKER IF IT IS 12
   3363 C     (REJECT LIST) OR 14 (SDM PURGE), OTHERWISE IT IS SET TO THE
   3364 C     NUMERICAL INDICATOR FOR THE DECODED RMS VECTOR WIND ERROR
   3365 C     (BEFORE THE ON29 Q.M. WAS IGNORED)
   3366 C 2014-03-13  D. A. KEYSER -- MODIFIED TO HANDLE VAD WINDS FROM LEVEL
   3367 C     2 DECODER (SUBSET "NC002017") {IN ADDITION TO THOSE FROM RADAR
   3368 C     CODED MESSAGE (SUBSET "NC002008")}; MAXIMUM NUMBER OF CAT. 04
   3369 C     WINDS-BY-HEIGHT LEVELS ALLOWED (EXCLUDING FIRST, SURFACE, LEVEL),
   3370 C     "ILVLMX_04", INCREASED FROM 64 TO 254 TO ACCOUNT FOR MORE LEVELS
   3371 C     IN NEW VAD WINDS FROM LEVEL 2 DECODER
   3372 C
   3373 C USAGE:    CALL UNPKB706(LUNIT,RDATA,ITP,IRET)
   3374 C   INPUT ARGUMENT LIST:
   3375 C     LUNIT    - FORTRAN UNIT NUMBER FOR INPUT DATA FILE
   3376 C     RDATA    - SINGLE NEXRAD (VAD) REPORT IN A QUASI-IW3UNPBF
   3377 C              - UNPACKED FORMAT WITH ONLY HEADER INFORMATION FILLED
   3378 C              - IN (CATEGORY 4 DATA MISSING)
   3379 C     ITP      - THE TYPE OF REPORT THAT HAS BEEN DECODED {=5 -
   3380 C              - NEXRAD (VAD) WIND FROM RADAR CODED MESSAGE; =12 -
   3381 C              - NEXRAD (VAD) WIND FROM LEVEL 2 DECODER}
   3382 C
   3383 C   OUTPUT ARGUMENT LIST:
   3384 C     RDATA    - SINGLE NEXRAD (VAD) REPORT IN A QUASI-IW3UNPBF
   3385 C              - UNPACKED FORMAT WITH CATEGORY 4 INFORMATION FILLED IN
   3386 C              - (ALL DATA FOR REPORT NOW FILLED)
   3387 C     IRET     - RETURN CODE AS DESCRIBED IN W3UNPKB7 DOCBLOCK
   3388 C
   3389 C   OUTPUT FILES:
   3390 C     UNIT 06  - PRINTOUT
   3391 C
   3392 C REMARKS: CALLED BY SUBROUTINE W3UNPKB7.
   3393 C
   3394 C ATTRIBUTES:
   3395 C   LANGUAGE: FORTRAN 90
   3396 C   MACHINE:  NCEP WCOSS
   3397 C
   3398 C$$$
   3399       SUBROUTINE UNPKB706(LUNIT,RDATA,ITP,IRET)
   3400 
   3401 C  Include parameters common to more than one subroutine

Page 71          Source Listing                  UNPKB706
2017-04-18 11:09                                 w3unpkb7.f

   3402 C  -----------------------------------------------------
   3403 
   3404       include 'inc_w3unpkb7.inc'
   3405 
   3471       CHARACTER*25  UAIR1,UAIR2
   3472       INTEGER  IDATA(IDMAX)
   3473       INTEGER QFV
   3474       LOGICAL  SKIP_CAT12
   3475       REAL(8) UAIR_8(5,255),BMISS
   3476       REAL  RMS(0:12),UAIR(5,255),RDATA(*),RDATX(IDMAX)
   3477       COMMON /PKB7AA/BMISS
   3478       COMMON /PKB7BB/kdate(8),ldate(8),KTIMCH,IPRINT,SKIP_CAT12
   3479       COMMON /PKB7GG/IDATS_04,IDATS_08,IDATS_10,IDATS_11,IDATS_12,
   3480      $ IDATS_13,IDATS_14,IDATS_15
   3481  
   3482       SAVE
   3483  
   3484       EQUIVALENCE (RDATX,IDATA)
   3485       DATA  XMISS/99999./
   3486       DATA  UAIR1/'HEIT WDIR WSPD QMWN RMSW '/
   3487       DATA  UAIR2/'HEIT UWND VWND QMWN QFV2 '/
   3488       DATA  RMS/1.,1.,2.,2.,3.,3.,4.,4.,5.,5.,6.,6.,7./
   3489       RDATX(1:IDMAX) = RDATA(1:IDMAX)
   3490       NSFC = 0
   3491       ILVL = 0
   3492       ILC =  0
   3493 C FIRST CATEGORY 4 DATA LEVEL CONTAINS ONLY HEIGHT (ELEV)
   3494       IF(IPRINT.GT.1)  PRINT 1078, ILC,ILVL
   3495  1078 FORMAT(' ATTEMPTING 1ST (SFC) LVL WITH ILC =',I5,'; NO. LEVELS ',
   3496      $ 'PROCESSED TO NOW =',I5)
   3497       RDATX(IDATS_04+ILC) = RDATX(7)
   3498       IF(IPRINT.GT.1)  PRINT 198, IDATS_04+ILC,RDATX(IDATS_04+ILC)
   3499   198 FORMAT(5X,'RDATA(',I5,') STORED AS: ',F10.2)
   3500       IF(RDATX(IDATS_04+ILC).LT.XMISS)  NSFC = 1
   3501       ILVL = ILVL + 1
   3502       ILC = ILC + 5
   3503       IF(IPRINT.GT.1) PRINT'(" HAVE COMPLETED LEVEL ",I0," WITH NSFC=",
   3504      $ I0,"; GOING INTO NEXT LEVEL WITH ILC=",I0)', ILVL,NSFC,ILC
   3505       UAIR_8 = BMISS
   3506       IF(ITP.EQ.5) THEN
   3507          CALL UFBINT(LUNIT,UAIR_8,5,255,NLEV,UAIR1);UAIR=UAIR_8
   3508       ELSE IF(ITP.EQ.12) THEN
   3509          CALL UFBINT(LUNIT,UAIR_8,5,255,NLEV,UAIR2);UAIR=UAIR_8
   3510       END IF
   3511       IF(IPRINT.GT.1)  PRINT 1068, NLEV
   3512  1068 FORMAT(' THIS REPORT CONTAINS ',I3,' LEVELS OF DATA (NOT ',
   3513      $ 'INCLUDING BOTTOM -SURFACE- LEVEL)')
   3514       IF(NLEV.EQ.0)  THEN
   3515 C.......................................................................
   3516 C PROBLEM: THE NUMBER OF DECODED "LEVELS" IS ZERO --
   3517          IF(NSFC.EQ.0)  THEN
   3518 C ... NO UPPER AIR DATA PROCESSED
   3519             PRINT 217
   3520   217       FORMAT(/'##W3UNPKB7: NO UPPER-AIR DATA PROCESSED FOR THIS',
   3521      $       ' REPORT -- NLEV = 0 AND NSFC = 0'/)
   3522             GO TO 99
   3523          ELSE

Page 72          Source Listing                  UNPKB706
2017-04-18 11:09                                 w3unpkb7.f

   3524 C ... ONLY FIRST (SURFACE) UPPER AIR LEVEL DATA PROCESSED
   3525             PRINT 218
   3526   218 FORMAT(/'##W3UNPKB7: NO UPPER-AIR DATA ABOVE FIRST (SURFACE) ',
   3527      $ 'LEVEL PROCESSED FOR THIS REPORT -- NLEV = 0 AND NSFC > 0'/)
   3528             GO TO 98
   3529          END IF
   3530 C.......................................................................
   3531       ELSE  IF(NLEV.GT.ILVLMX_04)  THEN
   3532 C PROBLEM: THE NUMBER OF DECODED "LEVELS" {EXCLUDING BOTTOM (SURFACE)
   3533 C  LEVEL} IS .GT. LIMIT OF "ILVLMX_04" --
   3534          PRINT 2186, NLEV,ILVLMX_04,ILVLMX_04
   3535  2186    FORMAT(/'##W3UNPKB7: NUMBER OF UPPER-AIR LEVELS FOR THIS ',
   3536      $    'REPORT (=',I3,') EXCEEDS LIMIT OF ',I0,' CAT. 04 LEVELS ',
   3537      $    '(EXCLUDING BOTTOM, SFC, LVL) -- '/'     ONLY FIRST ',I0,
   3538      $    ' UPPER-AIR LEVELS PLUS THE SURFACE LEVEL WILL BE PROCESSED'/)
   3539          NLEV = ILVLMX_04
   3540 C.......................................................................
   3541       END IF
   3542       DO I = 1,NLEV
   3543          IF(IPRINT.GT.1)  PRINT 1079, ILC,ILVL
   3544  1079 FORMAT(' ATTEMPTING NEW LEVEL WITH ILC =',I5,'; NO. LEVELS ',
   3545      $ 'PROCESSED TO NOW =',I5)
   3546  
   3547 C       HEIGHT ABOVE SEA-LEVEL (STORED AS REAL)
   3548  
   3549          M = 1
   3550          IF(IPRINT.GT.1)  PRINT 199, UAIR(1,I),M
   3551   199 FORMAT(5X,'UAIR HERE IS: ',F17.4,'; INDEX IS: ',I3)
   3552          IF(UAIR(1,I).LT.XMISS)  THEN
   3553             RDATX(IDATS_04+ILC) = NINT(UAIR(1,I))
   3554 
   3555 C       ... WE HAVE A VALID CATEGORY 4 DATA LEVEL -- THERE IS A VALID
   3556 C            HEIGHT
   3557 
   3558             ILVL = ILVL + 1
   3559          ELSE
   3560 
   3561 C       ... WE DO NOT HAVE A VALID CATEGORY 4 DATA LEVEL -- THERE IS NO
   3562 C            VALID HEIGHT GO ON TO NEXT INPUT LEVEL
   3563 
   3564             IF(IPRINT.GT.1)  PRINT'(" HEIGHT MISSING ON INPUT LEVEL ",
   3565      $       I0,", ALL OTHER DATA SET TO MSG ON THIS LEVEL")', I
   3566             CYCLE
   3567          END IF
   3568          IF(IPRINT.GT.1)  PRINT 198, IDATS_04+ILC,RDATX(IDATS_04+ILC)
   3569  
   3570 C       HORIZONTAL WIND DIRECTION (STORED AS REAL) (VAD FROM RADAR
   3571 C        CODED MESSAGE)
   3572 C       HORIZONTAL U-COMP WIND    (STORED AS REAL) (VAD FROM LEVEL 2
   3573 C        DECODER)
   3574  
   3575          M = 2
   3576          IF(IPRINT.GT.1)  PRINT 199, UAIR(2,I),M
   3577          IF(UAIR(2,I).LT.XMISS)  RDATX(IDATS_04+ILC+1) = UAIR(2,I)
   3578          IF(IPRINT.GT.1) PRINT 198, IDATS_04+ILC+1,RDATX(IDATS_04+ILC+1)
   3579  
   3580 C       HORIZONTAL WIND SPEED     (STORED AS REAL) (VAD FROM RADAR

Page 73          Source Listing                  UNPKB706
2017-04-18 11:09                                 w3unpkb7.f

   3581 C        CODED MESSAGE)
   3582 C       HORIZONTAL V-COMP WIND    (STORED AS REAL) (VAD FROM LEVEL 2
   3583 C        DECODER)
   3584  
   3585          M = 3
   3586          IF(IPRINT.GT.1)  PRINT 199, UAIR(3,I),M
   3587          IF(UAIR(3,I).LT.XMISS) THEN
   3588             IF(ITP.EQ.5) THEN
   3589                RDATX(IDATS_04+ILC+2) = NINT(UAIR(3,I)*10.)
   3590             ELSE IF(ITP.EQ.12) THEN
   3591                RDATX(IDATS_04+ILC+2) = UAIR(3,I)
   3592             END IF
   3593          END IF
   3594          IF(IPRINT.GT.1) PRINT 198, IDATS_04+ILC+2,RDATX(IDATS_04+ILC+2)
   3595  
   3596 C       WIND QUALITY MARKER -- 
   3597 C          IF SDMEDIT/QUIPS WIND QUALITY MARKER IS 12 (REJECT LIST) OR
   3598 C          14 (SDM PURGE) THEN THIS VALUE IS STORED; OTHERWISE IT IS
   3599 C          BASED ON CONFIDENCE LEVEL (WHICH IS ITSELF BASED ON RMS
   3600 C          VECTOR WIND ERROR)
   3601 C          (NOTE: THE LATTER IS CONVERTED TO NUMERICAL INDICATOR --
   3602 C                 SEE W3UNPKB7 DOCBLOCK REMARKS 5 FOR UNPACKED VAD WIND
   3603 C                 REPORT LAYOUT FOR VALUES)
   3604  
   3605          M = 4
   3606          IF(IPRINT.GT.1)  PRINT 199, UAIR(4,I),M
   3607          M = 5
   3608          IF(IPRINT.GT.1)  PRINT 199, UAIR(5,I),M
   3609          IF(UAIR(4,I).EQ.12.OR.UAIR(4,I).EQ.14)  THEN
   3610             RDATX(IDATS_04+ILC+4) = UAIR(4,I)
   3611          ELSE  IF(UAIR(5,I).LT.XMISS)  THEN
   3612 
   3613 C       ... CONVERT FROM METERS/SEC TO KNOTS
   3614 
   3615             IF (ITP .EQ. 5) THEN
   3616 CDAKCDAK       KRMS = INT(1.93333 * UAIR(5,I))
   3617                KRMS = INT(1.9425 * UAIR(5,I))
   3618                IF(KRMS.LT.13)  THEN
   3619                   RDATX(IDATS_04+ILC+4) = RMS(KRMS)
   3620                ELSE
   3621                  RDATX(IDATS_04+ILC+4) = 7.0
   3622                END IF
   3623             ELSE IF (ITP .EQ. 12) THEN
   3624                QFV = UAIR(5,I)
   3625                IF(QFV .EQ. 0) THEN
   3626                  RDATX(IDATS_04+ILC+4) = 1.0
   3627                ELSE IF(QFV .EQ. 1.0) THEN
   3628                  RDATX(IDATS_04+ILC+4) = 2.0
   3629                ELSE
   3630                  RDATX(IDATS_04+ILC+4) = 7.0
   3631                END IF
   3632             END IF
   3633          END IF
   3634          IF(IPRINT.GT.1) PRINT 198, IDATS_04+ILC+4,RDATX(IDATS_04+ILC+4)
   3635 C.......................................................................
   3636          ILC = ILC + 5
   3637          IF(IPRINT.GT.1)  PRINT'(" HAVE COMPLETED LEVEL ",I0,"; GOING ",

Page 74          Source Listing                  UNPKB706
2017-04-18 11:09                                 w3unpkb7.f

   3638      $    "INTO NEXT LEVEL WITH ILC=",I0)', ILVL,ILC
   3639 
   3640       ENDDO    
   3641  
   3642 C       SET DATA LEVEL CATEGORY COUNTERS FOR UPPER-AIR DATA
   3643  
   3644    98 CONTINUE
   3645       IDATA(19) = ILVL
   3646    99 CONTINUE
   3647       IF(IDATA(19).EQ.0)  THEN
   3648          IDATA(20) = 0
   3649          IRET = 5
   3650       ELSE
   3651          IDATA(20) = IDATS_04
   3652       END IF
   3653       IF(IPRINT.GT.1)  PRINT'(" NSFC=",I0,"; IDATA(37)=",I0,
   3654      $ "; IDATA(38)=",I0)', NSFC,IDATA(37),IDATA(38)
   3655       RDATA(1:IDMAX) = RDATX(1:IDMAX)
   3656       RETURN
   3657       END


ENTRY POINTS

  Name                 
                       
 unpkb706_             


SYMBOL CROSS REFERENCE

 Name                       Object Declared Type            Bytes Dimen Elements Attributes       References                        
                                                                                                                                    
 1068                       Label  3122                                                           3121                              
 1078                       Label  3105                                                           3104                              
 1079                       Label  3154                                                           3153                              
 198                        Label  3109                                                           3108,3178,3188,3204,3244          
 199                        Label  3161                                                           3160,3186,3196,3216,3218          
 217                        Label  3130                                                           3129                              
 218                        Label  3136                                                           3135                              
 2186                       Label  3145                                                           3144                              
 98                         Label  3254                                                           3138                              
 99                         Label  3256                                                           3132                              
 BMISS                      Scalar 3085     R(8)            8           scalar   COM              3115                              
 I                          Local  3152     I(4)            4           scalar   SAVE             3152,3160,3162,3163,3175,3186,3187
                                                                                                  ,3196,3197,3199,3201,3216,3218,321
                                                                                                  9,3220,3221,3227,3234             
 IDATA                      Local  3082     I(4)            4     1     2270     SAVE             3255,3257,3258,3261,3264          
 IDATS                      Param  40       I(4)            4           scalar                    43,46,49,52,56,59                 
 IDATS_04                   Scalar 3089     I(4)            4           scalar   COM              3107,3108,3110,3163,3178,3187,3188
                                                                                                  ,3199,3201,3204,3220,3229,3231,323
                                                                                                  6,3238,3240,3244,3261             
 IDATS_08                   Scalar 3089     I(4)            4           scalar   COM                                                
 IDATS_10                   Scalar 3089     I(4)            4           scalar   COM                                                
 IDATS_11                   Scalar 3089     I(4)            4           scalar   COM                                                
 IDATS_12                   Scalar 3089     I(4)            4           scalar   COM                                                
 IDATS_13                   Scalar 3090     I(4)            4           scalar   COM                                                

Page 75          Source Listing                  UNPKB706
2017-04-18 11:09 Symbol Table                    w3unpkb7.f

 Name                       Object Declared Type            Bytes Dimen Elements Attributes       References                        
                                                                                                                                    
 IDATS_14                   Scalar 3090     I(4)            4           scalar   COM                                                
 IDATS_15                   Scalar 3090     I(4)            4           scalar   COM                                                
 IDMAX                      Param  63       I(4)            4           scalar                    3082,3086,3099,3265               
 IDMAX_GOES                 Param  52       I(4)            4           scalar                    63                                
 IDMAX_GPS                  Param  56       I(4)            4           scalar                    64                                
 IDMAX_PROF                 Param  46       I(4)            4           scalar                    63                                
 IDMAX_RASS                 Param  59       I(4)            4           scalar                    64                                
 IDMAX_SCAT                 Param  49       I(4)            4           scalar                    63                                
 IDMAX_VAD                  Param  43       I(4)            4           scalar                    63                                
 ILC                        Local  3102     I(4)            4           scalar   SAVE             3102,3104,3107,3108,3110,3112,3114
                                                                                                  ,3153,3163,3178,3187,3188,3199,320
                                                                                                  1,3204,3220,3229,3231,3236,3238,32
                                                                                                  40,3244,3246,3248                 
 ILVL                       Local  3101     I(4)            4           scalar   SAVE             3101,3104,3111,3114,3153,3168,3248
                                                                                                  ,3255                             
 ILVLMX_04                  Param  15       I(4)            4           scalar                    43,3141,3144,3149                 
 ILVLMX_08                  Param  8        I(4)            4           scalar                    52                                
 ILVLMX_11                  Param  19       I(4)            4           scalar                    46                                
 ILVLMX_12                  Param  22       I(4)            4           scalar                    52                                
 ILVLMX_13                  Param  25       I(4)            4           scalar                    53                                
 ILVLMX_15                  Param  29       I(4)            4           scalar                    59                                
 ILVL_10                    Param  34       I(4)            4           scalar                    46,49                             
 ILVL_14                    Param  37       I(4)            4           scalar                    56                                
 INT                        Func   3227                                 scalar                    3227                              
 IPRINT                     Scalar 3088     I(4)            4           scalar   COM              3104,3108,3113,3121,3153,3160,3174
                                                                                                  ,3178,3186,3188,3196,3204,3216,321
                                                                                                  8,3244,3247,3263                  
 IRET                       Dummy  3074     I(4)            4           scalar   ARG,INOUT        3259                              
 ITP                        Dummy  3074     I(4)            4           scalar   ARG,INOUT        3116,3118,3198,3200,3225,3233     
 KDATE                      Scalar 3088     I(4)            4     1     8        COM                                                
 KRMS                       Local  3227     I(4)            4           scalar   SAVE             3227,3228,3229                    
 KTIMCH                     Scalar 3088     I(4)            4           scalar   COM                                                
 LDATE                      Scalar 3088     I(4)            4     1     8        COM                                                
 LUNIT                      Dummy  3074     I(4)            4           scalar   ARG,INOUT        3117,3119                         
 M                          Local  3159     I(4)            4           scalar   SAVE             3159,3160,3185,3186,3195,3196,3215
                                                                                                  ,3216,3217,3218                   
 MAX                        Func   63                                   scalar                    63                                
 NINT                       Func   3163                                 scalar                    3163,3199                         
 NLEV                       Local  3117     I(4)            4           scalar   SAVE             3117,3119,3121,3124,3141,3144,3149
                                                                                                  ,3152                             
 NSFC                       Local  3100     I(4)            4           scalar   SAVE             3100,3110,3114,3127,3264          
 PKB7AA                     Common 3087                                 8        SAVE                                               
 PKB7BB                     Common 3088                                 76       SAVE                                               
 PKB7GG                     Common 3089                                 32       SAVE                                               
 QFV                        Local  3083     I(4)            4           scalar   SAVE             3234,3235,3237                    
 RDATA                      Dummy  3074     R(4)            4     1     0        ARG,INOUT        3099,3265                         
 RDATX                      Local  3086     R(4)            4     1     2270     SAVE             3099,3107,3108,3110,3163,3178,3187
                                                                                                  ,3188,3199,3201,3204,3220,3229,323
                                                                                                  1,3236,3238,3240,3244,3265        
 RMS                        Local  3086     R(4)            4     1     13       SAVE             3098,3229                         
 SKIP_CAT12                 Scalar 3084     L(4)            4           scalar   COM                                                
 UAIR                       Local  3086     R(4)            4     2     1275     SAVE             3117,3119,3160,3162,3163,3186,3187
                                                                                                  ,3196,3197,3199,3201,3216,3218,321
                                                                                                  9,3220,3221,3227,3234             
 UAIR1                      Local  3081     CHAR            25          scalar   SAVE             3096,3117                         

Page 76          Source Listing                  UNPKB706
2017-04-18 11:09 Symbol Table                    w3unpkb7.f

 Name                       Object Declared Type            Bytes Dimen Elements Attributes       References                        
                                                                                                                                    
 UAIR2                      Local  3081     CHAR            25          scalar   SAVE             3097,3119                         
 UAIR_8                     Local  3085     R(8)            8     2     1275     SAVE             3115,3117,3119                    
 UFBINT                     Subr   3117                                                           3117,3119                         
 UNPKB706                   Subr   3074                                                                                             
 XMISS                      Local  3095     R(4)            4           scalar   SAVE             3095,3110,3162,3187,3197,3221     

Page 77          Source Listing                  UNPKB706
2017-04-18 11:09                                 w3unpkb7.f

   3658 
   3659 C$$$  SUBPROGRAM DOCUMENTATION BLOCK
   3660 C
   3661 C SUBPROGRAM:    UNPKB707
   3662 C   PRGMMR: WHITING          ORG: EMC        DATE: 2015-04-16
   3663 C
   3664 C ABSTRACT: FOR REPORT (SUBSET) READ OUT OF BUFR MESSAGE (PASSED IN
   3665 C   INTERNALLY VIA BUFRLIB STORAGE), CALLS BUFRLIB ROUTINE TO DECODE
   3666 C   UPPER-AIR (SOUNDING), ADDITIONAL DATA, AND RADIANCES FOR GOES
   3667 C   SOUNDING/RADIANCE REPORT.  UPPER-AIR DATA ARE THEN FILLED INTO THE
   3668 C   OUTPUT ARRAY AS DATA LEVEL CATEGORY 12 (SATELLITE SOUNDING),
   3669 C   ADDITIONAL DATA ARE FILLED AS DATA LEVEL CATEGORY 8 (ADDITIONAL
   3670 C   DATA) AND RADIANCE DATA ARE FILLED AS DATA LEVEL CATEGORY 13
   3671 C   (SATELLITE RADIANCE) THE OUTPUT ARRAY HOLDS A SINGLE GOES SOUNDING
   3672 C   IN THE QUASI-IW3UNPBF UNPACKED FORMAT.
   3673 C
   3674 C PROGRAM HISTORY LOG:
   3675 C 1997-06-05  D. A. KEYSER NP22 - ORIGINAL AUTHOR
   3676 C ????-??-??  D. A. KEYSER NP22 - ADDED CAT. 13 (RADIANCE) PROCESSING
   3677 C 2001-04-06  D. A. KEYSER NP22 - CAT. 8 TYPES ARE NO LONGER SCALED,
   3678 C     BUT STORED IN THE SAME UNITS/SCALING AS FOUND UPON INPUT; CAT. 13
   3679 C     BRIGHTNESS TEMPERATURES ARE NOW STORED AS DEG. K (PRECISE TO
   3680 C     10**2) RATHER THAN AS DEG. K X 100; NOW SKIPS CAT. 12 LEVELS
   3681 C     WHERE RETRIEVED GEOPOTENTIAL HGHT IS .LE. ELEVATION (LOWEST
   3682 C     RETRIEVED HEIGHT); NOW UNPACKS SURFACE PRESSURE INTO CAT. 8 CODE
   3683 C     FIGURE 262
   3684 C 2001-06-19  D. A. KEYSER -- RECOGNIZES BUFR TYPE/SUBTYPE 003/002 AS
   3685 C     GOES 1x1 (HI-RES) DATA, PART OF THE "GOESND" DUMP FILE ("SUBSET"
   3686 C     ADDED TO INPUT ARGUMENT LIST); STORES CLOUD COVER RATHER THAN
   3687 C     CLOUD AMOUNT IN OUTPUT CAT. 8, C.F. 258 FOR GOES HI-RES REPORTS
   3688 C 2001-07-10  D. A. KEYSER -- NOW KEEPS SEPARATE COUNT OF REPORTS WITH
   3689 C     MISSING # FOV (E.G., CLOUD-TOP REPORTS), BEFORE THESE WERE
   3690 C     GROUPED WITH # FOV 10-25
   3691 C 2004-09-09  D. A. KEYSER -- ADDED LOGIC TO HANDLE GOES 1x1 (SFOV)
   3692 C     SOUNDING (RADIANCE/RETRIEVAL) DATA: DOES NOT Q.C. ANY 1x1 DATA
   3693 C     (CLOUD AS BEFORE, BUT NOW ALSO SNDGS) BY NUMBER OF FOV's (STILL
   3694 C     DOES SO FOR NON-RADIANCE 5x5 DATA); FOR GOES PW RETRIEVALS, IF
   3695 C     TPW IS NOT FOUND UNDER LOCAL MNEMONIC "PH2O", NOW LOOKS FOR IT IN
   3696 C     WMO MNEMONIC "TPWT", THIS ALLOWS FOR TRANSITION FROM "PH2O" TO
   3697 C     "TPWT" IN REPORTS IN DUMP FILES (~ MID-2004) AND ALSO ALLOWS
   3698 C     HISTORICAL RERUNS TO READ OLD DUMP FILES
   3699 C 2006-07-14  D. A. KEYSER (THIS FUNCTION IN PROGRAM BUFR_LISTDUMPS):
   3700 C 2007-09-14  D. A. KEYSER (THIS FUNCTION IN PROGRAM PREPOBS_PREPDATA):
   3701 C     NUMBER OF FIELDS-OF-VIEW (USED IN Q.C. PROCESSING) IS NOW
   3702 C     OBTAINED FROM WORD 2 OF NEW "RDATA2" ARRAY (HOLDS VALUES DECODED
   3703 C     DIRECTLY FROM BUFR) RATHER FROM WORD 3 OF HEADER IN "RDATA" ARRAY
   3704 C 2007-09-14  D. A. KEYSER (THIS FUNCTION IN PROGRAM BUFR_LISTDUMPS):
   3705 C 2007-09-14  D. A. KEYSER (THIS FUNCTION IN PROGRAM PREPOBS_PREPDATA):
   3706 C     HANDLES GOES 1x1 F-O-V SNDGS/RADIANCES IN SUBSET "NC003003"; CODE
   3707 C     FIGURE 258 REFERS ONLY TO CLOUD AMOUNT (HAD ALSO PREVIOUSLY
   3708 C     REFERRED TO CLOUD COVER FOR GOES 1x1 SNDGS - GOES 1x1 AND 5x5
   3709 C     SNDGS NOW BOTH PROCESS CLOUD AMOUNT)
   3710 C 2013-02-14  D. A. KEYSER -- FOR ANY "GOESND" OR "GOESFV" DUMP FILES
   3711 C     WITH CENTER TIME 2013022512 OR LATER, NO ATTEMPT IS MADE TO
   3712 C     DECODE GOES SOUNDINGS (PROFILES) AS THESE WERE REMOVED AT THIS
   3713 C     TIME FROM THE 1X1 GOES RADIANCE FILES PROVIDED BY NESDIS
   3714 C     (INGESTED INTO FROM TANK b003/xx003)

Page 78          Source Listing                  UNPKB706
2017-04-18 11:09                                 w3unpkb7.f

   3715 C 2015-04-16 JWhiting --  RDATA2(25) stores total cloud cover (TOCC)
   3716 C     (present in dumps of GOES cloud reports).
   3717 C
   3718 C USAGE:    CALL UNPKB707(LUNIT,RDATA,RDATA2,subset,IRET)
   3719 C   INPUT ARGUMENT LIST:
   3720 C     LUNIT    - FORTRAN UNIT NUMBER FOR INPUT DATA FILE
   3721 C     RDATA    - SINGLE GOES SNDG REPORT IN A QUASI-IW3UNPBF
   3722 C              - UNPACKED FORMAT WITH ONLY HEADER INFORMATION FILLED
   3723 C              - IN (CATEGORY 12, 8 AND 13 8 DATA MISSING)
   3724 C     RDATA2   - 25-WORD ARRAY CONTAINING ADDITIONAL REPORT DATA NOT
   3725 C              - PRESENT IN RDATA ARRAY (DECODED DIRECTLY FROM BUFR)
   3726 C              - (ONLY WORDS 2 AND 7 FILLED IN - SEE W3UNPKB7 DOCBLOCK
   3727 C              - REMARKS 6 FOR CONTENT)
   3728 C     SUBSET   - CHARACTER*8 BUFR MESSAGE TYPE (SAME FOR ALL REPORTS
   3729 C              - IN A COMMON BUFR MESSAGE)
   3730 C
   3731 C   OUTPUT ARGUMENT LIST:
   3732 C     RDATA    - SINGLE GOES SNDG REPORT IN A QUASI-IW3UNPBF
   3733 C              - UNPACKED FORMAT WITH CATEGORY 12, 8 AND 13
   3734 C              - INFORMATION FILLED IN (ALL DATA FOR REPORT NOW
   3735 C              - FILLED)
   3736 C     IRET     - RETURN CODE AS DESCRIBED IN W3UNPKB7 DOCBLOCK
   3737 C
   3738 C   OUTPUT FILES:
   3739 C     UNIT 06  - PRINTOUT
   3740 C
   3741 C REMARKS: CALLED BY SUBROUTINE W3UNPKB7.
   3742 C
   3743 C ATTRIBUTES:
   3744 C   LANGUAGE: FORTRAN 90
   3745 C   MACHINE:  NCEP WCOSS
   3746 C
   3747 C$$$
   3748       SUBROUTINE UNPKB707(LUNIT,RDATA,RDATA2,subset,IRET)
   3749 
   3750 C  Include parameters common to more than one subroutine
   3751 C  -----------------------------------------------------
   3752 
   3753       include 'inc_w3unpkb7.inc'
   3754 
   3820       character*8   subset
   3821       CHARACTER*37  CAT8A,CAT8B
   3822       CHARACTER*48  UAIR1,RAD1
   3823       INTEGER  IDATA(IDMAX),ICDFG(ILVLMX_08)
   3824       LOGICAL  SKIP_CAT12
   3825       REAL(8) UAIR_8(4,255),CAT8_8(12),RTCSF_8,RAD_8(2,255),BMISS
   3826       REAL(8) TOCC_8
   3827       REAL UAIR(4,255),CAT8(ILVLMX_08),SCALE(ILVLMX_08),RDATA(*),
   3828      $ RDATX(IDMAX),RAD(2,255),ZMISS(ILVLMX_08),RDATA2(25)
   3829       COMMON /PKB7AA/BMISS
   3830       COMMON /PKB7BB/KDATE(8),LDATE(8),KTIMCH,IPRINT,SKIP_CAT12
   3831       COMMON /PKB7FF/IFOV(4,2),KNTSAT(250:260)
   3832       COMMON /PKB7GG/IDATS_04,IDATS_08,IDATS_10,IDATS_11,IDATS_12,
   3833      $ IDATS_13,IDATS_14,IDATS_15
   3834  
   3835       SAVE
   3836  

Page 79          Source Listing                  UNPKB707
2017-04-18 11:09                                 w3unpkb7.f

   3837       EQUIVALENCE (RDATX,IDATA)
   3838       DATA  XMISS/99999./,YMISS/99999.8/
   3839       DATA  UAIR1/'PRLC HGHT TMDB TMDP                             '/
   3840       DATA  RAD1 /'CHNM TMBR                                       '/
   3841       DATA  CAT8A/'GLFTI PH2O PH2O19 PH2O97 PH2O73 TMSK '/
   3842       DATA  CAT8B/'GCDTT CDTP CLAM   SIDU   SOEL   ELEV '/
   3843       DATA  ZMISS/ 99999.,  99999.,  99999.,  99999.,  99999.,
   3844      $             99999.,  99999., 999999.,  99999.,  99999.,
   3845      $             99999.,  99999.,  99999./
   3846       DATA ICDFG/   50,   51,  52,    53,    54,    55,
   3847      $              56,   57,  58,    59,    60,    61,    62/
   3848       DATA SCALE/  1.0,  1.0, 1.0,   1.0,   1.0,   1.0,
   3849      $             1.0,  .01, 1.0,   1.0,   1.0,   1.0,   1.0/
   3850       RDATX(1:IDMAX) = RDATA(1:IDMAX)
   3851 
   3852       QMFLG = 2.0
   3853 
   3854       IF(SUBSET(8:8).EQ.'1') THEN
   3855 
   3856 C ALL NON-RADIANCE 5x5 FOV DATA WILL BE Q.C.'D ACCORDING TO NUMBER OF
   3857 C  FIELDS-OF-VIEW FOR RETRIEVAL:  0-2 --> BAD, 3-9 --> SUSPECT, 10-25
   3858 C  OR MISSING --> NEUTRAL
   3859 
   3860          IF(NINT(RDATA2(2)).LT.3)  THEN
   3861             QMFLG = 13.0
   3862             IFOV(1,1) = IFOV(1,1) + 1
   3863          ELSE  IF(NINT(RDATA2(2)).LT.10.OR.NINT(RDATA2(7)).EQ.1)  THEN
   3864             QMFLG = 3.0
   3865             IF(NINT(RDATA2(2)).LT.10)  IFOV(2,1) = IFOV(2,1) + 1
   3866          END IF
   3867          IF(NINT(RDATA2(2)).GT.25)  THEN
   3868             IFOV(4,1) = IFOV(4,1) + 1
   3869          ELSE  IF(NINT(RDATA2(2)).GT.9)  THEN
   3870             IFOV(3,1) = IFOV(3,1) + 1
   3871          END IF
   3872 
   3873       ELSE
   3874 
   3875 C ALL NON-RADIANCE 1x1 FOV DATA GET NEUTRAL Q. MARK REGARDLESS OF
   3876 C  FIELD-OF-VIEW NUMBER (BUT STILL KEEP TRACK OF COUNTS BY FOV)
   3877 
   3878          IF(NINT(RDATA2(2)).GT.0.AND.NINT(RDATA2(2)).LT.4)  THEN
   3879             IFOV(NINT(RDATA2(2)),2) = IFOV(NINT(RDATA2(2)),2) + 1
   3880          ELSE 
   3881             IFOV(4,2) = IFOV(4,2) + 1
   3882          END IF
   3883 
   3884       END IF
   3885 
   3886       PSFC   = XMISS
   3887 
   3888       IF(SKIP_CAT12) GO TO 98 ! skip attempt to process soundings if
   3889                               ! center dump date is 2013022512 or later
   3890 
   3891 C***********************************************************************
   3892 C              FILL DATA LEVEL CATEGORY 12 PART OF OUTPUT
   3893 C***********************************************************************

Page 80          Source Listing                  UNPKB707
2017-04-18 11:09                                 w3unpkb7.f

   3894 
   3895       ILVL = 0
   3896       ILC  = 0
   3897       UAIR_8 = BMISS
   3898       ELEV   = -99999.
   3899       CALL UFBINT(LUNIT,UAIR_8,4,255,NLEV,UAIR1);UAIR=UAIR_8
   3900       IF(IPRINT.GT.1)  PRINT 1068, NLEV
   3901  1068 FORMAT(' THIS REPORT CONTAINS',I4,' INPUT LEVELS OF SOUNDING ',
   3902      $ 'DATA')
   3903       IF(NLEV.EQ.0)  THEN
   3904 C.......................................................................
   3905 C PROBLEM: THE NUMBER OF DECODED "LEVELS" IS ZERO --
   3906          if (subset.eq.'NC003002')  go to 98  ! Currently all of the
   3907                                               ! cloud 1x1 reports
   3908                                               ! have none (remove this
   3909                                               ! if NESDIS ever combines
   3910                                               ! cloud and PW/rad. 1x1's)
   3911          PRINT 217
   3912   217    FORMAT(/'##W3UNPKB7: NO UPPER-AIR (SOUNDING) DATA PROCESSED ',
   3913      $   'FOR THIS  REPORT -- NLEV = 0'/)
   3914          GO TO 98
   3915 C.......................................................................
   3916       ELSE  IF(NLEV.GT.ILVLMX_12)  THEN
   3917 C PROBLEM: THE NO. OF DECODED "LEVELS" IS .GT. LIMIT OF "ILVLMX_12" --
   3918          PRINT 2186, NLEV,ILVLMX_12,ILVLMX_12
   3919  2186    FORMAT(/'##W3UNPKB7: NUMBER OF UPPER-AIR LEVELS FOR THIS ',
   3920      $    'REPORT (=',I3,') EXCEEDS LIMIT OF ',I0,' CAT. 12 LEVELS -- ',
   3921      $    'ONLY FIRST ',I0,' LEVELS WILL BE PROCESSED'/)
   3922          NLEV = ILVLMX_12
   3923 C.......................................................................
   3924       END IF
   3925       DO I = 1,NLEV
   3926          IF(IPRINT.GT.1)  PRINT 1079, I,ILC,ILVL
   3927  1079 FORMAT(' ATTEMPTING NEW CAT. 12 INPUT LEVEL NUMBER',I4,' WITH ',
   3928      $ 'ILC =',I5,'; NO. LEVELS PROCESSED TO NOW =',I5)
   3929  
   3930 C       LEVEL PRESSURE, ELEVATION (STORED AS REAL)
   3931  
   3932          M = 1
   3933          IF(IPRINT.GT.1)  PRINT 199, UAIR(1,I),M
   3934   199 FORMAT(5X,'UAIR HERE IS: ',F17.4,'; INDEX IS: ',I3)
   3935          IF(I.EQ.1)  THEN
   3936             IF(UAIR(1,I).LT.999999.) PSFC = UAIR(1,I) * 0.01
   3937             IF(UAIR(2,1).LT.XMISS)  THEN
   3938                ELEV = UAIR(2,1)
   3939             ELSE
   3940 C.......................................................................
   3941 C PROBLEM: THE ELEVATION IS MISSING --
   3942                PRINT 6217
   3943  6217          FORMAT(/'##W3UNPKB7: NO UPPER-AIR (SOUNDING) DATA ',
   3944      $          'PROCESSED FOR THIS  REPORT -- ELEV IS MISSING'/)
   3945                GO TO 98
   3946 C.......................................................................
   3947             END IF
   3948          ELSE  IF(UAIR(1,I)*0.1.GE.YMISS)  THEN
   3949 C WE DO NOT HAVE A VALID CATEGORY 12 LEVEL -- THERE IS NO VALID PRESSURE
   3950 C  -- GO ON TO NEXT INPUT LEVEL (IF SFC LEVEL MSG, CONTINUE PROCESSING)

Page 81          Source Listing                  UNPKB707
2017-04-18 11:09                                 w3unpkb7.f

   3951             IF(IPRINT.GT.1)  PRINT'(" PRESSURE MISSING ON INPUT LEVEL ",
   3952      $       I0,", SKIP THE PROCESSING OF THIS LEVEL")', I
   3953             CYCLE
   3954          ELSE  IF(UAIR(1,I)*0.01.GE.PSFC)  THEN
   3955 C WE DO NOT HAVE A VALID CATEGORY 12 LEVEL -- THE INPUT LEVEL PRESSURE
   3956 C  IS BELOW THE SURFACE PRESSURE -- GO ON TO THE NEXT INPUT LEVEL
   3957             IF(IPRINT.GT.1)  PRINT'(" PRESSURE ON INPUT LEVEL ",I0,
   3958      $       " IS BELOW GROUND, SKIP THE PROCESSING OF THIS LEVEL")', I
   3959             CYCLE
   3960          ELSE  IF(UAIR(2,I).LE.ELEV)  THEN
   3961 C WE DO NOT HAVE A VALID CATEGORY 12 LEVEL -- THE INPUT LEVEL 
   3962 C  GEOPOTENTIAL HEIGHT IS NOT GREATER THAN THE ELEVATION -- GO ON TO THE
   3963 C  NEXT INPUT LEVEL
   3964             IF(IPRINT.GT.1)  PRINT'(" GEOPOTENTIAL HEIGHT ON INPUT ",
   3965      $       "LEVEL ",I0," IS .LE. ELEVATION, SKIP THE PROCESSING OF ",
   3966      $       "THIS LEVEL")', I
   3967             CYCLE
   3968          END IF
   3969 
   3970 C WE HAVE A VALID CATEGORY 12 LEVEL -- THERE IS A VALID PRESSURE AND
   3971 C  THE GEOPOTENTIAL HEIGHT IS GREATER THAN THE ELEVATION
   3972 
   3973        IF(UAIR(1,I)*0.1.LT.XMISS)RDATX(IDATS_12+ILC)=NINT(UAIR(1,I)*0.1)
   3974          ILVL = ILVL + 1
   3975          IF(IPRINT.GT.1)  PRINT 198, IDATS_12+ILC,RDATX(IDATS_12+ILC)
   3976   198 FORMAT(5X,'RDATA(',I5,') STORED AS: ',F10.2)
   3977  
   3978 C       GEOPOTENTIAL HEIGHT (STORED AS REAL)
   3979  
   3980          M = 2
   3981          IF(IPRINT.GT.1)  PRINT 199, UAIR(2,I),M
   3982          IF(UAIR(2,I).LT.XMISS)  RDATX(IDATS_12+ILC+1) = NINT(UAIR(2,I))
   3983          IF(IPRINT.GT.1) PRINT 198, IDATS_12+ILC+1,RDATX(IDATS_12+ILC+1)
   3984          IF(I.EQ.1)  THEN
   3985             IF(IPRINT.GT.1)  PRINT'(" THIS IS SURFACE LEVEL, SO STORE ",
   3986      $       "HEIGHT ALSO AS ELEVATION IN HEADER")'
   3987             IF(UAIR(2,1).LT.XMISS)  RDATX(7) = NINT(UAIR(2,1))
   3988             NNNNN = 7
   3989             IF(IPRINT.GT.1)  PRINT 198, NNNNN,RDATX(NNNNN)
   3990          END IF
   3991  
   3992 C       TEMPERATURE (STORED AS REAL)
   3993  
   3994          M = 3
   3995          IF(IPRINT.GT.1)  PRINT 199, UAIR(3,I),M
   3996          ITMP = NINT(UAIR(3,I)*100.)
   3997          IF(UAIR(3,I).LT.XMISS)
   3998      $    RDATX(IDATS_12+ILC+2) = NINT((ITMP - 27315) * 0.1)
   3999          IF(IPRINT.GT.1) PRINT 198, IDATS_12+ILC+2,RDATX(IDATS_12+ILC+2)
   4000  
   4001 C       DEWPOINT TEMPERATURE (STORED AS REAL)
   4002  
   4003          M = 4
   4004          IF(IPRINT.GT.1)  PRINT 199, UAIR(4,I),M
   4005          ITMP = NINT(UAIR(4,I)*100.)
   4006          IF(UAIR(4,I).LT.XMISS)
   4007      $    RDATX(IDATS_12+ILC+3) = NINT((ITMP - 27315) * 0.1)

Page 82          Source Listing                  UNPKB707
2017-04-18 11:09                                 w3unpkb7.f

   4008          IF(IPRINT.GT.1) PRINT 198, IDATS_12+ILC+3,RDATX(IDATS_12+ILC+3)
   4009  
   4010 C       GEOPOTENTIAL QUALITY MARKER (STORED AS REAL)
   4011  
   4012          RDATX(IDATS_12+ILC+6) = QMFLG
   4013          IF(IPRINT.GT.1) PRINT 198, IDATS_12+ILC+6,RDATX(IDATS_12+ILC+6)
   4014  
   4015 C       TEMPERATURE QUALITY MARKER (STORED AS REAL)
   4016  
   4017          RDATX(IDATS_12+ILC+7) = QMFLG
   4018          IF(IPRINT.GT.1) PRINT 198, IDATS_12+ILC+7,RDATX(IDATS_12+ILC+7)
   4019  
   4020 C       DEWPOINT TEMPERATURE QUALITY MARKER (STORED AS REAL)
   4021  
   4022          RDATX(IDATS_12+ILC+8) = QMFLG
   4023          IF(IPRINT.GT.1) PRINT 198, IDATS_12+ILC+8,RDATX(IDATS_12+ILC+8)
   4024 C.......................................................................
   4025          ILC = ILC + 9
   4026          IF(I+1.LE.NLEV.AND.IPRINT.GT.1)  PRINT'(" HAVE COMPLETED ",
   4027      $    "LEVEL ",I0,"; GOING INTO NEXT LEVEL WITH ILC=",I0)', ILVL,ILC
   4028 
   4029       ENDDO    
   4030  
   4031 C       SET DATA LEVEL CATEGORY COUNTERS FOR CATEGORY 12 (SNDG) DATA
   4032  
   4033       IDATA(39) = ILVL
   4034    98 CONTINUE
   4035       IF(IPRINT.GT.1)  PRINT'(1X,I0," CAT. 12 LEVELS PROCESSED")',
   4036      $ IDATA(39)
   4037       IF(IDATA(39).GT.0)  IDATA(40) = IDATS_12
   4038  
   4039 C***********************************************************************
   4040 C              FILL DATA LEVEL CATEGORY 8 PART OF OUTPUT
   4041 C        WILL ATTEMPT TO FILL "ILVLMX_08" (CURRENTLY 13) "LEVELS"
   4042 C
   4043 C LVL  1: LIFTED INDEX (DEG. K TO 10**2 PREC. - RELATIVE) -CODE FIG. 250
   4044 C LVL  2: TOTAL COLUMN PRECIP. WATER (MM TO 10**1 PREC.) - CODE FIG. 251
   4045 C LVL  3: 1. TO .9 SIGMA LYR P.WATER (MM TO 10**1 PREC.) - CODE FIG. 252
   4046 C LVL  4: .9 TO .7 SIGMA LYR P.WATER (MM TO 10**1 PREC.) - CODE FIG. 253
   4047 C LVL  5: .7 TO .3 SIGMA LYR P.WATER (MM TO 10**1 PREC.) - CODE FIG. 254
   4048 C LVL  6: SKIN TEMPERATURE (DEG. K TO 10**2 PREC.) ------- CODE FIG. 255
   4049 C LVL  7: CLOUD TOP TEMPERATURE (DEG. K TO 10**2 PREC.) -- CODE FIG. 256
   4050 C LVL  8: CLOUD TOP PRESSURE (MB TO 10**1 PREC.) --------- CODE FIG. 257
   4051 C LVL  9: CLOUD AMOUNT (C. FIG. BUFR TABLE 0-20-011) ----- CODE FIG. 258
   4052 C LVL 10: INSTR. DATA USED IN PROC.
   4053 C                      (C. FIG. BUFR TABLE 0-02-021) ----- CODE FIG. 259
   4054 C LVL 11: SOLAR ZENITH ANGLE (SOLAR ELEV) (DEG. TO 10**2 PREC.)
   4055 C                                                       -- CODE FIG. 260
   4056 C LVL 12: SATELLITE ZENITH ANGLE (ELEV) (DEG. TO 10**2 PREC.)
   4057 C                                                       -- CODE FIG. 261
   4058 C LVL 13: SURFACE PRESSURE (MB TO 10**1 PREC.) ----------- CODE FIG. 262
   4059 C
   4060 C     IF DATA ONE ANY LEVEL ARE MISSING, THAT LEVEL IS NOT PROCESSED
   4061 C***********************************************************************
   4062  
   4063       ILVL = 0
   4064       ILC = 0

Page 83          Source Listing                  UNPKB707
2017-04-18 11:09                                 w3unpkb7.f

   4065       CAT8_8 = BMISS
   4066       nlev8 = 0
   4067       CALL UFBINT(LUNIT,CAT8_8,12,1,NLEV8,CAT8A//CAT8B)
   4068 
   4069 C  Get total cloud cover for GOES cloud reports (in msg type NC003002)
   4070 C  -------------------------------------------------------------------
   4071 
   4072       CALL UFBINT(LUNIT,TOCC_8,1,1,NRET,'TOCC')
   4073       RDATA2(25)=TOCC_8
   4074 
   4075 C  Sometime in mid-2004, "TPWT" will replace "PH2O" for tpw - if one
   4076 C   is missing, look for the other (for historical reruns)
   4077 C  -----------------------------------------------------------------
   4078 
   4079       IF(IBFMS(CAT8_8(2)).NE.0)
   4080      $ CALL UFBINT(LUNIT,CAT8_8(2),1,1,LLEV8,'TPWT')
   4081       CAT8(1:12)=CAT8_8
   4082       CAT8(13) = PSFC
   4083       IF(NLEV8.NE.1)  THEN
   4084          IF(NLEV8.EQ.0)  THEN
   4085 C.......................................................................
   4086 C PROBLEM: THE NUMBER OF DECODED "LEVELS" IS ZERO --
   4087             PRINT 318
   4088   318 FORMAT(/'##W3UNPKB7: NO ADDITIONAL (CAT. 8) DATA PROCESSED FOR ',
   4089      $ 'THIS  REPORT -- NLEV8 = 0'/)
   4090             GO TO 99
   4091 C.......................................................................
   4092          ELSE
   4093 C.......................................................................
   4094 C PROBLEM: THE NUMBER OF DECODED "LEVELS" IS NOT WHAT IS EXPECTED --
   4095 C  SET IRET = 7 AND RETURN
   4096             PRINT 219, NLEV8
   4097   219 FORMAT(/'##W3UNPKB7: THE NUMBER OF DECODED "LEVELS" (=',I5,') ',
   4098      $ 'IS NOT WHAT IS EXPECTED (1) - IRET = 7'/)
   4099             IRET = 7
   4100             RETURN
   4101 C.......................................................................
   4102          END IF
   4103       END IF
   4104 
   4105 C THE TEMPERATURE CHANNEL SELECTION FLAG WILL BE USED LATER TO
   4106 C  DETERMINE Q. MARK FOR SKIN TEMPERATURE (IF 0 - OK, OTHERWISE - BAD)
   4107 
   4108       RTCSF_8 = BMISS
   4109       CALL UFBINT(LUNIT,RTCSF_8,1,1,NLEV0,'TCSF');RTCSF=RTCSF_8
   4110       ITCSF = 1
   4111       M = 1
   4112       IF(IPRINT.GT.1)  PRINT 299, RTCSF,M
   4113   299 FORMAT(5X,'RTCSF HERE IS: ',F17.4,'; INDEX IS: ',I3)
   4114       IF(RTCSF.LT.XMISS)  ITCSF = NINT(RTCSF)
   4115       IF(IPRINT.GT.1)  PRINT 1798, ITCSF
   4116  1798 FORMAT(5X,'ITCSF IS: ',I10)
   4117 
   4118 C LOOP THROUGH THE "ILVLMX_08" POSSIBLE ADDITIONAL DATA "LEVELS"
   4119 
   4120       DO M = 1,ILVLMX_08
   4121          IF(IPRINT.GT.1)  PRINT 6079, M,ILC,ILVL

Page 84          Source Listing                  UNPKB707
2017-04-18 11:09                                 w3unpkb7.f

   4122  6079 FORMAT(' ATTEMPTING MISCEL. INPUT',I5,' WITH ILC =',I5,'; NO. ',
   4123      $ 'OUTPUT CAT.  8 LVLS PROCESSED TO NOW =',I5)
   4124          IF(IPRINT.GT.1)  PRINT 399, CAT8(M),M
   4125   399 FORMAT(5X,'CAT8 HERE IS: ',F17.4,'; INDEX IS: ',I3)
   4126          IF(CAT8(M).LT.ZMISS(M))  THEN
   4127 
   4128 C WE HAVE A VALID CATEGORY 8 DATA "LEVEL"
   4129 
   4130             ILVL = ILVL + 1
   4131 
   4132 C STORE THE DATUM IN WORD 1 OF THE CAT. 8 DATA LEVEL
   4133 
   4134             RDATX(IDATS_08+ILC) = CAT8(M)*SCALE(M)
   4135             IF(IPRINT.GT.1)  PRINT 198, IDATS_08+ILC,RDATX(IDATS_08+ILC)
   4136 
   4137 C STORE THE CAT. 8 CODE FIGURE IN WORD 2 OF THE CAT. 8 DATA LEVEL
   4138 
   4139             RDATX(IDATS_08+ILC+1) = REAL(200+ICDFG(M))
   4140            IF(IPRINT.GT.1)PRINT 198,IDATS_08+ILC+1,RDATX(IDATS_08+ILC+1)
   4141 
   4142 C STORE THE DATUM QUALITY MARKER IN WORD 3 OF THE CAT. 8 DATA LEVEL
   4143 
   4144             RDATX(IDATS_08+ILC+2) = QMFLG
   4145 
   4146 C IF THIS DATUM IS SKIN TEMPERATURE AND THE TEMPERATURE CHANNEL
   4147 C  SELECTION FLAG IS BAD (.NE. 0), SET QUALITY MARKER TO 13.0 (BAD)
   4148 
   4149             IF(M.EQ.6.AND.ITCSF.NE.0)  RDATX(IDATS_08+ILC+2) = 13.0
   4150            IF(IPRINT.GT.1)PRINT 198,IDATS_08+ILC+2,RDATX(IDATS_08+ILC+2)
   4151 
   4152 C.......................................................................
   4153 
   4154             ILC = ILC + 4
   4155             IF(M.LT.ILVLMX_08.AND.IPRINT.GT.1) PRINT'(" HAVE COMPLETED",
   4156      $       " OUTPUT LVL",I0,"; GOING INTO NEXT INPUT DATUM WITH ILC=",
   4157      $       I0)', ILVL,ILC
   4158          ELSE
   4159             IF(IPRINT.GT.1)  PRINT'(" DATUM MISSING ON INPUT ",I0,
   4160      $       ", GO ON TO NEXT INPUT DATUM (NO. LVLS PROCESSED SO FAR=",
   4161      $       I0,"; ILC=",I0,")")', M,ILVL,ILC
   4162          END IF
   4163       ENDDO
   4164  
   4165 C       SET DATA LEVEL CATEGORY COUNTERS FOR CATEGORY 8 (ADD'L) DATA
   4166  
   4167       IDATA(27) = ILVL
   4168    99 CONTINUE
   4169       IF(IPRINT.GT.1)  PRINT'(1X,I0," CAT. 08 LEVELS PROCESSED")',
   4170      $ IDATA(27)
   4171       IF(IDATA(27).GT.0)  IDATA(28) = IDATS_08
   4172 
   4173 C***********************************************************************
   4174 C          FILL DATA LEVEL CATEGORY 13 PART OF OUTPUT (RADIANCES)
   4175 C***********************************************************************
   4176 
   4177       ILVL = 0
   4178       ILC =  0

Page 85          Source Listing                  UNPKB707
2017-04-18 11:09                                 w3unpkb7.f

   4179       RAD_8 = BMISS
   4180       CALL UFBINT(LUNIT,RAD_8,2,255,NLEV13,RAD1);RAD=RAD_8
   4181       IF(IPRINT.GT.1)  PRINT 2068, NLEV13
   4182  2068 FORMAT(' THIS REPORT CONTAINS',I4,' INPUT LEVELS (CHANNELS) OF ',
   4183      $ 'RADIANCE DATA')
   4184       IF(NLEV13.EQ.0)  THEN
   4185 C.......................................................................
   4186 C PROBLEM: THE NUMBER OF DECODED "LEVELS" IS ZERO --
   4187          if (subset.eq.'NC003002')  go to 100 ! Currently all of the
   4188                                               ! cloud 1x1 reports
   4189                                               ! have none (remove this
   4190                                               ! if NESDIS ever combines
   4191                                               ! cloud and PW/rad. 1x1's)
   4192          PRINT 417
   4193   417    FORMAT(/'##W3UNPKB7: NO RADIANCE DATA PROCESSED FOR THIS ',
   4194      $    'REPORT -- NLEV13 = 0'/)
   4195          GO TO 100
   4196 C.......................................................................
   4197       ELSE  IF(NLEV13.GT.ILVLMX_13)  THEN
   4198 C PROBLEM: THE NO. OF DECODED "LEVELS" IS .GT. LIMIT OF "ILVLMX_13" --
   4199          PRINT 2187, NLEV13,ILVLMX_13,ILVLMX_13
   4200  2187    FORMAT(/'##W3UNPKB7: NUMBER OF RADIANCE CHANNELS FOR THIS ',
   4201      $    'REPORT (=',I3,') EXCEEDS LIMIT OF ',I0,' CAT. 13 CHANNELS ',
   4202      $    '-- ONLY FIRST ',I0,' CHANNELS WILL BE PROCESSED'/)
   4203          NLEV13 = ILVLMX_13
   4204 C.......................................................................
   4205       END IF
   4206       DO I = 1,NLEV13
   4207          IF(IPRINT.GT.1)  PRINT 2079, I,ILC,ILVL
   4208  2079 FORMAT(' ATTEMPTING NEW CAT. 13 INPUT "LEVEL" NUMBER',I4,' WITH ',
   4209      $ 'ILC =',I5,'; NO. LEVELS (CHANNELS) PROCESSED TO NOW =',I5)
   4210  
   4211 C       CHANNEL NUMBER (STORED AS INTEGER)
   4212  
   4213          M = 1
   4214          IF(IPRINT.GT.1)  PRINT 499, RAD(1,I),M
   4215   499 FORMAT(5X,'RAD  HERE IS: ',F17.4,'; INDEX IS: ',I3)
   4216          IF(RAD(1,I).GE.YMISS)  THEN
   4217 C WE DO NOT HAVE A VALID CATEGORY 13 DATA LEVEL -- THERE IS NO VALID
   4218 C  CHANNEL NUMBER -- GO ON TO NEXT INPUT LEVEL
   4219             IF(IPRINT.GT.1)  PRINT'(" CHANNEL NUMBER MISSING ON INPUT",
   4220      $       " LEVEL ",I0,", SKIP THE PROCESSING OF THIS LEVEL")', I
   4221             CYCLE
   4222          END IF
   4223 
   4224 C WE HAVE A VALID CATEGORY 13 DATA LEVEL -- THERE IS A VALID CHANNEL
   4225 C  NUMBER
   4226 
   4227          IDATA(IDATS_13+ILC) = NINT(RAD(1,I))
   4228          ILVL = ILVL + 1
   4229          IF(IPRINT.GT.1)  PRINT 197, IDATS_13+ILC,IDATA(IDATS_13+ILC)
   4230   197 FORMAT(5X,'IDATA(',I5,') STORED AS: ',I10)
   4231  
   4232 C       BRIGHTNESS TEMPERATURE (STORED AS REAL)
   4233  
   4234          M = 2
   4235          IF(IPRINT.GT.1)  PRINT 499, RAD(2,I),M

Page 86          Source Listing                  UNPKB707
2017-04-18 11:09                                 w3unpkb7.f

   4236          IF(RAD(2,I).LT.XMISS)  RDATX(IDATS_13+ILC+1) = RAD(2,I)
   4237          IF(IPRINT.GT.1) PRINT 198, IDATS_13+ILC+1,RDATX(IDATS_13+ILC+1)
   4238  
   4239 C       QUALITY MARKERS (STORED AS REAL) -- CURRENTLY HARDWIRED TO 2.0
   4240 C         (NEUTRAL - DEFAULT)
   4241  
   4242          RDATX(IDATS_13+ILC+2) = 2.0
   4243          IF(IPRINT.GT.1) PRINT 198, IDATS_13+ILC+2,RDATX(IDATS_13+ILC+2)
   4244 
   4245 C.......................................................................
   4246 
   4247          ILC = ILC + 3
   4248          IF(I+1.LE.NLEV13.AND.IPRINT.GT.1)  PRINT'(" HAVE COMPLETED ",
   4249      $    "LEVEL ",I0,"; GOING INTO NEXT LEVEL WITH ILC=",I0)', ILVL,ILC
   4250 
   4251   210    CONTINUE
   4252       ENDDO    
   4253  
   4254 C       SET CATEGORY COUNTERS FOR DATA LVL CATEGORY 13 (RADIANCE) DATA
   4255  
   4256       IDATA(41) = ILVL
   4257   100 CONTINUE
   4258       IF(IPRINT.GT.1)  PRINT'(1X,I0," CAT. 13 LEVELS PROCESSED")',
   4259      $ IDATA(41)
   4260       IF(IDATA(41).GT.0)  IDATA(42) = IDATS_13
   4261 
   4262       IF(IDATA(27)+IDATA(39)+IDATA(41).EQ.0)  IRET = 5
   4263 
   4264       IF(IPRINT.GT.1)  PRINT'(" IDATA(39)=",I0,"; IDATA(40)=",I0,
   4265      $ "; IDATA(27)=",I0,"; IDATA(28)=",I0,"; IDATA(41)=",I0,
   4266      $ "; IDATA(42)=",I0)', IDATA(39),IDATA(40),IDATA(27),IDATA(28),
   4267      $ IDATA(41),IDATA(42)
   4268 
   4269       RDATA(1:IDMAX) = RDATX(1:IDMAX)
   4270       RETURN
   4271       END

Page 87          Source Listing                  UNPKB707
2017-04-18 11:09 Entry Points                    w3unpkb7.f



ENTRY POINTS

  Name                 
                       
 unpkb707_             


SYMBOL CROSS REFERENCE

 Name                       Object Declared Type            Bytes Dimen Elements Attributes       References                        
                                                                                                                                    
 100                        Label  3802                                                           3732,3740                         
 1068                       Label  3446                                                           3445                              
 1079                       Label  3472                                                           3471                              
 1798                       Label  3661                                                           3660                              
 197                        Label  3775                                                           3774                              
 198                        Label  3521                                                           3520,3528,3534,3544,3553,3558,3563
                                                                                                  ,3568,3680,3685,3695,3782,3788    
 199                        Label  3479                                                           3478,3526,3540,3549               
 2068                       Label  3727                                                           3726                              
 2079                       Label  3753                                                           3752                              
 210                        Label  3796                                                                                             
 217                        Label  3457                                                           3456                              
 2186                       Label  3464                                                           3463                              
 2187                       Label  3745                                                           3744                              
 219                        Label  3642                                                           3641                              
 299                        Label  3658                                                           3657                              
 318                        Label  3633                                                           3632                              
 399                        Label  3670                                                           3669                              
 417                        Label  3738                                                           3737                              
 499                        Label  3760                                                           3759,3780                         
 6079                       Label  3667                                                           3666                              
 6217                       Label  3488                                                           3487                              
 98                         Label  3579                                                           3433,3451,3459,3490               
 99                         Label  3713                                                           3635                              
 BMISS                      Scalar 3370     R(8)            8           scalar   COM              3442,3610,3653,3724               
 CAT8                       Local  3372     R(4)            4     1     13       SAVE             3626,3627,3669,3671,3679          
 CAT8A                      Local  3366     CHAR            37          scalar   SAVE             3386,3612                         
 CAT8B                      Local  3366     CHAR            37          scalar   SAVE             3387,3612                         
 CAT8_8                     Local  3370     R(8)            8     1     12       SAVE             3610,3612,3624,3625,3626          
 ELEV                       Local  3443     R(4)            4           scalar   SAVE             3443,3483,3505                    
 I                          Local  3470     I(4)            4           scalar   SAVE             3470,3471,3478,3480,3481,3493,3497
                                                                                                  ,3499,3503,3505,3511,3518,3526,352
                                                                                                  7,3529,3540,3541,3542,3549,3550,35
                                                                                                  51,3571,3751,3752,3759,3761,3765,3
                                                                                                  772,3780,3781,3793                
 IBFMS                      Func   3624     I(4)            4           scalar                    3624                              
 ICDFG                      Local  3368     I(4)            4     1     13       SAVE             3391,3684                         
 IDATA                      Local  3368     I(4)            4     1     2270     SAVE             3578,3581,3582,3712,3715,3716,3772
                                                                                                  ,3774,3801,3804,3805,3807,3811,381
                                                                                                  2                                 
 IDATS                      Param  40       I(4)            4           scalar                    43,46,49,52,56,59                 
 IDATS_04                   Scalar 3377     I(4)            4           scalar   COM                                                
 IDATS_08                   Scalar 3377     I(4)            4           scalar   COM              3679,3680,3684,3685,3689,3694,3695
                                                                                                  ,3716                             

Page 88          Source Listing                  UNPKB707
2017-04-18 11:09 Symbol Table                    w3unpkb7.f

 Name                       Object Declared Type            Bytes Dimen Elements Attributes       References                        
                                                                                                                                    
 IDATS_10                   Scalar 3377     I(4)            4           scalar   COM                                                
 IDATS_11                   Scalar 3377     I(4)            4           scalar   COM                                                
 IDATS_12                   Scalar 3377     I(4)            4           scalar   COM              3518,3520,3527,3528,3543,3544,3552
                                                                                                  ,3553,3557,3558,3562,3563,3567,356
                                                                                                  8,3582                            
 IDATS_13                   Scalar 3378     I(4)            4           scalar   COM              3772,3774,3781,3782,3787,3788,3805
 IDATS_14                   Scalar 3378     I(4)            4           scalar   COM                                                
 IDATS_15                   Scalar 3378     I(4)            4           scalar   COM                                                
 IDMAX                      Param  63       I(4)            4           scalar                    3368,3373,3395,3814               
 IDMAX_GOES                 Param  52       I(4)            4           scalar                    63                                
 IDMAX_GPS                  Param  56       I(4)            4           scalar                    64                                
 IDMAX_PROF                 Param  46       I(4)            4           scalar                    63                                
 IDMAX_RASS                 Param  59       I(4)            4           scalar                    64                                
 IDMAX_SCAT                 Param  49       I(4)            4           scalar                    63                                
 IDMAX_VAD                  Param  43       I(4)            4           scalar                    63                                
 IFOV                       Scalar 3376     I(4)            4     2     8        COM              3407,3410,3413,3415,3424,3426     
 ILC                        Local  3441     I(4)            4           scalar   SAVE             3441,3471,3518,3520,3527,3528,3543
                                                                                                  ,3544,3552,3553,3557,3558,3562,356
                                                                                                  3,3567,3568,3570,3572,3609,3666,36
                                                                                                  79,3680,3684,3685,3689,3694,3695,3
                                                                                                  699,3702,3706,3723,3752,3772,3774,
                                                                                                  3781,3782,3787,3788,3792,3794     
 ILVL                       Local  3440     I(4)            4           scalar   SAVE             3440,3471,3519,3572,3578,3608,3666
                                                                                                  ,3675,3702,3706,3712,3722,3752,377
                                                                                                  3,3794,3801                       
 ILVLMX_04                  Param  15       I(4)            4           scalar                    43                                
 ILVLMX_08                  Param  8        I(4)            4           scalar                    52,3368,3372,3373,3665,3700       
 ILVLMX_11                  Param  19       I(4)            4           scalar                    46                                
 ILVLMX_12                  Param  22       I(4)            4           scalar                    52,3461,3463,3467                 
 ILVLMX_13                  Param  25       I(4)            4           scalar                    53,3742,3744,3748                 
 ILVLMX_15                  Param  29       I(4)            4           scalar                    59                                
 ILVL_10                    Param  34       I(4)            4           scalar                    46,49                             
 ILVL_14                    Param  37       I(4)            4           scalar                    56                                
 IPRINT                     Scalar 3375     I(4)            4           scalar   COM              3445,3471,3478,3496,3502,3509,3520
                                                                                                  ,3526,3528,3530,3534,3540,3544,354
                                                                                                  9,3553,3558,3563,3568,3571,3580,36
                                                                                                  57,3660,3666,3669,3680,3685,3695,3
                                                                                                  700,3704,3714,3726,3752,3759,3764,
                                                                                                  3774,3780,3782,3788,3793,3803,3809
 IRET                       Dummy  3358     I(4)            4           scalar   ARG,INOUT        3644,3807                         
 ITCSF                      Local  3655     I(4)            4           scalar   SAVE             3655,3659,3660,3694               
 ITMP                       Local  3541     I(4)            4           scalar   SAVE             3541,3543,3550,3552               
 KDATE                      Scalar 3375     I(4)            4     1     8        COM                                                
 KNTSAT                     Scalar 3376     I(4)            4     1     11       COM                                                
 KTIMCH                     Scalar 3375     I(4)            4           scalar   COM                                                
 LDATE                      Scalar 3375     I(4)            4     1     8        COM                                                
 LLEV8                      Local  3625     I(4)            4           scalar   SAVE             3625                              
 LUNIT                      Dummy  3358     I(4)            4           scalar   ARG,INOUT        3444,3612,3617,3625,3654,3725     
 M                          Local  3477     I(4)            4           scalar   SAVE             3477,3478,3525,3526,3539,3540,3548
                                                                                                  ,3549,3656,3657,3665,3666,3669,367
                                                                                                  1,3679,3684,3694,3700,3706,3758,37
                                                                                                  59,3779,3780                      
 MAX                        Func   63                                   scalar                    63                                
 NINT                       Func   3405                                 scalar                    3405,3408,3410,3412,3414,3423,3424
                                                                                                  ,3518,3527,3532,3541,3543,3550,355

Page 89          Source Listing                  UNPKB707
2017-04-18 11:09 Symbol Table                    w3unpkb7.f

 Name                       Object Declared Type            Bytes Dimen Elements Attributes       References                        
                                                                                                                                    
                                                                                                  2,3659,3772                       
 NLEV                       Local  3444     I(4)            4           scalar   SAVE             3444,3445,3448,3461,3463,3467,3470
                                                                                                  ,3571                             
 NLEV0                      Local  3654     I(4)            4           scalar   SAVE             3654                              
 NLEV13                     Local  3725     I(4)            4           scalar   SAVE             3725,3726,3729,3742,3744,3748,3751
                                                                                                  ,3793                             
 NLEV8                      Local  3611     I(4)            4           scalar   SAVE             3611,3612,3628,3629,3641          
 NNNNN                      Local  3533     I(4)            4           scalar   SAVE             3533,3534                         
 NRET                       Local  3617     I(4)            4           scalar   SAVE             3617                              
 PKB7AA                     Common 3374                                 8        SAVE                                               
 PKB7BB                     Common 3375                                 76       SAVE                                               
 PKB7FF                     Common 3376                                 76       SAVE                                               
 PKB7GG                     Common 3377                                 32       SAVE                                               
 PSFC                       Local  3431     R(4)            4           scalar   SAVE             3431,3481,3499,3627               
 QMFLG                      Local  3397     R(4)            4           scalar   SAVE             3397,3406,3409,3557,3562,3567,3689
 RAD                        Local  3373     R(4)            4     2     510      SAVE             3725,3759,3761,3772,3780,3781     
 RAD1                       Local  3367     CHAR            48          scalar   SAVE             3385,3725                         
 RAD_8                      Local  3370     R(8)            8     2     510      SAVE             3724,3725                         
 RDATA                      Dummy  3358     R(4)            4     1     0        ARG,INOUT        3395,3814                         
 RDATA2                     Dummy  3358     R(4)            4     1     25       ARG,INOUT        3405,3408,3410,3412,3414,3423,3424
                                                                                                  ,3618                             
 RDATX                      Local  3373     R(4)            4     1     2270     SAVE             3395,3518,3520,3527,3528,3532,3534
                                                                                                  ,3543,3544,3552,3553,3557,3558,356
                                                                                                  2,3563,3567,3568,3679,3680,3684,36
                                                                                                  85,3689,3694,3695,3781,3782,3787,3
                                                                                                  788,3814                          
 REAL                       Func   3684                                 scalar                    3684                              
 RTCSF                      Local  3654     R(4)            4           scalar   SAVE             3654,3657,3659                    
 RTCSF_8                    Local  3370     R(8)            8           scalar   SAVE             3653,3654                         
 SCALE                      Local  3372     R(4)            4     1     13       SAVE             3393,3679                         
 SKIP_CAT12                 Scalar 3369     L(4)            4           scalar   COM              3433                              
 SUBSET                     Dummy  3358     CHAR            8           scalar   ARG,INOUT        3399,3451,3732                    
 TOCC_8                     Local  3371     R(8)            8           scalar   SAVE             3617,3618                         
 UAIR                       Local  3372     R(4)            4     2     1020     SAVE             3444,3478,3481,3482,3483,3493,3499
                                                                                                  ,3505,3518,3526,3527,3532,3540,354
                                                                                                  1,3542,3549,3550,3551             
 UAIR1                      Local  3367     CHAR            48          scalar   SAVE             3384,3444                         
 UAIR_8                     Local  3370     R(8)            8     2     1020     SAVE             3442,3444                         
 UFBINT                     Subr   3444                                                           3444,3612,3617,3625,3654,3725     
 UNPKB707                   Subr   3358                                                                                             
 XMISS                      Local  3383     R(4)            4           scalar   SAVE             3383,3431,3482,3518,3527,3532,3542
                                                                                                  ,3551,3659,3781                   
 YMISS                      Local  3383     R(4)            4           scalar   SAVE             3383,3493,3761                    
 ZMISS                      Local  3373     R(4)            4     1     13       SAVE             3388,3671                         

Page 90          Source Listing                  UNPKB707
2017-04-18 11:09                                 w3unpkb7.f

   4272 
   4273 C$$$  SUBPROGRAM DOCUMENTATION BLOCK
   4274 C
   4275 C SUBPROGRAM:    UNPKB709
   4276 C   PRGMMR: JWhiting         ORG: EMC        DATE: 2016-08-15
   4277 C
   4278 C ABSTRACT: FOR REPORT (SUBSET) READ OUT OF BUFR MESSAGE (PASSED IN
   4279 C   INTERNALLY VIA BUFRLIB STORAGE), CALLS BUFRLIB ROUTINE TO DECODE
   4280 C   GPS-IPW (INTEGRATED PRECIPITABLE WATER) DATA.  GPS-IPW DATA ARE
   4281 C   THEN FILLED INTO THE OUTPUT ARRAY AS DATA LEVEL CATEGORY 14.  THE
   4282 C   OUTPUT ARRAY HOLDS A SINGLE GPS-IPW REPORT IN THE QUASI-IW3UNPBF
   4283 C   UNPACKED FORMAT.
   4284 C
   4285 C PROGRAM HISTORY LOG:
   4286 C 2002-07-03  D. A. KEYSER NP22 - ORIGINAL AUTHOR
   4287 C 2016-08-15  JWhiting - Added variable 'subset' to arg list; tested 
   4288 C     on 'subset' to determine if new GNSS/GPS-Met zenith total delay 
   4289 C     data fields need to be read (this replaces potentially ambiguous
   4290 C     test on missing TDEL data from previous GPS-IPW data streams).
   4291 C
   4292 C USAGE:    CALL UNPKB709(LUNIT,RDATA,SUBSET)
   4293 C   INPUT ARGUMENT LIST:
   4294 C     LUNIT    - FORTRAN UNIT NUMBER FOR INPUT DATA FILE
   4295 C     RDATA    - SINGLE GPS-IPW REPORT IN A QUASI-IW3UNPBF UNPACKED
   4296 C              - FORMAT WITH ONLY HEADER INFORMATION FILLED IN (ALL
   4297 C              - OTHER DATA REMAINS MISSING)
   4298 C     SUBSET   - CHARACTER*8 BUFR MESSAGE TYPE (SAME FOR ALL REPORTS
   4299 C              - IN A COMMON BUFR MESSAGE)
   4300 C
   4301 C   OUTPUT ARGUMENT LIST:
   4302 C     RDATA    - SINGLE GPS-IPW REPORT IN A QUASI-IW3UNPBF UNPACKED
   4303 C              - FORMAT WITH GPS-IPW INFORMATION FILLED IN (ALL DATA
   4304 C              - FOR REPORT NOW FILLED)
   4305 C
   4306 C   OUTPUT FILES:
   4307 C     UNIT 06  - PRINTOUT
   4308 C
   4309 C REMARKS: CALLED BY SUBROUTINE W3UNPKB7.
   4310 C
   4311 C ATTRIBUTES:
   4312 C   LANGUAGE: FORTRAN 90
   4313 C   MACHINE:  NCEP WCOSS
   4314 C
   4315 C$$$
   4316       SUBROUTINE UNPKB709(LUNIT,RDATA,subset)
   4317 
   4318 C  Include parameters common to more than one subroutine
   4319 C  -----------------------------------------------------
   4320 
   4321       include 'inc_w3unpkb7.inc'
   4322 
   4388       CHARACTER*50  CAT14S
   4389       character*8   subset
   4390       INTEGER  IDATA(IDMAX)
   4391       LOGICAL  SKIP_CAT12
   4392       REAL(8) CAT14_8(10),BMISS,gnssrpsq_8(6,255)
   4393       REAL  CAT14(10),RDATA(*),RDATX(IDMAX)

Page 91          Source Listing                  UNPKB709
2017-04-18 11:09                                 w3unpkb7.f

   4394       COMMON /PKB7AA/BMISS
   4395       COMMON /PKB7BB/kdate(8),ldate(8),KTIMCH,IPRINT,SKIP_CAT12
   4396       COMMON /PKB7GG/IDATS_04,IDATS_08,IDATS_10,IDATS_11,IDATS_12,
   4397      $ IDATS_13,IDATS_14,IDATS_15
   4398  
   4399       SAVE
   4400  
   4401       EQUIVALENCE (RDATX,IDATA)
   4402       DATA  XMISS/99999./
   4403       DATA  CAT14S/'PRES TMDB REHU TPWT TDEL ETDL HSDL EHSD WMTM WDMF '/
   4404       RDATX(1:IDMAX) = RDATA(1:IDMAX)
   4405       CAT14_8 = BMISS
   4406       CALL UFBINT(LUNIT,CAT14_8,10,1,NLEV,CAT14S);CAT14=CAT14_8
   4407       IF(NLEV.NE.1)  THEN
   4408 C.......................................................................
   4409 C PROBLEM: THE NUMBER OF DECODED "LEVELS" IS NOT WHAT IS EXPECTED --
   4410          PRINT 217, NLEV
   4411   217 FORMAT(/'##W3UNPKB7: THE NUMBER OF DECODED "LEVELS" (=',I5,') ',
   4412      $ 'IS NOT WHAT IS EXPECTED (1) - NO GPS-IPW DATA PROCESSED'/)
   4413          GO TO 99
   4414 C.......................................................................
   4415       END IF
   4416  
   4417 C       STATION PRESSURE (STORED AS REAL - MB TO 10**1 PRECISION)
   4418  
   4419       M = 1
   4420       IF(IPRINT.GT.1)  PRINT 199, CAT14(M),M
   4421   199 FORMAT(5X,'CAT14 HERE IS: ',F17.4,'; INDEX IS: ',I3)
   4422       IF((CAT14(M)*0.01).LT.XMISS) RDATX(IDATS_14) = CAT14(M) * 0.01
   4423       NNNNN = IDATS_14
   4424       IF(IPRINT.GT.1)  PRINT 198, NNNNN,RDATX(IDATS_14)
   4425   198 FORMAT(5X,'RDATA(',I5,') STORED AS: ',F10.2)
   4426  
   4427 C       AIR TEMPERATURE (STORED AS REAL - KELVIN TO 10**2 PRECISION)
   4428  
   4429       M = 2
   4430       if(cat14(m).ge.xmiss)  then
   4431          call ufbint(lunit,cat14_8(m),10,1,nlev,'TMDBST')
   4432          cat14(m) = cat14_8(m)
   4433       endif
   4434       IF(IPRINT.GT.1)  PRINT 199, CAT14(M),M
   4435       IF(CAT14(M).LT.XMISS)  RDATX(IDATS_14+1) = CAT14(M)
   4436       NNNNN = IDATS_14 + 1
   4437       IF(IPRINT.GT.1)  PRINT 198, NNNNN,RDATX(IDATS_14+1)
   4438  
   4439 C       RELATIVE HUMIDITY (STORED AS REAL - PERCENT TO 10**0 PRECISION)
   4440  
   4441       M = 3
   4442       IF(IPRINT.GT.1)  PRINT 199, CAT14(M),M
   4443       IF(CAT14(M).LT.XMISS)  RDATX(IDATS_14+2) = CAT14(M)
   4444       NNNNN = IDATS_14 + 2
   4445       IF(IPRINT.GT.1)  PRINT 198, NNNNN,RDATX(IDATS_14+2)
   4446  
   4447 C       TOTAL PRECIPITABLE WATER (STORED AS REAL - MM TO 10**3 PREC.)
   4448  
   4449       M = 4
   4450       IF(IPRINT.GT.1)  PRINT 199, CAT14(M),M

Page 92          Source Listing                  UNPKB709
2017-04-18 11:09                                 w3unpkb7.f

   4451       IF(CAT14(M).LT.XMISS)  RDATX(IDATS_14+3) = CAT14(M)
   4452       NNNNN = IDATS_14 + 3
   4453       IF(IPRINT.GT.1)  PRINT 198, NNNNN,RDATX(IDATS_14+3)
   4454  
   4455 C       ZENITH TOTAL DELAY (STORED AS REAL - M TO 10**4 PRECISION)
   4456  
   4457       M = 5
   4458       if (subset.eq.'NC012004') then ! new GPS-Met feed
   4459          call ufbrep(lunit,gnssrpsq_8,6,255,irep,
   4460      $   'SCLF PTID BEARAZ ELEV APDS APDE')
   4461 
   4462 C        ZTD is obtained from "atmospheric path delay in satellite
   4463 C         signal" (m) from replication where azimuth angle is zero deg.
   4464 C         and elevation angle is 90 deg.)
   4465 C        Likewise, the Error in ZTD (used below) is obtained from
   4466 C         "error in atmospheric path delay in satellite signal" (m) from
   4467 C         this same replication.
   4468 C         (slant angles are discarded for now)
   4469 
   4470          do jrep = 1,irep
   4471             if(gnssrpsq_8(3,jrep).eq.0..and.gnssrpsq_8(4,jrep).eq.90.)
   4472      $       then
   4473                cat14_8(m:m+1) = gnssrpsq_8(5:6,jrep)
   4474                cat14(m:m+1) = cat14_8(m:m+1)
   4475                exit
   4476             end if
   4477          enddo
   4478       end if
   4479       IF(IPRINT.GT.1)  PRINT 199, CAT14(M),M
   4480       IF(CAT14(M).LT.XMISS)  RDATX(IDATS_14+4) = CAT14(M)
   4481       NNNNN = IDATS_14 + 4
   4482       IF(IPRINT.GT.1)  PRINT 198, NNNNN,RDATX(IDATS_14+4)
   4483  
   4484 C       ERROR IN ZENITH TOTAL DELAY (STORED AS REAL - M TO 10**4 PREC.)
   4485  
   4486       M = 6
   4487       IF(IPRINT.GT.1)  PRINT 199, CAT14(M),M
   4488       IF(CAT14(M).LT.XMISS)  RDATX(IDATS_14+5) = CAT14(M)
   4489       NNNNN = IDATS_14 + 5
   4490       IF(IPRINT.GT.1)  PRINT 198, NNNNN,RDATX(IDATS_14+5)
   4491  
   4492 C       HYDROSTATIC DELAY (STORED AS REAL - M TO 10**4 PRECISION)
   4493  
   4494       M = 7
   4495       IF(IPRINT.GT.1)  PRINT 199, CAT14(M),M
   4496       IF(CAT14(M).LT.XMISS)  RDATX(IDATS_14+6) = CAT14(M)
   4497       NNNNN = IDATS_14 + 6
   4498       IF(IPRINT.GT.1)  PRINT 198, NNNNN,RDATX(IDATS_14+6)
   4499  
   4500 C       ERROR IN HYDROSTATIC DELAY (STORED AS REAL - M TO 10**4 PREC.)
   4501  
   4502       M = 8
   4503       IF(IPRINT.GT.1)  PRINT 199, CAT14(M),M
   4504       IF(CAT14(M).LT.XMISS)  RDATX(IDATS_14+7) = CAT14(M)
   4505       NNNNN = IDATS_14 + 7
   4506       IF(IPRINT.GT.1)  PRINT 198, NNNNN,RDATX(IDATS_14+7)
   4507  

Page 93          Source Listing                  UNPKB709
2017-04-18 11:09                                 w3unpkb7.f

   4508 C       WEIGHTED MEAN TEMPERATURE (STORED AS REAL - K TO 10**2 PREC.)
   4509  
   4510       M = 9
   4511       IF(IPRINT.GT.1)  PRINT 199, CAT14(M),M
   4512       IF(CAT14(M).LT.XMISS)  RDATX(IDATS_14+8) = CAT14(M)
   4513       NNNNN = IDATS_14 + 8
   4514       IF(IPRINT.GT.1)  PRINT 198, NNNNN,RDATX(IDATS_14+8)
   4515  
   4516 C       WET DELAY MAPPING FUNCTION (STORED AS REAL -
   4517 C        NUMERIC TO 10**3 PRECISION)
   4518  
   4519       M = 10
   4520       IF(IPRINT.GT.1)  PRINT 199, CAT14(M),M
   4521       IF(CAT14(M).LT.XMISS)  RDATX(IDATS_14+9) = CAT14(M)
   4522       NNNNN = IDATS_14 + 9
   4523       IF(IPRINT.GT.1)  PRINT 198, NNNNN,RDATX(IDATS_14+9)
   4524  
   4525 C       SET DATA LEVEL CATEGORY COUNTERS FOR GPS-IPW DATA
   4526  
   4527       IDATA(43) = 1
   4528       IDATA(44) = IDATS_14
   4529    99 CONTINUE
   4530       IF(IPRINT.GT.1)  PRINT'("IDATA(43)=",I0)', IDATA(43)
   4531       RDATA(1:IDMAX) = RDATX(1:IDMAX)
   4532       RETURN
   4533       END


ENTRY POINTS

  Name                 
                       
 unpkb709_             

Page 94          Source Listing                  UNPKB709
2017-04-18 11:09 Symbol Table                    w3unpkb7.f



SYMBOL CROSS REFERENCE

 Name                       Object Declared Type            Bytes Dimen Elements Attributes       References                        
                                                                                                                                    
 198                        Label  3905                                                           3904,3917,3925,3933,3962,3970,3978
                                                                                                  ,3986,3994,4003                   
 199                        Label  3901                                                           3900,3914,3922,3930,3959,3967,3975
                                                                                                  ,3983,3991,4000                   
 217                        Label  3891                                                           3890                              
 99                         Label  4009                                                           3893                              
 BMISS                      Scalar 3872     R(8)            8           scalar   COM              3885                              
 CAT14                      Local  3873     R(4)            4     1     10       SAVE             3886,3900,3902,3910,3912,3914,3915
                                                                                                  ,3922,3923,3930,3931,3954,3959,396
                                                                                                  0,3967,3968,3975,3976,3983,3984,39
                                                                                                  91,3992,4000,4001                 
 CAT14S                     Local  3868     CHAR            50          scalar   SAVE             3883,3886                         
 CAT14_8                    Local  3872     R(8)            8     1     10       SAVE             3885,3886,3911,3912,3953,3954     
 GNSSRPSQ_8                 Local  3872     R(8)            8     2     1530     SAVE             3939,3951,3953                    
 IDATA                      Local  3870     I(4)            4     1     2270     SAVE             4007,4008,4010                    
 IDATS                      Param  40       I(4)            4           scalar                    43,46,49,52,56,59                 
 IDATS_04                   Scalar 3876     I(4)            4           scalar   COM                                                
 IDATS_08                   Scalar 3876     I(4)            4           scalar   COM                                                
 IDATS_10                   Scalar 3876     I(4)            4           scalar   COM                                                
 IDATS_11                   Scalar 3876     I(4)            4           scalar   COM                                                
 IDATS_12                   Scalar 3876     I(4)            4           scalar   COM                                                
 IDATS_13                   Scalar 3877     I(4)            4           scalar   COM                                                
 IDATS_14                   Scalar 3877     I(4)            4           scalar   COM              3902,3903,3904,3915,3916,3917,3923
                                                                                                  ,3924,3925,3931,3932,3933,3960,396
                                                                                                  1,3962,3968,3969,3970,3976,3977,39
                                                                                                  78,3984,3985,3986,3992,3993,3994,4
                                                                                                  001,4002,4003,4008                
 IDATS_15                   Scalar 3877     I(4)            4           scalar   COM                                                
 IDMAX                      Param  63       I(4)            4           scalar                    3870,3873,3884,4011               
 IDMAX_GOES                 Param  52       I(4)            4           scalar                    63                                
 IDMAX_GPS                  Param  56       I(4)            4           scalar                    64                                
 IDMAX_PROF                 Param  46       I(4)            4           scalar                    63                                
 IDMAX_RASS                 Param  59       I(4)            4           scalar                    64                                
 IDMAX_SCAT                 Param  49       I(4)            4           scalar                    63                                
 IDMAX_VAD                  Param  43       I(4)            4           scalar                    63                                
 ILVLMX_04                  Param  15       I(4)            4           scalar                    43                                
 ILVLMX_08                  Param  8        I(4)            4           scalar                    52                                
 ILVLMX_11                  Param  19       I(4)            4           scalar                    46                                
 ILVLMX_12                  Param  22       I(4)            4           scalar                    52                                
 ILVLMX_13                  Param  25       I(4)            4           scalar                    53                                
 ILVLMX_15                  Param  29       I(4)            4           scalar                    59                                
 ILVL_10                    Param  34       I(4)            4           scalar                    46,49                             
 ILVL_14                    Param  37       I(4)            4           scalar                    56                                
 IPRINT                     Scalar 3875     I(4)            4           scalar   COM              3900,3904,3914,3917,3922,3925,3930
                                                                                                  ,3933,3959,3962,3967,3970,3975,397
                                                                                                  8,3983,3986,3991,3994,4000,4003,40
                                                                                                  10                                
 IREP                       Local  3939     I(4)            4           scalar   SAVE             3939,3950                         
 JREP                       Local  3950     I(4)            4           scalar   SAVE             3950,3951,3953                    
 KDATE                      Scalar 3875     I(4)            4     1     8        COM                                                
 KTIMCH                     Scalar 3875     I(4)            4           scalar   COM                                                

Page 95          Source Listing                  UNPKB709
2017-04-18 11:09 Symbol Table                    w3unpkb7.f

 Name                       Object Declared Type            Bytes Dimen Elements Attributes       References                        
                                                                                                                                    
 LDATE                      Scalar 3875     I(4)            4     1     8        COM                                                
 LUNIT                      Dummy  3861     I(4)            4           scalar   ARG,INOUT        3886,3911,3939                    
 M                          Local  3899     I(4)            4           scalar   SAVE             3899,3900,3902,3909,3910,3911,3912
                                                                                                  ,3914,3915,3921,3922,3923,3929,393
                                                                                                  0,3931,3937,3953,3954,3959,3960,39
                                                                                                  66,3967,3968,3974,3975,3976,3982,3
                                                                                                  983,3984,3990,3991,3992,3999,4000,
                                                                                                  4001                              
 MAX                        Func   63                                   scalar                    63                                
 NLEV                       Local  3886     I(4)            4           scalar   SAVE             3886,3887,3890,3911               
 NNNNN                      Local  3903     I(4)            4           scalar   SAVE             3903,3904,3916,3917,3924,3925,3932
                                                                                                  ,3933,3961,3962,3969,3970,3977,397
                                                                                                  8,3985,3986,3993,3994,4002,4003   
 PKB7AA                     Common 3874                                 8        SAVE                                               
 PKB7BB                     Common 3875                                 76       SAVE                                               
 PKB7GG                     Common 3876                                 32       SAVE                                               
 RDATA                      Dummy  3861     R(4)            4     1     0        ARG,INOUT        3884,4011                         
 RDATX                      Local  3873     R(4)            4     1     2270     SAVE             3884,3902,3904,3915,3917,3923,3925
                                                                                                  ,3931,3933,3960,3962,3968,3970,397
                                                                                                  6,3978,3984,3986,3992,3994,4001,40
                                                                                                  03,4011                           
 SKIP_CAT12                 Scalar 3871     L(4)            4           scalar   COM                                                
 SUBSET                     Dummy  3861     CHAR            8           scalar   ARG,INOUT        3938                              
 UFBINT                     Subr   3886                                                           3886,3911                         
 UFBREP                     Subr   3939                                                           3939                              
 UNPKB709                   Subr   3861                                                                                             
 XMISS                      Local  3882     R(4)            4           scalar   SAVE             3882,3902,3910,3915,3923,3931,3960
                                                                                                  ,3968,3976,3984,3992,4001         

Page 96          Source Listing                  UNPKB709
2017-04-18 11:09                                 w3unpkb7.f

   4534 
   4535 C$$$  SUBPROGRAM DOCUMENTATION BLOCK
   4536 C
   4537 C SUBPROGRAM:    UNPKB710
   4538 C   PRGMMR: D. A. KEYSER     ORG: NP22       DATE: 2004-02-02
   4539 C
   4540 C ABSTRACT: FOR REPORT (SUBSET) READ OUT OF BUFR MESSAGE (PASSED IN
   4541 C   INTERNALLY VIA BUFRLIB STORAGE), CALLS BUFRLIB ROUTINE TO DECODE
   4542 C   UPPER-AIR DATA FOR NPN OR CAP RASS REPORT.  UPPER-AIR DATA ARE THEN
   4543 C   FILLED INTO THE OUTPUT ARRAY AS DATA LEVEL CATEGORY 15.  THE OUTPUT
   4544 C   ARRAY HOLDS A SINGLE RASS REPORT IN THE QUASI-IW3UNPBF UNPACKED
   4545 C   FORMAT.
   4546 C
   4547 C PROGRAM HISTORY LOG:
   4548 C 2004-02-02  D. A. KEYSER NP22 - ORIGINAL AUTHOR
   4549 C
   4550 C USAGE:    CALL UNPKB710(LUNIT,RDATA)
   4551 C   INPUT ARGUMENT LIST:
   4552 C     LUNIT    - FORTRAN UNIT NUMBER FOR INPUT DATA FILE
   4553 C     RDATA    - SINGLE RASS REPORT IN A QUASI-IW3UNPBF UNPACKED
   4554 C              - FORMAT WITH ONLY HEADER INFORMATION FILLED IN
   4555 C              - (CATEGORY 15 DATA MISSING)
   4556 C
   4557 C   OUTPUT ARGUMENT LIST:
   4558 C     RDATA    - SINGLE RASS REPORT IN A QUASI-IW3UNPBF UNPACKED
   4559 C              - FORMAT WITH CATEGORY 15 INFORMATION FILLED IN (ALL
   4560 C              - DATA FOR REPORT NOW FILLED)
   4561 C
   4562 C   OUTPUT FILES:
   4563 C     UNIT 06  - PRINTOUT
   4564 C
   4565 C REMARKS: CALLED BY SUBROUTINE W3UNPKB7.
   4566 C
   4567 C ATTRIBUTES:
   4568 C   LANGUAGE: FORTRAN 90
   4569 C   MACHINE:  NCEP WCOSS
   4570 C
   4571 C$$$
   4572       SUBROUTINE UNPKB710(LUNIT,RDATA)
   4573 
   4574 C  Include parameters common to more than one subroutine
   4575 C  -----------------------------------------------------
   4576 
   4577       include 'inc_w3unpkb7.inc'
   4578 
   4644       CHARACTER*20  CAT15S
   4645       INTEGER  IDATA(IDMAX)
   4646       LOGICAL  SKIP_CAT12
   4647       REAL(8) CAT15_8(4,255),BMISS
   4648       REAL  CAT15(4,255),RDATA(*),RDATX(IDMAX)
   4649       COMMON /PKB7AA/BMISS
   4650       COMMON /PKB7BB/kdate(8),ldate(8),KTIMCH,IPRINT,SKIP_CAT12
   4651       COMMON /PKB7GG/IDATS_04,IDATS_08,IDATS_10,IDATS_11,IDATS_12,
   4652      $ IDATS_13,IDATS_14,IDATS_15
   4653  
   4654       SAVE
   4655  

Page 97          Source Listing                  UNPKB710
2017-04-18 11:09                                 w3unpkb7.f

   4656       EQUIVALENCE (RDATX,IDATA)
   4657       DATA  XMISS/99999./
   4658       DATA  CAT15S/'HEIT TMVR QMAT NPQC '/
   4659       RDATX(1:IDMAX) = RDATA(1:IDMAX)
   4660       NSFC = 0
   4661       ILVL = 0
   4662       ILC =  0
   4663 C FIRST CATEGORY 15 DATA LEVEL CONTAINS ONLY HEIGHT (ELEV)
   4664       IF(IPRINT.GT.1)  PRINT 1078, ILC,ILVL
   4665  1078 FORMAT(' ATTEMPTING 1ST (SFC) LVL WITH ILC =',I5,'; NO. LEVELS ',
   4666      $ 'PROCESSED TO NOW =',I5)
   4667       RDATX(IDATS_15+ILC) = RDATX(7)
   4668       IF(IPRINT.GT.1)  PRINT 198, IDATS_15+ILC,RDATX(IDATS_15+ILC)
   4669   198 FORMAT(5X,'RDATA(',I5,') STORED AS: ',F10.2)
   4670       IF(RDATX(IDATS_15+ILC).LT.XMISS)  NSFC = 1
   4671       ILVL = ILVL + 1
   4672       ILC = ILC + 3
   4673       IF(IPRINT.GT.1) PRINT'(" HAVE COMPLETED LEVEL ",I0," WITH NSFC=",
   4674      $ I0,"; GOING INTO NEXT LEVEL WITH ILC=",I0)', ILVL,NSFC,ILC
   4675       CAT15_8 = BMISS
   4676       CALL UFBINT(LUNIT,CAT15_8,4,255,NLEV,CAT15S);CAT15=CAT15_8
   4677       IF(IPRINT.GT.1)  PRINT 1068, NLEV
   4678  1068 FORMAT(' THIS REPORT CONTAINS ',I3,' LEVELS OF DATA (NOT ',
   4679      $ 'INCLUDING BOTTOM -SURFACE- LEVEL)')
   4680       IF(NLEV.EQ.0)  THEN
   4681 C.......................................................................
   4682 C PROBLEM: THE NUMBER OF DECODED "LEVELS" IS ZERO --
   4683          IF(NSFC.EQ.0)  THEN
   4684 C ... NO UPPER AIR DATA PROCESSED
   4685             PRINT 217
   4686   217       FORMAT(/'##W3UNPKB7: NO UPPER-AIR DATA PROCESSED FOR THIS',
   4687      $       ' REPORT -- NLEV = 0 AND NSFC = 0'/)
   4688             GO TO 99
   4689          ELSE
   4690 C ... ONLY FIRST (SURFACE) UPPER AIR LEVEL DATA PROCESSED
   4691             PRINT 218
   4692   218 FORMAT(/'##W3UNPKB7: NO UPPER-AIR DATA ABOVE FIRST (SURFACE) ',
   4693      $ 'LEVEL PROCESSED FOR THIS REPORT -- NLEV = 0 AND NSFC > 0'/)
   4694             GO TO 98
   4695          END IF
   4696 C.......................................................................
   4697       ELSE  IF(NLEV.GT.ILVLMX_15)  THEN
   4698 C PROBLEM: THE NUMBER OF DECODED "LEVELS" {EXCLUDING BOTTOM (SURFACE)
   4699 C  LEVEL} IS .GT. LIMIT OF "ILVLMX_15" --
   4700          PRINT 2186, NLEV,ILVLMX_15,ILVLMX_15
   4701  2186    FORMAT(/'##W3UNPKB7: NUMBER OF UPPER-AIR LEVELS FOR THIS ',
   4702      $    'REPORT (=',I3,') EXCEEDS LIMIT OF ',I0,' CAT. 15 LEVELS ',
   4703      $    '(EXCLUDING BOTTOM, SFC, LVL) -- '/'     ONLY FIRST ',I0,
   4704      $    ' UPPER-AIR LEVELS PLUS THE SURFACE LEVEL WILL BE PROCESSED'/)
   4705          NLEV = ILVLMX_15
   4706 C.......................................................................
   4707       END IF
   4708       DO I = 1,NLEV
   4709          IF(IPRINT.GT.1)  PRINT 1079, ILC,ILVL
   4710  1079 FORMAT(' ATTEMPTING NEW LEVEL WITH ILC =',I5,'; NO. LEVELS ',
   4711      $ 'PROCESSED TO NOW =',I5)
   4712  

Page 98          Source Listing                  UNPKB710
2017-04-18 11:09                                 w3unpkb7.f

   4713 C       HEIGHT ABOVE SEA-LEVEL (STORED AS REAL - METERS TO 10**0 PREC.)
   4714  
   4715          M = 1
   4716          IF(IPRINT.GT.1)  PRINT 199, CAT15(1,I),M
   4717   199 FORMAT(5X,'CAT15 HERE IS: ',F17.4,'; INDEX IS: ',I3)
   4718          IF(CAT15(1,I).LT.XMISS)  THEN
   4719             RDATX(IDATS_15+ILC) = NINT(CAT15(1,I))
   4720 
   4721 C       ... WE HAVE A VALID CATEGORY 15 DATA LEVEL -- THERE IS A VALID
   4722 C            HEIGHT
   4723 
   4724             ILVL = ILVL + 1
   4725          ELSE
   4726 
   4727 C       ... WE DO NOT HAVE A VALID CATEGORY 15 DATA LEVEL -- THERE IS
   4728 C            NO VALID HEIGHT GO ON TO NEXT INPUT LEVEL
   4729 
   4730             IF(IPRINT.GT.1)  PRINT'(" HEIGHT MISSING ON INPUT LEVEL ",
   4731      $       I0,", ALL OTHER DATA SET TO MSG ON THIS LEVEL")', I
   4732             CYCLE
   4733          END IF
   4734          IF(IPRINT.GT.1)  PRINT 198, IDATS_15+ILC,RDATX(IDATS_15+ILC)
   4735  
   4736 C       VIRTUAL TEMPERATURE (STORED AS REAL - KELVIN TO 10**2 PRECISION)
   4737  
   4738          M = 2
   4739          IF(IPRINT.GT.1)  PRINT 199, CAT15(2,I),M
   4740          IF(CAT15(2,I).LT.XMISS)  RDATX(IDATS_15+ILC+1) = CAT15(2,I)
   4741          IF(IPRINT.GT.1) PRINT 198, IDATS_15+ILC+1,RDATX(IDATS_15+ILC+1)
   4742  
   4743 C       QUALITY CODE (STORED AS INTEGER - NUMERIC)
   4744 C          IF SDMEDIT/QUIPS TEMPERATURE QUALITY MARKER IS 12 (REJECT
   4745 C          LIST) OR 14 (SDM PURGE) THEN A VALUE OF 14 IS STORED FOR THE
   4746 C          QUALITY CODE; OTHERWISE THE DECODED QUALITY CODE IS STORED
   4747 C          DIRECTLY
   4748  
   4749          M = 3
   4750          IF(IPRINT.GT.1)  PRINT 199, CAT15(3,I),M
   4751          M = 4
   4752          IF(IPRINT.GT.1)  PRINT 199, CAT15(4,I),M
   4753          IF(CAT15(3,I).EQ.12.OR.CAT15(3,I).EQ.14)  THEN
   4754             IDATA(IDATS_15+ILC+2) = 14
   4755          ELSE  IF(CAT15(4,I).LT.XMISS) THEN
   4756             IDATA(IDATS_15+ILC+2) = NINT(CAT15(4,I))
   4757          END IF
   4758          IF(IPRINT.GT.1) PRINT 197, IDATS_15+ILC+2,IDATA(IDATS_15+ILC+2)
   4759   197 FORMAT(5X,'IDATA(',I5,') STORED AS: ',I10)
   4760 C.......................................................................
   4761          ILC = ILC + 3
   4762          IF(IPRINT.GT.1)  PRINT'(" HAVE COMPLETED LEVEL ",I0,"; GOING ",
   4763      $    "INTO NEXT LEVEL WITH ILC=",I0)', ILVL,ILC
   4764       ENDDO    
   4765  
   4766 C       SET DATA LEVEL CATEGORY COUNTERS FOR UPPER-AIR DATA
   4767  
   4768    98 CONTINUE
   4769       IDATA(45) = ILVL

Page 99          Source Listing                  UNPKB710
2017-04-18 11:09                                 w3unpkb7.f

   4770       IDATA(46) = IDATS_15
   4771    99 CONTINUE
   4772       IF(IPRINT.GT.1)  PRINT'(" NSFC=",I0,"; IDATA(45)=",I0,
   4773      $ "; IDATA(46)=",I0)', NSFC,IDATA(45),IDATA(46)
   4774       RDATA(1:IDMAX) = RDATX(1:IDMAX)
   4775       RETURN
   4776       END


ENTRY POINTS

  Name                 
                       
 unpkb710_             


SYMBOL CROSS REFERENCE

 Name                       Object Declared Type            Bytes Dimen Elements Attributes       References                        
                                                                                                                                    
 1068                       Label  4093                                                           4092                              
 1078                       Label  4080                                                           4079                              
 1079                       Label  4125                                                           4124                              
 197                        Label  4174                                                           4173                              
 198                        Label  4084                                                           4083,4149,4156                    
 199                        Label  4132                                                           4131,4154,4165,4167               
 217                        Label  4101                                                           4100                              
 218                        Label  4107                                                           4106                              
 2186                       Label  4116                                                           4115                              
 98                         Label  4183                                                           4109                              
 99                         Label  4186                                                           4103                              
 BMISS                      Scalar 4062     R(8)            8           scalar   COM              4090                              
 CAT15                      Local  4063     R(4)            4     2     1020     SAVE             4091,4131,4133,4134,4154,4155,4165
                                                                                                  ,4167,4168,4170,4171              
 CAT15S                     Local  4059     CHAR            20          scalar   SAVE             4073,4091                         
 CAT15_8                    Local  4062     R(8)            8     2     1020     SAVE             4090,4091                         
 I                          Local  4123     I(4)            4           scalar   SAVE             4123,4131,4133,4134,4146,4154,4155
                                                                                                  ,4165,4167,4168,4170,4171         
 IDATA                      Local  4060     I(4)            4     1     2270     SAVE             4169,4171,4173,4184,4185,4188     
 IDATS                      Param  40       I(4)            4           scalar                    43,46,49,52,56,59                 
 IDATS_04                   Scalar 4066     I(4)            4           scalar   COM                                                
 IDATS_08                   Scalar 4066     I(4)            4           scalar   COM                                                
 IDATS_10                   Scalar 4066     I(4)            4           scalar   COM                                                
 IDATS_11                   Scalar 4066     I(4)            4           scalar   COM                                                
 IDATS_12                   Scalar 4066     I(4)            4           scalar   COM                                                
 IDATS_13                   Scalar 4067     I(4)            4           scalar   COM                                                
 IDATS_14                   Scalar 4067     I(4)            4           scalar   COM                                                
 IDATS_15                   Scalar 4067     I(4)            4           scalar   COM              4082,4083,4085,4134,4149,4155,4156
                                                                                                  ,4169,4171,4173,4185              
 IDMAX                      Param  63       I(4)            4           scalar                    4060,4063,4074,4189               
 IDMAX_GOES                 Param  52       I(4)            4           scalar                    63                                
 IDMAX_GPS                  Param  56       I(4)            4           scalar                    64                                
 IDMAX_PROF                 Param  46       I(4)            4           scalar                    63                                
 IDMAX_RASS                 Param  59       I(4)            4           scalar                    64                                
 IDMAX_SCAT                 Param  49       I(4)            4           scalar                    63                                
 IDMAX_VAD                  Param  43       I(4)            4           scalar                    63                                
 ILC                        Local  4077     I(4)            4           scalar   SAVE             4077,4079,4082,4083,4085,4087,4089

Page 100         Source Listing                  UNPKB710
2017-04-18 11:09 Symbol Table                    w3unpkb7.f

 Name                       Object Declared Type            Bytes Dimen Elements Attributes       References                        
                                                                                                                                    
                                                                                                  ,4124,4134,4149,4155,4156,4169,417
                                                                                                  1,4173,4176,4178                  
 ILVL                       Local  4076     I(4)            4           scalar   SAVE             4076,4079,4086,4089,4124,4139,4178
                                                                                                  ,4184                             
 ILVLMX_04                  Param  15       I(4)            4           scalar                    43                                
 ILVLMX_08                  Param  8        I(4)            4           scalar                    52                                
 ILVLMX_11                  Param  19       I(4)            4           scalar                    46                                
 ILVLMX_12                  Param  22       I(4)            4           scalar                    52                                
 ILVLMX_13                  Param  25       I(4)            4           scalar                    53                                
 ILVLMX_15                  Param  29       I(4)            4           scalar                    59,4112,4115,4120                 
 ILVL_10                    Param  34       I(4)            4           scalar                    46,49                             
 ILVL_14                    Param  37       I(4)            4           scalar                    56                                
 IPRINT                     Scalar 4065     I(4)            4           scalar   COM              4079,4083,4088,4092,4124,4131,4145
                                                                                                  ,4149,4154,4156,4165,4167,4173,417
                                                                                                  7,4187                            
 KDATE                      Scalar 4065     I(4)            4     1     8        COM                                                
 KTIMCH                     Scalar 4065     I(4)            4           scalar   COM                                                
 LDATE                      Scalar 4065     I(4)            4     1     8        COM                                                
 LUNIT                      Dummy  4052     I(4)            4           scalar   ARG,INOUT        4091                              
 M                          Local  4130     I(4)            4           scalar   SAVE             4130,4131,4153,4154,4164,4165,4166
                                                                                                  ,4167                             
 MAX                        Func   63                                   scalar                    63                                
 NINT                       Func   4134                                 scalar                    4134,4171                         
 NLEV                       Local  4091     I(4)            4           scalar   SAVE             4091,4092,4095,4112,4115,4120,4123
 NSFC                       Local  4075     I(4)            4           scalar   SAVE             4075,4085,4089,4098,4188          
 PKB7AA                     Common 4064                                 8        SAVE                                               
 PKB7BB                     Common 4065                                 76       SAVE                                               
 PKB7GG                     Common 4066                                 32       SAVE                                               
 RDATA                      Dummy  4052     R(4)            4     1     0        ARG,INOUT        4074,4189                         
 RDATX                      Local  4063     R(4)            4     1     2270     SAVE             4074,4082,4083,4085,4134,4149,4155
                                                                                                  ,4156,4189                        
 SKIP_CAT12                 Scalar 4061     L(4)            4           scalar   COM                                                
 UFBINT                     Subr   4091                                                           4091                              
 UNPKB710                   Subr   4052                                                                                             
 XMISS                      Local  4072     R(4)            4           scalar   SAVE             4072,4085,4133,4155,4170          

Page 101         Source Listing                  UNPKB710
2017-04-18 11:09                                 w3unpkb7.f

   4777 

Page 102         Source Listing                  UNPKB710
2017-04-18 11:09 Subprograms/Common Blocks       w3unpkb7.f



SUBPROGRAMS/COMMON BLOCKS

 Name                       Object Declared Type            Bytes Dimen Elements Attributes       References                        
                                                                                                                                    
 PKB7AA                     Common 799                                  8        SAVE                                               
 PKB7AA                     Common 2027                                 8        SAVE                                               
 PKB7AA                     Common 2581                                 8        SAVE                                               
 PKB7AA                     Common 2774                                 8        SAVE                                               
 PKB7AA                     Common 3087                                 8        SAVE                                               
 PKB7AA                     Common 3374                                 8        SAVE                                               
 PKB7AA                     Common 3874                                 8        SAVE                                               
 PKB7AA                     Common 4064                                 8        SAVE                                               
 PKB7BB                     Common 800                                  76       SAVE                                               
 PKB7BB                     Common 1473                                 76       SAVE                                               
 PKB7BB                     Common 2028                                 76       SAVE                                               
 PKB7BB                     Common 2582                                 76       SAVE                                               
 PKB7BB                     Common 2775                                 76       SAVE                                               
 PKB7BB                     Common 3088                                 76       SAVE                                               
 PKB7BB                     Common 3375                                 76       SAVE                                               
 PKB7BB                     Common 3875                                 76       SAVE                                               
 PKB7BB                     Common 4065                                 76       SAVE                                               
 PKB7CC                     Common 801                                  4        SAVE                                               
 PKB7CC                     Common 1474                                 4        SAVE                                               
 PKB7DD                     Common 802                                  48       SAVE                                               
 PKB7DD                     Common 1475                                 48       SAVE                                               
 PKB7FF                     Common 803                                  76       SAVE                                               
 PKB7FF                     Common 2029                                 76       SAVE                                               
 PKB7FF                     Common 3376                                 76       SAVE                                               
 PKB7GG                     Common 1760                                 32       SAVE                                               
 PKB7GG                     Common 2583                                 32       SAVE                                               
 PKB7GG                     Common 2776                                 32       SAVE                                               
 PKB7GG                     Common 3089                                 32       SAVE                                               
 PKB7GG                     Common 3377                                 32       SAVE                                               
 PKB7GG                     Common 3876                                 32       SAVE                                               
 PKB7GG                     Common 4066                                 32       SAVE                                               
 PKB7HH                     Common 804                                  205824   SAVE                                               
 PKB7HH                     Common 1476                                 205824   SAVE                                               
 UNPKB701                   Subr   1468                                                                                             
 UNPKB702                   Subr   1749                                                                                             
 UNPKB703                   Subr   2012                                                                                             
 UNPKB704                   Subr   2569                                                                                             
 UNPKB705                   Subr   2762                                                                                             
 UNPKB706                   Subr   3074                                                                                             
 UNPKB707                   Subr   3358                                                                                             
 UNPKB709                   Subr   3861                                                                                             
 UNPKB710                   Subr   4052                                                                                             
 W3UNPKB7                   Subr   780                                                                                              

COMPILER OPTIONS BEING USED

       -align noall                          -align nonone
       -align nocommons                      -align nodcommons
       -align noqcommons                     -align nozcommons
       -align records                        -align nosequence
       -align norec1byte                     -align norec2byte

Page 103         Source Listing                  UNPKB710
2017-04-18 11:09                                 w3unpkb7.f

       -align norec4byte                     -align norec8byte
       -align norec16byte                    -align norec32byte
       -align norec64byte                    -align noarray8byte
       -align noarray16byte                  -align noarray32byte
       -align noarray64byte                  -align noarray128byte
       -align noarray256byte                 -altparam
       -assume accuracy_sensitive            -assume nobscc
       -assume nobuffered_io                 -assume nobuffered_stdout
       -assume nobyterecl                    -assume nocc_omp
       -assume nocstring                     -assume nodummy_aliases
       -assume nofpe_summary                 -assume noieee_fpe_flags
       -assume nominus0                      -assume noold_boz
       -assume old_complex_align             -assume old_unit_star
       -assume noold_ldout_format            -assume noold_logical_ldio
       -assume old_maxminloc                 -assume old_xor
       -assume noprotect_allocates           -assume protect_constants
       -assume noprotect_parens              -assume split_common
       -assume source_include                -assume nostd_intent_in
       -assume std_minus0_rounding           -assume nostd_mod_proc_name
       -assume std_value                     -assume norealloc_lhs
       -assume underscore                    -assume no2underscores
       -auto                            no   -auto_scalar
  no   -bintext                              -ccdefault default
       -check noargs                         -check noarg_temp_created
       -check noassume                       -check nobounds
       -check noformat                       -check nooutput_conversion
       -check nooverflow                     -check nopointers
       -check power                          -check noshape
       -check nostack                        -check nounderflow
       -check nouninitialized                -coarray-num-procs 0
  no   -coarray-config-file                  -convert big_endian
       -cross_reference                      -D __INTEL_COMPILER=1600
       -D __INTEL_COMPILER_UPDATE=3          -D __unix__
       -D __unix                             -D __linux__
       -D __linux                            -D __gnu_linux__
       -D unix                               -D linux
       -D __ELF__                            -D __x86_64
       -D __x86_64__                         -D __amd64
       -D __amd64__                          -D __INTEL_COMPILER_BUILD_DATE=20160415
       -D __INTEL_OFFLOAD                    -D __i686
       -D __i686__                           -D __pentiumpro
       -D __pentiumpro__                     -D __pentium4
       -D __pentium4__                       -D __tune_pentium4__
       -D __SSE2__                           -D __SSE2_MATH__
       -D __SSE__                            -D __SSE_MATH__
       -D __MMX__                            -double_size 64
  no   -d_lines                         no   -Qdyncom
       -error_limit 30                  no   -f66
  no   -f77rtl                          no   -fast
       -fpscomp nofilesfromcmd               -fpscomp nogeneral
       -fpscomp noioformat                   -fpscomp noldio_spacing
       -fpscomp nologicals                   -fixed
  no   -fpconstant                           -fpe3
       -fprm nearest                    no   -ftz
       -fp_model noprecise                   -fp_model fast
       -fp_model nostrict                    -fp_model nosource
       -fp_model nodouble                    -fp_model noextended

Page 104         Source Listing                  UNPKB710
2017-04-18 11:09                                 w3unpkb7.f

       -fp_model novery_fast                 -fp_model noexcept
       -fp_model nono_except                 -heap_arrays 0
  no   -threadprivate_compat                 -g2
       -iface nomixed_str_len_arg            -iface nono_mixed_str_len_arg
       -init noarrays                        -init noinf
       -init nonan                           -init nosnan
       -init nozero                     no   -intconstant
       -integer_size 32                 no   -mixed_str_len_arg
  no   -module                               -names lowercase
  no   -noinclude                            -offload-build=host
       -O2                              no   -pad_source
       -real_size 32                    no   -recursive
       -reentrancy none                 no   -sharable_localsaves
       -vec=simd                             -show noinclude
       -show map                             -show options
  no   -syntax_only                     no   -threadcom
  no   -U                               no   -vms
       -w noall                              -w nonone
       -w alignments                         -w noargument_checking
       -w nodeclarations                     -w general
       -w noignore_bounds                    -w noignore_loc
       -w nointerfaces                       -w notruncated_source
       -w uncalled                           -w uninitialized
       -w nounused                           -w usage
  no   -wrap-margins

       -includepath : /usrx/local/intel/2016SP3/daal/include/,/usr/include/,.FOR,./.FOR,/usrx/local/intel/2016SP3/ipp/include/.FOR,
           /usrx/local/intel/2016SP3/mkl/include/.FOR,/usrx/local/intel/2016SP3/tbb/include/.FOR,/usrx/local/intel/2016SP3/daal/include/.FOR,
           /gpfs/tp1/usrx/local/intel/2016SP3/compilers_and_libraries_2016.3.210/linux/compiler/include/intel64/.FOR,
           /gpfs/tp1/usrx/local/intel/2016SP3/compilers_and_libraries_2016.3.210/linux/compiler/include/.FOR,/usr/local/include/.FOR,
           /usr/lib/gcc/x86_64-redhat-linux/4.4.7/include/.FOR,/usr/include/.FOR,/usr/include/.FOR,/usr/include/.FOR
       -list filename : w3unpkb7.lst
       -o    filename : none

COMPILER: Intel(R) Fortran 16.0-1633
