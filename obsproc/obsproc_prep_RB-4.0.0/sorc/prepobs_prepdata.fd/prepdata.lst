Page 1           Source Listing                  PREPOBS_PREPDATA
2017-04-18 11:09                                 prepdata.f

      1 C$$$  MAIN PROGRAM DOCUMENTATION BLOCK
      2 C
      3 C MAIN PROGRAM: PREPOBS_PREPDATA
      4 C   PRGMMR: Keyser                ORG: NP22   DATE: 2017-01-11
      5 C
      6 C ABSTRACT: PREPARES DATA FOR USE IN ANALYSES FOR THE NDAS, NAM, GDAS,
      7 C   GFS, RAP (RAPID REFRESH), RTMA, AND URMA NETWORKS.  ALL ANALYSES
      8 C   ARE GSI.  ALSO RUNS IN HOURLY NETWORK TO PROCESS GOES CLOUD DATA
      9 C  (ONLY).  WRITES DATA TO PREPBUFR FILE WHICH CONTAINS 10000-BYTE BUFR
     10 C   MESSAGES. HERE A "REPORT" IS SEPARATED INTO MASS AND WIND PIECES.
     11 C
     12 C PROGRAM HISTORY LOG:
     13 C 1984-05-30  G. D. DIMEGO (W/NMC22)
     14 C 1985-10-21  G. D. DIMEGO -- UNIFIED CODE FOR REGIONAL AND GLOBAL OI
     15 C 1986-04-28  G. D. DIMEGO -- ADDED SWITCHES TO DATA CARD NAMELIST
     16 C 1986-06-18  G. D. DIMEGO -- REMOVED RADIATION CORRECTION SUBROUTINES
     17 C 1987-01-12  D. A. KEYSER -- MODIFIED TO PROCESS NOAA-10 TOVS DATA
     18 C 1987-03-10  D. A. KEYSER -- CODE STREAMLINED, QUALITY MARK CHANGES
     19 C 1987-06-14  D. A. KEYSER -- ADDED CAPABILITY TO PROCESS VAS, DMSP
     20 C 1987-12-29  D. A. KEYSER -- DELETE MASS REPORTS FROM INDIAN RAOBS
     21 C 1988-04-11  D. A. KEYSER -- ADDED NAMELIST SWITCH, NEW  WIND INTERP.
     22 C 1988-08-24  D. A. KEYSER -- ADDED DMSP F-9, NHC SATWNDS; CHG TOVS R.T.
     23 C 1988-09-14  D. A. KEYSER -- ADDED TOVS PHYSICAL RETR, SPLASH-LVL DROPS
     24 C 1988-10-25  D. A. KEYSER -- ADDED WV WND,SATWND SWITCHES;RMV ON29 TOVS
     25 C 1988-12-22  D. A. KEYSER -- STREAMLINED 'SFCDTA'; NEW SFC SWITCHES
     26 C 1989-01-25  D. A. KEYSER -- CORRECTED CAT. 2 PSFC ERROR WHEN MISSING
     27 C 1989-02-16  D. A. KEYSER -- NEW SUBR. LNDCHK & SWITCHES FOR SFC & UAIR
     28 C 1989-03-15  D. A. KEYSER -- NEW Q.M. IN 'ISPMRK'; ADDED SUBR. 'ISFMRK'
     29 C 1989-04-17  D. A. KEYSER -- ADDED 'SPCIAL';STRMLINED 'MSTBOG'&'MANDOB'
     30 C 1989-04-24  D. A. KEYSER -- CHKS TOVS FILTER FLG;B-LINE CHK U-AIR RPTS
     31 C 1989-05-12  D. A. KEYSER -- NADIR PROX. INDIC. ADDED TO TOVS STN. ID
     32 C 1989-06-15  G. J. DIMEGO -- TIGHTER LIMITS TO HYDRO. CHECK IN 'SMERGE'
     33 C 1989-12-13  D. A. KEYSER -- ADDED BASELINE CHK; ADDED MASS PROCESSING
     34 C    FOR AIRCFT & SATWND; U-AIR RPT TOSSED IF MAND. MASS/WIND LEVELS
     35 C    MONITOR PURGED
     36 C 1990-01-11  D. A. KEYSER -- COMP. IN FORTRAN77 (RESTRUCTURED); ADDED
     37 C    DUPL. WIND LVL CHECK
     38 C 1990-02-06  D. A. KEYSER -- ADDED SWITCH 'PHISWN' & PRINT TBL SATWNDS
     39 C 1990-07-11  D  A. KEYSER -- HONORS NEW AIRCFT Q. MARKS
     40 C 1990-09-19  D  A. KEYSER -- DVAL TEST ON U-AIR CAT.2 LVL1 PRES, FAIL
     41 C    ASSUMES NOT PSTN
     42 C 1990-10-25  D. A. KEYSER -- SUBR. 'PWATER' TO PROC. RAOB, SSM/I,
     43 C    TOVS PWATER; FCN. 'PWCLC' TO CALC. RAOB PWATER; TOSSES DEF. CAT
     44 C    SAT. MBOGUS; SUBR. 'UNPO29' + ENTRIES TO UNPACK RPTS FROM ON29
     45 C    D-SETS; PROCESSES SSM/I WSPD/PWATER
     46 C 1991-01-03  D. A. KEYSER -- MISPLACED INSAT RPTS (N OF 40N) TOSSED;
     47 C    PMSL BOGUS R. TYPE EXPANDED
     48 C 1991-01-23  D. A. KEYSER -- SWITCH 'FILL' EXPANDED TO 'FILLZ/T/P/W/M',
     49 C    SUBR. 'FILLIN' SPLIT INTO 'FILWND' AND 'FILDPT'
     50 C 1991-05-14  D. A. KEYSER -- HONORS OPC PMSL AND WIND Q.M. FOR MARINE
     51 C    SFC RPTS; MARINE RPTS NOT TOSSED IF ONLY TEMP IS BAD; G. LAKES SFC
     52 C    MARINE W/ GOOD ELEV SET R. TYPE=183 & W/ ELEV=0 TOSSED
     53 C 1991-06-07  D. A. KEYSER -- ADDED PROCESSING OF PROFILER DATA
     54 C 1991-09-10  D. A. KEYSER -- PROCESSES GBL-SSI, NOT GBL-OI; SUBR.
     55 C    MANDOB REMOVED); W3FI64 REPL W3AI02; ASYNCH. READS REMOVED; ATLAS
     56 C    BUOY TEST MORE STRINGENT; SUBR. ENCDTE & LL2XY REPL W/ IW3DAT &
     57 C    W3FB04, RESP; W3FS15 REPL W/ W3FS21 & W3FS22 FOR DATE CHECKS

Page 2           Source Listing                  PREPOBS_PREPDATA
2017-04-18 11:09                                 prepdata.f

     58 C    RELATED TO HIST. RERUNS
     59 C 1991-11-19  D. A. KEYSER -- ADDED SUBR. 'CFL' & SWITCH 'WNDADJ' TO
     60 C    ALLOW MOORED BUOY WSPD BUOYS W/ ANEMOMETER HGHT < 10M TO BE
     61 C    ADJUSTED TO 10M HGHT; TOSSES SSM/I WSPD OR PW W/ Q.MARK .GT. LIMIT
     62 C 1992-01-27  D. A. KEYSER -- CHG IN BASELNE CHK; 925 MB MAND. LVL DATA
     63 C    PROCESSED FROM CAT. 8 (Z), 2, 3; HANDLES CLASS SNDGS (ON29 R.TYPE
     64 C    =13, OI/SSI R.TYPE=122/222)
     65 C 1992-06-10  D. A. KEYSER -- ADDED SUBR. 'MARKN' TO HANDLE NEW ON29
     66 C    Q. MARKS OUTPUT BY NEW CQC CHK; SPCIAL & ALL FILL SWITCHES SET TO
     67 C    FALSE FOR SAT. RETR.  (ALL TYPES); TOSSES ALL DATA ON ANY CAT. 2
     68 C    OR 3 LVL IF PRESS > PSFC (1ST LVL); U-AIR PRESS. ROUNDED RATHER
     69 C    THAN TRUNCATED
     70 C 1992-07-01  D. A. KEYSER -- ADDED PROCESSING OF NESDIS GRADIENT WINDS
     71 C 1992-07-09  D. A. KEYSER -- MACHINE INDEPENDENT (NAS/CRAY); ADDED
     72 C    CALLS TO 3 NEW W3 ROUTINES TO GET MACHINE WORD LG, AND CONVERSIONS
     73 C    TO/FROM IBM INT*2; ON85 HDR FOR PREPDA INDICATES MACHINE; SEQ'L
     74 C    FIXED GRID FILE WITH NEW MASK FOR CONUS (PLUS N.H./S.H. LAND/SEA);
     75 C    PARM FLD REPLACED WITH N-LIST "&PARM" IN DATA CARDS (IUNIT); STOP
     76 C    19 & 29 ADDED FOR PROBLEM READING DATE FROM ADPUPA OR PROD. DATE
     77 C    FILE, RESP.; SUBR. "BUBBLE" REPL. W/ "SHELL" (MORE EFFICIENT);
     78 C    REPL. SUBPR. FCN "QFRMTP" W/ IN-LINE FCN STMNT.; 925 MB LVL NOT
     79 C    PROC. AS CAT. 2 OR 3 IF MAND. LVL; NOBS ARRAY NOT FILLED W/
     80 C    VARIABLE IF .GT. 32767
     81 C 1992-08-07  D. A. KEYSER -- Q.MARK FOR BOTH TEMP & WIND FOR CONV'L/
     82 C    AMDAR AIRCFT FROM PROD AIRCFT ON29 D-SET NOW OBTAINED FROM 1ST
     83 C    BYTE RATHER THAN FROM 2'ND OR 4'TH BYTE FOR TEMP & WIND, RESP.;
     84 C    TEST FOR AMDAR ACFT RPTS LOOKS ONLY FOR 'Z' IN 6'TH BYTE OF STNID
     85 C    (NO MORE 'A'); ATLAS BUOY TEST MORE STRINGENT; ADDED GEOGRAPHICAL
     86 C    TEST TO N-LIST SWITCH "AWINDO" (BASED ON IN/OUT CONUS); ADDED
     87 C    SWITCH "PGAFUS" TO ALLOW CONV'L AIREP/ PIREP ACFT FLT LVL RPTS
     88 C    OVER CONUS TO BE TOSSED IF > 100 MDCRS RPTS HERE; STOP 69 ADDED
     89 C    FOR OVERFLOW PACKING FULL-WORD ARRAY TO 16-BIT ARRAY (& LOG MSG.)
     90 C 1992-09-08  D. A. KEYSER -- ADDED CALL TO W3AI39 TO CONVERT STN. ID
     91 C    FROM ASCII TO EBCDIC ON CRAY PRIOR TO WRITE; STN. ID PKED INTO RPT
     92 C    HEADER IN SUBR. FILLX NOT RPTLBL
     93 C 1992-12-02  D. A. KEYSER -- CALLS W3FI77 NOT W3FI60 TO UNPACK PROFLR
     94 C    RPTS DIRECTLY FROM SEQ'L BUFR FILES; DEFAULT FOR 'IUNIT' ARRAY
     95 C    CHGED SINCE BUFR TABLEB/TABLED HARDWIRED IN UNIT 20/21; U-AIR CAT.
     96 C    4 CALC. PRESSURES SET TO NEAREST INTEGER (WERE TRUNCATED); PROFLR
     97 C    RPTS CAN ALSO BE INPUT IN ADPUPA FILE (ON29 CAT.4); IMPROVED
     98 C    PRINTOUT FOR CAT. 6 MASS/WIND RPTS W/ BAD/MSG DATA; ACFT RPTS W/
     99 C    BAD/MSG TEMP NO LONGER PROCESS MASS PIECE; MDCRS RPTS USE NEW,
    100 C    EXPAND. Q.M., CHGS. SSI/OI Q.M. ON MDCRS WIND FROM 2 TO 1
    101 C 1993-02-10  D. A. KEYSER -- MODIFIED TO CALL NEWEST VERSION OF W3FI77
    102 C 1993-03-17  D. A. KEYSER -- MODIFIED TO CALL NEWEST VERSION OF W3FI77;
    103 C    INPUT QUALITY INDICATOR TO FCN 'MARKP' CAN BE FROM EITHER EDTN. 0
    104 C    OR 2 BUFR MSGS; DIAG. PRINTOUT WHEN CAT. 0 MOIST. BGS. RPT FOUND
    105 C    AND TOSSED (AGREES W/ GESS OR INDETERMINATE); AFTER 00Z 4/1/93
    106 C    CAT. 7 & 8 MOIST. BGS. PROCESSED EVERYWHERE (NO LONGER MEAN
    107 C    "DEFAULT")
    108 C 1993-04-01  D. A. KEYSER -- ADDED COND. CODES 18, 99; ADDED SWITCHES
    109 C    "NHWRD" & "NLWRD" TO DEFINE STRUCTURE OF NOBS ARRAY
    110 C 1993-05-12  D. A. KEYSER -- WORD 2 FOR EACH MASS/WIND LVL IS PRESS.
    111 C    X 10MB, NEW WORD 5 FOR EACH LEVEL CONTAINS 4 PACKED "PREPBUFR TBL
    112 C    VALUES" WHICH CAN RANGE FROM 0-15 AND CORRESPOND TO ON29 Q.
    113 C    MARKERS OR PREPRO-GENERATED Q. MARKERS OR ON29 CAT. NO.; ALL
    114 C    NON-MISSING DATA ARE NOW PACKED INTO PREPBUFR REGARDLESS OF

Page 3           Source Listing                  PREPOBS_PREPDATA
2017-04-18 11:09                                 prepdata.f

    115 C    QUALITY; IN INTERNAL PROCESSING MISSING DATA GET PREPBUFR TABLE
    116 C    VALUE OF 16 NOT 10; VERT. COORDINATE INDICATOR ADDED TO PREPDA
    117 C    TABLE VALUE LIST FOR VARIABLES; SUBR. "TWOBIT" REPL. BY W3LIB
    118 C    ROUTINE "GBYTES"; IN SUBR. GETC06, HIGH LVL PRESS (MB * 10)
    119 C    ROUNDED TO NEAREST WHOLE NUMBER (WAS TRUNCATED) WHEN CONVERTED TO
    120 C    INTEGER
    121 C 1993-05-31  D. A. KEYSER -- ADDED SUBR. "SATBFR" TO PROCESS TOVS
    122 C    RETR. FROM INPUT BUFR FILES, CURRENTLY PROCESSES ONLY NESDIS
    123 C    40-LVL(80KM) RETR. (LATER INTERACTIVE), "SATBFR" CALLS NEW W3LIB
    124 C    "W3FI80" TO DECODE; RENAMED SWITCH "TIROST" TO "TOVEDS", ADDED
    125 C    SWITCH "TOVBFR"; RENAMED SUBR. "SATSND" TO "SATEDS"; NEW SUBR.
    126 C    "SNDTBL" PRINTOUT OF COUNTS FOR ALL SAT. RETR. TYPES ; INCR. MAX
    127 C    VALUE FOR SWITCH "KTOP" FROM 20 (1.0 MB) TO 22 (0.1 MB), "KTOP"
    128 C    NOW APPLIES TO ALL VAR. AND TO MAND. & SIG. LVLS FOR ALL SAT.
    129 C    RETR. TYPES; ADDED PRINTOUT FOR TOVS(BUFR) COUNTS {BOTH NO.
    130 C    PROCESSED & NO. SKIPPED (BY REASON)} IN SUMMARY AT END; CHANGED
    131 C    DEF. VALUES & ORDER FOR SWITCH "IUNIT", ADDING IUNIT(7) TO POINT
    132 C    TO TOVS(BUFR) FILES; REDEFINED OI/SSI R. TYPES FOR SATELLITE
    133 C    RETR., ADDED NEW R. TYPE (286) FOR ERS1 SCATTEROMETER WINDS,
    134 C    REDEFINED & ADDED NEW R. TYPES FOR SATWNDS (MASS/WIND); SWITCH
    135 C    "IRTRV" EXPANDED TO 3-DIM. W/ 3'RD DIM REFERRING TO SAT./RETR.
    136 C    TYPE (ALLOWS DIFF. SWITCHES FOR NESDIS 40-LVL RETR. VS.
    137 C    INTERACTIVE); MODIFIED SWITCHES "SWINDO", "SWNLND", "JSWIND",
    138 C    "JSMASS" TO BE 3-DIM. TO BETTER ORGANIZE SATWND RPTS. BY
    139 C    PRODUCER/SAT/PRODUCT COMBINATION; IMPROVED PRINTOUT FOR TBL OF
    140 C    SATWND COUNTS
    141 C 1993-07-28  D. A. KEYSER -- NEW SWITCH "OBUFR" ADDED TO PASS FILLED
    142 C    REPORTS IN "NOBS" ARRAY THRU INTERFACE TO ENCODE IN PREPBUFR FILE
    143 C    (=TRUE) (=FALSE WRITES TO RECORDS IN PREPDA FILE AS BEFORE),
    144 C    INTERFACE NOT YET READY; N-LIST "PARM" INCLUDES IUNIT(13), UNIT
    145 C    NO. FOR PREPBUFR D-SET; R. TYPE 183 NOW EST. PSTN FROM RPTED PMSL
    146 C    & TEMP RATHER THAN FROM STD. ATMS.; R.TYPE 151-153 PWATER NOW
    147 C    STORED IN MM*10 RATHER THAN MM; SWITCHES "JPSSMI" & "XWINDO" NOW
    148 C    2-DIM ARRAYS W/ 1ST DIM INDICATING LAT. BAND (CAN PROCESS/NO
    149 C    PROCESS FOR 6 LAT. BANDS); TABLE IN SUBR. GETSMI SUMMARIZES SSM/I
    150 C    COUNTS BY LAT. BAND
    151 C 1993-09-14  D. A. KEYSER -- ADDED SWITCH "TVIRT" TO OUTPUT TEMP. AS
    152 C    VIRTUAL (=TRUE, DEFAULT) OR AS SENSIBLE (=FALSE) FOR RAOB, RECCO/
    153 C    DROPS, CLASS & SFC DATA; IF VIRT. TEMP > 375K (>325K ABOVE 100 MB)
    154 C    STORES SENS. TEMP WITH "FAILED" Q.M. AND SETS DWPT TEMP TO MSG FOR
    155 C    U-AIR REPORTS; CALLS LIBRARY FCN 'EXIT' WHEN NON-ZERO STOP
    156 C    CONDITION OCCURS -- ALLOWS FOREGROUND EXIT STATUS IN UNIX TO MATCH
    157 C    FORTRAN COND. CODE
    158 C 1993-10-07  D. A. KEYSER -- PGM COMPL. W/ C.CODE=04 IF EITHER ADPUPA
    159 C    OR ADPSFC CONTAIN NO RPTS; MSG VALUE IN NOBS ARRAY IS 99999,
    160 C    ACTUAL HEIGHT (NO D-VAL) STORED IN NOBS ARRAY, STREAMLNED W3FIZZ
    161 C    W/ MORE VARIABLES PASSED THRU COMMON; ORDER FOR PROCESSING SFC
    162 C    DATA REARRANGED S.T.: 1ST ALL LAND TYPES, NEXT ALL MARINE TYPES,
    163 C    FINALLY ALL PMSL BOGUS TYPES; READING & UNPKING OF ON29 RPTS
    164 C    STREAMLINED BY REPL. READING OF REC. & CALL TO W3FI64 W/ CALL TO
    165 C    IW3GAD (ALSO ALLOWS FOR DIFFERENT VERSIONS OF IW3GAD WHICH MAY NOT
    166 C    NECESSARILY POINT TO ON29 FORMAT D-SET)
    167 C 1993-11-02  D. A. KEYSER -- ADDED SWITCH 'RECSLM' TO PROCESS/NO PROC.
    168 C    (T/F) CAT. 6 RECCO MASS LEVELS (DEF=T); ALL CAT. 6 LEVEL DATA NOW
    169 C    STORE ON29 CAT. IN MOIST. TBL VAL. SLOT; FOLLOWING PERTAINS TO
    170 C    SINGLE-LVL CAT. 1 RECCOS: NO LONGER O-PUT SFC. PRESS. (ONLY) IN
    171 C    1ST LVL OF MASS/WIND RPT; NOW PROCESSED IN SUBR. 'GETC06'; MAND.

Page 4           Source Listing                  PREPOBS_PREPDATA
2017-04-18 11:09                                 prepdata.f

    172 C    P-LVL STILL INCL. GEOPOT. BUT TEMP, MOIST., WIND & ELEV NOW
    173 C    TREATED ON 2ND LVL LIKE CAT. 6 (PRESS. EST. FROM GEOPOT., ELEV,
    174 C    AND TEMP); STORE ON29 R.TYPE AND INSTR. TYPE IN WORDS 9 & 10 OF
    175 C    OUTPUT RPT HDR, RESP. AND THEN ENCODE IN BUFR; MONITOR PURGE ON
    176 C    ALL U-AIR MAND. LVL WINDS/HGHTS-TEMPS NOW PUTS SAME TBL. VALUE ON
    177 C    ALL SIG. LVL WINDS/TEMPS AND CAT. 4 HGHTS IF MONITOR PURGE ON
    178 C    MAND-LVL HGHTS; SWITCHES PG4243, PGAFUS, AIRLND, SWNLND, MARLND,
    179 C    LFMAX & IRTRV NOW DO NOT TOSS REPORTS BUT RATHER FLAG ALL
    180 C    VARIABLES W/ PREPBUFR T. VAL =15; NEW SWITCH 'IPRINT' CONTROLS AMT.
    181 C    OF PRINTOUT FOR TOSSED/FLAGGED REPORTS; FOR SATBFR=T CAN NOW
    182 C    PROCESS MIXTURE OF NESDIS 40-LVL & I/A RETR., RETR. SUMMARY TABLE
    183 C    EXPANDED TO INCL. COUNTS FROM BOTH RETR. SOURCES; WILL NOW PRODUCE
    184 C    'OLD-FMT' PREPDA D-SET FROM EACH PROCESSED RPT
    185 C 1993-12-21  D. A. KEYSER -- ADDED SUBR. FIZZ02 TO MAKE AN OLD I*2
    186 C    PREPDA DATA SET FROM NOBS ARRAY; W/ DUPL. LVLS IN SUBR. WNDBYP/
    187 C    WNDBYZ NOW ENSURES THAT BEST TEMP IS KEPT REGARDLESS OF HGHT TBL.
    188 C    VAL. & WILL NOT TRANSF. DWPT TO LVL WHERE MSG UNLESS FILLM=T OR
    189 C    TEMP. HAS BEEN TRANSF.; IN SUBR. WNDBYZ HGHTS MUST AGREE TO
    190 C    NEAREST 100'TH M TO BE DUPL.; THE ON29 CAT. STORED W/ U-AIR WIND
    191 C    LVLS NOW PRECISELY IDENT. AS CAT. 3 OR CAT. 4; IN SUBR. WNDBYZ NO
    192 C    LONGER SET 2 LVLS W/I 1 MB OF EACH OTHER TO SAME PRESSURE; CAT. 4
    193 C    & 6 WIND LVLS NOW HOLD P-ALT IN WORD 1 OF LVL INFO (NOBS) W/ TBL.
    194 C    VAL. IN POS. 3 OF WORD 5 (BOTH WERE MSG); FOR SFC DATA IF PMSL
    195 C    T.V. BAD, SET PSTN T.V. TO 15 (AND VICE VERSA), ALSO IF PSTN MADE
    196 C    FROM PMSL VIA FCN, SET ITS TBL. VAL. TO MAX OF 8 OR PMSL TBL.
    197 C    VAL.;; INCR. MAX NO. LVLS THAT CAN BE PROCESSED FROM 200 TO 300;
    198 C    ONLY TOVS I/A RETR. SET PSTN (1ST LVL) TO PBOT VALUE RETURNED FROM
    199 C    W3FI80, NESDIS 40-LVL RETR. CAN'T GET A PSTN
    200 C 1994-07-19  D. A. KEYSER -- ATLAS BUOYS HAVE ON29 R. TYPE 562 NOT
    201 C    561 AFTER 2/23/94, ALSO TIGHTENED LAT TEST; FOLLOWING PERTAINS TO
    202 C    SINGLE-LVL CAT. 2/3 RECCOS: NO LONGER O-PUT SFC. PRESS. (ONLY) IN
    203 C    1ST LVL OF MASS/WIND RPT; NOW PROCESSED IN SUBR. 'GETC06'; PSTN-
    204 C    LVL STILL INCL. BUT GEOPOT. NOW ZERO RATHER THAN 'ELEV' ALSO TEMP,
    205 C    MOIST., WIND & ELEV NOW TREATED ON 2ND LVL LIKE CAT. 6 (PRESS.
    206 C    EST. FROM GEOPOT., ELEV, TEMP)
    207 C 1994-08-11  D. A. KEYSER -- ADDED PROCESSING OF TOVS VIA INPUT FILE
    208 C    WHICH RETURNS UNPACKED ON29 (NOT OPER'L), INVOKED IF TOVS DCTY
    209 C    FILE EMPTY; PROCESSES CAT. 4 LVLS EVEN IF NO. OF CAT. 4 LVLS < SUM
    210 C    OF CAT. 1,3,5 LVLS; ANY CAT. 2 OR 3 LVL > (BELOW) SFC. PRESSURE NO
    211 C    LONGER SKIPPED, ALL VARIABLES ON LVL FLAGGED; C.CODE=18 REMOVED;
    212 C    SWITCHES 'NHWRD', 'NLWRD' & 'KMAX' REMOVED, HARDWIRED IN CODE;
    213 C    STORE ELEV IN WORD 11 OF NOBS RPT HDR AND ENCODE IN BUFR); ADDED
    214 C    PARAMETER NAMES TO ALLOW FOR CHANGING ARRAY SIZES; SWITCH 'TVIRT'
    215 C    REMOVED; VIRT. TEMP NOW CALC. IN SUBR. 'STOROB' PRIOR TO WRITING
    216 C    TO NOBS ARRAY; WORDS 6 AND 7 OF MASS(WIND) LVL NOW CONTAIN VIRT.
    217 C    TEMP (WIND DIR) AND DWPT TEMP(WSD), RESP., ALSO WORD 3 OF MASS LVL
    218 C    NOW CONTAINS "REPORTED" TEMP; RPT SEQ. NUMBER STORED IN WORD 12 OF
    219 C    NOBS HEADER; RPT. SEQ. NO., VIRT. /RPTED/DWPT TEMP, WIND DIR. &
    220 C    SPEED ALL ENCODED IN BUFR; RAOBS FAILING B-LINE CHK NOW FLAG ALL
    221 C    CAT. 4 LVLS BELOW TOP SPANNING PRESS. (BEFORE LVLS NOT PROCESSED);
    222 C    WSPD & DIR ENCODED TO BUFR; ADDED ENTRY CMDDFF TO SUBR. 'UV' TO
    223 C    CONVERT WIND U- & V-COMP BACK TO SPEED/DIR; ALL DUPL. PRESS.
    224 C    CHECKS NOW REQUIRE PRESS. TO AGREE TO NEAREST 10'TH OF A MB TO BE
    225 C    A DUPL. (WAS NEAREST WHOLE MB); CALC. CAT. 4 PRESS. NOW STORED TO
    226 C    NEAREST 10'TH OF A MB (WAS NEAREST WHOLE MB); ADDED SWITCH
    227 C    'IREANL'; SWITCH 'MARLND' NOW APPLIES TO OCEAN STN U-AIR (RAOB,
    228 C    PIBAL) RPTS AS WELL AS TO MARINE SFC RPTS; ADDED COND. CODE 22, IF

Page 5           Source Listing                  PREPOBS_PREPDATA
2017-04-18 11:09                                 prepdata.f

    229 C    CHAR. ON MACHINE NOT ASCII OR EBCDIC; NOW DETERMINES MACHINE CHAR.
    230 C    TYPE RATHER THAN ASSUMING ASCII; TEST FOR MISSING LAT/LON EXPANDED
    231 C    TO INCL. LAT/ LON OUTSIDE POSS. RANGE; SUBR. 'TOVSID' REWRITTEN TO
    232 C    INCR. EFFICIENCY; INCR. STNID FROM 6 TO 8 CHAR; AIRCFT AIREP/PIREP
    233 C    RTPS NOW GET 7'TH CHAR. (FROM ON29 RES. CHAR) ADDED TO STNID AND
    234 C    THE CARRIER ID IS CORRECTED BASED ON INPUT ID; ADDED SWITCH
    235 C    'IACARL' TO INDICATE FLOOR FOR MDCRS; CONV'L/ AMDAR QCACFT WSPD
    236 C    INCR. Q.M. NOW KEPT IN COMMON FOR RPT; RCPT TIME, RPT SUB-TYPE AND
    237 C    QCACFT WSPD INCR. Q.M. (CONV'L/AMDAR AIRCFT WIND RPTS ONLY)
    238 C    ENCODED INTO RPT HEADER IN PREPBUFR
    239 C 1994-08-30  D. A. KEYSER -- NEW SUBR. 'INTERP' INTERPS. TOVS I/A
    240 C    RETR. TEMP AND SPEC. HUMIDITY TO MANDATORY LEVELS
    241 C 1995-07-12  D. A. KEYSER -- ADDED SUBR. 'GOESDG' & SWITCHES 'GOESND'
    242 C    & 'GOESPW' TO PROCESS GOES SOUNDINGS & 4-LAYERS PWATER; ADDED
    243 C    IUNIT(14) FOR OUTPUT REWRITES OF GOES BUFR MSGS; CALLS TO SUBR.
    244 C    'UFBQCD' TO ENCODE PGM CODE FOR PREPDATA INTO PREPBUFR; CAN
    245 C    PROCESS RGL PREPBUFR (TEMPORARILY DIFFERS FROM GBL PREPBUFR);
    246 C    REMOVED LOGIC TO PROCESS VAS RETR.; CAN PROCESS SSM/I 7-CHN
    247 C    BRIGHT. TEMPS.; PWATER NOBS PROCESSING MODIFIED TO HANDLE > 1 LVL,
    248 C    P-SLOT VALUE IDENTIFIES PWATER TYPE; R.TYPES 151- 159 USED FOR
    249 C    PWATER TYPES, SATWND TEMPS HI- & LO-LVL NOW COMBINED IN R. TYPES
    250 C    140-149, CLIMATOLOGY R.T. REMOVED; GOES-EVN & -ODD SATWND (MASS/
    251 C    WIND) R.TYPES NOW SEPARATE; ADDED SWITCH "PHIACF", DEFINES LAT.
    252 C    BANDS FOR SELECTING ACFT RPTS; EXPAND. SWITCHES "AIRLND",
    253 C    "JAWIND", "JAMASS" TO (6,4) ARRAYS TO SELECT BY LAT. BAND; ADDED
    254 C    TABLE SUMMARIZING ACFT COUNTS BY LAT. BAND; DATA SEARCH GRID NO
    255 C    LONGER APPLIES TO ACFT RPTS; ADDED SWITCHES 'VADWND' & 'MWINDO' TO
    256 C    PROCESS VAD (NEXRAD) WINDS; ADDED IUNIT(15) FOR OUTPUT REWRITES OF
    257 C    VAD BUFR MSGS; NOW RETAINS PRESS. IF > 1075 MB FOR U-AIR RPTS BUT
    258 C    FLAGS PRESS Q.M., SAME FOR U-AIR SFC. PRESS. OUTSIDE DVAL LIMIT;
    259 C    SUBR. SMERGE, WNDBYP, WNDBYZ, FILWND, FILDPT CHECK PRESS. Q.M. FOR
    260 C    SPANNING LVL, IF BAD INTERP. VALUE IS BAD; SPEC. HUM. SET TO MSG
    261 C    IF PRESS. Q.M. BAD; ACCOUNTED FOR CHANGES/FIXES TO RECCO DECODER
    262 C    (AUG. 95) BY REFORMATTING BACK TO OLD FORMAT SINCE EXISTING LOGIC
    263 C    WILL CORRECT ERRORS; MNEMONIC 'TSB' (REPORT SUB-TYPE) NOW USED TO
    264 C    HOLD INDICATOR FOR MISSING PHASE OF FLIGHT FOR ACFT AMDAR REPORTS
    265 C 1995-08-24  D. A. KEYSER -- FOR 925 MB MAND. LVL PREPBUFR TBL VAL FOR
    266 C    VERT. COORD. (PRESS) INIT. TO DEFAULT (7), BEFORE INIT. TO 16; R.T
    267 C    182 NOW INCLUDES RECCOS W/ EST. PMSL; CHGD DEF. VALUE FOR SWITCH
    268 C    "FWINDO(5)" FROM 300. TO 600.; R.T. 132 DROPS SFC. DATA ALL
    269 C    FLAGGED FOR NON-USE BY ANAL. (USED LATER AS R.T 182), SAME FOR
    270 C    CAT. 2 SNGL-LVL RECCOS SFC. DATA (PMSL, Z); R.T. 182 RECCOS W/
    271 C    EST. PMSL CORRECTED TO GET SFC. HGHT OF ZERO RATHER THAN FROM
    272 C    RPTED ELEV (P-ALT); DVAL CHECK ON R.T. 182 PRESS. CHGD FROM LOW-
    273 C    LIMIT OF -75MB TO -215MB TO ACCEPT PRESS. IN HURRICANE SITUATIONS;
    274 C    R.T. 182'S NOW NOT PROCESSED IF CAT. 2 SFC PRESS. MSG (UNLESS CAT.
    275 C    3 SFC PRESS. AVAIL), OR IF CAT. 2 SFC PRESS. IS < 1MB; GOES SNDG
    276 C    SFC DATA (T,Q,Z) PREPBUFR TABLE VALUES SET TO AT BEST SUSPECT
    277 C 1996-02-07  D. A. KEYSER -- SWITCHES 'JSMASS' AND 'JSWIND' NOW HAVE
    278 C    MORE POSSIBLE VALUES THAN 0 OR 9999, ALLOWS CERTAIN COMBINATIONS
    279 C    OF SAT PRODUCERS/PRODUCTS AND EVEN CERTAIN GOES-EVEN AND ODD SAT
    280 C    NUMBERS TO BE PROCESSED BUT FLAGGED FOR NON-USE BY ANALYSIS; NOW
    281 C    RECOGNIZES THAT GOES SATWND STNID SUFFIX CHARACTER DIFFERS FOR
    282 C    EVERY-OTHER ODD OR EVEN SATELLITE; FOR RGL PREPBUFR OUTPUT:
    283 C    ORIGINAL TESTS FOR OLD PREPDA PROC. OF CAT. 4 LVLS AND PROC. OF
    284 C    CAT. 3 WINDS ON LVLS ABOVE LAST NON-MISSING HGHT AND TEMP. LEVELS
    285 C    RETAINED (TO MAKE PREPBUFR FILE CONTAIN DATA EXPECTED BY FERR PGM

Page 6           Source Listing                  PREPOBS_PREPDATA
2017-04-18 11:09                                 prepdata.f

    286 C    AND OI ANALYSIS)
    287 C 1996-03-04  D. A. KEYSER -- FOR RGL PREPBUFR OUTPUT: MORE FIXES TO
    288 C    MAKE PREPBUFR FILE CONTAIN DATA EXPECTED BY FERR PGM & OI-ANAL
    289 C    (SEE SUBR. DOCBLOCKS); REPORT SEQ. NUMBER STORED IN HDR(11) FOR
    290 C    ALL "ADPUPA" RPTS AND LATER ENCODED IN PREPBUFR FILE; ALL SFC RPTS
    291 C    SET HGHT Q.M. TO PSTN Q.M. VALUE PRIOR TO STORING RPT IN NOBS
    292 C    ARRAY & SUBSEQ. ENCODING IN PREPBUFR (USED TO ALWAYS ASSIGN HGHT A
    293 C    NEUTRAL Q.M.); ALL SFC MARINE RPTS NOW CONVERT ON29 Q.M. 'H' OR
    294 C    'P' ON PMSL TO EQUIV. PREPBUFR T. V. FOR BOTH PMSL & PSTN (USED TO
    295 C    CONVERT TO ONLY PMSL TBL VAL) (ALLOWS THESE OPC Q.M.'S TO BE
    296 C    HONORED FOR RPTS W/ VALID PSTN, WHOSE ON29 Q.M. IS ALWAYS BLANK-
    297 C    NEUTRAL)
    298 C 1996-09-03  D. A. KEYSER -- CAN NOW RETURN NMCEDS FORMAT FOR TOVS
    299 C    RETR. IN NEW BUFR DUMP FILES (SWITCH IEDSTP, NEW SUBR. W3TOVEDS);
    300 C    CAN PROCESS RETR. FROM GOES-ODD SAT (AS WAS FOR GOES-EVEN SAT); E-
    301 C    O-F ON FIXED LAND/SEA/U.S. MASK FILE NOW STOPS W/ C.CODE 49 (USED
    302 C    TO IGNORE MASKS); ADDED PROCESSING FOR NESDIS HI-DENSITY SAT.
    303 C    WINDS (SWITCHES "SWINDO", "SWNLND", "JSWIND", "JSMASS" EXPANDED),
    304 C    R.TYPES EXPANDED; PROCESSING OF TOVS RADIANCES PARTIALLY DONE
    305 C    (SWITCH "TOVRAD"); ADDED SWITCH "MSGPSF" TO PROCESS SFC LAND RPTS
    306 C    W/ MISSING PSTN AND PMSL (STD. ATMS. PSTN USED) (NOT PROC. IN
    307 C    OPERATIONS); ALLOW BUFR EDIT. 3 WIND PROFILER MSGS TO BE
    308 C    PROCESSED; WIND PROFILER LVLS WITH Q. CODE INDICATOR 2 (IN EDIT. 2
    309 C    OR >, SHEAR CHK AND/OR MEDIAN CHK NOT PERFORMED OR INCONCL.) NOW
    310 C    GET PREPBUFR TBL. VAL. 11 (BAD), BEFORE SUCH LVLS WERE OF NEUTRAL
    311 C    QUALITY; CAN READ WSPD IN M/S X 10 FROM ON29 CAT.8, C.FIG. 924 IF
    312 C    AVAILABLE
    313 C 1996-10-24  D. A. KEYSER -- LOGIC ADDED TO PROCESS TOVS RADIANCES
    314 C    FROM BUFR DUMP FILE AND ENCODE THEM INTO PREPBUFR FILE, CALL TO
    315 C    W3FI80 REPLACED BY W3TOVUNP, N-LIST SWITCHES "TOVRAD" AND "TOVRTV"
    316 C    ADDED TO PROCESS RADIANCES AND RETRIEVALS RESP.; LOGIC RELATED TO
    317 C    INTERACTIVE RETR. PROCESSING REMOVED, SUBR. "INTERP" REMOVED;
    318 C    HARDWIRED TO NO LONGER WRITE TO SEQ'L. 16-BIT PREPDA DATA SET;
    319 C    ADDED CALL TO BUFRLIB "DATEBF" TO RETURN CENTER DATE FOR TOVS BUFR
    320 C    DATA DUMP FILES (SIMPLIFIES OTHER TIME-CHECKING PROCEDURES);
    321 C    STREAMLINED PARTS OF SUBR. "SATEDS", NOW PRINTS COUNT OF RPTS.
    322 C    OUTSIDE TIME WINDOW; DEFAULT FOR N-LIST SWITCH "IDELEV" UP'D FROM
    323 C    20 TO 30 (METERS), FOR U-AIR REPORT FAILING B-LINE CHK ANY
    324 C    VARIABLES WITH AN EXISTING KEEP FLAG ON THEM WILL NOT BE FLAGGED
    325 C    AS BAD OR SUSPECT; ADDED LOGIC TO PROCESS ERS SCATTEROMETER WIND
    326 C    REPORTS (R.TYPE=286) AND ENCODE IN PREPBUFR D-SET (USED TO BE
    327 C    APPENDED LATER), NEW SUBR. "GETERS" CALLS NEW W3LIB "W3ERSUNP",
    328 C    NEW N-LIST SWITCHES JPERSD(6) & IEWNDO(2), CAN WRITE TIMELY BUFR
    329 C    MESSAGES TO IUNIT(16); REORGANIZED/STREAMLINED COMMON BLOCKS;
    330 C    CORRECTED ERROR IN ENCODING OF INITIAL VALUES FOR HEADER MNEMONICS
    331 C    "RQM", "DUP", "PRG", "SRC", AND "RUD" (ONLY USED FOR REANALYSIS
    332 C    VERSION)
    333 C 1997-01-31  D. A. KEYSER -- ADDED CALL TO NEW SUBR. "W3UNPK77" AND
    334 C    ADDED N-LIST SWITCHES "IACFTL" (REPL. "IACARL"), "AIFNOW", AND
    335 C    "IPRFTP" [THE FIRST TWO ALLOW AIRCRAFT DATA TO BE FLAGGED OR
    336 C    TOSSED IF BELOW "FLOOR" OR WIND IS MISSING, THE THIRD SELECTS THE
    337 C    TYPE OF INPUT FILE FOR WIND PROFILER DATA (WMO BUFR VS. BUFR
    338 C    DUMPS)] - ALL OF THIS IS TO ALLOW THIS PROGRAM TO READ OBS. DATA
    339 C    EITHER FROM OLD NAS9000 PROCESSING OR NEW CRAY/BUFR INGEST
    340 C    PROCESSING
    341 C 1997-05-01  D. A. KEYSER -- AT END OF SUBR. WNDBYZ WILL NOW ALWAYS
    342 C    RESORT ALL REPORTS BY PRESSURE TO ENSURE THAT ALL REPORTS IN THE

Page 7           Source Listing                  PREPOBS_PREPDATA
2017-04-18 11:09                                 prepdata.f

    343 C    PREPBUFR FILE WILL BE ARRANGED IN DECREASING PRESSURE (ERRONEOUS
    344 C    REPORTS MAY CONTAIN HEIGHTS THAT ARE OUT OF ORDER NOW); EXPANDED
    345 C    ARRAYS NOBS, DAT, TMP TO HOLD P,T,q,W REASON CODES; EST. REASON
    346 C    CODES FOR UPPER-AIR DATA TYPES (CURRENTLY JUST 100, 101-103, 105
    347 C    TO IDENTIFY INTERPOLATED DATA FOR CQCBUFR PGM); CHGS IN LVL ON29
    348 C    CATEGORY INDICATORS: SPEC. LVLS GET CAT=7 RATHER THAN 6, TROP CAT=
    349 C    5 EXPLICITLY IDENTIFED IN ALL CASES, SAME W/ CAT 2-4; STDOUT
    350 C    EXPANDED TO INCL. REASON CODES; REASON CODES ENCODED INTO
    351 C    PREPBUFR; SUBR. 'STOROB' NO LONGER CALLED AND REMOVED, SUBR.
    352 C    'STORXX' RENAMED TO 'STOROB'; ALL REFERENCES TO NAS/HDS REMOVED
    353 C 1997-06-02  D. A. KEYSER -- REMOVED A LOT OF LOGIC TESTING FOR
    354 C    SEQNTL=F, OBUFR=F & NLWRD=4 SINCE THESE ARE NO LONGER OPTIONS;
    355 C    REMOVED FCN MARARC SINCE NO LONGER CALLED; THE REPORT D-TIME
    356 C    {HDR(4)} CHGED FROM HRS*100 TO HRS*1000 (CURRENTLY ONLY MDCRS CAN
    357 C    BE THIS PRECISE); BUFR MNEMONIC "DHR" (REPORT D-TIME) SCALE CHGED
    358 C    FROM 10**2 TO 10**3 FOR MORE PRECISION IN RPT TIME; FOR AMDAR
    359 C    ACFT: CHAR. 1 & 2 OF TRUE STNID NOW READ FROM UNPKED ON29 CAT. 8
    360 C    C. FIG. 917, CHAR. 3 & 4 OF TRUE STNID NOW READ FROM UNPKED ON29
    361 C    CAT. 8 C. FIG. 918, AND CHAR. 5 & 6 OF TRUE STNID NOW READ FROM
    362 C    UNPKED ON29 CAT. 8 C. FIG. 919; FOR AMDAR AND MDCRS ACFT: CHAR. 7
    363 C    & 8 OF TRUE STNID NOW READ FROM UNPKED ON29 CAT. 8 C. FIG. 920;
    364 C    FOR MDCRS ACFT: RPT. TIME TO NEAREST 1000'TH HOUR NOW READ FROM
    365 C    UNPKED ON29 CAT. 8 C. FIG. 921; ADDED N-LIST SWITCH "IVADTP" TO
    366 C    SELECT THE TYPE OF INPUT FILE FOR NEXRAD (VAD) WIND DATA (WMO BUFR
    367 C    VS. BUFR DATA DUMP) TO ALLOW THIS PROGRAM TO READ THIS DATA EITHER
    368 C    FROM OLD NAS9000 PROCESSING OR NEW CRAY/BUFR INGEST PROCESSING;
    369 C    ADDED N-LIST SWITCH "FLDMGS" TO FLAG MOISTURE DATA ON ALL LEVELS
    370 C    FOR GULF STREAM DROPS (IF TRUE)
    371 C 1997-07-02  D. A. KEYSER -- REMOVED MORE LOGIC TESTING FOR SEQNTL=F,
    372 C    OBUFR=F, NLWRD=4 AND ALSO KMAX=12 SINCE THESE ARE NO LONGER
    373 C    OPTIONS; MODIFIED THE PROCESSING OF GOES DATA TO READ FROM A
    374 C    SINGLE BUFR DATA DUMP FILE USING W3LIB ROUTINE W3UNPK77 (RATHER
    375 C    THAN OLD READ FROM 2 WMO BUFR FILES WHICH USED W3FI77), ALSO READS
    376 C    IN AND PROCESSES 18-CHANNELS OF BRIGHTNESS TEMPERATURE (IF
    377 C    REQUESTED FROM NEW N-LIST SWITCH "GOESRD"); QUAL. MARKER FOR VAD
    378 C    WIND LEVELS WITH INPUT RMS VECTOR ERROR TAG OF "B" (3.9 KNOTS)
    379 C    DOWNGRADED FROM NEUTRAL TO SUSPECT (AT REQUEST OF NOAA/FSL);
    380 C    STREAMLINED DO LOOP PROCESSING IN PLACES TO SPEED UP PROGRAM A
    381 C    BIT; REMOVED SUBR. "TAB"; FOR U.S. SATWNDS: CHAR. 7 & 8 OF STNID
    382 C    NOW READ FROM UNPKED ON29 CAT. 8 C. FIG. 920; PROFLR AND VADWND
    383 C    GENERATE SPECIAL LEVELS BASED ON "SPCIAL" SWITCH (BEFORE,
    384 C    HARDWIRED TO ALWAYS GENERATE SPECIAL LEVELS)
    385 C 1997-07-22  D. A. KEYSER -- ESTABLISHED NEW BUFR TABLE A MESSAGE TYPE
    386 C    "GOESND" TO HOLD GOES RADIANCES/RETRIEVALS (BEFORE THEY WERE
    387 C    COMBINED WITH TOVS IN "SATEMP"); CORRECTED SOME COMMON BLOCK AND
    388 C    SUBR. ARGUMENT INCONSISTENCIES THAT MAY HAVE CONTRIBUTED TO
    389 C    STORAGE BEING "CLOBBERED"; NAMELIST SWITCH "IWINDO" FOR GOES DATA
    390 C    (LAST 10 WORDS) REDEFINED FROM WHOLE HOURS TO HOURS * 100 TO GIVE
    391 C    MORE PRECISION IN DEFINING GOES TIME WINDOW
    392 C 1997-08-28  D. A. KEYSER -- CORRECTS FOR GOES CALC. NEGATIVE TOP
    393 C    LAYER P. WATER WHICH CAN NOW OCCUR DUE TO ROUND-OFF ERROR IN INPUT
    394 C    BUFR DUMP FILE - SETS TO 0 IF > -1 MM, ELSE TOSSES PWATER REPORT;
    395 C    TOSSES GOES PWATER RPT IF ANY OF THE LAYER VALUES ARE MISSING OR
    396 C    < ZERO
    397 C 1997-09-18  D. A. KEYSER -- REMOVED CALL TO "ERRSET"; ADDED "W3FS22"
    398 C    IN-LINE TO DIAGNOSE DATA CLOBBERING; REDEFINED N-LIST SWITCH
    399 C    "MSGPSF=T" TO USE ALTIMETER SETTING FOR PMSL WHEN OBS. SURFACE

Page 8           Source Listing                  PREPOBS_PREPDATA
2017-04-18 11:09                                 prepdata.f

    400 C    LAND PMSL & PSTN ARE MISSING; CAN STORE ALTIM. SETTING IN
    401 C    PREPBUFR; STORES SKIN TEMP., CLOUD AMT., SOLAR ZENITH ANG., AND
    402 C    SAT. ZENITH ANG. IN PREPBUFR WHEN PROCESSING GOES RADIANCES
    403 C 1997-10-06  D. A. KEYSER -- ADDED LOGIC TO PROCESS NEW TYPES OF
    404 C    NESDIS HI-DENS SATWNDS, ALONG WITH NEW R.TYPES {ALSO N-LIST ARRAYS
    405 C    SWINDO, SWNLND, JSWIND, JSMASS EXPANDED FROM (6,5,7) TO (6,5,10)};
    406 C    N-LIST SWITCHES LNDHRY AND BUOHRY REMOVED AS IS ALL LOGIC RE:
    407 C    PROCESSING OF ASYNPOTIC SFC REPORTS (OBSOLETE); N-LIST SWITCHES
    408 C    FILLP, SEQNTL, OBUFR, LIMITA, LIMDAY AND LIMON ALL REMOVED
    409 C    (OBSOLETE); ENCODES FOV# AS 'ACAV' INTO PREPBUFR FOR GOES REPORTS
    410 C 1998-02-17  D. A. KEYSER -- REMOVED LOTS OF OBSOLETE LOGIC, MUCH
    411 C    PERTAINING TO UNPACKED ON29 INPUT; INCREASED EFFICIF. OF CODE BY
    412 C    REPLACING CALLS TO IW3GAD WITH IW3UNPBF WHICH RETURNS REPORTS FROM
    413 C    BUFR IN UPDATED FMT; ADDED SEVERAL OTHER INTERFACE REPLACEMENT
    414 C    CODES INCL. W3UNPKB7 (REPL. W3UNPK77), W3ERSUNB (REPL. W3ERSUNP),
    415 C    AND NEW VERSION OF W3FA07 - ALL ARE CURRENTLY IN-LINE; MORE
    416 C    PRECISION IN ENCODED REPORT TIME, WIND SPEED IN PREPBUFR; TROP.
    417 C    LVLS WITH WSPD=0 FLAGGED AS BAD
    418 C 1998-03-16  D. A. KEYSER -- CRISIS FIX TO BUMP UP ARRAY SIZE FOR
    419 C    UNPACKED REPORT FROM IW3UNPBF/IW3GAD TO 2500 (WAS 1608 BUT
    420 C    IW3UNPBF FILLS MORE WORDS THAN DID IW3GAD)
    421 C 1998-05-15  D. A. KEYSER -- ADDED PROCESSING OF RTOVS DATA BASED ON
    422 C    NEW NAMELIST SWITCH "RTOVS", NEW IN-LINE ROUTINES W3RTVUNP AND
    423 C    W3RTVEDS ADDED FOR INTERFACE WITH RTOVS DATA (RETURNING 40-LVL/
    424 C    RADIANCES AND PARTIAL NMCEDS FORMAT, RESP.), 250 KM RTOVS SAMPLING
    425 C    ACCOMPL. VIA PROCESSING ONLY EVERY 4'TH RETRIEVAL; ADDED KOUNTS
    426 C    FOR REJECTED TOVS/RTOVS NMCEDS DATA PROCESSING, SUMMARIZED IN
    427 C    STDOUT PRINT AT END OF PROGRAM; FLAGGING OF TROP LVLS WITH WSPD=0
    428 C    MOVED FROM SUBR. GETUPA TO STOROB BECAUSE SOME CALM TROP WINDS
    429 C    WEREN'T BEING IDENTIFIED
    430 C 1998-06-14  D. A. KEYSER -- NEW LOGICAL N-LIST SWITCH "FLGOES" IS A
    431 C    4-WORD ARRAY WHICH ALLOWS ALL SNDG/RETR DATA FROM EVERY OTHER EVEN
    432 C    OR ODD GOES SATELLITE TO BE FLAGGED FOR NON-USE BY THE ANALYSIS
    433 C    (NEEDED WHEN 2 EVENS OR ODDS ARE PRODUCING DATA BUT ONLY ONE IS
    434 C    USED OPERATIONALLY), CHAR. 6 OF GOES STNID IS NOW UNIQUE FOR TWO
    435 C    DIFFERENT, BUT CONSECUTIVE, EVEN OR ODD SATELLITES)
    436 C 1998-06-15  D. A. KEYSER -- INCR. Y2K-COMPL. BY REPL. CALL TO IW3GAD
    437 C    W/ IW3UNP29 (APPLIES ONLY TO SPSSMI FILE; SEE W3LIB ROUTINE
    438 C    IW3UNP29 FOR PSEUDO-ON85 FMT); INCL. THE OLD PREVENTS PROGRAM,
    439 C    MERGED IN AS A SUBR., CONTROLLED BY N-LIST SWITCH 'PREVEN'; ADDED
    440 C    N-LIST 'PREVDATA' WITH SWITCHES FOR PREVENTS PROCESSING; MODIFIED
    441 C    ARRANGEMENT OF INPUT DATA SET UNIT NOS. (CONTROLLED BY SWITCH
    442 C    'IUNIT' IN NAMELIST 'PARM'); PREVENTS OUTPUTS A DATA FILTERING
    443 C    EVENTS SUMMARY FILE; REMOVED OBSOLETE R.H. MNEMONICS & 'SFCBOG'
    444 C    TABLE A ENTRY; SUBR. W3FIZZ STREAMLINED TO NO LONGER SEPARATE
    445 C    SINGLE- & MULTI-LVL TABLE A TYPES; NOBS ARRAY REMOVED - DATA FOR A
    446 C    RPT NOW STORED IN HEADER ARRAY (HDR) & LVL DATA ARRAY (MOBS) -
    447 C    MOBS 3-DIM TO HANDLE VARIABLE SUBTYPE (OBS, T.V., R.C.), VARIABLE,
    448 C    & LVL; LAT, LON, OBS. TIME & RCPT TIME IN HEADER NOW STORED IN
    449 C    WHOLE DEG. & HRS TO STREAMLINE INTERFACE BETWEEN DATA DUMPS &
    450 C    PREPBUFR FILE; STREAMLINED THE PROCESSING OF CAT. 6 FLT-LVL RECCOS
    451 C    W/ EITHER MAND LVL GEOPOT. OBS OR MEAN SEA-LVL PRESS. OBS; REMOVED
    452 C    ALL LOGIC PERTAINING TO TOVS PROCESSING (SUBR. 'TOVSID' & 'TDEW'
    453 C    NO LONGER CALLED - REMOVED, N-LIST SWITCH 'RTOVS' REMOVED; N*/
    454 C    PTLY-CLDY PATH NO LONGER POSSIBLE); ENCODES SOLAR & IR RAD.
    455 C    CORRECTION INDICATOR INTO PREPBUFR FILE AS MNEMONIC 'SIRC' (FOR
    456 C    "ADPUPA" TYPES W/ VALID INSTR. TYPE), READ CAT. 8 C.F. 353; RTOVS

Page 9           Source Listing                  PREPOBS_PREPDATA
2017-04-18 11:09                                 prepdata.f

    457 C    250KM SUB-SAMPLING NOW DEPENDS UPON VALUE IN FILTER FLAG AS WAS
    458 C    THE CASE FOR TOVS (FIX BY NESDIS) (BEFORE 250KM SUB-SAMPLING WAS
    459 C    EST. BY PROCESSING EVERY 4'TH RTOVS REPORT)
    460 C 1998-09-21  D. A. KEYSER -- THIS PROGRAM IS NOW Y2K AND FORTRAN 90
    461 C    COMPLIANT; COMMENTED OUT CALL TO PREVENTS SINCE PREVENTS
    462 C    PROCESSING IS STILL DONE IN SEPARATE PROGRAM
    463 C 1998-10-09  D. A. KEYSER -- CORRECTED ERROR IN RETURNING GOES CAT. 8
    464 C    DATA IN W3UNPKB7 WHEN GREATER THAN 9 "LEVELS" ARE PRESENT; ADDED
    465 C    SECONDS TO DECODED REPORT DATE IN W3ERSUNB (ONLY USED IN PRINTS OF
    466 C    REPORT DATE)
    467 C 1998-12-11  D. A. KEYSER -- REPLACED CALL TO "ABORT" WITH CALL TO
    468 C    "BORT" (BUFRLIB ROUTINE); NO LONGER ENCODES ERS SCATTEROMETER
    469 C    INCIDENT ANGLE, AZIMUTH ANGLE, BACKSCATTER AND ERROR ESTIMATE IN
    470 C    PREPBUFR FILE (WERE ALWAYS SET TO ZERO AND NEVER USED) - SAVES A
    471 C    LOT OF SPACE IN THE PREPBUFR FILES
    472 C 1999-01-20  D. A. KEYSER -- INCORPORATED BOB KISTLER'S CHANGES NEEDED
    473 C    TO PORT THE CODE TO THE IBM SP; ADDED N-LIST SWITCHES "IVADFL" AND
    474 C    "IVADSP" TO SELECT VAD WIND RMSVE TOLERANCE; REPL. N-LIST SWITCH
    475 C    "SATLND" WITH NEW SWITCHES "ISATLS" AND "JSATLS" TO HANDLE LAND/
    476 C    SEA SELECTION FOR SATELLITE SNDGS/RADIANCES AND GOES PW RETR.
    477 C    SEPARATELY (ALSO CAN NOW SELECT JUST LAND AS WELL AS JUST SEA OR
    478 C    EVERYWHERE); N-LIST SWITCHES "RECCON" AND "RWINDO" NOW APPLY ONLY
    479 C    TO RECCO DATA, NEW SWITCHES "DROPSN" AND "DWINDO" NOW APPLY TO
    480 C    DROPS; ADDED N-LIST SWITCH "FLDMAF" WHICH CAN FLAG MOISTURE DATA
    481 C    ON ALL LEVELS FOR USAF DROPS (IF TRUE)
    482 C 1999-08-04  D. A. KEYSER -- MODIFIED TO READ BOTH REPROCESSED SSM/I
    483 C    (SPSSMI) AND ERS WIND (ERSCAT) DATA FROM "JACK WOOLLEN" BUFR FILES
    484 C    RATHER THAN FROM ON29 AND WMO BUFR FILES, RESP., REMOVED SUBR.
    485 C    W3ERSUNB AND CALL TO IT, REMOVED SUBR. UNPREP AND CALL TO IT,
    486 C    SUBR. IW3UNPBF (VIA SUBR. UNPREPBF) AND W3UNPKB7 MOD. TO HANDLE
    487 C    SSM/I AND ERS REPROC. DATA (RESP.) IN "JACK" BUFR, INPUT TABLEB
    488 C    AND TABLED FILES REMOVED; REMOVED ENCODING OF 'RQM', 'DUP', 'PRG',
    489 C    'SRC', 'RUD' AS THEY WERE ALWAYS MISSING (REANALYSIS RELATED) AND
    490 C    WASTED LOTS OF SPACE; ADDED ENCODING OF PHASE OF FLIGHT ('POAF')
    491 C    FOR ALL ACFT TYPES AND DEGREE OF TURBULENCE ('DGOT') FOR NON-MDCRS
    492 C    ACFT TYPES (REQUESTED BY NCDC); UPDATED LOGIC TO PROPERLY PROCESS
    493 C    AUSTRALIAN SEA-LEVEL PRESSURE BOGUS DATA (PAOBS); ADDED PROCESSING
    494 C    OF MDCRS MOISTURE DATA BUT THEY ARE FLAGGED FOR ALL REPORTS;
    495 C    RADIOSONDE BALLOON DRIFT LAT/LON NOW CALCULATED ON EACH LEVEL AND
    496 C    ENCODED INTO PREPBUFR FILE WITH MNEMONICS "YDR" AND "XDR"; FOREIGN
    497 C    SATWND SWITCHES NOW CONTROL IR C-DRFT AND VIS. C-DRFT SEPARATELY
    498 C    (STILL SAME R.TYPES); ADDED PROCESSING OF FOREIGN WATER VAPOR
    499 C    SATWNDS WITH NEW R.TYPES 250 (GMS), 254 (EUMETSAT), AND 256
    500 C    (INSAT); REPLACED CALL TO SUBROUTINE "PREVENTS" WITH CALL TO W3LIB
    501 C    ROUTINE "GBLEVENTS"; REPLACED SORT ROUTINE "SHELL" (IN-LINE
    502 C    SUBROUTINE) WITH W3LIB ROUTINE "ORDERS", MORE EFFICIENT AND ALLOWS
    503 C    MULTIPLE ORDER SORT KEYS; ADDED CALL TO SUBROUTINE WORDLENGTH TO
    504 C    DETERMINE REAL AND INTEGER MACHINE WORDLENGTH SO PROPER SORT KEY
    505 C    WORD LENGTH IS ALWAYS PASSED INTO W3LIB ROUTINE ORDERS, CALL TO
    506 C    W3LIB ROUTINE "W3FI04" REMOVED; STOP COND. CODE "22" COULD NEVER
    507 C    HAPPEN AND WAS REMOVED; THE LOGIC THAT ALLOWS PROFILER DATA FROM
    508 C    EITHER 1-HR PREV OR 1-HR LATER TO BE USED IF ONLY A SINGLE TIME
    509 C    SELECTED AND NO DATA AT THAT TIME FOUND CONFINED TO ONLY OI RUNS
    510 C    (WAS FOR ALL TYPES); R.C. =4 NOW OCCURS IF EITHER NO ADPUPA OR
    511 C    ADPSFC REPORTS WERE PROCESSED INTO PREPBUFR FILE, BEFORE IT
    512 C    OCCURRED ONLY IF EITHER NO ADPUPA OR ADPSFC REPORTS WERE READ IN;
    513 C    SWITCH "PREVEN" MOVED FROM NAMELIST "LDTA" TO "GBLEVN" - IF

Page 10          Source Listing                  PREPOBS_PREPDATA
2017-04-18 11:09                                 prepdata.f

    514 C    NAMELIST GBLEVN NOT FOUND IN DATA CARDS, PREVEN DEFAULTS TO FALSE
    515 C    - THIS ALLOWS FOR CONTROL OF CALL TO W3LIB ROUTINE "GBLEVENTS" TO
    516 C    BE AT THE SCRIPT LEVEL
    517 C 2000-02-17  D. A. KEYSER -- CHANGES TO MAKE CODE MORE PORTABLE; CAT.
    518 C    4 U-AIR LEVELS NOW SET WIND Q.M. TO AT LEAST 2 ONLY IF WIND DOES
    519 C    NOT HAVE AN SDM KEEP FLAG (I.E., THE KEEP FLAG ON CAT. 4 WINDS IS
    520 C    HONORED); BUFR MNEMONIC TABLE REVISED TO REDUCE SIZE OF PREPBUFR
    521 C    FILE BY REMOVING THE ENCODING OF SOME MNEMONICS WHICH ARE ALWAYS
    522 C    MISSING; SWITCHES "FWINDO", "JSURFM" AND "JSURFW" ARE NOW ABLE TO
    523 C    ACT ON SURFACE LAND SYNOPTIC AND METAR DATA SEPARATELY; CAN NOW
    524 C    SKIP OVER INPUT BUFR MESSAGES IN DATA DUMP FILES IF THE BUFR TYPE/
    525 C    SUBTYPE IS SET TO BE EXCLUDED (BEFORE EXCLUSION OCCURRED ONLY
    526 C    AFTER REPORT WAS DECODED FROM DUMP FILE), THIS MAKES THIS PROGRAM
    527 C    MORE EFFICIENT IN THESE CASES (NOTE: APPLIES ONLY TO U-AIR AND
    528 C    SURFACE LAND DATA READ IN VIA FUNCTION IW3UNPBF); MNEMONIC "TFC"
    529 C    NOW ENCODED IN PREPBUFR FILE FOR VAD WIND REPORTS (NEEDED BY
    530 C    FUTURE VERSION OF CQCVAD PROGRAM); SUBR. W3RTVUNP RENAMED TO
    531 C    W3RTOVSUNP, W3CNVTOV RENAMED TO W3CNVXTOVS (HANDLES RTOVS AND NEW
    532 C    ATOVS), W3RTVEDS RENAMED TO W3XTOVSEDS (HANDLES RTOVS AND NEW
    533 C    ATOVS), AND W3TOVMND RENAMED TO W3XTOVSMND (HANDLES RTOVS AND
    534 C    ATOVS); CAN NOW PROCESS ATOVS DATA VIA NEW SUBR. W3ATOVSUNP (40-
    535 C    LVL/35 RADIANCES) AND SUBR. W3XTOVSEDS (NMCEDS FORMAT); N-LIST
    536 C    SWITCHES "TOVEDS" AND "TOVBFR" EXPANDED TO LENGTH 2 ARRAYS TO
    537 C    DIFFERENTIATE BETWEEN RTOVS (=1) AND NEW ATOVS (=2) SAT. RETR.;
    538 C    FOR SAT. RETR. OUTPUT IN NMCEDS FORMAT, CHAR. 7 OF STNID NOW
    539 C    INDICATES RTOVS (='R') OR ATOVS (='A') (WAS BLANK); SPEC.
    540 C    HUMIDITY AND VIRT. TEMPERATURE ARE NOW CALCULATED AS "VIRTMP"
    541 C    EVENTS IN W3LIB GBLEVENTS WHEN SPEC. HUMIDITY QUAL. MARKER IS BAD
    542 C    (SUBJECT TO A SANITY CHECK), HOWEVER THE VIRT. TEMPERATURE GETS A
    543 C    BAD QUAL. MARKER (8); ADDED ENCODING OF NESDIS RECURSIVE FILTER
    544 C    FLAG FOR SATWND (GOES) TYPES; MOVED GOES SATWND Q.M. ASSIGNMENT
    545 C    BASED ON RFFL FROM SUBROUTINE IW3UNPBF TO INLINE SUBROUTINE
    546 C    GETC06; EXPANDED BALLOON DRIFT PROCESSING TO INCL. PIBALS; UPDATED
    547 C    DEL-TIME ON UPPER-AIR RAOB AND PIBAL LVLS (ALREADY CALC. BASED ON
    548 C    BALLOON DRIFT) AND ENCODED INTO PREPBUFR FILE W/ MNEMONIC "HRDR";
    549 C    LAUNCH TIME NOW READ FROM CAT. 8 CODE FIG. 104 IN ORDER TO ASSIGN
    550 C    A CBASE TIME TO FIRST DATA LEVEL; LAUNCH TIME USED TO "CORRECT"
    551 C    OBS. TIME FOR ADPUPA RPTS IN "DHR"; ADDED MNEMONICS "RPT" (ORIG.
    552 C    OBS. TIME) AND "TCOR" (IND. FOR CORRECTED OBS. TIME IN"DHR")
    553 C    ENCODED INTO PREPBUFR FILE; IMPR. CHECKING IN RAOB/PIBAL BALLOON
    554 C    DRIFT LAT/LON/TIME CALC.; NOW CALLS SUBR. FILWND FOR RAOBS AND
    555 C    PIBALS EVEN WHEN FILLW=F TO GET INTERP. WIND LEVELS FOR BALLOON
    556 C    DRIFT LAT/LON CALC. (DISCARDS THEM PRIOR TO WRITE TO PREPBUFR FILE
    557 C    WHEN FILLW=F); IF FILTER FLAG=-99 AND TR80KM=F, PROCESS ONLY EVERY
    558 C    4'TH UNPACKED RTOVS RETRIEVAL TO SIMULATE 250 KM SUB-SAMPLING
    559 C    (RTOVS DUMP FILE PRIOR TO 7/1/1998 - NO FILTER FLAG INFORMATION
    560 C    AVAILABLE - NEEDED FOR HISTORICAL CDAS RUNS)
    561 C 2000-09-22  D. A. KEYSER -- ADDED THE PROCESSING OF QUIKSCAT SCATTER-
    562 C     OMETER WINDS (ALONG WITH NEW N-LIST SWITCHES "JPQKSD", "IQWNDO",
    563 C     "IQKSLM" & "IQKSSP"), A TEMPORARY INSERTION IS THE THINNING OF
    564 C     THE DATA BY PROCESSING ONLY EVERY-OTHER UNPACKED REPORT; SUBR.
    565 C     GETERS CHANGED TO GETSCATT SINCE IT PROCESSES BOTH ERS AND
    566 C     QUIKSCAT SCATTEROMETER REPORTS; ADDED ABILITY TO APPEND DATA TO
    567 C     AN EXISTING PREPBUFR FILE VIA NEW N-LIST SWITCH "APPEND" (WHEN
    568 C     APPENDING, THE INTERNAL BUFR MNEM. TBL. IN THE EXISTING PREPBUFR
    569 C     FILE IS USED, R.C.=4 NOT VALID FOR APPEND=T, NEW R.C.=30 VALID
    570 C     ONLY WHEN APPEND=T AND EXISTING FILE DATE DOES NOT MATCH EXPECTED

Page 11          Source Listing                  PREPOBS_PREPDATA
2017-04-18 11:09                                 prepdata.f

    571 C     (PRODUCTION) DATE; ADDED PROCESSING OF AUTOMATED TIDE GAUGE STN
    572 C     DATA (SFC MARINE TYPE, ON29 R.T. 533), N-LIST SWITCHES "FWINDO",
    573 C     "JSURFM" AND "JSURFW" EXPANDED FROM 8 TO 9 WORDS; REMOVED
    574 C     OBSOLETE LOGIC DEALING WITH OLD OI PROCESSING; CHANGED DEFAULT
    575 C     FOR N-LIST SWITCHES "FILLZ", "FILLT", "FILLW" AND "FILLM" FROM
    576 C     "TRUE" TO "FALSE", AND FOR "IRNMRK" FROM "2" TO "-99"
    577 C 2000-12-05  D. A. KEYSER -- CHANGED ON29 REPORT TYPE (T29) FOR SFC
    578 C     MARINE AUTOMATED TIDE GAUGE REPORTS FROM 533 TO 532 SO THEY AGREE
    579 C     WITH REPORT TYPE IN QUIPS PROCESSING; N-LIST SWITCH "MSGPSF"
    580 C     REPL. BY SWITCH "PFRALT" WHICH PROCESSES METARS W/ MISSING
    581 C     PRESSURE BY CALC. PSTN FROM ALTIMETER, THESE GET NEW R.T.
    582 C     187/287; RECOGNIZES SATWIND REPORTS WITH NEW 8-CHAR. STNID
    583 C     FORMAT; RECOGNIZES GOES SNDG/RAD REPORTS WITH NEW 8-CHAR. STNID
    584 C     FORMAT; RECOGNIZES ERS AND QUIKSCAT REPORTS WITH NEW 8-CHAR.
    585 C     STNID FORMAT; ALL CAT. 6 TYPES NOW STORE SPEC. HUMIDITY AS
    586 C     MOISTURE VARIABLE RATHER THAN DEWPOINT DEPR.; NEW N-LIST SWITCH
    587 C     "FLACMS", WHEN TRUE (DEF.) FLAGS ALL MDCRS MOISTURE DATA (WAS
    588 C     HARDWIRED AS FLAGGED); METARS W/ MISSING WDIR & WSPD .LE. 3M/S
    589 C     ENCODE WSPD OBS/QM IN NEW MNEM. "SOB" AND "SQM"; FOR IRNMRK=4
    590 C     (RUC) ALL BUOYS W/ MISSING PRESSURE BUT VALID WIND ARE PROC.
    591 C     W/ R.T. 282 (PRESS. SET TO 1013.3MB, JUST LIKE ATLAS BUOYS);
    592 C     WIND PROFILERS WHICH COME IN DISGUISED AS PIBALS ARE CHANGED TO
    593 C     R.T. 223 SO THEY WILL BE PROCESSED AS WIND PROFILERS (DETERMINED
    594 C     BY STNID)
    595 C 2001-04-06  D. A. KEYSER -- NAMELIST SWITCH IQKSLM NOW 2-WORD ARRAY
    596 C     (WORD 2 - QUIKSCAT P.O.R. THESHOLD FOR SUSPECT Q.M.); PRINTS
    597 C     DIAG. IF TDEW < TDLIM FOR NON-ADPUPA DATA TYPES); CAN HANDLE
    598 C     WIND PROFILERS ORIG. FROM PILOT (PIBAL) BULL. IN "PROFLR" DUMP
    599 C     FILE; ADDED UK PROFILER ID 03501 TO LIST OF PROFILERS WHICH MAY
    600 C     COME IN DISGUISED AS PIBALS PRIOR TO DECODER CHANGE (GETS R.TYPE
    601 C     223); SUBR. "PWATER" RENAMED TO "GETPWATER", NOW RETURNS IERF=1
    602 C     IF REPORT NOT ENCODED INTO PREPBUFR FILE (INSTEAD OF MST=0); NOW
    603 C     PROCESSES SSM/I RAIN RATE UNDER R.TYP 150; SUBR. "GETSMI"
    604 C     STREAMLINED; ACCOUNTS FOR SUBR. W3UNPKB7 OUTPUTTING GOES RAD.
    605 C     AS K (PRECISE TO 10**2) RATHER THAN K*100; ACCOUNTS FOR SUBR.
    606 C     W3UNPKB7 OUTPUTTING GOES PWATER AS AS MM (PRECISE TO 10**2)
    607 C     RATHER THAN MM*100; ACCOUNTS FOR SUBR. W3UNPKB7 OUTPUTTING GOES
    608 C     SKIN TEMP AS K (PRECISE TO 10**2) RATHER THAN K*100; ACCOUNTS
    609 C     FOR SUBR. W3UNPKB7 OUTPUTTING GOES SOLAR AND SAT. ZENITH ANGLE
    610 C     AS DEGREES (PRECISE TO 10**2) RATHER THAN DEG*100; ACCOUNTS
    611 C     FOR SUBR. IW3UNPBF OUTPUTTING SSM/I WIND SPEED IN M/SEC (PRECISE
    612 C     TO 10**1) RATHER THAN M/SEC*10; ACCOUNTS FOR SUBR. IW3UNPBF
    613 C     OUTPUTTING SSM/I TPW IN MM (PRECISE TO 10**1) RATHER THAN MM*10;
    614 C     ACCOUNTS FOR SUBR. IW3UNPBF OUTPUTTING SSM/I BRIGHTNESS TEMPS IN
    615 C     K (PRECISE TO 10**2) RATHER THAN K*100; FOR ALL SATELLITE TYPES
    616 C     EXCEPT SSM/I SUPEROBED PRODUCTS, NOW READS SATELLITE ID FROM
    617 C     WORD 6 OF HEADER RETURNED FROM BOTH SUBR. IW3UNPBF AND W3UNPB7
    618 C     AND ENCODES AS "SAID" IN PREPBUFR FILE; N-LIST SWITCH SWINDO
    619 C     SPLIT INTO SWINDO_e (EARLIEST TIME WINDOW) AND SWINDO_l (LATEST
    620 C     TIME WINDOW) FOR SATWND REPORTS ("-" PRIOR TO CYCLE TIME, "+"
    621 C     AFTER CYCLE TIME) (SAME DEFAULTS AS BEFORE); SUBR. "RPTLBL" NOW
    622 C     HAS INPUT ARGS. "TIMWIN_e" (EARLIEST TIME WINDOW) AND "TIMWIN_l"
    623 C     (LATEST TIME WINDOW) REPL. "TIMWIN" (+/- TIME WINDOW) ("-" PRIOR
    624 C     TO CYCLE TIME, "+" AFTER CYCLE TIME), ALLOWS THE 2 TO BE
    625 C     DIFFERENT; WIND PROFILERS COMING IN DISGUISED AS PIBALS
    626 C     (DETERMINED BY STNID) IN THE "ADPUPA" FILE ARE NO LONGER SUBJECT
    627 C     TO POSSIBLE REPORT TIME ALTERATION AND LAUNCH TIME CALC. (THIS

Page 12          Source Listing                  PREPOBS_PREPDATA
2017-04-18 11:09                                 prepdata.f

    628 C     WAS AN OVERSIGHT IN LAST IMPL. WHICH GAVE THEM R.T.223 - THE
    629 C     POINT WILL SOON BE MUTE IN PRODUCTION SINCE THESE WILL BE IN
    630 C     "PROFLR" FILE, BUT STILL NEEDED FOR HISTORICAL RERUNS); READS IN
    631 C     THE 4 MDCRS TURBULENCE INDECES AND ENCODES THEM INTO THE PREPBUFR
    632 C     FILE UNDER MNEMONICS "TRBX10", "TRBX21", "TRBX32" AND "TRBX43";
    633 C     READS IN GOES SFC PRESSURE (FROM CAT. 8, CF 262) AND ENCODES IT
    634 C     INTO PREPBUFR FILE UNDER MNEMONIC "PRSS" FOR GOES PW RETR.
    635 C     REPORTS
    636 C 2001-06-19  D. A. KEYSER -- CAN NOW PROCESS GOES 1x1 FOV CLOUD TOP
    637 C     REPORTS INTO PREPBUFR FILE UNDER R.T. 151 (MNEMONICS ARE "CDTP"/
    638 C     CLOUD TOP PRESSURE, "TOCC"/CLOUD COVER, "GCDTT"/CLOUD TOP TEMP.);
    639 C     NEW SUBR. "TIMCHK" DOES TIME WINDOW CHECK SEPARATE FROM "RPTLBL";
    640 C     SUBR. "GOESDG" STREAMLINED, WITH NEW SUBR. "GOESCHK" NOW
    641 C     PERFORMING CHECKS ON SEPARATE RPT TYPES BEING PROCESSED; N-LIST
    642 C     SWITCHES "GOESND", "GOESPW", "GOESRD" AND NEW "GOESCT" NOW LENGTH
    643 C     2 TO PROCESS THE 4 GOESND TYPES FORM EITHER 5X5 OR 1X1 FOV;
    644 C     N-LIST SWITCHES "IWINDO", "SATMST", "ISATLS", "IRTRV" AND "KTOP"
    645 C     NOW MORE SPECIFIC TO POINT TO PAIRS OF EVEN OR ODD GOES SATS. AND
    646 C     TO THE 4 POSSIBLE REPORT TYPES THAT CAN BE GENERATED FROM RTOVS/
    647 C     ATOVS AND GOES SNDG/RAD/RETR. DATA (OLD SWITCHES "JSATLS" AND
    648 C     "FLGOES" NO LONGER NEEDED AND REMOVED); SUBR. "SNDTBL"
    649 C     STREAMLINED TO PRESENT IMPROVED TABLES, INPUT ARG. "IDSAT" OF
    650 C     LENGTH 4 REPL. OLD ARG. "IEVSAT" AND "IODSAT"; SET GOES PW REPORT
    651 C     REASON CODES TO 100 (WERE MISSING); SET SSM/I PW REPORT REASON
    652 C     CODE TO 100 (WAS MISSING); SET SSM/I RAINFALL RATE REASON CODE TO
    653 C     100 (WAS MISSING)
    654 C 2001-08-01  D. A. KEYSER -- N-LIST SWITCH IRNMRK CAN NOW HAVE A
    655 C     VALUE OF 7 TO DESIGNATE CDAS-REANLYSIS/SSI RUNS (BEFORE THESE
    656 C     RECEIVED IRNMRK=5, RESERVED FOR FNL-GDAS/SSI RUNS); WELCOME PRINT
    657 C     NOW IDENTIFIES PARTICULAR RUN; N-LIST SWITCH IWINDO SPLIT INTO
    658 C     IWINDO_e (EARLIEST TIME WINDOW) AND IWINDO_l (LATEST TIME WINDOW)
    659 C     FOR SATELLITE SOUNDING/RETRIEVAL/RADIANCE REPORTS ("-" PRIOR TO
    660 C     CYCLE TIME, "+" AFTER CYCLE TIME) (SAME DEFAULTS AS BEFORE); IN
    661 C     RESPONSE TO CHANGE TO SUBR. W3ATOVSUNP, NOW PASSES IER=0 INTO
    662 C     SUBR. UPON FIRST CALL FOR ATOVS DATA (SIGNALS INPUT BUFR FILE
    663 C     IS A DATA DUMP)
    664 C 2001-09-14  D. A. KEYSER -- CORRECTED AN ERROR IN CALCULATING
    665 C     RADIOSONDE BALLOON DRIFT D-TIME ("HRDR") FOR WIND REPORT
    666 C     PRESSURE LEVELS THAT ARE ALSO FOUND IN THE CORRESPONDING MASS
    667 C     REPORT ("HRDR" IS CALCULATED CORRECTLY FOR THE MASS REPORT
    668 C     LEVELS); REPORT SEQ. NUMBER STORED IN HDR(11) FOR SURFACE LAND
    669 C     AND SURFACE MARINE REPORTS LATER ENCODED IN PREPBUFR FILE UNDER
    670 C     MESSAGE TYPES "ADPSFC" AND "SFCSHP", FOR SATELLITE-DERIVED WIND
    671 C     REPORTS LATER ENCODED UNDER MESSAGE TYPE "SATWND", AND FOR
    672 C     RECCOS LATER ENCODED UNDER MESSAGE TYPE "ADPUPA" (RECCO SEQ.
    673 C     NUMBER WILL BEGIN WHERE RAOBS/PIBALS/DROPS LEFT OFF IN "ADPUPA")
    674 C 2001-10-10  D. A. KEYSER -- NEW N-LIST "TASK" READ IN WITH SWITCH
    675 C     "MP_PROCESS" WHICH IDENTIFIES PROCESS NUMBER FROM THE MPI RUN,
    676 C     ENCODED IN PREPBUFR UNDER MNEMONIC "PROCN"; N-LIST SWITCHES
    677 C     "IQKSLM" AND "IQKSSP" NO LONGER READ AND REMOVED AS QUIKSCAT
    678 C     Q.C. WRT PROB. OF RAIN AND SWATH EDGE NOW PERFORMED IN UPSTREAM
    679 C     PGM "WAVE_DCODQUIKSCAT";  RECOGNIZES QUIKSCAT SUPEROBS (NOW
    680 C     GENERATED IN "WAVE_DCODQUIKSCAT") WITH "S" IN CHAR. 2 OF REPORT
    681 C     ID; NO LONGER THINS QUIKSCAT DATA BY PROCESSING ONLY EVERY OTHER
    682 C     REPORT ("WAVE_DCODQUIKSCAT" NOW HAS OPTION TO SUPEROB); MODIFIED
    683 C     TO NOW PASS TWO SPANNING GLOBAL SIGMA GUESS FILES INTO W3LIB
    684 C     ROUTINE GBLEVENTS IN SITUATIONS WHERE THE CENTER DATE FOR THE

Page 13          Source Listing                  PREPOBS_PREPDATA
2017-04-18 11:09                                 prepdata.f

    685 C     PREPBUFR FILE HAS AN HOUR THAT IS NOT A MULTIPLE OF 3 (SEE
    686 C     2001-10-10 CHANGES TO GBLEVENTS); ENCODES SATELLITE ID ("SAID")
    687 C     FOR RTOVS/ATOVS RETRIEVALS (FROM BOTH 40-LEVEL BUFR OR NMCEDS
    688 C     FMT) (WAS MISSING)
    689 C 2002-01-14  D. A. KEYSER -- ADDED N-LIST SWITCH "IACFTH" WHICH ALLOWS
    690 C     AIRCRAFT DATA TO BE FLAGGED IF ABOVE A LIMITING ALTITUDE (DEFAULT
    691 C     IS 18000 M FOR AIREP/PIREP AND AMDAR AND 16500 FOR MDCRS); LEVELS
    692 C     WITH REPORTED/CALC. DWPT < "TDLIM" VALUE NOW CALC./RETAIN SPEC.
    693 C     HUM AND RETAIN/CALC. DWPT IN PREPBUFR FILE, BUT MOISTURE PREPDA
    694 C     TABLE VALUE IS FLAGGED WITH Q.M.=15 (BEFORE, SPEC. HUM. AND DWPT
    695 C     SET TO MISSING) VIRT. TEMP. CALC. IN THIS CASE (BEFORE, SET TO
    696 C     SENSIBLE TEMP.)
    697 C 2002-01-28  D. A. KEYSER -- READS PRECISION OF TEMP. OBS. OUT OF
    698 C     "AIRCAR" AND "AIRCFT" DUMP FILES (CAT. 8, CODE FIG. 915) AND
    699 C     ENCODES THIS INTO PREPBUFR FILE UNDER MNEMONIC "PCAT" (ONLY
    700 C     AVAIL. FOR AMDAR AND MDCRS); CORRECTED ERROR INTRODUCED ~1/9/2001
    701 C     WHICH RESULTED IN NO MASS REPORTS BEING ENCODED INTO THE RUC
    702 C     VERSION OF THE PREPBUFR FILE FOR MOORED AND DRIFTING BUOYS
    703 C     (AFFECTED ONLY THE RUC AND ONLY THESE DATA TYPES); NOW RECOGNIZES
    704 C     THAT W3UNPKB7 CAN RETURN A VAD WIND Q.M. OF 12 (MEANING ON REJECT
    705 C     LIST) OR 14 (MEANING SDM PURGED) ALONG WITH EXISTING Q.M.
    706 C     GENERATED FROM RMS VECTOR ERROR; NOW RECOGNIZES THAT W3UNPKB7 CAN
    707 C     RETURN A WIND PROFILER "QUALITY CODE" OF 14 (MEANING EITHER ON
    708 C     WIND REJECT LIST OR SDM PURGED) ALONG WITH EXISTING Q. CODES FROM
    709 C     FSL/HUB
    710 C 2003-07-10  D. A. KEYSER -- NOW RETURNS NEW ARRAY "OBS2" OUT OF
    711 C     CALL TO IWUNPBF, CURRENTLY JUST 2-WORDS WHERE WORD 1 IS
    712 C     "RESTRICTIONS ON REDISTRIBUTION" (BUFR F.T. 0-35-200) AND WORD
    713 C     2 IS "EXPIRATION OF RESTRICTIONS ON REDISTRIBUTION" (HRS),
    714 C     THESE ARE ENCODED INTO PREPBUFR FILE UNDER NEW MNEMONICS
    715 C     "RSRD" AND "EXPRSRD", RESP.
    716 C 2003-08-22  D. A. KEYSER -- CORRECTED BUG WHICH STARTED CALCULATING
    717 C     RADIOSONDE/PIBAL BALLOON DRIFT TIME FROM FIRST REPORTING HEIGHT
    718 C     LEVEL RATHER THAN SURFACE LEVEL (STARTED AT 1000 MB MAND. LEVEL
    719 C     BELOW GROUND), DRIFT LAT/LON VALUES WERE OKAY
    720 C 2004-01-09  D. A. KEYSER -- ADDED NEW NAMELIST SWITCH SUBSKP
    721 C     DIMENSIONED (0:12,0:200) DEFINED AS EXISTING VARIABLE SUBSKP
    722 C     {IDENTIFIES THOSE BUFR TYPES/SUBTYPES FOR WHICH THE BUFR
    723 C     MESSAGES SHOULD BE SKIPPED OVER (WITHOUT DECODING REPORTS) IF
    724 C     TRUE} (DEFAULT=.FALSE.), THIS IS PASSED INTO IW3UNPBF AS BEFORE,
    725 C     BUT SECOND DIMENSION CHANGED FROM 1:200 TO 0:200 TO ACCOUNT FOR
    726 C     REPORTS WITH BUFR SUBTYPE 000 (CURRENTLY ONLY WMO RES. 40
    727 C     SYNOPS)
    728 C 2004-09-09  D. A. KEYSER -- ADDED PROCESSING OF GPS-IPW DATA, READ
    729 C     FROM "GPSIPW" DUMP FILE DUMP R. TYPE 74, GET PREPBUFR R. TYPE
    730 C     153, PROCESSED BY NEW SUBR. "GETGPSIPW" INTO PREPBUFR FILE UNDER
    731 C     NEW TBL A ENTRY "GPSIPW" {NEW NAMELIST SWITCH JPGPSD (PROCESS/
    732 C     DON'T PROCESS)}; ADDED PROCESSING OF NPN OR CAP RASS DATA READ
    733 C     FROM "RASSDA" DUMP FILE IN NEW DATA LVL CAT. 15, DUMP R. TYPE 77,
    734 C     GET PREPBUFR R. TYPE 126, PROCESSED INTO PREPBUFR FILE UNDER NEW
    735 C     TBL A ENTRY "RASSDA" {NEW NAMELIST SWITCHES TWINDO (TIME WINDOW
    736 C     ABOUT CYCLE TIME FOR ACCEPTING)} & RASS (PROCESS/DON'T PROCESS);
    737 C     ADDED PROCESSING OF EAMDAR ACFT RPTS NOW POSSIBLY INCL. IN
    738 C     "AIRCFT" DUMP FILE DUMP R. TYPE 41, SUBTYPE 6, INCL. WITH
    739 C     EXISTING PREPBUFR R. TYPES 131/231, PROCESSED INTO PREPBUFR FILE
    740 C     UNDER EXISTING TBL A ENTRY "AIRCFT"; ADDED PROCESSING OF CAP AND
    741 C     JAPANESE WIND PROFILERS NOW POSSIBLY INCL. IN "PROFLR" DUMP FILE

Page 14          Source Listing                  PREPOBS_PREPDATA
2017-04-18 11:09                                 prepdata.f

    742 C     DUMP R. TYPES 75 AND 76, RESP., GETS PREPBUFR R. TYPES 227 AND
    743 C     228, RESP., PROCESSED INTO PREPBUFR FILE UNDER EXISTING TBL A
    744 C     ENTRY "PROFLR", WIND PROFILER RPTS ORIGINATING FROM PILOT (PIBAL)
    745 C     BULLETINS NOW GET A UNIQUE PREPBUFR R. TYPE OF 229 {NAMELIST
    746 C     SWITCHES PROFIL (PROCESS/DON'T PROCESS) CHANGED TO PRFLER AND
    747 C     NWINDO (EARLIEST/LATEST TIME RELATIVE TO CYCLE TIME FOR
    748 C     ACCEPTING) REPL. WITH PWINDO (TIME WINDOW ABOUT CYCLE TIME FOR
    749 C     ACCEPTING)}; FOR VAD WINDS NAMELIST SWITCH VADWND CHANGED TO
    750 C     VADWIN (PROCESS/DON'T PROCESS) AND NAMELIST SWITCH MWINDO
    751 C     (EARLIEST/LATEST TIME RELATIVE TO CYCLE TIME FOR ACCEPTING) REPL.
    752 C     WITH VWINDO (TIME WINDOW ABOUT CYCLE TIME FOR ACCEPTING); ADDED
    753 C     PROCESSING OF MESONET DATA, READ FROM "MSONET" DUMP FILE DUMP R.
    754 C     TYPE 540, GET PREPBUFR R. TYPE 188/288, PROCESSED INTO PREPBUFR
    755 C     FILE UNDER NEW TBL A ENTRY "MSONET" {INCL, ENCODING OF ID STRINGS
    756 C     FOR PROVIDER (MNEMONIC "PRVSTG") AND SUB-PROVIDER (MNEMONIC
    757 C     "SPRVSTG")}, THESE CAN HAVE AN ELEVATION Q.M. - IF IT'S POOR SET
    758 C     PSTN AND PMSL (IF PRESENT) Q.M. TO 15 (BAD), IF IT'S FAIR SET
    759 C     PSTN AND PMSL (IF PRESENT) Q.M. TO 3 (SUSPECT); EXPANDED NAMELIST
    760 C     SWITCHES FWINDO, JSURFM AND JSURFW FROM 9-WORDS TO 11-WORDS TO
    761 C     ADD MESONET IN WORD 9 AND MOBILE SYNOPTIC LAND IN WORD 10; IF
    762 C     MESONET REPORT HAS A MISSING PSTN (PMSL ALWAYS MISSING) BUT A
    763 C     VALID ALTIMETER SETTING, GENERATE PSTN FROM OBSERVED ALTIMETER
    764 C     AND ELEV. (CHAR. 8 OF STNID IS SET TO 'a' TO IDENTIFY THESE); IF
    765 C     MESONET REPORT HAS A MISSING PSTN (PMSL ALWAYS MISSING) AND A
    766 C     MISSING ALTIMETER SETTING, GENERATE PSTN FROM STD. ATMOS. PMSL,
    767 C     OBSERVED TEMP. AND ELEV. (CHAR. 8 OF STNID IS SET TO 'x' TO
    768 C     IDENTIFY THESE); ADDED PROCESSING OF MOBILE SFC SYNOPTIC LAND
    769 C     RPTS NOW POSSIBLY INCL. IN "ADPSFC" DUMP FILE DUMP R. TYPE 514,
    770 C     INCL. WITH EXISTING PREPBUFR R. TYPES 181/183/281/284, PROCESSED
    771 C     INTO PREPBUFR FILE UNDER EXISTING TBL A ENTRY "ADPSFC";
    772 C     INITIALIZES INSTRUMENT TYPE AS MISSING INSTEAD OF "99"; NOW
    773 C     PRINTS "*" (FORMAT OVERFLOW) FOR MISSING QUALITY MARKS (BEFORE
    774 C     SET THEM TO "15"); CORRECTED BUG IN QUIKSCAT PROCESSING WHICH
    775 C     WOULD HAVE STORED ALONG-TRACK ROW NUMBER INTO INSTRUMENT TYPE
    776 C     LOCATION (NOW STORES MISSING); NOW ENCODES MDCRS FLIGHT NUMBER
    777 C     (MNEMONIC "ACID") INTO MDCRS REPORTS; REPLACED CALL TO BUFRLIB
    778 C     ROUTINE "BORT" WITH CALL TO W3LIB ROUTINE ERREXIT, WITH CONDITION
    779 C     CODE 59 IF THERE ARE MORE THAN "MXBLVL" LEVELS IN A REPORT AT THE
    780 C     TIME IT IS ABOUT TO BE ENCODED INTO THE PREPBUFR FILE; ARRAY
    781 C     SUBSKP BUMPED UP FROM (0:12,0:200) TO (0:255,0:200); ADDED NEW
    782 C     IRNMRK VALUE 8 FOR HOURLY (GOES CLOUD DATA) RUNS; RAIN RATE
    783 C     (SSM/I) IS NOW ENCODED WITH STANDARD MNEMONIC REQV INSTEAD OF
    784 C     LOCAL MNEMONIC REQ6 (STILL HIGH PRECISION, BUFRTABLE HAS OPERATOR
    785 C     DESCRIPTORS); ADDED LOGIC IN SUBR. W3FIZZ (CURRENTLY NOT INVOKED)
    786 C     TO SEPARATE METAR REPORTS INTO THEIR OWN MESSAGES IN THE ADPSFC
    787 C     MESSAGE TYPE, BUT WITH A UNIQUE MESSAGE SUB-TYPE OF 7 (SEE
    788 C     COMMENTS IN SUBROUTINE); ADDED PROCESSING OF NASA/MODIS POES AQUA/
    789 C     TERRA SATELLITE-DERIVED WINDS, NOW POSSIBLY INCL. IN "SATWND" DUMP
    790 C     FILE EXISTING DUMP R. TYPE 63, GET PREPBUFR R. TYPES 257 (IR), 258
    791 C     (W.VAPOR IMGR CLOUD-TOP) AND 259 (W.WAPOR IMGR DEEP LAYER),
    792 C     PROCESSED INTO PREPBUFR FILE UNDER EXISTING TBL A ENTRY "SATWND";
    793 C     NOW RETURNS 41-WORD (RATHER THAN 2-WORD) ARRAY "OBS2" OUT OF CALL
    794 C     TO IW3UNPBF, WHERE WORDS 3-41 CONTAIN ALTIMETER SETTING (WHICH HAD
    795 C     BEEN RETURNED IN CAT. 8, C.F. 20, NOW ONLY ALTIMETER TBL. VAL.
    796 C     RETURNED FROM HERE), SEA-SURFACE TEMPERATURE, SINGLE-LEVEL
    797 C     SENSIBLE WEATHER ELEMENTS AND SST TABLE VALUE (Q.M.); RETURNS NEW
    798 C     ARRAY ARGUMENTS "OBS3" {(5,MXBLVL,5)} AND "NOBS3" {(5)} OUT OF

Page 15          Source Listing                  PREPOBS_PREPDATA
2017-04-18 11:09                                 prepdata.f

    799 C     CALL TO IW3UNPBF WHERE OBS3 CONTAINS MULTIPLE-LEVEL SENSIBLE
    800 C     WEATHER ELEMENTS AND NOBS3 DEFINES THE NUMBER OF LEVELS OF DATA IN
    801 C     THE OBS3(X,Y,1) TO OBS3(X,Y,5) ARRAYS (SEE IW3UNPBF DOCBLOCK FOR
    802 C     MORE INFO); ALL NEW PARAMETERS (I.E., SST AND SENSIBLE WEATHER
    803 C     ELEMENTS) IN OBS2 AND OBS3 ARE ENCODED INTO PREPBUFR FILE, BUT
    804 C     ONLY IN THE MASS "PIECE" OF A REPORT (UNLESS THERE IS NO MASS
    805 C     PIECE, THEN THEY ARE ENCODED INTO WIND PIECE; WILL NOW CALC. Q AND
    806 C     Tv IN STOROB IF PQM IS 15 (BUTS SETS QQM TO 15) (E.G., FOR DROPs
    807 C     WITH PRESS FAILING D-VAL, BEFORE Q MISSING BUT LATER CALC. IN
    808 C     VIRTMP STEP)
    809 C 2005-07-01  D. A. KEYSER -- NOW STORES A VALUE 2 INTO REPORT SUBTYPE
    810 C     FOR DROPWINSONDE REPORTS AND A VALUE OF 1 INTO REPORT SUBTYPE FOR
    811 C     RECCO REPORTS, THIS GETS ENCODED INTO PREPBUFR UNDER MNEMONIC
    812 C     "TSB" AND ALLOWS DROPS AND RECCOS TO BE DIFFERENTIATED IN
    813 C     PREPBUFR SINCE BOTH HAVE SAME PREPBUFR REPORT TYPE (132/232) AND
    814 C     INPUT/DUMP REPORT TYPE (031)
    815 C 2006-07-14  D. A. KEYSER -- NO LONGER FAILS IF LIMIT OF "MXBLVL"
    816 C     OUTPUT LEVELS IN PREPBUFR REPORT IS HIT, NOW PROCESSES BOTTOM
    817 C     "MXBLVL" LEVELS AND SENDS DIAGNOSTIC TO JOBLOG; BUMP UP ARRAY
    818 C     SIZE FOR UNPACKED REPORT FROM IW3UNPBF FROM 2500 TO 3000; ADDED
    819 C     IRNMRK=9 FOR REAL TIME MESOSCALE ANALYSIS (RTMA) NETWORK
    820 C 2006-08-17  D. A. KEYSER -- MODIFIED THE FUNCTION WHICH CALC. PSTN
    821 C     FROM ALTIMETER SETTING BASED ON REQUEST BY JOHN DERBER; EXPANDED
    822 C     DEGREE OF DIAG. PRINT IN BALLOON DRIFT CALC. IF IPRT(2)=1; MOVED
    823 C     BALLOON DRIFT PROCESSING OUT OF SUBR. STOROB (TWO PLACES - IN
    824 C     MASS AND WIND PROC.) INTO NEW SUBR. BALLOON_DRIFT; CORRECTED
    825 C     LOGIC ERRORS IN BALLOON DRIFT PROCESSING WHICH HAD RESULTED IN
    826 C     OCASSIONAL ARRAY OVERFLOWS AND LEVEL INDEXING MIS-MATCHES (AMONG
    827 C     OTHER THINGS RESULTED IN SUDDEN JUMP IN THE DRIFT TIME BETWEEN
    828 C     ADJACENT LEVELS > 3 HOURS!), WILL NOW CONTINUE TO CALC. DRIFT
    829 C     TIME AND LAT/LON IF A SMALL (< 5 SEC) NEGATIVE TIME DIFF. IS
    830 C     FOUND BETWEEN ADJACENT LEVELS (USED TO REVERT TO LAST "GOOD"
    831 C     LEVEL ALL THE WAY UP THE PROFILE); NOW PRINTS WARNING AND SENDS
    832 C     DIAGNOSTIC TO JOBLOG IF SUBR. STOROB FINDS NUMBER OF PROCESSED
    833 C     MASS AND WIND LEVELS SENT TO SUBR. FILLX ARE NOT THE SAME (SHOULD
    834 C     ALWAYS BE THE SAME!); WIND QM SET TO 15 IN SUBR. STOROB IF A
    835 C     REPORTED WIND IS FOUND ON A LEVEL WHICH IS BELOW GROUND
    836 C 2006-11-29  D. A. KEYSER -- MODIFIED EUMETSAT PROCESSING TO CONSIDER
    837 C     "ODD" AND "EVEN" SATELLITES SEPARATELY FOR PROCESS/NO-PROCESS/
    838 C     FLAG ALL/FLAG EVERY-OTHER (N-LIST SWITCHES "JSMASS"/"JSWIND"),
    839 C     TIME WINDOW ("SWINDO_e"/"SWINDO_l"), LAND/NO-LAND ("SWNLND"), ALL
    840 C     BY LAT BAND AND PRODUCT TYPE
    841 C 2007-09-14  D. A. KEYSER -- MODIFIED TO RECOGNIZE HIGH-DENSITY JMA
    842 C     SATELLITE WINDS DERIVED FROM BUFR BULLETINS IN NC005044-NC005046
    843 C     WHICH MAY NOW BE IN INPUT "satwnd" DUMP FILE IN PLACE OF LOW-
    844 C     DENSITY JMA WINDS DERIVED FROM SATOB BULLETINS IN NC005041-
    845 C     NC005043 (EITHER BUFR OR SATOB WILL BE PROCESSED); ACCOUNTS FOR
    846 C     HIGH-DENSITY JMA SATELLITE WINDS DERIVED FROM BUFR BULLETINS IN
    847 C     NC005044-NC005046 CONTAINING RFF QUALITY INDICATOR, THE Q.C.
    848 C     TESTS FOR RFF ARE LIMITED ONLY TO THE NESDIS GOES AND NASA/POES
    849 C     SATWINDS AT THIS TIME; MODIFIED TO PROCESS TAMDAR AND CANADIAN
    850 C     AMDAR AIRCRAFT REPORTS (FORMER GET PREPBUFR REPORT TYPE 134/234
    851 C     AND ENCODES NEW PARAMETERS "TRBX" AND "ROLF" INTO PREPBUFR FILE;
    852 C     LATTER GET PREPBUFR REPORT TYPE 135/235); IF AIFNOW=FALSE, NOW
    853 C     FLAGS ALL ACFT REPORTS AS BAD IF WIND IS MISSING BUT TEMP IS
    854 C     PRESENT (USED TO FLAG ONLY MDCRS HERE AND TOSS ALL OTHER TYPES DUE
    855 C     TO CONCERN ABOUT PREPACQC), POINT IS MOOT BECAUSE AIFNOW NOW SET

Page 16          Source Listing                  PREPOBS_PREPDATA
2017-04-18 11:09                                 prepdata.f

    856 C     TO TRUE TO PROCESS ALL ACFT TYPE TEMP REPORTS WHEN WIND DATA ARE
    857 C     MISSING; NOW FLAGS ALL ACFT REPORTS BELOW "FLOOR" LEVEL (USED TO
    858 C     FLAG ONLY MDCRS MDCRS HERE AND TOSS ALL OTHER TYPES DUE TO CONCERN
    859 C     ABOUT PREPACQC); REPLACED CALL TO BUFRLIB ROUTINE OVRBS1 WITH CALL
    860 C     TO BUFRLIB ROUTINE PKBS1 (OVRBS1 OBSOLETE WITH 1/31/2006 VERSION
    861 C     OF BUFRLIB) (THIS IS CURRENTLY NEVER CALLED IN PREPDATA);
    862 C     INCREASED SIZE OF COMMON BLOCK /BITBUF/ ARRAYS IBAY AND MBAY FROM
    863 C     (5000) AND (5000,32) TO (12500) AND (12500,32), RESP. TO MATCH
    864 C     SIZES IN THIS COMMON BLOCK IN 1/31/2006 VERSION OF BUFRLIB;
    865 C     REDEFINES MANY BUFR TABLE DESCRIPTORS FOR TABLE A/D ENTRIES TO
    866 C     AVOID TABLE A/D CONFLICTS WITH OTHER BUFR TABLES; MODIFIED TO
    867 C     PROCESS WINDSAT SCATTEROMETER REPORTS, READ FROM NEW "WDSATR" DUMP
    868 C     FILE (GETS PREPBUFR REPORT TYPE 289 AND ENCODES NEW PARAMETERS
    869 C     MRWVC, MRLWC, WSST, MWD10, MWS10, WSEQC1, CHSQ, PHER, SPDE, SSTE,
    870 C     CLDE AND VPRE IN PREPBUFR FILE UNDER NEW MESSAGE TYPE "WDSATR);
    871 C     NOW HANDLES SATWINDS FROM NEW INDIAN KALPANA SATELLITE (REPORTS
    872 C     HAVE SUFFIX CHARACTER "K" IN STATION ID); MODIFIED TO HANDLE
    873 C     RETURN OF NEW ARGUMENT "RDATA2" FROM CALLS TO W3UNPKB7 [1-DIM 21-
    874 C     WORD ARRAY WHICH HOLDS ADDITIONAL VALUES DECODED DIRECTLY FROM
    875 C     BUFR (AND NOT IN "RDATA" ARRAY), FOR SOME PARAMETERS REPLACING
    876 C     WHAT HAD BEEN RETURNED IN "RDATA" ARRAY (IN THE HEADER)]; BUMP UP
    877 C     ARRAY SIZE FOR UNPACKED REPORT FROM IW3UNPBF FROM 3000 TO 3500;
    878 C     ACCOUNTS FOR EUMETSAT MSG (METEOSAT-8 AND UP) SATWINDS CONTAINING
    879 C     RFF QUALITY INDICATOR; ADDED READING IN, LISTING AND ENCODING OF
    880 C     PERCENT CONFIDENCE BASED ON - EUMETSAT QUALITY INDEX WITH FORECAST
    881 C     CONSISTENCY TEST (READ FROM CAT. 8 CODE TABLE 356, ENCODED USING
    882 C     MNEMONIC "QIFY"), EUMETSAT QUALITY INDEX WITHOUT FORECAST
    883 C     CONSISTENCY TEST (READ FROM CAT. 8 CODE TABLE 357, ENCODED USING
    884 C     MNEMONIC "QIFN") AND NESDIS EXPECTED ERROR (READ FROM CAT. 8 CODE
    885 C     TABLE 358, ENCODED USING MNEMONIC "EEQF") FOR SATWND TYPES; FIXED
    886 C     BUG WHICH STORED BALLOON DRIFT COORDINATES FROM PREVIOUS RAOB/
    887 C     PIBAL REPORT INTO DROPWINSONDE REPORT (DROPS SHOULD HAVE MISSING
    888 C     BALLOON DRIFT COORDINATES); CASES WHERE OBS ARE SET TO QM=15 IN
    889 C     ORDER TO FLAG A REPORT FOR NON-USE BY ANALYSIS (EVEN THOUGH OBS
    890 C     MAY NOT NECESSARILY BE BAD) NOW FIRST CHECK TO MAKE SURE OBS QM
    891 C     ISN'T ALREADY "BAD" (> 3 AND < 15) (PREVENTS GSI FROM MONITORING
    892 C     TRULY BAD OBS WHICH JUST HAPPEN TO BE IN REPORT GROUPS FLAGGED
    893 C     FOR NON-USE BY ANALYSIS); CHANGED PROCESSING OF DROPSONDE
    894 C     MOISTURE: ACFT USING SWITCH "FLDMGS" (ALL NOAA, INCL. P-3 AND
    895 C     GULF STREAM) MORE PRECISELY DEFINED TO ENSURE THAT ONLY NOAA ACFT
    896 C     ARE AFFECTED BY THIS SWITCH, SWITCH "FLDMAF" NOW REFERS
    897 C     EXCLUSIVELY TO USAF ACFT (HAD REFERRED TO ALL NON-NOAA ACFT), NEW
    898 C     SWITCH "FLDMFR" REFERS TO NON-US (NON-NOAA AND NON-USAF) ACFT
    899 C     (DEFAULTS TO TRUE - FLAG MOISTURE DATA ON ALL LEVELS); EXPANDED
    900 C     ARRAYS OBS3 FROM (5,255,5) TO (5,255,7) AND NOBS3 FROM (5) TO (7)
    901 C     (RETURNED OUT OF CALL TO IW3UNPBF) TO ACCOUNT FOR PROCESSING OF
    902 C     ADDITIONAL MULTIPLE-LEVEL SENSIBLE WEATHER ELEMENTS CONTAINING
    903 C     AIRFRAME ICING (RECCOS, PIREPS, EAMDAR, CANADIAN AMDAR, TAMDAR),
    904 C     ENCODED INTO PREPBUFR FILE IN NEW MNEMONICS "AFIC", "HBOI" AND
    905 C     "HTOI" (TYPE OF ICING, HEIGHT OF BOTTOM AND TOP OF ICING LAYER),
    906 C     AND DEGREE OF TURBULENCE (RECCOS AND ALL AIRCRAFT), ENCODED INTO
    907 C     PREPBUFR FILE IN EXISTING MNEMONIC "DGOT" (DEGREE OF TURBULENCE)
    908 C     AND NEW MNEMONICS "HBOT" AND "HTOT" (HEIGHT OF BOTTOM AND TOP OF
    909 C     TURBULENCE LAYER), THE EXPANDED TURBULENCE INFORMATION REPLACES
    910 C     THE SINGLE DEGREE OF TURBULENCE VALUE WHICH HAD BEEN RETURNED
    911 C     FROM IW3UNPBF IN CAT. 8, CODE FIGURE 916; ADDED NEW N-LIST SWITCH
    912 C     WRMISS (DEF=T) - IF TRUE, REPORTS WITH NO VALID OBS (WIND/TEMP)

Page 17          Source Listing                  PREPOBS_PREPDATA
2017-04-18 11:09                                 prepdata.f

    913 C     LEVELS AND NO VALID BRIT. TEMP. CHANNELS, BUT WITH OTHER
    914 C     ANCILLARY INFO (E.G., SENSIBLE WX ELEMENTS) ARE NOW ENCODED INTO
    915 C     PREPBUFR FILE - CURRENTLY APPLIES ONLY TO AIRCRAFT REPORTS
    916 C     (MAINLY PIREPS WITH TURB, ICING, CLOUD BUT NO TEMP OR WIND) -
    917 C     BEFORE SUCH OBS WITHOUT ANY DATA USED BY ASSIMILATION WERE ALWAYS
    918 C     SKIPPED; CAN NOW HANDLE GOES 1x1 SOUNDINGS/PW/RADIANCES IN
    919 C     MESSAGE TYPE "NC003003"; GOES SOUNDINGS/PW/RADIANCES ONLY
    920 C     PROCESSED IF MESSAGE TYPE IS "NC003001" (5x5) OR "NC003003" (1x1),
    921 C     GOES CLOUD-TOP RETR ONLY PROCESSED IF MESSAGE TYPE IS "NC003002"
    922 C     (NEEDED WHEN 1x1 SNDGS ARE STORED WITH CLOUD IN GOESND DUMP SINCE
    923 C     FORMER ALSO CONTAIN CLOUD INFO WHICH WE DO NOT WANT TO PROCESS);
    924 C     ADDED NAMELIST SWITCH "SKGP45", WHEN TRUE (DEFAULT) SKIPS ALL
    925 C     GPS-IPW REPORTS WITH REPORT TIME MINUTES GREATER THAN 30 (xx:45
    926 C     REPORTS CONSIDERED TO BE OF POORER QUALITY THAN xx:15 REPORTS);
    927 C     ACCOUNTS FOR INCREASE IN PRECISION FOR "DHR" AND "RPT" FROM 10**3
    928 C     TO 10**5 (HOURS)
    929 C 2008-04-10  D. A. KEYSER -- CAN HANDLE RADIOSONDE TYPES > 99 WHICH
    930 C     WILL SOON BE INTRODUCED INTO THE BUFR DATABASE (BASED ON NOVEMBER
    931 C     2007 WMO BUFR UPDATE); INTERFACE ROUTINES WITH ATOVS SOUNDINGS
    932 C     (W3ATOVSUNP AND W3XTOVSEDS CAN NOW HANDLE METOP-2 SATELLITE (CDAS
    933 C     ONLY)
    934 C 2008-09-12  D. A. KEYSER -- MODIFIED TO RECOGNIZE THAT TAMDAR REPORTS
    935 C     CAN NOW APPEAR IN "aircft" DUMP MESSAGE TYPES NC004012 (PENAIR)
    936 C     AND NC004013 (CHAUTAUQUA) IN ADDITION TO MESSAGE TYPE NC004008
    937 C     (MESABA)
    938 C 2008-09-25  D. A. KEYSER -- CAN NOW PROCESS ASCAT SCATTEROMETER
    939 C     WIND DATA READING FROM REPROCESSED DUMP FILE IN UNIT 39, ENCODING
    940 C     INTO NEW PREPBUFR REPORT TYPE 290 UNDER NEW PREPBUFR MESSAGE TYPE
    941 C     "ASCATW" VIA NEW NAMELIST SWITCHES "JPASCD" (DEF=6*9999) AND
    942 C     IAWNDO (DEF=-3,+3) (1-DIM ARRAY RDATA2 RETURNED FROM W3UNPKB7
    943 C     INCREASED FROM 21 TO 24 WORDS TO HANDLE NEW ANCILLARY INFO
    944 C     ENCODED WITH ASCAT REPORTS); CHANGES TO PREPBUFR ENCODING IN
    945 C     PREPARATION FOR FUTURE DOWNSTREAM NRL AIRCRAFT Q.C. MODULE
    946 C     (REPLACING CURRENT DOWNSTREAM PREPACQC AND ACARSQC MODULES) WHICH
    947 C     WILL REPLICATE LEVEL DATA IN ITS GENERATION OF "PROFILES": SOME
    948 C     MNEMONICS THAT WERE IN HEADER MOVED TO LEVEL INFO, CALL TO
    949 C     BUFRLIB ROUTINE DRFINI TO ALLOW FOR POSSIBLE NESTED REPLICATION
    950 C     OF LEVEL INFO SEQUENCES; 1-DIM ARRAY OBS2 RETURNED FROM IW3UNPBF
    951 C     INCREASED FROM 41 TO 42 WORDS TO HOLD MOISTURE QUALITY (CODE
    952 C     TABLE) FOR MDCRS REPORTS, ENCODED INTO PREPBUFR FILE (MNEMONIC
    953 C     MSTQ) FOR USE BY FUTURE DOWNSTREAM NRL AIRCRAFT Q.C. MODULE;
    954 C     UPPER LIMIT FOR STORING Q CHANGED FROM 32767 MG/KG TO 99999 MG/KG
    955 C     TO ENSURE THAT LEVELS WITH VERY HIGH SPECIFIC HUMIDITY ARE
    956 C     PROCESSED (THE 32767 LIMIT WAS A VESTIGE FROM THE OLD I*2 PREPDA
    957 C     DAYS); IF NEAREST INTEGER FOR Q IS 0 MG/KG, IT IS RESET TO
    958 C     1 MG/KG (.001 G/KG) TO ENSURE THAT LEVELS WITH VERY LOW SPECIFIC
    959 C     HUMIDITY ARE PROCESSED (Q MUST BE > 0 TO BE PROCESSED)
    960 C 2010-06-07  D. A. KEYSER -- NOW CHECKS FOR ALTIMETER Q.M. IN CODE
    961 C     FIG. 20 OF CAT. 8 FOR METARS (AS WELL AS FOR MESONETS AS BEFORE)
    962 C     SINCE IW3UNPBF IS ALSO MODIFIED HERE TO STORE THIS FOR METARS
    963 C     (BUT ONLY IF Q.M. VALUE IS 12-REJECT or 14-PURGE); CORRECTED BUG
    964 C     IN SUBR. SFCDTA WHICH WAS NOT PROPERLY INTERPRETING ALTIMETER
    965 C     Q.M. IN CODE FIG. 20 OF CAT. 8 FOR MESONETS (MANY MESONET PRESS.
    966 C     Q.M.'S WERE SET TO 2 OR 15 WHEN THEY SHOULD HAVE BEEN SET TO 3 OR
    967 C     13, RESP.) (NOTE THAT MESONETS TO NOT REPORT PRESS. SO ALTIMETER
    968 C     SETTING IS USED TO CALCULATE PRESS. AND THE ALTIMETER Q.M. IS
    969 C     TRANSFERRED TO PRESS.)

Page 18          Source Listing                  PREPOBS_PREPDATA
2017-04-18 11:09                                 prepdata.f

    970 C 2011-10-14  D. A. KEYSER -- RAP (RAPID REFRESH) NETWORK REPLACES
    971 C     RUC2A (RAPID UPDATE CYCLE) IN NCEP MODEL RUN MARKER (IRNMRK) 4
    972 C 2012-11-27  D. A. KEYSER -- INCREASED MAXIMUM POSSIBLE VALUE FOR SQN
    973 C     (SEQUENCE NUMBER) ENCODED INTO PREPBUFR FILE FROM 99998 TO 524286
    974 C     (NEEDED BECAUSE THERE CAN NOW BE > 99998 MDCRS REPORTS IN A
    975 C     MONOLITHIC "AIRCAR" DUMP FILE - THIS CAUSES PREPACQC TO FAIL IN
    976 C     SERIAL PREPBUFR PROCESSING RUNS, E.G. IN SDMEDIT)
    977 C 2012-11-30  J. WOOLLEN  INITIAL PORT TO WCOSS; ADDED CALL TO BUFRLIB
    978 C     ROUTINE SETBMISS(10E08_8) TO RESET BMISS TO A VALUE (10E08_8)
    979 C     WHICH WILL NOT CAUSE INTEGER OVERFLOW WHICH CAN BE UNPREDICTABLE
    980 C     (PRIOR BMISS VALUE WAS 10E10_8)
    981 C 2013-02-14  D. A. KEYSER -- FINAL CHANGES TO RUN ON WCOSS: PASS BMISS
    982 C     VIA COMMON BLOCK RATHER THAN HARDWIRING IT TO 10E08_8 IN MANY
    983 C     DIFFERENT SUBROUTINES;  USE FORMATTED PRINT STATEMENTS WHERE
    984 C     PREVIOUSLY UNFORMATTED PRINT WAS USED (WCOSS SPLITS UNFORMATTED
    985 C     PRINT AT 80 CHARACTERS); IN SUBR. LNDCHK, FIXED BUG IN S.H.
    986 C     KXI/KYJ CALCULATION WHICH LED TO ALL S.H. REPORTS NEVER HAVING
    987 C     "ICHK" SATISFIED, MEANING ILAND WAS ALWAYS RETURNED AS 0 (E.G.,
    988 C     FOR LAND/SEA CHECK, ALL S.H. REPORTS WERE DEEMED OVER WATER
    989 C     REGARDLESS OF THEIR LOCATION), THIS ALSO CAUSED AN ARRAY OVERFLOW
    990 C     SINCE KYJ COULD BE CALCULATED AS 38, 1 GREATER THAN THE LIMIT; IN
    991 C     SUBR. LNDCHK  FIXED S.H. BUGS WHICH CAUSED AN OVERFLOW IN KXI FOR
    992 C     ELON > 359.98 AND AN OVERFLOW IN KYJ FOR LAT > -0.01
    993 C 2014-04-25  D. A. Keyser --
    994 C          - For all satellite-derived wind reports, now encodes
    995 C     PREPBUFR report sub-type (mnemonic "TSB", previously missing) as
    996 C     BUFR satellite id times 10 plus "Satellite Derived Wind
    997 C     Computation Method ("SWCM" - BUFR code table 0-02-023), allows
    998 C     GSI to identify cloud-top vs. deep-layer WV winds and IR vs.
    999 C     visible winds for METEOSAT and JMA since, unlike NESDIS, both
   1000 C     have same report types (250-JMA & 254-EUMETSAT for WV, 242/252-
   1001 C     JMA & 243/253-EUMETSAT for IR/VIS).
   1002 C          - 1-dim array OBS2 returned from IW3UNPBF increased from 42
   1003 C     to 43 words to hold satellite zenith angle (degrees, for all
   1004 C     SATWND types), encoded into PREPBUFR file (mnemonic SAZA) for use
   1005 C     by GSI (to possibly screen SATWNDS with high SAZA values).
   1006 C          -  Added IRNMRK=10 for UnRestricted Mesoscale Analysis (URMA)
   1007 C     network.
   1008 C          - No longer aborts with RC=99 if number of levels in a
   1009 C     report exceeds the limit of "MXLVL".  Instead, now skips the
   1010 C     offending report(s) and, at the very end, posts a message to the
   1011 C     JOBLOG file noting how many reports were skipped due to this
   1012 C     issue.
   1013 C 2014-04-25  S. Melchior  --
   1014 C          - Added processing of Coast Guard tide gauge data (read from
   1015 C     SFCSHP dump, dump report type 534). A 12'th word added to
   1016 C     following namelist switches to account for these new reports:
   1017 C     FWINDO, JSURFM, JSURFW.
   1018 C          - Added new namelist switch NPKRPT, if TRUE all of the below
   1019 C     occurs: will process reports that would otherwise be tossed due
   1020 C     to their having a missing pstn; these reports estimate pstn from
   1021 C     the reported or U.S. std. atmosphere pmsl, the reported or U.S.
   1022 C     std. atmosphere sensible temperature, and the reported elevation
   1023 C     (only marine reports > 7.5 m can have a reported pmsl and fall
   1024 C     into this category); this estimated pstn (POB) is used to
   1025 C     estimate q (QOB); both POB and QOB are assigned minimum q.m.'s
   1026 C     (PQM, QQM) of 3; estimated POB is encoded into PREPBUFR file;

Page 19          Source Listing                  PREPOBS_PREPDATA
2017-04-18 11:09                                 prepdata.f

   1027 C     these reports are then assigned new PREPBUFR report types 192/292
   1028 C     (SYNOP), 193/293 (METAR), 194/294 (marine), 195/295 (mesonet);
   1029 C     ATLAS buoy wind reports which also have missing pstn and pmsl
   1030 C     will continue to be processed as before (PREPBUFR report type 282
   1031 C     - note: this means that if an ATLAS buoy ever had T,q info, its
   1032 C     mass piece would still be tossed rather than getting into
   1033 C     PREPBUFR file under report type 194 (may need to fix this logic
   1034 C     someday); MESONETS will no longer have "x" in character 8 of id,
   1035 C     instead they will get PREPBUFR report types 195/295 rather than
   1036 C     188/288.
   1037 C          - Subroutine SFCDTA modified to trap reports whose wind
   1038 C     information exceeds the 32767 limit.  If the limit is exceeded,
   1039 C     the entire report will skip being encoded into the output
   1040 C     PREPBUFR file.
   1041 C          - Modified to always encode wind speed obs in m/sec ("SOB")
   1042 C     and wind direction obs ("DDO") for all types of surface reports
   1043 C     (even if one or the other are missing but also if both are
   1044 C     present); removed old logic which encoded "SOB" only for METAR
   1045 C     reports when direction was missing and speed was .LE. 3 m/sec
   1046 C     (direction was never encoded in any situation for surface
   1047 C     reports), also removed encoding of "SQM" (wind speed quality
   1048 C     mark) for these types of METAR reports - all surface reports now
   1049 C     encode wind qm as "WQM" regardless of whether or not it also
   1050 C     encodes direction, speed, u-comp or v-comp {note this change does
   1051 C     not affect non-surface reports which can still encode speed
   1052 C     in knots ("FFO") and direction ("DDO") when "UOB" and "VOB" are
   1053 C     also encoded.
   1054 C          - Added new mnemonic "PMIN" (mean sea-level pressure
   1055 C     indicator) which is encoded with a value of zero for all surface
   1056 C     reports with an observed mean sea-level pressure encoded in
   1057 C     "PMO".  "PMIN" will be encoded with a value of 1 in w3emc routine
   1058 C     GBLEVENTS for cases where a mean sea-level pressure is derived
   1059 C     (see docblock in GBLEVENTS for more information).
   1060 C          - Report type 183 now stores moisture quality mark no lower
   1061 C     than 3 (suspect) (before type 183 stored observed moisture
   1062 C     quality mark read from the ADPSFC dump file).
   1063 C 2014-04-25  Y. Ling      --
   1064 C          - Handles new VAD wind reports from Level 2 decoder.
   1065 C     Differentiates between these and existing Radar Coded Message
   1066 C     (RCM) VAD wind reports via use of report subtype (TSB=1 for RCM
   1067 C     and =2 for Level 2).  No conversion of winds from dir/speed to
   1068 C     u/v for VAD wind reports from Level 2 decoder since these are
   1069 C     already u/v and are stored in m/sec
   1070 C          - Increase the maximum number of levels that can be
   1071 C     processed from 300 to 600.  This allows runs that might include
   1072 C     interpolated levels (e.g., special AFOS graphics, IRNMRK=2) to
   1073 C     still work properly as more and more radiosonde levels become
   1074 C     available in the new RRS.
   1075 C 2014-07-10  D. A. Keyser --
   1076 C          - Added encoding of "DFQ" (wind dir/speed quality mark) for
   1077 C     all types that aleady encode "DDO" (wind dir) and either "FFO"
   1078 C     (wind speed kts) or "SOB" (wind speed m/s) {"DFQ" will now be
   1079 C     encoded with overall wind quality mark in both cases when "UOB"
   1080 C     and "VOB" are encoded (then "DFQ" same as "WQM") and cases when,
   1081 C     for surface reports, "UOB" and "VOB" are not encoded because
   1082 C     either dir or speed is missing}.  Prior to this, "DFQ" was always
   1083 C     missing and the overall wind quality mark was always encoded in

Page 20          Source Listing                  PREPOBS_PREPDATA
2017-04-18 11:09                                 prepdata.f

   1084 C     "WQM" even when, for surface reports, "UOB" and "VOB" were
   1085 C     missing but either wind dir or speed was not.  Now, the entire
   1086 C     "W__EVENT" sequence "[UOB VOB WQM WPC WRC]" is skipped for
   1087 C     surface reports when "UOB" and "VOB" are both missing.
   1088 C          - Added encoding of "DFP" (wind dir/speed program code) for
   1089 C     surface reports in both cases when "UOB" and "VOB" are encoded
   1090 C     (then "DFP" same as "WPC") and when "UOB" and "VOB" are not
   1091 C     encoded because either dir or speed is missing.  Prior to this,
   1092 C     "DFP" was always missing in this case.
   1093 C          - Added encoding of "DFR" (wind dir/speed reason code), if
   1094 C     it is non-missing, in both cases when "UOB" and "VOB" are encoded
   1095 C     (then "DFR" same as "WRC") and cases when, for surface reports,
   1096 C     "UOB" and "VOB" are not encoded because either dir or speed is
   1097 C     missing.  Prior to this, "DFR" was always missing in either case.
   1098 C 2014-07-10  S. Melchior  -- Added logic in subr. FIZZ01 to reset
   1099 C     longitude to 0.0 when it is very close to 360.0. This ensures
   1100 C     that array clobbering will not occur if a report (with high
   1101 C     precision native lat/lon) is right at Prime Meridian.
   1102 C 2014-11-25  D. A. Keyser -- Removed input argument "IDATE" (central
   1103 C     date) from call to subr. W3CNVXTOVS since year {IDATE(1)} is no
   1104 C     longer needed to obtain BUFR satellite ID.
   1105 C 2015-01-30  D. A. Keyser -- All references to IR satellite-derived
   1106 C     winds now expanded to refer to IR "long-wave" - this
   1107 C     differentiates them from IR "short-wave" winds which are now
   1108 C     produced from GOES but are not processed by this program. Skips
   1109 C     over the reading of reports in "satwnd" dump coming from tanks
   1110 C     NC005080 (AVHRR POES) and NC005090 (VIIRS POES) since these
   1111 C     cannot be processed by this program.
   1112 C 2015-03-09  D. A. Keyser -- In subr. UNPREPBF, accounts for new
   1113 C     output argument "CBULL" returned from IW3UNPBF for unpacked
   1114 C     reports (character*11 string containing WMO bulletin header and
   1115 C     originator - filled only for aircraft types right now).
   1116 C 2015-03-11  D. A. Keyser -- Fixed issues related to storage of SQN
   1117 C     (sequence number):
   1118 C         - Now initialized as 999990 instead of 99999.
   1119 C         - Corrected bug which was not encoding it properly for AIRCAR
   1120 C           type when SQN was > 99998.
   1121 C         - Now encoded as missing rather than 99999 for types which do
   1122 C           not store SQN.
   1123 C 2015-04-08  D. A. Keyser -- Encodes new, unique report subtype (TSB)
   1124 C     values into PREPBUFR file for AIRCAR types based on WMO bulletin
   1125 C     header/originator (1-U.S. MDCRS, 2-Mexican MDCRS, 3-ADS-C MDCRS,
   1126 C     99-default/unknown)
   1127 C 2015-04-10  D. A. Keyser -- Added new namelist switch TDMAX, defined
   1128 C     as the upper limit for acceptable dewpoint temperature obs (the
   1129 C     moisture on any level, for any report type, with dewpoint
   1130 C     temperature on that level > TDMAX will be flagged with QM=15 in
   1131 C     subr. FIZZ01 and encoded in the PREPBUFR file if it is not
   1132 C     already flagged as bad).
   1133 C 2015-04-16 JWhiting -- Fixed bug in GOES TOCC encoding in subr.
   1134 C     GOESDG; now populates CLTOP(1,2) with TOCC value directly from
   1135 C     RDATA2(25) passed from W3UNPKB7 (had looked for it in cat 8 c.f.
   1136 C     258 passed in from W3UNPKB7 in RDATA array but this was changed
   1137 C     long ago to hold cloud amount and not total cloud cover, and the
   1138 C     former is missing in GOES cloud reports). RDATA2 is expanded to
   1139 C     size 25 in W3UNPKB7 in order to store TOCC, and this is accounted
   1140 C     for here in prepdata.f.

Page 21          Source Listing                  PREPOBS_PREPDATA
2017-04-18 11:09                                 prepdata.f

   1141 C 2015-04-16  D. A. Keyser -- Updated land/sea check in subr. LNDCHK
   1142 C     for N.H. surface marine reports.  Now has option (under certain
   1143 C     conditions) to check 16 points around obs lat/lon location {4
   1144 C     inner points as before (which is still an option) plus also now
   1145 C     12 points in next, outer ring}.  If any one of the 16 points is
   1146 C     over water, the obs is deemed over water. On the mask boundary
   1147 C     (i.e., Prime Meridian or Equator), check reverts back to only
   1148 C     surrounding 4 points since 1 or more mask points are not stored
   1149 C     in outer 12 point ring in this case.  Several additional mask
   1150 C     points in key geographical locations known to be over water are
   1151 C     also converted from over land to over water (after being read
   1152 C     in). It is known that many valid N.H. marine ship and buoy
   1153 C     reports at the coastline are being flagged as over land (and not
   1154 C     used by the analysis) due to their imprecise lat/lon. This change
   1155 C     will allow these to now be used by the analysis, but it will
   1156 C     still flag reports with invalid lat or lon (when it results in
   1157 C     them being well inland).
   1158 C 2016-01-28 JWhiting -- Updated subr W3FIZZ to generate values for new
   1159 C     CEILING mnemonic. This new field is created from cloud base
   1160 C     (HOCB) content when available, for the lowest cloud layer that
   1161 C     has a cloud amount (CLAM) that is "either Broken (6-9 tenths sky
   1162 c     cover) or Overcast (10 tenths cover)", or is listed as fog
   1163 C     conditions (CLAM=9 or 10); Otherwise, CEILING is set to missing.
   1164 C     For clear conditions (less than broken and non-fog), the CEILING
   1165 C     is set to an "infinite" high value (arbitrarily chosen as 20000m).
   1166 C     Also, added a printout of the BUFRLIB version in use (though a
   1167 C     BVERS() subroutine call)
   1168 C 2016-08-15 JWhiting -- Updated to enable new GNSS/GPS-Met data feed
   1169 C     (message type NC012004 in dump file "gpsipw") with precip. water
   1170 C     & zenith total delay content:
   1171 C       Added new LDTA namelist switch SKGNSS (stored in existing common
   1172 C        block /GPSWCH/) to control the ability to toss new GNSS/GPS-Met
   1173 C        reports (i.e., those with subset NC012004) if they are NOT from
   1174 C        the U.S.-provider (ENI) {tosses when SKGNSS = T (default)};
   1175 C       In subr GETGPSIPW:
   1176 C         Set existing LDTA namelist switch SKGP45 to apply to reports
   1177 C          with subset NC012003 (old GSD-supplied GPS) only.
   1178 C         Added trap to toss reports w/ precipitable water value zero
   1179 C          regardless of GPS data stream (new or old).
   1180 C         Added logic to toss reports with subset NC012004 (new U.S.
   1181 C          ENI- and foreign GNSS-supplied GPS) if they are from a non-
   1182 C          ENI provider (i.e., characters 5-8 of report id not being
   1183 C          "GPSS") as GSI may not be able to handle these properly at
   1184 C          this time (controlled by SKGNSS).
   1185 C       In subr FIZZ01:
   1186 C         For all GPS data streams (i.e., NC012003-004), store zenith
   1187 C         total delay (m) and its error (m), along with hardwired
   1188 C         azimuth (0.0 deg) and elevation (90.0 deg) angles into holding
   1189 C         arrays for subsequent output.
   1190 C       In subr. W3FIZZ:
   1191 C         For all GPS data streams (i.e., NC012003-004), encode into
   1192 C         PREPBUFR file zenith total delay (when present) and its error,
   1193 C         represented by "atmospheric path delay in satellite signal"
   1194 C         (m) (mnemonic APDS) and "error in atmospheric path delay in
   1195 C         satellite signal" (m) (mnemonic APDE), resp., in association
   1196 C         with hardwired azimuth angle (mnemonic BEARAZ) of 0.0 (deg)
   1197 C         and hardwired elevation angle (mnemonic ELEV) of 90.0 (deg).

Page 22          Source Listing                  PREPOBS_PREPDATA
2017-04-18 11:09                                 prepdata.f

   1198 C 2016-08-15  D. A. Keyser -- In subr. FILLX, add zenith total delay and
   1199 C     its error to listings for GPS-IPW/ZTD reports in report type 153.
   1200 C 2016-09-01  D. A. Keyser -- New BUFRLIB routine NEMSPECS is
   1201 C     integrated into code.
   1202 C     BENEFIT: Facilitates easier handling of future precision
   1203 C              increases.
   1204 C 2016-09-05  S. Melchior --
   1205 C      - Processes two new aircraft data types in AIRCFT message type:
   1206 C        Korean AMDAR (BUFR) and Catch-all AMDAR (BUFR).  Either pre-
   1207 C        version 7 BUFR or new version 7 BUFR for Catch-All AMDAR,
   1208 C        MDCRS and E-AMDAR can be handled.
   1209 C          - The following arrays' dimensions were increased and
   1210 C            defaults adjusted: AWINDO, AIRLND, JAWIND, JAMASS, IACFTL,
   1211 C            IACFTH, AIFNOW, FLACMS, KSKALM, KSKAHM, KEPAC, KSKNOW,
   1212 C            INAC.
   1213 C        BENEFIT: Handles TAC to BUFR migration of AMDAR data and move
   1214 C                 to version 7 BUFR for those applicable aircraft
   1215 C                 types.
   1216 C      - Some diagnostic output print statements formatted to
   1217 C        accommodate increased precision now in latitude and longitude
   1218 C        (driven by new version 7 BUFR AMDAR data but also by hi-res lat
   1219 C        /lon found in reports in input dump files for other data
   1220 C        types).  These hi-res lat/lon values are now encoded into the
   1221 C        PREPBUFR files (via a change to fixed file
   1222 C        prepobs_prep.bufrtable).
   1223 C      - Fixed a bug which allowed an aircraft report "mass piece" to
   1224 C        be encoded into the PREPBUFR file in cases when everything was
   1225 C        missing other than the restriction indicators (mnemonics RSRD
   1226 C        and EXPRSRD).
   1227 C        BENEFIT: Prevents a failure downstream in PREPACQC.
   1228 C                 {Fortunately this has never occurred to date because
   1229 C                 AMDAR reports (only type restricted) have never had
   1230 C                 both a missing temperature and wind.}
   1231 C 2016-10-27  C. Hill --
   1232 C      - TAMDARB AIRCFT message type added to handle BUFR form of TAMDAR
   1233 C        reports.  Allows for older (pre-2011) and newer TAMDAR data to
   1234 C        be processed.  The array sizes of AWINDO, AIRLND, JAWIND,
   1235 C        JAMASS, IACFTL, IACFTH, AIFNOW, FLACMS, KSKALM, KSKAHM, KEPAC,
   1236 C        KSKNOW, and INAC were all increased to (6,9).
   1237 C 2016-11-25  D. A. Keyser --
   1238 C      - Changed nomenclature: ASDAR becomes AMDAR; E-ADAS becomes
   1239 C        EAMDAR; ACARS becomes MDCRS; TAMDAR from MADIS becomes TAMDARM;
   1240 C        TAMDAR from Panasonic/AirDAT (BUFR) becomes TAMDARB; CAN-AMDAR
   1241 C        becomes CAMDAR; KOR-AMDAR becomes KAMDAR.
   1242 C      - Reset default values for namelist switches AWINDO, JAWIND,
   1243 C        JAMASS, IACFTL and AIFNOW to more accurately reflect the values
   1244 C        read in from parm cards for most networks.
   1245 C      - Encodes instantaneous altitude rate (IALR) into PREPBUFR file
   1246 C        for TAMDARB reports in report type 134/234 (returned from c.f.
   1247 C        932 in call to IW3UNPBF).
   1248 C      - Flight number (returned from header reserve character word 2 in
   1249 C        call to IW3UNPBF) is now encoded into PREPBUFR file as ACID for
   1250 C        AMDARB reports (if non-missing).
   1251 C      - Corrected a bug in 2016-10-27 update: TAMDARB reports now get
   1252 C        proper report type 134/234 (were getting 131/231).
   1253 C      - Encode report subtype (TSB) of 1 for new Panasonic TAMDARB
   1254 C        reports (distinguishes them from legacy AirDAT TAMDAR BUFR

Page 23          Source Listing                  PREPOBS_PREPDATA
2017-04-18 11:09                                 prepdata.f

   1255 C        reports which had the default TSB value of 0).
   1256 C 2016-11-30  D. A. Keyser --
   1257 C      - Reads new output real, double-precision argument array OBS8_8
   1258 C        of length 2 in calls to IW3UNPBF and W3UNPKB7.  This returns
   1259 C        latitude and longitude for each report which is then carried
   1260 C        through code as R*8 variables ALAT_8 and ALON_8 before being
   1261 C        encoded into PREPBUFR file in mnemonics YOB (lat) and XOB
   1262 C        (lon) (and in lowest level drift lat/lon, YDR and XDR, resp.).
   1263 C        BENEFIT: Replaces lat/lon returned in RDATA(1:2) in calls to
   1264 C                 IW3UNPBF and W3UNPKB7 which are at machine precison,
   1265 C                 and HDR(2:3) carried through code also at machine
   1266 C                 precision (normally R*4). {RDATA(1:2) is still
   1267 C                 returned and will be used as input lat/lon only in
   1268 C                 rare event that OBS8_8(1:2) are missing.} Now that
   1269 C                 many reports in the dumps store lat/lon at 0.001 or
   1270 C                 even 0.00001 degree precision, and now that PREPBUFR
   1271 C                 encodes YOB/YDR and XOB/XDR at 0.00001 degree
   1272 C                 precision, this change will ensure that lat/lon is
   1273 C                 always accurate to 0.00001 degrees in PREPBUFR files.
   1274 C      - Additional diagnostic output print statements formatted to
   1275 C        accommodate increased precision in latitude and longitude.
   1276 C      - Replace machine length lat/lon {HDR(3), HDR(2)} with R*8 lat/
   1277 C        lon (ALAT_8, ALON_8) in some print statements.
   1278 C        BENEFIT: Values are now precise to 10**5 degrees (was not the
   1279 C                 case after 2016-09-05 change #2 above).
   1280 C 2017-01-11  C. Hill -- The default value for IACFTH(9) in BLOCK DATA
   1281 C        is changed from 3050 to 16500 meters to provide capability to
   1282 C        process the full vertical profile of TAMDARB reports (made
   1283 C        available by ARINC 01/17/2017).
   1284 C
   1285 C
   1286 C USAGE:
   1287 C   INPUT FILES:
   1288 C
   1289 C     UNIT 05  - STANDARD INPUT (DATA CARDS - SEE NAMELIST
   1290 C                DOCUMENTATION BELOW)
   1291 C
   1292 C              **  GROUP "AA" -- NCEP PRODUCTION DATE FILE **
   1293 C       (WHERE AA IS IUNIT(1) IN NAMELIST "&PARM"  DESCRIPTION BELOW)
   1294 C     UNIT AA   - NCEP PRODUCTION DATE FILE
   1295 C
   1296 C                    **  GROUP "BB" -- BUFR TABLES  **
   1297 C       (WHERE BB IS IUNIT(2) IN NAMELIST "&PARM"  DESCRIPTION BELOW)
   1298 C     UNIT BB   - FILE CONTAINING PREPBUFR MNEMONIC TABLES A/B/D
   1299 C     UNIT BB+1 - ** RESERVED FOR FUTURE USE **
   1300 C     UNIT BB+2 - ** RESERVED FOR FUTURE USE **
   1301 C
   1302 C                   **  GROUP "CC" -- FIXED FIELDS **
   1303 C       (WHERE CC IS IUNIT(3) IN NAMELIST "&PARM"  DESCRIPTION BELOW)
   1304 C     UNIT CC   - SEQUENTIAL FILE HOLDING: N.H. 1 DEG. LAT/LON GRID
   1305 C                 LAND/SEA INDICATOR; S.H. 2.5 DEG. LAT/LON GRID
   1306 C                 LAND/SEA INDICATOR; N.H. U.S.-MAINLAND/CONUS YES/NO
   1307 C                 INDICATOR - 1 DEG. LAT/LON
   1308 C     UNIT CC+1 - ** RESERVED FOR FUTURE USE **
   1309 C
   1310 C        **  GROUP "DD" -- BACKGROUND FILES (FOR "GBLEVENTS") **
   1311 C       (WHERE DD IS IUNIT(4) IN NAMELIST "&PARM"  DESCRIPTION BELOW)

Page 24          Source Listing                  PREPOBS_PREPDATA
2017-04-18 11:09                                 prepdata.f

   1312 C     UNIT DD   - FIRST SPECTRAL (GLOBAL) SIGMA FIRST GUESS FILE; IF
   1313 C                 HOUR IN CENTER DATE FOR PREPBUFR FILE IS A MULTIPLE
   1314 C                 OF 3 THEN THIS FILE IS VALID AT THE CENTER DATE OF
   1315 C                 THE PREPBUFR FILE, IF THE HOUR IN CENTER DATE FOR
   1316 C                 PREPBUFR FILE IS NOT A MULTIPLE OF 3 THEN THIS FILE
   1317 C                 IS VALID AT THE CLOSEST TIME PRIOR TO THE CENTER DATE
   1318 C                 OF THE PREPBUFR FILE THAT IS A MULTIPLE OF 3
   1319 C     UNIT DD+1 - SECOND SPECTRAL (GLOBAL) SIGMA FIRST GUESS FILE; IF
   1320 C                 HOUR IN CENTER DATE FOR PREPBUFR FILE IS A MULTIPLE
   1321 C                 OF 3 THEN THIS FILE IS EMPTY, IF THE HOUR IN CENTER
   1322 C                 DATE FOR PREPBUFR FILE IS NOT A MULTIPLE OF 3 THEN
   1323 C                 THIS FILE IS VALID AT THE CLOSEST TIME AFTER THE
   1324 C                 CENTER DATE OF THE PREPBUFR FILE THAT IS A MULTIPLE
   1325 C                 OF 3
   1326 C     UNIT DD+2 - OBSERVATION ERROR FILE
   1327 C
   1328 C            **  GROUP "EE" -- UPPER-AIR BUFR DATA DUMP FILES **
   1329 C       (WHERE EE IS IUNIT(5) IN NAMELIST "&PARM"  DESCRIPTION BELOW)
   1330 C     UNIT EE   - 'ADPUPA' BUFR DATA DUMP FILE (RAOB/PIBAL/DROPS/RECCOS)
   1331 C     UNIT EE+1 - 'AIRCAR' BUFR DATA DUMP FILE (MDCRS AIRCRAFT)
   1332 C     UNIT EE+2 - 'AIRCFT' BUFR DATA DUMP FILE (ALL AIRCRAFT OTHER THAN
   1333 C                  MDCRS)
   1334 C     UNIT EE+3 - 'SATWND' BUFR DATA DUMP FILE (SATELLITE-DERIVED WINDS)
   1335 C     UNIT EE+4 - 'PROFLR' BUFR DATA DUMP FILE (WIND PROFILER)
   1336 C     UNIT EE+5 - 'VADWND' BUFR DATA DUMP FILE (NEXRAD VAD WINDS)
   1337 C     UNIT EE+6 - 'RASSDA' BUFR DATA DUMP FILE (RASS TEMPERATURES)
   1338 C     UNIT EE+7 - ** RESERVED FOR FUTURE USE **
   1339 C     UNIT EE+8 - ** RESERVED FOR FUTURE USE **
   1340 C     UNIT EE+9 - ** RESERVED FOR FUTURE USE **
   1341 C
   1342 C             **  GROUP "FF" -- SURFACE BUFR DATA DUMP FILES **
   1343 C       (WHERE FF IS IUNIT(6) IN NAMELIST "&PARM"  DESCRIPTION BELOW)
   1344 C     UNIT FF   - 'ADPSFC' BUFR DATA DUMP FILE {SYNOPTIC (INCL. WMO RES.
   1345 C                  40)/METAR LAND SFC}
   1346 C     UNIT FF+1 - 'SFCSHP' BUFR DATA DUMP FILE (MARINE SURFACE)
   1347 C     UNIT FF+2 - 'SFCBOG' BUFR DATA DUMP FILE (MEAN SEA-LVL PRES BOGUS)
   1348 C     UNIT FF+3 - 'MSONET' BUFR DATA DUMP FILE (COOPERATIVE NETWORKS)
   1349 C     UNIT FF+4 - 'SPSSMI' BUFR DATA DUMP FILE (REPROCESSED FROM
   1350 C                 ORIGINAL SSM/I DATA DUMP - USUALLY CONTAINS TOTAL
   1351 C                 PRECIP. WATER, WIND SPEED AND MAYBE ALSO RAIN RATE)
   1352 C     UNIT FF+5 - 'ERS1DA' BUFR DATA DUMP FILE (REPROCESSED FROM
   1353 C                 ORIGINAL ERS SCATTEROMETER DATA DUMP - CONTAINS WIND
   1354 C                 INFORMATION)
   1355 C     UNIT FF+6 - 'QKSWND' BUFR DATA DUMP FILE (REPROCESSED FROM
   1356 C                 ORIGINAL QUIKSCAT SCATTEROMETER DATA DUMP - CONTAINS
   1357 C                 WIND INFORMATION)
   1358 C     UNIT FF+7 - 'WDSATR' BUFR DATA DUMP FILE (REPROCESSED FROM
   1359 C                 ORIGINAL WINDSAT SCATTEROMETER DATA DUMP - CONTAINS
   1360 C                 WIND, MOISTURE AND RAINRATE INFORMATION)
   1361 C     UNIT FF+8 - 'ASCATW' BUFR DATA DUMP FILE (REPROCESSED FROM
   1362 C                 ORIGINAL ASCAT SCATTEROMETER DATA DUMP - CONTAINS
   1363 C                 WIND INFORMATION)
   1364 C     UNIT FF+9 - ** RESERVED FOR FUTURE USE **
   1365 C
   1366 C   **  GROUP "GG" -- POLAR-ORBITING SATELLITE BUFR DATA DUMP FILES **
   1367 C       (WHERE GG IS IUNIT(7) IN NAMELIST "&PARM"  DESCRIPTION BELOW)
   1368 C     UNIT GG   - RTOVS BUFR DATA FILE (SOUNDINGS/RETRIEVALS/RADIANCES)

Page 25          Source Listing                  PREPOBS_PREPDATA
2017-04-18 11:09                                 prepdata.f

   1369 C     UNIT GG+1 - ATOVS BUFR DATA FILE (SOUNDINGS/RETRIEVALS/RADIANCES)
   1370 C     UNIT GG+2 - ** RESERVED FOR FUTURE USE **
   1371 C     UNIT GG+3 - ** RESERVED FOR FUTURE USE **
   1372 C     UNIT GG+4 - ** RESERVED FOR FUTURE USE **
   1373 C
   1374 C                **  GROUP "HH" -- GOES BUFR DATA DUMP FILE **
   1375 C       (WHERE HH IS IUNIT(8) IN NAMELIST "&PARM"  DESCRIPTION BELOW)
   1376 C     UNIT HH   - GOES BUFR DATA FILE (5x5 AND/OR 1x1 FOV SOUNDINGS/
   1377 C                 RETRIEVALS/RADIANCES)
   1378 C     UNIT HH+1 - ** RESERVED FOR FUTURE USE **
   1379 C
   1380 C      **  GROUP "II" -- OTHER SATELLITE BUFR DATA DUMP FILE **
   1381 C       (WHERE II IS IUNIT(9) IN NAMELIST "&PARM"  DESCRIPTION BELOW)
   1382 C     UNIT II   - 'GPSIPW' BUFR DUMP FILE (GPS INTEGRATED PRECIPITABLE
   1383 C                   WATER/ZENITH TOTAL DELAY)
   1384 C     UNIT II+1 - ** RESERVED FOR FUTURE USE **
   1385 C     UNIT II+2 - ** RESERVED FOR FUTURE USE **
   1386 C
   1387 C            **  GROUP "JJ" TO "OO" -- RESERVED FOR FUTURE USE  **
   1388 C       (WHERE JJ IS IUNIT(10) IN NAMELIST "&PARM"  DESCRIPTION BELOW;
   1389 C              KK IS IUNIT(11) IN NAMELIST "&PARM"  DESCRIPTION BELOW;
   1390 C              LL IS IUNIT(12) IN NAMELIST "&PARM"  DESCRIPTION BELOW;
   1391 C              MM IS IUNIT(13) IN NAMELIST "&PARM"  DESCRIPTION BELOW;
   1392 C              NN IS IUNIT(14) IN NAMELIST "&PARM"  DESCRIPTION BELOW;
   1393 C              OO IS IUNIT(15) IN NAMELIST "&PARM"  DESCRIPTION BELOW;
   1394 C
   1395 C   OUTPUT FILES:
   1396 C     UNIT 06  - STANDARD OUTPUT PRINT
   1397 C     UNIT PP  - PREPBUFR DATA SET
   1398 C              - (WHERE PP IS IUNIT(16) IN N-LIST "&PARM" DESCR. BELOW)
   1399 C     UNIT QQ  - "PREVENT" EVENTS DATA FILTERING SUMMARY PRINT FILE
   1400 C              - (WHERE QQ IS IUNIT(17) IN N-LIST "&PARM" DESCR. BELOW)
   1401 C
   1402 C   SUBPROGRAMS CALLED:
   1403 C     UNIQUE     - PREP       UNPREPBF   CHKREP     LL2IJ
   1404 C                  RPTLBL     TIMCHK     LNDCHK     GETUPA     UV
   1405 C                  SMERGE     SWNTBL     HSTATS     PSTATS
   1406 C                  WNDBYP     WNDBYZ     FILWND     FILDPT
   1407 C                  STOROB     BALLOON_DRIFT         FILLX      GETC06
   1408 C                  SATEDS     SNDPRP     GETPWATER  SFCDTA     GETSMI
   1409 C                  ISEL       ISSEL      SATBFR     GOESDG     GOESCHK
   1410 C                  SNDTBL     CMDDFF     GETSCATT   GETGPSIPW  W3FIZZ
   1411 C                  FIZZ01     WORDLENGTH IW3UNPBF   W3CNVXTOVS
   1412 C                  W3XTOVSMND W3UNPKB7   W3RTOVSUNP W3ATOVSUNP
   1413 C                  W3XTOVSEDS
   1414 C     LIBRARY:
   1415 C       SYSTEM   - SYSTEM
   1416 C       W3NCO    - W3TAGB     W3TAGE     W3LOCDAT   W3PRADAT   ERREXIT
   1417 C       W3EMC    - ORDERS     GBLEVENTS  W3FA03     W3FA04     W3FB04
   1418 C       BUFRLIB  - DATEBF     OPENBF     OPENMB     CLOSBF     STATUS
   1419 C                  UFBINT     WRITSB     UFBCNT     UFBQCD     DATELEN
   1420 C                  CLOSMG     OPENMG     PKBS1      SETBMISS   GETBMISS
   1421 C                  NEMSPECS   BVERS
   1422 C
   1423 C   EXIT STATES:
   1424 C     COND =   0 - SUCCESSFUL RUN
   1425 C     COND =  04 - APPEND=FALSE ONLY: ONE OF THE FOLLOWING DATA SETS

Page 26          Source Listing                  PREPOBS_PREPDATA
2017-04-18 11:09                                 prepdata.f

   1426 C                  CONTAINS NO REPORTS: ADPUPA OR ADPSFC (OR BOTH);
   1427 C                  PROGRAM RUNS TO COMPLETION
   1428 C     COND =  29 - ERROR READING NCEP PRODUCTION DATE FILE
   1429 C     COND =  30 - APPEND=TRUE ONLY: THE DATE FROM THE EXISTING
   1430 C                  PREPBUFR DATA SET DOES NOT MATCH THE EXPECTED
   1431 C                  (NCEP PRODUCTION) DATE
   1432 C     COND =  39 - A PROBLEM OCCURRED RETURNING A REPORT IN UNPACKED
   1433 C                  FORMAT VIA FCN IW3UNPBF, NO USEFUL INFO RETURNED
   1434 C     COND =  49 - ERROR OR END-OF-FILE READING FIXED LAND-SEA-U.S.
   1435 C                  MASK FILE IN UNIT IUNIT(3)
   1436 C     COND =  60-79 - RESERVED FOR W3EMC ROUTINE GBLEVENTS (SEE
   1437 C                      GBLEVENTS DOCBLOCK)
   1438 C
   1439 C REMARKS: SEE COMMENT CARDS FOLLOWING DOCBLOCK.
   1440 C
   1441 C ATTRIBUTES:
   1442 C   LANGUAGE: FORTRAN 90
   1443 C   MACHINE:  NCEP WCOSS
   1444 C
   1445 C$$$
   1446 CC
   1447 C    ***** VARIABLES IN NAMELIST TASK READ IN MAIN PROGRAM *****
   1448 CC
   1449 C    MP_PROCESS - PROCESS NUMBER FOR THIS MPI RUN (OBTAINED FROM SCRIPT)
   1450 C                                                            (DEFAULT=0)
   1451 CC
   1452 CC
   1453 C   ***** VARIABLES IN NAMELIST GBLEVN READ IN MAIN PROGRAM *****
   1454 CC
   1455 C    PREVEN - PERFORM THE GBLEVENTS (PREVENTS MODE) PROCESSING?
   1456 C              (SEE W3EMC ROUTINE GBLEVENTS)
   1457 C              PREVEN =.TRUE.  ---> YES, PERFORM GBLEVENTS PREVENTS
   1458 C              PREVEN =.FALSE. ---> NO, SKIP GBLEVENTS PREVENTS    (DEF)
   1459 CC
   1460 CC
   1461 C   ***** VARIABLES IN NAMELIST RGRID READ IN MAIN PROGRAM *****
   1462 CC
   1463 C  N O T E -- SEARCH GRID USED TO DEFINE AREA FOR DATA EXTRACTION
   1464 C              ALL DATA OUTSIDE THE SEARCH GRID ARE EXCLUDED
   1465 C          THE DIMENSIONS OF THE SEARCH GRID ARE SET BY IGRD, JGRD
   1466 C     =====> NOTE: THE SEARCH GRID DOES NOT APPLY TO AIRCRAFT REPORTS
   1467 C                  (ALL TYPES).  THEY ARE SELECTED ACCORDING TO
   1468 C                  LATITUDE BAND IN SWITCHES "JAMASS" AND "JAWIND".
   1469 C                  (PROGRAM PREPACQC WILL DETERMINE DOMAIN FOR THESE.)
   1470 CC
   1471 C    IGRD   - NO. OF SEARCH GRID POINTS IN EAST-WEST DIRECTION  (DEF=73)
   1472 C    JGRD   - NO. OF SEARCH GRID POINTS IN NORTH-SOUTH DIRECTION(DEF=37)
   1473 C    POLA   - TYPE OF SEARCH GRID
   1474 C              POLA  =.TRUE.  ---> POLAR STEROGRAPHIC
   1475 C              POLA  =.FALSE. ---> MERCATOR
   1476 C    NORTH  - HEMISPHERE SWITCH FOR POLAR STEREOGRAPHIC SEARCH GRID
   1477 C              NORTH =.TRUE.  ---> N. HEMISPHERE
   1478 C              NORTH =.FALSE. ---> S. HEMISPHERE
   1479 C              (APPLIES ONLY WHEN POLA = TRUE)
   1480 C    ALONVT - IF POLA=.TRUE.  ---> REFERENCE LONGITUDE (+W)
   1481 C             IF POLA=.FALSE. ---> STARTING (SOUTHERNMOST) LAT (+N,-S)
   1482 C    POLEI  - IF POLA=.TRUE.  ---> I INDEX OF POLE

Page 27          Source Listing                  PREPOBS_PREPDATA
2017-04-18 11:09                                 prepdata.f

   1483 C             IF POLA=.FALSE. ---> INCREMENT FOR LATITUDE (DEGREES)
   1484 C    POLEJ  - IF POLA=.TRUE.  ---> J INDEX OF POLE
   1485 C             IF POLA=.FALSE. ---> STARTING (WESTERNMOST) LONGITUDE
   1486 C                   (RANGE 0.01 TO 360.00 WEST; =360.00 FOR GREENWICH)
   1487 C    XMESHL - IF POLA=.TRUE.  ---> MESH LENGTH (KM) AT 60N
   1488 C             IF POLA=.FALSE. ---> INCREMENT FOR LONGITUDE (DEGREES)
   1489 CC
   1490 CC
   1491 C   ***** VARIABLES IN NAMELIST LDTA  READ IN MAIN PROGRAM *****
   1492 CC
   1493 CC
   1494 C    APPEND - APPEND BUFR MESSAGES TO EXISTING PREPBUFR FILE IN
   1495 C              UNIT PP?
   1496 C              APPEND =.TRUE.  ---> YES, ASSUMES OUTPUT FILE ALREADY
   1497 C                      CONTAINS DATA; ALL OUPUT BUFR MESSAGES WILL BE
   1498 C                      APPENDED TO IT USING THE INTERNAL BUFR MNEMONIC
   1499 C                      TABLE STORED IN THE FIRST SEVERAL BUFR MESSAGES
   1500 C                      AT THE TOP OF THE FILE
   1501 C              APPEND =.FALSE. ---> NO,  ASSUMES OUTPUT FILE IS NEW;
   1502 C                      ALL OUTPUT BUFR MESSAGES WILL BE WRITTEN TO IT
   1503 C                      USING THE EXTERNAL BUFR MNEMONIC TABLE IN
   1504 C                      UNIT BB                                 (DEFAULT)
   1505 C    IRNMRK - NCEP MODEL RUN MARKER
   1506 C              IRNMRK =  2 ---> SPECIAL AFOS GRAPHICS RUN
   1507 C              IRNMRK =  3 ---> GFS RUNS
   1508 C              IRNMRK =  4 ---> RAP (RAPID REFRESH) RUNS {PRIOR TO
   1509 C                               1 MAY 2012 THIS WAS RUC2A (RAPID UPDATE
   1510 C                               CYCLE)}
   1511 C              IRNMRK =  5 ---> GDAS RUNS
   1512 C              IRNMRK =  6 ---> NDAS OR NAM RUNS
   1513 C              IRNMRK =  7 ---> CDAS-REANALYSIS RUNS
   1514 C              IRNMRK =  8 ---> HOURLY (GOES CLOUD DATA) RUNS
   1515 C              IRNMRK =  9 ---> REAL TIME MESOSCALE ANAL (RTMA) RUNS
   1516 C              IRNMRK = 10 ---> UNRESTRICTED MESOSCALE ANAL (URMA) RUNS
   1517 C                                                          (DEFAULT=-99)
   1518 C    SUBSKP - LOGICAL (0:255,0:200) THAT IDENTIFIES THOSE BUFR TYPES/
   1519 C              SUBTYPES FOR WHICH THE BUFR MESSAGES SHOULD BE SKIPPED
   1520 C              OVER (WITHOUT DECODING REPORTS) IF TRUE (DEFAULT=.FALSE.)
   1521 C              (NOTE: THIS IS HONORED ONLY FOR THOSE TYPES/SUBSTYPES NOT
   1522 C                     SPECIFICALLY CONTROLLED BY SUBSEQUENT SWITCHES IN
   1523 C                     THIS NAMELIST (E.G., NEW TYPES/SUBTYPES IN DUMP
   1524 C                     FILES READ BY THIS PROGRAM BUT NOT RECOGNIZED BY
   1525 C                     IT)
   1526 C    WRMISS-  ENCODE SUBSETS WITH NO VALID OBS LEVELS OR BRIGHTNESS
   1527 C             TEMP CHANNELS INTO PREPBUFR FILE IF SUBSET HAS OTHER
   1528 C             ANCILLARY INFORMATION WHICH IS NOT DIRECTLY USED BY
   1529 C             ASSIMILATION BUT MIGHT BE USEFUL FOR VERIFICATION OR
   1530 C             IN OTHER WAYS (E.G., SENSIBLE WEATHER ELEMENTS)?
   1531 C                                                       (DEFAULT=.TRUE.)
   1532 C    SPCIAL - PROCESS "SPECIAL" 25/50 MB LVLS IN GETUPA (NORMALLY FALSE
   1533 C              FOR FOR ALL NETWORKS)?                    (DEFAULT=FALSE)
   1534 C              (NOTE:  ALL SATELLITE RETRIEVAL TYPES NEVER PROCESS)
   1535 C    TDLIM  - IF REPORTED/CALC. DWPT TEMP. IS .LT. THIS VALUE,
   1536 C              MOISTURE IS FLAGGED WITH PREPBUFR TABLE VALUE=15, ALSO
   1537 C                     vvvvv below needs to be verified!! vvvvv
   1538 C              TEMP. PREPBUFR TABLE VALUE IS AT BEST 2, AND VIRT. TEMP.
   1539 C              IS NOT ENCODED IN PREPBUFR FILE {APPLIES TO U-AIR CAT.1-5

Page 28          Source Listing                  PREPOBS_PREPDATA
2017-04-18 11:09                                 prepdata.f

   1540 C              (INCL. ALL SATELLITE RETRIEVAL TYPES EXCEPT RTOVS AND
   1541 C              ATOVS 40-LVL), ALL CAT.6, OR SFC RPTS}   (DEFAULT=215. K)
   1542 C    TDMAX  - IF REPORTED/CALC. DWPT TEMP. IS .GT. THIS VALUE,
   1543 C              MOISTURE IS FLAGGED WITH PREPBUFR TABLE VALUE=15
   1544 C              (APPLIES TO ALL DATA REPORT TYPES)
   1545 C                                    (DEFAULT=999. K, I.E., NOT INVOKED)
   1546 C    MARLND - ALLOW UPPER-AIR OCEAN STN AND SFC MARINE DATA OVER LAND?
   1547 C              MARLND =.TRUE.  ---> PROCESS SUCH REPORTS OVER LAND
   1548 C              MARLND =.FALSE. ---> PROCESS REPORTS OVER LAND
   1549 C                      BUT GIVE ALL VARIABLES A PREPBUFR TBL. VAL. 15
   1550 C                                                        (DEFAULT=FALSE)
   1551 CC
   1552 C    UWINDO - TIME WINDOW (+/-) FOR RAOB & PIBAL REPORTS (IN
   1553 C              HUNDREDTHS OF AN HR) - (MAX IS +/- 12 HRS) (DEFAULT=300.)
   1554 C    PG4243 - ALLOW INDIAN RAOB MASS REPORTS (BLOCK 42,43)?
   1555 C              PG4243 =.FALSE. ---> PROCESS THESE REPORTS
   1556 C              PG4243 =.TRUE.  ---> PROCESS THESE REPORTS BUT
   1557 C                      GIVE ALL MASS VARIABLES A PREPBUFR TBL. VAL. 15
   1558 C                                                       (DEFAULT=.TRUE.)
   1559 C
   1560 C  +++ NEXT 4 SWITCHES CAN APPLY TO UPPER-AIR DATA TYPES OTHER THAN
   1561 C      THAN SATELLITE RETRIEVALS WHICH RESET THESE AS FALSE
   1562 C
   1563 C    FILLZ  - INTERPOLATE HEIGHT TO LEVELS WHERE MISSING (BOTH CAT. 2
   1564 C              LVLS IN 'SMERGE' AND CAT. 3/SPEC. LVLS IN 'WNDBYP') AND
   1565 C              RETAIN CAT. 4/11 OR 15 HEIGHTS IN MASS REPORT (APPLIES
   1566 C              TO ADPUPA, PROFLR AND VADWND)
   1567 C              FILLZ=.TRUE. ---> YES
   1568 C              FILLZ=.FALSE. --> NO  (NORMALLY FOR OUTPUT TO GSI)
   1569 C                                                              (DEFAULT)
   1570 C    FILLW  - INTERPOLATE WINDS TO LEVELS WHERE MISSING (IN 'FILWND')
   1571 C              (APPLIES TO ADPUPA, PROFLR AND VADWND)
   1572 C              FILLW=.TRUE. ---> YES
   1573 C              FILLW=.FALSE. --> NO  (NORMALLY FOR OUTPUT TO GSI)
   1574 C                                                              (DEFAULT)
   1575 C
   1576 C    FILLT  - INTERPOLATE TEMPERATURE TO LEVELS WHERE MISSING (BOTH CAT.
   1577 C              3/SPEC. LVLS IN 'WNDBYP' AND CAT. 4/11 LVLS IN 'WNDBYZ')
   1578 C              (APPLIES TO ADPUPA)
   1579 C              FILLT=.TRUE. ---> YES
   1580 C              FILLT=.FALSE. --> NO  (NORMALLY FOR OUTPUT TO GSI)
   1581 C                                                              (DEFAULT)
   1582 C    FILLM  - INTERPOLATE MOISTURE TO LEVELS WHERE MISSING (IN 'FILDPT')
   1583 C              (APPLIES TO ADPUPA)
   1584 C              FILLM=.TRUE. ---> YES
   1585 C              FILLM=.FALSE. --> NO  (NORMALLY FOR OUTPUT TO GSI)
   1586 C                                                              (DEFAULT)
   1587 C
   1588 C    DWINDO - TIME WINDOW (+/-) FOR DROPWINSONDE REPORTS REPORTS (IN
   1589 C             HUNDREDTHS OF AN HR) - (MAX IS +/- 12 HRS)  (DEFAULT=300.)
   1590 C    RWINDO - TIME WINDOW (+/-) FOR RECONNAISSANCE REPORTS REPORTS (IN
   1591 C             HUNDREDTHS OF AN HR) - (MAX IS +/- 12 HRS)  (DEFAULT=300.)
   1592 C    DROPSN - PROCESS DROPWINSONDE REPORTS?             (DEFAULT=.TRUE.)
   1593 C    RECCON - PROCESS RECONNAISSANCE AIRCRAFT REPORTS?  (DEFAULT=.TRUE.)
   1594 C    RECSLM - PROCESS RECCO CAT. 6 MASS DATA?           (DEFAULT=.TRUE.)
   1595 C    FLDMGS - FLAG MOISTURE DATA ON ALL LEVELS FOR NOAA (P-3 OR GULF
   1596 C              STREAM) DROPS?

Page 29          Source Listing                  PREPOBS_PREPDATA
2017-04-18 11:09                                 prepdata.f

   1597 C              FLDMGS=.TRUE. ---> YES                          (DEFAULT)
   1598 C              FLDMGS=.FALSE. --> NO
   1599 C    FLDMAF - FLAG MOISTURE DATA ON ALL LEVELS FOR USAF DROPS?
   1600 C              FLDMAF=.TRUE. ---> YES                          (DEFAULT)
   1601 C              FLDMAF=.FALSE. --> NO
   1602 C    FLDMFR - FLAG MOISTURE DATA ON ALL LEVELS FOR NON-US (I.E., NON-
   1603 C              NOAA AND NON-USAF) OR UNKNOWN DROPS?
   1604 C              FLDMFR=.TRUE. ---> YES                          (DEFAULT)
   1605 C              FLDMFR=.FALSE. --> NO
   1606 C    KTEMP  -PROCESS MASS PIECE IF TEMP VALID BUT ALL HEIGHTS MISSING
   1607 C             OR BAD?
   1608 C              KTEMP=.TRUE. ---> YES
   1609 C              KTEMP=.FALSE. --> NO (IF WIND VALID,THEN PIBAL) (DEFAULT)
   1610 C              (NOTE: IF HGHT BAD/MSG & KTEMP=T; PIBAL DEFINITION CHGED)
   1611 C    LSWIND - CLASS SOUNDING WIND DATA TYPE SWITCH -
   1612 C       =    0  PROCESS THIS TYPE
   1613 C       = 9999  EXCLUDE THIS TYPE               (DEFAULT - LSWIND/9999/)
   1614 C    LSMASS - CLASS SOUNDING MASS DATA TYPE SWITCH -
   1615 C       =    0  PROCESS THIS TYPE
   1616 C       = 9999  EXCLUDE THIS TYPE               (DEFAULT - LSMASS/9999/)
   1617 C    CWINDO - TIME WINDOW (+/-) FOR CLASS SOUNDING REPORTS (IN
   1618 C              HUNDREDTHS OF AN HR) - (MAX IS +/- 12 HRS) (DEFAULT=300.)
   1619 CC
   1620 C  N O T E -- THE FOLLOWING (2,9) ARRAY REFERS TO THE 2 GEOGRAPHICAL
   1621 C              REGIONS & THE 9 AIRCRAFT FLIGHT LVL REPORT TYPES POSSIBLE
   1622 C                ** THE FIRST ELEMENT IDENTIFIED AS FOLLOWS:
   1623 C                     1 - OUTSIDE THE CONUS REGION
   1624 C                     2 - INSIDE THE CONUS REGION
   1625 C                ** THE SECOND ELEMENT IDENTIFIED AS FOLLOWS:
   1626 C                     1 - AIREP/PIREP FORMAT REPORTS (HEREAFTER CALLED
   1627 C                         "AIREP/PIREP" REPORTS FOR SIMPLICITY)
   1628 C                     2 - AMDAR REPORTS ORIGINALLY IN AMDAR FORMAT
   1629 C                         (HEREAFTER CALLED "AMDAR" REPORTS FOR
   1630 C                         SIMPLICITY)
   1631 C                     3 - EUROPEAN AMDAR REPORTS ORIGINALLY IN BUFR
   1632 C                         (HEREAFTER CALLED "EAMDAR" REPORTS FOR
   1633 C                         SIMPLICITY)
   1634 C                     4 - U.S. AMDAR (MDCRS) REPORTS ORIGINALLY IN BUFR
   1635 C                         (HEREAFTER CALLED "MDCRS" REPORTS FOR
   1636 C                         SIMPLICITY)
   1637 C                     5 - TAMDAR (TROPOSPHERIC AIRBORNE METEOROLOGICAL
   1638 C                         DATA REPORT) REPORTS FROM GSD MADIS FEED
   1639 C                         ORIGINALLY IN NetCDF FORMAT (HEREAFTER REFERRED
   1640 C                         TO AS "TAMDARM" REPORTS)
   1641 C                     6 - CANADIAN AMDAR REPORTS ORIGINALLY IN BUFR
   1642 C                         FORMAT (HEREAFTER CALLED CAMDAR" REPORTS FOR
   1643 C                         SIMPLICITY)
   1644 C                     7 - KOREAN AMDAR REPORTS ORIGINALLY IN BUFR FORMAT
   1645 C                         (HEREAFTER CALLED "KAMDAR" REPORTS FOR
   1646 C                         SIMPLICITY)
   1647 C                     8 - OTHER-THAN-ABOVE AMDAR REPORTS ORIGINALLY IN
   1648 C                         BUFR FORMAT (HEREAFTER CALLED "AMDARB" REPORTS
   1649 C                         FOR SIMPLICITY)
   1650 C                     9 - TAMDAR REPORTS ORIGINALLY IN BUFR FORMAT {FROM
   1651 C                         PANASONIC (nee AirDAT), HEREAFTER REFERRED TO
   1652 C                         AS "TAMDARB" REPORTS)
   1653 CC

Page 30          Source Listing                  PREPOBS_PREPDATA
2017-04-18 11:09                                 prepdata.f

   1654 C    AWINDO - TIME WINDOW (+/-) FOR ACFT RPTS (IN HUNDREDTHS OF AN HR)
   1655 C             - (MAX IS +/- 12 HRS)
   1656 C                         (DEFAULT - AWINDO(2,9)/6*325.,2*325.,10*325./)
   1657 CC
   1658 C    PHIACF - BOUNDARIES OF 6 LATITUDE BANDS FOR AIRCRAFT DATA
   1659 C                   (DEFAULT - PHIACF(7)/-90.,-70.,-20.,0.,20.,70.,90./)
   1660 C  N O T E -- THE FOLLOWING (6,9) ARRAYS REFER TO THE 6 LATITUDE
   1661 C              BANDS IN PHIACF (1ST ELEMENT) AND THE 9 ACFT FLIGHT LVL
   1662 C              RPT TYPES POSSIBLE (SEE SECOND ELEMENT DEFINITION ABOVE)
   1663 CC
   1664 C    AIRLND - ALLOW AIRCRAFT FLIGHT LEVEL DATA OVER LAND?
   1665 C              AIRLND =.TRUE.  ---> PROCESS REPORTS OVER LAND
   1666 C              AIRLND =.FALSE. ---> PROCESS REPORTS OVER LAND
   1667 C                      BUT GIVE ALL VARIABLES A PREPBUFR TBL. VAL. 15
   1668 C                                     (DEFAULT - AIRLND(6,9)/54*.TRUE./)
   1669 C    JAWIND - AIRCRAFT FLIGHT LEVEL WIND DATA TYPE SWITCH -
   1670 C       =    0  PROCESS THIS TYPE          (DEFAULT - JAWIND(6,9)/54*0/)
   1671 C       = 9999  EXCLUDE THIS TYPE
   1672 C    JAMASS - AIRCRAFT FLIGHT LEVEL MASS DATA TYPE SWITCH -
   1673 C       =    0  PROCESS THIS TYPE          (DEFAULT - JAMASS(6,9)/54*0/)
   1674 C       = 9999  EXCLUDE THIS TYPE
   1675 CC
   1676 C  N O T E -- THE FOLLOWING ARRAYS REFER TO THE 9 ACFT FLIGHT LEVEL
   1677 C              REPORT TYPES POSSIBLE (SEE DEFINITION ABOVE)
   1678 CC
   1679 C    IACFTL - LOWEST ALTITUDE (METERS) FOR WHICH ACFT DATA WILL BE
   1680 C              PROCESSED (BELOW THIS LEVEL ALL VARIABLES GET
   1681 C              PREPBUFR TBL. VAL. 15)   (DEFAULT - IACFTL(9)/100,8*-200)
   1682 C              (NOTE:  100 METERS IS  328 FEET)
   1683 C                     2286 METERS IS 7500 FEET)
   1684 C    IACFTH - HIGHEST ALTITUDE (METERS) FOR WHICH ACFT DATA WILL BE
   1685 C              PROCESSED (ABOVE THIS LEVEL ALL VARIABLES GET
   1686 C              PREPBUFR TBL. VAL. 15)
   1687 C                      (DEFAULT - IACFTH(9)/3*18000,16500,4*18000,16500)
   1688 C              (NOTE: 16500 METERS IS APPROXIMATELY  95 MB)
   1689 C                     18000 METERS IS APPROXIMATELY  75 MB)
   1690 C    AIFNOW - PROCESS ACFT FLIGHT LEVEL MASS REPORT "PIECE" IF WIND
   1691 C              DATA ARE MISSING (WIND RPT "PIECE" IS TOSSED)?
   1692 C              AIFNOW =.TRUE.  ---> PROCESS MASS REPORTS
   1693 C              AIFNOW =.FALSE. ---> PROCESS MASS REPORTS BUT GIVE
   1694 C                      ALL VARIABLES A PREPBUFR TBL. VAL. OF 15
   1695 C                                         (DEFAULT - AIFNOW(9)/9*.TRUE.)
   1696 C    FLACMS - FLAG AIRCRAFT MOISTURE (SET SPEC. HUMIDITY Q.M. TO 15)?
   1697 C              FLACMS =.TRUE.  ---> YES  (DEFAULT - FLACMS(9)/9*.TRUE./)
   1698 C              FLACMS =.FALSE. ---> NO
   1699 C          N O T E:  CURRENTLY ONLY MDCRS, EAMDAR AND TAMDAR(M/B)
   1700 C                    REPORTS HAVE MOISTURE
   1701 CC
   1702 C    PHISWN - BOUNDARIES OF 6 LAT. BANDS FOR SATELLITE (WIND) DATA
   1703 C                   (DEFAULT - PHISWN(7)/-90.,-70.,-20.,0.,20.,70.,90./)
   1704 C  N O T E -- THE FOLLOWING (6,8,10) ARRAYS REFER TO THE 6 LATITUDE
   1705 C              BANDS IN PHISWN (1ST ELEMENT), 8 PRODUCERS/SATELLITES
   1706 C              (2ND ELEMENT), AND 10 PRODUCTS (3RD ELEMENT)
   1707 C                ** THE SECOND ELEMENT IDENTIFIED AS FOLLOWS:
   1708 C                     1 - USA/NOAA/NESDIS / ODD  NUMBER GOES SATELLITE
   1709 C                     2 - USA/NOAA/NESDIS / EVEN NUMBER GOES SATELLITE
   1710 C                     3 - INDIA / ALL INSAT/KALPANA SATELLITES

Page 31          Source Listing                  PREPOBS_PREPDATA
2017-04-18 11:09                                 prepdata.f

   1711 C                     4 - JAPAN / ALL GMS/MTSAT SATELLITES, OR GOES-09
   1712 C                                 (IF GOES-09, STILL REFERRED TO AS GMS
   1713 C                                  IN THIS PROGRAM)
   1714 C                     5 - EUMETSAT / ODD  NUMBER METEOSAT SATELLITE
   1715 C                     6 - EUMETSAT / EVEN NUMBER METEOSAT SATELLITE
   1716 C                     7 - NASA/MODIS / AQUA SATELLITE
   1717 C                     8 - NASA/MODIS / TERRA SATELLITE
   1718 C                           (NOTE: 1-6 ARE GEOSTATIONARY SATELLITES,
   1719 C                                  7-8 ARE POLAR-ORBITING SATELLITES)
   1720 C                ** THE THIRD ELEMENT IDENTIFIED AS FOLLOWS:
   1721 C                     1 - CONVENTIONAL IR (LONG-WAVE) CLOUD-DRIFT WINDS/
   1722 C                         TEMPERATURE
   1723 C                     2 - CONVENTIONAL IMAGER WATER-VAPOR WINDS (DEEP-
   1724 C                         LAYER AND CLOUD TOP) (NO TEMPERATURE)
   1725 C                     3 - CONVENTIONAL VISIBLE CLOUD-DRIFT WINDS/TEMP
   1726 C                     4 - HIGH-DENSITY IMAGER IR (LONG-WAVE) CLOUD-
   1727 C                         DRIFT WINDS/TEMPERATURE
   1728 C                     5 - HIGH-DENSITY VIS CLOUD-DRIFT WINDS/TEMPERATURE
   1729 C                     6 - HIGH-DENSITY IMAGER CLOUD-TOP WATER VAPOR
   1730 C                         WINDS/TEMPERATURE
   1731 C                     7 - HIGH-DENSITY IMAGER DEEP-LAYER WATER VAPOR
   1732 C                         WINDS/TEMPERATURE
   1733 C                     8 - HIGH-DENSITY SOUNDER CLOUD-TOP WATER VAPOR
   1734 C                         WINDS/TEMPERATURE
   1735 C                     9 - HIGH-DENSITY SOUNDER DEEP-LAYER WATER VAPOR
   1736 C                         WINDS/TEMPERATURE
   1737 C                    10 - PICTURE TRIPLET CLOUD-DRIFT WINDS/TEMPERATURE
   1738 CC
   1739 C    SWINDO_e - EARLIEST TIME WINDOW FOR SAT. RPTS (RELATIVE TO CYCLE
   1740 C                TIME, "-" IS PRIOR, "+" IS AFTER; IN HUNDREDTHS OF AN
   1741 C                HR; MAXIMUM IS +/- 12 HOURS)
   1742 C     (DEF- SWINDO_e(6,8,10)/12*-300.,6*-700.,6*-300.,12*-300.,12*-300.,
   1743 C                            12*-300.,6*-700.,6*-300.,12*-300.,12*-300.,
   1744 C                            12*-300.,6*-700.,6*-300.,12*-300.,12*-300.,
   1745 C                            336*-300./)
   1746 C    SWINDO_l - LATEST TIME WINDOW FOR SAT. RPTS (RELATIVE TO CYCLE
   1747 C                TIME, "-" IS PRIOR, "+" IS AFTER; IN HUNDREDTHS OF AN
   1748 C                HR; MAXIMUM IS +/- 12 HOURS)
   1749 C     (DEF- SWINDO_l(6,8,10)/12*+300.,6*+700.,6*+300.,12*+300.,12*+300.,
   1750 C                            12*+300.,6*+700.,6*+300.,12*+300.,12*+300.,
   1751 C                            12*+300.,6*+700.,6*+300.,12*+300.,12*+300.,
   1752 C                            336*+300./)
   1753 C    SWNLND - ALLOW SATELLITE REPORTS DATA OVER LAND?
   1754 C              SWNLND =.TRUE.  ---> PROCESS REPORTS OVER LAND
   1755 C              SWNLND =.FALSE. ---> PROCESS REPORTS OVER LAND
   1756 C                      BUT GIVE ALL VARIABLES A PREPBUFR TBL. VAL. 15
   1757 C                                 (DEFAULT - SWNLND(6,8,10)/480*.TRUE./)
   1758 C    JSWIND - SATELLITE WIND REPORT SUB-TYPE SWITCH -
   1759 C       =    0  PROCESS THIS TYPE
   1760 C       =   99  PROCESS THIS TYPE BUT GIVE ALL VARIABLES A PREPBUFR
   1761 C                 TABLE VALUE OF 15 SO REPORT ISN'T USED BY ANALYSIS
   1762 C       =  199  PROCESS THIS TYPE IF GOES-ODD SATELLITE AND SAT. NO.
   1763 C                 IS 253, 257, ... (PREFIX CHAR. 'C' IN STNID); GIVE
   1764 C                 ALL VARIABLES A PREPBUFR TABLE VALUE 15 IF GOES-ODD
   1765 C                 SATELLITE AND SAT. NO. IS 251, 255, ... (PREFIX CHAR.
   1766 C                 'A' IN STNID)  --> APPLIES TO 2'ND ELEM. =1 ONLY
   1767 C                                 -- OR --

Page 32          Source Listing                  PREPOBS_PREPDATA
2017-04-18 11:09                                 prepdata.f

   1768 C               PROCESS THIS TYPE IF GOES-EVEN SATELLITE AND SAT. NO.
   1769 C                 IS 250, 254, ... (PREFIX CHAR. 'D' IN STNID); GIVE
   1770 C                 ALL VARIABLES A PREPBUFR TABLE VALUE 15 IF GOES-EVEN
   1771 C                 SATELLITE AND SAT. NO. IS 252, 256, ... (PREFIX CHAR.
   1772 C                 'B' IN STNID)  --> APPLIES TO 2'ND ELEM. =2 ONLY
   1773 C                                 -- OR --
   1774 C               PROCESS THIS TYPE IF METEOSAT-ODD SATELLITE AND SAT.
   1775 C                 NO. IS 53, 57, ... (PREFIX CHAR. 'Y' IN STNID); GIVE
   1776 C                 ALL VARIABLES A PREPBUFR TABLE VALUE 15 IF METEOSAT-
   1777 C                 ODD SATELLITE AND SAT. NO. IS 51, 55, ... (PREFIX
   1778 C                  CHAR. 'W' IN STNID) -->  APPLIES TO 2'ND ELEM. =5
   1779 C                  ONLY
   1780 C                                 -- OR --
   1781 C               PROCESS THIS TYPE IF METEOSAT-EVEN SATELLITE AND SAT.
   1782 C                 NO. IS 50, 54, ... (PREFIX CHAR. 'Z' IN STNID); GIVE
   1783 C                 ALL VARIABLES A PREPBUFR TABLE VALUE 15 IF METEOSAT-
   1784 C                 EVEN SATELLITE AND SAT. NO. IS 52, 56, ... (PREFIX
   1785 C                  CHAR. 'X' IN STNID) -->  APPLIES TO 2'ND ELEM. =6
   1786 C                  ONLY
   1787 C       =  299  PROCESS THIS TYPE IF GOES-ODD SATELLITE AND SAT. NO.
   1788 C                 IS 251, 255, ... (PREFIX CHAR. 'A' IN STNID); GIVE
   1789 C                 ALL VARIABLES A PREPBUFR TABLE VALUE 15 IF GOES-ODD
   1790 C                 SATELLITE AND SAT. NO. IS 253, 257, ... (PREFIX CHAR.
   1791 C                 'C' IN STNID)  --> APPLIES TO 2'ND ELEM. =1 ONLY
   1792 C                                 -- OR --
   1793 C               PROCESS THIS TYPE IF GOES-EVEN SATELLITE AND SAT. NO.
   1794 C                 IS 252, 256, ... (PREFIX CHAR. 'B' IN STNID); GIVE
   1795 C                 ALL VARIABLES A PREPBUFR TABLE VALUE 15 IF GOES-EVEN
   1796 C                 SATELLITE AND SAT. NO. IS 250, 254 ... (PREFIX CHAR.
   1797 C                 'D' IN STNID)  --> APPLIES TO 2'ND ELEM. =2 ONLY
   1798 C                                 -- OR --
   1799 C               PROCESS THIS TYPE IF METEOSAT-ODD SATELLITE AND SAT.
   1800 C                 NO. IS 51, 55, ... (PREFIX CHAR. 'W' IN STNID); GIVE
   1801 C                 ALL VARIABLES A PREPBUFR TABLE VALUE 15 IF METEOSAT-
   1802 C                 ODD SATELLITE AND SAT. NO. IS 53, 57, ... (PREFIX
   1803 C                  CHAR. 'Y' IN STNID) -->  APPLIES TO 2'ND ELEM. =5
   1804 C                  ONLY
   1805 C                                 -- OR --
   1806 C               PROCESS THIS TYPE IF METEOSAT-EVEN SATELLITE AND SAT.
   1807 C                 NO. IS 52, 56, ... (PREFIX CHAR. 'X' IN STNID); GIVE
   1808 C                 ALL VARIABLES A PREPBUFR TABLE VALUE 15 IF METEOSAT-
   1809 C                 EVEN SATELLITE AND SAT. NO. IS 50, 54, ... (PREFIX
   1810 C                  CHAR. 'Z' IN STNID) -->  APPLIES TO 2'ND ELEM. =6
   1811 C                  ONLY
   1812 C       = 9999  EXCLUDE THIS TYPE
   1813 C    {NOTE: JSWIND SHOULD ALWAYS BE SET TO 9999 FOR ALL TYPES EXCEPT:
   1814 C                JSWIND(X,Y, 1) WHERE X=1-6; Y=3-6      AND
   1815 C                JSWIND(X,Y, 2) WHERE X=1-6; Y=3-6      AND
   1816 C                JSWIND(X,Y, 3) WHERE X=1-6; Y=3-6      AND
   1817 C                JSWIND(X,Y, 4) WHERE X=1-6; Y=1-2, 7-8 AND
   1818 C                JSWIND(X,Y, 5) WHERE X=1-6; Y=1-2      AND
   1819 C                JSWIND(X,Y, 6) WHERE X=1-6; Y=1-2, 7-8 AND
   1820 C                JSWIND(X,Y, 7) WHERE X=1-6; Y=1-2, 7-8 AND
   1821 C                JSWIND(X,Y, 8) WHERE X=1-6; Y=1-2      AND
   1822 C                JSWIND(X,Y, 9) WHERE X=1-6; Y=1-2      AND
   1823 C                JSWIND(X,Y,10) WHERE X=1-6; Y=1-2}
   1824 C    {NOTE: FOR JSWIND(X,Y,Z) = 99, 199, 299, JSMASS(X,Y,Z) MUST EITHER

Page 33          Source Listing                  PREPOBS_PREPDATA
2017-04-18 11:09                                 prepdata.f

   1825 C           BE 9999 OR BE THE SAME AS JSWIND(X,Y,Z) !!!}
   1826 C           (DEF- JSWIND(6,8,10)/12*9999,6*9999,6*0,12*0,12*9999,
   1827 C                                12*9999,6*9999,6*9999,12*9999,12*9999,
   1828 C                                12*9999,6*9999,6*0,12*0,12*9999,
   1829 C                                12*0,6*9999,6*9999,12*9999,12*9999,
   1830 C                                12*9999,6*9999,6*9999,12*9999,12*9999,
   1831 C                                12*0,6*9999,6*9999,12*9999,12*9999,
   1832 C                                12*9999,6*9999,6*9999,12*9999,12*9999,
   1833 C                                12*9999,6*9999,6*9999,12*9999,12*9999,
   1834 C                                12*9999,6*9999,6*9999,12*9999,12*9999,
   1835 C                                12*9999,6*9999,6*9999,12*9999,12*9999/)
   1836 C    JSMASS - SATELLITE MASS REPORT SUB-TYPE SWITCH -
   1837 C       =    0  PROCESS THIS TYPE
   1838 C       =   99  PROCESS THIS TYPE BUT GIVE ALL VARIABLES A PREPBUFR
   1839 C                 TABLE VALUE OF 15 SO REPORT ISN'T USED BY ANALYSIS
   1840 C       =  199  PROCESS THIS TYPE IF GOES-ODD SATELLITE AND SAT. NO.
   1841 C                 IS 253, 257, ... (PREFIX CHAR. 'C' IN STNID); GIVE
   1842 C                 ALL VARIABLES A PREPBUFR TABLE VALUE 15 IF GOES-ODD
   1843 C                 SATELLITE AND SAT. NO. IS 251, 255, ... (PREFIX CHAR.
   1844 C                 'A' IN STNID)  --> APPLIES TO 2'ND ELEM. =1 ONLY
   1845 C                                 -- OR --
   1846 C               PROCESS THIS TYPE IF GOES-EVEN SATELLITE AND SAT. NO.
   1847 C                 IS 250, 254, ... (PREFIX CHAR. 'D' IN STNID); GIVE
   1848 C                 ALL VARIABLES A PREPBUFR TABLE VALUE 15 IF GOES-EVEN
   1849 C                 SATELLITE AND SAT. NO. IS 252, 256, ... (PREFIX CHAR.
   1850 C                 'B' IN STNID)  --> APPLIES TO 2'ND ELEM. =2 ONLY
   1851 C                                 -- OR --
   1852 C               PROCESS THIS TYPE IF METEOSAT-ODD SATELLITE AND SAT.
   1853 C                 NO. IS 53, 57, ... (PREFIX CHAR. 'Y' IN STNID); GIVE
   1854 C                 ALL VARIABLES A PREPBUFR TABLE VALUE 15 IF METEOSAT-
   1855 C                 ODD SATELLITE AND SAT. NO. IS 51, 55, ... (PREFIX
   1856 C                  CHAR. 'W' IN STNID) -->  APPLIES TO 2'ND ELEM. =5
   1857 C                  ONLY
   1858 C                                 -- OR --
   1859 C               PROCESS THIS TYPE IF METEOSAT-EVEN SATELLITE AND SAT.
   1860 C                 NO. IS 50, 54, ... (PREFIX CHAR. 'Z' IN STNID); GIVE
   1861 C                 ALL VARIABLES A PREPBUFR TABLE VALUE 15 IF METEOSAT-
   1862 C                 EVEN SATELLITE AND SAT. NO. IS 52, 56, ... (PREFIX
   1863 C                  CHAR. 'X' IN STNID) -->  APPLIES TO 2'ND ELEM. =6
   1864 C                  ONLY
   1865 C       =  299  PROCESS THIS TYPE IF GOES-ODD SATELLITE AND SAT. NO.
   1866 C                 IS 251, 255, ... (PREFIX CHAR. 'A' IN STNID); GIVE
   1867 C                 ALL VARIABLES A PREPBUFR TABLE VALUE 15 IF GOES-ODD
   1868 C                 SATELLITE AND SAT. NO. IS 253, 257, ... (PREFIX CHAR.
   1869 C                 'C' IN STNID)  --> APPLIES TO 2'ND ELEM. =1 ONLY
   1870 C                                 -- OR --
   1871 C               PROCESS THIS TYPE IF GOES-EVEN SATELLITE AND SAT. NO.
   1872 C                 IS 252, 256, ... (PREFIX CHAR. 'B' IN STNID); GIVE
   1873 C                 ALL VARIABLES A PREPBUFR TABLE VALUE 15 IF GOES-EVEN
   1874 C                 SATELLITE AND SAT. NO. IS 250, 254 ... (PREFIX CHAR.
   1875 C                 'D' IN STNID)  --> APPLIES TO 2'ND ELEM. =2 ONLY
   1876 C                                 -- OR --
   1877 C               PROCESS THIS TYPE IF METEOSAT-ODD SATELLITE AND SAT.
   1878 C                 NO. IS 51, 55, ... (PREFIX CHAR. 'W' IN STNID); GIVE
   1879 C                 ALL VARIABLES A PREPBUFR TABLE VALUE 15 IF METEOSAT-
   1880 C                 ODD SATELLITE AND SAT. NO. IS 53, 57, ... (PREFIX
   1881 C                  CHAR. 'Y' IN STNID) -->  APPLIES TO 2'ND ELEM. =5

Page 34          Source Listing                  PREPOBS_PREPDATA
2017-04-18 11:09                                 prepdata.f

   1882 C                  ONLY
   1883 C                                 -- OR --
   1884 C               PROCESS THIS TYPE IF METEOSAT-EVEN SATELLITE AND SAT.
   1885 C                 NO. IS 52, 56, ... (PREFIX CHAR. 'X' IN STNID); GIVE
   1886 C                 ALL VARIABLES A PREPBUFR TABLE VALUE 15 IF METEOSAT-
   1887 C                 EVEN SATELLITE AND SAT. NO. IS 50, 54, ... (PREFIX
   1888 C                  CHAR. 'Z' IN STNID) -->  APPLIES TO 2'ND ELEM. =6
   1889 C                  ONLY
   1890 C       = 9999  EXCLUDE THIS TYPE
   1891 C    {NOTE: JSMASS SHOULD ALWAYS BE SET TO 9999 FOR ALL TYPES EXCEPT:
   1892 C                JSMASS(X,Y, 1) WHERE X=1-6; Y=3-6      AND
   1893 C                JSMASS(X,Y, 3) WHERE X=1-6; Y=3-6      AND
   1894 C                JSMASS(X,Y, 4) WHERE X=1-6; Y=1-2      AND
   1895 C                JSMASS(X,Y, 5) WHERE X=1-6; Y=1-2      AND
   1896 C                JSMASS(X,Y, 6) WHERE X=1-6; Y=1-2      AND
   1897 C                JSMASS(X,Y, 7) WHERE X=1-6; Y=1-2      AND
   1898 C                JSMASS(X,Y, 8) WHERE X=1-6; Y=1-2      AND
   1899 C                JSMASS(X,Y, 9) WHERE X=1-6; Y=1-2}
   1900 C    {NOTE: FOR JSMASS(X,Y,Z) = 99, 199, 299, JSWIND(X,Y,Z) MUST EITHER
   1901 C           BE 9999 OR BE THE SAME AS JSMASS(X,Y,Z) !!!}
   1902 C                                        (DEF- JSMASS(6,8,10)/480*9999/)
   1903 C
   1904 CC
   1905 C  N O T E -- THE FOLLOWING 4-WORD ARRAYS REFER TO THE 4 WIND PROFILER
   1906 C              REPORT TYPES POSSIBLE
   1907 C                     1 - NOAA PROFILER NETWORK (NPN)
   1908 C                     2 - PROFILERS ORIGINATING FROM PILOT (PIBAL)
   1909 C                         FORMAT BULLETINS
   1910 C                     3 - COOPERATIVE AGENCY PROFILERS (INCL. NOAA BLP)
   1911 C                     4 - JAPANESE METEOR. AGENCY (JMA) PROFILERS
   1912 CC
   1913 C    PWINDO - TIME WINDOW (+/-) FOR WIND PROFILER REPORTS (IN
   1914 C              HUNDREDTHS OF AN HR) - (MAX IS +/- 12 HRS)   (DEF=4*300.)
   1915 C    PRFLER - PROCESS WIND PROFILER REPORTS?          (DEFAULT=4*.TRUE.)
   1916 CC
   1917 C    VWINDO - TIME WINDOW (+/-) FOR VAD WIND REPORTS (IN HUNDREDTHS OF
   1918 C              AN HR) - (MAX IS +/- 12 HRS)               (DEFAULT=300.)
   1919 C    IVADFL - LOWEST VAD WIND CONFIDENCE LEVEL FOR WHICH WIND ON
   1920 C             LEVEL WILL BE GIVEN A QUALITY MARK OF 13 (BAD) (DEFAULT=5)
   1921 C             (SEE SUBROUTINE W3UNPKB7 FOR DEF'N OF "CONFIDENCE LEVEL")
   1922 C             (NOTE: WINDS WITH C.L. .GE. IVADFL ARE GIVEN BAD Q.M.)
   1923 C    IVADSP - LOWEST VAD WIND CONFIDENCE LEVEL FOR WHICH WIND ON
   1924 C             LEVEL WILL BE GIVEN A QUALITY MARK OF 3 (SUSPECT)  (DEF=2)
   1925 C             (SEE SUBROUTINE W3UNPKB7 FOR DEF'N OF "CONFIDENCE LEVEL")
   1926 C             (NOTE: WINDS WITH C.L. .GE. IVADSP ARE GIVEN SUSPECT
   1927 C                    Q.M. UP TO VALUE OF IVADFL, AFTER WHICH WINDS ARE
   1928 C                    GIVEN A BAD Q.M.)
   1929 C             IMPORTANT: IVADSP MUST ALWAYS BE .LE. IVADFL
   1930 C    VADWIN - PROCESS VAD (NEXRAD) WIND REPORTS?       (DEFAULT=.FALSE.)
   1931 CC
   1932 C    TWINDO - TIME WINDOW (+/-) FOR RASS REPORTS (IN HUNDREDTHS OF AN
   1933 C              HR) - (MAX IS +/- 12 HRS)                  (DEFAULT=300.)
   1934 C    RASS   - PROCESS RASS TEMPERATURE REPORTS?        (DEFAULT=.FALSE.)
   1935 CC
   1936 CC
   1937 C  N O T E -- THE FOLLOWING 2-WORD ARRAYS (TOVEDS AND TOVBFR) REFER TO
   1938 C              RTOVS (1) AND ATOVS (2) DATA

Page 35          Source Listing                  PREPOBS_PREPDATA
2017-04-18 11:09                                 prepdata.f

   1939 CC
   1940 C    TOVEDS - PROCESS RTOVS OR ATOVS RETRIEVAL REPORTS (NO RADIANCES)
   1941 C              RETURNED IN UNPACKED NMCEDS FORMAT?    (DEFAULT=2*.TRUE.)
   1942 C    TOVBFR - PROCESS RTOVS OR ATOVS RADIANCES AND/OR 40-LVL RETRIEVAL
   1943 C              RPTS (SEE TOVRAD & TOVRTV BELOW)?     (DEFAULT=2*.FALSE.)
   1944 C    (NOTE: TOVEDS(I) AND TOVBFR(I) SHOULD  N E V E R  BOTH BE TRUE
   1945 C            REGARDLESS OF THE VALUE FOR "I")
   1946 C                  --  GIVEN THAT TOVBFR(I) = TRUE --
   1947 CC
   1948 C    TOVRAD - PROCESS RTOVS OR ATOVS RADIANCES FROM RPTS?  (DEF=.FALSE.)
   1949 C    TOVRTV - PROCESS RTOVS OR ATOVS 40-LEVEL RETRIEVALS FROM RPTS?
   1950 C                                                      (DEFAULT=.FALSE.)
   1951 C    TR80KM - RESOLUTION FOR RTOVS OR ATOVS REPORTS (ALL TYPES)
   1952 C              TR80KM =.TRUE.  --->  80 KM RTOVS/40 KM ATOVS (FULL
   1953 C                                    RESOLUTION)
   1954 C              TR80KM =.FALSE. ---> 250 KM                     (DEFAULT)
   1955 C             (NOTE: FOR RTOVS THIS IS DETERMINED BY A FILTER FLAG
   1956 C                    WHERE GOOD IS 250KM RESOLUTION AND GOOD+REDUNDANT
   1957 C                    IS 80KM RESOLUTION; FOR ATOVS 250KM RESOLUTION IS
   1958 C                    ESTIMATED BY SAMPLING EVERY 11'TH RETRIEVAL)
   1959 CC
   1960 C  N O T E -- THE FOLLOWING 2-WORD ARRAYS (GOESND, GOESPW, GOESRD AND
   1961 C              GOESCT) REFER TO LOW-RESOLUTION (5x5 FOV) AND HIGH-
   1962 C              RESOLUTION (1x1) DATA
   1963 CC
   1964 C    GOESND - PROCESS GOES SOUNDING (PROFILE) RPTS?  (DEFAULT=2*.FALSE.)
   1965 C    GOESPW - PROCESS GOES PRECIPITABLE WATER RPTS?  (DEFAULT=2*.FALSE.)
   1966 C    GOESRD - PROCESS GOES RADIANCE REPORTS          (DEFAULT=2*.FALSE.)
   1967 C    GOESCT - PROCESS GOES CLOUD TOP REPORTS?        (DEFAULT=2*.FALSE.)
   1968 CC
   1969 C    PHI    - BOUNDARIES OF 5 LAT BANDS FOR SATELLITE RADIANCE/RETR DATA
   1970 C                         (DEFAULT - PHI(6)/-90.,-70.,-20.,20.,74.,90./)
   1971 CC
   1972 C  N O T E -- THE FOLLOWING (5,4,4) ARRAYS REFER TO THE 5 LATITUDE
   1973 C              BANDS IN PHI (1ST ELEMENT), 4 SATELLITES (2ND ELEMENT),
   1974 C              AND 4 TYPES (3RD ELEMENT)
   1975 C       ** THE SECOND ELEMENT IDENTIFIED AS FOLLOWS:
   1976 C           1 - EVEN NUMBERED NOAA SATELLITE (FOR 3RD ELEM.=1)
   1977 C                             -- OR --
   1978 C               EVEN-1 NUMBERED GOES SATELLITE (FOR 3RD ELEM.=2,4)
   1979 C                {E.G., GOES-04(248), GOES-08(252), GOES-12(256), ... }
   1980 C                (SUFFIX CHARACTERS "I", "J" OR "K")
   1981 C           2 - ODD  NUMBERED NOAA SATELLITE (FOR 3RD ELEM.=1)
   1982 C                             -- OR --
   1983 C               ODD-1  NUMBERED GOES SATELLITE (FOR 3RD ELEM.=2,4)
   1984 C                {E.G., GOES-09(253), GOES-13(257), ... }
   1985 C                (SUFFIX CHARACTERS "L", "M" OR "N")
   1986 C           3 - EVEN-2 NUMBERED GOES SATELLITE (FOR 3RD ELEM.=2,4)
   1987 C                {E.G., GOES-06(250), GOES-10(254), GOES-14(258), ... }
   1988 C                (SUFFIX CHARACTERS "O", "P" OR "S")
   1989 C                (NOTE: DOES NOT APPLY FOR 3RD ELEM.=1)
   1990 C           4 - ODD-2  NUMBERED GOES SATELLITE (FOR 3RD ELEM.=2,4)
   1991 C                {E.G., GOES-07(251), GOES-11(255), GOES-15(259), ... }
   1992 C                (SUFFIX CHARACTERS "Q", "R" OR "T")
   1993 C                (NOTE: DOES NOT APPLY FOR 3RD ELEM.=1)
   1994 C       ** THE THIRD ELEMENT IDENTIFIED AS FOLLOWS:
   1995 C           1 - RTOVS/ATOVS SOUNDINGS/RADIANCES

Page 36          Source Listing                  PREPOBS_PREPDATA
2017-04-18 11:09                                 prepdata.f

   1996 C           2 - GOES SOUNDINGS/RADIANCES
   1997 C           3 - GOES PW RETRIEVALS
   1998 C           4 - GOES CLOUD TOP RETRIEVALS
   1999 C
   2000 CC
   2001 C    IWINDO_e - EARLIEST TIME WINDOW FOR SATELLITE RADIANCES/RETRIEVALS
   2002 C                (RELATIVE TO CYCLE TIME, "-" IS PRIOR, "+" IS AFTER)
   2003 C               -- FOR RTOVS OR ATOVS IN WHOLE HOURS
   2004 C               -- FOR GOES IN HOURS TIMES 100
   2005 C                (MAXIMUM IS +/- 12 HOURS)
   2006 C                              (DEFAULT- IWINDO_e(5,4,4)/20*-3,60*-300/)
   2007 C    IWINDO_l - LATEST TIME WINDOW FOR SATELLITE RADIANCES/RETRIEVALS
   2008 C                (RELATIVE TO CYCLE TIME, "-" IS PRIOR, "+" IS AFTER)
   2009 C               -- FOR RTOVS OR ATOVS IN WHOLE HOURS
   2010 C               -- FOR GOES IN HOURS TIMES 100
   2011 C                (MAXIMUM IS +/- 12 HOURS)
   2012 C                              (DEFAULT- IWINDO_l(5,4,4)/20*+3,60*+300/)
   2013 C    SATMST - PROCESS MOISTURE INFORMATION IN A SOUNDING?
   2014 C              SATMST =.TRUE.  ---> PROCESS MOISTURE INFORMATION
   2015 C              SATMST =.FALSE. ---> EXCLUDE MOISTURE INFORMATION
   2016 C                                  (DEFAULT - SATMST(5,4,4)/80*.FALSE./)
   2017 C              (NOTE: APPLIES ONLY TO THIRD ELEMENT = 1,2)
   2018 C    ISATLS - SATELLITE RADIANCE/RETRIEVAL REPORT LAND/SEA SWITCH
   2019 C              ISATLS =     0 ---> PROCESS REPORTS OVER LAND AND OCEAN
   2020 C              ISATLS =     1 ---> PROCESS REPORTS OVER LAND ONLY
   2021 C              ISATLS =     2 ---> PROCESS REPORTS OVER OCEAN ONLY
   2022 C                                        (DEFAULT - ISATLS(5,4,4)/80*2/)
   2023 C              (NOTE: IMPORTANT: ANY TYPE NOT PROCESSED IS TOSSED, IT
   2024 C                     IS NOT FLAGGED)
   2025 C    KTOP   - INDEX CORRESP. TO UPPER LIMITING MAND. PRESSURE LEVEL FOR
   2026 C              PROCESSING SAT. RETRIEVALS {DATA ON ALL LVLS ON & BELOW
   2027 C              PMAND(KTOP) PROCESSED}    (DEF - KTOP(5,4,4)/80*16/,10MB)
   2028 C              -- THE MAXIMUM VALUE IS 23 (CORRESPONDING TO 0.1 MB)
   2029 C              (NOTE: APPL. TO ALL VARIABLES ON THE LVL, INCL. MOISTURE)
   2030 C
   2031 C    IRTRV  - SATELLITE PATH TYPE SWITCH -
   2032 C       =    0  PROCESS ALL PATH TYPES
   2033 C       =    1  PROCESS ONLY CLEAR COLUMN PATH TYPES
   2034 C       =    2  RTOVS/ATOVS: PROCESS ONLY N* (PARTLY CLDY) PATH TYPES
   2035 C               GOES: DOES NOT APPLY
   2036 C       =    3  PROCESS ONLY CLOUDY TYPES
   2037 C       =    4  GOES: PROCESS ONLY UNKNOWN TYPES
   2038 C               RTOVS/ATOVS: DOES NOT APPLY
   2039 C       = 9999  EXCLUDE ALL TYPES
   2040 C       =  544  EXCLUDE CLOUDY TYPES
   2041 C       =  528  RTOVS/ATOVS: EXCLUDE N* (PARTLY CLOUDY) TYPES
   2042 C               GOES: DOES NOT APPLY TO GOES
   2043 C       =  272  EXCLUDE CLEAR COLUMN TYPES
   2044 C       =  118  EXCLUDE UNKNOWN TYPES
   2045 C
   2046 C    (NOTE 1: THIS DOES NOT APPLY TO RTOVS/ATOVS OR GOES RADIANCES;
   2047 C     NOTE 2: IMPORTANT: 'PROCESS' HERE MEANS THIS TYPE IS
   2048 C             NOT FLAGGED W/ PREPBUFR TBL VALUE=15 AND ALL OTHER TYPES
   2049 C             ARE FLAGGED;  'EXCLUDE' HERE MEANS THIS TYPE IS PROCESSED
   2050 C             BUT IS FLAGGED WITH PREPBUFR TABLE VALUE=15)
   2051 C                          (DEFAULT - IRTRV(5,4,4)/4(2*0,544,2*0),60*0/)
   2052 CC

Page 37          Source Listing                  PREPOBS_PREPDATA
2017-04-18 11:09                                 prepdata.f

   2053 C  N O T E -- THE FOLLOWING 12-WORD ARRAYS REFER TO THE 12 SURFACE
   2054 C              OBSERVATION TYPES POSSIBLE
   2055 C        1 - SYNOPTIC LAND (FIXED) (INCLUDING WMO RESOLUTION 40)
   2056 C        2 - MARINE SHIP (FIXED AND MOVING)
   2057 C        3 - OPC/NOS POINT MEAN SEA-LEVEL PRESSURE BOGUS (MARINE)
   2058 C        4 - MARINE BUOY (FIXED AND DRIFTING)
   2059 C        5 - MARINE SPLASH-LEVEL FROM DROPWINSONDES OR RECCOS WITH PMSL
   2060 C            OBS (MASS RPT)
   2061 C        6 - MARINE C-MAN PLATFORM
   2062 C        7 - AUSTRALIAN (PAOBS) MEAN SEA-LEVEL PRESSURE BOGUS (MARINE)
   2063 C        8 - METAR LAND
   2064 C        9 - MARINE AUTOMATED TIDE GAUGE STATIONS
   2065 C       10 - MESONET SURFACE (COOPERATIVE NETWORKS)
   2066 C       11 - SYNOPTIC LAND (MOBILE)
   2067 C       12 - COAST GUARD TIDE GAUGE STATIONS
   2068 CC
   2069 C    FWINDO - TIME WINDOW (+/-) FOR SURFACE RPTS (IN HUNDREDTHS OF AN
   2070 C              HR) - (MAX IS +/- 12 HRS)
   2071 C                            (DEF - FWINDO(12)/4*300.,600.,7*300./)
   2072 C    JSURFM - SURFACE MASS DATA TYPE SWITCH -
   2073 C       =    0  PROCESS MASS INFO FOR THIS TYPE
   2074 C       = 9999  EXCL. MASS INFO FOR THIS TYPE   (DEF - JSURFM(12)/12*0/)
   2075 C    JSURFW - SURFACE WIND DATA TYPE SWITCH -
   2076 C       =    0  PROCESS WIND INFO FOR THIS TYPE
   2077 C       = 9999  EXCLUDE WIND INFO FOR THIS TYPE
   2078 C                         (DEF - JSURFW(12)/2*0,9999,0,9999,0,9999,5*0/)
   2079 C    npkrpt - logical flag denoting whether or not to process surface
   2080 C              reports in the following situations:
   2081 C                1) non-mesonet land reports with a missing station
   2082 C                   pressure observation, a missing sea-level pressure
   2083 C                   observation, and pfralt=F;
   2084 C                2) non-mesonet land reports with a missing station
   2085 C                   pressure observation, a missing sea-level pressure
   2086 C                   observation, and a missing altimeter setting when
   2087 C                   pfralt=T;
   2088 C                3) marine reports with a missing station pressure
   2089 C                   observation and a missing sea-level pressure
   2090 C                   observation
   2091 C                4) marine reports with a missing station pressure
   2092 C                   observation a reported missing sea-level pressure
   2093 C                   observation and an elevation > 7.5 meters
   2094 C       =   .TRUE.   process the surface report in one of the above
   2095 C                    situations, store pstn estimated from reported
   2096 C                    info and possibly U.S. Std. Atmos., and give
   2097 C                    report a new report type (more on that later)
   2098 C       =   .FALSE.  toss the surface report in one of the above
   2099 C                    situations
   2100 C                         -- or --
   2101 C             logical flag denoting how to process surface mesonet
   2102 C              reports with a missing station pressure observation and
   2103 C              a missing altimeter setting (note: all mesonets have a
   2104 C              a missing sea-level pressure observation, and all have
   2105 C              hardwired pfralt=T)
   2106 C       =   .TRUE.   process the surface mesonet report, store pstn
   2107 C                    estimated from reported info and possibly U.S.
   2108 C                    Std. Atmos, and give report a new report type
   2109 C                    (more on that later)

Page 38          Source Listing                  PREPOBS_PREPDATA
2017-04-18 11:09                                 prepdata.f

   2110 C       =   .FALSE.  process the surface mesonet report, store pstn
   2111 C                    estimated from reported info and possibly U.S.
   2112 C                    Std. Atmos., and set character 8 of the stnid to
   2113 C                    "x" (instead of the usual blank) (these reports
   2114 C                    remain report type 188/288)
   2115 C                                        (def - npkrpt(12)/12*.false./)
   2116 C {NOTE: PMSL BOGUS (BOTH) & SPL-LVL REPORTS NEVER PROCESS A WIND PART)
   2117 CC
   2118 C    PFRALT - FOR NON-MESONET SURFACE LAND (ONLY) REPORTS WITH MISSING
   2119 C              STATION PRESSURE AND NON-MISSING ALTIMETER SETTING,
   2120 C              CALCULATE STATION PRESSURE FROM ALTIMETER AND GIVE THE
   2121 C              REPORTS A PREPBUFR REPORT TYPE OF 187/287 TO UNIQUELY
   2122 C              IDENTIFY THEM (SEE BELOW FOR INFO ON MESONET REPORTS)
   2123 C              PFRALT =.TRUE.  ---> YES
   2124 C              PFRALT =.FALSE. ---> NO                         (DEFAULT)
   2125 C             {NOTE1: THE FOLLOWING DOES NOT APPLY TO MESONET REPORTS:
   2126 C                     IN THE CASE OF PFRALT=F OR MISSING ALTIMETER
   2127 C                     SETTING, IF SURFACE LAND REPORTS HAVE MISSING
   2128 C                     STATION PRESSURE, THEN IT WILL BE ESTIMATED FROM
   2129 C                     PMSL IF ITS NON-MISSING AND ENCODED INTO PREPBUFR
   2130 C                     FILE, AND THE REPORTS WILL GET A PREPBUFR REPORT
   2131 C                     TYPE 183/284 (UNLESS ELEV IS < 7.5 M IN WHICH
   2132 C                     CASE PSTN IS SET TO PMSL AND PREPBUFR R.T. 181/
   2133 C                     281 IS ASSIGNED); IF PMSL IS ALSO MISSING, THEN
   2134 C                     ONE OF THE FOLLOWING WILL OCCUR:
   2135 C                      1) IF NPKRPT=T FOR THE SFC TYPE, PSTN IS
   2136 C                         ESTIMATED FROM U.S. STANDARD ATMOS. PMSL
   2137 C                         (1013.25 MB) AND ENCODED INTO PREPBUFR FILE,
   2138 C                         AND THE REPORTS WILL GET A PREPBUFR REPORT
   2139 C                         TYPE 192/292 IF SYNOPTIC AND PREPBUFR REPORT
   2140 C                         TYPE 193/193 IF METAR;
   2141 C                      2) IF NPKRPT=F FOR THE SFC TYPE, THE REPORT WILL
   2142 C                         BE SKIPPED}
   2143 C             (NOTE2: PFRALT=T WILL ALSO ENCODE ALTIMETER SETTING INTO
   2144 C                     PREPBUFR FILE FOR ALL SURFACE LAND REPORTS,
   2145 C                     REGARDLESS OF WHETHER OR NOT STATION PRESSURE IS
   2146 C                     MISSING - THE RUC2A HAD READ THE ALTIMETER
   2147 C                     SETTING, NOT STATION PRESSURE, FOR SURFACE LAND
   2148 C                     REPORTS - THIS IS NOT THE CASE FOR THE RAP)
   2149 C             (NOTE3: FOR MESONET REPORTS, PFRALT IS HARDWIRED TO TRUE:
   2150 C                     - IF PSTN IS NON-MISSING, IT IS ENCODED IN
   2151 C                       PREPBUFR FILE, AND CHARACTER 8 OF STNID REMAINS
   2152 C                       BLANK, THESE GET PREPBUFR REPORT TYPE 188/288;
   2153 C                     - IF PSTN IS MISSING BUT ALTIMETER SETTING IS
   2154 C                       NON-MISSING, IT IS USED TO ESTIMATE PSTN, PSTN
   2155 C                       IS ENCODED IN PREPBUFR FILE, AND CHARACTER 8 OF
   2156 C                       STNID IS SET TO 'a', THESE GET PREPBUFR REPORT
   2157 C                       TYPE 188/288;
   2158 C                     - IF BOTH PSTN AND ALTIMETER SETTING ARE MISSING,
   2159 C                       THEN ONE OF THE FOLLOWING WILL OCCUR:
   2160 C                        1) IF NPKRPT(10)=T, PSTN IS ESTIMATED FROM
   2161 C                           U.S. STANDARD ATMOS. PMSL (1013.25 MB) AND
   2162 C                           ENCODED INTO PREPBUFR FILE, THESE GET
   2163 C                           PREPBUFR REPORT TYPE 195/295;
   2164 C                        2) IF NPKRPT(10)=F, THE U.S. STANDARD
   2165 C                           ATMOSPHERE IS USED TO ESTIMATE PSTN, PSTN
   2166 C                           IS ENCODED INTO PREPBUFR WITH THIS VALUE,

Page 39          Source Listing                  PREPOBS_PREPDATA
2017-04-18 11:09                                 prepdata.f

   2167 C                           AND CHARACTER 8 OF STNID IS SET TO 'x',
   2168 C                           THESE GET PREPBUFR REPORT TYPE 188/288;
   2169 C                     NOTE THAT PMSL IS ALWAYS MISSING FOR MESONET
   2170 C                     REPORTS.)
   2171 CC
   2172 C  N O T E --  THE FOLLOWING DEFINES AN LFM GRID (POLAR STEREOGRAPHIC)
   2173 C               WHICH IS USED TO 'THIN' VOLUME OF SURFACE DATA PREPARED
   2174 C                 LFMAXI=0 TURNS OFF THE THINNING TESTS
   2175 C               THINNING MEANS FLAGGING ALL VARIABLES WITH
   2176 C                 PREPBUFR TABLE VALUE = 15
   2177 CC
   2178 C    LFMAXI - I DIMENSION OF LFM GRID                       (DEFAULT=53)
   2179 C    LFMAXJ - J DIMENSION OF LFM GRID                       (DEFAULT=45)
   2180 C    FMESHL - MESH LENGTH IN KM AT 60N                   (DEFAULT=190.5)
   2181 C    FLONVT - REFERENCE LONGITUDE((+W) OF LFM GRID        (DEFAULT=105.)
   2182 C    FPOLEI - I INDEX OF NORTH POLE                        (DEFAULT=27.)
   2183 C    FPOLEJ - J INDEX OF NORTH POLE                        (DEFAULT=49.)
   2184 CC
   2185 C  N O T E -- THE FOLLOWING (6,4) ARRAYS REFER TO 6 LATITUDE BANDS (90S
   2186 C              -70S,70S-20S,20S-0,0-20N,20N-70N,70N-90N) (1ST ELEMENT),
   2187 C              AND 4 SSM/I SATELLITE REPORT TYPES POSSIBLE (2ND ELEMENT)
   2188 C               ** THEN SECOND ELEMENT IDENTIFIED AS FOLLOWS:
   2189 C                     1 - SURFACE WIND SPEED (OVER OCEANS)
   2190 C                     2 - TOTAL COLUMN PRECIPITABLE WATER (OVER OCEANS)
   2191 C                     3 - RAIN RATE (OVER LAND AND OCEAN)
   2192 C                     4 - SEVEN-CHANNEL BRIGHTNESS TEMPERATURE
   2193 CC
   2194 C    XWINDO - TIME WINDOW (+/-) FOR SSM/I REPORTS (IN HUNDREDTHS OF AN
   2195 C             HR) - (MAX IS +/- 12 HRS) (DEFAULT - XWINDO(6,4)/24*300./)
   2196 CC
   2197 C    JPSSMI - SSM/I DATA TYPE SWITCH -
   2198 C       =    0  PROCESS THIS TYPE
   2199 C       = 9999  EXCLUDE THIS TYPE       (DEFAULT - JPSSMI(6,4)/24*9999/)
   2200 CC
   2201 C  N O T E -- THE FOLLOWING 6-WORD ARRAYS REFER TO 6 LATITUDE BANDS
   2202 C              (90S-70S,70S-20S,20S-0,0-20N,20N-70N,70N-90N)
   2203 CC
   2204 C    JPERSD - ERS SCATTEROMETER WIND DATA TYPE SWITCH -
   2205 C       =    0  PROCESS THIS TYPE
   2206 C       = 9999  EXCLUDE THIS TYPE          (DEFAULT - JPERSD(6)/6*9999/)
   2207 CC
   2208 C    JPQKSD - QUIKSCAT SCATTEROMETER WIND DATA TYPE SWITCH -
   2209 C       =    0  PROCESS THIS TYPE
   2210 C       = 9999  EXCLUDE THIS TYPE          (DEFAULT - JPQKSD(6)/6*9999/)
   2211 CC
   2212 C    JPWDSD - WINDSAT SCATTEROMETER WIND DATA TYPE SWITCH -
   2213 C       =    0  PROCESS THIS TYPE
   2214 C       = 9999  EXCLUDE THIS TYPE          (DEFAULT - JPWDSD(6)/6*9999/)
   2215 CC
   2216 C    JPASCD - ASCAT SCATTEROMETER WIND DATA TYPE SWITCH -
   2217 C       =    0  PROCESS THIS TYPE
   2218 C       = 9999  EXCLUDE THIS TYPE          (DEFAULT - JPASCD(6)/6*9999/)
   2219 CC
   2220 C    IEWNDO(1) - EARLIEST TIME FOR ACCEPTING ERS SCATTEROMETER RPTS -
   2221 C             EXPRESSED AS NO. OF WHOLE HRS. RELATIVE TO CYCLE TIME
   2222 C             (NEGATIVE IF PRIOR TO CYCLE TIME; POSITIVE IF AFTER
   2223 C             CYCLE TIME) (E.G., IF CYCLE HR = 00Z THEN IEWNDO(1) = -3

Page 40          Source Listing                  PREPOBS_PREPDATA
2017-04-18 11:09                                 prepdata.f

   2224 C             MEANS EARLIEST ERS SCATT. REPORT IS AT 21Z)   (DEFAULT=-3)
   2225 C    IEWNDO(2) - LATEST TIME FOR ACCEPTING ERS SCATTEROMETER RPTS -
   2226 C             EXPRESSED AS FOR IEWNDO(1) (E.G., IF CYCLE HR = 12Z
   2227 C             THEN IEWNDO(2) = 2 MEANS LATEST  ERS SCATT. REPORT IS
   2228 C             AT 14Z)                                        (DEFAULT=3)
   2229 CC
   2230 C    IQWNDO(1) - EARLIEST TIME FOR ACCEPTING QUIKSCAT SCATTEROMETER
   2231 C             RPTS - EXPRESSED AS NO. OF WHOLE HRS. RELATIVE TO CYCLE
   2232 C             TIME (NEGATIVE IF PRIOR TO CYCLE TIME; POSITIVE IF AFTER
   2233 C             CYCLE TIME) (E.G., IF CYCLE HR = 00Z THEN IQWNDO(1) = -3
   2234 C             MEANS EARLIEST QUIKSCAT SCATT. REPORT IS AT 21Z)  (DEF=-3)
   2235 C    IQWNDO(2) - LATEST TIME FOR ACCEPTING QUIKSCAT SCATTEROMETER RPTS
   2236 C             - EXPRESSED AS FOR IQWNDO(1) (E.G., IF CYCLE HR = 12Z
   2237 C             THEN IQWNDO(2) = 2 MEANS LATEST QUIKSCAT SCATT. REPORT
   2238 C             IS AT 14Z)                                     (DEFAULT=3)
   2239 CC
   2240 C    IWWNDO(1) - EARLIEST TIME FOR ACCEPTING WINDSAT SCATTEROMETER RPTS
   2241 C             - EXPRESSED AS NO. OF WHOLE HRS. RELATIVE TO CYCLE TIME
   2242 C             (NEGATIVE IF PRIOR TO CYCLE TIME; POSITIVE IF AFTER CYCLE
   2243 C             TIME) (E.G., IF CYCLE HR = 00Z THEN IWWNDO(1) = -3 MEANS
   2244 C             EARLIEST WINDSAT SCATT. REPORT IS AT 21Z)     (DEFAULT=-3)
   2245 C    IWWNDO(2) - LATEST TIME FOR ACCEPTING WINDSAT SCATTEROMETER RPTS -
   2246 C             EXPRESSED AS FOR IWWNDO(1) (E.G., IF CYCLE HR = 12Z THEN
   2247 C             IWWNDO(2) = 2 MEANS LATEST  WINDSAT SCATT. REPORT IS AT
   2248 C             14Z)                                           (DEFAULT=3)
   2249 CC
   2250 C    IAWNDO(1) - EARLIEST TIME FOR ACCEPTING ASCAT SCATTEROMETER RPTS -
   2251 C             EXPRESSED AS NO. OF WHOLE HRS. RELATIVE TO CYCLE TIME
   2252 C             (NEGATIVE IF PRIOR TO CYCLE TIME; POSITIVE IF AFTER CYCLE
   2253 C             TIME) (E.G., IF CYCLE HR = 00Z THEN IAWNDO(1) = -3
   2254 C             MEANS EARLIEST ASCAT SCATTEROMETER RPT IS AT 21Z  (DEF=-3)
   2255 C    IAWNDO(2) - LATEST TIME FOR ACCEPTING ASCAT SCATTEROMETER RPTS -
   2256 C             EXPRESSED AS FOR IAWNDO(1) (E.G., IF CYCLE HR = 12Z THEN
   2257 C             IAWNDO(2) = 2 MEANS LATEST ASCAT SCATTEROMETER REPORT
   2258 C             IS AT 14Z)                                     (DEFAULT=3)
   2259 CC
   2260 C  N O T E -- THE FOLLOWING 6-WORD ARRAYS REFER TO 6 LATITUDE BANDS
   2261 C              (90S-70S,70S-20S,20S-0,0-20N,20N-70N,70N-90N)
   2262 CC
   2263 C    JPGPSD - GPS-IPW/TZD DATA TYPE SWITCH -
   2264 C       =    0  PROCESS THIS TYPE
   2265 C       = 9999  EXCLUDE THIS TYPE          (DEFAULT - JPGPSD(6)/6*9999/)
   2266 CC
   2267 C    GWINDO - TIME WINDOW (+/-) FOR GPS-IPW/TZD REPORTS (IN HUNDREDTHS
   2268 C              OF AN HR) - (MAX IS +/- 12 HRS)            (DEFAULT=300.)
   2269 C    SKGP45 - SKIP ALL GPS-IPW REPORTS WITH REPORT TIME MINUTES GREATER
   2270 C             THAN 30 (xx:45 REPORTS CONSIDERED TO BE OF POORER QUALITY
   2271 C             THAN xx:15 REPORTS)
   2272 C             --> This applies ONLY to older GSD-supplied GPS-IPW rpts
   2273 C                 (i.e., in subset NC012003 of "gpsipw" dump file)
   2274 C              SKGP45 =.TRUE.  ---> YES                        (DEFAULT)
   2275 C              SKGP45 =.FALSE. ---> NO
   2276 C    SKGNSS - LOGICAL SWITCH TO CONTROL SKIPPING OF Ground-based global
   2277 C             Navigation Satellite System (GNSS) REPORTS THAT ARE FROM
   2278 C             PROVIDERS OTHER THAN U.S. BASED Earth Networks, Inc. (ENI)
   2279 C             (currently determined by characters 5-8 of report id)
   2280 C             --> This applies ONLY to newer WMO BUFR GPS-IPW/ZTD rpts

Page 41          Source Listing                  PREPOBS_PREPDATA
2017-04-18 11:09                                 prepdata.f

   2281 C                 (i.e., in subset NC012004 of "gpsipw" dump file)
   2282 C              SKGNSS =.TRUE.  ---> ENABLE RPT SKIPPING        (DEFAULT)
   2283 C              SKGNSS =.FALSE. ---> DISABLE RPT SKIPPING
   2284 CC
   2285 C GET LIMITS FOR EXTRACTING NON-SAT. UPPER-AIR DATA IN CAT 1-5:
   2286 C    (SEE SWITCH "KTOP" FOR SATELLITE RETRIEVAL LIMITS)
   2287 CC
   2288 C    LEVPM  - INDEX CORRESP. TO UPPER LIMITING MAND. PRESSURE LEVEL FOR
   2289 C              PROCESSING MAND-LVL (CAT.1), SIG-LVL (CAT.3/SPEC.-LVL),
   2290 C              TEMP-BY-HGT (CAT.15) AND WNDS-BY-HGT (CAT.4/11) U-AIR
   2291 C              DATA {DATA ON ALL LVLS ON & BELOW PMAND(LEVPM) ARE
   2292 C              PROCESSED}  (DEFAULT=16,10MB) -- THE MAXIMUM VALUE IS 21
   2293 C              (CORRESPONDING TO 1.0 MB)
   2294 C              {NOTE: DOES NOT APPLY TO MOISTURE - SEE SWITCH LEVQQ;
   2295 C               FOR CAT.4/11 AND 15 DATA, ALL LVLS ON & BELOW STANDARD
   2296 C               ATMOSPHERE HEIGHT CORRESPONDING TO PMAND(LEVPM) ARE
   2297 C               PROCESSED}
   2298 C    LEVST  - INDEX CORRESP. TO UPPER LIMITING MAND. PRESSURE LEVEL FOR
   2299 C              PROCESSING SIG-LVL (CAT.2/5) U-AIR DATA {DATA ON ALL LVLS
   2300 C              ON & BELOW PMAND(LEVST) ARE PROCESSED}  (DEFAULT=13,50MB)
   2301 C              -- THE MAXIMUM VALUE IS 21 (CORRESPONDING TO 1.0 MB)
   2302 C              (NOTE: DOES NOT APPLY TO MOISTURE - SEE SWITCH LEVQQ)
   2303 C    LEVQQ  - INDEX CORRESP. TO UPPER LIMITING MAND. PRESSURE LEVEL FOR
   2304 C              PROCESSING MAND- & SIG-LVL U-AIR MOIST. DATA {DATA ON ALL
   2305 C              LVLS ON & BELOW PMAND(LEVQQ) ARE PROCESSED} (DEF=8,250MB)
   2306 C              -- THE MAXIMUM VALUE IS 21 (CORRESPONDING TO 1.0 MB)
   2307 CC
   2308 C    MODPRT - CONTROLS FREQ. OF RPT STD. O-PUT (UNIT 6) PRT- MUST BE A
   2309 C               MULT. OF 4 {WHEN MODPRT=N, EVERY N'TH U-AIR RPT OR SAT.
   2310 C               RAD/RETR RPT IS PRINTED FOR EACH CAT. IN THE MERGING
   2311 C               PROCESS; EVERY N/4'TH FILLED REPORT IN "MOBS" ARRAY
   2312 C               (FOR ALL DATA) IS PRINTED}
   2313 C              MODPRT < 0 ---> NO REPORTS ARE PRINTED      (DEFAULT=500)
   2314 C
   2315 C    IPRINT - CONTROLS AMOUNT OF STANDARD OUTPUT (UNIT 6) PRINT -
   2316 C               MAINLY FOR PRINT RELATED TO REPORTS THAT HAVE BEEN
   2317 C               TOSSED OR FULLY FLAGGED
   2318 C              IPRINT   =  0 ----> FULL PRINTOUT               (DEFAULT)
   2319 C              IPRINT .NE. 0 ----> LIMITED PRINTOUT
   2320 C
   2321 C    STNPRT - C*8 3-WORD ARRAY HOLDING SPECIFIC STN. IDS FOR DETAILED
   2322 C              STD. O-PUT (UNIT 6) PRINT DURING MERGING OF CAT. -- WILL
   2323 C              ALSO PRINT EVERYTHING PRINTED WHEN 'MODPRT' ABOVE IS
   2324 C              INVOKED -- LIMIT OF THREE STATIONS AND ALL MUST BE OF THE
   2325 C              ADPUPA OR SAT. RAD/RETR TYPE(DEF-STNPRT(3)/3*'        '/)
   2326 CC
   2327 CC
   2328 C   ***** VARIABLES IN NAMELIST PARM  READ IN MAIN PROGRAM *****
   2329 CC
   2330 CC
   2331 C    IUNIT  - 28-WORD ARRAY HOLDING UNIT NUMBERS AND SWITCHES ....
   2332 C       IUNIT(1)  - UNIT NUMBER FOR NCEP PRODUCTION DATE FILE
   2333 C       IUNIT(2)  - UNIT NUMBER OF FIRST FILE IN BUFR TABLE FILE GROUP
   2334 C       IUNIT(3)  - UNIT NUMBER OF FIRST FILE IN FIXED FIELD FILE GROUP
   2335 C       IUNIT(4)  - UNIT NUMBER OF FIRST FILE IN BACKGROUND FILE GROUP
   2336 C       IUNIT(5)  - UNIT NUMBER OF FIRST FILE IN UPPER-AIR FILE GROUP
   2337 C       IUNIT(6)  - UNIT NUMBER OF FIRST FILE IN SURFACE FILE GROUP

Page 42          Source Listing                  PREPOBS_PREPDATA
2017-04-18 11:09                                 prepdata.f

   2338 C       IUNIT(7)  - UNIT NUMBER OF FIRST FILE IN POLAR-ORBITING
   2339 C                    SATELLITE SOUNDING FILE GROUP
   2340 C       IUNIT(8)  - UNIT NUMBER OF FIRST FILE IN GOES SATELLITE
   2341 C                    SOUNDING FILE GROUP
   2342 C       IUNIT(9)  - UNIT NUMBER OF FIRST FILE IN OTHER SATELLITE FILE
   2343 C                    GROUP
   2344 C       IUNIT(10)\
   2345 C         TO     -> CURRENTLY NOT USED
   2346 C       IUNIT(15)/
   2347 C       IUNIT(16) - UNIT NUMBER OF OUTPUT PREPBUFR FILE
   2348 C       IUNIT(17) - UNIT NUMBER OF OUTPUT "PREVENT" EVENTS DATA
   2349 C                    FILTERING SUMMARY PRINT FILE
   2350 C       IUNIT(18)\
   2351 C         TO     -> CURRENTLY NOT USED
   2352 C       IUNIT(28)/
   2353 C
   2354 C           (DEFAULT - IUNIT/11,12,15,18,21,31,41,46,48,6*0,51,52,11*0/)
   2355 CC
   2356 CC
   2357 C *** VARIABLES IN NAMELIST PREVDATA READ IN W3EMC ROUTINE GBLEVENTS ***
   2358 CC
   2359 CC
   2360 C         ---> See Docblock in W3EMC Routine GBLEVENTS
   2361 CC
   2362 C***********************************************************************
   2363 CCCCC
   2364 
   2365 C----------------------------------------------------------------------
   2366 C     REPORT (SINGLE MASS/WIND PIECE) HEADER IS STORED IN ARRAY "HDR"
   2367 C                   (NOTE: THIS APPLIES TO ALL REPORTS)
   2368 C----------------------------------------------------------------------
   2369 C
   2370 C         C O N T E N T S   O F   T H E   A R R A Y   H D R
   2371 C                     HDR HOLDS UP TO "MXWRDH" WORDS
   2372 C                      (CURRENTLY MXWRDH SET TO 15)
   2373 C
   2374 C        HDR(1)   = STATION IDENTIFICATION (CHARACTER)
   2375 C        HDR(2)   = LONGITUDE(DEGREES) EAST (0.00 TO 359.99)
   2376 C                   passed through this code as ALON_8 only if OBS8_8(2)
   2377 C                   (see below) is missing
   2378 C        HDR(3)   = LATITUDE (DEGREES) N+ (RANGE -90.00 TO 90.00)
   2379 C                   passed through this code as ALAT_8 only if OBS8_8(1)
   2380 C                   (see below) is missing
   2381 C        HDR(4)   = DELTA OBS. TIME (OBS. TIME - CYCLE TIME, HRS)
   2382 C        HDR(5)   = RECEIPT TIME (HRS)
   2383 C        HDR(6)   = PREPBUFR REPORT TYPE -- SEE "ITYPE" BELOW
   2384 C        HDR(7)   = DUMP REPORT TYPE
   2385 C        HDR(8)   = REPORT SUB-TYPE (VALUE DEPENDS ON TYPE OF REPORT,
   2386 C                    SEE COMMENTS WITHIN CODE)
   2387 C        HDR(9)   = FOR ALL TYPES COMING FROM IW3UNPBF -
   2388 C                        INSTRUMENT TYPE
   2389 C                   FOR GOES SOUNDINGS COMING FROM W3UNPKB7 -
   2390 C                        PROCESSING TECHNIQUE
   2391 C                   FOR ALL OTHER TYPES - NOT USED (MISSING)
   2392 C        HDR(10)  = ELEVATION (METERS)
   2393 C        HDR(11)  = REPORT SEQUENCE NUMBER (NUMERIC)
   2394 C        HDR(12)  = SOLAR AND INFRARED RADIATION CORRECTION INDICATOR

Page 43          Source Listing                  PREPOBS_PREPDATA
2017-04-18 11:09                                 prepdata.f

   2395 C                   (SEE BUFR C.T. 0-02-013, APPLIES ONLY TO "ADPUPA"
   2396 C                   TYPES WITH A VALID INSTRUMENT TYPE)
   2397 C        HDR(13)  = REPORTED OBSERVATION TIME (HRS)
   2398 C        HDR(14)  = INDICATOR FOR OBSERVATION TIME IN "HDR(4)"
   2399 C                   CALCULATION: (=0 - REPORTED; =1 - CORRECTED FROM
   2400 C                   REPORTED LAUNCH TIME; =2 - CORRECTED EVEN THOUGH
   2401 C                   LAUNCH TIME IS MISSING)
   2402 C        HDR(15)  = SATELLITE ID (SEE BUFR C.T. 0-01-007, APPLIES
   2403 C                   ONLY TO SATELLITE DATA TYPES)
   2404 C
   2405 C      MISSING PARAMETERS SET TO XMISS (99999.), EXCEPT FOR HDR(11)
   2406 C      WHICH IS SET TO XMISS*10. (999990.)
   2407 C      ITYPE = (KI * 100) + (NI * 10) + JI
   2408 C        WHERE, KI = OBSERVATION  TYPE (1 FOR MASS, 2 FOR WINDS)
   2409 C               NI = INSTRUMENT
   2410 C               JI = SUBSET OF INSTRUMENT
   2411 C
   2412 C----------------------------------------------------------------------
   2413 C  ADDITONAL REPORT (SINGLE MASS/WIND PIECE) HEADER INFORMATION
   2414 C                       IS STORED IN ARRAY "OBS8_8"
   2415 C  (NOTE: THIS APPLIES TO ALL REPORTS COMING FROM IW3UNPBF OR W3UNPKB7)
   2416 C----------------------------------------------------------------------
   2417 C
   2418 C       C O N T E N T S   O F   T H E   A R R A Y   O B S 8 _ 8
   2419 C                               OBS8_8(2)
   2420 C
   2421 C        OBS8_8(1)   = REAL*8 LATITIUDE DEGREES)  N+ (RANGE -90. TO 90.)
   2422 C        OBS8_8(2)   = REAL*8 LONGITUDE (DEGREES) E+ (RANGE -179.99999
   2423 C                                                              TO +180.)
   2424 C
   2425 C     OBS8_8(1) passed through this code as ALAT_8 (REAL*8)
   2426 C     OBS8_8(2) passed through this code as ALON_8 (REAL*8)
   2427 C       {ALON_8 redefined as degrees East (0.00 TO 359.99999)}
   2428 C
   2429 C----------------------------------------------------------------------
   2430 C       SINGLE "LEVEL" REPORT (SINGLE MASS/WIND PIECE) INFORMATION
   2431 C           STORED DIRECTLY FROM BUFR IS STORED IN ARRAY "OBS2"
   2432 C         (NOTE: THIS APPLIES TO ALL REPORTS COMING FROM IW3UNPBF)
   2433 C----------------------------------------------------------------------
   2434 C
   2435 C         C O N T E N T S   O F   T H E   A R R A Y   O B S 2
   2436 C                     OBS2 HOLDS UP TO "NUMOBS2" WORDS
   2437 C                       (CURRENTLY NUMOBS2 SET TO 43)
   2438 C
   2439 C        OBS2(1)  = RESTRICTIONS ON REDISTRIBUTION (BUFR F.T. 0-35-200)
   2440 C        OBS2(2)  = EXPIRATION OF RESTRICTIONS ON REDISTRIBUTION (HR)
   2441 C        OBS2(3)  = ALTIMETER SETTING (PASCALS)
   2442 C        OBS2(4)  = SEA-SURFACE TEMPERATURE (KELVIN)
   2443 C        OBS2(5)  = DEPTH AT WHICH SEA-SURFACE TEMPERATURE MEASURED (M)
   2444 C        OBS2(6)  = METHOD OF SEA SURFACE TEMPERATURE MEASUREMENT
   2445 C                   (BUFR C.T. 0-02-038)
   2446 C        OBS2(7)  = RELATIONSHIP TO HORIZONTAL VISIBILITY
   2447 C                   (BUFR C.T. 0-08-201)
   2448 C        OBS2(8)  = HORIZONTAL VISIBILITY (M)
   2449 C        OBS2(9)  = VERTICAL VISIBILITY (M)
   2450 C        OBS2(10) = PAST WEATHER - 1 (BUFR C.T. 0-20-004)
   2451 C        OBS2(11) = PAST WEATHER - 2 (BUFR C.T. 0-20-005)

Page 44          Source Listing                  PREPOBS_PREPDATA
2017-04-18 11:09                                 prepdata.f

   2452 C        OBS2(12) = PEAK WIND SPEED (M/SEC)
   2453 C        OBS2(13) = PEAK WIND DIRECTION (DEGREES)
   2454 C        OBS2(14) = DURATION OF TIME FOR MAX. WIND SPEED (GUST) (MIN)
   2455 C        OBS2(15) = MAXIMUM WIND SPEED (GUST) (M/SEC)
   2456 C        OBS2(16) = MAXIMUM WIND GUST DIRECTION (DEGREES)
   2457 C        OBS2(17) = TOTAL PRECIPITATION PAST  1-HR (KG/M**2)
   2458 C        OBS2(18) = TOTAL PRECIPITATION PAST  3-HR (KG/M**2)
   2459 C        OBS2(19) = TOTAL PRECIPITATION PAST  6-HR (KG/M**2)
   2460 C        OBS2(20) = TOTAL PRECIPITATION PAST 12-HR (KG/M**2)
   2461 C        OBS2(21) = TOTAL PRECIPITATION PAST 24-HR (KG/M**2)
   2462 C        OBS2(22) = TOTAL SUNSHINE (MIN)
   2463 C        OBS2(23) = TOTAL CLOUD COVER (%)
   2464 C        OBS2(24) = HEIGHT ABOVE SURFACE OF BASE OF LOWEST CLOUD SEEN
   2465 C                   (BUFR C.T. 0-20-201)
   2466 C        OBS2(25) = 10 METER EXTRAPOLATED WIND SPEED (M/SEC)
   2467 C        OBS2(26) = 20 METER EXTRAPOLATED WIND SPEED (M/SEC)
   2468 C        OBS2(27) = SURFACE WIND DIRECTION (DEGREES)
   2469 C        OBS2(28) = SURFACE WIND SPEED (M/SEC)
   2470 C        OBS2(29) = DURATION OF TIME FOR DEPTH OF FRESH SNOW (HR)
   2471 C        OBS2(30) = DEPTH OF FRESH SNOW (M)
   2472 C        OBS2(31) = TOTAL SNOW DEPTH (M)
   2473 C        OBS2(32) = HEIGHT OF WAVES (M)
   2474 C        OBS2(33) = PERIOD OF WAVES (SEC)
   2475 C        OBS2(34) = HEIGHT OF WIND WAVES (M)
   2476 C        OBS2(35) = PERIOD OF WIND WAVES (SEC)
   2477 C        OBS2(36) = TRUE DIRECTION OF SHIP PAST 3-HRS
   2478 C                   (BUFR C.T. 0-01-193)
   2479 C        OBS2(37) = AVG SPEED OF SHIP PAST 3-HRS (BUFR C.T. 0-01-200)
   2480 C        OBS2(38) = CHARACTERISTIC OF PRESSURE TENDENCY
   2481 C                   (BUFR C.T. 0-10-063)
   2482 C        OBS2(39) = 03-HOUR PRESSURE CHANGE (PASCALS)
   2483 C        OBS2(40) = 24-HOUR PRESSURE CHANGE (PASCALS)
   2484 C        OBS2(41) = SEA-SURFACE TEMPERATURE TABLE VALUE (Q.M.)
   2485 C                   (BUFR C.T. 0-22-246)
   2486 C        OBS2(42) = MOISTURE QUALITY (BUFR C.T. 0-33-026)
   2487 C        OBS2(43) = SATELLITE ZENITH ANGLE (DEGREES)
   2488 C
   2489 C----------------------------------------------------------------------
   2490 C  ADDITONAL SINGLE "LEVEL" REPORT (SINGLE MASS/WIND PIECE) INFORMATION
   2491 C          STORED DIRECTLY FROM BUFR IS STORED IN ARRAY "RDATA2"
   2492 C         (NOTE: THIS APPLIES TO ALL REPORTS COMING FROM W3UNPKB7)
   2493 C----------------------------------------------------------------------
   2494 C
   2495 C       C O N T E N T S   O F   T H E   A R R A Y   R D A T A 2
   2496 C                               RDATA2(25)
   2497 C
   2498 C        RDATA2(1)  = TIME SIGNIFICANCE (BUFR C.T. 0-08-021)
   2499 C        RDATA2(2)  = TOTAL NUMBER (WITH RESPECT TO ACCUMULATION OR
   2500 C                     AVERAGE) (i.e., F-O-V number for GOES sounding/
   2501 C                     radiance; # of orig. reports used to generate
   2502 C                     superob for QuikSCAT, WindSAT and ASCAT - for
   2503 C                     non-superobs, hardwired to 1) (NUMERIC)
   2504 C        RDATA2(3)  = ACROSS-SWATH CELL NUMBER (NUMERIC)
   2505 C        RDATA2(4)  = ALONG-TRACK ROW NUMBER (NUMERIC)
   2506 C        RDATA2(5)  = WIND PROFILER SUBMODE INFORMATION (Note: Submode
   2507 C                     is missing after 5/2002 (no longer available)
   2508 C                     (BUFR C.T. 0-25-033)

Page 45          Source Listing                  PREPOBS_PREPDATA
2017-04-18 11:09                                 prepdata.f

   2509 C        RDATA2(6)  = TIME PERIOD OR DISPLACEMENT (i.e., AVERAGING
   2510 C                     TIME) (Note: A negative number means prior to
   2511 C                     observation time (MINUTE)
   2512 C        RDATA2(7)  = QUALITY INFORMATION (BUFR C.T. 0-33-002)
   2513 C        RDATA2(8)  = SEAWINDS PROBABILITY OF RAIN (NUMERIC)
   2514 C        RDATA2(9)  = SEA SURFACE TEMPERATURE (KELVIN)
   2515 C        RDATA2(10) = TOTAL WATER VAPOR (KG/M**2)
   2516 C        RDATA2(11) = TOTAL CLOUD LIQUID WATER (KG/M**2)
   2517 C        RDATA2(12) = WINDSAT SURFACE TYPE (BUFR C.T. 0-20-219)
   2518 C        RDATA2(13) = MODEL WIND DIRECTION AT 10 METERS (DEGREES)
   2519 C        RDATA2(14) = MODEL WIND SPEED AT 10 METERS  (M/SEC)
   2520 C        RDATA2(15) = WINDSAT EDR Q.C. FLAG # 1 (BUFR F.T. 0-33-200)
   2521 C        RDATA2(16) = CHI-SQUARED (OF THE WIND VECTOR RETRIEVAL)
   2522 C                     (NUMERIC)
   2523 C        RDATA2(17) = ESTIMATED ERROR COVARIANCE FOR WIND DIRECTION
   2524 C                     RETRIEVAL (DEGREES)
   2525 C        RDATA2(18) = ESTIMATED ERROR COVARIANCE FOR WIND (M/SEC)
   2526 C        RDATA2(19) = ESTIMATED ERROR COVARIANCE FOR SEA SURFACE
   2527 C                     TEMPERATURE RETRIEVAL (KELVIN)
   2528 C        RDATA2(20) = ESTIMATED ERROR COVARIANCE FOR TOTAL CLOUD LIQUID
   2529 C                     WATER RETRIEVAL (KG/M**2)
   2530 C        RDATA2(21) = ESTIMATED ERROR COVARIANCE FOR TOTAL WATER VAPOR
   2531 C                     RETRIEVAL (KG/M**2)
   2532 C        RDATA2(22) = WIND VECTOR CELL QUALITY (BUFR F.T. 0-21-155)
   2533 C        RDATA2(23) = BACKSCATTER DISTANCE (NUMERIC)
   2534 C        RDATA2(24) = LIKELIHOOD COMPUTED FOR SOLUTION (NUMERIC)
   2535 C        RDATA2(25) = TOTAL CLOUD COVER (PERCENT)
   2536 C
   2537 C----------------------------------------------------------------------
   2538 C       MULTI-"LEVEL" REPORT (SINGLE MASS/WIND PIECE) INFORMATION
   2539 C           STORED DIRECTLY FROM BUFR IS STORED IN ARRAY "OBS3"
   2540 C         (NOTE: THIS APPLIES TO ALL REPORTS COMING FROM IW3UNPBF)
   2541 C----------------------------------------------------------------------
   2542 C
   2543 C  C O N T E N T S   O F   T H E   A R R A Y S   O B S 3  &  N O B S 3
   2544 C                              OBS3(5,MXBLVL,7)
   2545 C                                NOBS3(7)
   2546 C
   2547 C
   2548 C        OBS3(1,A,1) = DURATION OF TIME FOR TOTAL PRECIPITATION
   2549 C                      MEASURMENT (HR)
   2550 C        OBS3(2,A,1) = TOTAL PRECIPITATION MEASUREMENT (KG/M**2)
   2551 C        {WHERE A RANGES FROM 1 TO NOBS3(1), THE NUMBER OF "LEVELS"}
   2552 C
   2553 C        OBS3(1,B,2) = PRESENT WEATHER (BUFR C.T. 0-20-003)
   2554 C        {WHERE B RANGES FROM 1 TO NOBS3(2), THE NUMBER OF "LEVELS"}
   2555 C
   2556 C        OBS3(1,C,3) = VERTICAL SIGNIFICANCE (SURFACE OBSERVATION)
   2557 C                      (BUFR C.T. 0-08-002)
   2558 C        OBS3(2,C,3) = CLOUD AMOUNT (BUFR C.T. 0-20-011)
   2559 C        OBS3(3,C,3) = CLOUD TYPE (BUFR C.T. 0-20-012)
   2560 C        OBS3(4,C,3) = HEIGHT OF BASE OF CLOUD (M)
   2561 C        OBS3(5,C,3) = HEIGHT OF TOP OF CLOUD (M)
   2562 C        {WHERE C RANGES FROM 1 TO NOBS3(3), THE NUMBER OF "LEVELS"}
   2563 C
   2564 C        OBS3(1,D,4) = DURATION OF TIME FOR MAXIMUM TEMPERATURE (HR)
   2565 C        OBS3(2,D,4) = MAXIMUM TEMPERATURE (K)

Page 46          Source Listing                  PREPOBS_PREPDATA
2017-04-18 11:09                                 prepdata.f

   2566 C        OBS3(3,D,4) = DURATION OF TIME FOR MINIMUM TEMPERATURE (HR)
   2567 C        OBS3(4,D,4) = MINIMUM TEMPERATURE (K)
   2568 C        {WHERE D RANGES FROM 1 TO NOBS3(4), THE NUMBER OF "LEVELS"}
   2569 C
   2570 C        OBS3(1,E,5) = DIRECTION OF SWELL WAVES (DEGREES)
   2571 C        OBS3(2,E,5) = HEIGHT OF SWELL WAVES (M)
   2572 C        OBS3(3,E,5) = PERIOD OF SWELL WAVES (SEC)
   2573 C        {WHERE E RANGES FROM 1 TO NOBS3(5), THE NUMBER OF "LEVELS"}
   2574 C
   2575 C        OBS3(1,F,6) = AIRFRAME ICING (BUFR C.T. 0-20-041)
   2576 C        OBS3(2,F,6) = HEIGHT OF BASE OF ICING (M)
   2577 C        OBS3(3,F,6) = HEIGHT OF TOP OF ICING (M)
   2578 C        {WHERE F RANGES FROM 1 TO NOBS3(6), THE NUMBER OF "LEVELS"}
   2579 C
   2580 C        OBS3(1,G,7) = DEGREE OF TURBULENCE (BUFR C.T. 0-11-031)
   2581 C        OBS3(2,G,7) = HEIGHT OF BASE OF TURBULENCE (M)
   2582 C        OBS3(3,G,7) = HEIGHT OF TOP OF TURBULENCE (M)
   2583 C        {WHERE G RANGES FROM 1 TO NOBS3(7), THE NUMBER OF "LEVELS"}
   2584 C
   2585 C----------------------------------------------------------------------
   2586 C            REPORT (MASS/WIND PIECE) DATA ARE STORED IN ARRAYS
   2587 C  "ICAT", "MOBS", "IPMSL", "PWAT", "GRAD", "RTRAD", "SRAD", "REQV"
   2588 C                             AND "CLTOP"
   2589 C----------------------------------------------------------------------
   2590 C
   2591 C         C O N T E N T S   O F   T H E   A R R A Y   I C A T
   2592 C                         (DATA LEVEL CATEGORY -
   2593 C       CURRENTLY APPLIES ONLY TO RAOB, PIBAL, RECCO, DROPS, CLASS,
   2594 C    PROFILER, VAD, RASS, SATELLITE SOUNDINGS, SATWINDS, AND AIRCRAFT.)
   2595 C
   2596 C                              ICAT(MXLVL)
   2597 C
   2598 C          WHERE MXLVL  = MAX NUMBER OF LEVELS
   2599 C                   CURRENTLY = 600 (BOTTOM TO TOP)
   2600 C
   2601 C                      POSSIBLE VALUES FOR ICAT:
   2602 C
   2603 C    =  0 SURFACE LEVEL (APPLIES ONLY TO MASS REPORTS OF THE FOLLOWING
   2604 C         TYPE: RAOB, PIBAL, MULTI-LEVEL RECCO, DROPS, CLASS, RASS,
   2605 C         AND SATELLITE SOUNDINGS)
   2606 C    =  1 MANDATORY LEVEL
   2607 C    =  2 SIGNIFICANT TEMPERATURE LEVEL (MASS ONLY)
   2608 C    =  3 WINDS-BY-PRESSURE LEVEL (WIND ONLY)
   2609 C    =  4 WINDS-BY-HEIGHT LEVEL (WIND ONLY)
   2610 C    =  5 TROPOPAUSE LEVEL
   2611 C    =  6 SINGLE LEVEL (INCLUDING ALL AIRCRAFT TYPES, AND ALL SATELLITE
   2612 C         WIND TYPES)
   2613 C    =  7 AUXILIARY LEVEL (SPECIAL INTERPOLATED LEVELS - APPLIES ONLY TO
   2614 C         RAOB, PIBAL, DROPWINSONDE, CLASS, PROFILER, SATELLITE
   2615 C         SOUNDINGS AND ONLY FOR SPCIAL=TRUE)
   2616 C    = 15 TEMPERATURES-BY-HEIGHT (PERTAINS ONLY TO RASS DATA)
   2617 C
   2618 C
   2619 C         C O N T E N T S   O F   T H E   A R R A Y   M O B S
   2620 C           (REPORT LEVEL DATA FOR A SINGLE MASS/WIND PIECE)
   2621 C
   2622 C                        MOBS(MXTYPV,MXWRDL,MXLVL)

Page 47          Source Listing                  PREPOBS_PREPDATA
2017-04-18 11:09                                 prepdata.f

   2623 C
   2624 C          WHERE MXTYPV = MAX NUMBER OF "GROUPS" ASSIGNED TO A
   2625 C                         VARIABLE ON AN MOBS REPORT LEVEL
   2626 C          CURRENTLY = 3 {1 - OBSERVATION;
   2627 C                         2 - PREPBUFR TABLE VALUE (QUALITY MARKER
   2628 C                            UNLESS OTHERWISE INDICATED BELOW;
   2629 C                         3 - REASON CODE}
   2630 C
   2631 C          WHERE MXWRDL = MAX NUMBER OF VARIABLES (AS GROUPED ABOVE)
   2632 C                         ON AN MOBS REPORT LEVEL
   2633 C          CURRENTLY = 6 (AS INDICATED BELOW)
   2634 C
   2635 C          WHERE MXLVL  = MAX NUMBER OF LEVELS FOR AN MOBS REPORT
   2636 C          CURRENTLY = 600 (BOTTOM TO TOP)
   2637 C
   2638 C      {IN ALL CASES, MISSING/NOT USED IS INITIALIZED AS IMISS (99999)}
   2639 C
   2640 C     MXWRD = 1 --> MASS AND WIND: PRESSURE (OBS. UNITS: MB * 10)
   2641 C                   (NOTE1: THIS IS STATION PRESSURE FOR SFC REPORTS)
   2642 C                   (NOTE2: FOR ALL TYPES EXCEPT CAT. 4/11 AND 15
   2643 C                           UPPER-AIR AND CAT. 6 SINGLE-LEVEL DATA, THE
   2644 C                           PREPBUFR TABLE VALUE IS THE VERTICAL
   2645 C                           COORDINATE INDICATOR MARK)
   2646 C     MXWND = 2 --> MASS: GEOPOTENTIAL (FOR ACFT FLIGHT-LEVEL,THIS IS
   2647 C                         PRESSURE ALTITUDE) (OBS. UNITS: METERS);
   2648 C                   WIND: PRESSURE-ALTITUDE (OBS. UNITS: METERS)
   2649 C                         (NOTE: APPLIES ONLY TO CAT. 4/11, CAT. 15 OR
   2650 C                                CAT. 6 WIND LEVELS, FOR ALL OTHERS
   2651 C                                THIS IS MISSING; ALSO FOR THESE TYPES,
   2652 C                                THE PREPBUFR TABLE VALUE IS THE
   2653 C                                VERTICAL COORDINATE INDICATOR MARK)
   2654 C     MXWRD = 3 --> MASS: "REPORTED" TEMPERATURE (FOR RTOVS OR ATOVS
   2655 C                         VIRT., FOR ALL OTHERS SENSIBLE) (OBS. UNITS:
   2656 C                         DEGREES C * 100);
   2657 C                   WIND: U-COMP (OBS. UNITS: M/SEC * 100)
   2658 C     MXWRD = 4 --> MASS: SPECIFIC HUMIDITY (OBS. UNITS: G/KG * 10**3);
   2659 C                   WIND: V-COMP (OBS. UNITS: M/SEC * 100)
   2660 C     MXWRD = 5 --> MASS: VIRTUAL TEMP (OBS. UNITS: DEGREES C * 100);
   2661 C                   WIND: DIRECTION (OBS. UNITS: DEGREES)
   2662 C     MXWRD = 6 --> MASS: DEWPOINT TEMP (OBS. UNITS: DEGREES C * 100);
   2663 C                   WIND: SPEED (OBS. UNITS: KNOTS FOR ALL TYPES
   2664 C                         EXCEPT SURFACE, OTHERWISE FOR SURFACE (ALL
   2665 C                         TYPES) M/SEC * 10)
   2666 C
   2667 C
   2668 C         C O N T E N T S   O F   T H E   A R R A Y   I P M S L
   2669 C         (MEAN SEA-LEVEL PRESSURE DATA FOR A SINGLE MASS PIECE)
   2670 C
   2671 C                             IPMSL(MXTYPV)
   2672 C
   2673 C          WHERE MXTYPV = MAX NUMBER OF "GROUPS" ASSIGNED TO A
   2674 C                         VARIABLE ON AN MOBS REPORT LEVEL
   2675 C          CURRENTLY = 3 {1 - PMSL OBSERVATION (UNITS: MB * 10);
   2676 C                         2 - PREPBUFR TABLE VALUE (QUALITY MARKER)
   2677 C                         3 - REASON CODE}
   2678 C
   2679 C      {IN ALL CASES, MISSING/NOT USED IS INITIALIZED AS IMISS (99999)}

Page 48          Source Listing                  PREPOBS_PREPDATA
2017-04-18 11:09                                 prepdata.f

   2680 C
   2681 C
   2682 C          C O N T E N T S   O F   T H E   A R R A Y   P W A T
   2683 C          (PRECIPITABLE WATER REPORT DATA FOR A SINGLE MASS PIECE)
   2684 C              (APPLIES ONLY TO GOES, SSM/I AND GPS-IPW REPORTS)
   2685 C
   2686 C                         PWAT(MXTYPV,MXPWT)
   2687 C
   2688 C          WHERE MXTYPV = MAX NUMBER OF "GROUPS" ASSIGNED TO A
   2689 C                         VARIABLE ON AN MOBS REPORT LEVEL
   2690 C          CURRENTLY = 3 {1 - PWATER OBSERVATION (UNITS: MM, WITH
   2691 C                             PRECISION TO NEAREST 10'TH MM)
   2692 C                         2 - PREPBUFR TABLE VALUE (QUALITY MARKER)
   2693 C                         3 - REASON CODE}
   2694 C
   2695 C          WHERE MXPWT  = INDICATOR OF TYPE (COLUMNAR EXTENT) OF
   2696 C                         PRECIPITABLE WATER OBSERVATION
   2697 C          CURRENTLY = 5 (AS INDICATED BELOW)
   2698 C
   2699 C     {IN ALL CASES, MISSING/NOT USED IS INITIALIZED AS XMISS (99999.)}
   2700 C
   2701 C                MXPWT = 1 --> TOTAL COLUMN
   2702 C                MXPWT = 2 --> 1.0 TO 0.9 SIGMA LAYER
   2703 C                MXPWT = 3 --> 0.9 TO 0.7 SIGMA LAYER
   2704 C                MXPWT = 4 --> 0.7 TO 0.3 SIGMA LAYER
   2705 C                MXPWT = 5 --> 0.3 TO 0.0 SIGMA LAYER
   2706 C
   2707 C
   2708 C         C O N T E N T S   O F   T H E   A R R A Y   G R A D
   2709 C          (GOES RADIANCE REPORT DATA FOR A SINGLE MASS PIECE)
   2710 C                    (APPLIES ONLY TO GOES REPORTS)
   2711 C
   2712 C                              GRAD(18)
   2713 C                    + POSSIBLE ANCILLARY DATA
   2714 C
   2715 C        GRAD - BRIGHTNESS TEMPERATURE OBSERVATION (UNITS: DEG. K);
   2716 C         (REAL NUMBER WITH PRECISION TO NEAREST 100'TH DEG. K)
   2717 C
   2718 C           {MISSING/NOT USED IS INITIALIZED AS XMISS (99999.)}
   2719 C
   2720 C
   2721 C        C O N T E N T S   O F   T H E   A R R A Y   R T R A D
   2722 C     (RTOVS OR ATOVS RADIANCE REPORT DATA FOR A SINGLE MASS PIECE)
   2723 C               (APPLIES ONLY TO RTOVS AND ATOVS REPORTS)
   2724 C
   2725 C                              RTRAD(35)
   2726 C                    + POSSIBLE ANCILLARY DATA
   2727 C
   2728 C       RTRAD - BRIGHTNESS TEMPERATURE OBSERVATION (UNITS: DEG. K);
   2729 C         (REAL NUMBER WITH PRECISION TO NEAREST 100'TH DEG. K)
   2730 C
   2731 C           {MISSING/NOT USED IS INITIALIZED AS XMISS (99999.)}
   2732 C              (32 CHANNELS FOR RTOVS, 35 CHANNELS FOR ATOVS)
   2733 C
   2734 C
   2735 C          C O N T E N T S   O F   T H E   A R R A Y   S R A D
   2736 C          (SSM/I RADIANCE REPORT DATA FOR A SINGLE MASS PIECE)

Page 49          Source Listing                  PREPOBS_PREPDATA
2017-04-18 11:09                                 prepdata.f

   2737 C                    (APPLIES ONLY TO SSM/I REPORTS)
   2738 C
   2739 C                              SRAD(7)
   2740 C
   2741 C        SRAD - BRIGHTNESS TEMPERATURE OBSERVATION (UNITS: DEG. K);
   2742 C         (REAL NUMBER WITH PRECISION TO NEAREST 100'TH DEG. K)
   2743 C
   2744 C           {MISSING/NOT USED IS INITIALIZED AS XMISS (99999.)}
   2745 C
   2746 C
   2747 C         C O N T E N T S   O F   T H E   A R R A Y   R E Q V
   2748 C           (RAIN RATE REPORT DATA FOR A SINGLE MASS PIECE)
   2749 C                    (APPLIES ONLY TO SSM/I REPORTS)
   2750 C                              -- OR --
   2751 C           (RAIN RATE REPORT DATA FOR A SINGLE WIND PIECE)
   2752 C                 (APPLIES ONLY TO WINDSAT REPORTS)
   2753 C
   2754 C                              REQV(1)
   2755 C
   2756 C              REQV - RAIN RATE OBSERVATION (UNITS: MM/SEC);
   2757 C   (REAL NUMBER WITH PRECISION TO NEAREST 10**6'TH MM/SEC FOR SSM/I
   2758 C                 AND TO NEAREST 10**4'TH MM/SEC FOR WINDSAT)
   2759 C
   2760 C           {MISSING/NOT USED IS INITIALIZED AS XMISS (99999.)}
   2761 C
   2762 C
   2763 C        C O N T E N T S   O F   T H E   A R R A Y   C L T O P
   2764 C          (CLOUD TOP REPORT REPORT DATA FOR A SINGLE MASS PIECE)
   2765 C                    (APPLIES ONLY TO GOES REPORTS)
   2766 C
   2767 C                            CLTOP(2,3)
   2768 C
   2769 C          WHERE FIRST ELEMENT OF ARRAY IS:
   2770 C                      1 FOR OBSERVATION
   2771 C                      2 FOR PREPBUFR TABLE VALUE (QUALITY MARKER)
   2772 C          AND SECOND ELEMENT OF ARRAY IS:
   2773 C                      1 FOR CLOUD TOP PRESSURE (OBS. IN MB PRECISE
   2774 C                         TO 10**1)
   2775 C                      2 FOR TOTAL CLOUD COVER (OBS. IN PER CENT
   2776 C                         PRECISE TO 10**0)
   2777 C                      3 FOR CLOUD TOP TEMPERATURE (OBS. IN KELVIN
   2778 C                         PRECISE TO 10**2)
   2779 C
   2780 C           {MISSING/NOT USED IS INITIALIZED AS XMISS (99999.)}
   2781 C
   2782 C
   2783 C----------------------------------------------------------------------
   2784 
   2785       PROGRAM PREPOBS_PREPDATA
   2786 
   2787 C PARAMETER NAME "MXWRDH" THROUGHOUT PGM SETS MAXIMUM NO. OF VARIABLES
   2788 C  IN THE REPORT HEADER
   2789       PARAMETER (MXWRDH = 15)
   2790 
   2791 C PARAMETER NAME "MXTYPV" THROUGHOUT PGM SETS MAXIMUM NO. GROUPS THAT
   2792 C  ARE ASSIGNED TO A VARIABLE ON AN MOBS REPORT LEVEL (CURRENTLY 3 -
   2793 C  OBS, PREPBUFR TABLE VALUE, AND PREPDATA REASON CODE)

Page 50          Source Listing                  PREPOBS_PREPDATA
2017-04-18 11:09                                 prepdata.f

   2794       PARAMETER (MXTYPV =  3)
   2795 
   2796 C PARAMETER NAME "MXWRDL" THROUGHOUT PGM SETS MAXIMUM NO. OF OBS/Q.M./
   2797 C  R.C., ETC. VARIABLE GROUPS ON AN MOBS REPORT LEVEL
   2798       PARAMETER (MXWRDL =  6)
   2799 
   2800 C PARAMETER NAME "MXLVL"  THROUGHOUT PGM SETS MAXIMUM NO. OF LEVELS THAT
   2801 C  CAN BE PROCESSED INTO THE FOLLOWING ARRAYS: MOBS, ICAT, DAT, TMP, IQ,
   2802 C  JQ, IR, JR, VDAT, VTMP, PP, ZP, TP, DP, QP, UP, VP, VV, CLAM, CLAL,
   2803 C  AND KS
   2804       PARAMETER (MXLVL = 600)
   2805 
   2806 C PARAMETER NAME "MXPWT" THROUGHOUT PGM SETS MAXIMUM NO. OF PRECIP.
   2807 C  WATER OBS/Q.M./R.C. ETC. GROUPS (CURRENTLY 5 - TOTAL COLUMN, 1.0-0.9
   2808 C  SIGMA LAYER, 0.9-0.7 SIGMA LAYER, 0.7-0.3 SIGMA LAYER, AND 0.3-0.0
   2809 C  SIGMA LAYER)
   2810       PARAMETER (MXPWT =  5)
   2811 
   2812 C PARAMETER NAME "NUMVAR" THROUGHOUT PGM SETS NO. OF OBS. VARIABLES
   2813 C  IN THE DAT AND TMP ARRAYS (UPPER-AIR DATA)
   2814 C PARAMETER NAME "NUMQMS" THROUGHOUT PGM SETS NO. OF OBS. PREPBUFR TBL
   2815 C  VALUES IN THE IQ (EQUIV. TO DAT) & JQ (EQUIV. TO TMP) ARRAYS (U-AIR)
   2816       PARAMETER (NUMVAR = 6, NUMQMS = 5)
   2817 C PARAMETER NAME "NUMDAT" THROUGHOUT PGM SETS SIZE OF DAT AND TMP ARRAYS
   2818       PARAMETER (NUMDAT = NUMVAR + (2 * NUMQMS))
   2819 
   2820 C PARAMETER NAME "NUMTYP" THROUGHOUT PGM SETS NO. OF POSSIBLE MASS
   2821 C  REPORT TYPES (NUMBER OF POSSIBLE WIND REPORT TYPES IS SAME AS THIS)
   2822       PARAMETER (NUMTYP = 74)
   2823 
   2824 C PARAMETER NAME "MAXOBS" THROUGHOUT PGM SETS MAX SIZE OF OBS ARRAY
   2825 C  IN INTERFACE WITH SUBROUTINE IW3UNPBF
   2826       PARAMETER (MAXOBS = 3500)
   2827 
   2828       CHARACTER*4   c2many_lvls
   2829       CHARACTER*5   CTYPE(2)
   2830       CHARACTER*6   CMXLVL
   2831       CHARACTER*8   STNPRT,STNID,SUBSET_d
   2832       CHARACTER*10  CDAT(8)
   2833       CHARACTER*14  NET(10)
   2834       CHARACTER*40  NAMEW(NUMTYP),NAMEM(NUMTYP)
   2835       LOGICAL  POLA,NORTH,RECCON,DROPSN,AIRLND,TOVEDS,GOESND,SATMST,
   2836      $ SWNLND,MARLND,PG4243,SPCIAL,FILLZ,FILLT,FILLW,FILLM,KTEMP,TR80KM,
   2837      $ PRFLER,TOVBFR,RECSLM,GOESPW,GOESCT,VADWIN,TOVRAD,TOVRTV,
   2838      $ PFRALT,AIFNOW,FLDMGS,FLDMAF,FLDMFR,FLACMS,GOESRD,PREVEN,APPEND,
   2839      $ SUBSKP,RASS,WRMISS,SKGP45,npkrpt,SKGNSS
   2840       REAL(8)  BMISS,GETBMISS,alon_8,alat_8
   2841       INTEGER  KTYPE(NUMTYP-1),NTYPE(NUMTYP-1),JITSM(NUMTYP),
   2842      $ JITSW(NUMTYP),IDATA(MAXOBS),IDAT(8)
   2843       character*8   cvstr
   2844       COMMON/WORD/LWI,LWR
   2845       COMMON/LNDSEA/GDSH(145,37),GDUS(362,91),GDNH(362,91)
   2846       COMMON/GRID/IGRD,JGRD,POLA,NORTH,ALONVT,POLEI,POLEJ,XMESHL,YNLIM,
   2847      $ YSLIM
   2848       COMMON/DATA/KOUNT,IDATE(4),IDAT10,MP_PROCESS,WRMISS
   2849       COMMON/RPTHDR/SUBSET_d,STNID,HDR(2:MXWRDH),alon_8,alat_8
   2850       COMMON/ADP/ISATOB,PMAND(23),RDATA(MAXOBS),IPRINT

Page 51          Source Listing                  PREPOBS_PREPDATA
2017-04-18 11:09                                 prepdata.f

   2851       COMMON/RUNSW/IRNMRK
   2852       COMMON/UNITNO/NFILE,IUNIT(28)
   2853       COMMON/SNDATA/DAT(MXLVL,NUMDAT)
   2854       COMMON/SATSW2/PHI(6),IRTRV(5,4,4),KTOP(5,4,4),IWINDO_e(5,4,4),
   2855      $ IWINDO_l(5,4,4),SATMST(5,4,4),ISATLS(5,4,4)
   2856       COMMON/SATSW3/PHISWN(7),SWNLND(6,8,10),SWINDO_e(6,8,10),
   2857      $ SWINDO_l(6,8,10),JSWIND(6,8,10),JSMASS(6,8,10),KEPSW(6,8,10),
   2858      $ KSKSWD(10),RFFL,QIFY,QIFN,EEQF
   2859       COMMON/ACFTSW/AWINDO(2,9),AIRLND(6,9),JAWIND(6,9),JAMASS(6,9),
   2860      $ IACFTL(9),IACFTH(9),PHIACF(7),KEPAC(6,9),AIFNOW(9),POAF,TRBX(5),
   2861      $ FLACMS(9),PCAT,ROLF,aMSTQ,RIALR
   2862       COMMON/TVSWCH/TOVEDS(2),TOVBFR(2),TR80KM,KNTTOV(2),
   2863      $ KSKPTV(2),KNOPTV(2),KIPTTV(2),KMSGTV(2),KBDYTV(2),KTIMTV(2),
   2864      $ KLNDTV(2),KSEATV(2),KREDTV(2),KJFLAG(2)
   2865       COMMON/GOSWCH/GOESND(2),GOESPW(2),GOESCT(2),KNTGIT,KNTGIS,KNTGIP,
   2866      $ KSKPGI,KNDCGI,KNOPGI,KMSGGI,KBDYGI,KTIMGI(3),KLNDGI(3),KSEAGI(3),
   2867      $ KNTGIC,KNOCTP
   2868       COMMON/LFMSFC/LFMAXI,LFMAXJ,FMESHL,FLONVT,FPOLEI,FPOLEJ,MARLND,
   2869      $ JSURFM(12),JSURFW(12),FWINDO(12),PFRALT,npkrpt(12)
   2870       COMMON/UPALIM/LEVPM,LEVST,LEVQQ,TDLIM,TDMAX,SPCIAL,ISQNUM_UPA
   2871       COMMON/COUNT/KKTYPE(100:299)
   2872       COMMON/PARM2/PG4243,KTEMP,i2many_lvls
   2873       COMMON/PARM3/RECCON,RWINDO,UWINDO,RECSLM,FLRECO,VWINDO,VADWIN,
   2874      $ IVADFL,IVADSP,FLDMGS,FLDMAF,FLDMFR,DROPSN,DWINDO
   2875       COMMON/PARM4/ICODE
   2876       COMMON/PARM5/FILLZ,FILLT,FILLW,FILLM,LSWIND,LSMASS,CWINDO,NPZ
   2877       COMMON/PARM6/MODPRT,IFLUA,STNPRT(3)
   2878       COMMON/SKPCNT/KSKPUA,KSKPSF,KMSGUA,KMSGSF,KBDYUA,KBDYSF,KTIMUA,
   2879      $ KTIMSF,KSKNSW,KSKREC,KNOATS,KNTUPA,KNTCAR,KNTAIR,KNTSWN,KNTPRO,
   2880      $ KNTVAD,KNTRAS,KNTDUM(3),KNTSFC,KNTSHP,KNTSLP,KNTMSO,KNTSPL,
   2881      $ KSKSWN,KSKACF,KNDCDE(3),KSKCLS,KSKTHN,KSKOMR(2),KSKALM(9),
   2882      $ KSKAHM(9),KSKNOW(9),KSKDRP
   2883       COMMON/MISWCH/XWINDO(6,4),JPSSMI(6,4),SRAD(7),KNTSMI(4),KTIMM(4),
   2884      $ KSKPMI,KMSGMI,KBDYMI
   2885       COMMON/SCTWCH/IEWNDO(2),JPERSD(6),IQWNDO(2),JPQKSD(6),IWWNDO(2),
   2886      $ JPWDSD(6),KSKPSC(4),KMSGSC(4),KBDYSC(4),KTIMSC(4),KNTSCT(4),
   2887      $ JPASCD(6),IAWNDO(2)
   2888       COMMON/RADANC/RTRAD(35),GRAD(18),IGCHN(18),SOZANG,SAZANG,OZONE,
   2889      $ SKINT,CLDAMT,TOVRAD,TOVRTV,GOESRD(2)
   2890       COMMON/GPSWCH/JPGPSD(6),GWINDO,KNTGPS,KSKPGP,KMSGGP,KBDYGP,KTIMGP,
   2891      $ KMISGP,KT45GP,SKGP45,SKGNSS,KTGNSS
   2892       COMMON/CLDTOP/CLTOP(2,3)
   2893       COMMON/PREVSW/PREVEN
   2894       COMMON/APDNSW/APPEND
   2895       COMMON/SKPSUB/SUBSKP(0:255,0:200)
   2896       COMMON/PFSWCH/PRFLER(4),PWINDO(4),PROFILERinADPUPA
   2897       COMMON/RASSSW/RASS,TWINDO
   2898       common/pstnflg/ipstnflg
   2899       COMMON /BUFRLIB_MISSING/BMISS
   2900       EQUIVALENCE (RDATA,IDATA)
   2901       DATA  IMISS/99999/
   2902       DATA  NET/'??????????????',' AFOS GRAPHIC ','***** GFS ****',
   2903      $          '**** RAP *****','**** GDAS ****','** NAM/NDAS **',
   2904      $          '  CDAS-REANL  ','HRLY- GOES CLD','**** RTMA ****',
   2905      $          '**** URMA ****'/
   2906       DATA  CTYPE/'RTOVS','ATOVS'/
   2907       DATA  JITSW/

Page 52          Source Listing                  PREPOBS_PREPDATA
2017-04-18 11:09                                 prepdata.f

   2908      $ 202,210,220,221,222,223,224,225,226,227,228,229,230,231,232,233,
   2909      $ 234,235,240,241,242,243,244,245,246,247,248,249,250,251,252,253,
   2910      $ 254,255,256,257,258,259,260,261,262,263,264,265,266,267,268,269,
   2911      $ 270,271,272,273,274,275,276,277,278,279,280,281,282,283,284,285,
   2912      $ 286,287,288,289,290,291,292,293,294,295/
   2913       DATA  NAMEW  /
   2914                                                ! PREPBUFR REPORT TYPE
   2915      $  '-- EMPTY --                             ',  ! 202
   2916      $  'UAIR: SYNTHETIC TROPICAL CYCLONE WINDS  ',  ! 210
   2917      $  'UAIR: RAWINSONDE                        ',  ! 220
   2918      $  'UAIR: PIBAL                             ',  ! 221
   2919      $  'UAIR: CLASS SOUNDING                    ',  ! 222
   2920      $  'UAIR: NOAA PROFILER NETWORK (NPN) WINDS ',  ! 223
   2921      $  'UAIR: VAD (NEXRAD)                      ',  ! 224
   2922      $  'UAIR: NEXRAD RADIAL WINDS               ',  ! 225
   2923      $  '-- EMPTY --                             ',  ! 226
   2924      $  'UAIR: COOPERATIVE AGENCY PROFILERS (CAP)',  ! 227
   2925      $  'UAIR: JAPANESE METEOR. AGENCY PROFILER  ',  ! 228
   2926      $  'UAIR: PROFILER FROM PILOT(PIBAL) BULLS. ',  ! 229
   2927      $  'ACFT: FLIGHT-LEVEL CNVENTNAL AIREP/PIREP',  ! 230
   2928      $  'ACFT: FLT-LVL AMDAR, AMDARB, (K/E)AMDAR ',  ! 231
   2929      $  'UAIR: RECONNAISSANCE OR DROPWINSONDES   ',  ! 232
   2930      $  'ACFT: FLIGHT-LEVEL MDCRS                ',  ! 233
   2931      $  'ACFT: FLIGHT-LEVEL TAMDAR(M/B)          ',  ! 234
   2932      $  'ACFT: FLIGHT-LEVEL CANADIAN AMDAR       ',  ! 235
   2933      $  '-- EMPTY --                             ',  ! 240
   2934      $  'SATWND: INDIA  INSAT/KLPNA IR(LW)/VZ C-D',  ! 241
   2935      $  'SATWND: JAPAN  GMS/MTST IR(LW)/VZ C-D LO',  ! 242
   2936      $  'SATWND: EUMSAT MTEOSAT IR(LW)/VZ C-DR LO',  ! 243
   2937      $  '-- EMPTY --                             ',  ! 244
   2938      $  'SATWND: NESDIS GOES    H-D IR(LW) CL DFT',  ! 245
   2939      $  'SATWND: NESDIS GOES    H-D IM WV/CL. TOP',  ! 246
   2940      $  'SATWND: NESDIS GOES    H-D IM WV/DEEP LY',  ! 247
   2941      $  'SATWND: NESDIS GOES    H-D SN WV/CL. TOP',  ! 248
   2942      $  'SATWND: NESDIS GOES    H-D SN WV/DEEP LY',  ! 249
   2943      $  'SATWND: JAPAN  GMS/MTSAT IM WV(C-T, D-L)',  ! 250
   2944      $  'SATWND: NESDIS GOES    H-D VZ CLD-DRIFT ',  ! 251
   2945      $  'SATWND: JAPAN  GMS/MTSAT IR(LW)/VZ CD HI',  ! 252
   2946      $  'SATWND: EUMSAT MTEOSAT IR(LW)/VZ C-DF HI',  ! 253
   2947      $  'SATWND: EUMSAT MTEOSAT IM WV (C-T, D-L) ',  ! 254
   2948      $  'SATWND: NESDIS GOES    PICTURE TRIPLET  ',  ! 255
   2949      $  'SATWND: INDIA INSAT/KALPANA IM WV(CT,DL)',  ! 256
   2950      $  'SATWND: NASA/MODIS POES IR(LW) CL-DRFT  ',  ! 257
   2951      $  'SATWND: NASA/MODIS POES IMGR WV/CLD. TOP',  ! 258
   2952      $  'SATWND: NASA/MODIS POES IMGR WV/DEEP LYR',  ! 259
   2953      $ 10*'-- EMPTY --                             ',! 260-9
   2954      $  '* - CONSTANT-LEVEL BALLOON (PSEUDO)     ',  ! 270
   2955      $  9*'-- EMPTY --                             ',! 271-9
   2956      $  'SFC: MARINE (VALID STATION PRESSURE)    ',  ! 280
   2957      $  'SFC: LAND (VALID STATION PRESSURE)      ',  ! 281
   2958      $  'SFC: MARINE ATLAS BUOYS                 ',  ! 282
   2959      $  'SFC: SSM-I WIND SPEED (DIR SET TO ZERO) ',  ! 283
   2960      $  'SFC: LAND or MARINE, MISSING STN PRESS  ',  ! 284
   2961      $  'SFC: QUIKSCAT SCATTEROMETER             ',  ! 285
   2962      $  'SFC: ERS SCATTEROMETER                  ',  ! 286
   2963      $  'SFC: LAND, MISSING STATION PRESSURE     ',  ! 287
   2964      $  'SFC: MESONET (COOPERATIVE NETWORKS)     ',  ! 288

Page 53          Source Listing                  PREPOBS_PREPDATA
2017-04-18 11:09                                 prepdata.f

   2965      $  'SFC: WINDSAT SCATTEROMETER              ',  ! 289
   2966      $  'SFC: ASCAT SCATTEROMETER                ',  ! 290
   2967      $  '-- EMPTY --                             ',  ! 291
   2968      $  'SFC: SYNOP LAND, MSG STN AND MSL PRESS  ',  ! 292
   2969      $  'SFC: METAR, MSG STN AND MSL PRESSURE    ',  ! 293
   2970      $  'SFC: SHIP/CMAN/BUOY, MSG STN & MSL PRES ',  ! 294
   2971      $  'SFC: MESONET, MSG STN AND MSL PRESS     '/  ! 295
   2972       DATA  NAMEM  /
   2973                                                ! PREPBUFR REPORT TYPE
   2974      $  'SATSND: SSM-I 7-CHANNEL BRIGHTNESS TEMP.',  ! 102
   2975      $  '-- EMPTY --                             ',  ! 110
   2976      $  'UAIR: RAWINSONDE                        ',  ! 120
   2977      $  '-- EMPTY --                             ',  ! 121
   2978      $  'UAIR: CLASS SOUNDING                    ',  ! 122
   2979      $  '-- EMPTY --                             ',  ! 123
   2980      $  2*'-- EMPTY --                             ',! 124-5
   2981      $  'UAIR: NPN OR CAP RASS                   ',  ! 126
   2982      $  3*'-- EMPTY --                             ',! 127-9
   2983      $  'ACFT: FLIGHT-LVL CNVENTNAL AIREP/PIREP  ',  ! 130
   2984      $  'ACFT: FLT-LVL AMDAR, AMDARB, (K/E)AMDAR ',  ! 131
   2985      $  'UAIR: RECONNAISSANCE OR DROPWINSONDES   ',  ! 132
   2986      $  'ACFT: FLIGHT-LEVEL MDCRS                ',  ! 133
   2987      $  'ACFT: FLIGHT-LEVEL TAMDAR(M/B)          ',  ! 134
   2988      $  'ACFT: FLIGHT-LEVEL CANADIAN AMDAR       ',  ! 135
   2989      $  '-- EMPTY --                             ',  ! 140
   2990      $  'SATWND: INDIA  INSAT/KLPNA IR(LW)/VZ C-D',  ! 141
   2991      $  'SATWND: JAPAN  GMS/MTSAT IR(LW)/VZ C-DFT',  ! 142
   2992      $  'SATWND: EUMSAT MTEOSAT IR(LW)/VZ CL-DRFT',  ! 143
   2993      $  'SATWND: NESDIS GOES    H-D VZ CLD-DRIFT ',  ! 144
   2994      $  'SATWND: NESDIS GOES    H-D IR(LW) CL DFT',  ! 145
   2995      $  'SATWND: NESDIS GOES    H-D IM WV/CL. TOP',  ! 146
   2996      $  'SATWND: NESDIS GOES    H-D IM WV/DEEP LY',  ! 147
   2997      $  'SATWND: NESDIS GOES    H-D SN WV/CL. TOP',  ! 148
   2998      $  'SATWND: NESDIS GOES    H-D SN WV/DEEP LY',  ! 149
   2999      $  'MOISTR: SSM-I RAIN RATE RETRIEVAL       ',  ! 150
   3000      $  'SATSND: GOES CLOUD TOP RETRIEVAL        ',  ! 151
   3001      $  'MOISTR: SSM-I PRECIP. WATER RETRIEVAL   ',  ! 152
   3002      $  'MOISTR: GPS INTEGR. PWATR/ZENITH TOT DLY',  ! 153
   3003      $  2*'-- EMPTY --                             ',! 154-5
   3004      $  'MOISTR: GOES PR. WATER RETR-LAND/CLEAR  ',  ! 156
   3005      $  'MOISTR: GOES PR. WATER RETR-LAND/CLOUDY ',  ! 157
   3006      $  'MOISTR: GOES PR. WATER RETR-SEA/CLEAR   ',  ! 158
   3007      $  'MOISTR: GOES PR. WATER RETR-SEA/CLOUDY  ',  ! 159
   3008      $  '-- EMPTY --                             ',  ! 160
   3009      $  'SATSND: RTOVS/ATOVS RAD/SNDG-LAND/CLEAR ',  ! 161
   3010      $  '-- EMPTY --                             ',  ! 162
   3011      $  'SATSND: RTOVS/ATOVS RAD/SNDG-LAND/CLOUDY',  ! 163
   3012      $  'SATSND: GOES RADIANCE/SNDG-LAND/CLEAR   ',  ! 164
   3013      $  'SATSND: GOES RADIANCE/SNDG-LAND/CLOUDY  ',  ! 165
   3014      $  4*'-- EMPTY --                             ',! 166-9
   3015      $  '-- EMPTY --                             ',  ! 170
   3016      $  'SATSND: RTOVS/ATOVS RAD/SNDG-SEA/CLEAR  ',  ! 171
   3017      $  '-- EMPTY --                             ',  ! 172
   3018      $  'SATSND: RTOVS/ATOVS RAD/SNDG-SEA/CLOUDY ',  ! 173
   3019      $  'SATSND: GOES RADIANCE/SNDG-SEA/CLEAR    ',  ! 174
   3020      $  'SATSND: GOES RADIANCE/SNDG-SEA/CLOUDY   ',  ! 175
   3021      $  4*'-- EMPTY --                             ',! 176-9

Page 54          Source Listing                  PREPOBS_PREPDATA
2017-04-18 11:09                                 prepdata.f

   3022      $  'SFC: MARINE (VALID STATION PRESSURE)    ',  ! 180
   3023      $  'SFC: LAND (VALID STATION PRESSURE)      ',  ! 181
   3024      $  'SFC: SPLASH-LVL (DROP OR RECCO W/ PMSL) ',  ! 182
   3025      $  'SFC: LAND or MARINE, MISSING STN PRESS  ',  ! 183
   3026      $  3*'-- EMPTY --                             ',! 184-6
   3027      $  'SFC: LAND, MISSING STATION PRESSURE     ',  ! 187
   3028      $  'SFC: MESONET (COOPERATIVE NETWORKS)     ',  ! 188
   3029      $  '-- EMPTY --                             ',  ! 189
   3030      $  'SFCBOG: OPC/NOS POINT PMSL BOGUS        ',  ! 190
   3031      $  'SFCBOG: AUSTRALIAN PAOB PMSL BOGUS      ',  ! 191
   3032      $  'SFC: SYNOP LAND, MSG STN AND MSL PRESS  ',  ! 192
   3033      $  'SFC: METAR, MSG STN AND MSL PRESSURE    ',  ! 193
   3034      $  'SFC: SHIP/CMAN/BUOY, MSG STN & MSL PRES ',  ! 194
   3035      $  'SFC: MESONET, MSG STN AND MSL PRESS     '/  ! 195
   3036 
   3037       NAMELIST/TASK/MP_PROCESS
   3038       NAMELIST/GBLEVN/PREVEN
   3039       NAMELIST/RGRID/IGRD,JGRD,POLA,NORTH,ALONVT,POLEI,POLEJ,XMESHL
   3040       NAMELIST/LDTA/IRNMRK,RECCON,AIRLND,JAWIND,TOVEDS,GOESND,SWINDO_e,
   3041      $ SWINDO_l,SWNLND,JSWIND,PHI,IWINDO_e,IWINDO_l,SATMST,IRTRV,KTOP,
   3042      $ MARLND,LFMAXI,DROPSN,LFMAXJ,FMESHL,FLONVT,FPOLEI,FPOLEJ,PG4243,
   3043      $ MODPRT,LEVPM,LEVST,LEVQQ,TDLIM,TDMAX,AWINDO,RWINDO,UWINDO,JSURFM,
   3044      $ JSURFW,FWINDO,SPCIAL,JAMASS,JSMASS,KTEMP,PHISWN,STNPRT,XWINDO,
   3045      $ JPSSMI,TR80KM,FILLZ,FILLT,FILLW,FILLM,PRFLER,PWINDO,LSWIND,
   3046      $ LSMASS,CWINDO,TOVBFR,RECSLM,IPRINT,IACFTL,GOESPW,PHIACF,VADWIN,
   3047      $ VWINDO,TOVRAD,TOVRTV,PFRALT,IEWNDO,JPERSD,AIFNOW,FLDMGS,FLDMAF,
   3048      $ GOESRD,IVADFL,IVADSP,ISATLS,DWINDO,JPQKSD,IQWNDO,GOESCT,APPEND,
   3049      $ FLACMS,IACFTH,SUBSKP,JPGPSD,GWINDO,RASS,TWINDO,JPWDSD,IWWNDO,
   3050      $ FLDMFR,WRMISS,SKGP45,JPASCD,IAWNDO,npkrpt,SKGNSS
   3051       NAMELIST/PARM/IUNIT
   3052       CALL W3TAGB('PREPOBS_PREPDATA',2017,0011,0070,'NP22')
   3053 C DETERMINE MACHINE WORD LENGTH (BYTES) FOR BOTH INTEGERS AND REALS
   3054       CALL WORDLENGTH(LWI,LWR)
   3055       PRINT 2213, LWI,LWR
   3056  2213 FORMAT(/' ---> MACHINE WORD LENGTH (BYTES) FOR INTEGER WORDS IS ',
   3057      $ I3/' ---> MACHINE WORD LENGTH (BYTES) FOR   REAL  WORDS IS ',I3/)
   3058 C SWITCH DEFAULTS FOR VARIABLES NOT INITIALIZED IN BLOCK DATA
   3059       IRNMRK = -99
   3060 C READ IN NAMELISTS TASK, GBLEVN, RGRID, LDTA AND PARM TO ESTABLISH
   3061 C  SWITCHES
   3062 C   (IF NAMELIST TASK NOT FOUND, THEN SWITCH MP_PROCESS SET TO 0; THIS
   3063 C    NAMELIST IS NORMALLY CAT'ED TO THE BEGINNING OF THE DATA CARDS
   3064 C    FILE BY THE MAKE_PREPBUFR SCRIPT)
   3065 C   (IF NAMELIST GBLEVN NOT FOUND, THEN SWITCH PREVEN SET TO FALSE;
   3066 C    THIS NAMELIST IS NORMALLY CAT'ED TO THE BEGINNING OF THE DATA
   3067 C    CARDS FILE, JUST AFTER NAMELIST TASK, BY THE MAKE_PREPBUFR SCRIPT)
   3068       MP_PROCESS = 0
   3069       READ(5,TASK,ERR=886,END=886)
   3070   886 CONTINUE
   3071       PREVEN = .FALSE.
   3072       READ(5,GBLEVN,ERR=887,END=887)
   3073   887 CONTINUE
   3074       REWIND 5
   3075       READ(5,RGRID)
   3076       READ(5,LDTA)
   3077       READ(5,PARM)
   3078       IF(.NOT.TOVBFR(1).AND..NOT.TOVBFR(2))  THEN

Page 55          Source Listing                  PREPOBS_PREPDATA
2017-04-18 11:09                                 prepdata.f

   3079          TOVRAD = .FALSE.
   3080          TOVRTV = .FALSE.
   3081       END IF
   3082       IF(TOVBFR(1).OR.TOVBFR(2))  THEN
   3083          TOVEDS(1) = .FALSE.
   3084          TOVEDS(2) = .FALSE.
   3085       ELSE IF(TOVEDS(1).OR.TOVEDS(2))  THEN
   3086          TOVBFR(1) = .FALSE.
   3087          TOVBFR(2) = .FALSE.
   3088       END IF
   3089       IF(IRNMRK.GT.0.AND.IRNMRK.LT.11)  THEN
   3090          PRINT 321, NET(IRNMRK)
   3091       ELSE
   3092          PRINT 321, NET(1)
   3093       END IF
   3094   321 FORMAT(/37X,'WELCOME TO THE UNIVERSAL ',A14,' DATA PREPROCESSOR'/
   3095      $ 48X,'WCOSS VERSION CREATED 11 Jan 2017')
   3096       call bvers(cvstr)
   3097       print 3211, cvstr
   3098  3211 FORMAT(48X,'--BUFRLIB VERSION USED = v',a,/)
   3099       PRINT 322, (IUNIT(I),I=1,8),IUNIT(16),IUNIT(17)
   3100   322 FORMAT(//53X,'TABLE OF UNIT NUMBERS'/31X,
   3101      $ 'INPUTS IN UNIT NUMBERS 11-50 - OUTPUTS IN UNIT NUMBERS 51-90'//
   3102      $ 36X,'NCEP PRODUCTION DATE IN UNIT ........................ ',I5/
   3103      $ 36X,'BUFR TABLE FILE GROUP OF 3 SEQUENTIAL FROM UNIT ..... ',I5/
   3104      $ 36X,'FIXED FIELD FILE GROUP OF 3 SEQUENTIAL FROM UNIT .... ',I5/
   3105      $ 36X,'BACKGROUND FILE GROUP OF 3 SEQUENTIAL FROM UNIT ..... ',I5/
   3106      $ 36X,'UPPER-AIR FILE GROUP OF 10 SEQUENTIAL FROM UNIT ..... ',I5/
   3107      $ 36X,'SURFACE FILE GROUP OF 10 SEQUENTIAL FROM UNIT ....... ',I5/
   3108      $ 36X,'POLAR-ORBITING SAT. SNDG GROUP OF 5 SEQ. FROM UNIT .. ',I5/
   3109      $ 36X,'GOES SATELLITE SNDG GROUP OF 4 SEQUENTIAL FROM UNIT . ',I5/
   3110      $ 36X,'PREPBUFR DATA FILE IN UNIT .......................... ',I5/
   3111      $ 36X,'"PREVENT" EVENTS SUMMARY PRINT FILE IN UNIT ......... ',I5)
   3112 C READ PRODUCTION DATE
   3113       READ(IUNIT(1),'(6X,I10)',END=326)  IDAT10
   3114 C SPLIT PRODUCTION DATE INTO COMPONENTS (IDATE)
   3115       IDATE(1) = IDAT10/1000000
   3116       IDATE(2) = MOD((IDAT10/10000),100)
   3117       IDATE(3) = MOD((IDAT10/100),100)
   3118       IDATE(4) = MOD(IDAT10,100)
   3119       PRINT 324, IDATE
   3120   324 FORMAT(//23X,'ALL INPUT DATA SETS WILL BE CHECKED AGAINST THE ',
   3121      $ 'NCEP PRODCUTION DATE: ',I4.4,2('-',I2.2),1X,I2.2,'Z'/)
   3122       CALL W3LOCDAT(IDAT)
   3123       CALL W3PRADAT(IDAT,CDAT)
   3124       PRINT 357, CDAT(2),CDAT(3),CDAT(6),CDAT(7),CDAT(1),IUNIT(16)
   3125   357 FORMAT(/31X,'CURRENT WALL CLOCK TIME: ',A3,1X,A8,' - ',A8,A4,
   3126      $ ' LST -- ',A10//36X,'OUTPUT IS THROUGH INTERFACE TO PREPBUFR ',
   3127      $ 'DATA SET ON UNIT',I3//)
   3128 C PRINT OUT NAMELISTS TASK, GBLEVN, RGRID, LDTA & PARM
   3129       WRITE(6,TASK)
   3130       WRITE(6,GBLEVN)
   3131       WRITE(6,RGRID)
   3132       PRINT 999
   3133   999 FORMAT(' ')
   3134       WRITE(6,LDTA)
   3135       PRINT 999

Page 56          Source Listing                  PREPOBS_PREPDATA
2017-04-18 11:09                                 prepdata.f

   3136       WRITE(6,PARM)
   3137       NEWPRT = MODPRT/4
   3138       IF(MODPRT.GT.0)  THEN
   3139          PRINT 332
   3140   332    FORMAT(/)
   3141          PRINT 334, MODPRT
   3142   334    FORMAT(/13X,'>>> A COMPLETE LISTING OF EVERY ',I3,'-TH ADPUPA',
   3143      $    ' AND SAT. RADIANCE/RETRIEVAL REPORT WILL BE PRINTED OUT <<<')
   3144          PRINT 335, NEWPRT
   3145   335    FORMAT(/2X,'>>> EVERY ',I3,'-TH FILLED REPORT IN "HDR/MOBS/',
   3146      $    'IPMSL/PWAT/xRAD/REQV/CLTOP" ARRAYS WILL BE PRINTED OUT (FOR',
   3147      $    ' EACH DATA TYPE) <<<')
   3148       END IF
   3149 
   3150 C  On WCOSS should always set BUFRLIB missing (BMISS) to 10E8 to avoid
   3151 C   overflow when either an INTEGER*4 variable is set to BMISS or a
   3152 C   REAL*8 (or REAL*4) variable that is missing is NINT'd
   3153 C  -------------------------------------------------------------------
   3154 ccccc CALL SETBMISS(10E10_8)
   3155       CALL SETBMISS(10E8_8)
   3156       BMISS=GETBMISS()
   3157       print'(1X)'
   3158       print'(" BUFRLIB value for missing is: ",G0)', bmiss
   3159       print'(1X)'
   3160 
   3161 C DETERMINE SOUTH AND NORTH LATITUDE BOUNDARIES FOR DATA SEARCH AREA
   3162       YSLIM = ALONVT
   3163       YNLIM = YSLIM + ((JGRD - 1) * POLEI)
   3164       IF(POLA)  THEN
   3165          IF(NORTH)  THEN
   3166             YSLIM = -20.
   3167          ELSE
   3168             YNLIM = 20.
   3169          END IF
   3170       END IF
   3171 C-----------------------------------------------------------------------
   3172 C READ IN N.H. LAND-SEA GRID (1 DEG.), S.H. LAND-SEA GRID (2.5 DEG.)
   3173 C  AND CONUS GRID (1 DEG.)
   3174 C  GRIDS DEFINED AS FOLLOWS:
   3175 C        GDNH (NH LAND-SEA) - =0.0 SEA; =1.0 LAND
   3176 C        GDSH (SH LAND-SEA) - =0.0 SEA; =1.0 LAND
   3177 C        GDUS (NH GEOGR.)   - =2.0 U.S. MAINLAND; =1.0 ADJOINING
   3178 C         GULF OF MEXICO AND CANADA SOUTH OF 49N LAT; =0.0 REST OF N.H.
   3179       PRINT 101, IUNIT(3)
   3180   101 FORMAT(/,1X,'**** OPEN UNIT ',I2,' TO GET N.H./S.H. LAND-SEA ',
   3181      $ 'GRIDS &  N.H. CONUS GRID FOR LOCATION CHECKS ****')
   3182       READ(IUNIT(3),ERR=14,END=14)  GDNH
   3183       READ(IUNIT(3),ERR=14,END=14)  GDSH
   3184       READ(IUNIT(3),ERR=14,END=14)  GDUS
   3185       GO TO 12
   3186    14 CONTINUE
   3187 C ERROR READING FILE -- STOP 49
   3188       PRINT 102
   3189   102 FORMAT(/5X,'###### ERROR READING LAND-SEA-U.S. MASK FILE -- ',
   3190      $ 'STOP 49'/)
   3191       CALL W3TAGE('PREPOBS_PREPDATA')
   3192       CALL ERREXIT(49)

Page 57          Source Listing                  PREPOBS_PREPDATA
2017-04-18 11:09                                 prepdata.f

   3193    12 CONTINUE
   3194 C-----------------------------------------------------------------------
   3195 C CALL SUBR. PREP TO INITIATE PREPROCESSING OF ALL TYPES OF DATA
   3196       CALL PREP
   3197 C CALL W3FIZZ WITH HDR(3) = IMISS (99999): SIGNALS TO BUFR INTERFACE
   3198 C  THAT LAST INCOMPLETE BUFR MESSAGE SHOULD BE WRITTEN OUT
   3199       HDR(3) = IMISS
   3200       CALL W3FIZZ(IER)
   3201       PRINT 401
   3202   401 FORMAT(/33X,21('-'),' ***** SUMMARY ***** ',21('-'))
   3203       PRINT 950
   3204   950 FORMAT(//54X,'>>> UPPER-AIR DATA <<<'/28X,'(INCLUDES ADPUPA',
   3205      $ ', AIRCFT, AIRCAR, SATWND, PROFLR, VADWND AND RASSDA FILES)')
   3206       PRINT 1951, KNTUPA,KNTAIR,KNTSWN,KNTCAR,KNTPRO,KNTVAD,KNTRAS,
   3207      $ KSKPUA,KMSGUA,KBDYUA,KTIMUA,KSKOMR(1),KNOATS,KSKNSW,KSKSWD,
   3208      $ KSKREC,KSKDRP,KNDCDE,KSKCLS
   3209  1951 FORMAT(/,35X,
   3210      $ 'NUMBER OF UNPACKED ADPUPA REPORTS PROCESSED      = ',I8,/,35X,
   3211      $ 'NUMBER OF UNPACKED AIRCFT REPORTS PROCESSED      = ',I8,/,35X,
   3212      $ 'NO. UNPKD SATWND (MASS/WND; ALL TYPES) RPTS PROC.= ',I8,/,35X,
   3213      $ 'NUMBER OF UNPACKED AIRCAR (MDCRS) REPORTS PROC.  = ',I8,/,35X,
   3214      $ 'NUMBER OF UNPACKED PROFILER REPORTS PROCESSED    = ',I8,/,35X,
   3215      $ 'NUMBER OF UNPACKED VAD(NEXRAD) REPORTS PROCESSED = ',I8,/,35X,
   3216      $ 'NUMBER OF UNPACKED RASS REPORTS PROCESSED        = ',I8,/,35X,
   3217      $ 'TOTAL NO. OF UNPACKED REPORTS SKIPPED (ALL U-AIR)= ',I8,/,35X,
   3218      $ '   -- NUMBER WITH MISSING LATITUDE OR LONGITUDE  = ',I8,/,35X,
   3219      $ '   -- NUMBER OUTSIDE DATA EXTRACTION BOUNDARY    = ',I8,/,35X,
   3220      $ '   -- NUMBER OUTSIDE TIME INTERVAL               = ',I8,/,35X,
   3221      $ '   -- NUMBER OVERLAND OCEAN STATION REPORTS      = ',I8,/,35X,
   3222      $ '   -- NUMBER OF OLD-TYPE "CLOUD" WIND EST. RPTS. = ',I8,/,35X,
   3223      $ '   -- NUMBER OF SATWND REPORTS WITH INVALID        ',8X,/,35X,
   3224      $ '       PRODUCER/SATELLITE/PRODUCT COMBINATION    = ',I8,/,35X,
   3225      $ '   -- NO. SATWND (ALL PRODUCERS/SATELLITES)...        ',/,35X,
   3226      $ '          CONVENTIONAL IR (LONG-WAVE) CLOUD DRIFT= ',I8,/,35X,
   3227      $ '          CONVENTIONAL IMGR WTR VPR(CL-TOP,D-LYR)= ',I8,/,35X,
   3228      $ '          CONVENTIONAL VISIBLE CLOUD DRIFT       = ',I8,/,35X,
   3229      $ '          HI-DENSITY IR (LONG-WAVE) CLOUD DRIFT  = ',I8,/,35X,
   3230      $ '          HI-DENSITY VISIBLE CLOUD DRIFT         = ',I8,/,35X,
   3231      $ '          HI-DENSITY IMAGER  WATER VAPOR-CLD TOP = ',I8,/,35X,
   3232      $ '          HI-DENSITY IMAGER  WATER VAPOR-DEEP LYR= ',I8,/,35X,
   3233      $ '          HI-DENSITY SOUNDER WATER VAPOR-CLD TOP = ',I8,/,35X,
   3234      $ '          HI-DENSITY SOUNDER WATER VAPOR-DEEP LYR= ',I8,/,35X,
   3235      $ '          PICTURE TRIPLET CLOUD DRIFT            = ',I8,/,35X,
   3236      $ '   -- NO. SKIPPED RECONNAISSANCE RPTS (RECCON=F) = ',I8,/,35X,
   3237      $ '   -- NO. SKIPPED DROPWINSONDE REPORTS (DROPSN=F)= ',I8,/,35X,
   3238      $ '   -- NO. PROFILER RPTS THAT COULD NOT BE DECODED= ',I8,/,35X,
   3239      $ '   -- NO. VAD REPORTS THAT COULD NOT BE DECODED  = ',I8,/,35X,
   3240      $ '   -- NO. RASS REPORTS THAT COULD NOT BE DECODED = ',I8,/,35X,
   3241      $ '   -- NUMBER OF CLASS SOUNDINGS                  = ',I8)
   3242       PRINT 1958, KSKSWN,KSKACF,(IACFTL(II),KSKALM(II),II=1,9),
   3243      $ (IACFTH(II),KSKAHM(II),II=1,9),(KSKNOW(II),II=1,9)
   3244  1958 FORMAT(35X,
   3245      $ 'COUNT OF RPTS FLAGGED (TBL. VAL. SET TO 15, ALL VARIABLES)'/35X,
   3246      $ '   -- NO. SATWND (ALL COMBN/TYPES) RPTS OVER LAND= ',I8,/,35X,
   3247      $ '   -- NO. OF AIRCRAFT FLIGHT LVL RPTS OVER LAND  = ',I8,/,35X,
   3248      $ '   -- NO. OF AIREP/PIREP RPTS BELOW',I6,' METERS = ',I8,/,35X,
   3249      $ '   -- NO. OF AMDAR  ACFT RPTS BELOW',I6,' METERS = ',I8,/,35X,

Page 58          Source Listing                  PREPOBS_PREPDATA
2017-04-18 11:09                                 prepdata.f

   3250      $ '   -- NO. OF EAMDAR ACFT RPTS BELOW',I6,' METERS = ',I8,/,35X,
   3251      $ '   -- NO. OF MDCRS  ACFT RPTS BELOW',I6,' METERS = ',I8,/,35X,
   3252      $ '   -- NO. OF TAMDARM ACF RPTS BELOW',I6,' METERS = ',I8,/,35X,
   3253      $ '   -- NO. OF CAMDAR ACFT RPTS BELOW',I6,' METERS = ',I8,/,35X,
   3254      $ '   -- NO. OF KAMDAR ACFT RPTS BELOW',I6,' METERS = ',I8,/,35X,
   3255      $ '   -- NO. OF AMDARB ACFT RPTS BELOW',I6,' METERS = ',I8,/,35X,
   3256      $ '   -- NO. OF TAMDARB ACF RPTS BELOW',I6,' METERS = ',I8,/,35X,
   3257      $ '   -- NO. OF AIREP/PIREP RPTS ABOVE',I6,' METERS = ',I8,/,35X,
   3258      $ '   -- NO. OF AMDAR  ACFT RPTS ABOVE',I6,' METERS = ',I8,/,35X,
   3259      $ '   -- NO. OF EAMDAR ACFT RPTS ABOVE',I6,' METERS = ',I8,/,35X,
   3260      $ '   -- NO. OF MDCRS  ACFT RPTS ABOVE',I6,' METERS = ',I8,/,35X,
   3261      $ '   -- NO. OF TAMDARM ACF RPTS ABOVE',I6,' METERS = ',I8,/,35X,
   3262      $ '   -- NO. OF CAMDAR ACFT RPTS ABOVE',I6,' METERS = ',I8,/,35X,
   3263      $ '   -- NO. OF KAMDAR ACFT RPTS ABOVE',I6,' METERS = ',I8,/,35X,
   3264      $ '   -- NO. OF AMDARB ACFT RPTS ABOVE',I6,' METERS = ',I8,/,35X,
   3265      $ '   -- NO. OF TAMDARB ACF RPTS ABOVE',I6,' METERS = ',I8,/,35X,
   3266      $ '   -- NO. AIREP/PIR. RPTS W/MSG WIND & VALID MASS= ',I8,/,35X,
   3267      $ '   -- NO. AMDAR ACFT RPTS W/MSG WIND & VALID MASS= ',I8,/,35X,
   3268      $ '   -- NO. EAMDAR ACFT RPTS W/MSG WND & VALID MASS= ',I8,/,35X,
   3269      $ '   -- NO. MDCRS ACFT RPTS W/MSG WIND & VALID MASS= ',I8,/,35X,
   3270      $ '   -- NO. TAMDARM ACF RPTS W/MSG WND & VALID MASS= ',I8,/,35X,
   3271      $ '   -- NO. CAMDAR ACFT RPTS W/MSG WND & VALID MASS= ',I8,/,35X,
   3272      $ '   -- NO. KAMDAR ACFT RPTS W/MSG WND & VALID MASS= ',I8,/,35X,
   3273      $ '   -- NO. AMDARB ACFT RPTS W/MSG WND & VALID MASS= ',I8,/,35X,
   3274      $ '   -- NO. TAMDARB ACF RPTS W/MSG WND & VALID MASS= ',I8)
   3275       DO  II = 1,2
   3276          IF(TOVBFR(II).OR.TOVEDS(II))  THEN
   3277             PRINT 3990, CTYPE(II)
   3278  3990 FORMAT(//49X,'>>>  ',A5,' SATELLITE REPORTS  <<<')
   3279             IF(TOVBFR(II))  THEN
   3280                IF(TOVRAD)  PRINT 7990
   3281  7990          FORMAT(/50X,'>>>  RADIANCES PROCESSED <<<')
   3282                IF(TOVRTV)  PRINT 7991
   3283  7991          FORMAT(/45X,'>>>  40-LEVEL RETRIEVALS PROCESSED <<<')
   3284             ELSE  IF(TOVEDS(II))  THEN
   3285                PRINT 7992
   3286  7992          FORMAT(/46X,'>>>  NMCEDS RETRIEVALS PROCESSED <<<')
   3287             END IF
   3288             PRINT 991, CTYPE(II),KNTTOV(II),KSKPTV(II),KNOPTV(II),
   3289      $       KIPTTV(II),KMSGTV(II),KBDYTV(II),KTIMTV(II),KLNDTV(II),
   3290      $       KSEATV(II),KREDTV(II),KJFLAG(II)
   3291   991       FORMAT(/,35X,
   3292      $ 'NUMBER OF UNPACKED ',A5,' REPORTS PROCESSED       = ',I8,/,35X,
   3293      $ 'TOTAL NO. OF UNPACKED REPORTS SKIPPED            = ',I8,/,35X,
   3294      $ ' *** NO. SKIPPED BY FOLLOWING CHECKS (IN THIS ORDER) ***'/35X,
   3295      $ '   -- NUMBER FROM NON-OPERATIONAL SATELLITES     = ',I8,/,35X,
   3296      $ '   -- NUMBER FROM INVALID PATHS (INSTRUMENTS)    = ',I8,/,35X,
   3297      $ '   -- NUMBER WITH MISSING LATITUDE OR LONGITUDE  = ',I8,/,35X,
   3298      $ '   -- NUMBER OUTSIDE DATA EXTRACTION BOUNDARY    = ',I8,/,35X,
   3299      $ '   -- NUMBER OUTSIDE TIME INTERVAL               = ',I8,/,35X,
   3300      $ '   -- NUMBER OF OVERLAND REPORTS                 = ',I8,/,35X,
   3301      $ '   -- NUMBER OF OCEANIC REPORTS                  = ',I8,/,35X,
   3302      $ '   -- NUMBER OF SKIPPED TR80KM=F OR BAD REPORTS  = ',I8,/,35X,
   3303      $ '   -- NO. W/ NON-0 STATUS FROM W3XTOVSMND(NMCEDS)= ',I8)
   3304          END IF
   3305       ENDDO
   3306       IF(GOESND(1).OR.GOESPW(1).OR.GOESRD(1).OR.GOESCT(1).OR.GOESND(2).

Page 59          Source Listing                  PREPOBS_PREPDATA
2017-04-18 11:09                                 prepdata.f

   3307      $ OR.GOESPW(2).OR.GOESRD(2).OR.GOESCT(2))  THEN
   3308          PRINT 590
   3309   590 FORMAT(//48X,'>>>  GOES SATELLITE REPORTS  <<<')
   3310          IF(GOESRD(1))  PRINT 8990
   3311  8990 FORMAT(/46X,'---  GOES 5x5 RADIANCES PROCESSED ---')
   3312          IF(GOESRD(2))  PRINT 8993
   3313  8993 FORMAT(/46X,'---  GOES 1x1 RADIANCES PROCESSED ---')
   3314          IF(GOESND(1))  PRINT 8991
   3315  8991 FORMAT(/42X,'---  GOES 5x5 PROFILE SOUNDINGS PROCESSED ---')
   3316          IF(GOESND(2))  PRINT 8994
   3317  8994 FORMAT(/42X,'---  GOES 1x1 PROFILE SOUNDINGS PROCESSED ---')
   3318          IF(GOESPW(1))  PRINT 8992
   3319  8992 FORMAT(/38X,'---  GOES 5x5 PRECIP. WATER RETRIEVALS PROCESSED ',
   3320      $ '---')
   3321          IF(GOESPW(2))  PRINT 8995
   3322  8995 FORMAT(/38X,'---  GOES 1x1 PRECIP. WATER RETRIEVALS PROCESSED ',
   3323      $ '---')
   3324          IF(GOESCT(1))  PRINT 8996
   3325  8996 FORMAT(/40X,'---  GOES 5x5 CLOUD TOP RETRIEVALS PROCESSED ---')
   3326          IF(GOESCT(2))  PRINT 8997
   3327  8997 FORMAT(/40X,'---  GOES 1x1 CLOUD TOP RETRIEVALS PROCESSED ---')
   3328          PRINT 591, KNTGIT,KNTGIS,KNTGIP,KNTGIC,KSKPGI,KNDCGI,KNOPGI,
   3329      $    KMSGGI,KBDYGI,KNOCTP
   3330   591    FORMAT(/35X,
   3331      $ 'NUMBER OF DECODED GOES REPORTS PROCESSED         = ',I8/35X,
   3332      $ '... NUMBER CONTAINING GOES SNDG/RADIANCE DATA    = ',I8/35X,
   3333      $ '... NUMBER CONTAINING GOES PRECIP. WATER DATA    = ',I8/35X,
   3334      $ '... NUMBER CONTAINING GOES CLOUD TOP DATA        = ',I8/35X,
   3335      $ 'TOTAL NO. OF DECODED REPORTS SKIPPED             = ',I8/35X,
   3336      $ ' *** NO. SKIPPED BY FOLLOWING CHECKS (IN THIS ORDER) ***'/35X,
   3337      $ '   -- NUMBER THAT COULD NOT BE DECODED, ERROR    = ',I8/35X,
   3338      $ '   -- NO. FROM NON-OP. SATS OR INVALID PATH(INST)= ',I8/35X,
   3339      $ '   -- NUMBER WITH MISSING LATITUDE OR LONGITUDE  = ',I8/35X,
   3340      $ '   -- NUMBER OUTSIDE DATA EXTRACTION BOUNDARY    = ',I8/35X,
   3341      $ '   -- C-TOP ONLY: NO. W/ MSG P, BUT W/ OTHER DATA= ',I8)
   3342          PRINT 7591, KTIMGI,KLNDGI,KSEAGI
   3343  7591    FORMAT(/,35X,
   3344      $ ' *** NO. OF REPORTS SKIPPED ***'/35X,
   3345      $ '   -- NUMBER OF SNDG/RAD OUTSIDE TIME INTERVAL   = ',I8/35X,
   3346      $ '   -- NUMBER OF P. WATER OUTSIDE TIME INTERVAL   = ',I8/35X,
   3347      $ '   -- NUMBER OF CLOUD TOP OUTSIDE TIME INTERVAL  = ',I8/35X,
   3348      $ '   -- NUMBER OF OVERLAND SOUNDING/RADIANCE       = ',I8/35X,
   3349      $ '   -- NUMBER OF OVERLAND PRECIPITABLE WATER      = ',I8/35X,
   3350      $ '   -- NUMBER OF OVERLAND CLOUD TOP               = ',I8/35X,
   3351      $ '   -- NUMBER OF OCEANIC SOUNDING/RADIANCE        = ',I8/35X,
   3352      $ '   -- NUMBER OF OCEANIC PRECIPITABLE WATER       = ',I8/35X,
   3353      $ '   -- NUMBER OF OCEANIC CLOUD TOP                = ',I8)
   3354       END IF
   3355       PRINT 954
   3356   954 FORMAT(//56X,'>>> SURFACE DATA <<<'/38X,'(INCL. ADPSFC, SFCSHP, ',
   3357      $ 'SFCBOG, SPLASH-LEVEL, MSONET)')
   3358       KOTHSF = KSKPSF - KMSGSF - KBDYSF - KTIMSF
   3359       PRINT 1955, KNTSFC,KNTSHP,KNTSLP,KNTMSO,KNTSPL,KSKPSF,KMSGSF,
   3360      $ KBDYSF,KTIMSF,KOTHSF,KSKOMR(2),KSKTHN
   3361  1955 FORMAT(/,35X,
   3362      $ 'NUMBER OF UNPACKED ADPSFC REPORTS PROCESSED      = ',I8,/,35X,
   3363      $ 'NUMBER OF UNPACKED SFCSHP REPORTS PROCESSED      = ',I8,/,35X,

Page 60          Source Listing                  PREPOBS_PREPDATA
2017-04-18 11:09                                 prepdata.f

   3364      $ 'NUMBER OF UNPACKED MSL P BOGUS REPORTS PROCESSED = ',I8,/,35X,
   3365      $ 'NUMBER OF UNPACKED MESONET REPORTS PROCESSED     = ',I8,/,35X,
   3366      $ 'NUMBER OF SPLASH-LEVEL MASS REPORTS PROCESSED    = ',I8,/,35X,
   3367      $ 'TOTAL NO. OF UNPACKED REPORTS SKIPPED (ALL SFC)  = ',I8,/,35X,
   3368      $ '   -- NUMBER WITH MISSING LATITUDE OR LONGITUDE  = ',I8,/,35X,
   3369      $ '   -- NUMBER OUTSIDE DATA EXTRACTION BOUNDARY    = ',I8,/,35X,
   3370      $ '   -- NUMBER OUTSIDE TIME INTERVAL               = ',I8,/,35X,
   3371      $ '   -- NUMBER SKIPPED FOR OTHER REASONS           = ',I8,/,35X,
   3372      $ 'COUNT OF RPTS FLAGGED (TBL. VAL. SET TO 15, ALL VARIABLES)'/35X,
   3373      $ '   -- NUMBER OVERLAND MARINE REPORTS             = ',I8,/,35X,
   3374      $ '   -- NUMBER LAND RPTS THINNED OUTSIDE LFM DOMAIN= ',I8)
   3375       DO IB = 1,6
   3376          IF(MIN(JPSSMI(IB,1),JPSSMI(IB,2),JPSSMI(IB,3),JPSSMI(IB,4))
   3377      $    .EQ.0)  THEN
   3378             PRINT 956
   3379   956       FORMAT(//57X,'>>> SSM/I DATA <<<'/13X,'(INCLUDES REPORTS ',
   3380      $       'WITH EITHER WIND SPEED, PRECIP. WATER, RAIN RATE AND/OR ',
   3381      $       '7-CHN. BRIGHTNESS TEMPERATURES)')
   3382             KOTHMI = KSKPMI - KMSGMI - KBDYMI - KTIMM(1) - KTIMM(2) -
   3383      $               KTIMM(3) - KTIMM(4)
   3384             KNTSMI_TOT = KNTSMI(1) + KNTSMI(2) + KNTSMI(3) + KNTSMI(4)
   3385             PRINT 957, KNTSMI_TOT,(KNTSMI(II),II=1,4),KSKPMI,KMSGMI,
   3386      $       KBDYMI,(KTIMM(II),II=1,4),KOTHMI
   3387   957       FORMAT(/,35X,
   3388      $   'NUMBER OF UNPACKED SSM/I REPORTS PROCESSED       = ',I8,/,35X,
   3389      $   '   -- NUMBER OF OCEANIC WIND SPEED REPORTS       = ',I8,/,35X,
   3390      $   '   -- NUMBER OF OCEANIC PRECIP. WATER REPORTS    = ',I8,/,35X,
   3391      $   '   -- NUMBER OF RAIN RATE REPORTS                = ',I8,/,35X,
   3392      $   '   -- NUMBER OF 7-CHANNEL BRIGHTNESS TEMP REPORTS= ',I8,/,35X,
   3393      $   'TOTAL NO. OF UNPACKED REPORTS SKIPPED            = ',I8,/,35X,
   3394      $   '   -- NUMBER WITH MISSING LATITUDE OR LONGITUDE  = ',I8,/,35X,
   3395      $   '   -- NUMBER OUTSIDE DATA EXTRACTION BOUNDARY    = ',I8,/,35X,
   3396      $   '   -- NO. OF W. SPEED RPTS OUTSIDE TIME INTERVAL = ',I8,/,35X,
   3397      $   '   -- NO. OF P. WATER RPTS OUTSIDE TIME INTERVAL = ',I8,/,35X,
   3398      $   '   -- NO. OF R. RATE  RPTS OUTSIDE TIME INTERVAL = ',I8,/,35X,
   3399      $   '   -- NO. OF B. TEMP. RPTS OUTSIDE TIME INTERVAL = ',I8,/,35X,
   3400      $   '   -- NUMBER SKIPPED FOR OTHER REASONS           = ',I8)
   3401             EXIT
   3402          END IF
   3403       ENDDO
   3404       IF(MIN(JPERSD(1),JPERSD(2),JPERSD(3),JPERSD(4),JPERSD(5),
   3405      $ JPERSD(6)).EQ.0)  THEN
   3406          PRINT 976
   3407   976    FORMAT(//49X,'>>> ERS SCATTEROMETER WIND DATA <<<')
   3408          KOTHER = KSKPSC(1) - KMSGSC(1) - KBDYSC(1) - KTIMSC(1)
   3409          PRINT 977, KNTSCT(1),KSKPSC(1),KMSGSC(1),KBDYSC(1),KTIMSC(1),
   3410      $    KOTHER
   3411   977       FORMAT(/,35X,
   3412      $   'NUMBER OF UNPACKED ERS SCATTER. RPTS PROCESSED   = ',I8,/,35X,
   3413      $   'TOTAL NO. OF UNPACKED REPORTS SKIPPED            = ',I8,/,35X,
   3414      $   '   -- NUMBER WITH MISSING LATITUDE OR LONGITUDE  = ',I8,/,35X,
   3415      $   '   -- NUMBER OUTSIDE DATA EXTRACTION BOUNDARY    = ',I8,/,35X,
   3416      $   '   -- NUMBER OUTSIDE TIME INTERVAL               = ',I8,/,35X,
   3417      $   '   -- NUMBER SKIPPED FOR OTHER REASONS           = ',I8)
   3418       END IF
   3419       IF(MIN(JPQKSD(1),JPQKSD(2),JPQKSD(3),JPQKSD(4),JPQKSD(5),
   3420      $ JPQKSD(6)).EQ.0)  THEN

Page 61          Source Listing                  PREPOBS_PREPDATA
2017-04-18 11:09                                 prepdata.f

   3421          PRINT 2976
   3422  2976    FORMAT(//46X,'>>> QUIKSCAT SCATTEROMETER WIND DATA <<<')
   3423          KOTHQK = KSKPSC(2) - KMSGSC(2) - KBDYSC(2) - KTIMSC(2)
   3424          PRINT 2977, KNTSCT(2),KSKPSC(2),KMSGSC(2),KBDYSC(2),KTIMSC(2),
   3425      $    KOTHQK
   3426  2977       FORMAT(/,35X,
   3427      $   'NUMBER OF UNPACKED QUIKSCAT SCATTER. RPTS PROC.  = ',I8,/,35X,
   3428      $   'TOTAL NO. OF UNPACKED REPORTS SKIPPED            = ',I8,/,35X,
   3429      $   '   -- NUMBER WITH MISSING LATITUDE OR LONGITUDE  = ',I8,/,35X,
   3430      $   '   -- NUMBER OUTSIDE DATA EXTRACTION BOUNDARY    = ',I8,/,35X,
   3431      $   '   -- NUMBER OUTSIDE TIME INTERVAL               = ',I8,/,35X,
   3432      $   '   -- NUMBER SKIPPED FOR OTHER REASONS           = ',I8)
   3433       END IF
   3434       IF(MIN(JPWDSD(1),JPWDSD(2),JPWDSD(3),JPWDSD(4),JPWDSD(5),
   3435      $ JPWDSD(6)).EQ.0)  THEN
   3436          PRINT 2978
   3437  2978    FORMAT(//46X,'>>> WINDSAT SCATTEROMETER WIND DATA <<<')
   3438          KOTHWS = KSKPSC(3) - KMSGSC(3) - KBDYSC(3) - KTIMSC(3)
   3439          PRINT 2979, KNTSCT(3),KSKPSC(3),KMSGSC(3),KBDYSC(3),KTIMSC(3),
   3440      $    KOTHWS
   3441  2979       FORMAT(/,35X,
   3442      $   'NUMBER OF UNPACKED WINDSAT SCATTER. REPORTS PROC.= ',I8,/,35X,
   3443      $   'TOTAL NO. OF UNPACKED REPORTS SKIPPED            = ',I8,/,35X,
   3444      $   '   -- NUMBER WITH MISSING LATITUDE OR LONGITUDE  = ',I8,/,35X,
   3445      $   '   -- NUMBER OUTSIDE DATA EXTRACTION BOUNDARY    = ',I8,/,35X,
   3446      $   '   -- NUMBER OUTSIDE TIME INTERVAL               = ',I8,/,35X,
   3447      $   '   -- NUMBER SKIPPED FOR OTHER REASONS           = ',I8)
   3448       END IF
   3449       IF(MIN(JPASCD(1),JPASCD(2),JPASCD(3),JPASCD(4),JPASCD(5),
   3450      $ JPASCD(6)).EQ.0)  THEN
   3451          PRINT 2996
   3452  2996    FORMAT(//44X,'>>> ASCAT SCATTEROMETER WIND DATA <<<')
   3453          KOTHAS = KSKPSC(4) - KMSGSC(4) - KBDYSC(4) - KTIMSC(4)
   3454          PRINT 2997, KNTSCT(4),KSKPSC(4),KMSGSC(4),KBDYSC(4),KTIMSC(4),
   3455      $    KOTHAS
   3456  2997       FORMAT(/,35X,
   3457      $   'NUMBER OF UNPACKED ASCAT SCATTEROMETER RPTS PROC.= ',I8,/,35X,
   3458      $   'TOTAL NO. OF UNPACKED REPORTS SKIPPED            = ',I8,/,35X,
   3459      $   '   -- NUMBER WITH MISSING LATITUDE OR LONGITUDE  = ',I8,/,35X,
   3460      $   '   -- NUMBER OUTSIDE DATA EXTRACTION BOUNDARY    = ',I8,/,35X,
   3461      $   '   -- NUMBER OUTSIDE TIME INTERVAL               = ',I8,/,35X,
   3462      $   '   -- NUMBER SKIPPED FOR OTHER REASONS           = ',I8)
   3463       END IF
   3464       IF(MIN(JPGPSD(1),JPGPSD(2),JPGPSD(3),JPGPSD(4),JPGPSD(5),
   3465      $ JPGPSD(6)).EQ.0)  THEN
   3466          PRINT 3976
   3467  3976    FORMAT(//54X,'>>> GPS-IPW/ZTD DATA <<<')
   3468          KOTHGP = KSKPGP - KMISGP - KMSGGP - KBDYGP - KTIMGP - KT45GP
   3469      $                   - KTGNSS
   3470          PRINT 4977, KNTGPS,KSKPGP,KMISGP,KMSGGP,KBDYGP,KTIMGP,KT45GP,
   3471      $    KTGNSS,KOTHGP
   3472  4977    FORMAT(/,35X,
   3473      $   'NUMBER OF UNPACKED GPS-IPW/ZTD REPORTS PROCESSED = ',I8,/,35X,
   3474      $   'TOTAL NO. OF UNPACKED REPORTS SKIPPED            = ',I8,/,35X,
   3475      $   '   -- NUMBER WITH MISSING TOTAL PRECIP. WATER    = ',I8,/,35X,
   3476      $   '   -- NUMBER WITH MISSING LATITUDE OR LONGITUDE  = ',I8,/,35X,
   3477      $   '   -- NUMBER OUTSIDE DATA EXTRACTION BOUNDARY    = ',I8,/,35X,

Page 62          Source Listing                  PREPOBS_PREPDATA
2017-04-18 11:09                                 prepdata.f

   3478      $   '   -- NUMBER OUTSIDE TIME INTERVAL               = ',I8,/,35X,
   3479      $   '   -- NUMBER WITH REPORT TIME MINUTES > 30       = ',I8,/,35X,
   3480      $   '   -- NUMBER THAT ARE NOT PROVIDED BY ENI        = ',I8,/,35X,
   3481      $   '   -- NUMBER SKIPPED FOR OTHER REASONS           = ',I8)
   3482       END IF
   3483       PRINT 299
   3484   299 FORMAT(///,38X,'TABLE OF IDENTIFICATION OF PREPBUFR REPORT TYPES',
   3485      $ ' USED'//41X,'WINDS',40X,'MASS  ',/)
   3486       DO I = 1,NUMTYP
   3487          JITSM(I) = JITSW(I) - 100
   3488          PRINT 501, JITSW(I),NAMEW(I),JITSM(I),NAMEM(I)
   3489       ENDDO
   3490   501 FORMAT(14X,I3,4X,A40,7X,I3,4X,A40)
   3491       IKN = 0
   3492       KKTOT = 0
   3493       KTYPE = 0
   3494       NTYPE = 0
   3495       DO I = 100,299
   3496          IF(KKTYPE(I).GT.0)  THEN
   3497             IF(IKN.EQ.NUMTYP)  THEN
   3498                PRINT 8897, NUMTYP-1,I
   3499  8897 FORMAT(//'  %%  >',I3,' UNIQUE RPT TYPES PROCESSED - COUNTS ',
   3500      $ 'FOR RPT TYPE',I4,' CANNOT BE PRINTED -- TOTAL NO. OF COUNTS ',
   3501      $ 'SET TO ',I0/)
   3502                KKTOT = -99999
   3503                CYCLE
   3504             END IF
   3505             IKN = IKN + 1
   3506             KTYPE(IKN) = KKTYPE(I)
   3507             NTYPE(IKN) = I
   3508             KKTOT = KKTOT + KKTYPE(I)
   3509          END IF
   3510       ENDDO
   3511       PRINT 400
   3512   400 FORMAT(//,46X,'REPORT COUNTS BY PREPBUFR REPORT TYPE')
   3513       PRINT 200, (NTYPE(I), I= 1,17)
   3514       PRINT 200, (KTYPE(I), I= 1,17)
   3515       PRINT *
   3516       PRINT 200, (NTYPE(I), I=18,34)
   3517       PRINT 200, (KTYPE(I), I=18,34)
   3518       PRINT *
   3519       PRINT 200, (NTYPE(I), I=35,51)
   3520       PRINT 200, (KTYPE(I), I=35,51)
   3521       PRINT *
   3522       PRINT 200, (NTYPE(I), I=52,68)
   3523       PRINT 200, (KTYPE(I), I=52,68)
   3524       PRINT *
   3525       PRINT 200, (NTYPE(I), I=69,NUMTYP-1)
   3526       PRINT 200, (KTYPE(I), I=69,NUMTYP-1)
   3527   200 FORMAT(3X,17I7)
   3528       PRINT 203, KKTOT
   3529   203 FORMAT(/33X,'>>>>> TOTAL NUMBER OF REPORTS WRITTEN TO DATA',
   3530      $ ' SET =',I6,' <<<<<')
   3531       PRINT 91
   3532    91 FORMAT(//39X,'***** PREPDATA PROGRAM SUCCESSFULLY COMPLETED',
   3533      $ ' *****'//)
   3534       if(i2many_lvls.gt.0) then

Page 63          Source Listing                  PREPOBS_PREPDATA
2017-04-18 11:09                                 prepdata.f

   3535          WRITE(c2many_lvls,'(I4)') i2many_lvls
   3536          WRITE(CMXLVL,'(I6)') MXLVL
   3537          CALL SYSTEM('[ -n "$jlogfile" ] && $DATA/postmsg'//
   3538      $    ' "$jlogfile" "***WARNING: '//c2many_lvls//' REPORT(S) '//
   3539      $    'SKIPPED DUE TO HAVING TOO MANY LEVELS (> '//
   3540      $    CMXLVL//' )"')
   3541       end if
   3542       GO TO 99
   3543 C-----------------------------------------------------------------------
   3544   326 CONTINUE
   3545 C PROBLEM IN PRODUCTION DATE FILE -- STOP 29
   3546       PRINT 9326
   3547  9326 FORMAT(/5X,'++ ERROR READING NCEP PRODUCTION DATE FILE- STOP 29'/)
   3548       CALL W3TAGE('PREPOBS_PREPDATA')
   3549       CALL ERREXIT(29)
   3550 C-----------------------------------------------------------------------
   3551    99 CONTINUE
   3552       IF(ICODE.EQ.4.AND..NOT.APPEND)  THEN
   3553 C-----------------------------------------------------------------------
   3554 C NO DATA FOUND IN ONE OF THE FOLLOWING FILES: ADPUPA OR ADPSFC (AND
   3555 C  NOT APPENDING)
   3556          PRINT 9327
   3557  9327 FORMAT(/5X,'++ NO DATA FOUND IN EITHER ADPUPA OR ADPSFC -STOP 4'/)
   3558       CALL W3TAGE('PREPOBS_PREPDATA')
   3559       CALL ERREXIT(4)
   3560 C-----------------------------------------------------------------------
   3561       END IF
   3562       CALL W3TAGE('PREPOBS_PREPDATA')
   3563       STOP
   3564       END

Page 64          Source Listing                  PREPOBS_PREPDATA
2017-04-18 11:09 Entry Points                    prepdata.f



ENTRY POINTS

  Name              
                    
 MAIN__             


SYMBOL CROSS REFERENCE

 Name                       Object Declared Type            Bytes Dimen Elements Attributes       References                        
                                                                                                                                    
 101                        Label  3180                                                           3179                              
 102                        Label  3189                                                           3188                              
 12                         Label  3193                                                           3185                              
 14                         Label  3186                                                           3182,3183,3184                    
 1951                       Label  3209                                                           3206                              
 1955                       Label  3361                                                           3359                              
 1958                       Label  3244                                                           3242                              
 200                        Label  3527                                                           3513,3514,3516,3517,3519,3520,3522
                                                                                                  ,3523,3525,3526                   
 203                        Label  3529                                                           3528                              
 2213                       Label  3056                                                           3055                              
 2976                       Label  3422                                                           3421                              
 2977                       Label  3426                                                           3424                              
 2978                       Label  3437                                                           3436                              
 2979                       Label  3441                                                           3439                              
 299                        Label  3484                                                           3483                              
 2996                       Label  3452                                                           3451                              
 2997                       Label  3456                                                           3454                              
 321                        Label  3094                                                           3090,3092                         
 3211                       Label  3098                                                           3097                              
 322                        Label  3100                                                           3099                              
 324                        Label  3120                                                           3119                              
 326                        Label  3544                                                           3113                              
 332                        Label  3140                                                           3139                              
 334                        Label  3142                                                           3141                              
 335                        Label  3145                                                           3144                              
 357                        Label  3125                                                           3124                              
 3976                       Label  3467                                                           3466                              
 3990                       Label  3278                                                           3277                              
 400                        Label  3512                                                           3511                              
 401                        Label  3202                                                           3201                              
 4977                       Label  3472                                                           3470                              
 501                        Label  3490                                                           3488                              
 590                        Label  3309                                                           3308                              
 591                        Label  3330                                                           3328                              
 7591                       Label  3343                                                           3342                              
 7990                       Label  3281                                                           3280                              
 7991                       Label  3283                                                           3282                              
 7992                       Label  3286                                                           3285                              
 886                        Label  3070                                                           3069                              
 887                        Label  3073                                                           3072                              
 8897                       Label  3499                                                           3498                              
 8990                       Label  3311                                                           3310                              
 8991                       Label  3315                                                           3314                              

Page 65          Source Listing                  PREPOBS_PREPDATA
2017-04-18 11:09 Symbol Table                    prepdata.f

 Name                       Object Declared Type            Bytes Dimen Elements Attributes       References                        
                                                                                                                                    
 8992                       Label  3319                                                           3318                              
 8993                       Label  3313                                                           3312                              
 8994                       Label  3317                                                           3316                              
 8995                       Label  3322                                                           3321                              
 8996                       Label  3325                                                           3324                              
 8997                       Label  3327                                                           3326                              
 91                         Label  3532                                                           3531                              
 9326                       Label  3547                                                           3546                              
 9327                       Label  3557                                                           3556                              
 950                        Label  3204                                                           3203                              
 954                        Label  3356                                                           3355                              
 956                        Label  3379                                                           3378                              
 957                        Label  3387                                                           3385                              
 976                        Label  3407                                                           3406                              
 977                        Label  3411                                                           3409                              
 99                         Label  3551                                                           3542                              
 991                        Label  3291                                                           3288                              
 999                        Label  3133                                                           3132,3135                         
 ACFTSW                     Common 2859                                 1148                                                        
 ADP                        Common 2850                                 14100                                                       
 AIFNOW                     Scalar 2838     L(4)            4     1     9        COM              3047                              
 AIRLND                     Scalar 2835     L(4)            4     2     54       COM              3040                              
 ALAT_8                     Scalar 2840     R(8)            8           scalar   COM                                                
 ALONVT                     Scalar 2846     R(4)            4           scalar   COM              3039,3162                         
 ALON_8                     Scalar 2840     R(8)            8           scalar   COM                                                
 AMSTQ                      Scalar 2861     R(4)            4           scalar   COM                                                
 APDNSW                     Common 2894                                 4                                                           
 APPEND                     Scalar 2838     L(4)            4           scalar   COM              3048,3552                         
 AWINDO                     Scalar 2859     R(4)            4     2     18       COM              3043                              
 BMISS                      Scalar 2840     R(8)            8           scalar   COM              3156,3158                         
 BUFRLIB_MISSING            Common 2899                                 8                                                           
 BVERS                      Subr   3096                                                           3096                              
 C2MANY_LVLS                Local  2828     CHAR            4           scalar                    3535,3538                         
 CDAT                       Local  2832     CHAR            10    1     8                         3123,3124                         
 CLDAMT                     Scalar 2889     R(4)            4           scalar   COM                                                
 CLDTOP                     Common 2892                                 24                                                          
 CLTOP                      Scalar 2892     R(4)            4     2     6        COM                                                
 CMXLVL                     Local  2830     CHAR            6           scalar                    3536,3540                         
 COUNT                      Common 2871                                 800                                                         
 CTYPE                      Local  2829     CHAR            5     1     2                         2906,3277,3288                    
 CVSTR                      Local  2843     CHAR            8           scalar                    3096,3097                         
 CWINDO                     Scalar 2876     R(4)            4           scalar   COM              3046                              
 DAT                        Scalar 2853     R(4)            4     2     9600     COM                                                
 DATA                       Common 2848                                 32                                                          
 DROPSN                     Scalar 2835     L(4)            4           scalar   COM              3042                              
 DWINDO                     Scalar 2874     R(4)            4           scalar   COM              3048                              
 EEQF                       Scalar 2858     R(4)            4           scalar   COM                                                
 ERREXIT                    Subr   3192                                                           3192,3549,3559                    
 FILLM                      Scalar 2836     L(4)            4           scalar   COM              3045                              
 FILLT                      Scalar 2836     L(4)            4           scalar   COM              3045                              
 FILLW                      Scalar 2836     L(4)            4           scalar   COM              3045                              
 FILLZ                      Scalar 2836     L(4)            4           scalar   COM              3045                              
 FLACMS                     Scalar 2838     L(4)            4     1     9        COM              3049                              
 FLDMAF                     Scalar 2838     L(4)            4           scalar   COM              3047                              
 FLDMFR                     Scalar 2838     L(4)            4           scalar   COM              3050                              

Page 66          Source Listing                  PREPOBS_PREPDATA
2017-04-18 11:09 Symbol Table                    prepdata.f

 Name                       Object Declared Type            Bytes Dimen Elements Attributes       References                        
                                                                                                                                    
 FLDMGS                     Scalar 2838     L(4)            4           scalar   COM              3047                              
 FLONVT                     Scalar 2868     R(4)            4           scalar   COM              3042                              
 FLRECO                     Scalar 2873     R(4)            4           scalar   COM                                                
 FMESHL                     Scalar 2868     R(4)            4           scalar   COM              3042                              
 FPOLEI                     Scalar 2868     R(4)            4           scalar   COM              3042                              
 FPOLEJ                     Scalar 2868     R(4)            4           scalar   COM              3042                              
 FWINDO                     Scalar 2869     R(4)            4     1     12       COM              3044                              
 GBLEVN                     Local  3038                                 scalar                    3072,3130                         
 GDNH                       Scalar 2845     R(4)            4     2     32942    COM              3182                              
 GDSH                       Scalar 2845     R(4)            4     2     5365     COM              3183                              
 GDUS                       Scalar 2845     R(4)            4     2     32942    COM              3184                              
 GETBMISS                   Func   2840     R(8)            8           scalar                    3156                              
 GOESCT                     Scalar 2837     L(4)            4     1     2        COM              3048,3306,3307,3324,3326          
 GOESND                     Scalar 2835     L(4)            4     1     2        COM              3040,3306,3314,3316               
 GOESPW                     Scalar 2837     L(4)            4     1     2        COM              3046,3306,3307,3318,3321          
 GOESRD                     Scalar 2838     L(4)            4     1     2        COM              3048,3306,3307,3310,3312          
 GOSWCH                     Common 2865                                 100                                                         
 GPSWCH                     Common 2890                                 68                                                          
 GRAD                       Scalar 2888     R(4)            4     1     18       COM                                                
 GRID                       Common 2846                                 40                                                          
 GWINDO                     Scalar 2890     R(4)            4           scalar   COM              3049                              
 HDR                        Scalar 2849     R(4)            4     1     14       COM              3199                              
 I                          Local  3099     I(4)            4           scalar                    3099,3486,3487,3488,3495,3496,3498
                                                                                                  ,3506,3507,3508,3513,3514,3516,351
                                                                                                  7,3519,3520,3522,3523,3525,3526   
 I2MANY_LVLS                Scalar 2872     I(4)            4           scalar   COM              3534,3535                         
 IACFTH                     Scalar 2860     I(4)            4     1     9        COM              3049,3243                         
 IACFTL                     Scalar 2860     I(4)            4     1     9        COM              3046,3242                         
 IAWNDO                     Scalar 2887     I(4)            4     1     2        COM              3050                              
 IB                         Local  3375     I(4)            4           scalar                    3375,3376                         
 ICODE                      Scalar 2875     I(4)            4           scalar   COM              3552                              
 IDAT                       Local  2842     I(4)            4     1     8                         3122,3123                         
 IDAT10                     Scalar 2848     I(4)            4           scalar   COM              3113,3115,3116,3117,3118          
 IDATA                      Scalar 2842     I(4)            4     1     3500     COM                                                
 IDATE                      Scalar 2848     I(4)            4     1     4        COM              3115,3116,3117,3118,3119          
 IER                        Local  3200     I(4)            4           scalar                    3200                              
 IEWNDO                     Scalar 2885     I(4)            4     1     2        COM              3047                              
 IFLUA                      Scalar 2877     I(4)            4           scalar   COM                                                
 IGCHN                      Scalar 2888     I(4)            4     1     18       COM                                                
 IGRD                       Scalar 2846     I(4)            4           scalar   COM              3039                              
 II                         Local  3242     I(4)            4           scalar                    3242,3243,3275,3276,3277,3279,3284
                                                                                                  ,3288,3289,3290,3385,3386         
 IKN                        Local  3491     I(4)            4           scalar                    3491,3497,3505,3506,3507          
 IMISS                      Local  2901     I(4)            4           scalar                    2901,3199                         
 IPRINT                     Scalar 2850     I(4)            4           scalar   COM              3046                              
 IPSTNFLG                   Scalar 2898     I(4)            4           scalar   COM                                                
 IQWNDO                     Scalar 2885     I(4)            4     1     2        COM              3048                              
 IRNMRK                     Scalar 2851     I(4)            4           scalar   COM              3040,3059,3089,3090               
 IRTRV                      Scalar 2854     I(4)            4     3     80       COM              3041                              
 ISATLS                     Scalar 2855     I(4)            4     3     80       COM              3048                              
 ISATOB                     Scalar 2850     I(4)            4           scalar   COM                                                
 ISQNUM_UPA                 Scalar 2870     I(4)            4           scalar   COM                                                
 IUNIT                      Scalar 2852     I(4)            4     1     28       COM              3051,3099,3113,3124,3179,3182,3183
                                                                                                  ,3184                             
 IVADFL                     Scalar 2874     I(4)            4           scalar   COM              3048                              

Page 67          Source Listing                  PREPOBS_PREPDATA
2017-04-18 11:09 Symbol Table                    prepdata.f

 Name                       Object Declared Type            Bytes Dimen Elements Attributes       References                        
                                                                                                                                    
 IVADSP                     Scalar 2874     I(4)            4           scalar   COM              3048                              
 IWINDO_E                   Scalar 2854     I(4)            4     3     80       COM              3041                              
 IWINDO_L                   Scalar 2855     I(4)            4     3     80       COM              3041                              
 IWWNDO                     Scalar 2885     I(4)            4     1     2        COM              3049                              
 JAMASS                     Scalar 2859     I(4)            4     2     54       COM              3044                              
 JAWIND                     Scalar 2859     I(4)            4     2     54       COM              3040                              
 JGRD                       Scalar 2846     I(4)            4           scalar   COM              3039,3163                         
 JITSM                      Local  2841     I(4)            4     1     74                        3487,3488                         
 JITSW                      Local  2842     I(4)            4     1     74                        2907,3487,3488                    
 JPASCD                     Scalar 2887     I(4)            4     1     6        COM              3050,3449,3450                    
 JPERSD                     Scalar 2885     I(4)            4     1     6        COM              3047,3404,3405                    
 JPGPSD                     Scalar 2890     I(4)            4     1     6        COM              3049,3464,3465                    
 JPQKSD                     Scalar 2885     I(4)            4     1     6        COM              3048,3419,3420                    
 JPSSMI                     Scalar 2883     I(4)            4     2     24       COM              3045,3376                         
 JPWDSD                     Scalar 2886     I(4)            4     1     6        COM              3049,3434,3435                    
 JSMASS                     Scalar 2857     I(4)            4     3     480      COM              3044                              
 JSURFM                     Scalar 2869     I(4)            4     1     12       COM              3043                              
 JSURFW                     Scalar 2869     I(4)            4     1     12       COM              3044                              
 JSWIND                     Scalar 2857     I(4)            4     3     480      COM              3041                              
 KBDYGI                     Scalar 2866     I(4)            4           scalar   COM              3329                              
 KBDYGP                     Scalar 2890     I(4)            4           scalar   COM              3468,3470                         
 KBDYMI                     Scalar 2884     I(4)            4           scalar   COM              3382,3386                         
 KBDYSC                     Scalar 2886     I(4)            4     1     4        COM              3408,3409,3423,3424,3438,3439,3453
                                                                                                  ,3454                             
 KBDYSF                     Scalar 2878     I(4)            4           scalar   COM              3358,3360                         
 KBDYTV                     Scalar 2863     I(4)            4     1     2        COM              3289                              
 KBDYUA                     Scalar 2878     I(4)            4           scalar   COM              3207                              
 KEPAC                      Scalar 2860     I(4)            4     2     54       COM                                                
 KEPSW                      Scalar 2857     I(4)            4     3     480      COM                                                
 KIPTTV                     Scalar 2863     I(4)            4     1     2        COM              3289                              
 KJFLAG                     Scalar 2864     I(4)            4     1     2        COM              3290                              
 KKTOT                      Local  3492     I(4)            4           scalar                    3492,3502,3508,3528               
 KKTYPE                     Scalar 2871     I(4)            4     1     200      COM              3496,3506,3508                    
 KLNDGI                     Scalar 2866     I(4)            4     1     3        COM              3342                              
 KLNDTV                     Scalar 2864     I(4)            4     1     2        COM              3289                              
 KMISGP                     Scalar 2891     I(4)            4           scalar   COM              3468,3470                         
 KMSGGI                     Scalar 2866     I(4)            4           scalar   COM              3329                              
 KMSGGP                     Scalar 2890     I(4)            4           scalar   COM              3468,3470                         
 KMSGMI                     Scalar 2884     I(4)            4           scalar   COM              3382,3385                         
 KMSGSC                     Scalar 2886     I(4)            4     1     4        COM              3408,3409,3423,3424,3438,3439,3453
                                                                                                  ,3454                             
 KMSGSF                     Scalar 2878     I(4)            4           scalar   COM              3358,3359                         
 KMSGTV                     Scalar 2863     I(4)            4     1     2        COM              3289                              
 KMSGUA                     Scalar 2878     I(4)            4           scalar   COM              3207                              
 KNDCDE                     Scalar 2881     I(4)            4     1     3        COM              3208                              
 KNDCGI                     Scalar 2866     I(4)            4           scalar   COM              3328                              
 KNOATS                     Scalar 2879     I(4)            4           scalar   COM              3207                              
 KNOCTP                     Scalar 2867     I(4)            4           scalar   COM              3329                              
 KNOPGI                     Scalar 2866     I(4)            4           scalar   COM              3328                              
 KNOPTV                     Scalar 2863     I(4)            4     1     2        COM              3288                              
 KNTAIR                     Scalar 2879     I(4)            4           scalar   COM              3206                              
 KNTCAR                     Scalar 2879     I(4)            4           scalar   COM              3206                              
 KNTDUM                     Scalar 2880     I(4)            4     1     3        COM                                                
 KNTGIC                     Scalar 2867     I(4)            4           scalar   COM              3328                              
 KNTGIP                     Scalar 2865     I(4)            4           scalar   COM              3328                              

Page 68          Source Listing                  PREPOBS_PREPDATA
2017-04-18 11:09 Symbol Table                    prepdata.f

 Name                       Object Declared Type            Bytes Dimen Elements Attributes       References                        
                                                                                                                                    
 KNTGIS                     Scalar 2865     I(4)            4           scalar   COM              3328                              
 KNTGIT                     Scalar 2865     I(4)            4           scalar   COM              3328                              
 KNTGPS                     Scalar 2890     I(4)            4           scalar   COM              3470                              
 KNTMSO                     Scalar 2880     I(4)            4           scalar   COM              3359                              
 KNTPRO                     Scalar 2879     I(4)            4           scalar   COM              3206                              
 KNTRAS                     Scalar 2880     I(4)            4           scalar   COM              3206                              
 KNTSCT                     Scalar 2886     I(4)            4     1     4        COM              3409,3424,3439,3454               
 KNTSFC                     Scalar 2880     I(4)            4           scalar   COM              3359                              
 KNTSHP                     Scalar 2880     I(4)            4           scalar   COM              3359                              
 KNTSLP                     Scalar 2880     I(4)            4           scalar   COM              3359                              
 KNTSMI                     Scalar 2883     I(4)            4     1     4        COM              3384,3385                         
 KNTSMI_TOT                 Local  3384     I(4)            4           scalar                    3384,3385                         
 KNTSPL                     Scalar 2880     I(4)            4           scalar   COM              3359                              
 KNTSWN                     Scalar 2879     I(4)            4           scalar   COM              3206                              
 KNTTOV                     Scalar 2862     I(4)            4     1     2        COM              3288                              
 KNTUPA                     Scalar 2879     I(4)            4           scalar   COM              3206                              
 KNTVAD                     Scalar 2880     I(4)            4           scalar   COM              3206                              
 KOTHAS                     Local  3453     I(4)            4           scalar                    3453,3455                         
 KOTHER                     Local  3408     I(4)            4           scalar                    3408,3410                         
 KOTHGP                     Local  3468     I(4)            4           scalar                    3468,3471                         
 KOTHMI                     Local  3382     I(4)            4           scalar                    3382,3386                         
 KOTHQK                     Local  3423     I(4)            4           scalar                    3423,3425                         
 KOTHSF                     Local  3358     I(4)            4           scalar                    3358,3360                         
 KOTHWS                     Local  3438     I(4)            4           scalar                    3438,3440                         
 KOUNT                      Scalar 2848     I(4)            4           scalar   COM                                                
 KREDTV                     Scalar 2864     I(4)            4     1     2        COM              3290                              
 KSEAGI                     Scalar 2866     I(4)            4     1     3        COM              3342                              
 KSEATV                     Scalar 2864     I(4)            4     1     2        COM              3290                              
 KSKACF                     Scalar 2881     I(4)            4           scalar   COM              3242                              
 KSKAHM                     Scalar 2882     I(4)            4     1     9        COM              3243                              
 KSKALM                     Scalar 2881     I(4)            4     1     9        COM              3242                              
 KSKCLS                     Scalar 2881     I(4)            4           scalar   COM              3208                              
 KSKDRP                     Scalar 2882     I(4)            4           scalar   COM              3208                              
 KSKNOW                     Scalar 2882     I(4)            4     1     9        COM              3243                              
 KSKNSW                     Scalar 2879     I(4)            4           scalar   COM              3207                              
 KSKOMR                     Scalar 2881     I(4)            4     1     2        COM              3207,3360                         
 KSKPGI                     Scalar 2866     I(4)            4           scalar   COM              3328                              
 KSKPGP                     Scalar 2890     I(4)            4           scalar   COM              3468,3470                         
 KSKPMI                     Scalar 2884     I(4)            4           scalar   COM              3382,3385                         
 KSKPSC                     Scalar 2886     I(4)            4     1     4        COM              3408,3409,3423,3424,3438,3439,3453
                                                                                                  ,3454                             
 KSKPSF                     Scalar 2878     I(4)            4           scalar   COM              3358,3359                         
 KSKPTV                     Scalar 2863     I(4)            4     1     2        COM              3288                              
 KSKPUA                     Scalar 2878     I(4)            4           scalar   COM              3207                              
 KSKREC                     Scalar 2879     I(4)            4           scalar   COM              3208                              
 KSKSWD                     Scalar 2858     I(4)            4     1     10       COM              3207                              
 KSKSWN                     Scalar 2881     I(4)            4           scalar   COM              3242                              
 KSKTHN                     Scalar 2881     I(4)            4           scalar   COM              3360                              
 KT45GP                     Scalar 2891     I(4)            4           scalar   COM              3468,3470                         
 KTEMP                      Scalar 2836     L(4)            4           scalar   COM              3044                              
 KTGNSS                     Scalar 2891     I(4)            4           scalar   COM              3469,3471                         
 KTIMGI                     Scalar 2866     I(4)            4     1     3        COM              3342                              
 KTIMGP                     Scalar 2890     I(4)            4           scalar   COM              3468,3470                         
 KTIMM                      Scalar 2883     I(4)            4     1     4        COM              3382,3383,3386                    
 KTIMSC                     Scalar 2886     I(4)            4     1     4        COM              3408,3409,3423,3424,3438,3439,3453

Page 69          Source Listing                  PREPOBS_PREPDATA
2017-04-18 11:09 Symbol Table                    prepdata.f

 Name                       Object Declared Type            Bytes Dimen Elements Attributes       References                        
                                                                                                                                    
                                                                                                  ,3454                             
 KTIMSF                     Scalar 2879     I(4)            4           scalar   COM              3358,3360                         
 KTIMTV                     Scalar 2863     I(4)            4     1     2        COM              3289                              
 KTIMUA                     Scalar 2878     I(4)            4           scalar   COM              3207                              
 KTOP                       Scalar 2854     I(4)            4     3     80       COM              3041                              
 KTYPE                      Local  2841     I(4)            4     1     73                        3493,3506,3514,3517,3520,3523,3526
 LDTA                       Local  3040                                 scalar                    3076,3134                         
 LEVPM                      Scalar 2870     I(4)            4           scalar   COM              3043                              
 LEVQQ                      Scalar 2870     I(4)            4           scalar   COM              3043                              
 LEVST                      Scalar 2870     I(4)            4           scalar   COM              3043                              
 LFMAXI                     Scalar 2868     I(4)            4           scalar   COM              3042                              
 LFMAXJ                     Scalar 2868     I(4)            4           scalar   COM              3042                              
 LFMSFC                     Common 2868                                 224                                                         
 LNDSEA                     Common 2845                                 284996                                                      
 LSMASS                     Scalar 2876     I(4)            4           scalar   COM              3046                              
 LSWIND                     Scalar 2876     I(4)            4           scalar   COM              3045                              
 LWI                        Scalar 2844     I(4)            4           scalar   COM              3054,3055                         
 LWR                        Scalar 2844     I(4)            4           scalar   COM              3054,3055                         
 MARLND                     Scalar 2836     L(4)            4           scalar   COM              3042                              
 MAXOBS                     Param  2826     I(4)            4           scalar                    2842,2850                         
 MIN                        Func   3376                                 scalar                    3376,3404,3419,3434,3449,3464     
 MISWCH                     Common 2883                                 264                                                         
 MOD                        Func   3116                                 scalar                    3116,3117,3118                    
 MODPRT                     Scalar 2877     I(4)            4           scalar   COM              3043,3137,3138,3141               
 MP_PROCESS                 Scalar 2848     I(4)            4           scalar   COM              3037,3068                         
 MXLVL                      Param  2804     I(4)            4           scalar                    2853,3536                         
 MXPWT                      Param  2810     I(4)            4           scalar                                                      
 MXTYPV                     Param  2794     I(4)            4           scalar                                                      
 MXWRDH                     Param  2789     I(4)            4           scalar                    2849                              
 MXWRDL                     Param  2798     I(4)            4           scalar                                                      
 NAMEM                      Local  2834     CHAR            40    1     74                        2972,3488                         
 NAMEW                      Local  2834     CHAR            40    1     74                        2913,3488                         
 NET                        Local  2833     CHAR            14    1     10                        2902,3090,3092                    
 NEWPRT                     Local  3137     I(4)            4           scalar                    3137,3144                         
 NFILE                      Scalar 2852     I(4)            4           scalar   COM                                                
 NORTH                      Scalar 2835     L(4)            4           scalar   COM              3039,3165                         
 NPKRPT                     Scalar 2839     L(4)            4     1     12       COM              3050                              
 NPZ                        Scalar 2876     I(4)            4           scalar   COM                                                
 NTYPE                      Local  2841     I(4)            4     1     73                        3494,3507,3513,3516,3519,3522,3525
 NUMDAT                     Param  2818     I(4)            4           scalar                    2853                              
 NUMQMS                     Param  2816     I(4)            4           scalar                    2818                              
 NUMTYP                     Param  2822     I(4)            4           scalar                    2834,2841,2842,3486,3497,3498,3525
                                                                                                  ,3526                             
 NUMVAR                     Param  2816     I(4)            4           scalar                    2818                              
 OZONE                      Scalar 2888     R(4)            4           scalar   COM                                                
 PARM                       Local  3051                                 scalar                    3077,3136                         
 PARM2                      Common 2872                                 12                                                          
 PARM3                      Common 2873                                 56                                                          
 PARM4                      Common 2875                                 4                                                           
 PARM5                      Common 2876                                 32                                                          
 PARM6                      Common 2877                                 32                                                          
 PCAT                       Scalar 2861     R(4)            4           scalar   COM                                                
 PFRALT                     Scalar 2838     L(4)            4           scalar   COM              3047                              
 PFSWCH                     Common 2896                                 36                                                          
 PG4243                     Scalar 2836     L(4)            4           scalar   COM              3042                              

Page 70          Source Listing                  PREPOBS_PREPDATA
2017-04-18 11:09 Symbol Table                    prepdata.f

 Name                       Object Declared Type            Bytes Dimen Elements Attributes       References                        
                                                                                                                                    
 PHI                        Scalar 2854     R(4)            4     1     6        COM              3041                              
 PHIACF                     Scalar 2860     R(4)            4     1     7        COM              3046                              
 PHISWN                     Scalar 2856     R(4)            4     1     7        COM              3044                              
 PMAND                      Scalar 2850     R(4)            4     1     23       COM                                                
 POAF                       Scalar 2860     R(4)            4           scalar   COM                                                
 POLA                       Scalar 2835     L(4)            4           scalar   COM              3039,3164                         
 POLEI                      Scalar 2846     R(4)            4           scalar   COM              3039,3163                         
 POLEJ                      Scalar 2846     R(4)            4           scalar   COM              3039                              
 PREP                       Subr   3196                                                           3196                              
 PREPOBS_PREPDATA           Prog   2785                                                                                             
 PREVEN                     Scalar 2838     L(4)            4           scalar   COM              3038,3071                         
 PREVSW                     Common 2893                                 4                                                           
 PRFLER                     Scalar 2837     L(4)            4     1     4        COM              3045                              
 PROFILERINADPUPA           Scalar 2896     R(4)            4           scalar   COM                                                
 PSTNFLG                    Common 2898                                 4                                                           
 PWINDO                     Scalar 2896     R(4)            4     1     4        COM              3045                              
 QIFN                       Scalar 2858     R(4)            4           scalar   COM                                                
 QIFY                       Scalar 2858     R(4)            4           scalar   COM                                                
 RADANC                     Common 2888                                 320                                                         
 RASS                       Scalar 2839     L(4)            4           scalar   COM              3049                              
 RASSSW                     Common 2897                                 8                                                           
 RDATA                      Scalar 2850     R(4)            4     1     3500     COM                                                
 RECCON                     Scalar 2835     L(4)            4           scalar   COM              3040                              
 RECSLM                     Scalar 2837     L(4)            4           scalar   COM              3046                              
 RFFL                       Scalar 2858     R(4)            4           scalar   COM                                                
 RGRID                      Local  3039                                 scalar                    3075,3131                         
 RIALR                      Scalar 2861     R(4)            4           scalar   COM                                                
 ROLF                       Scalar 2861     R(4)            4           scalar   COM                                                
 RPTHDR                     Common 2849                                 88                                                          
 RTRAD                      Scalar 2888     R(4)            4     1     35       COM                                                
 RUNSW                      Common 2851                                 4                                                           
 RWINDO                     Scalar 2873     R(4)            4           scalar   COM              3043                              
 SATMST                     Scalar 2835     L(4)            4     3     80       COM              3041                              
 SATSW2                     Common 2854                                 1944                                                        
 SATSW3                     Common 2856                                 11604                                                       
 SAZANG                     Scalar 2888     R(4)            4           scalar   COM                                                
 SCTWCH                     Common 2885                                 208                                                         
 SETBMISS                   Subr   3155                                                           3155                              
 SKGNSS                     Scalar 2839     L(4)            4           scalar   COM              3050                              
 SKGP45                     Scalar 2839     L(4)            4           scalar   COM              3050                              
 SKINT                      Scalar 2889     R(4)            4           scalar   COM                                                
 SKPCNT                     Common 2878                                 252                                                         
 SKPSUB                     Common 2895                                 205824                                                      
 SNDATA                     Common 2853                                 38400                                                       
 SOZANG                     Scalar 2888     R(4)            4           scalar   COM                                                
 SPCIAL                     Scalar 2836     L(4)            4           scalar   COM              3044                              
 SRAD                       Scalar 2883     R(4)            4     1     7        COM                                                
 STNID                      Scalar 2831     CHAR            8           scalar   COM                                                
 STNPRT                     Scalar 2831     CHAR            8     1     3        COM              3044                              
 SUBSET_D                   Scalar 2831     CHAR            8           scalar   COM                                                
 SUBSKP                     Scalar 2839     L(4)            4     2     51456    COM              3049                              
 SWINDO_E                   Scalar 2856     R(4)            4     3     480      COM              3040                              
 SWINDO_L                   Scalar 2857     R(4)            4     3     480      COM              3041                              
 SWNLND                     Scalar 2836     L(4)            4     3     480      COM              3041                              
 SYSTEM                     Subr   3537                                                           3537                              

Page 71          Source Listing                  PREPOBS_PREPDATA
2017-04-18 11:09 Symbol Table                    prepdata.f

 Name                       Object Declared Type            Bytes Dimen Elements Attributes       References                        
                                                                                                                                    
 TASK                       Local  3037                                 scalar                    3069,3129                         
 TDLIM                      Scalar 2870     R(4)            4           scalar   COM              3043                              
 TDMAX                      Scalar 2870     R(4)            4           scalar   COM              3043                              
 TOVBFR                     Scalar 2837     L(4)            4     1     2        COM              3046,3078,3082,3086,3087,3276,3279
 TOVEDS                     Scalar 2835     L(4)            4     1     2        COM              3040,3083,3084,3085,3276,3284     
 TOVRAD                     Scalar 2837     L(4)            4           scalar   COM              3047,3079,3280                    
 TOVRTV                     Scalar 2837     L(4)            4           scalar   COM              3047,3080,3282                    
 TR80KM                     Scalar 2836     L(4)            4           scalar   COM              3045                              
 TRBX                       Scalar 2860     R(4)            4     1     5        COM                                                
 TVSWCH                     Common 2862                                 108                                                         
 TWINDO                     Scalar 2897     R(4)            4           scalar   COM              3049                              
 UNITNO                     Common 2852                                 116                                                         
 UPALIM                     Common 2870                                 28                                                          
 UWINDO                     Scalar 2873     R(4)            4           scalar   COM              3043                              
 VADWIN                     Scalar 2837     L(4)            4           scalar   COM              3046                              
 VWINDO                     Scalar 2873     R(4)            4           scalar   COM              3047                              
 W3FIZZ                     Subr   3200                                                           3200                              
 W3LOCDAT                   Subr   3122                                                           3122                              
 W3PRADAT                   Subr   3123                                                           3123                              
 W3TAGB                     Subr   3052                                                           3052                              
 W3TAGE                     Subr   3191                                                           3191,3548,3558,3562               
 WORD                       Common 2844                                 8                                                           
 WORDLENGTH                 Subr   3054                                                           3054                              
 WRMISS                     Scalar 2839     L(4)            4           scalar   COM              3050                              
 XMESHL                     Scalar 2846     R(4)            4           scalar   COM              3039                              
 XWINDO                     Scalar 2883     R(4)            4     2     24       COM              3044                              
 YNLIM                      Scalar 2846     R(4)            4           scalar   COM              3163,3168                         
 YSLIM                      Scalar 2847     R(4)            4           scalar   COM              3162,3163,3166                    

Page 72          Source Listing                  PREPOBS_PREPDATA
2017-04-18 11:09                                 prepdata.f

   3565 C$$$  SUBPROGRAM DOCUMENTATION BLOCK
   3566 C
   3567 C SUBPROGRAM:    PREP
   3568 C   PRGMMR: Keyser           ORG: NP22       DATE: 2016-11-30
   3569 C
   3570 C ABSTRACT: PERFORMS SEVERAL FUNCTIONS - UNPACKS REPORTS ONE AT A TIME
   3571 C   INTO UNPACKED IW3UNPBF FMT, PERFORMING SEVERAL CHECKS SUCH AS
   3572 C   WHETHER REPORT IS WITHIN TIME LIMIT OR DATA EXTRACTION BOUNDARY -
   3573 C   CALLS PROPER SUBROUTINE TO ACTUALLY PROCESS UPPER AIR DATA (ALL
   3574 C   TYPES & CATEGORIES) - FINALLY CALLS SUBROUTINES TO UNPACK AND
   3575 C   EVENTUALLY PROCESS SATELLITE RETRIEVALS AND SURFACE REPORTS.
   3576 C
   3577 C PROGRAM HISTORY LOG:
   3578 C   UNKNOWN
   3579 C 1988-04-11  D. A. KEYSER -- DOCBLOCKED/COMMENTED, STREAMLINED;
   3580 C    SATWND CHECK FOR OVERLAND REPORTS ADDED
   3581 C 1988-08-24  D. A. KEYSER -- ADDED SWITCHES TO PROCESS NHC SAT. WINDS
   3582 C 1988-10-25  D. A. KEYSER -- MODIFIED TO PROCESS WATER VAPOR CHN WINDS;
   3583 C    NEW SWITCHES FOR SATWNDS; REF. TO ON29 TOVS REMOVED
   3584 C 1989-02-16  D. A. KEYSER -- TIME WINDOW TYPE DEPENDENT; KEEP/TOSS
   3585 C    TYPE DEPENDENT; LAND CHECK POSSIBLE FOR AIRCRAFT RPTS
   3586 C 1989-12-13  D. A. KEYSER -- RESTRUCTRED CAT. 6 REPORT PROCESSING
   3587 C 1990-01-11  D. A. KEYSER -- CONVERTED TO VS FORTRAN(77) & RESTRUCTURED
   3588 C 1990-07-11  D. A. KEYSER -- SWITCH 'FGGE' REMOVED FROM N-LIST (FALSE)
   3589 C 1990-10-25  D. A. KEYSER -- NEW SUBR. 'UNPO29' + ENTRIES NOW UNPACKS
   3590 C    REPORTS FROM ON29 DATA SETS (STREAMLINED)
   3591 C 1991-06-07  D. A. KEYSER -- ADDED PROCESSING OF PROFILER DATA
   3592 C 1992-01-27  D. A. KEYSER -- HANDLES CLASS SNDGS (ON29 R.TYPE=13, OI/
   3593 C    SSI R.TYPE=122/222) W/ SWITCHES 'LSMASS,LSWIND,CWINDO'
   3594 C 1992-06-10  D. A. KEYSER -- SPCIAL AND ALL FILL SWITCHES SET TO FALSE
   3595 C    FOR SAT. RETR.. (ALL TYPES) REGARDLESS OF OUTPUT D-SET
   3596 C 1992-12-02  D. A. KEYSER -- CALLS W3FI77 RATHER THAN W3FI60 TO UNPACK
   3597 C    PROFILER RPTS DIRECTLY FROM SEQ'L BUFR FILES
   3598 C 1993-02-10  D. A. KEYSER -- MODIFIED TO CALL NEWEST VERSION OF W3FI77
   3599 C 1993-03-17  D. A. KEYSER -- MODIFIED TO CALL NEWEST VERSION OF W3FI77
   3600 C    (PROFLR DCTY NO LONGER READ IN, CHG IN FORMAT OF O-PUT 'IDATA'
   3601 C    ARRAY)
   3602 C 1993-05-31  D. A. KEYSER -- CALLS SUBR. "SATBFR" TO PROCESS TOVS RETR.
   3603 C    FROM INPUT BUFR-FMT FILES, CURRENTLY PROCESSES ONLY NESDIS 40-LVL
   3604 C    (80KM) RETR. (LATER NMC INTERACT. RETR.) CHANGED DEFAULT VALUES
   3605 C    AND ORDER FOR N-LIST SWITCH "IUNIT"
   3606 C 1993-09-14  D. A. KEYSER -- ADDED N-LIST SWITCH "TVIRT" TO OUTPUT
   3607 C    TEMP. AS VIRTUAL (=TRUE, DEFAULT) OR AS SENSIBLE (=FALSE) FOR
   3608 C    RAOB, RECCO/DROPS, CLASS & SFC DATA
   3609 C 1993-10-07  D. A. KEYSER -- PGM RUNS TO COMPL. W/ C.CODE=04 IF EITHER
   3610 C    ADPUPA OR ADPSFC CONTAIN NO RPTS
   3611 C 1993-11-02  D. A. KEYSER -- SINGLE-LVL CAT. 1 RECCOS NOW PROCESSED IN
   3612 C    SUBR. 'GETC06'
   3613 C 1994-08-11  D. A. KEYSER -- N-LIST SWITCH 'MARLND' NOW APPLIES TO
   3614 C    OCEAN STATION UPPER-AIR (RAOB, PIBAL) REPORTS AS WELL AS TO MARINE
   3615 C    SFC RPTS
   3616 C 1995-07-12  D. A. KEYSER -- ADDED CALL TO SUBR. 'GOESDG' TO PROCESS
   3617 C    GOES SOUNDINGS AND/OR PRECIPITABLE WATER; CHECKS FOR AND TOSSES
   3618 C    'CLIMATOLOGY' REPORTS; ADDED TABLE SUMMARIZING ACFT COUNTS BY LAT.
   3619 C    BAND; ADDED PROCESSING OF VAD (NEXRAD) WINDS VIA CALLS TO W3FI77;
   3620 C    ACCOUNTED FOR CHANGES/FIXES TO RECCO DECODER (AUG. 95) BY
   3621 C    REFORMATTING BACK TO OLD FORMAT SINCE EXISTING LOGIC WILL CORRECT

Page 73          Source Listing                  PREPOBS_PREPDATA
2017-04-18 11:09                                 prepdata.f

   3622 C    ERRORS
   3623 C 1996-10-24  D. A. KEYSER -- ADDED LOGIC TO PROCESS ERS SCATTEROMETER
   3624 C    WIND REPORTS (R.TYPE=286) VIA CALL TO NEW SUBR. "GETERS"
   3625 C 1997-01-31  D. A. KEYSER -- ADDED CALL TO NEW SUBR. "W3UNPK77" WHEN
   3626 C    INPUT WIND PROFILER DATA SET IS FROM BUFR DATA DUMP
   3627 C 1997-07-02  D. A. KEYSER -- PROFLR AND VADWND GENERATE SPECIAL LEVELS
   3628 C    BASED ON "SPCIAL" SWITCH (BEFORE, HARDWIRED TO ALWAYS GENERATE
   3629 C    SPECIAL LEVELS)
   3630 C 1998-06-15  D. A. KEYSER -- STREAMLINED THE PROCESSING OF CAT. 6
   3631 C    RECCOS W/ EITHER MAND LVL GEOPOT. OBS OR MEAN SEA-LVL PRESS. OBS
   3632 C 1999-01-20  D. A. KEYSER -- N-LIST SWITCHES "RECCON" AND "RWINDO" NOW
   3633 C    APPLY ONLY TO RECCO DATA, NEW SWITCHES "DROPSN" AND "DWINDO" NOW
   3634 C    APPLY TO DROPS
   3635 C 1999-08-04  D. A. KEYSER -- THE LOGIC THAT ALLOWS PROFILER DATA FROM
   3636 C    EITHER 1-HR PREV OR 1-HR LATER TO BE USED IF ONLY A SINGLE TIME
   3637 C    SELECTED AND NO DATA AT THAT TIME FOUND CONFINED TO ONLY OI RUNS
   3638 C    (WAS FOR ALL TYPES); R.C. =4 NOW OCCURS IF EITHER NO ADPUPA OR
   3639 C    ADPSFC REPORTS WERE PROCESSED INTO PREPBUFR FILE, BEFORE IT
   3640 C    OCCURRED ONLY IF EITHER NO ADPUPA OR ADPSFC REPORTS WERE READ IN
   3641 C 2000-02-17  D. A. KEYSER -- CAN NOW SKIP OVER INPUT BUFR MESSAGES IN
   3642 C    DATA DUMP FILES IF THE BUFR TYPE/SUBTYPE IS SET TO BE EXCLUDED
   3643 C    (BEFORE EXCLUSION OCCURRED ONLY AFTER REPORT WAS DECODED FROM DUMP
   3644 C    FILE), THIS MAKES THIS PROGRAM MORE EFFICIENT IN THESE CASES
   3645 C    (NOTE: APPLIES ONLY TO U-AIR AND SURFACE LAND DATA READ IN VIA
   3646 C    FUNCTION IW3UNPBF)
   3647 C 2001-04-06  D. A. KEYSER -- CAN HANDLE PROFILERS ORIG. IN PILOT
   3648 C    (PIBAL) FORMAT BULLETINS IN "PROFLR" DUMP FILE; NOW PROCESSES
   3649 C     SSM/I RAIN RATE UNDER R.TYP 150; N-LIST SWITCH SWINDO SPLIT INTO
   3650 C     SWINDO_e (EARLIEST TIME WINDOW) AND SWINDO_l (LATEST TIME WINDOW)
   3651 C     FOR SATWND REPORTS ("-" PRIOR TO CYCLE TIME, "+" AFTER CYCLE
   3652 C     TIME) (SAME DEFAULTS AS BEFORE); SUBR. "RPTLBL" NOW HAS INPUT
   3653 C     ARGS. "TIMWIN_e" (EARLIEST TIME WINDOW) AND "TIMWIN_l" (LATEST
   3654 C     TIME WINDOW) REPL. "TIMWIN" (+/- TIME WINDOW) ("-" PRIOR TO CYCLE
   3655 C     TIME, "+" AFTER CYCLE TIME), ALLOWS THE 2 TO BE DIFFERENT
   3656 C 2001-06-19  D. A. KEYSER -- NEW SUBR. "TIMCHK" DOES TIME WINDOW CHECK
   3657 C     SEPARATE FROM "RPTLBL"; N-LIST SWITCHES "GOESND", "GOESPW",
   3658 C     "GOESRD" AND NEW "GOESCT" NOW LENGTH 2 TO PROCESS THE 4 GOESND
   3659 C     TYPES FORM EITHER 5X5 OR 1X1 FOV
   3660 C 2004-09-09  D. A. KEYSER -- ADDED PROCESSING OF GPS-IPW DATA, READ
   3661 C     FROM "GPSIPW" DUMP FILE DUMP R. TYPE 74, GET PREPBUFR R. TYPE
   3662 C     153, PROCESSED BY NEW SUBR. "GETGPSIPW" INTO PREPBUFR FILE UNDER
   3663 C     NEW TBL A ENTRY "GPSIPW" {NEW NAMELIST SWITCH JPGPSD (PROCESS/
   3664 C     DON'T PROCESS)}; ADDED PROCESSING OF NPN AND CAP RASS DATA READ
   3665 C     FROM "RASSDA" DUMP FILE IN NEW DATA LVL CAT. 15, DUMP R. TYPE 77,
   3666 C     GET PREPBUFR R. TYPE 126, PROCESSED INTO PREPBUFR FILE UNDER NEW
   3667 C     TBL A ENTRY "RASSDA" {NEW NAMELIST SWITCHES TWINDO (TIME WINDOW
   3668 C     ABOUT CYCLE TIME FOR ACCEPTING)} AND RASS (PROCESS/DON'T
   3669 C     PROCESS); ADDED PROCESSING OF EAMDAR ACFT RPTS NOW POSSIBLY INCL.
   3670 C     IN "AIRCFT" DUMP FILE DUMP R. TYPE 41, SUBTYPE 6, INCL. WITH
   3671 C     EXISTING PREPBUFR R. TYPES 131/231, PROCESSED INTO PREPBUFR FILE
   3672 C     UNDER EXISTING TBL A ENTRY "AIRCFT"; ADDED PROCESSING OF CAP AND
   3673 C     JAPANESE WIND PROFILERS NOW POSSIBLY INCL. IN "PROFLR" DUMP FILE
   3674 C     DUMP R. TYPES 75 AND 76, RESP., GETS PREPBUFR R. TYPES 227 AND
   3675 C     228, RESP., PROCESSED INTO PREPBUFR FILE UNDER EXISTING TBL A
   3676 C     ENTRY "PROFLR", WIND PROFILER RPTS ORIGINATING FROM PILOT (PIBAL)
   3677 C     BULLETINS NOW GET A UNIQUE PREPBUFR R. TYPE OF 229 {NAMELIST
   3678 C     SWITCHES PROFIL (PROCESS/DON'T PROCESS) CHANGED TO PRFLER AND

Page 74          Source Listing                  PREPOBS_PREPDATA
2017-04-18 11:09                                 prepdata.f

   3679 C     NWINDO (EARLIEST/LATEST TIME RELATIVE TO CYCLE TIME FOR
   3680 C     ACCEPTING) REPL. WITH PWINDO (TIME WINDOW ABOUT CYCLE TIME FOR
   3681 C     ACCEPTING)}; FOR VAD WINDS NAMELIST SWITCH VADWND CHANGED TO
   3682 C     VADWIN (PROCESS/DON'T PROCESS) AND NAMELIST SWITCH MWINDO
   3683 C     (EARLIEST/LATEST TIME RELATIVE TO CYCLE TIME FOR ACCEPTING) REPL.
   3684 C     WITH VWINDO (TIME WINDOW ABOUT CYCLE TIME FOR ACCEPTING); ADDED
   3685 C     PROCESSING OF NASA/MODIS POES AQUA/TERRA SATELLITE-DERIVED WINDS,
   3686 C     NOW POSSIBLY INCL. IN "SATWND" DUMP FILE EXISTING DUMP R. TYPE
   3687 C     63, GET PREPBUFR R. TYPES 257 (IR), 258 (W.VAPOR IMGR CLOUD-TOP)
   3688 C     AND 259 (W.WAPOR IMGR DEEP LAYER), PROCESSED INTO PREPBUFR FILE
   3689 C     UNDER EXISTING TBL A ENTRY "SATWND"
   3690 C 2005-07-01  D. A. KEYSER -- NOW STORES A VALUE 2 INTO REPORT SUBTYPE
   3691 C     (HEADER WORD 8) FOR DROPWINSONDE REPORTS IN REPORT TYPE 132/232 -
   3692 C     LATER GETS ENCODED INTO PREPBUFR UNDER MNEMONIC "TSB" (SUBR.
   3693 C     GETC06 STORES THIS AS 1 FOR RECCOS - THIS ALLOWS DROPS AND RECCOS
   3694 C     TO BE DIFFERENTIATED IN PREPBUFR)
   3695 C 2007-09-14  D. A. KEYSER -- MODIFIED TO RECOGNIZE HIGH-DENSITY JMA
   3696 C     SATELLITE WINDS DERIVED FROM BUFR BULLETINS IN NC005044-NC005046
   3697 C     WHICH MAY NOW BE IN INPUT "satwnd" DUMP FILE IN PLACE OF LOW-
   3698 C     DENSITY JMA WINDS DERIVED FROM SATOB BULLETINS IN NC005041-
   3699 C     NC005043 (EITHER BUFR OR SATOB WILL BE PROCESSED); MODIFIED TO
   3700 C     PROCESS WINDSAT SCATTEROMETER REPORTS, READ FROM NEW "WDSATR"
   3701 C     DUMP FILE (GETS PREPBUFR REPORT TYPE 289 AND ENCODES NEW
   3702 C     PARAMETERS MRWVC, MRLWC, WSST, MWD10, MWS10, WSEQC1, CHSQ, PHER,
   3703 C     SPDE, SSTE, CLDE AND VPRE IN PREPBUFR FILE UNDER NEW MESSAGE TYPE
   3704 C     "WDSATR); MODIFIED TO HANDLE RETURN OF NEW ARGUMENT "RDATA2" FROM
   3705 C     CALLS TO W3UNPKB7 [1-DIM 21-WORD ARRAY WHICH HOLDS ADDITIONAL
   3706 C     VALUES DECODED DIRECTLY FROM BUFR (AND NOT IN "RDATA" ARRAY), FOR
   3707 C     SOME PARAMETERS REPLACING WHAT HAD BEEN RETURNED IN "RDATA" ARRAY
   3708 C     (IN THE HEADER)]
   3709 C 2008-09-12  D. A. KEYSER -- MODIFIED TO RECOGNIZE THAT TAMDAR REPORTS
   3710 C     CAN NOW APPEAR IN "aircft" DUMP MESSAGE TYPES NC004012 (PENAIR)
   3711 C     AND NC004013 (CHAUTAUQUA) IN ADDITION TO MESSAGE TYPE NC004008
   3712 c     (MESABA)
   3713 C 2008-09-25  D. A. KEYSER -- CAN NOW PROCESS ASCAT SCATTEROMETER
   3714 C     WIND DATA READING FROM REPROCESSED DUMP FILE IN UNIT 39, ENCODING
   3715 C     INTO NEW PREPBUFR REPORT TYPE 290 UNDER NEW PREPBUFR MESSAGE TYPE
   3716 C     "ASCATW" VIA NEW NAMELIST SWITCHES "JPASCD" (DEF=6*9999) AND
   3717 C     IAWNDO (DEF=-3,+3)
   3718 C 2014-04-25  Y. Ling      -- Handles new VAD wind reports from Level 2
   3719 C     decoder.  Differentiates between these and existing Radar Coded
   3720 C     Message (RCM) VAD wind reports via use of report subtype (TSB=1
   3721 C     for RCM and =2 for Level 2).
   3722 C 2015-01-30  D. A. Keyser -- All references to IR satellite-derived
   3723 C     winds now expanded to refer to IR "long-wave" - this
   3724 C     differentiates them from IR "short-wave" winds which are now
   3725 C     produced from GOES but are not processed by this program. Skips
   3726 C     over the reading of reports in "satwnd" dump coming from tanks
   3727 C     NC005080 (AVHRR POES) and NC005090 (VIIRS POES) since these
   3728 C     cannot be processed by this program.
   3729 C 2016-02-08  S. Melchior --
   3730 C      - Processes two new aircraft data types in AIRCFT message type:
   3731 C        Korean AMDAR (BUFR) and Catch-all AMDAR (BUFR).  Either pre-
   3732 C        version 7 BUFR or new version 7 BUFR for Catch-All AMDAR,
   3733 C        MDCRS and E-AMDAR can be handled.
   3734 C          - The following arrays' dimensions were increased and
   3735 C            defaults adjusted: AWINDO, AIRLND, JAWIND, JAMASS, IACFTL,

Page 75          Source Listing                  PREPOBS_PREPDATA
2017-04-18 11:09                                 prepdata.f

   3736 C            IACFTH, AIFNOW, FLACMS, KSKALM, KSKAHM, KEPAC, KSKNOW,
   3737 C            INAC.
   3738 C 2016-10-27  C. Hill --
   3739 C      - TAMDARB AIRCFT message type added to handle BUFR form of TAMDAR
   3740 C        reports.  Allows for older (pre-2011) and newer TAMDAR data to
   3741 C        be processed.  The array sizes of AWINDO, AIRLND, JAWIND,
   3742 C        JAMASS, IACFTL, IACFTH, AIFNOW, FLACMS, KSKALM, KSKAHM, KEPAC,
   3743 C        KSKNOW, and INAC were all increased to (6,9).
   3744 C 2016-11-30  D. A. KEYSER -- Accounts for new output argument "OBS8_8"
   3745 C     returned from W3UNPKB7 for unpacked reports (REAL*8 2-word array
   3746 C     containing latitude and longitude of report).
   3747 C
   3748 C USAGE:    CALL PREP
   3749 C   INPUT FILES:
   3750 C     UNIT EE   - 'ADPUPA' BUFR DATA DUMP FILE (RAOB/PIBAL/DROPS/RECCOS)
   3751 C     UNIT EE+1 - 'AIRCAR' BUFR DATA DUMP FILE (MDCRS AIRCRAFT)
   3752 C     UNIT EE+2 - 'AIRCFT' BUFR DATA DUMP FILE (ALL AIRCRAFT OTHER THAN
   3753 C                  MDCRS)
   3754 C     UNIT EE+3 - 'SATWND' BUFR DATA DUMP FILE (SATELLITE-DERIVED WINDS)
   3755 C     UNIT EE+4 - 'PROFLR' BUFR DATA DUMP FILE (WIND PROFILER)
   3756 C     UNIT EE+5 - 'VADWND' BUFR DATA DUMP FILE (NEXRAD VAD WINDS)
   3757 C     UNIT EE+6 - 'RASSDA' BUFR DATA DUMP FILE (RASS TEMPERATURES)
   3758 C    (WHERE EE IS UNIT NUMBER DEFINED AS IUNIT(5) IN NAMELIST "&PARM")
   3759 C
   3760 C   OUTPUT FILES:
   3761 C     UNIT 06  - STANDARD OUTPUT PRINT
   3762 C
   3763 C REMARKS: CALLED BY MAIN PROGRAM.
   3764 C
   3765 C ATTRIBUTES:
   3766 C   LANGUAGE: FORTRAN 90
   3767 C   MACHINE:  NCEP WCOSS
   3768 C
   3769 C$$$
   3770       SUBROUTINE PREP
   3771       PARAMETER (MXWRDH = 15)
   3772       PARAMETER (MXTYPV =  3)
   3773       PARAMETER (MXWRDL =  6)
   3774       PARAMETER (MXLVL = 600)
   3775       PARAMETER (MAXOBS = 3500)
   3776 C PARAMETER NAME "NUMOBS2"  THROUGHOUT PGM SETS NO. OF ELEMENTS IN OBS2
   3777 C  ARRAY
   3778       PARAMETER (NUMOBS2 = 43)
   3779 C PARAMETER NAME "MXBLVL"  THROUGHOUT PGM SETS MAXIMUM NO. OF REPORT
   3780 C  LEVELS THAT CAN BE PROCESSED AND ENCODED INTO BUFR MESSAGES
   3781       PARAMETER (MXBLVL = 255)
   3782       CHARACTER*8   STNPRT,STNID,FILNAM(7),DSNAME,SUBSET_d
   3783       CHARACTER*25  DNAME(3)
   3784       CHARACTER*47  NAME1
   3785       CHARACTER*56  NAME2
   3786       LOGICAL  RECCON,TOVEDS,GOESND,FILLZ,SWNLND,AIRLND,PRFLER,
   3787      $ SPCIAL,FILLW,FILLT,FILLM,TOVBFR,MARLND,GOESPW,GOESCT,VADWIN,
   3788      $ GOESRD,FLRECO,DROPSN,SUBSKP,PROFILERinADPUPA,RASS
   3789       INTEGER  IDATA(MAXOBS),MDATE(4)
   3790       INTEGER(8) IDSDMP_8
   3791       REAL(8)  BMISS,obs8_8,alon_8,alat_8
   3792       COMMON/STRCTY/ICAT(MXLVL)

Page 76          Source Listing                  PREP
2017-04-18 11:09                                 prepdata.f

   3793       COMMON/STRMOB/MOBS(MXTYPV,MXWRDL,MXLVL)
   3794       COMMON/STRMSL/IPMSL(MXTYPV)
   3795       COMMON/ADP/ISATOB,PMAND(23),RDATA(MAXOBS),IPRINT
   3796       COMMON/DATA/KOUNT,IDATE(4),IDAT10,MP_PROCESS,WRMISS
   3797       COMMON/RPTHDR/SUBSET_d,STNID,HDR(2:MXWRDH),alon_8,alat_8
   3798       COMMON/UNITNO/NFILE,IUNIT(28)
   3799       COMMON/UPALIM/LEVPM,LEVST,LEVQQ,TDLIM,TDMAX,SPCIAL,ISQNUM_UPA
   3800       COMMON/SATSW3/PHISWN(7),SWNLND(6,8,10),SWINDO_e(6,8,10),
   3801      $ SWINDO_l(6,8,10),JSWIND(6,8,10),JSMASS(6,8,10),KEPSW(6,8,10),
   3802      $ KSKSWD(10),RFFL,QIFY,QIFN,EEQF
   3803       COMMON/ACFTSW/AWINDO(2,9),AIRLND(6,9),JAWIND(6,9),JAMASS(6,9),
   3804      $ IACFTL(9),IACFTH(9),PHIACF(7),KEPAC(6,9),AIFNOW(9),POAF,TRBX(5),
   3805      $ FLACMS(9),PCAT,ROLF,aMSTQ,RIALR
   3806       COMMON/TVSWCH/TOVEDS(2),TOVBFR(2),TR80KM,KNTTOV(2),
   3807      $ KSKPTV(2),KNOPTV(2),KIPTTV(2),KMSGTV(2),KBDYTV(2),KTIMTV(2),
   3808      $ KLNDTV(2),KSEATV(2),KREDTV(2),KJFLAG(2)
   3809       COMMON/GOSWCH/GOESND(2),GOESPW(2),GOESCT(2),KNTGIT,KNTGIS,KNTGIP,
   3810      $ KSKPGI,KNDCGI,KNOPGI,KMSGGI,KBDYGI,KTIMGI(3),KLNDGI(3),KSEAGI(3),
   3811      $ KNTGIC,KNOCTP
   3812       COMMON/GPSWCH/JPGPSD(6),GWINDO,KNTGPS,KSKPGP,KMSGGP,KBDYGP,KTIMGP,
   3813      $ KMISGP,KT45GP,SKGP45,SKGNSS,KTGNSS
   3814       COMMON/RADANC/RTRAD(35),GRAD(18),IGCHN(18),SOZANG,SAZANG,OZONE,
   3815      $ SKINT,CLDAMT,TOVRAD,TOVRTV,GOESRD(2)
   3816       COMMON/PARM3/RECCON,RWINDO,UWINDO,RECSLM,FLRECO,VWINDO,VADWIN,
   3817      $ IVADFL,IVADSP,FLDMGS,FLDMAF,FLDMFR,DROPSN,DWINDO
   3818       COMMON/PARM4/ICODE
   3819       COMMON/PARM5/FILLZ,FILLT,FILLW,FILLM,LSWIND,LSMASS,CWINDO,NPZ
   3820       COMMON/PARM6/MODPRT,IFLUA,STNPRT(3)
   3821       COMMON/LNDSEA/GDSH(145,37),GDUS(362,91),GDNH(362,91)
   3822       COMMON/LFMSFC/LFMAXI,LFMAXJ,FMESHL,FLONVT,FPOLEI,FPOLEJ,MARLND,
   3823      $ JSURFM(12),JSURFW(12),FWINDO(12),PFRALT,npkrpt(12)
   3824       COMMON/SKPCNT/KSKPUA,KSKPSF,KMSGUA,KMSGSF,KBDYUA,KBDYSF,KTIMUA,
   3825      $ KTIMSF,KSKNSW,KSKREC,KNOATS,KNTUUU(10),KNTSFC,KNTSHP,KNTSLP,
   3826      $ KNTMSO,KNTSPL,KSKSWN,KSKACF,KNDCDE(3),KSKCLS,KSKTHN,KSKOMR(2),
   3827      $ KSKALM(9),KSKAHM(9),KSKNOW(9),KSKDRP
   3828       COMMON/MISWCH/XWINDO(6,4),JPSSMI(6,4),SRAD(7),KNTSMI(4),KTIMM(4),
   3829      $ KSKPMI,KMSGMI,KBDYMI
   3830       COMMON/SCTWCH/IEWNDO(2),JPERSD(6),IQWNDO(2),JPQKSD(6),IWWNDO(2),
   3831      $ JPWDSD(6),KSKPSC(4),KMSGSC(4),KBDYSC(4),KTIMSC(4),KNTSCT(4),
   3832      $ JPASCD(6),IAWNDO(2)
   3833       COMMON/SKPSUB/SUBSKP(0:255,0:200)
   3834       COMMON/PWSWCH/PWT(5),IQMPW
   3835       COMMON/PFSWCH/PRFLER(4),PWINDO(4),PROFILERinADPUPA
   3836       COMMON/RASSSW/RASS,TWINDO
   3837       COMMON/DIRECT/OBS3(5,MXBLVL,7),OBS2(NUMOBS2),NOBS3(7),RDATA2(25),
   3838      $ obs8_8(2)
   3839       COMMON /BUFRLIB_MISSING/BMISS
   3840       EQUIVALENCE  (IDATA,RDATA)
   3841       DATA  XMISS/99999./,IMISS/99999/
   3842       DATA  FILNAM/'ADPUPA  ','AIRCAR  ','AIRCFT  ','SATWND  ',
   3843      $             'PROFLR  ','VADWND  ','RASSDA  '/
   3844       DATA  DNAME/'WIND PROFILER DATA -     ',
   3845      $            'VAD WIND DATA - .........',
   3846      $            'RASS TEMPERATURE DATA - .'/
   3847       DATA  DATA4/0/
   3848       PWT = XMISS
   3849 C INITIALIZE IPMSL ARRAY (WILL REMAIN MISSING UNTIL SURFACE REPORTS)

Page 77          Source Listing                  PREP
2017-04-18 11:09                                 prepdata.f

   3850       IPMSL  = IMISS
   3851       OBS2   = BMISS  ! initialize obs2   array before reading any rpts
   3852       OBS3   = BMISS  ! initialize obs3   array before reading any rpts
   3853       NOBS3  = 0      ! initialize nobs3  array before reading any rpts
   3854       obs8_8 = bmiss  ! initialize obs8_8 array before reading any rpts
   3855       RDATA2 = BMISS  ! initialize rdata2 array before reading any rpts
   3856 C***********************************************************************
   3857 C UPPER-AIR DATA RPTS {RAOB/PIBAL/RECCO/CLASS, A-CFT FLIGHT LVL, SATWND
   3858 C       {ALL TYPES), WIND PROFILER, VAD WINDS, RASS TEMPERATURES}
   3859 C              (DATA LEVEL CATEGORIES 1-5, 6, 8, 10, 11, 15)
   3860 C***********************************************************************
   3861       PRINT 8001
   3862  8001 FORMAT(//30X,21('-'),' ***** UPPER-AIR DATA ***** ',21('-'))
   3863       NN = 1
   3864   700 CONTINUE
   3865       IPRFPIB   = 0
   3866       IOPENED   = 0
   3867       DSNAME    = 'ZZZZZZZZ'
   3868       IDSDAT    = 0
   3869       IDSDMP_8  = 0
   3870       SUBSET_d  = 'XXXXXXXX'
   3871 C KNTALL COUNTS NO. OF REPORTS UNPACKED FROM FILE (ALL REPORTS)
   3872       KNTALL = 0
   3873 C KOUNT COUNTS NO. OF REPORTS UNPACKED (& NOT SKIPPED) FROM FILE
   3874       KOUNT = 0
   3875 C INITIALIZE ALL LEVELS OF MOBS ARRAY (NOTE: FOR CAT. 6 PROCESSING,
   3876 C  SUBR. GETC06 WILL LATER INIT. ONLY FIRST TWO LEVELS FOR EACH RPT)
   3877       MOBS = IMISS
   3878 C INITIALIZE ALL LEVELS OF ICAT ARRAY (NOTE: FOR CAT. 6 PROCESSING,
   3879 C  SUBR. GETC06 WILL LATER INIT. ONLY FIRST TWO LEVELS FOR EACH RPT)
   3880       ICAT = IMISS
   3881       FLRECO = .FALSE.
   3882       PROFILERinADPUPA = .FALSE.
   3883       NFILE = NN + IUNIT(5) - 1
   3884       IF(NN.EQ.2)  THEN
   3885 C CHECK TO SEE IF AIRCAR (MDCRS) DATA SHOULD BE PROCESSED
   3886          IF(MIN(JAWIND(1,4),JAWIND(2,4),JAWIND(3,4),JAWIND(4,4),
   3887      $    JAWIND(5,4),JAWIND(6,4),JAMASS(1,4),JAMASS(2,4),JAMASS(3,4),
   3888      $    JAMASS(4,4),JAMASS(5,4),JAMASS(6,4)).EQ.9999)  GO TO 7001
   3889       ELSE IF(NN.EQ.3)  THEN
   3890 C CHECK TO SEE IF ANY BUFR MESSAGES CAN BE SKIPPED IN INPUT AIRCFT DUMP
   3891          IF(MIN(JAWIND(1,1),JAWIND(2,1),JAWIND(3,1),JAWIND(4,1),
   3892      $    JAWIND(5,1),JAWIND(6,1),JAMASS(1,1),JAMASS(2,1),JAMASS(3,1),
   3893      $    JAMASS(4,1),JAMASS(5,1),JAMASS(6,1)).EQ.9999)  THEN
   3894             SUBSKP(004,001) = .TRUE.
   3895             SUBSKP(004,002) = .TRUE.
   3896          END IF
   3897          IF(MIN(JAWIND(1,2),JAWIND(2,2),JAWIND(3,2),JAWIND(4,2),
   3898      $    JAWIND(5,2),JAWIND(6,2),JAMASS(1,2),JAMASS(2,2),JAMASS(3,2),
   3899      $    JAMASS(4,2),JAMASS(5,2),JAMASS(6,2)).EQ.9999)
   3900      $    SUBSKP(004,003) = .TRUE.
   3901          IF(MIN(JAWIND(1,3),JAWIND(2,3),JAWIND(3,3),JAWIND(4,3),
   3902      $    JAWIND(5,3),JAWIND(6,3),JAMASS(1,3),JAMASS(2,3),JAMASS(3,3),
   3903      $    JAMASS(4,3),JAMASS(5,3),JAMASS(6,3)).EQ.9999)
   3904      $    SUBSKP(004,006) = .TRUE.
   3905          IF(MIN(JAWIND(1,5),JAWIND(2,5),JAWIND(3,5),JAWIND(4,5),
   3906      $    JAWIND(5,5),JAWIND(6,5),JAMASS(1,5),JAMASS(2,5),JAMASS(3,5),

Page 78          Source Listing                  PREP
2017-04-18 11:09                                 prepdata.f

   3907      $    JAMASS(4,5),JAMASS(5,5),JAMASS(6,5)).EQ.9999) THEN
   3908             SUBSKP(004,008) = .TRUE.
   3909             SUBSKP(004,012) = .TRUE.
   3910             SUBSKP(004,013) = .TRUE.
   3911          END IF
   3912          IF(MIN(JAWIND(1,6),JAWIND(2,6),JAWIND(3,6),JAWIND(4,6),
   3913      $    JAWIND(5,6),JAWIND(6,6),JAMASS(1,6),JAMASS(2,6),JAMASS(3,6),
   3914      $    JAMASS(4,6),JAMASS(5,6),JAMASS(6,6)).EQ.9999)
   3915      $    SUBSKP(004,009) = .TRUE.
   3916          IF(MIN(JAWIND(1,7),JAWIND(2,7),JAWIND(3,7),JAWIND(4,7),
   3917      $    JAWIND(5,7),JAWIND(6,7),JAMASS(1,7),JAMASS(2,7),JAMASS(3,7),
   3918      $    JAMASS(4,7),JAMASS(5,7),JAMASS(6,7)).EQ.9999)
   3919      $    SUBSKP(004,011) = .TRUE.
   3920          IF(MIN(JAWIND(1,8),JAWIND(2,8),JAWIND(3,8),JAWIND(4,8),
   3921      $    JAWIND(5,8),JAWIND(6,8),JAMASS(1,8),JAMASS(2,8),JAMASS(3,8),
   3922      $    JAMASS(4,8),JAMASS(5,8),JAMASS(6,8)).EQ.9999)
   3923      $    SUBSKP(004,103) = .TRUE.
   3924          IF(MIN(JAWIND(1,9),JAWIND(2,9),JAWIND(3,9),JAWIND(4,9),
   3925      $    JAWIND(5,9),JAWIND(6,9),JAMASS(1,9),JAMASS(2,9),JAMASS(3,9),
   3926      $    JAMASS(4,9),JAMASS(5,9),JAMASS(6,9)).EQ.9999)
   3927      $    SUBSKP(004,010) = .TRUE.
   3928 C CHECK TO SEE IF AIRCFT DATA SHOULD BE PROCESSED
   3929          IF(SUBSKP(004,001).AND.SUBSKP(004,002).AND.SUBSKP(004,003).AND.
   3930      $      SUBSKP(004,006).AND.SUBSKP(004,008).AND.SUBSKP(004,009).AND.
   3931      $      SUBSKP(004,010).AND.SUBSKP(004,011).AND.SUBSKP(004,012).AND.
   3932      $      SUBSKP(004,013).AND.SUBSKP(004,103))
   3933      $    GO TO 7001
   3934       ELSE IF(NN.EQ.4)  THEN
   3935          SUBSKP(005,001:090) = .TRUE.
   3936 C CHECK TO SEE IF ANY BUFR MESSAGES CAN BE SKIPPED IN INPUT SATWND DUMP
   3937          LOOP1: DO II=1,6
   3938             LOOP1n1: DO JJ=1,2
   3939                IF(MIN(JSWIND(II,JJ,4),JSMASS(II,JJ,4)).LT.9999)  THEN
   3940                    ! ** GOES-E AND GOES-W Infrared (long-wave) **
   3941                   SUBSKP(005,010) = .FALSE. ! current
   3942                   SUBSKP(005,001) = .FALSE. ! historical (oldest)
   3943                   SUBSKP(005,005) = .FALSE. ! historical
   3944                   EXIT LOOP1
   3945                END IF
   3946             END DO LOOP1n1
   3947          END DO LOOP1
   3948          LOOP2: DO II=1,6
   3949             LOOP2n1: DO JJ=1,2
   3950                IF(MIN(JSWIND(II,JJ,5),JSMASS(II,JJ,5)).LT.9999)  THEN
   3951                    ! ** GOES-E AND GOES-W Visible **
   3952                   SUBSKP(005,012) = .FALSE. ! current
   3953                   SUBSKP(005,002) = .FALSE. ! historical (oldest)
   3954                   SUBSKP(005,008) = .FALSE. ! historical
   3955                   EXIT LOOP2
   3956                END IF
   3957             END DO LOOP2n1
   3958          END DO LOOP2
   3959          LOOP3: DO II=1,6
   3960             LOOP3n1: DO JJ=1,2
   3961                LOOP3n2: DO KK=6,7
   3962                   IF(MIN(JSWIND(II,JJ,KK),JSMASS(II,JJ,KK)).LT.9999)THEN
   3963                    ! ** GOES-E AND GOES-W Water Vapor Imager **

Page 79          Source Listing                  PREP
2017-04-18 11:09                                 prepdata.f

   3964                      SUBSKP(005,011) = .FALSE. ! current
   3965                      SUBSKP(005,003) = .FALSE. ! historical (oldest)
   3966                      SUBSKP(005,006) = .FALSE. ! historical
   3967                      EXIT LOOP3
   3968                   END IF
   3969                END DO LOOP3n2
   3970             END DO LOOP3n1
   3971          END DO LOOP3
   3972          LOOP4: DO II=1,6
   3973             LOOP4n1: DO JJ=1,2
   3974                LOOP4n2: DO KK=8,9
   3975                   IF(MIN(JSWIND(II,JJ,KK),JSMASS(II,JJ,KK)).LT.9999)THEN
   3976                    ! ** GOES-E AND GOES-W Water Vapor Sounder **
   3977                      SUBSKP(005,014) = .FALSE. ! current
   3978                      EXIT LOOP4
   3979                   END IF
   3980                END DO LOOP4n2
   3981             END DO LOOP4n1
   3982          END DO LOOP4
   3983          LOOP5: DO II=1,6
   3984             LOOP5n1: DO JJ=1,2
   3985                IF(MIN(JSWIND(II,JJ,10),JSMASS(II,JJ,10)).LT.9999)  THEN
   3986                    ! ** GOES-E AND GOES-W Picture Triplet **
   3987                   SUBSKP(005,013) = .FALSE. ! current
   3988                   SUBSKP(005,004) = .FALSE. ! historical (oldest)
   3989                   SUBSKP(005,009) = .FALSE. ! historical
   3990                   EXIT LOOP5
   3991                END IF
   3992             END DO LOOP5n1
   3993          END DO LOOP5
   3994          DO II=1,6
   3995             IF(MIN(JSWIND(II,3,1),JSMASS(II,3,1)).LT.9999)  THEN
   3996                SUBSKP(005,021) = .FALSE.
   3997                EXIT
   3998             END IF
   3999          END DO
   4000          DO II=1,6
   4001             IF(MIN(JSWIND(II,3,3),JSMASS(II,3,3)).LT.9999)  THEN
   4002                SUBSKP(005,022) = .FALSE.
   4003                EXIT
   4004             END IF
   4005          END DO
   4006          DO II=1,6
   4007             IF(MIN(JSWIND(II,3,2),JSMASS(II,3,2)).LT.9999)  THEN
   4008                SUBSKP(005,023) = .FALSE.
   4009                EXIT
   4010             END IF
   4011          END DO
   4012          DO II=1,6
   4013             IF(MIN(JSWIND(II,4,1),JSMASS(II,4,1)).LT.9999)  THEN
   4014                SUBSKP(005,044) = .FALSE. ! current
   4015                SUBSKP(005,041) = .FALSE. ! historical
   4016                EXIT
   4017             END IF
   4018          END DO
   4019          DO II=1,6
   4020             IF(MIN(JSWIND(II,4,3),JSMASS(II,4,3)).LT.9999)  THEN

Page 80          Source Listing                  PREP
2017-04-18 11:09                                 prepdata.f

   4021                SUBSKP(005,045) = .FALSE. ! current
   4022                SUBSKP(005,042) = .FALSE. ! historical
   4023                EXIT
   4024             END IF
   4025          END DO
   4026          DO II=1,6
   4027             IF(MIN(JSWIND(II,4,2),JSMASS(II,4,2)).LT.9999)  THEN
   4028                SUBSKP(005,046) = .FALSE. ! current
   4029                SUBSKP(005,043) = .FALSE. ! historical
   4030                EXIT
   4031             END IF
   4032          END DO
   4033          LOOP8: DO II=1,6
   4034             LOOP8n1: DO JJ=5,6
   4035                IF(MIN(JSWIND(II,JJ,1),JSMASS(II,JJ,1)).LT.9999)  THEN
   4036               ! ** METEOSAT-ODD AND METEOSAT-EVEN Infrared (long-wave)**
   4037                   SUBSKP(005,064) = .FALSE. ! current
   4038                   SUBSKP(005,061) = .FALSE. ! historical
   4039                   EXIT LOOP8
   4040                END IF
   4041             END DO LOOP8n1
   4042          END DO LOOP8
   4043          LOOP9: DO II=1,6
   4044             LOOP9n1: DO JJ=5,6
   4045                IF(MIN(JSWIND(II,JJ,3),JSMASS(II,JJ,3)).LT.9999)  THEN
   4046                    ! ** METEOSAT-ODD AND METEOSAT-EVEN Visible **
   4047                   SUBSKP(005,065) = .FALSE. ! current
   4048                   SUBSKP(005,062) = .FALSE. ! historical
   4049                   EXIT LOOP9
   4050                END IF
   4051             END DO LOOP9n1
   4052          END DO LOOP9
   4053          LOOP10: DO II=1,6
   4054             LOOP10n1: DO JJ=5,6
   4055                IF(MIN(JSWIND(II,JJ,2),JSMASS(II,JJ,2)).LT.9999)  THEN
   4056                    ! ** METEOSAT-ODD AND METEOSAT-EVEN Water Vpr Imgr **
   4057                   SUBSKP(005,066) = .FALSE. ! current
   4058                   SUBSKP(005,063) = .FALSE. ! historical
   4059                   EXIT LOOP10
   4060                END IF
   4061             END DO LOOP10n1
   4062          END DO LOOP10
   4063          LOOP6: DO II=1,6
   4064             LOOP6n1: DO JJ=7,8
   4065                IF(MIN(JSWIND(II,JJ,4),JSMASS(II,JJ,4)).LT.9999)  THEN
   4066             ! ** AQUA AND TERRA (NASA/MODIS POES) Infrared (long-wave)**
   4067                   SUBSKP(005,070) = .FALSE. ! current
   4068                   EXIT LOOP6
   4069                END IF
   4070             END DO LOOP6n1
   4071          END DO LOOP6
   4072          LOOP7: DO II=1,6
   4073             LOOP7n1: DO JJ=7,8
   4074                LOOP7n2: DO KK=6,7
   4075                   IF(MIN(JSWIND(II,JJ,KK),JSMASS(II,JJ,KK)).LT.9999)THEN
   4076                    ! ** AQUA AND TERRA (NASA/MODIS POES) W. Vpr Imgr **
   4077                      SUBSKP(005,071) = .FALSE. ! current

Page 81          Source Listing                  PREP
2017-04-18 11:09                                 prepdata.f

   4078                      EXIT LOOP7
   4079                   END IF
   4080                END DO LOOP7n2
   4081             END DO LOOP7n1
   4082          END DO LOOP7
   4083 C CHECK TO SEE IF SATWND DATA SHOULD BE PROCESSED
   4084          DO II = 001,071
   4085             IF(.NOT.SUBSKP(005,II))  GO TO 234
   4086          END DO
   4087          GO TO 7001
   4088   234    CONTINUE
   4089       ELSE IF(NN.EQ.5)  THEN
   4090 C CHECK TO SEE IF ANY BUFR MESSAGES CAN BE SKIPPED IN INPUT PROFLR DUMP
   4091          IF(.NOT.PRFLER(1))  SUBSKP(002,007) = .TRUE.
   4092          IF(.NOT.PRFLER(2))  SUBSKP(002,009) = .TRUE.
   4093          IF(.NOT.PRFLER(3))  SUBSKP(002,011) = .TRUE.
   4094          IF(.NOT.PRFLER(4))  SUBSKP(002,013) = .TRUE.
   4095 C CHECK TO SEE IF WIND PROFILER DATA SHOULD BE PROCESSED
   4096          IF(SUBSKP(002,007).AND.SUBSKP(002,009).AND.SUBSKP(002,011).AND.
   4097      $      SUBSKP(002,013))  GO TO 7001
   4098       ELSE IF(NN.EQ.6)  THEN
   4099 C CHECK TO SEE IF VAD WIND DATA SHOULD BE PROCESSED
   4100          IF(.NOT.VADWIN)  GO TO 7001
   4101       ELSE IF(NN.EQ.7)  THEN
   4102 C CHECK TO SEE IF RASS TMPERATURE DATA SHOULD BE PROCESSED
   4103          IF(.NOT.RASS)  GO TO 7001
   4104       END IF
   4105       IFLAG = 0
   4106       JFLAG = 0
   4107       PRINT 5678, FILNAM(NN)
   4108  5678 FORMAT(/130('.')/15X,'Next Dataset should be ',A8/130('.')/)
   4109       GO TO 2100
   4110 C***********************************************************************
   4111 C***********************************************************************
   4112  2090 CONTINUE
   4113 C COUNT ALL SKIPPED REPORTS
   4114       KSKPUA = KSKPUA + 1
   4115 C***********************************************************************
   4116 C***********************************************************************
   4117  2100 CONTINUE
   4118       IF(NN.LT.5.OR.(NN.EQ.5.AND.IPRFPIB.GT.0))  THEN
   4119 C***********************************************************************
   4120 C CALL UNPREPBF TO UNPACK THE NEXT REPORT {NOT USED FOR WIND PROFILER
   4121 C  (EXCEPT FOR THOSE ORIGINATING FROM PILOT FORMAT BULLETINS), VAD WIND
   4122 C  OR RASS TEMPERATURE REPORTS}
   4123          CALL UNPREPBF(IFLAG,CYCLET,IOPENED,DSNAME,IDSDAT,IDSDMP_8,

Page 82          Source Listing                  PREP
2017-04-18 11:09 Entry Points                    prepdata.f



ENTRY POINTS

  Name             
                   
 prep_             


SYMBOL CROSS REFERENCE

 Name                       Object Declared Type            Bytes Dimen Elements Attributes       References                        
                                                                                                                                    
 102                        Label  4371                                                           4370                              
 105                        Label  4455                                                           4454                              
 1101                       Label  4378                                                           4377                              
 1490                       Label  4652                                                           4633,4644                         
 1929                       Label  4648                                                           4647                              
 2090                       Label  4112                                                           4431,4448,4458,4490,4507,4571,4592
                                                                                                  ,4598,4631,4668                   
 2100                       Label  4117                                                           4109,4345,4411,4423,4469,4478,4592
                                                                                                  ,4661,4668                        
 234                        Label  4088                                                           4085                              
 324                        Label  4383                                                           4382                              
 5678                       Label  4108                                                           4107                              
 5679                       Label  4729                                                           4728                              
 700                        Label  3864                                                           4727                              
 7000                       Label  4671                                                           4124,4385                         
 7001                       Label  4725                                                           3888,3933,4087,4097,4100,4103     
 7002                       Label  4674                                                           4436                              
 7003                       Label  4687                                                           4673                              
 79                         Label  4441                                                           4342                              
 8001                       Label  3862                                                           3861                              
 8002                       Label  4684                                                           4683                              
 8003                       Label  4679                                                           4678                              
 8050                       Label  4739                                                           4738                              
 871                        Label  4129                                                           4128,4390                         
 872                        Label  4132                                                           4131                              
 873                        Label  4344                                                           4284,4286,4290,4292,4296,4298,4303
                                                                                                  ,4305,4309,4311,4315,4317,4321,432
                                                                                                  3,4327,4329,4334,4336,4340,4394,43
                                                                                                  98,4402,4406,4409                 
 876                        Label  4279                                                           4272,4274,4276,4278               
 881                        Label  4699                                                           4698                              
 8872                       Label  4268                                                           4136,4139,4144,4147,4150,4153,4158
                                                                                                  ,4161,4164,4167,4172,4175,4180,418
                                                                                                  3,4191,4196,4201,4206,4211,4216,42
                                                                                                  21,4224,4229,4232,4237,4240,4248,4
                                                                                                  251,4256,4259,4262,4265           
 8873                       Label  4187                                                           4186                              
 8874                       Label  4245                                                           4244                              
 892                        Label  4418                                                           4417                              
 9105                       Label  4467                                                           4466                              
 9109                       Label  4476                                                           4475                              
 912                        Label  4429                                                           4428                              
 950                        Label  4689                                                           4688                              
 981                        Label  4710                                                           4708                              

Page 83          Source Listing                  PREP
2017-04-18 11:09 Symbol Table                    prepdata.f

 Name                       Object Declared Type            Bytes Dimen Elements Attributes       References                        
                                                                                                                                    
 995                        Label  4596                                                           4595                              
 ACFTSW                     Common 3803                                 1148                                                        
 ADP                        Common 3795                                 14100                                                       
 AIFNOW                     Scalar 3804     R(4)            4     1     9        COM                                                
 AIRLND                     Scalar 3786     L(4)            4     2     54       COM                                                
 ALAT_8                     Scalar 3791     R(8)            8           scalar   COM                                                
 ALON_8                     Scalar 3791     R(8)            8           scalar   COM                                                
 AMSTQ                      Scalar 3805     R(4)            4           scalar   COM                                                
 AWINDO                     Scalar 3803     R(4)            4     2     18       COM              4284,4286,4290,4292,4296,4298,4303
                                                                                                  ,4305,4309,4311,4315,4317,4321,432
                                                                                                  3,4327,4329,4334,4336             
 BMISS                      Scalar 3791     R(8)            8           scalar   COM              3851,3852,3854,3855,4359,4360,4362
                                                                                                  ,4363                             
 BUFRLIB_MISSING            Common 3839                                 8                                                           
 CHKREP                     Subr   4448                                                           4448                              
 CLDAMT                     Scalar 3815     R(4)            4           scalar   COM                                                
 CWINDO                     Scalar 3819     R(4)            4           scalar   COM              4278,4575,4576                    
 CYCLET                     Local  4123     R(4)            4           scalar                    4123,4389,4592,4610               
 DATA                       Common 3796                                 32                                                          
 DATA4                      Local  3847     R(4)            4           scalar                    3847,4438                         
 DIRECT                     Common 3837                                 36016                                                       
 DNAME                      Local  3783     CHAR            25    1     3                         3844,4428                         
 DROPSN                     Scalar 3788     L(4)            4           scalar   COM              4276,4505                         
 DSNAME                     Local  3782     CHAR            8           scalar                    3867,4123,4364,4370,4377          
 DWINDO                     Scalar 3817     R(4)            4           scalar   COM              4276,4510,4511                    
 EEQF                       Scalar 3802     R(4)            4           scalar   COM                                                
 FILLM                      Scalar 3787     L(4)            4           scalar   COM              4753                              
 FILLT                      Scalar 3787     L(4)            4           scalar   COM              4751                              
 FILLW                      Scalar 3787     L(4)            4           scalar   COM              4752                              
 FILLZ                      Scalar 3786     L(4)            4           scalar   COM              4736,4750                         
 FILNAM                     Local  3782     CHAR            8     1     7                         3842,4107                         
 FLACMS                     Scalar 3805     R(4)            4     1     9        COM                                                
 FLDMAF                     Scalar 3817     R(4)            4           scalar   COM                                                
 FLDMFR                     Scalar 3817     R(4)            4           scalar   COM                                                
 FLDMGS                     Scalar 3817     R(4)            4           scalar   COM                                                
 FLONVT                     Scalar 3822     R(4)            4           scalar   COM                                                
 FLRECO                     Scalar 3788     L(4)            4           scalar   COM              3881,4730                         
 FMESHL                     Scalar 3822     R(4)            4           scalar   COM                                                
 FPOLEI                     Scalar 3822     R(4)            4           scalar   COM                                                
 FPOLEJ                     Scalar 3822     R(4)            4           scalar   COM                                                
 FWINDO                     Scalar 3823     R(4)            4     1     12       COM                                                
 GDNH                       Scalar 3821     R(4)            4     2     32942    COM              4642                              
 GDSH                       Scalar 3821     R(4)            4     2     5365     COM              4640                              
 GDUS                       Scalar 3821     R(4)            4     2     32942    COM                                                
 GETC06                     Subr   4592                                                           4592                              
 GETGPSIPW                  Subr   4852                                                           4852                              
 GETSCATT                   Subr   4810                                                           4810,4820,4830,4840               
 GETSMI                     Subr   4798                                                           4798                              
 GETUPA                     Subr   4668                                                           4668                              
 GOESCT                     Scalar 3787     L(4)            4     1     2        COM              4775,4776                         
 GOESDG                     Subr   4776                                                           4776                              
 GOESND                     Scalar 3786     L(4)            4     1     2        COM              4775                              
 GOESPW                     Scalar 3787     L(4)            4     1     2        COM              4775,4776                         
 GOESRD                     Scalar 3788     L(4)            4     1     2        COM              4775,4776                         
 GOSWCH                     Common 3809                                 100                                                         

Page 84          Source Listing                  PREP
2017-04-18 11:09 Symbol Table                    prepdata.f

 Name                       Object Declared Type            Bytes Dimen Elements Attributes       References                        
                                                                                                                                    
 GPSWCH                     Common 3812                                 68                                                          
 GRAD                       Scalar 3814     R(4)            4     1     18       COM                                                
 GWINDO                     Scalar 3812     R(4)            4           scalar   COM                                                
 HDR                        Scalar 3797     R(4)            4     1     14       COM              4613,4619,4621,4628,4658          
 I                          Local  4136     I(4)            4           scalar                    4136,4137,4139,4140,4144,4145,4147
                                                                                                  ,4148,4150,4151,4153,4154,4158,415
                                                                                                  9,4161,4162,4164,4165,4167,4168,41
                                                                                                  72,4173,4175,4176,4180,4181,4183,4
                                                                                                  184,4191,4192,4196,4197,4201,4202,
                                                                                                  4206,4207,4211,4212,4216,4217,4221
                                                                                                  ,4222,4224,4225,4229,4230,4232,423
                                                                                                  3,4237,4238,4240,4241,4248,4249,42
                                                                                                  51,4252,4256,4257,4259,4260,4262,4
                                                                                                  263,4265,4266,4698,4708,4709      
 IACFTH                     Scalar 3804     I(4)            4     1     9        COM                                                
 IACFTL                     Scalar 3804     I(4)            4     1     9        COM                                                
 IAWNDO                     Scalar 3832     I(4)            4     1     2        COM                                                
 IB                         Local  4792     I(4)            4           scalar                    4792,4793                         
 ICAT                       Scalar 3792     I(4)            4     1     600      COM              3880,4786                         
 ICODE                      Scalar 3818     I(4)            4           scalar   COM              4691                              
 IDAT10                     Scalar 3796     I(4)            4           scalar   COM              4381                              
 IDATA                      Scalar 3789     I(4)            4     1     3500     COM              4449,4454,4459,4466,4470,4475,4479
                                                                                                  ,4480,4496,4515,4523,4532,4540,454
                                                                                                  8,4556,4564,4591,4592,4594,4595,46
                                                                                                  13,4617,4633,4647,4658,4660,4661  
 IDATE                      Scalar 3796     I(4)            4     1     4        COM              4364,4389                         
 IDSDAT                     Local  3868     I(4)            4           scalar                    3868,4123,4365,4373,4374,4375,4376
                                                                                                  ,4381                             
 IDSDMP_8                   Local  3790     I(8)            8           scalar                    3869,4123,4365,4377               
 IER                        Local  4628     I(4)            4           scalar                    4628,4629                         
 IEWNDO                     Scalar 3830     I(4)            4     1     2        COM                                                
 IFLAG                      Local  4105     I(4)            4           scalar                    4105,4123,4125                    
 IFLUA                      Scalar 3820     I(4)            4           scalar   COM              4605,4650,4651                    
 IGCHN                      Scalar 3814     I(4)            4     1     18       COM                                                
 II                         Local  3937     I(4)            4           scalar                    3937,3939,3948,3950,3959,3962,3972
                                                                                                  ,3975,3983,3985,3994,3995,4000,400
                                                                                                  1,4006,4007,4012,4013,4019,4020,40
                                                                                                  26,4027,4033,4035,4043,4045,4053,4
                                                                                                  055,4063,4065,4072,4075,4084,4085 
 ILAND                      Local  4640     I(4)            4           scalar                    4640,4642,4644                    
 IMISS                      Local  3841     I(4)            4           scalar                    3841,3850,3877,3880,4783,4786,4797
                                                                                                  ,4809,4819,4829,4839,4851         
 INSTR                      Local  4514     I(4)            4           scalar                    4514,4519,4528,4536,4544,4552,4560
                                                                                                  ,4573,4581,4658                   
 IOPENED                    Local  3866     I(4)            4           scalar                    3866,4123,4421                    
 IPMSL                      Scalar 3794     I(4)            4     1     3        COM              3850                              
 IPRFPIB                    Local  3865     I(4)            4           scalar                    3865,4118,4125,4341,4422          
 IPRINT                     Scalar 3795     I(4)            4           scalar   COM              4647                              
 IQMPW                      Scalar 3834     I(4)            4           scalar   COM                                                
 IQWNDO                     Scalar 3830     I(4)            4     1     2        COM                                                
 IRET                       Local  4350     I(4)            4           scalar                    4350,4365,4367,4413,4425,4433     
 ISATOB                     Scalar 3795     I(4)            4           scalar   COM              4744,4760,4774,4777               
 ISEL                       Func   4658     I(4)            4           scalar                    4658                              
 ISQNUM_UPA                 Scalar 3799     I(4)            4           scalar   COM                                                
 IUNIT                      Scalar 3798     I(4)            4     1     28       COM              3883,4678                         

Page 85          Source Listing                  PREP
2017-04-18 11:09 Symbol Table                    prepdata.f

 Name                       Object Declared Type            Bytes Dimen Elements Attributes       References                        
                                                                                                                                    
 IVADFL                     Scalar 3817     I(4)            4           scalar   COM                                                
 IVADSP                     Scalar 3817     I(4)            4           scalar   COM                                                
 IWWNDO                     Scalar 3830     I(4)            4     1     2        COM                                                
 J                          Local  4708     I(4)            4           scalar                    4708,4709                         
 JAMASS                     Scalar 3803     I(4)            4     2     54       COM              3887,3888,3892,3893,3898,3899,3902
                                                                                                  ,3903,3906,3907,3913,3914,3917,391
                                                                                                  8,3921,3922,3925,3926             
 JAWIND                     Scalar 3803     I(4)            4     2     54       COM              3886,3887,3891,3892,3897,3898,3901
                                                                                                  ,3902,3905,3906,3912,3913,3916,391
                                                                                                  7,3920,3921,3924,3925             
 JFLAG                      Local  4106     I(4)            4           scalar                    4106,4369,4442,4677,4682          
 JJ                         Local  3938     I(4)            4           scalar                    3938,3939,3949,3950,3960,3962,3973
                                                                                                  ,3975,3984,3985,4034,4035,4044,404
                                                                                                  5,4054,4055,4064,4065,4073,4075   
 JPASCD                     Scalar 3832     I(4)            4     1     6        COM              4835,4836                         
 JPERSD                     Scalar 3830     I(4)            4     1     6        COM              4805,4806                         
 JPGPSD                     Scalar 3812     I(4)            4     1     6        COM              4847,4848                         
 JPQKSD                     Scalar 3830     I(4)            4     1     6        COM              4815,4816                         
 JPSSMI                     Scalar 3828     I(4)            4     2     24       COM              4793                              
 JPWDSD                     Scalar 3831     I(4)            4     1     6        COM              4825,4826                         
 JSMASS                     Scalar 3801     I(4)            4     3     480      COM              3939,3950,3962,3975,3985,3995,4001
                                                                                                  ,4007,4013,4020,4027,4035,4045,405
                                                                                                  5,4065,4075                       
 JSURFM                     Scalar 3823     I(4)            4     1     12       COM                                                
 JSURFW                     Scalar 3823     I(4)            4     1     12       COM                                                
 JSWIND                     Scalar 3801     I(4)            4     3     480      COM              3939,3950,3962,3975,3985,3995,4001
                                                                                                  ,4007,4013,4020,4027,4035,4045,405
                                                                                                  5,4065,4075                       
 KBDYGI                     Scalar 3810     I(4)            4           scalar   COM                                                
 KBDYGP                     Scalar 3812     I(4)            4           scalar   COM                                                
 KBDYMI                     Scalar 3829     I(4)            4           scalar   COM                                                
 KBDYSC                     Scalar 3831     I(4)            4     1     4        COM                                                
 KBDYSF                     Scalar 3824     I(4)            4           scalar   COM                                                
 KBDYTV                     Scalar 3807     I(4)            4     1     2        COM                                                
 KBDYUA                     Scalar 3824     I(4)            4           scalar   COM              4448                              
 KEPAC                      Scalar 3804     I(4)            4     2     54       COM              4698,4708,4709                    
 KEPSW                      Scalar 3801     I(4)            4     3     480      COM                                                
 KIPTTV                     Scalar 3807     I(4)            4     1     2        COM                                                
 KJFLAG                     Scalar 3808     I(4)            4     1     2        COM                                                
 KK                         Local  3961     I(4)            4           scalar                    3961,3962,3974,3975,4074,4075     
 KLNDGI                     Scalar 3810     I(4)            4     1     3        COM                                                
 KLNDTV                     Scalar 3808     I(4)            4     1     2        COM                                                
 KMISGP                     Scalar 3813     I(4)            4           scalar   COM                                                
 KMSGGI                     Scalar 3810     I(4)            4           scalar   COM                                                
 KMSGGP                     Scalar 3812     I(4)            4           scalar   COM                                                
 KMSGMI                     Scalar 3829     I(4)            4           scalar   COM                                                
 KMSGSC                     Scalar 3831     I(4)            4     1     4        COM                                                
 KMSGSF                     Scalar 3824     I(4)            4           scalar   COM                                                
 KMSGTV                     Scalar 3807     I(4)            4     1     2        COM                                                
 KMSGUA                     Scalar 3824     I(4)            4           scalar   COM              4448                              
 KNDCDE                     Scalar 3826     I(4)            4     1     3        COM              4430                              
 KNDCGI                     Scalar 3810     I(4)            4           scalar   COM                                                
 KNOATS                     Scalar 3825     I(4)            4           scalar   COM              4457                              
 KNOCTP                     Scalar 3811     I(4)            4           scalar   COM                                                
 KNOPGI                     Scalar 3810     I(4)            4           scalar   COM                                                

Page 86          Source Listing                  PREP
2017-04-18 11:09 Symbol Table                    prepdata.f

 Name                       Object Declared Type            Bytes Dimen Elements Attributes       References                        
                                                                                                                                    
 KNOPTV                     Scalar 3807     I(4)            4     1     2        COM                                                
 KNTALL                     Local  3872     I(4)            4           scalar                    3872,4443,4688                    
 KNTGIC                     Scalar 3811     I(4)            4           scalar   COM                                                
 KNTGIP                     Scalar 3809     I(4)            4           scalar   COM                                                
 KNTGIS                     Scalar 3809     I(4)            4           scalar   COM                                                
 KNTGIT                     Scalar 3809     I(4)            4           scalar   COM                                                
 KNTGPS                     Scalar 3812     I(4)            4           scalar   COM                                                
 KNTMSO                     Scalar 3826     I(4)            4           scalar   COM                                                
 KNTSCT                     Scalar 3831     I(4)            4     1     4        COM                                                
 KNTSFC                     Scalar 3825     I(4)            4           scalar   COM                                                
 KNTSHP                     Scalar 3825     I(4)            4           scalar   COM                                                
 KNTSLP                     Scalar 3825     I(4)            4           scalar   COM                                                
 KNTSMI                     Scalar 3828     I(4)            4     1     4        COM                                                
 KNTSPL                     Scalar 3826     I(4)            4           scalar   COM                                                
 KNTTOV                     Scalar 3806     I(4)            4     1     2        COM                                                
 KNTUUU                     Scalar 3825     I(4)            4     1     10       COM              4692,4693,4696,4706               
 KOUNT                      Scalar 3796     I(4)            4           scalar   COM              3874,4691,4692                    
 KREDTV                     Scalar 3808     I(4)            4     1     2        COM                                                
 KSEAGI                     Scalar 3810     I(4)            4     1     3        COM                                                
 KSEATV                     Scalar 3808     I(4)            4     1     2        COM                                                
 KSKACF                     Scalar 3826     I(4)            4           scalar   COM                                                
 KSKAHM                     Scalar 3827     I(4)            4     1     9        COM                                                
 KSKALM                     Scalar 3827     I(4)            4     1     9        COM                                                
 KSKCLS                     Scalar 3826     I(4)            4           scalar   COM              4570                              
 KSKDRP                     Scalar 3827     I(4)            4           scalar   COM              4506                              
 KSKNOW                     Scalar 3827     I(4)            4     1     9        COM                                                
 KSKNSW                     Scalar 3825     I(4)            4           scalar   COM                                                
 KSKOMR                     Scalar 3826     I(4)            4     1     2        COM              4650                              
 KSKPGI                     Scalar 3810     I(4)            4           scalar   COM                                                
 KSKPGP                     Scalar 3812     I(4)            4           scalar   COM                                                
 KSKPMI                     Scalar 3829     I(4)            4           scalar   COM                                                
 KSKPSC                     Scalar 3831     I(4)            4     1     4        COM                                                
 KSKPSF                     Scalar 3824     I(4)            4           scalar   COM                                                
 KSKPTV                     Scalar 3807     I(4)            4     1     2        COM                                                
 KSKPUA                     Scalar 3824     I(4)            4           scalar   COM              4114                              
 KSKREC                     Scalar 3825     I(4)            4           scalar   COM              4489                              
 KSKSWD                     Scalar 3802     I(4)            4     1     10       COM                                                
 KSKSWN                     Scalar 3826     I(4)            4           scalar   COM                                                
 KSKTHN                     Scalar 3826     I(4)            4           scalar   COM                                                
 KT45GP                     Scalar 3813     I(4)            4           scalar   COM                                                
 KTGNSS                     Scalar 3813     I(4)            4           scalar   COM                                                
 KTIMGI                     Scalar 3810     I(4)            4     1     3        COM                                                
 KTIMGP                     Scalar 3812     I(4)            4           scalar   COM                                                
 KTIMM                      Scalar 3828     I(4)            4     1     4        COM                                                
 KTIMSC                     Scalar 3831     I(4)            4     1     4        COM                                                
 KTIMSF                     Scalar 3825     I(4)            4           scalar   COM                                                
 KTIMTV                     Scalar 3807     I(4)            4     1     2        COM                                                
 KTIMUA                     Scalar 3824     I(4)            4           scalar   COM              4630                              
 LEVPM                      Scalar 3799     I(4)            4           scalar   COM                                                
 LEVQQ                      Scalar 3799     I(4)            4           scalar   COM                                                
 LEVST                      Scalar 3799     I(4)            4           scalar   COM                                                
 LFMAXI                     Scalar 3822     I(4)            4           scalar   COM                                                
 LFMAXJ                     Scalar 3822     I(4)            4           scalar   COM                                                
 LFMSFC                     Common 3822                                 224                                                         
 LNDCHK                     Subr   4640                                                           4640,4642                         

Page 87          Source Listing                  PREP
2017-04-18 11:09 Symbol Table                    prepdata.f

 Name                       Object Declared Type            Bytes Dimen Elements Attributes       References                        
                                                                                                                                    
 LNDSEA                     Common 3821                                 284996                                                      
 LOOP1                      Label  3937                                 scalar                    3944,3947                         
 LOOP10                     Label  4053                                 scalar                    4059,4062                         
 LOOP10N1                   Label  4054                                 scalar                    4061                              
 LOOP1N1                    Label  3938                                 scalar                    3946                              
 LOOP2                      Label  3948                                 scalar                    3955,3958                         
 LOOP2N1                    Label  3949                                 scalar                    3957                              
 LOOP3                      Label  3959                                 scalar                    3967,3971                         
 LOOP3N1                    Label  3960                                 scalar                    3970                              
 LOOP3N2                    Label  3961                                 scalar                    3969                              
 LOOP4                      Label  3972                                 scalar                    3978,3982                         
 LOOP4N1                    Label  3973                                 scalar                    3981                              
 LOOP4N2                    Label  3974                                 scalar                    3980                              
 LOOP5                      Label  3983                                 scalar                    3990,3993                         
 LOOP5N1                    Label  3984                                 scalar                    3992                              
 LOOP6                      Label  4063                                 scalar                    4068,4071                         
 LOOP6N1                    Label  4064                                 scalar                    4070                              
 LOOP7                      Label  4072                                 scalar                    4078,4082                         
 LOOP7N1                    Label  4073                                 scalar                    4081                              
 LOOP7N2                    Label  4074                                 scalar                    4080                              
 LOOP8                      Label  4033                                 scalar                    4039,4042                         
 LOOP8N1                    Label  4034                                 scalar                    4041                              
 LOOP9                      Label  4043                                 scalar                    4049,4052                         
 LOOP9N1                    Label  4044                                 scalar                    4051                              
 LSMASS                     Scalar 3819     I(4)            4           scalar   COM              4278,4569                         
 LSWIND                     Scalar 3819     I(4)            4           scalar   COM              4278,4569                         
 MARLND                     Scalar 3787     L(4)            4           scalar   COM              4633                              
 MAX                        Func   4660                                 scalar                    4660                              
 MAXOBS                     Param  3775     I(4)            4           scalar                    3789,3795                         
 MDATE                      Local  3789     I(4)            4     1     4                         4373,4374,4375,4376,4377          
 MIN                        Func   3886                                 scalar                    3886,3891,3897,3901,3905,3912,3916
                                                                                                  ,3920,3924,3939,3950,3962,3975,398
                                                                                                  5,3995,4001,4007,4013,4020,4027,40
                                                                                                  35,4045,4055,4065,4075,4278,4793,4
                                                                                                  805,4815,4825,4835,4847           
 MISWCH                     Common 3828                                 264                                                         
 MOBS                       Scalar 3793     I(4)            4     3     10800    COM              3877,4783,4797,4809,4819,4829,4839
                                                                                                  ,4851                             
 MOD                        Func   4374                                 scalar                    4374,4375,4376                    
 MODPRT                     Scalar 3820     I(4)            4           scalar   COM                                                
 MP_PROCESS                 Scalar 3796     I(4)            4           scalar   COM                                                
 MXBLVL                     Param  3781     I(4)            4           scalar                    3837                              
 MXLVL                      Param  3774     I(4)            4           scalar                    3792,3793                         
 MXTYPV                     Param  3772     I(4)            4           scalar                    3793,3794                         
 MXWRDH                     Param  3771     I(4)            4           scalar                    3797                              
 MXWRDL                     Param  3773     I(4)            4           scalar                    3793                              
 NAME1                      Local  3784     CHAR            47          scalar                    4135,4136,4138,4139,4143,4144,4146
                                                                                                  ,4147,4149,4150,4152,4153,4157,415
                                                                                                  8,4160,4161,4163,4164,4166,4167,41
                                                                                                  71,4172,4174,4175,4179,4180,4182,4
                                                                                                  183,4190,4191,4195,4196,4200,4201,
                                                                                                  4205,4206,4210,4211,4215,4216,4220
                                                                                                  ,4221,4223,4224,4228,4229,4231,423
                                                                                                  2,4236,4237,4239,4240,4247,4248,42
                                                                                                  50,4251,4255,4256,4258,4259,4261,4

Page 88          Source Listing                  PREP
2017-04-18 11:09 Symbol Table                    prepdata.f

 Name                       Object Declared Type            Bytes Dimen Elements Attributes       References                        
                                                                                                                                    
                                                                                                  262,4264,4265                     
 NAME2                      Local  3785     CHAR            56          scalar                    4271,4272,4273,4274,4275,4276,4277
                                                                                                  ,4278,4283,4284,4285,4286,4289,429
                                                                                                  0,4291,4292,4295,4296,4297,4298,43
                                                                                                  02,4303,4304,4305,4308,4309,4310,4
                                                                                                  311,4314,4315,4316,4317,4320,4321,
                                                                                                  4322,4323,4326,4327,4328,4329,4333
                                                                                                  ,4334,4335,4336,4339,4340,4393,439
                                                                                                  4,4397,4398,4401,4402,4405,4406,44
                                                                                                  08,4409                           
 NFILE                      Scalar 3798     I(4)            4           scalar   COM              3883,4364,4370,4417,4672          
 NINT                       Func   4639                                 scalar                    4639                              
 NN                         Local  3863     I(4)            4           scalar                    3863,3883,3884,3889,3934,4089,4098
                                                                                                  ,4101,4107,4118,4130,4270,4281,433
                                                                                                  2,4338,4391,4404,4407,4428,4430,45
                                                                                                  92,4691,4692,4693,4696,4706,4726,4
                                                                                                  727                               
 NOBS3                      Scalar 3837     I(4)            4     1     7        COM              3853,4361                         
 NPKRPT                     Scalar 3823     I(4)            4     1     12       COM                                                
 NPZ                        Scalar 3819     I(4)            4           scalar   COM                                                
 NUMOBS2                    Param  3778     I(4)            4           scalar                    3837                              
 OBS2                       Scalar 3837     R(4)            4     1     43       COM              3851,4359                         
 OBS3                       Scalar 3837     R(4)            4     3     8925     COM              3852,4360                         
 OBS8_8                     Scalar 3791     R(8)            8     1     2        COM              3854,4362,4365                    
 OZONE                      Scalar 3814     R(4)            4           scalar   COM                                                
 PARM3                      Common 3816                                 56                                                          
 PARM4                      Common 3818                                 4                                                           
 PARM5                      Common 3819                                 32                                                          
 PARM6                      Common 3820                                 32                                                          
 PCAT                       Scalar 3805     R(4)            4           scalar   COM                                                
 PFRALT                     Scalar 3823     R(4)            4           scalar   COM                                                
 PFSWCH                     Common 3835                                 36                                                          
 PHIACF                     Scalar 3804     R(4)            4     1     7        COM                                                
 PHISWN                     Scalar 3800     R(4)            4     1     7        COM                                                
 PMAND                      Scalar 3795     R(4)            4     1     23       COM                                                
 POAF                       Scalar 3804     R(4)            4           scalar   COM                                                
 PREP                       Subr   3770                                                                                             
 PRFLER                     Scalar 3786     L(4)            4     1     4        COM              4091,4092,4093,4094               
 PROFILERINADPUPA           Scalar 3788     L(4)            4           scalar   COM              3882,4731                         
 PSTATS                     Subr   4736                                                           4736                              
 PWINDO                     Scalar 3835     R(4)            4     1     4        COM              4340,4394,4398,4402,4521,4522,4530
                                                                                                  ,4531,4538,4539,4546,4547         
 PWSWCH                     Common 3834                                 24                                                          
 PWT                        Scalar 3834     R(4)            4     1     5        COM              3848                              
 QIFN                       Scalar 3802     R(4)            4           scalar   COM                                                
 QIFY                       Scalar 3802     R(4)            4           scalar   COM                                                
 RADANC                     Common 3814                                 320                                                         
 RASS                       Scalar 3788     L(4)            4           scalar   COM              4103                              
 RASSSW                     Common 3836                                 8                                                           
 RDATA                      Scalar 3795     R(4)            4     1     3500     COM              4364,4438,4454,4466,4475,4595,4639
                                                                                                  ,4640,4642,4647                   
 RDATA2                     Scalar 3837     R(4)            4     1     25       COM              3855,4363,4364                    
 RECCON                     Scalar 3786     L(4)            4           scalar   COM              4274,4488                         
 RECSLM                     Scalar 3816     R(4)            4           scalar   COM                                                
 RFFL                       Scalar 3802     R(4)            4           scalar   COM                                                

Page 89          Source Listing                  PREP
2017-04-18 11:09 Symbol Table                    prepdata.f

 Name                       Object Declared Type            Bytes Dimen Elements Attributes       References                        
                                                                                                                                    
 RIALR                      Scalar 3805     R(4)            4           scalar   COM                                                
 ROLF                       Scalar 3805     R(4)            4           scalar   COM                                                
 RPTHDR                     Common 3797                                 88                                                          
 RPTLBL                     Subr   4610                                                           4610                              
 RTRAD                      Scalar 3814     R(4)            4     1     35       COM                                                
 RWINDO                     Scalar 3816     R(4)            4           scalar   COM              4274,4493,4494                    
 SATBFR                     Subr   4745                                                           4745                              
 SATEDS                     Subr   4761                                                           4761                              
 SATSW3                     Common 3800                                 11604                                                       
 SAZANG                     Scalar 3814     R(4)            4           scalar   COM                                                
 SCTWCH                     Common 3830                                 208                                                         
 SFCDTA                     Subr   4787                                                           4787                              
 SKGNSS                     Scalar 3813     R(4)            4           scalar   COM                                                
 SKGP45                     Scalar 3813     R(4)            4           scalar   COM                                                
 SKINT                      Scalar 3815     R(4)            4           scalar   COM                                                
 SKPCNT                     Common 3824                                 252                                                         
 SKPSUB                     Common 3833                                 205824                                                      
 SOZANG                     Scalar 3814     R(4)            4           scalar   COM                                                
 SPCIAL                     Scalar 3787     L(4)            4           scalar   COM              4749                              
 SRAD                       Scalar 3828     R(4)            4     1     7        COM                                                
 STNID                      Scalar 3782     CHAR            8           scalar   COM              4364,4454,4466,4470,4475,4564,4595
                                                                                                  ,4647                             
 STNPRT                     Scalar 3782     CHAR            8     1     3        COM                                                
 STRCTY                     Common 3792                                 2400                                                        
 STRMOB                     Common 3793                                 43200                                                       
 STRMSL                     Common 3794                                 12                                                          
 SUBSET_D                   Scalar 3782     CHAR            8           scalar   COM              3870,4365,4618                    
 SUBSKP                     Scalar 3788     L(4)            4     2     51456    COM              3894,3895,3900,3904,3908,3909,3910
                                                                                                  ,3915,3919,3923,3927,3929,3930,393
                                                                                                  1,3932,3935,3941,3942,3943,3952,39
                                                                                                  53,3954,3964,3965,3966,3977,3987,3
                                                                                                  988,3989,3996,4002,4008,4014,4015,
                                                                                                  4021,4022,4028,4029,4037,4038,4047
                                                                                                  ,4048,4057,4058,4067,4077,4085,409
                                                                                                  1,4092,4093,4094,4096,4097,4134,41
                                                                                                  42,4156,4170,4178,4189,4194,4199,4
                                                                                                  204,4209,4214,4219,4227,4235,4243,
                                                                                                  4246,4254,4282,4288,4294,4300,4301
                                                                                                  ,4307,4313,4319,4325,4365,4392,439
                                                                                                  6,4400                            
 SWINDO_E                   Scalar 3800     R(4)            4     3     480      COM              4136,4139,4144,4147,4150,4153,4158
                                                                                                  ,4161,4164,4167,4172,4175,4180,418
                                                                                                  3,4191,4196,4201,4206,4211,4216,42
                                                                                                  21,4224,4229,4232,4237,4240,4248,4
                                                                                                  251,4256,4259,4262,4265           
 SWINDO_L                   Scalar 3801     R(4)            4     3     480      COM              4137,4140,4145,4148,4151,4154,4159
                                                                                                  ,4162,4165,4168,4173,4176,4181,418
                                                                                                  4,4192,4197,4202,4207,4212,4217,42
                                                                                                  22,4225,4230,4233,4238,4241,4249,4
                                                                                                  252,4257,4260,4263,4266           
 SWNLND                     Scalar 3786     L(4)            4     3     480      COM                                                
 SWNTBL                     Subr   4695                                                           4695                              
 TDLIM                      Scalar 3799     R(4)            4           scalar   COM                                                
 TDMAX                      Scalar 3799     R(4)            4           scalar   COM                                                
 TIMCHK                     Subr   4628                                                           4628                              

Page 90          Source Listing                  PREP
2017-04-18 11:09 Symbol Table                    prepdata.f

 Name                       Object Declared Type            Bytes Dimen Elements Attributes       References                        
                                                                                                                                    
 TIMWIN_E                   Local  4493     R(4)            4           scalar                    4493,4510,4521,4530,4538,4546,4554
                                                                                                  ,4562,4575,4583,4628              
 TIMWIN_L                   Local  4494     R(4)            4           scalar                    4494,4511,4522,4531,4539,4547,4555
                                                                                                  ,4563,4576,4584,4628              
 TOVBFR                     Scalar 3787     L(4)            4     1     2        COM              4745                              
 TOVEDS                     Scalar 3786     L(4)            4     1     2        COM              4761                              
 TOVRAD                     Scalar 3815     R(4)            4           scalar   COM                                                
 TOVRTV                     Scalar 3815     R(4)            4           scalar   COM                                                
 TR80KM                     Scalar 3806     R(4)            4           scalar   COM                                                
 TRBX                       Scalar 3804     R(4)            4     1     5        COM                                                
 TVSWCH                     Common 3806                                 108                                                         
 TWINDO                     Scalar 3836     R(4)            4           scalar   COM              4409,4562,4563                    
 UNITNO                     Common 3798                                 116                                                         
 UNPREPBF                   Subr   4123                                                           4123                              
 UPALIM                     Common 3799                                 28                                                          
 UWINDO                     Scalar 3816     R(4)            4           scalar   COM              4272,4583,4584                    
 VADWIN                     Scalar 3787     L(4)            4           scalar   COM              4100                              
 VWINDO                     Scalar 3816     R(4)            4           scalar   COM              4406,4554,4555                    
 W3UNPKB7                   Subr   4364                                                           4364                              
 WRMISS                     Scalar 3796     R(4)            4           scalar   COM                                                
 XMISS                      Local  3841     R(4)            4           scalar                    3841,3848                         
 XWINDO                     Scalar 3828     R(4)            4     2     24       COM                                                

Page 91          Source Listing                  PREP
2017-04-18 11:09                                 prepdata.f

   4124      $    *7000)
   4125          IF(IFLAG.EQ.1.OR.IPRFPIB.EQ.2)  THEN
   4126 C.......................................................................
   4127 C IFLAG = 1 RETURNS DATA SET INFO (ONLY) AFTER FIRST CALL
   4128             PRINT 871
   4129   871 FORMAT(/42X,'+++  TIME WINDOW  (HRS X 100) ON REPORTS  +++'/)
   4130             IF(NN.EQ.4)  THEN
   4131                PRINT 872
   4132   872          FORMAT(25X,'---> HIGH-DENSITY U.S. GEOSTATIONARY ',
   4133      $          'REPORTS:')
   4134                IF(.NOT.SUBSKP(005,010))  THEN
   4135                NAME1 = 'NESDIS: GOES-ODD IMAGER C D-IR-LW (6 LAT BANDS)'
   4136                   PRINT 8872, NAME1,(SWINDO_e(I,1,4),I=1,6),
   4137      $             (SWINDO_l(I,1,4),I=1,6)
   4138                NAME1 = 'NESDIS: GOES-EVN IMGR C.DFT-IR-LW (6 LAT BANDS)'
   4139                   PRINT 8872, NAME1,(SWINDO_e(I,2,4),I=1,6),
   4140      $             (SWINDO_l(I,2,4),I=1,6)
   4141                END IF
   4142                IF(.NOT.SUBSKP(005,011))  THEN
   4143                NAME1 = 'NESDIS: GOES-ODD IMAGER WV-CL.TOP (6 LAT BANDS)'
   4144                   PRINT 8872, NAME1,(SWINDO_e(I,1,6),I=1,6),
   4145      $             (SWINDO_l(I,1,6),I=1,6)
   4146                NAME1 = 'NESDIS: GOES-EVN IMAGER WV-CL.TOP (6 LAT BANDS)'
   4147                   PRINT 8872, NAME1,(SWINDO_e(I,2,6),I=1,6),
   4148      $             (SWINDO_l(I,2,6),I=1,6)
   4149                NAME1 = 'NESDIS: GOES-ODD IMAGER WV-D. LYR (6 LAT BANDS)'
   4150                   PRINT 8872, NAME1,(SWINDO_e(I,1,7),I=1,6),
   4151      $             (SWINDO_l(I,1,7),I=1,6)
   4152                NAME1 = 'NESDIS: GOES-EVN IMAGER WV-D. LYR (6 LAT BANDS)'
   4153                   PRINT 8872, NAME1,(SWINDO_e(I,2,7),I=1,6),
   4154      $             (SWINDO_l(I,2,7),I=1,6)
   4155                END IF
   4156                IF(.NOT.SUBSKP(005,014))  THEN
   4157                NAME1 = 'NESDIS: GOES-ODD SOUNDR WV-CL.TOP (6 LAT BANDS)'
   4158                   PRINT 8872, NAME1,(SWINDO_e(I,1,8),I=1,6),
   4159      $             (SWINDO_l(I,1,8),I=1,6)
   4160                NAME1 = 'NESDIS: GOES-EVN SOUNDR WV-CL.TOP (6 LAT BANDS)'
   4161                   PRINT 8872, NAME1,(SWINDO_e(I,2,8),I=1,6),
   4162      $             (SWINDO_l(I,2,8),I=1,6)
   4163                NAME1 = 'NESDIS: GOES-ODD SOUNDR WV-D. LYR (6 LAT BANDS)'
   4164                   PRINT 8872, NAME1,(SWINDO_e(I,1,9),I=1,6),
   4165      $             (SWINDO_l(I,1,9),I=1,6)
   4166                NAME1 = 'NESDIS: GOES-EVN SOUNDR WV-D. LYR (6 LAT BANDS)'
   4167                   PRINT 8872, NAME1,(SWINDO_e(I,2,9),I=1,6),
   4168      $             (SWINDO_l(I,2,9),I=1,6)
   4169                END IF
   4170                IF(.NOT.SUBSKP(005,012))  THEN
   4171                NAME1 = 'NESDIS: GOES-ODD IMAGER C.DFT-VIZ (6 LAT BANDS)'
   4172                   PRINT 8872, NAME1,(SWINDO_e(I,1,5),I=1,6),
   4173      $             (SWINDO_l(I,1,5),I=1,6)
   4174                NAME1 = 'NESDIS: GOES-EVN IMAGER C.DFT-VIZ (6 LAT BANDS)'
   4175                   PRINT 8872, NAME1,(SWINDO_e(I,2,5),I=1,6),
   4176      $             (SWINDO_l(I,2,5),I=1,6)
   4177                END IF
   4178                IF(.NOT.SUBSKP(005,013))  THEN
   4179                NAME1 = 'NESDIS: GOES-ODD PICTURE TRIPLET  (6 LAT BANDS)'
   4180                   PRINT 8872, NAME1,(SWINDO_e(I,1,10),I=1,6),

Page 92          Source Listing                  PREP
2017-04-18 11:09                                 prepdata.f

   4181      $             (SWINDO_l(I,1,10),I=1,6)
   4182                NAME1 = 'NESDIS: GOES-EVN PICTURE TRIPLET  (6 LAT BANDS)'
   4183                   PRINT 8872, NAME1,(SWINDO_e(I,2,10),I=1,6),
   4184      $             (SWINDO_l(I,2,10),I=1,6)
   4185                END IF
   4186                PRINT 8873
   4187  8873          FORMAT(25X,'---> CONVENTIONAL FOREIGN GEOSTATIONARY ',
   4188      $          'REPORTS:')
   4189                IF(.NOT.SUBSKP(005,021))  THEN
   4190                NAME1 = 'INDIA: INSAT/KALPANA CL.DFT-IR-LW (6 LAT BANDS)'
   4191                   PRINT 8872, NAME1,(SWINDO_e(I,3,1),I=1,6),
   4192      $             (SWINDO_l(I,3,1),I=1,6)
   4193                END IF
   4194                IF(.NOT.SUBSKP(005,022))  THEN
   4195                NAME1 = 'INDIA: INSAT/KALPANA CLD DRFT-VIS (6 LAT BANDS)'
   4196                   PRINT 8872, NAME1,(SWINDO_e(I,3,3),I=1,6),
   4197      $             (SWINDO_l(I,3,3),I=1,6)
   4198                END IF
   4199                IF(.NOT.SUBSKP(005,023))  THEN
   4200                NAME1 = 'INDIA: INSAT/KALPANA CLD DRFT -WV (6 LAT BANDS)'
   4201                   PRINT 8872, NAME1,(SWINDO_e(I,3,2),I=1,6),
   4202      $             (SWINDO_l(I,3,2),I=1,6)
   4203                END IF
   4204                IF(.NOT.SUBSKP(005,041).OR..NOT.SUBSKP(005,044))  THEN
   4205                NAME1 = 'JAPAN: GMS/MTSAT CL. DRIFT- IR-LW (6 LAT BANDS)'
   4206                   PRINT 8872, NAME1,(SWINDO_e(I,4,1),I=1,6),
   4207      $             (SWINDO_l(I,4,1),I=1,6)
   4208                END IF
   4209                IF(.NOT.SUBSKP(005,042).OR..NOT.SUBSKP(005,045))  THEN
   4210                NAME1 = 'JAPAN: GMS/MTSAT CLOUD DRIFT -VIS (6 LAT BANDS)'
   4211                   PRINT 8872, NAME1,(SWINDO_e(I,4,3),I=1,6),
   4212      $             (SWINDO_l(I,4,3),I=1,6)
   4213                END IF
   4214                IF(.NOT.SUBSKP(005,043).OR..NOT.SUBSKP(005,046))  THEN
   4215                NAME1 = 'JAPAN: GMS/MTSAT CLOUD DRIFT - WV (6 LAT BANDS)'
   4216                   PRINT 8872, NAME1,(SWINDO_e(I,4,2),I=1,6),
   4217      $             (SWINDO_l(I,4,2),I=1,6)
   4218                END IF
   4219                IF(.NOT.SUBSKP(005,061).OR..NOT.SUBSKP(005,064))  THEN
   4220                NAME1 = 'ESA: METEOSAT-ODD CL DRIFT -IR-LW (6 LAT BANDS)'
   4221                   PRINT 8872, NAME1,(SWINDO_e(I,5,1),I=1,6),
   4222      $             (SWINDO_l(I,5,1),I=1,6)
   4223                NAME1 = 'ESA: METEOSAT-EVN CL DRIFT -IR-LW (6 LAT BANDS)'
   4224                   PRINT 8872, NAME1,(SWINDO_e(I,6,1),I=1,6),
   4225      $             (SWINDO_l(I,6,1),I=1,6)
   4226                END IF
   4227                IF(.NOT.SUBSKP(005,062).OR..NOT.SUBSKP(005,065))  THEN
   4228                NAME1 = 'ESA: METEOSAT-ODD CLOUD DRIFT-VIS (6 LAT BANDS)'
   4229                   PRINT 8872, NAME1,(SWINDO_e(I,5,3),I=1,6),
   4230      $             (SWINDO_l(I,5,3),I=1,6)
   4231                NAME1 = 'ESA: METEOSAT-EVN CLOUD DRIFT-VIS (6 LAT BANDS)'
   4232                   PRINT 8872, NAME1,(SWINDO_e(I,6,3),I=1,6),
   4233      $             (SWINDO_l(I,6,3),I=1,6)
   4234                END IF
   4235                IF(.NOT.SUBSKP(005,063).OR..NOT.SUBSKP(005,066))  THEN
   4236                NAME1 = 'ESA: METEOSAT-ODD CLOUD DRFT-WVPR (6 LAT BANDS)'
   4237                   PRINT 8872, NAME1,(SWINDO_e(I,5,2),I=1,6),

Page 93          Source Listing                  PREP
2017-04-18 11:09                                 prepdata.f

   4238      $             (SWINDO_l(I,5,2),I=1,6)
   4239                NAME1 = 'ESA: METEOSAT-EVN CLOUD DRFT-WVPR (6 LAT BANDS)'
   4240                   PRINT 8872, NAME1,(SWINDO_e(I,6,2),I=1,6),
   4241      $             (SWINDO_l(I,6,2),I=1,6)
   4242                END IF
   4243                IF(.NOT.SUBSKP(005,070).OR..NOT.SUBSKP(005,071))
   4244      $          PRINT 8874
   4245  8874          FORMAT(25X,'---> POLAR-ORBITING REPORTS:')
   4246                IF(.NOT.SUBSKP(005,070))  THEN
   4247                NAME1 = 'NASA/MODIS: AQUA  IMGR C.DR-IR-LW (6 LAT BANDS)'
   4248                   PRINT 8872, NAME1,(SWINDO_e(I,7,4),I=1,6),
   4249      $             (SWINDO_l(I,7,4),I=1,6)
   4250                NAME1 = 'NASA/MODIS: TERRA IMGR C.DR-IR-LW (6 LAT BANDS)'
   4251                   PRINT 8872, NAME1,(SWINDO_e(I,8,4),I=1,6),
   4252      $             (SWINDO_l(I,8,4),I=1,6)
   4253                END IF
   4254                IF(.NOT.SUBSKP(005,071))  THEN
   4255                NAME1 = 'NASA/MODIS: AQUA  IMGR WV-CL. TOP (6 LAT BANDS)'
   4256                   PRINT 8872, NAME1,(SWINDO_e(I,7,6),I=1,6),
   4257      $             (SWINDO_l(I,7,6),I=1,6)
   4258                NAME1 = 'NASA/MODIS: TERRA IMGR WV-CL. TOP (6 LAT BANDS)'
   4259                   PRINT 8872, NAME1,(SWINDO_e(I,8,6),I=1,6),
   4260      $             (SWINDO_l(I,8,6),I=1,6)
   4261                NAME1 = 'NASA/MODIS: AQUA  IMGR WV-DP. LYR (6 LAT BANDS)'
   4262                   PRINT 8872, NAME1,(SWINDO_e(I,7,7),I=1,6),
   4263      $             (SWINDO_l(I,7,7),I=1,6)
   4264                NAME1 = 'NASA/MODIS: TERRA IMGR WV-DP. LYR (6 LAT BANDS)'
   4265                   PRINT 8872, NAME1,(SWINDO_e(I,8,7),I=1,6),
   4266      $             (SWINDO_l(I,8,7),I=1,6)
   4267                END IF
   4268  8872          FORMAT(5X,A47,6F6.0,' TO ',6F6.0)
   4269                PRINT'(1X)'
   4270             ELSE IF(NN.EQ.1)  THEN
   4271       NAME2 = '               RAOB/PIBAL - ............ MINUS AND PLUS '
   4272                PRINT 876, NAME2,UWINDO
   4273       NAME2 = '               RECONNAISSANCE - ........ MINUS AND PLUS '
   4274                IF(RECCON)  PRINT 876, NAME2,RWINDO
   4275       NAME2 = '               DROPWINSONDE - .......... MINUS AND PLUS '
   4276                IF(DROPSN)  PRINT 876, NAME2,DWINDO
   4277       NAME2 = '               CLASS SOUNDINGS - ....... MINUS AND PLUS '
   4278                IF(MIN(LSMASS,LSWIND).EQ.0)  PRINT 876, NAME2,CWINDO
   4279   876          FORMAT(27X,A56,F5.0)
   4280                PRINT'(1X)'
   4281             ELSE  IF(NN.EQ.3)  THEN
   4282                IF(.NOT.SUBSKP(004,001).OR..NOT.SUBSKP(004,002))  THEN
   4283       NAME2 = 'AIREP/PIREP ACFT; OUT US MNLND/G.MEX/S.ONT.-MINUS & PLUS'
   4284                   PRINT 873, NAME2,AWINDO(1,1)
   4285       NAME2 = 'AIREP/PIREP ACFT; IN  US MNLND/G.MEX/S.ONT.-MINUS & PLUS'
   4286                   PRINT 873, NAME2,AWINDO(2,1)
   4287                END IF
   4288                IF(.NOT.SUBSKP(004,003))  THEN
   4289       NAME2 = 'AMDAR AIRCRAFT;   OUT US MNLND/G.MEX/S.ONT.-MINUS & PLUS'
   4290                   PRINT 873, NAME2,AWINDO(1,2)
   4291       NAME2 = 'AMDAR AIRCRAFT;   IN  US MNLND/G.MEX/S.ONT.-MINUS & PLUS'
   4292                   PRINT 873, NAME2,AWINDO(2,2)
   4293                END IF
   4294                IF(.NOT.SUBSKP(004,006))  THEN

Page 94          Source Listing                  PREP
2017-04-18 11:09                                 prepdata.f

   4295       NAME2 = 'EAMDAR AIRCFT;    OUT US MNLND/G.MEX/S.ONT.-MINUS & PLUS'
   4296                   PRINT 873, NAME2,AWINDO(1,3)
   4297       NAME2 = 'EAMDAR AIRCFT;    IN  US MNLND/G.MEX/S.ONT.-MINUS & PLUS'
   4298                   PRINT 873, NAME2,AWINDO(2,3)
   4299                END IF
   4300                IF(.NOT.SUBSKP(004,008).OR..NOT.SUBSKP(004,012).OR.
   4301      $            .NOT.SUBSKP(004,013))  THEN
   4302       NAME2 = 'TAMDARM AIRCFT;   OUT US MNLND/G.MEX/S.ONT.-MINUS & PLUS'
   4303                   PRINT 873, NAME2,AWINDO(1,5)
   4304       NAME2 = 'TAMDARM AIRCFT;   IN  US MNLND/G.MEX/S.ONT.-MINUS & PLUS'
   4305                   PRINT 873, NAME2,AWINDO(2,5)
   4306                END IF
   4307                IF(.NOT.SUBSKP(004,009))  THEN
   4308       NAME2 = 'CAMDAR AIRCFT;    OUT US MNLND/G.MEX/S.ONT.-MINUS & PLUS'
   4309                   PRINT 873, NAME2,AWINDO(1,6)
   4310       NAME2 = 'CAMDAR AIRCFT;    IN  US MNLND/G.MEX/S.ONT.-MINUS & PLUS'
   4311                   PRINT 873, NAME2,AWINDO(2,6)
   4312                END IF
   4313                IF(.NOT.SUBSKP(004,011))  THEN
   4314       NAME2 = 'KAMDAR AIRCFT;    OUT US MNLND/G.MEX/S.ONT.-MINUS & PLUS'
   4315                   PRINT 873, NAME2,AWINDO(1,7)
   4316       NAME2 = 'KAMDAR AIRCFT;    IN  US MNLND/G.MEX/S.ONT.-MINUS & PLUS'
   4317                   PRINT 873, NAME2,AWINDO(2,7)
   4318                END IF
   4319                IF(.NOT.SUBSKP(004,103))  THEN
   4320       NAME2 = 'AMDARB AIRCFT;    OUT US MNLND/G.MEX/S.ONT.-MINUS & PLUS'
   4321                   PRINT 873, NAME2,AWINDO(1,8)
   4322       NAME2 = 'AMDARB AIRCFT;    IN  US MNLND/G.MEX/S.ONT.-MINUS & PLUS'
   4323                   PRINT 873, NAME2,AWINDO(2,8)
   4324                END IF
   4325                IF(.NOT.SUBSKP(004,010))  THEN
   4326       NAME2 = 'TAMDARB AIRCFT;   OUT US MNLND/G.MEX/S.ONT.-MINUS & PLUS'
   4327                   PRINT 873, NAME2,AWINDO(1,9)
   4328       NAME2 = 'TAMDARB AIRCFT;   IN  US MNLND/G.MEX/S.ONT.-MINUS & PLUS'
   4329                   PRINT 873, NAME2,AWINDO(2,9)
   4330                END IF
   4331                PRINT'(1X)'
   4332             ELSE  IF(NN.EQ.2)  THEN
   4333       NAME2 = 'MDCRS AIRCRAFT;   OUT US MNLND/G.MEX/S.ONT.-MINUS & PLUS'
   4334                PRINT 873, NAME2,AWINDO(1,4)
   4335       NAME2 = 'MDCRS AIRCRAFT;   IN  US MNLND/G.MEX/S.ONT.-MINUS & PLUS'
   4336                PRINT 873, NAME2,AWINDO(2,4)
   4337                PRINT'(1X)'
   4338             ELSE  IF(NN.EQ.5)  THEN
   4339       NAME2 = 'WIND PROFILER DATA ORIG. FROM PILOT BULL .. MINUS & PLUS'
   4340                PRINT 873, NAME2,PWINDO(2)
   4341                IPRFPIB = 1
   4342                GO TO 79
   4343             END IF
   4344   873       FORMAT(34X,A56,F5.0)
   4345             GO TO 2100
   4346 C.......................................................................
   4347          END IF
   4348       ELSE
   4349 C***********************************************************************
   4350          IRET = 0
   4351 C CALL W3UNPKB7 TO READ/DECODE THE NEXT WIND PROFILER (EXCEPT FOR THOSE

Page 95          Source Listing                  PREP
2017-04-18 11:09                                 prepdata.f

   4352 C  ORIGINATING FROM PILOT FORMAT BULLETINS), VAD WIND OR RASS TEMP.
   4353 C  REPORT {ASSUME THAT ALL MESSAGES IN BUFR DUMP FILE SHOULD BE READ
   4354 C  AND DECODED (TIME WINDOW CHECK LATER ON CAN FILTER REPORTS OUTSIDE
   4355 C  OF REQUESTED TIME LIMITS) - SET RANGE FROM MINUS 5 HOURS TO PLUS 5
   4356 C  HOURS SO W3UNPKB7 WILL NOT HAVE TO DO ANY TIME CHECKS - -3 TO +2
   4357 C  HOURS WOULD ALSO AVOID TIME CHECKS BUT NEED EXPANDED WINDOW
   4358 C  BECAUSE GFS DUMPS ATE +/-5 HOURS TO IMPROVE PROFCQC PERFORMANCE}
   4359          OBS2   = BMISS  ! init obs2   array before reading any rpts
   4360          OBS3   = BMISS  ! init obs3   array before reading any rpts
   4361          NOBS3  = 0      ! init nobs3  array before reading any rpts
   4362          obs8_8 = BMISS  ! init obs8_8 array before reading any rpts
   4363          RDATA2 = BMISS  ! init rdata2 array before reading any rpts
   4364          CALL W3UNPKB7(IDATE,-5,+5,NFILE,RDATA,STNID,DSNAME,RDATA2,
   4365      $    obs8_8,IDSDAT,IDSDMP_8,SUBSET_d,SUBSKP,IRET)
   4366 C.......................................................................
   4367          IF(IRET.EQ.1)  THEN
   4368 C IRET = 1 RETURNS DATA SET INFO (ONLY) AFTER FIRST CALL
   4369             JFLAG = 1
   4370             PRINT 102, DSNAME,NFILE
   4371   102       FORMAT(//46X,'*****  ',A8,'  --  UNIT =',I3,'  *****')
   4372 C SPLIT CENTER DATE INTO COMPONENTS (MDATE)
   4373             MDATE(1) = IDSDAT/1000000
   4374             MDATE(2) = MOD((IDSDAT/10000),100)
   4375             MDATE(3) = MOD((IDSDAT/100),100)
   4376             MDATE(4) = MOD(IDSDAT,100)
   4377             PRINT 1101, DSNAME,MDATE,IDSDMP_8
   4378  1101 FORMAT(/20X,'DATASET NAME: ',A8,'  --  DATE: ',I4.4,2('-',I2.2),
   4379      $ 1X,I2.2,'Z  -- DUMP DATE (I12 FORMAT): ',I12.12/)
   4380 C DOES DATE FROM DATA SET MATCH NCEP PRODUCTION DATE?
   4381             IF(IDSDAT.NE.IDAT10)  THEN
   4382                PRINT 324
   4383   324 FORMAT(/13X,'>>>>>   P R O B L E M :   D A T E   D O E S   N O T',
   4384      $ '   M A T C H   P R O D U C T I O N   D A T E   <<<<<'/)
   4385                GO TO 7000
   4386             END IF
   4387 C CYCLET IS TIME THE WIND PROFILER, VAD WIND OR RASS TEMPERATURE REPORT
   4388 C  IS CENTERED ON (CYCLE TIME)
   4389             CYCLET = IDATE(4)
   4390             PRINT 871
   4391             IF(NN.EQ.5)  THEN
   4392                IF(.NOT.SUBSKP(002,007))  THEN
   4393       NAME2 = 'NOAA PROFILER NETWORK (NPN) WIND DATA ..... MINUS & PLUS'
   4394                   PRINT 873, NAME2,PWINDO(1)
   4395                END IF
   4396                IF(.NOT.SUBSKP(002,011))  THEN
   4397       NAME2 = 'COOPERATIVE AGENCY PROFLR (CAP) WIND DATA . MINUS & PLUS'
   4398                   PRINT 873, NAME2,PWINDO(3)
   4399                END IF
   4400                IF(.NOT.SUBSKP(002,013))  THEN
   4401       NAME2 = 'JAPANESE METEOR. AGENCY WIND PROFILER DATA. MINUS & PLUS'
   4402                   PRINT 873, NAME2,PWINDO(4)
   4403                END IF
   4404             ELSE  IF(NN.EQ.6)  THEN
   4405       NAME2 = 'VAD WIND DATA ............................. MINUS & PLUS'
   4406                PRINT 873, NAME2,VWINDO
   4407             ELSE  IF(NN.EQ.7)  THEN
   4408       NAME2 = 'NPN OR CAP RASS TEMPERATURE DATA .......... MINUS & PLUS'

Page 96          Source Listing                  PREP
2017-04-18 11:09                                 prepdata.f

   4409                PRINT 873, NAME2,TWINDO
   4410             END IF
   4411             GO TO 2100
   4412 C.......................................................................
   4413          ELSE  IF(IRET.EQ.8)  THEN
   4414 C A NEW BUFR MESSAGE WAS READ WITH TYPE 002, SUBTYPE 009 - THIS MESSAGE
   4415 C  CONTAINS WIND PROFILER REPORTS ORIGINATING FROM PILOT (PIBAL) FORMAT
   4416 C  BULLETINS - USE SUBROUTINE UNPREPBF TO UNPACK THESE
   4417             PRINT 892, NFILE
   4418   892 FORMAT(/'BUFR MESSAGE IN UNIT',I3,' CONTAINS WIND PROFILER ',
   4419      $ 'REPORTS FROM PIBAL BULLETINS - USE SUBROUTINE UNPREPBF TO ',
   4420      $ 'UNPACK THESE REPORTS'/)
   4421             IOPENED = 1
   4422             IPRFPIB = 2
   4423             GO TO 2100
   4424 C.......................................................................
   4425          ELSE  IF(IRET.GT.2)  THEN
   4426 C PROBLEM READING WIND PROFILER, VAD WIND OR RASS TEMPERATURE REPORT,
   4427 C  GO ON TO NEXT REPORT
   4428             PRINT 912, DNAME(NN-4)
   4429   912       FORMAT(/' * * ERROR READING ',A8,' REPORT'/)
   4430             KNDCDE(NN-4) = KNDCDE(NN-4) + 1
   4431             GO TO 2090
   4432 C.......................................................................
   4433          ELSE  IF(IRET.EQ.2)  THEN
   4434 C ALL WIND PROFILER, VAD WIND OR RASS TEMPERATURE REPORTS READ; GO ON
   4435 C  TO NEXT DATA TYPE
   4436             GO TO 7002
   4437          END IF
   4438          DATA4 = RDATA(4)
   4439 C***********************************************************************
   4440       END IF
   4441    79 CONTINUE
   4442       JFLAG = 2
   4443       KNTALL = KNTALL + 1
   4444 C-----------------------------------------------------------------------
   4445 C BEGIN SERIES OF CHECKS ON UNPACKED REPORT - IF ANY FAIL, SKIP REPORT
   4446 C-----------------------------------------------------------------------
   4447 C CALL CHKREP TO CHECK FOR MSG LAT/LON & FOR REPORT OUTSIDE SEARCH AREA
   4448       CALL CHKREP(KMSGUA,KBDYUA,*2090)
   4449       IF(IDATA(9).EQ.62)  THEN
   4450 C+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
   4451 C        CHECKS ON OLD-TYPE "CLOUD" WIND ESTIMATES (R. TYPE 62)
   4452 C+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
   4453 C CURRENTLY THESE REPORTS ARE ALL SKIPPED (BUT KEEP COUNT)
   4454          PRINT 105, STNID,RDATA(1),RDATA(2),IDATA(9)
   4455   105 FORMAT(' * * TOTAL REPORT TOSSED  -ID=',A8,', LAT=',F7.2,'N, ',
   4456      $ 'LON=',F8.2,'E, RTYP',I4,' - OLD "CLOUD" WIND ESTIMATE')
   4457          KNOATS = KNOATS + 1
   4458          GO TO 2090
   4459       ELSE  IF(IDATA(9).EQ.61)  THEN
   4460 C+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
   4461 C         CHECKS ON OLD-TYPE VTPR SATELLITE RETRIEVALS (R. TYPE 61)
   4462 C                          (OLD FGGE CASES)
   4463 C MODERN SATELLITE RETRIEVALS PROCESSED LATER IN SUBR. SATEDS OR SATBFR
   4464 C+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
   4465 C CURRENTLY THESE REPORTS ARE ALL SKIPPED (NO COUNT)

Page 97          Source Listing                  PREP
2017-04-18 11:09                                 prepdata.f

   4466          PRINT 9105, STNID,RDATA(1),RDATA(2),IDATA(9)
   4467  9105 FORMAT(' * * TOTAL REPORT TOSSED  -ID=',A8,', LAT=',F7.2,'N, ',
   4468      $ 'LON=',F8.2,'E, RTYP',I4,' - VTPR SATELLITE RETRIEVAL')
   4469          GO TO 2100
   4470       ELSE  IF(IDATA(9).EQ.51.AND.STNID(1:1).EQ.'C')  THEN
   4471 C+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
   4472 C      CHECKS ON CLIMATOLOGY (R. TYPE 51, STATION ID BEGINS WITH 'C')
   4473 C+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
   4474 C CURRENTLY THESE REPORTS ARE ALL SKIPPED (NO COUNT)
   4475          PRINT 9109, STNID,RDATA(1),RDATA(2),IDATA(9)
   4476  9109 FORMAT(' * * TOTAL REPORT TOSSED  -ID=',A8,', LAT=',F7.2,'N, ',
   4477      $ 'LON=',F8.2,'E, RTYP',I4,' - CLIMATOLOGY')
   4478          GO TO 2100
   4479       ELSE  IF(IDATA(9).EQ.31)  THEN
   4480          IF(IDATA(10).EQ.1)  THEN
   4481 C+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
   4482 C            CHECKS ON RECONNAISSANCE (R. TYPE 31, SUBTYPE 1)
   4483 C  (NOTE: I BELIEVE THE TIME CHECK IS NOT NEEDED HERE BECAUSE ALL RECCOS
   4484 C         ARE DATA LEVEL CAT. 6 AND GO INTO SUBR. GETC06 WHERE THEY ARE
   4485 C         AGAIN TIME CHECKED)
   4486 C+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
   4487 C SKIP REPORT IF RECCON=F (KEEP COUNT)
   4488             IF(.NOT.RECCON)  THEN
   4489                KSKREC = KSKREC + 1
   4490                GO TO 2090
   4491             ELSE
   4492 C SET UP FOR LATER CHECK IF RECCO. IS W/I TIME WINDOW (RWINDO)
   4493                TIMWIN_e = -RWINDO * .01
   4494                TIMWIN_l =  RWINDO * .01
   4495 cppppppppppppppppppppppppppppp
   4496                if(idata(23).le.0) print'(" ^^^^^ Here is a RECCO that",
   4497      $          " would NOT go into subr. GETC06 - something wrong?")'
   4498 cppppppppppppppppppppppppppppp
   4499             END IF
   4500          ELSE
   4501 C+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
   4502 C             CHECKS ON DROPWINSONDE (R. TYPE 31, SUBTYPE 2)
   4503 C+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
   4504 C SKIP REPORT IF DROPSN=F (KEEP COUNT)
   4505             IF(.NOT.DROPSN)  THEN
   4506                KSKDRP = KSKDRP + 1
   4507                GO TO 2090
   4508             ELSE
   4509 C SET UP FOR LATER CHECK IF DROPS. IS W/I TIME WINDOW (DWINDO)
   4510                TIMWIN_e = -DWINDO * .01
   4511                TIMWIN_l =  DWINDO * .01
   4512             END IF
   4513          END IF
   4514          INSTR = 2
   4515       ELSE  IF(IDATA(9).EQ.71)  THEN
   4516 C+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
   4517 C     CHECKS ON NOAA PROFILER NETWORK (NPN) WIND REPORTS (R. TYPE 71)
   4518 C+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
   4519          INSTR = 3
   4520 C SET UP FOR LATER CHECK IF PROFILER RPT IS W/I TIME WINDOW {PWINDO(1)}
   4521          TIMWIN_e = -PWINDO(1) * .01
   4522          TIMWIN_l =  PWINDO(1) * .01

Page 98          Source Listing                  PREP
2017-04-18 11:09                                 prepdata.f

   4523       ELSE  IF(IDATA(9).EQ.73)  THEN
   4524 C+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
   4525 C              CHECKS ON WIND PROFILER REPORTS ORIGINATING FROM
   4526 C                PILOT (PIBAL) FORMAT BULLETINS  (R. TYPE 73)
   4527 C+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
   4528          INSTR = 9
   4529 C SET UP FOR LATER CHECK IF PROFILER RPT IS W/I TIME WINDOW {PWINDO(2)}
   4530          TIMWIN_e = -PWINDO(2) * .01
   4531          TIMWIN_l =  PWINDO(2) * .01
   4532       ELSE  IF(IDATA(9).EQ.75)  THEN
   4533 C+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
   4534 C  CHECKS ON COOPERATIVE AGENCY PROFILER (CAP) WIND RPTS (R. TYPE 75)
   4535 C+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
   4536          INSTR = 7
   4537 C SET UP FOR LATER CHECK IF PROFILER RPT IS W/I TIME WINDOW {PWINDO(3)}
   4538          TIMWIN_e = -PWINDO(3) * .01
   4539          TIMWIN_l =  PWINDO(3) * .01
   4540       ELSE  IF(IDATA(9).EQ.76)  THEN
   4541 C+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
   4542 C        CHECKS ON JMA (JAPANESE) WIND PROFILER REPORTS (R. TYPE 76)
   4543 C+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
   4544          INSTR = 8
   4545 C SET UP FOR LATER CHECK IF PROFILER RPT IS W/I TIME WINDOW {PWINDO(4)}
   4546          TIMWIN_e = -PWINDO(4) * .01
   4547          TIMWIN_l =  PWINDO(4) * .01
   4548       ELSE  IF(IDATA(9).EQ.72)  THEN
   4549 C+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
   4550 C           CHECKS ON VAD (NEXRAD) WIND REPORTS (R. TYPE 72)
   4551 C+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
   4552          INSTR = 4
   4553 C SET UP FOR LATER CHECK IF VAD WIND REPORT IS W/I TIME WINDOW (VWINDO)
   4554          TIMWIN_e = -VWINDO * .01
   4555          TIMWIN_l =  VWINDO * .01
   4556       ELSE  IF(IDATA(9).EQ.77)  THEN
   4557 C+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
   4558 C       CHECKS ON NPN AND CAP RASS TEMPERATURE REPORTS (R. TYPE 77)
   4559 C+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
   4560          INSTR = 6
   4561 C SET UP FOR LATER CHECK IF RASS TEMP REPORT IS W/I TIME WINDOW (TWINDO)
   4562          TIMWIN_e = -TWINDO * .01
   4563          TIMWIN_l =  TWINDO * .01
   4564       ELSE  IF(IDATA(9).EQ.13.AND.STNID(1:4).EQ.'CLAS')  THEN
   4565 C+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
   4566 C          CHECKS ON CLASS SOUNDINGS (R. TYPE 13), STNID = 'CLASxx'
   4567 C+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
   4568 C SKIP REPORT IF BOTH LSMASS AND LSWIND = 9999 (KEEP COUNT)
   4569          IF(LSMASS.EQ.9999.AND.LSWIND.EQ.9999)  THEN
   4570             KSKCLS = KSKCLS + 1
   4571             GO TO 2090
   4572          END IF
   4573          INSTR = 2
   4574 C SET UP FOR LATER CHECK IF CLASS SNDG IS W/I TIME WINDOW (CWINDO)
   4575          TIMWIN_e = -CWINDO * .01
   4576          TIMWIN_l =  CWINDO * .01
   4577       ELSE
   4578 C+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
   4579 C                CHECKS ON RADIOSONDE/PIBALS (DEFAULT)

Page 99          Source Listing                  PREP
2017-04-18 11:09                                 prepdata.f

   4580 C+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
   4581          INSTR = 0
   4582 C SET UP FOR LATER CHECK IF RAOB, PIBAL W/I TIME WINDOW (UWINDO)
   4583          TIMWIN_e = -UWINDO * .01
   4584          TIMWIN_l =  UWINDO * .01
   4585 C+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
   4586       END IF
   4587 C***********************************************************************
   4588 C PROCESS DATA LEVEL CAT.6 {ACFT FLT-LVL, SATWND(ALL TYPES), RECCO} RPTS
   4589 C***********************************************************************
   4590 C ALL CAT. 6 RPTS ARE TREATED IN THEIR OWN SUBROUTINE
   4591       IF(IDATA(23).GT.0.AND.(IDATA(9).EQ.31.OR.IDATA(9).EQ.41.OR.
   4592      $ IDATA(9).EQ.63)) CALL GETC06(NN,CYCLET,*2100,*2090)
   4593 C IF REPORT IS NOT ONE OF THE VALID CAT. 6 TYPES, SKIP IT
   4594       IF(IDATA(23).GT.0)  THEN
   4595          PRINT 995, STNID,RDATA(1),RDATA(2),IDATA(9)
   4596   995 FORMAT(' * * TOTAL REPORT TOSSED  -ID=',A8,', LAT=',F7.2,'N, ',
   4597      $ 'LON=',F8.2,'E, RTYP',I4,' - INVALID TYPE WITH CAT. 6')
   4598          GO TO 2090
   4599       END IF
   4600 C***********************************************************************
   4601 C PROCESS DATA LEVEL CAT. 1-5 (RAOB, PIBAL, DROPS, PROFILERS ORIG. IN
   4602 C   PILOT FORMAT, VAD WINDS), DATA LEVEL CAT. 11 (ALL OTHER PROFILERS),
   4603 C                & DATA LEVEL CAT. 15 (RASS) REPORTS
   4604 C***********************************************************************
   4605       IFLUA = 0
   4606 C-----------------------------------------------------------------------
   4607 C CALL SUBR. 'RPTLBL' TO STORE REPORT HEADER INTO HDR(4),HDR(5),HDR(7),
   4608 C                          HDR(9)-HDR(15), ALAT_8, ALON_8
   4609 C-----------------------------------------------------------------------
   4610       CALL RPTLBL(CYCLET)
   4611 C STORE WORD 8 OF REPORT HEADER (REPORT "SUBTYPE") AS 2 FOR DROPS
   4612 C  (STORED AS 1 FOR RECCOS IN SUBR. GETC06)
   4613       IF(IDATA(9).EQ.31)  HDR(8) = 2.
   4614 C STORE WORD 8 OF REPORT HEADER (REPORT "SUBTYPE") AS 2 FOR VAD WIND
   4615 C  REPORTS FROM LEVEL 2 DECODER AND AS 1 FOR VAD WIND REPORTS FROM
   4616 C  RADAR CODED MESSAGE
   4617       IF(IDATA(9).EQ.72) THEN
   4618          IF(SUBSET_d.EQ.'NC002017')  THEN
   4619             HDR(8) = 2.
   4620          ELSE
   4621             HDR(8) = 1.
   4622          END IF
   4623       END IF
   4624 C-----------------------------------------------------------------------
   4625 C        CALL SUBR. 'TIMCHK' TO CHECK IF REPORT IS W/I PROPER
   4626 C              TIME WINDOW OF CYCLE TIME (IER =1 TOSS RPT)
   4627 C-----------------------------------------------------------------------
   4628       CALL TIMCHK(HDR(4),TIMWIN_e,TIMWIN_l,IER)
   4629       IF(IER.EQ.1)  THEN
   4630          KTIMUA = KTIMUA + 1
   4631          GO TO 2090
   4632       END IF
   4633       IF(MARLND.OR.IDATA(9).LT.21.OR.IDATA(9).GT.23)  GO TO 1490
   4634 C-----------------------------------------------------------------------
   4635 C TEST OCEAN STATION RADIOSONDE AND PIBAL REPORTS FOR OVER LAND CRITERIA
   4636 C         IF MET SUCH RPTS ARE GIVEN PREPBUFR TABLE VALUE = 15

Page 100         Source Listing                  PREP
2017-04-18 11:09                                 prepdata.f

   4637 C-----------------------------------------------------------------------
   4638 C OTHERWISE, CALL SUBR. LNDCHK, SEE IF RPT SATISFIES OVER LAND CRITERIA
   4639       IF(NINT(RDATA(1)*100.).LT.0)  THEN
   4640          CALL LNDCHK(RDATA(1),RDATA(2),1,4,1,GDSH,145,37,0.5,ILAND)
   4641       ELSE
   4642          CALL LNDCHK(RDATA(1),RDATA(2),1,4,1,GDNH,362,91,0.5,ILAND)
   4643       END IF
   4644       IF(ILAND.EQ.0)  GO TO 1490
   4645 C REPORT SATISFIES OVER LAND CRITERIA
   4646 C   PROCESS BUT FLAG ALL VARIABLES WITH PREPBUFR T.V. OF 15
   4647       IF(IPRINT.EQ.0)  PRINT 1929, STNID,RDATA(1),RDATA(2),IDATA(9)
   4648  1929 FORMAT(' + + TOTAL REPORT FLAGGED -ID=',A8,', LAT=',F7.2,'N, ',
   4649      $ 'LON=',F8.2,'E, RTYP',I4,' - OVERLAND OCEAN STN REPORT')
   4650       IF(IFLUA.EQ.0)  KSKOMR(1) = KSKOMR(1) + 1
   4651       IFLUA = 1
   4652  1490 CONTINUE
   4653 C-----------------------------------------------------------------------
   4654 C         UNPACKED REPORT HAS SUCCESSFULLY PASSED ALL CHECKS
   4655 C-----------------------------------------------------------------------
   4656 C FUNCTION ISEL CONVERTS DUMP REPORT TYPE TO A VALUE USED TO GET
   4657 C  PREPBUFR REPORT TYPE
   4658       HDR(6) = ((ISEL(IDATA(9)) + 10) * 10) + INSTR
   4659 C CHECK FOR VALID DATA, IF NONE UNPACK NEXT REPORT
   4660       IF(MAX(IDATA(13),IDATA(15),IDATA(17),IDATA(19),IDATA(21),
   4661      $       IDATA(35),IDATA(37),IDATA(45)).EQ.0)  GO TO 2100
   4662 C.......................................................................
   4663 C  PROCESS RAOB, PIBAL, DROPWINSONE, WIND PROFILER, VAD WIND, RASS AND
   4664 C   CLASS DATA ON MANDATORY AND SIGNIFICANT LEVELS (DATA LEVEL
   4665 C   CAT. 1-5, 11, 15)
   4666 C.......................................................................
   4667 C "ISATOB" =0 - NON-SATELLITE DATA (TRANSF. VIA COMMON, DEFAULT VALUE)
   4668       CALL GETUPA(*2100,*2090)
   4669 C***********************************************************************
   4670 C HIT END-OF FILE - TIME TO LOOK AT NEXT UPPER-AIR FILE
   4671  7000 CONTINUE
   4672       REWIND NFILE
   4673       GO TO 7003
   4674  7002 CONTINUE
   4675 C ONLY WIND PROFILER (EXCEPT THOSE ORIG. IN PILOT FORMAT BULLETINS),
   4676 C  VAD WIND OR RASS TEMPERATURE REPORTS CAN COME HERE
   4677       IF(JFLAG.LE.0)  THEN
   4678          PRINT 8003, IUNIT(8)
   4679  8003    FORMAT(/' *** ERROR RETURNING DATA SET INFORMATION IN ',
   4680      $    'FIRST CALL TO FILE IN UNIT ',I3,' -- THIS MAY BE A NULL',
   4681      $    ' FILE -- GO TO NEXT FILE'/)
   4682       ELSE  IF(JFLAG.EQ.1)  THEN
   4683          PRINT 8002
   4684  8002 FORMAT(/' * * NO REPORTS CURRENTLY PRESENT IN THIS DATA FILE,',
   4685      $ ' GO TO NEXT FILE'/)
   4686          END IF
   4687  7003 CONTINUE
   4688       PRINT 950, KNTALL
   4689   950 FORMAT(19X,'===>  A TOTAL OF ',I6,'  REPORTS WERE UNPACKED ',
   4690      $ 'FROM THIS FILE, WHETHER KEPT OR SKIPPED  <===',/)
   4691       IF(NN.EQ.1.AND.KOUNT.EQ.0)  ICODE = 4
   4692       KNTUUU(NN) = KOUNT
   4693       IF(NN.EQ.4.AND.KNTUUU(4).GT.0)  THEN

Page 101         Source Listing                  PREP
2017-04-18 11:09                                 prepdata.f

   4694 C FOR SATWND FILE, CALL SUBROUTINE SWNTBL TO SUMMARIZE RESULTS IN TABLE
   4695          CALL SWNTBL
   4696       ELSE  IF(NN.EQ.2.AND.KNTUUU(2).GT.0)  THEN
   4697 C FOR AIRCAR FILE, BRIEFLY SUMMARIZE IN A TABLE
   4698          PRINT 881, (KEPAC(I,4),I=1,6)
   4699   881    FORMAT(/31X,'***** TABLE DETAILING THE USE OF AIRCRAFT REPORTS'
   4700      $,   ' *****'//,20X,86('_')/43X,'||',19X,'COUNTS BY LATITUDE BAND',
   4701      $    17X,'||'/20X,'AIRCRAFT REPORT TYPE   || 90S-70S | 70S-20S ',
   4702      $    '| 20S-EQ  |  EQ-20N | 20N-70N | 70N-90N ||'/43X,'||',
   4703      $    6(9X,'|'),'|'
   4704      $    /21X,'MDCRS                 ||',6(I6,3X,'|'),'|'
   4705      $    /20X,86('_')/)
   4706       ELSE  IF(NN.EQ.3.AND.KNTUUU(3).GT.0)  THEN
   4707 C FOR AIRCRAFT FILE, BRIEFLY SUMMARIZE IN A TABLE
   4708          PRINT 981, ((KEPAC(I,J),I=1,6),J=1,3),
   4709      $              ((KEPAC(I,J),I=1,6),J=5,9)
   4710   981    FORMAT(/31X,'***** TABLE DETAILING THE USE OF AIRCRAFT REPORTS'
   4711      $,   ' *****'//,20X,86('_')/43X,'||',19X,'COUNTS BY LATITUDE BAND',
   4712      $    17X,'||'/20X,'AIRCRAFT REPORT TYPE   || 90S-70S | 70S-20S ',
   4713      $    '| 20S-EQ  |  EQ-20N | 20N-70N | 70N-90N ||'/43X,'||',
   4714      $    6(9X,'|'),'|'
   4715      $    /21X,'AIREP/PIREP           ||',6(I6,3X,'|'),'|'
   4716      $    /21X,'AMDAR                 ||',6(I6,3X,'|'),'|'
   4717      $    /21X,'EAMDAR                ||',6(I6,3X,'|'),'|'
   4718      $    /21X,'TAMDARM               ||',6(I6,3X,'|'),'|'
   4719      $    /21X,'CAMDAR                ||',6(I6,3X,'|'),'|'
   4720      $    /21X,'KAMDAR                ||',6(I6,3X,'|'),'|'
   4721      $    /21X,'AMDARB                ||',6(I6,3X,'|'),'|'
   4722      $    /21X,'TAMDARB               ||',6(I6,3X,'|'),'|'
   4723      $    /20X,86('_')/)
   4724       END IF
   4725  7001 CONTINUE
   4726       NN = NN + 1
   4727       IF(NN.LT.8)  GO TO 700
   4728       PRINT 5679
   4729  5679 FORMAT(/130('.')/130('.')/)
   4730       FLRECO = .FALSE.
   4731       PROFILERinADPUPA = .FALSE.
   4732 C***********************************************************************
   4733 C***********************************************************************
   4734 C ALL U-AIR DATA FILES HAVE BEEN EXAMINED, PRINT TABLES SUMMARIZING
   4735 C  HYDROSTATIC CHECK (UNLESS FILLZ = FALSE)
   4736       IF(FILLZ)  CALL PSTATS
   4737 C READY FOR SATELLITE DATA.....
   4738       PRINT 8050
   4739  8050 FORMAT(//30X,21('-'),' ***** SATELLITE DATA ***** ',21('-'))
   4740 C***********************************************************************
   4741 C RTOVS OR ATOVS RADIANCES/40-LEVEL RETRIEVALS FROM BUFR DATA DUMP FILE
   4742 C***********************************************************************
   4743 C "ISATOB" =4 - RTOVS OR ATOVS 40-LEVEL RETRIEVALS (TRANSF. VIA COMMON)
   4744       ISATOB = 4
   4745       IF(TOVBFR(1).OR.TOVBFR(2))  CALL SATBFR
   4746 C***********************************************************************
   4747 C SPCIAL=FILLZ=FILLT=FILLW=FILLM=F ALWAYS FOR ALL OTHER SAT. RETR.
   4748 C (THEY DON'T APPLY TO 40-LVL RTOVS AND ATOVS RETRIEVALS AND GOES SNDGS)
   4749       SPCIAL = .FALSE.
   4750       FILLZ  = .FALSE.

Page 102         Source Listing                  PREP
2017-04-18 11:09                                 prepdata.f

   4751       FILLT  = .FALSE.
   4752       FILLW  = .FALSE.
   4753       FILLM  = .FALSE.
   4754 C***********************************************************************
   4755 C        RTOVS OR ATOVS RETRIEVAL RETURNED IN UNPACKED NMCEDS FORMAT
   4756 C                        FROM BUFR DATA DUMP FILE
   4757 C***********************************************************************
   4758 C "ISATOB" =1 - RTOVS OR ATOVS RETR. RETURNED IN UNPACKED NMCEDS FORMAT
   4759 C   (TRANSF. VIA COMMON)
   4760       ISATOB = 1
   4761       IF(TOVEDS(1).OR.TOVEDS(2))  CALL SATEDS
   4762 C***********************************************************************
   4763 C                 GOES DATA FROM BUFR DATA DUMP FILE
   4764 C                            -- EITHER --
   4765 C  GOES SNDGS {WHEN EITHER GOESND(1) OR GOESND(2) =T} (DATA LVL CAT 12)
   4766 C                              -- OR --
   4767 C GOES PREC. WTR RETR. {WHEN GOESPW(1) OR GOESPW(2) =T} (DATA LVL CAT 8)
   4768 C                              -- OR --
   4769 C    GOES RADIANCES {WHEN GOESRD(1) OR GOESRD(2) =T} (DATA LVL CAT 13)
   4770 C                              -- OR --
   4771 C GOES CLOUD TOP RETR. {WHEN GOESCT(1) OR GOESCT(2) =T} (DATA LVL CAT 8)
   4772 C***********************************************************************
   4773 C "ISATOB" =3 - GOES REPORTS (TRANSF. VIA COMMON)
   4774       ISATOB = 3
   4775       IF(GOESND(1).OR.GOESPW(1).OR.GOESRD(1).OR.GOESCT(1).OR.GOESND(2)
   4776      $ .OR.GOESPW(2).OR.GOESRD(2).OR.GOESCT(2))  CALL GOESDG
   4777       ISATOB = -99
   4778 C***********************************************************************
   4779 C    SURFACE AND PMSL BOGUS REPORTS (DATA LEVEL CATEGORIES 51 AND 8)
   4780 C***********************************************************************
   4781 C INITIALIZE ALL LEVELS OF MOBS ARRAY (NOTE: FOR SURFACE PROCESSING,
   4782 C  SUBR. SFCDTA WILL LATER INIT. ONLY FIRST LEVEL FOR EACH RPT)
   4783       MOBS = IMISS
   4784 C INITIALIZE ALL LEVELS OF ICAT ARRAY (NOTE: FROM HERE ON, NO DATA TYPE
   4785 C  STORES CAT. IN ICAT, HOWEVER IT'S STILL REFERRED TO IN SUBR. FILLX
   4786       ICAT = IMISS
   4787       CALL SFCDTA
   4788 C***********************************************************************
   4789 C        SSM/I WIND SPEED, P. WATER, RAIN RATE AND B. TEMP. REPORTS
   4790 C                        (DATA LEVEL CATEGORY 8)
   4791 C***********************************************************************
   4792       DO IB = 1,6
   4793          IF(MIN(JPSSMI(IB,1),JPSSMI(IB,2),JPSSMI(IB,3),JPSSMI(IB,4))
   4794      $    .EQ.0)  THEN
   4795 C INITIALIZE ALL LEVELS OF MOBS ARRAY (NOTE: FOR SSMI WSPD PROCESSING,
   4796 C  SUBR. GETSMI WILL LATER INIT. ONLY FIRST LEVEL FOR EACH RPT)
   4797             MOBS = IMISS
   4798             CALL GETSMI
   4799             EXIT
   4800          END IF
   4801       ENDDO
   4802 C***********************************************************************
   4803 C              ERS SCATTEROMETER DATA (DATA LEVEL CATEGORY 10)
   4804 C***********************************************************************
   4805       IF(MIN(JPERSD(1),JPERSD(2),JPERSD(3),JPERSD(4),JPERSD(5),
   4806      $ JPERSD(6)).EQ.0)  THEN
   4807 C INITIALIZE ALL LEVELS OF MOBS ARRAY (NOTE: FOR ERS PROCESSING, SUBR.

Page 103         Source Listing                  PREP
2017-04-18 11:09                                 prepdata.f

   4808 C  GETSCATT WILL LATER INIT. ONLY FIRST LEVEL FOR EACH RPT)
   4809          MOBS = IMISS
   4810          CALL GETSCATT(1)
   4811       END IF
   4812 C***********************************************************************
   4813 C           QUIKSCAT SCATTEROMETER DATA (DATA LEVEL CATEGORY 10)
   4814 C***********************************************************************
   4815       IF(MIN(JPQKSD(1),JPQKSD(2),JPQKSD(3),JPQKSD(4),JPQKSD(5),
   4816      $ JPQKSD(6)).EQ.0)  THEN
   4817 C INITIALIZE ALL LEVELS OF MOBS ARRAY (NOTE: FOR QUIKSCAT PROCESSING,
   4818 C  SUBR. GETSCATT WILL LATER INIT. ONLY FIRST LEVEL FOR EACH RPT)
   4819          MOBS = IMISS
   4820          CALL GETSCATT(2)
   4821       END IF
   4822 C***********************************************************************
   4823 C           WINDSAT SCATTEROMETER DATA (DATA LEVEL CATEGORY 10)
   4824 C***********************************************************************
   4825       IF(MIN(JPWDSD(1),JPWDSD(2),JPWDSD(3),JPWDSD(4),JPWDSD(5),
   4826      $ JPWDSD(6)).EQ.0)  THEN
   4827 C INITIALIZE ALL LEVELS OF MOBS ARRAY (NOTE: FOR WINDSAT PROCESSING,
   4828 C  SUBR. GETSCATT WILL LATER INIT. ONLY FIRST LEVEL FOR EACH RPT)
   4829          MOBS = IMISS
   4830          CALL GETSCATT(3)
   4831       END IF
   4832 C***********************************************************************
   4833 C             ASCAT SCATTEROMETER DATA (DATA LEVEL CATEGORY 10)
   4834 C***********************************************************************
   4835       IF(MIN(JPASCD(1),JPASCD(2),JPASCD(3),JPASCD(4),JPASCD(5),
   4836      $ JPASCD(6)).EQ.0)  THEN
   4837 C INITIALIZE ALL LEVELS OF MOBS ARRAY (NOTE: FOR ASCAT PROCESSING,
   4838 C  SUBR. GETSCATT WILL LATER INIT. ONLY FIRST LEVEL FOR EACH RPT)
   4839          MOBS = IMISS
   4840          CALL GETSCATT(4)
   4841       END IF
   4842 C***********************************************************************
   4843 C      GLOBAL POSITIONING SATELLITE - INTEGRATED PRECIPITABLE WATER
   4844 C                        / ZENITH TOTAL DELAY
   4845 C                (GPS-IPW/ZTD) DATA (DATA LEVEL CATEGORY 14)
   4846 C***********************************************************************
   4847       IF(MIN(JPGPSD(1),JPGPSD(2),JPGPSD(3),JPGPSD(4),JPGPSD(5),
   4848      $ JPGPSD(6)).EQ.0)  THEN
   4849 C INITIALIZE ALL LEVELS OF MOBS ARRAY (NOTE: FOR GPS-IPW/ZTD PROCESSING,
   4850 C  SUBR. GETGPSIPW WILL LATER INIT. ONLY FIRST LEVEL FOR EACH RPT)
   4851          MOBS = IMISS
   4852          CALL GETGPSIPW
   4853       END IF
   4854 C***********************************************************************
   4855       RETURN
   4856       END
   4857 C$$$  SUBPROGRAM DOCUMENTATION BLOCK
   4858 C
   4859 C SUBPROGRAM:    UNPREPBF
   4860 C   PRGMMR: Keyser           ORG: NP22       DATE: 2016-11-30
   4861 C
   4862 C ABSTRACT: GENERALIZED CODE TO UNPACK RPTS FROM BUFR DATA SETS VIA
   4863 C   FCN IW3UNPBF.  REPORTS ARE PLACED INTO SPECIFIED UNPACKED FORMAT.
   4864 C   IN THE FIRST CALL TO THIS SUBROUTINE FOR A NEW DATA SET, DATA SET

Page 104         Source Listing                  PREP
2017-04-18 11:09                                 prepdata.f

   4865 C   INFORMATION RETURNED FROM THE FIRST CALL TO IW3UNPBF IS USED TO
   4866 C   CHECK THE DATA SET CENTER DATE AGAINST THE NCEP PRODUCTION DATE.
   4867 C   IF THE DATES AGREE, A NORMAL RETURN OCCURS BUT WITH NO REPORT
   4868 C   UNPACKED.  THIS IS IDENTIFIED BY THE OUTPUT ARGUMENT IFLAG=1.
   4869 C   THE SECOND CALL TO THIS SUBROUTINE THEN RETURNS THE FIRST REPORT
   4870 C   IN THE DATA SET.  EACH SUBSEQUENT CALL RETURNS AN UNPACKED REPORT
   4871 C   UNTIL ALL DATA IN THE FILE HAVE BEEN PROCESSED.  ENTRY CHKREP
   4872 C   CHECKS AN UNPACKED REPORT FOR MISSING LAT/LON VALUES AND FOR
   4873 C   LAT/LON VALUES OUTSIDE THE DATA SEARCH BOUNDARY. {THE LATTER
   4874 C   CHECK DOES NOT APPLY TO AIRCRAFT REPORTS (ALL TYPES)}.
   4875 C
   4876 C PROGRAM HISTORY LOG:
   4877 C 1998-02-17  D. A. KEYSER -- ORIGINAL AUTHOR (ADAPTED FROM ORIGINAL
   4878 C    SUBROUTINE UNPREP WHICH UNPACKED ON29 DATA SETS)
   4879 C 1999-08-04  D. A. KEYSER -- MODIFIED TO READ REPROCESSED SSM/I
   4880 C    (SPSSMI) DATA FROM "JACK WOOLLEN" BUFR FILES RATHER THAN FROM ON29
   4881 C    FILES, SUBR. IW3UNPBF MOD. TO HANDLE SSM/I REPROC. DATA IN JACK"
   4882 C    BUFR
   4883 C 2001-04-06  D. A. KEYSER -- CAN HANDLE WIND PROFILERS ORIG. IN PILOT
   4884 C    (PIBAL) FORMAT BULLETINS IN "PROFLR" DUMP FILE (FOR THIS EXPANDED
   4885 C    INPUT ARG. TO INCLUDE "IOPENED", "DSNAME", "IDSDAT", "IDSDMP_8",
   4886 C    SUBSET_d")
   4887 C 2003-07-10  D. A. KEYSER -- NOW RETURNS NEW ARRAY "OBS2" OUT OF
   4888 C     CALL TO IWUNPBF, CURRENTLY JUST 2-WORDS WHERE WORD 1 IS
   4889 C     "RESTRICTIONS ON REDISTRIBUTION" (BUFR F.T. 0-35-200) AND WORD
   4890 C     2 IS "EXPIRATION OF RESTRICTIONS ON REDISTRIBUTION" (HRS)
   4891 C 2004-09-09  D. A. KEYSER -- NOW RETURNS 41-WORD (RATHER THAN 2-WORD)
   4892 C     ARRAY "OBS2" OUT OF CALL TO IW3UNPBF, WHERE WORDS 3-41 CONTAIN
   4893 C     ALTIMETER SETTING, SEA-SURFACE TEMPERATURE, SINGLE-LEVEL SENSIBLE
   4894 C     WEATHER ELEMENTS AND SST TABLE VALUE (Q.M.); RETURNS NEW ARRAY
   4895 C     ARGUMENTS "OBS3" {(5,MXBLVL,5)} AND "NOBS3" {(5)} OUT OF CALL TO
   4896 C     IW3UNPBF WHERE OBS3 CONTAINS MULTIPLE-LEVEL SENSIBLE WEATHER
   4897 C     ELEMENTS AND NOBS3 DEFINES THE NUMBER OF LEVELS OF DATA IN THE
   4898 C     OBS3(X,Y,1) TO OBS3(X,Y,5) ARRAYS (SEE IW3UNPBF DOCBLOCK FOR MORE
   4899 C     INFO)
   4900 C 2007-09-14  D. A. KEYSER -- BUMP UP ARRAY SIZE FOR UNPACKED REPORT
   4901 C     FROM IW3UNPBF FROM 3000 TO 3500
   4902 C 2015-03-09  D. A. KEYSER -- Accounts for new output argument "CBULL"
   4903 C     returned from IW3UNPBF for unpacked reports (character*11 string
   4904 C     containing wmo bulletin header and originator - filled only for
   4905 C     aircraft types right now).
   4906 C 2016-11-30  D. A. KEYSER -- Accounts for new output argument "OBS8_8"
   4907 C     returned from IW3UNPBF for unpacked reports (REAL*8 2-word array
   4908 C     containing latitude and longitude of report).
   4909 C
   4910 C USAGE:    CALL UNPREPBF(IFLAG,CYCLET,IOPENED,DSNAME,IDSDAT,IDSDMP_8,*)
   4911 C   INPUT  ARGUMENT LIST:
   4912 C     IFLAG    - SWITCH {=0 - NEW DATA SET (I.E., THIS MUST BE FIRST
   4913 C              - CALL TO THIS SUBR.); =1 - OLD DATA SET BUT ONLY
   4914 C              - DATA SET INFO RETURNED TO THIS POINT (I.E., THIS
   4915 C              - MUST BE SECOND CALL TO THIS SUBR.); =2 - OLD
   4916 C              - DATA SET WITH VALID DATA READ TO THIS POINT (I.E.,
   4917 C              - THIS MUST BE AT LEAST THE THIRD CALL TO THIS SUBR.)}
   4918 C     IOPENED  - INDICATOR AS TO WHETHER INPUT FILE HAS ALREADY
   4919 C              - BEEN OPENED BY SUBROUTINE W3UNPKB7 IN THIS PROGRAM
   4920 C              - (AND SOME REPORTS HAVE BEEN READ BY W3UNPKB7) (=0 -
   4921 C              - HAS NOT ALREADY BEEN OPENED; =1 - HAS ALREADY BEEN

Page 105         Source Listing                  PREP
2017-04-18 11:09                                 prepdata.f

   4922 C              - OPENED)
   4923 C     DSNAME   - CHARACTER*8 DATA SET NAME (IF IOPENED IS INPUT AS
   4924 C              - 0, THEN DSNAME IS NOT READ AND CAN BE INPUT AS
   4925 C              - 'ZZZZZZZZ')
   4926 C     IDSDAT   - CENTER TIME FOR DUMP DATA SET IN FORM YYYYMMDDHH (IF
   4927 C              - IOPENED IS INPUT AS 0, THEN IDSDAT IS NOT READ AND
   4928 C              - CAN BE INPUT AS ZERO)
   4929 C     IDSDMP_8 - INTEGER*8 DUMP TIME FOR DUMP DATA SET IN FORM
   4930 C              - YYYYMMDDHHMM (IF IOPENED IS INPUT AS 0, THEN IDSDMP_8
   4931 C              - IS NOT READ AND CAN BE INPUT AS ZERO)
   4932 C
   4933 C   OUTPUT ARGUMENT LIST:
   4934 C     IFLAG    - SWITCH {=1 - OLD DATA SET BUT ONLY DATA SET INFO
   4935 C              - RETURNED TO THIS POINT (I.E., THIS MUST BE FIRST CALL
   4936 C              - TO THIS SUBR.); =2 - OLD DATA SET WITH VALID DATA
   4937 C              - READ TO THIS POINT (I.E., THIS MUST BE AT LEAST THE
   4938 C              - SECOND CALL TO THIS SUBR.)}
   4939 C     CYCLET   - CYCLE TIME (IN HOURS UTC)
   4940 C
   4941 C   OUTPUT FILES:
   4942 C     UNIT 06  - STANDARD OUTPUT PRINT
   4943 C
   4944 C REMARKS: SUBROUTINE AND ENTRY BOTH CALLED BY SUBROUTINES 'PREP',
   4945 C    'SFCDTA' AND 'GETSMI'.  ENTRY ONLY CALLED BY SUBROUTINES 'SATEDS',
   4946 C    'SATBFR', 'GOESDG' AND 'GETSCATT'.
   4947 C
   4948 C ATTRIBUTES:
   4949 C   LANGUAGE: FORTRAN 90
   4950 C   MACHINE:  NCEP WCOSS
   4951 C
   4952 C$$$
   4953       SUBROUTINE UNPREPBF(IFLAG,CYCLET,IOPENED,DSNAME,IDSDAT,IDSDMP_8,*)
   4954       PARAMETER (MXWRDH = 15)
   4955       PARAMETER (MXBLVL = 255)
   4956       PARAMETER (MAXOBS = 3500)
   4957       PARAMETER (NUMOBS2 = 43)
   4958       CHARACTER*8   STNID,CRES1,CRES2,DSNAME,SUBSET_d
   4959       CHARACTER*11  CBULL
   4960       INTEGER  IDATA(MAXOBS),MDATE(4)
   4961       INTEGER(8) IDSDMP_8
   4962       REAL(8)  BMISS,obs8_8,alon_8,alat_8
   4963       COMMON/ADP/ISATOB,PMAND(23),RDATA(MAXOBS),IPRINT
   4964       COMMON/UNITNO/NFILE,IUNIT(28)
   4965       COMMON/GRID/IGRD,JGRD,POLA,NORTH,ALONVT,POLEI,POLEJ,XMESHL,YNLIM,
   4966      $ YSLIM
   4967       COMMON/DATA/KOUNT,IDATE(4),IDAT10,MP_PROCESS,WRMISS
   4968       COMMON/RPTHDR/SUBSET_d,STNID,HDR(2:MXWRDH),alon_8,alat_8
   4969       COMMON/XTRHD2/CRES1,CRES2,CBULL
   4970       COMMON/SKPSUB/SUBSKP(0:255,0:200)
   4971       COMMON/DIRECT/OBS3(5,MXBLVL,7),OBS2(NUMOBS2),NOBS3(7),RDATA2(25),
   4972      $ obs8_8(2)
   4973       COMMON /BUFRLIB_MISSING/BMISS
   4974       EQUIVALENCE  (RDATA,IDATA)
   4975       DATA  YMISS/99998.8/
   4976 
   4977       IER = 0
   4978       IF(IFLAG.EQ.0)  THEN

Page 106         Source Listing                  UNPREPBF
2017-04-18 11:09                                 prepdata.f

   4979          IF(IOPENED.EQ.1)  THEN
   4980             IER = -1
   4981             PRINT 892, NFILE
   4982   892 FORMAT(/'IW3UNPBF WILL NOW UNPACK REPORTS FROM A FILE (UNIT',I3,
   4983      $ ') WHICH HAS ALREADY BEEN OPENED BY SUBROUTINE W3UNPKB7'/)
   4984          END IF
   4985       END IF
   4986 
   4987 C CALL IW3UNPBF TO UNPACK AND READ FROM DATA SET --> RDATA, STNID,
   4988 C  CRES1, CRES2, CBULL, OBS2, OBS3, NOBS3 and obs8_8 HOLD RETURNED
   4989 C  REPORT IN SPECIFIED UNPACKED FORMAT {UNLESS FIRST CALL WHICH SHOULD
   4990 C  RETURN JUST THE DATA SET INFO (DSNAME, IDSDAT AND IDSDMP_8)}
   4991       OBS2   = BMISS  ! initialize obs2   array before reading any rpts
   4992       OBS3   = BMISS  ! initialize obs3   array before reading any rpts
   4993       NOBS3  = 0      ! initialize nobs3  array before reading any rpts
   4994       obs8_8 = bmiss  ! initialize obs8_8 array before reading any rpts
   4995       RDATA2 = BMISS  ! initialize rdata2 array before reading any rpts
   4996       IF(IW3UNPBF(NFILE,RDATA,STNID,CRES1,CRES2,CBULL,OBS2,OBS3,NOBS3,
   4997      $ obs8_8,DSNAME,IDSDAT,IDSDMP_8,SUBSET_d,SUBSKP,IER).EQ.0) GO TO 50
   4998    78 CONTINUE
   4999 C-----------------------------------------------------------------------
   5000       IF(IER.EQ.1)  THEN
   5001 C COME HERE IF FIRST CALL AND DATA SET INFORMATION RETURNED IN DSNAME,
   5002 C  IDSDAT AND IDSDMP_8
   5003          IFLAG = 1
   5004          PRINT 102, DSNAME,NFILE
   5005   102    FORMAT(//46X,'*****  ',A8,'  --  UNIT =',I3,'  *****')
   5006 C SPLIT CENTER DATE INTO COMPONENTS (MDATE)
   5007          MDATE(1) = IDSDAT/1000000
   5008          MDATE(2) = MOD((IDSDAT/10000),100)
   5009          MDATE(3) = MOD((IDSDAT/100),100)
   5010          MDATE(4) = MOD(IDSDAT,100)
   5011          PRINT 101, DSNAME,MDATE,IDSDMP_8
   5012   101    FORMAT(/19X,'DATASET NAME: ',A8,'  --  DATE: ',I4.4,2('-',
   5013      $    I2.2),1X,I2.2,'Z  -- DUMP DATE (I12 FORMAT): ',I12.12/)
   5014 C DOES DATE FROM DATA SET MATCH NCEP PRODUCTION DATE?
   5015          IF(IDSDAT.NE.IDAT10)  THEN
   5016             PRINT 324
   5017   324 FORMAT(/13X,'>>>>>   P R O B L E M :   D A T E   D O E S   N O T',
   5018      $ '   M A T C H   P R O D U C T I O N   D A T E   <<<<<'/)
   5019             RETURN 1
   5020          END IF
   5021 C CYCLET IS TIME THE DATA IS CENTERED ON (CYCLE TIME)
   5022          CYCLET = IDATE(4)
   5023          IF(IOPENED.EQ.1)  THEN
   5024             IOPENED = 0
   5025             IER = 0
   5026             GO TO 50
   5027          END IF
   5028          RETURN
   5029 C-----------------------------------------------------------------------
   5030       ELSE  IF(IER.EQ.2.OR.IER.EQ.3)  THEN
   5031 C COME HERE IF ALL REPORTS HAVE BEEN PROCESSED FOR THIS DATA SET
   5032          IF(IFLAG.LE.0)  THEN
   5033             PRINT 8003, NFILE
   5034  8003       FORMAT(/' *** ERROR RETURNING DATA SET INFORMATION IN ',
   5035      $       'FIRST CALL TO FILE IN UNIT ',I3,' -- THIS MAY BE A NULL',

Page 107         Source Listing                  UNPREPBF
2017-04-18 11:09                                 prepdata.f

   5036      $       ' FILE -- GO TO NEXT FILE'/)
   5037          ELSE  IF(IFLAG.EQ.1)  THEN
   5038             PRINT 8002
   5039  8002    FORMAT(/' * * NO REPORTS CURRENTLY PRESENT IN THIS DATA FILE,',
   5040      $    ' GO TO NEXT FILE'/)
   5041          END IF
   5042          RETURN 1
   5043 C-----------------------------------------------------------------------
   5044       ELSE
   5045 C COME HERE IF A PROBLEM OCCURRED IN RETURNING A REPORT
   5046 C   -- STOP 39 (THIS SHOULD BE THE RESULT OF AN IER=999 RETURNED HERE)
   5047          PRINT 8013
   5048  8013    FORMAT(/5X,'###### IER FROM IW3UNPBF = 999 -- STOP 39'/)
   5049       CALL W3TAGE('PREPOBS_PREPDATA')
   5050       CALL ERREXIT(39)
   5051       END IF
   5052 C-----------------------------------------------------------------------
   5053    50 CONTINUE
   5054       IF(IOPENED.EQ.1)  THEN
   5055          IER = 1
   5056          GO TO 78
   5057       END IF
   5058 C COME HERE IF REPORT HAS BEEN SUCCESSFULLY RETURNED IN SPECIFIED FORMAT
   5059       IFLAG = 2
   5060       IF(NFILE.EQ.IUNIT(5)+2)  THEN
   5061 C CAN NOW FILL IN COMPLETE CARRIER ID FOR CERTAIN AIRCRAFT REPORTS
   5062          IF(STNID(1:2).EQ.'UA'.AND.STNID(3:3).NE.'L')  THEN
   5063             STNID = STNID(1:2)//'L'//STNID(3:7)
   5064          ELSE  IF((STNID(1:2).EQ.'AL'.AND.STNID(3:3).NE.'L')
   5065      $        .OR.(STNID(1:2).EQ.'DL'.AND.STNID(3:3).NE.'H'))  THEN
   5066             STNID = STNID(1:1)//'A'//STNID(2:7)
   5067          END IF
   5068       END IF
   5069       RETURN
   5070            ENTRY CHKREP(KSMSG,KSBDY,*)
   5071 C SKIP REPORTS WITH MISSING OR UNREASONABLE LAT/LON (BUT KEEP COUNT)
   5072       IF(NINT(RDATA(1)*100.).GT.9000.OR.NINT(RDATA(1)*100.).LT.-9000.OR.
   5073      $ NINT(RDATA(2)*100.).GT.36000.OR.NINT(RDATA(2)*100.).LT.0)  THEN
   5074          IF(MAX(RDATA(1),RDATA(2)).GT.YMISS)  THEN
   5075             PRINT 953
   5076   953 FORMAT(' * * TOTAL REPORT TOSSED  -ID=????????, LAT=???????N, ',
   5077      $ 'LON=????????E, RTYP ??? - LAT AND LON MISSING')
   5078          ELSE
   5079             PRINT 954
   5080   954 FORMAT(' * * TOTAL REPORT TOSSED  -ID=????????, LAT=???????N, ',
   5081      $ 'LON=????????E, RTYP ??? - LAT AND LON UNREASONABLE')
   5082          END IF
   5083          KSMSG = KSMSG + 1
   5084          RETURN 1
   5085       END IF
   5086       WLON = 360. - RDATA(2)
   5087       IF(NINT(WLON*100.).EQ.36000)  WLON = 0.
   5088       IF(IDATA(9).EQ.41)  RETURN
   5089 C FOR ALL TYPES EXCEPT ACFT (ALL TYPES), CHECK TO SEE IF RPT W/I LAT/LON
   5090 C  LIMIT OF DATA SEARCH AREA; SKIP RPTS O-SIDE THE LIMIT(BUT KEEP COUNT)
   5091       IF(NINT(RDATA(1)*100.).LT.NINT(YSLIM*100.).OR.
   5092      $   NINT(RDATA(1)*100.).GT.NINT(YNLIM*100.))  THEN

Page 108         Source Listing                  UNPREPBF
2017-04-18 11:09                                 prepdata.f

   5093 CCCCC    PRINT 952, STNID,RDATA(1),RDATA(2),IDATA(9)
   5094 CC952 FORMAT(' * * TOTAL REPORT TOSSED  -ID=',A8,', LAT=',F7.2,'N, ',
   5095 CCCCC$ 'LON=',F8.2,'E, RTYP',I4,' - OUTSIDE SEARCH AREA ')
   5096          KSBDY = KSBDY + 1
   5097          RETURN 1
   5098       END IF
   5099       CALL LL2IJ(RDATA(1),WLON,XI,YJ)
   5100       IF(XI.LT.1..OR.YJ.LT.1..OR.XI.GT.REAL(IGRD).OR.YJ.GT.REAL(JGRD))
   5101      $ THEN
   5102          KSBDY = KSBDY + 1
   5103          RETURN 1
   5104       END IF
   5105       RETURN
   5106       END


ENTRY POINTS

  Name                    Name                 
                                               
 chkrep_                 unprepbf_             


SYMBOL CROSS REFERENCE

 Name                       Object Declared Type            Bytes Dimen Elements Attributes       References                        
                                                                                                                                    
 101                        Label  5012                                                           5011                              
 102                        Label  5005                                                           5004                              
 324                        Label  5017                                                           5016                              
 50                         Label  5053                                                           4997,5026                         
 78                         Label  4998                                                           5056                              
 8002                       Label  5039                                                           5038                              
 8003                       Label  5034                                                           5033                              
 8013                       Label  5048                                                           5047                              
 892                        Label  4982                                                           4981                              
 953                        Label  5076                                                           5075                              
 954                        Label  5080                                                           5079                              
 ADP                        Common 4963                                 14100                                                       
 ALAT_8                     Scalar 4962     R(8)            8           scalar   COM                                                
 ALONVT                     Scalar 4965     R(4)            4           scalar   COM                                                
 ALON_8                     Scalar 4962     R(8)            8           scalar   COM                                                
 BMISS                      Scalar 4962     R(8)            8           scalar   COM              4991,4992,4994,4995               
 BUFRLIB_MISSING            Common 4973                                 8                                                           
 CBULL                      Scalar 4959     CHAR            11          scalar   COM              4996                              
 CHKREP                     Subr   5070                                                                                             
 CRES1                      Scalar 4958     CHAR            8           scalar   COM              4996                              
 CRES2                      Scalar 4958     CHAR            8           scalar   COM              4996                              
 CYCLET                     Dummy  4953     R(4)            4           scalar   ARG,INOUT        5022                              
 DATA                       Common 4967                                 32                                                          
 DIRECT                     Common 4971                                 36016                                                       
 DSNAME                     Dummy  4953     CHAR            8           scalar   ARG,INOUT        4997,5004,5011                    
 ERREXIT                    Subr   5050                                                           5050                              
 GRID                       Common 4965                                 40                                                          
 HDR                        Scalar 4968     R(4)            4     1     14       COM                                                
 IDAT10                     Scalar 4967     I(4)            4           scalar   COM              5015                              
 IDATA                      Scalar 4960     I(4)            4     1     3500     COM              5088                              

Page 109         Source Listing                  UNPREPBF
2017-04-18 11:09 Symbol Table                    prepdata.f

 Name                       Object Declared Type            Bytes Dimen Elements Attributes       References                        
                                                                                                                                    
 IDATE                      Scalar 4967     I(4)            4     1     4        COM              5022                              
 IDSDAT                     Dummy  4953     I(4)            4           scalar   ARG,INOUT        4997,5007,5008,5009,5010,5015     
 IDSDMP_8                   Dummy  4953     I(8)            8           scalar   ARG,INOUT        4997,5011                         
 IER                        Local  4977     I(4)            4           scalar                    4977,4980,4997,5000,5025,5030,5055
 IFLAG                      Dummy  4953     I(4)            4           scalar   ARG,INOUT        4978,5003,5032,5037,5059          
 IGRD                       Scalar 4965     I(4)            4           scalar   COM              5100                              
 IOPENED                    Dummy  4953     I(4)            4           scalar   ARG,INOUT        4979,5023,5024,5054               
 IPRINT                     Scalar 4963     I(4)            4           scalar   COM                                                
 ISATOB                     Scalar 4963     I(4)            4           scalar   COM                                                
 IUNIT                      Scalar 4964     I(4)            4     1     28       COM              5060                              
 IW3UNPBF                   Func   4996     I(4)            4           scalar                    4996                              
 JGRD                       Scalar 4965     I(4)            4           scalar   COM              5100                              
 KOUNT                      Scalar 4967     I(4)            4           scalar   COM                                                
 KSBDY                      Dummy  5070     I(4)            4           scalar   ARG,INOUT        5096,5102                         
 KSMSG                      Dummy  5070     I(4)            4           scalar   ARG,INOUT        5083                              
 LL2IJ                      Subr   5099                                                           5099                              
 MAX                        Func   5074                                 scalar                    5074                              
 MAXOBS                     Param  4956     I(4)            4           scalar                    4960,4963                         
 MDATE                      Local  4960     I(4)            4     1     4                         5007,5008,5009,5010,5011          
 MOD                        Func   5008                                 scalar                    5008,5009,5010                    
 MP_PROCESS                 Scalar 4967     I(4)            4           scalar   COM                                                
 MXBLVL                     Param  4955     I(4)            4           scalar                    4971                              
 MXWRDH                     Param  4954     I(4)            4           scalar                    4968                              
 NFILE                      Scalar 4964     I(4)            4           scalar   COM              4981,4996,5004,5033,5060          
 NINT                       Func   5072                                 scalar                    5072,5073,5087,5091,5092          
 NOBS3                      Scalar 4971     I(4)            4     1     7        COM              4993,4996                         
 NORTH                      Scalar 4965     I(4)            4           scalar   COM                                                
 NUMOBS2                    Param  4957     I(4)            4           scalar                    4971                              
 OBS2                       Scalar 4971     R(4)            4     1     43       COM              4991,4996                         
 OBS3                       Scalar 4971     R(4)            4     3     8925     COM              4992,4996                         
 OBS8_8                     Scalar 4962     R(8)            8     1     2        COM              4994,4997                         
 PMAND                      Scalar 4963     R(4)            4     1     23       COM                                                
 POLA                       Scalar 4965     R(4)            4           scalar   COM                                                
 POLEI                      Scalar 4965     R(4)            4           scalar   COM                                                
 POLEJ                      Scalar 4965     R(4)            4           scalar   COM                                                
 RDATA                      Scalar 4963     R(4)            4     1     3500     COM              4996,5072,5073,5074,5086,5091,5092
                                                                                                  ,5099                             
 RDATA2                     Scalar 4971     R(4)            4     1     25       COM              4995                              
 REAL                       Func   5100                                 scalar                    5100                              
 RPTHDR                     Common 4968                                 88                                                          
 SKPSUB                     Common 4970                                 205824                                                      
 STNID                      Scalar 4958     CHAR            8           scalar   COM              4996,5062,5063,5064,5065,5066     
 SUBSET_D                   Scalar 4958     CHAR            8           scalar   COM              4997                              
 SUBSKP                     Scalar 4970     R(4)            4     2     51456    COM              4997                              
 UNITNO                     Common 4964                                 116                                                         
 UNPREPBF                   Subr   4953                                                                                             
 W3TAGE                     Subr   5049                                                           5049                              
 WLON                       Local  5086     R(4)            4           scalar                    5086,5087,5099                    
 WRMISS                     Scalar 4967     R(4)            4           scalar   COM                                                
 XI                         Local  5099     R(4)            4           scalar                    5099,5100                         
 XMESHL                     Scalar 4965     R(4)            4           scalar   COM                                                
 XTRHD2                     Common 4969                                 27                                                          
 YJ                         Local  5099     R(4)            4           scalar                    5099,5100                         
 YMISS                      Local  4975     R(4)            4           scalar                    4975,5074                         
 YNLIM                      Scalar 4965     R(4)            4           scalar   COM              5092                              

Page 110         Source Listing                  UNPREPBF
2017-04-18 11:09 Symbol Table                    prepdata.f

 Name                       Object Declared Type            Bytes Dimen Elements Attributes       References                        
                                                                                                                                    
 YSLIM                      Scalar 4966     R(4)            4           scalar   COM              5091                              

Page 111         Source Listing                  UNPREPBF
2017-04-18 11:09                                 prepdata.f

   5107 C$$$  SUBPROGRAM DOCUMENTATION BLOCK
   5108 C
   5109 C SUBPROGRAM:    LL2IJ
   5110 C   PRGMMR: D. A. KEYSER     ORG: W/NMC22    DATE: 1990-01-11
   5111 C
   5112 C ABSTRACT: CONVERTS A REPORT'S LATITUDE/LONGITUDE TO GRID POINT
   5113 C   SPACE VIA A LINEAR COORDINATE TRANSFORMATION WITHIN THE DATA
   5114 C   SEARCH REGION INITIALLY SET UP IN NAMELIST 'RGRID' AND
   5115 C   PASSED VIA COMMON BLOCK /GRID/.
   5116 C
   5117 C PROGRAM HISTORY LOG:
   5118 C   UNKNOWN
   5119 C 1988-04-11  D. A. KEYSER -- DOCBLOCKED/COMMENTED
   5120 C 1990-01-11  D. A. KEYSER -- CONVERTED TO VS FORTRAN(77) & RESTRUCTURED
   5121 C
   5122 C USAGE:    CALL LL2IJ(YLAT,WLON,XI,YJ)
   5123 C   INPUT ARGUMENT LIST:
   5124 C     YLAT      - LATITUDE OF DATA REPORT  (NORTH +, SOUTH -)
   5125 C     WLON      - LONGITUDE OF DATA REPORT (0.0-359.99 DEG. W)
   5126 C
   5127 C   OUTPUT ARGUMENT LIST:
   5128 C     XI       - I-COORDINATE OF REPORT IN GRID PT. SPACE
   5129 C     YJ       - J-COORDINATE OF REPORT IN GRID PT. SPACE
   5130 C
   5131 C REMARKS: CALLED BY SUBROUTINE 'CHKREP'.  SEARCH GRID DEFINES AREA
   5132 C    FOR DATA EXTRACTION, ALL DATA OUTSIDE SEARCH GRID ARE EXCLUDED
   5133 C    {NO. OF GRID POINTS IN X & Y DIRECTION DEFINED BY IGRD AND JGRD
   5134 C    (DEF = 73,37)}
   5135 C
   5136 C ATTRIBUTES:
   5137 C   LANGUAGE: FORTRAN 90
   5138 C   MACHINE:  NCEP WCOSS
   5139 C
   5140 C$$$
   5141       SUBROUTINE LL2IJ(YLAT,WLON,XI,YJ)
   5142       LOGICAL  POLA,NORTH
   5143       COMMON/GRID/IGRD,JGRD,POLA,NORTH,ALONVT,POLEI,POLEJ,XMESHL,YNLIM,
   5144      $ YSLIM
   5145       EQUIVALENCE(YLATS,ALONVT),(DLAT,POLEI),(XLONW,POLEJ),(DLON,XMESHL)
   5146       DATA  CONV2R/0.017453293/,EARTHR/6371.2/
   5147       IF(.NOT.POLA)  THEN
   5148 C GRID IS LAT/LONG (I.E., MERCATOR)
   5149          YJ = (((NINT(YLAT*100.) - NINT(YLATS*100.))/NINT(DLAT*100.)) +
   5150      $    100)/100
   5151          XI = (((NINT(XLONW*100.) - NINT(WLON*100.))/NINT(DLON*100.)) +
   5152      $    100)/100
   5153 C IF XI < 0, POSSIBLE THAT GREENWICH HAS BEEN CROSSED, ADD 360. TO XLONW
   5154          IF(XI.LT.0.0)  XI = ((((NINT(XLONW*100.) + 36000) -
   5155      $    NINT(WLON*100.))/NINT(DLON*100.)) + 100)/100
   5156 C WLON CAN NEVER BE LESS THAN ZERO, NEXT LINE NEVER SATISFIED
   5157          IF(NINT(WLON*100.).LT.0)  XI = (((NINT(XLONW*100.) - (36000 +
   5158      $    NINT(WLON*100.)))/NINT(DLON*100.)) + 100)/100
   5159          RETURN
   5160       ELSE
   5161 C GRID IS POLAR STEREOGRAPHIC
   5162          RE = (EARTHR * 1.86603)/XMESHL
   5163          ALAT = YLAT * CONV2R

Page 112         Source Listing                  LL2IJ
2017-04-18 11:09                                 prepdata.f

   5164          IF(.NOT.NORTH)  THEN
   5165             ALAT = -ALAT
   5166             ALONG = (180. - WLON + ALONVT) * CONV2R
   5167          ELSE
   5168             ALONG = (WLON + 180. - ALONVT) * CONV2R
   5169          END IF
   5170          R = (RE * COS(ALAT))/(1.0 + SIN(ALAT))
   5171          XI = POLEI + (R * SIN(ALONG)) + 0.00000005
   5172          YJ = POLEJ + (R * COS(ALONG)) + 0.00000005
   5173       END IF
   5174       RETURN
   5175       END


ENTRY POINTS

  Name              
                    
 ll2ij_             


SYMBOL CROSS REFERENCE

 Name                       Object Declared Type            Bytes Dimen Elements Attributes       References                        
                                                                                                                                    
 ALAT                       Local  5163     R(4)            4           scalar                    5163,5165,5170                    
 ALONG                      Local  5166     R(4)            4           scalar                    5166,5168,5171,5172               
 ALONVT                     Scalar 5143     R(4)            4           scalar   COM              5166,5168                         
 CONV2R                     Local  5146     R(4)            4           scalar                    5146,5163,5166,5168               
 COS                        Func   5170                                 scalar                    5170,5172                         
 DLAT                       Scalar 5145     R(4)            4           scalar   COM              5149                              
 DLON                       Scalar 5145     R(4)            4           scalar   COM              5151,5155,5158                    
 EARTHR                     Local  5146     R(4)            4           scalar                    5146,5162                         
 GRID                       Common 5143                                 40                                                          
 IGRD                       Scalar 5143     I(4)            4           scalar   COM                                                
 JGRD                       Scalar 5143     I(4)            4           scalar   COM                                                
 LL2IJ                      Subr   5141                                                                                             
 NINT                       Func   5149                                 scalar                    5149,5151,5154,5155,5157,5158     
 NORTH                      Scalar 5142     L(4)            4           scalar   COM              5164                              
 POLA                       Scalar 5142     L(4)            4           scalar   COM              5147                              
 POLEI                      Scalar 5143     R(4)            4           scalar   COM              5171                              
 POLEJ                      Scalar 5143     R(4)            4           scalar   COM              5172                              
 R                          Local  5170     R(4)            4           scalar                    5170,5171,5172                    
 RE                         Local  5162     R(4)            4           scalar                    5162,5170                         
 SIN                        Func   5170                                 scalar                    5170,5171                         
 WLON                       Dummy  5141     R(4)            4           scalar   ARG,INOUT        5151,5155,5157,5158,5166,5168     
 XI                         Dummy  5141     R(4)            4           scalar   ARG,INOUT        5151,5154,5157,5171               
 XLONW                      Scalar 5145     R(4)            4           scalar   COM              5151,5154,5157                    
 XMESHL                     Scalar 5143     R(4)            4           scalar   COM              5162                              
 YJ                         Dummy  5141     R(4)            4           scalar   ARG,INOUT        5149,5172                         
 YLAT                       Dummy  5141     R(4)            4           scalar   ARG,INOUT        5149,5163                         
 YLATS                      Scalar 5145     R(4)            4           scalar   COM              5149                              
 YNLIM                      Scalar 5143     R(4)            4           scalar   COM                                                
 YSLIM                      Scalar 5144     R(4)            4           scalar   COM                                                

Page 113         Source Listing                  LL2IJ
2017-04-18 11:09                                 prepdata.f

   5176 C$$$  SUBPROGRAM DOCUMENTATION BLOCK
   5177 C
   5178 C SUBPROGRAM:    RPTLBL
   5179 C   PRGMMR: Keyser           ORG: NP22       DATE: 2016-11-30
   5180 C
   5181 C ABSTRACT: FOR ALL REPORT TYPES, STORES WORDS 4 (REPORT D-TIME), 5
   5182 C   (RECEIPT TIME), 7 (DUMP REPORT TYPE), 9 (INSTRUMENT TYPE), 10
   5183 C   (ELEVATION), 11 (SEQUENCE NUMBER), 12 (ADPUPA REPORT SOLAR AND
   5184 C   INFRARED RADIATION CORRECTION INDICATOR), 13 (REPORTED OBS. TIME),
   5185 C   14 (CORRECTION INDICATOR FOR OBS. TIME USED IN REPORT D-TIME
   5186 C   CALCULATION), AND 15 (SATELLITE ID) INTO THE REPORT HEADER ARRAY
   5187 C   "HDR".  ALSO STORES LATITUDE AND LONGITUDE INTO ALAT_8 AND ALON_8.
   5188 C   THE STATION ID (IN WORD 1 OF HDR), PREPBUFR REPORT TYPE (WORD 6) AND
   5189 C   REPORT SUBTYPE (WORD 8) ARE ALL STORED ELSEWHERE.
   5190 C
   5191 C PROGRAM HISTORY LOG:
   5192 C 1990-01-17  D. A. KEYSER (W/NMC22)
   5193 C 1992-09-08  D. A. KEYSER -- REMOVED WRITING OF STATION ID INTO WORDS
   5194 C    3-5, THIS IS NOW DONE IN SUBROUTINE FILLX
   5195 C 1993-11-02  D. A. KEYSER -- WILL STORE ON29 R.TYPE AND INSTR. TYPE IN
   5196 C    WORDS 9 & 10 OF OUTPUT RPT HDR, RESP. AND ENCODED IN PREPBUFR
   5197 C 1994-08-11  D. A. KEYSER -- WILL STORE ELEV. AND REPORT SEQ. NUMBER
   5198 C    IN REPORT HEADER (CURRENTLY ONLY MDCRS STORE SEQ. NO. IN THIS
   5199 C    SUBR.); MACHINE CHARACTER TYPE NOW USED FOR ASCII/EBCDIC
   5200 C    CONVERSION TEST RATHER THAN 'LW' VALUE
   5201 C 1998-02-17  D. A. KEYSER -- RCPT. TIME NOW STORED IN WORD 5 OF HDR;
   5202 C    ONLY IDATA(8) NOW USED TO GET RPT. INSTR. TYPE
   5203 C 1998-06-15  D. A. KEYSER -- READS SOLAR & IR RAD. CORRECTION
   5204 C    INDICATOR FROM CAT. 8 C.F. 353 (LATER ENCODED INTO PREPBUFR FILE)
   5205 C 2000-02-17  D. A. KEYSER -- LAUNCH TIME NOW READ FROM CAT. 8 CODE
   5206 C    FIG. 104 IN ORDER TO ASSIGN A BASE TIME TO FIRST DATA LEVEL;
   5207 C    LAUNCH TIME USED TO "CORRECT" OBS. TIME FOR ADPUPA RPTS IN "DHR";
   5208 C    STORE VALUES LATER ENCODED INTO PREPBUFR FILE WITH MNEMONICS "RPT"
   5209 C    (ORIG. OBS. TIME) AND "TCOR" (IND. FOR CORRECTED OBS. TIME IN"DHR")
   5210 C 2001-04-06  D. A. KEYSER -- FOR ALL SATELLITE TYPES EXCEPT SSM/I
   5211 C     SUPEROBED PRODUCTS, NOW READS SATELLITE ID FROM WORD 6 OF HEADER
   5212 C     RETURNED FROM BOTH SUBR. IW3UNPBF AND W3UNPB7; NOW HAS INPUT
   5213 C     ARGS. "TIMWIN_e" (EARLIEST TIME WINDOW) AND "TIMWIN_l" (LATEST
   5214 C     TIME WINDOW) REPL. "TIMWIN" (+/- TIME WINDOW) ("-" PRIOR TO CYCLE
   5215 C     TIME, "+" AFTER CYCLE TIME), ALLOWS THE 2 TO BE DIFFERENT;
   5216 C     PROFILERS COMING IN DISGUISED AS PIBALS (DETERMINED BY STNID) IN
   5217 C     THE "ADPUPA" FILE ARE NO LONGER SUBJECT TO POSSIBLE REPORT TIME
   5218 C     ALTERATION AND LAUNCH TIME CALC. (THIS WAS AN OVERSIGHT IN LAST
   5219 C     IMPL. WHICH GAVE THEM R.T. 223 - THE POINT WILL SOON BE MUTE IN
   5220 C     PRODUCTION SINCE THESE WILL BE IN "PROFLR" FILE, BUT STILL NEEDED
   5221 C     FOR HISTORICAL RERUNS); PRINTS THE 4 MDCRS TURBULENCE INDECES
   5222 C 2001-06-19  D. A. KEYSER -- NEW SUBR. "TIMCHK" DOES TIME WINDOW CHECK
   5223 C     SEPARATE FROM THIS SUBR.
   5224 C 2004-09-09  D. A. KEYSER -- ADDED PROCESSING OF NPN AND CAP RASS DATA
   5225 C     READ FROM "RASSDA" DUMP FILE IN NEW DATA LVL CAT. 15, DUMP R.
   5226 C     TYPE 77, GET PREPBUFR R. TYPE 126, PROCESSED INTO PREPBUFR FILE
   5227 C     UNDER NEW TBL A ENTRY "RASSDA"; INITIALIZES INSTRUMENT TYPE AS
   5228 C     MISSING INSTEAD OF "99"
   5229 C 2008-04-10  D. A. KEYSER -- CAN HANDLE RADIOSONDE TYPES > 99 WHICH
   5230 C     WILL SOON BE INTRODUCED INTO THE BUFR DATABASE (BASED ON NOVEMBER
   5231 C     2007 WMO BUFR UPDATE)
   5232 C 2012-11-27  D. A. KEYSER -- INCREASED MAXIMUM POSSIBLE VALUE FOR SQN

Page 114         Source Listing                  LL2IJ
2017-04-18 11:09                                 prepdata.f

   5233 C     (SEQUENCE NUMBER) ENCODED INTO PREPBUFR FILE FROM 99998 TO 524286
   5234 C     (NEEDED BECAUSE THERE CAN NOW BE > 99998 MDCRS REPORTS IN A
   5235 C     MONOLITHIC "AIRCAR" DUMP FILE - THIS CAUSES PREPACQC TO FAIL IN
   5236 C     SERIAL PREPBUFR PROCESSING RUNS, E.G. IN SDMEDIT)
   5237 C 2015-03-11  D. A. Keyser -- SQN (sequence number) now initialized as
   5238 C     999990 instead of 99999.
   5239 C 2015-04-08  D. A. Keyser -- Encodes new, unique report subtype (TSB)
   5240 C     values into PREPBUFR file for AIRCAR types based on WMO bulletin
   5241 C     header/originator (1-U.S. MDCRS, 2-Mexican MDCRS, 3-ADS-C MDCRS,
   5242 C     99-default/unknown)
   5243 C 2016-11-30  D. A. Keyser --
   5244 C      - Carries double-precision latitude and longitude for each report
   5245 C        through code as R*8 variables ALAT_8 and ALON_8 obtained from
   5246 C        new R*8 array OBS8_8(1:2) read directly out of IW3UNPBF or
   5247 C        W3UNPKB7.  Replaces machine precision lat/lon stored in
   5248 C        HDR(2:3) (normally R*4). {Values in ALAT_8 and ALON_8 obtained
   5249 C        from HDR(2:3) only in rare event that OBS8_8(1:2) are
   5250 C        missing.}.
   5251 C
   5252 C USAGE:    CALL RPTLBL(CYCLET)
   5253 C   INPUT ARGUMENT LIST:
   5254 C     CYCLET   - CYCLE TIME (IN HOUR UTC) USED FOR TIME CHECKING A
   5255 C              - REPORT (REAL NUMBER PRECISION)
   5256 C
   5257 C   OUTPUT FILES:
   5258 C     UNIT 06  - STANDARD OUTPUT PRINT
   5259 C
   5260 C REMARKS: CALLED BY SUBROUTINES 'PREP', 'GETC06', 'SATEDS',
   5261 C     'SATBFR', 'GOESDG', 'SFCDTA', 'GETSMI' AND 'GETSCATT'.
   5262 C
   5263 C ATTRIBUTES:
   5264 C   LANGUAGE: FORTRAN 90
   5265 C   MACHINE:  NCEP WCOSS
   5266 C
   5267 C$$$
   5268       SUBROUTINE RPTLBL(CYCLET)
   5269       PARAMETER (MXWRDH = 15)
   5270       PARAMETER (MAXOBS = 3500)
   5271       parameter (mxblvl = 255)
   5272       parameter (numobs2 = 43)
   5273       CHARACTER*8  STNID,SUBSET_d,CRES1,CRES2
   5274       CHARACTER*11 CBULL
   5275       LOGICAL  PROFILERinADPUPA
   5276       INTEGER  IDATA(MAXOBS)
   5277       real(8)  bmiss,obs8_8,alon_8,alat_8
   5278       COMMON/DATA/KOUNT,IDATE(4),IDAT10,MP_PROCESS,WRMISS
   5279       COMMON/ADP/ISATOB,PMAND(23),RDATA(MAXOBS),IPRINT
   5280       COMMON/RPTHDR/SUBSET_d,STNID,HDR(2:MXWRDH),alon_8,alat_8
   5281       COMMON/UNITNO/NFILE,IUNIT(28)
   5282       COMMON/LAUNCH/ALNCH
   5283       COMMON/PFSWCH/PRFLER(4),PWINDO(4),PROFILERinADPUPA
   5284       COMMON/XTRHD2/CRES1,CRES2,CBULL
   5285       common/direct/obs3(5,mxblvl,7),obs2(numobs2),nobs3(7),rdata2(25),
   5286      $ obs8_8(2)
   5287       common /bufrlib_missing/bmiss
   5288       DATA  XMISS/99999./, YMISS/99998.8/,IMISS/99999/
   5289       EQUIVALENCE (RDATA,IDATA)

Page 115         Source Listing                  RPTLBL
2017-04-18 11:09                                 prepdata.f

   5290       HDR(2:MXWRDH) = XMISS
   5291       HDR(11) = XMISS*10.
   5292       ALNCH = XMISS
   5293       alon_8 = bmiss
   5294       alat_8 = bmiss
   5295 C LONGITUDE GOES IN ALON_8 (EAST, RANGE: 0. TO 359.99999)
   5296       HDR(2) = RDATA(2)
   5297 
   5298 C Important: According to BUFR Manual, longitude (0-06-001 or 0-06-002)
   5299 C            {represented here by obs8_8(2)} should be in units of
   5300 C            Degrees West - and East + (-180.0 to +180.0); however some
   5301 C            BUFR data sets (e.g., PREPBUFR) are known to encode
   5302 C            longitude in units of Degree East (0.0 to 359.99) --
   5303 C            convert to PREPBUFR convention regardless of which
   5304 C            convention is used coming in here
   5305 C if obs8_8(2) (r*8) non-missing store it into alon_8 (r*8), else store
   5306 C  hdr(2) {obtained from rdata(2)} into alon_8
   5307       if(obs8_8(2).lt.bmiss)  then
   5308          alon_8 = 360. - mod(720.-obs8_8(2),360.)
   5309          if(alon_8.eq.360.)  alon_8 = 0.0
   5310       else
   5311          alon_8 = hdr(2)
   5312       end if
   5313 C LATITUDE GOES IN ALAT_8 (N +, RANGE: -90. TO +90.)
   5314       HDR(3) = RDATA(1)
   5315 C if obs8_8(1) (r*8) non-missing store it into alat_8 (r*8), else store
   5316 C  hdr(3) {obtained from rdata(1)} into alat_8
   5317       if(obs8_8(1).lt.bmiss)  then
   5318          alat_8 = obs8_8(1)
   5319       else
   5320          alat_8 = hdr(3)
   5321       end if
   5322 C DUMP REPORT TYPE GOES IN HDR(7)
   5323       HDR(7)  = IDATA(9)
   5324 C REPORT SEQUENCE NUMBER GOES IN HDR(11) (ONLY CURRENTLY FOR MDCRS
   5325 C  AIRCRAFT REPORTS HERE)
   5326 C INSTRUMENT TYPE GOES IN HDR(9)
   5327       HDR(9) = IDATA(8)
   5328 C IF INSTRUMENT TYPE VALID, SOLAR AND INFRARED RADIATION CORRECTION
   5329 C  INDICATOR GOES IN HDR(12) (ONLY FOR ADPUPA REPORTS HERE)
   5330 C LAUNCH TIME IS READ FOR LATER USE IN THIS SUBR. (ONLY FOR ADPUPA
   5331 C  REPORTS HERE)
   5332       IF(NFILE.EQ.IUNIT(5))  THEN
   5333          IF(HDR(9).LT.IMISS)  THEN
   5334             IF(HDR(9).EQ.0.OR.(HDR(9).GE.2.AND.HDR(9).LE.6).OR.
   5335      $       HDR(9).EQ.8.OR.(HDR(9).GE.100.AND.HDR(9).LE.109).OR.
   5336      $       HDR(9).GE.112) PRINT 261, STNID,NINT(HDR(9))
   5337   261 FORMAT(2X,'* * *  STNID ',A8,' HAS AN UNRECOGNIZED INSTR. TYPE',
   5338      $ ' DESIGNATION (BUFR CODE ',I3.3,') - GO AHEAD & STORE IT'/)
   5339          END IF
   5340          IF(IDATA(27).GT.0)  THEN
   5341             L = IDATA(28) - 4
   5342             DO I = 1,IDATA(27)
   5343                L = L + 4
   5344                IF(NINT(RDATA(L+1)).EQ.353)  THEN
   5345 C CHECK FOR ADPUPA REPORT SOLAR AND INFRARED RADIATION CORRECTION
   5346 C  INDICATOR

Page 116         Source Listing                  RPTLBL
2017-04-18 11:09                                 prepdata.f

   5347                   IF(RDATA(L).LT.YMISS.AND.HDR(9).LT.IMISS)
   5348      $             HDR(12) = NINT(RDATA(L))
   5349                   CYCLE
   5350                ELSE  IF(NINT(RDATA(L+1)).EQ.104)  THEN
   5351 C CHECK FOR ADPUPA REPORT LAUNCH TIME
   5352                   IF(RDATA(L).LT.YMISS)  ALNCH = RDATA(L) * 0.01
   5353                   CYCLE
   5354                END IF
   5355             ENDDO
   5356          END IF
   5357       ELSE  IF(NFILE.EQ.IUNIT(5)+1)  THEN
   5358          IF(IDATA(27).GT.0)  THEN
   5359             L = IDATA(28) - 4
   5360             DO I = 1,IDATA(27)
   5361                L = L + 4
   5362                IF(NINT(RDATA(L+1)).EQ.21)  THEN
   5363 ccdak             IF(RDATA(L).LT.YMISS)  THEN
   5364                                        !SQN can now be > XMISS (99999.)
   5365                   IF(RDATA(L).LT.YMISS*10.)  THEN
   5366 C MDCRS REPORT SEQUENCE NUMBER FOUND
   5367                      HDR(11) = NINT(RDATA(L))
   5368                      GO TO 856
   5369                   END IF
   5370                END IF
   5371             ENDDO
   5372          END IF
   5373   856    CONTINUE
   5374 C DUMP REPORT SUBTYPE GOES IN HDR(8) (for MDCRS, based on WMO bulletin
   5375 C  header and originator)
   5376          HDR(8) = 99.    ! Unknown (default)
   5377          IF(CBULL.EQ.'IUAX02 KARP') THEN
   5378             HDR(8) = 1.  ! U.S. MDCRS
   5379          ELSE IF(CBULL.EQ.'IUAX01 MMMX') THEN
   5380             HDR(8) = 2.  ! Mexican MDCRS
   5381          ELSE IF(CBULL.EQ.'IUAX06 KARP') THEN
   5382             HDR(8) = 3.  ! ADS-C MDCRS
   5383          END IF
   5384       END IF
   5385 C RECEIPT TIME GOES IN HDR(5)
   5386       HDR(5) = RDATA(11)
   5387 C ELEVATION GOES IN HDR(10)
   5388       HDR(10) = NINT(RDATA(7))
   5389 C REPORTED OBSERVATION TIME GOES IN HDR(13)
   5390       HDR(13) = RDATA(4)
   5391 C CORRECTION INDICATOR FOR OBS. TIME USED IN REPORT D-TIME CALCULATION
   5392 C  GOES IN HDR(14) (INITIALIZED AS 0 - NOT CORRECTED)
   5393       HDR(14) = 0
   5394       IF(NFILE.EQ.IUNIT(5))  THEN
   5395 C WIND PROFILERS ORIG. IN PILOT (PIBAL) FORMAT BULLETINS WERE DECODED
   5396 C  AS PIBALS INTO THE "ADPUPA" DUMP FILE PRIOR TO 05/14/2001.  IF THIS
   5397 C  IS A HISTORICAL RERUN, THESE NEED TO BE IDENTIFIED SO THAT THEY ARE
   5398 C  TREATED AS PROFILERS AND ASSIGNED RTYPE 223 (WILL BE WRITTEN TO
   5399 C  "PROFLR" BUFR MESSAGES & PROCESSED BY THE SUBSEQUENT PROGRAM
   5400 C  PREPOBS_PROFCQC)
   5401          IF(IDAT10.GT.2001051415)  THEN
   5402             PROFILERinADPUPA = .FALSE.
   5403          ELSE

Page 117         Source Listing                  RPTLBL
2017-04-18 11:09                                 prepdata.f

   5404             PROFILERinADPUPA =     (STNID.EQ.'91492   '.OR.
   5405      $       STNID.EQ.'PSMAN   '.OR.STNID.EQ.'PSNAU   '.OR.
   5406      $       STNID.EQ.'91609   '.OR.STNID.EQ.'PSGAL   '.OR.
   5407      $       STNID.EQ.'PSPIU   '.OR.STNID.EQ.'03501')
   5408          END IF
   5409          IF(.NOT.PROFILERinADPUPA)  THEN
   5410             IF(MOD(NINT(RDATA(4))*100000,10000).EQ.0)  THEN
   5411 C FOR REPORTS IN ADPUPA FILE WITH REPORTED OBS. TIME ON THE HOUR ...
   5412                IF(ALNCH.LT.YMISS)  THEN
   5413 C . IF LAUNCH TIME IS NOT MISSING ...
   5414                   IF(INT(ALNCH).EQ.INT(RDATA(4)))  THEN
   5415 C ... IF LAUNCH HOUR SAME AS REPORTED OBS. TIME HOUR ...
   5416                      IF(MOD(ALNCH*100.,100.).LE.25.)  THEN
   5417 C     ... IF LAUNCH WAS BEFORE 15 MIN PAST HOUR, "CORRECT" OBS. TIME
   5418 C          BY ADDING 1/2 HOUR TO REPORTED VALUE
   5419                         RDATA(4) = INT(RDATA(4)) + 0.50
   5420                      ELSE
   5421 C     ... IF LAUNCH WAS LATER THAN 15 MIN PAST HOUR, "CORRECT" OBS. TIME
   5422 C          BY ADDING 1 HOUR TO REPORTED VALUE
   5423                         RDATA(4) = MOD(INT(RDATA(4))+1,24)
   5424                      END IF
   5425       PRINT 2951,STNID,RDATA(1),RDATA(2),IDATA(9),HDR(13),RDATA(4),ALNCH
   5426  2951 FORMAT(' # # REPORT TIME CHANGED  -ID=',A8,', LAT=',F7.2,'N, ',
   5427      $ 'LON=',F8.2,'E, RTYP',I4,'- FROM',F9.5,' TO',F9.5,'; LAUNCH ',
   5428      $ 'TIME',F6.2)
   5429 C ... HDR(14) IS RESET TO 1 (OBS. TIME IS CORRECTED, BASED ON REPORTED
   5430 C      LAUNCH TIME)
   5431                      HDR(14) = 1
   5432                   ELSE
   5433 C ... IF LAUNCH HOUR IS NOT SAME AS REPORTED OBS. TIME HOUR ...
   5434                      IDT = INT(ALNCH) - INT(RDATA(4))
   5435                      IF(IDT.GT. 12)  IDT = IDT - 24
   5436                      IF(IDT.LT.-12)  IDT = IDT + 24
   5437                      IF(IDT.GT.1.OR.IDT.LT.-2)  THEN
   5438 C     ... IF LAUNCH HOUR IS EITHER MORE THAN 1-HOUR LATER THAN REPORTED
   5439 C          OBS. TIME HOUR OR MORE THAN 2-HOURS EARLIER, CONSIDER LAUNCH
   5440 C          HOUR INVALID AND SET IT TO MISSING
   5441       PRINT 5951,STNID,RDATA(1),RDATA(2),IDATA(9),ALNCH,RDATA(4)
   5442  5951 FORMAT(' # # BAD LAUNCH TIME      -ID=',A8,', LAT=',F7.2,'N, ',
   5443      $ 'LON=',F8.2,'E, RTYP',I4,' - SET TO MISSING (WAS',F6.2,'); RPT ',
   5444      $ 'TIME',F9.5)
   5445                         ALNCH = XMISS
   5446                      END IF
   5447                   END IF
   5448                END IF
   5449                IF(ALNCH.GE.YMISS)  THEN
   5450 C . IF LAUNCH TIME IS MISSING ...
   5451                   IF(INT(RDATA(4)).EQ.11.OR.INT(RDATA(4)).EQ.23)  THEN
   5452                      IF((STNID(1:2).LT.'70'.OR.STNID(1:2).GT.'74').AND.
   5453      $                (IDATA(9).EQ.11.OR.IDATA(9).EQ.12))  THEN
   5454 C     ... FOR LAND FIXED RAOB/PIBAL REPORTS OTHER THAN BLOCK 70-74 AT
   5455 C          11Z OR 23Z, "CORRECT" OBS. TIME BY ADDING 1/2 HOUR TO
   5456 C          REPORTED VALUE AND SET LAUNCH TIME TO 1/4 HOUR PRIOR TO
   5457 C          CORRECTED OBS. TIME
   5458                         RDATA(4) = INT(RDATA(4)) + 0.50
   5459       PRINT 2958,STNID,RDATA(1),RDATA(2),IDATA(9),HDR(13),RDATA(4)
   5460  2958 FORMAT(' # # REPORT TIME CHANGED  -ID=',A8,', LAT=',F7.2,'N, ',

Page 118         Source Listing                  RPTLBL
2017-04-18 11:09                                 prepdata.f

   5461      $ 'LON=',F8.2,'E, RTYP',I4,' - FROM',F9.5,' TO',F9.5,'; NO ',
   5462      $ 'REPORTED LAUNCH TIME')
   5463                         ALNCH = INT(RDATA(4)) + 0.25
   5464               PRINT 2959,STNID,RDATA(1),RDATA(2),IDATA(9),ALNCH,RDATA(4)
   5465 C ... HDR(14) IS RESET TO 2 (OBS. TIME IS CORRECTED, EVEN THOUGH LAUNCH
   5466 C      TIME IS MISSING)
   5467                         HDR(14) = 2
   5468                      END IF
   5469                   END IF
   5470                END IF
   5471             END IF
   5472             IF(ALNCH.GE.YMISS)  THEN
   5473 C AT THIS POINT, ANY REPORTS WHICH STILL HAVE A MISSING LAUNCH TIME
   5474 C  ASSIGN THE LAUNCH TIME TO BE 1/4 HOUR PRIOR TO REPORTED OBS. TIME
   5475                ALNCH = RDATA(4) - 0.25
   5476                IF(ALNCH.LT.0.)  ALNCH = ALNCH + 24.
   5477               PRINT 2959,STNID,RDATA(1),RDATA(2),IDATA(9),ALNCH,RDATA(4)
   5478  2959 FORMAT(' # # LAUNCH TIME MISSING  -ID=',A8,', LAT=',F7.2,'N, ',
   5479      $ 'LON=',F8.2,'E, RTYP',I4,' - SET TO',F6.2,' (BASED ON REPORT ',
   5480      $ 'TIME',F9.5,')')
   5481             END IF
   5482          END IF
   5483       END IF
   5484 C SATELLITE ID GOES IN HDR(15) (MISSING FOR NON-SATELLITE TYPES)
   5485       HDR(15) = REAL(IDATA(6))
   5486 C CHECK TO SEE IF REPORT IS W/I PROPER TIME WINDOW OF INPUT CYCLE TIME
   5487       DT = RDATA(4) - CYCLET
   5488       IF(DT.GT. 12.)  DT = DT - 24.
   5489       IF(DT.LT.-12.)  DT = DT + 24.
   5490 C RESET RDATA(4) WORD TO DIFFERENCE BETWEEN OBS. TIME & CYCLE TIME (HRS)
   5491       RDATA(4) = DT
   5492 C TIME DIFFERENCE GOES IN HDR(4)
   5493       HDR(4) = RDATA(4)
   5494       RETURN
   5495       END

Page 119         Source Listing                  RPTLBL
2017-04-18 11:09 Entry Points                    prepdata.f



ENTRY POINTS

  Name               
                     
 rptlbl_             


SYMBOL CROSS REFERENCE

 Name                       Object Declared Type            Bytes Dimen Elements Attributes       References                        
                                                                                                                                    
 261                        Label  5337                                                           5336                              
 2951                       Label  5426                                                           5425                              
 2958                       Label  5460                                                           5459                              
 2959                       Label  5478                                                           5464,5477                         
 5951                       Label  5442                                                           5441                              
 856                        Label  5373                                                           5368                              
 ADP                        Common 5279                                 14100                                                       
 ALAT_8                     Scalar 5277     R(8)            8           scalar   COM              5294,5318,5320                    
 ALNCH                      Scalar 5282     R(4)            4           scalar   COM              5292,5352,5412,5414,5416,5425,5434
                                                                                                  ,5441,5445,5449,5463,5464,5472,547
                                                                                                  5,5476,5477                       
 ALON_8                     Scalar 5277     R(8)            8           scalar   COM              5293,5308,5309,5311               
 BMISS                      Scalar 5277     R(8)            8           scalar   COM              5293,5294,5307,5317               
 BUFRLIB_MISSING            Common 5287                                 8                                                           
 CBULL                      Scalar 5274     CHAR            11          scalar   COM              5377,5379,5381                    
 CRES1                      Scalar 5273     CHAR            8           scalar   COM                                                
 CRES2                      Scalar 5273     CHAR            8           scalar   COM                                                
 CYCLET                     Dummy  5268     R(4)            4           scalar   ARG,INOUT        5487                              
 DATA                       Common 5278                                 32                                                          
 DIRECT                     Common 5285                                 36016                                                       
 DT                         Local  5487     R(4)            4           scalar                    5487,5488,5489,5491               
 HDR                        Scalar 5280     R(4)            4     1     14       COM              5290,5291,5296,5311,5314,5320,5323
                                                                                                  ,5327,5333,5334,5335,5336,5347,534
                                                                                                  8,5367,5376,5378,5380,5382,5386,53
                                                                                                  88,5390,5393,5425,5431,5459,5467,5
                                                                                                  485,5493                          
 I                          Local  5342     I(4)            4           scalar                    5342,5360                         
 IDAT10                     Scalar 5278     I(4)            4           scalar   COM              5401                              
 IDATA                      Scalar 5276     I(4)            4     1     3500     COM              5323,5327,5340,5341,5342,5358,5359
                                                                                                  ,5360,5425,5441,5453,5459,5464,547
                                                                                                  7,5485                            
 IDATE                      Scalar 5278     I(4)            4     1     4        COM                                                
 IDT                        Local  5434     I(4)            4           scalar                    5434,5435,5436,5437               
 IMISS                      Local  5288     I(4)            4           scalar                    5288,5333,5347                    
 INT                        Func   5414                                 scalar                    5414,5419,5423,5434,5451,5458,5463
 IPRINT                     Scalar 5279     I(4)            4           scalar   COM                                                
 ISATOB                     Scalar 5279     I(4)            4           scalar   COM                                                
 IUNIT                      Scalar 5281     I(4)            4     1     28       COM              5332,5357,5394                    
 KOUNT                      Scalar 5278     I(4)            4           scalar   COM                                                
 L                          Local  5341     I(4)            4           scalar                    5341,5343,5344,5347,5348,5350,5352
                                                                                                  ,5359,5361,5362,5365,5367         
 LAUNCH                     Common 5282                                 4                                                           
 MAXOBS                     Param  5270     I(4)            4           scalar                    5276,5279                         
 MOD                        Func   5308                                 scalar                    5308,5410,5416,5423               

Page 120         Source Listing                  RPTLBL
2017-04-18 11:09 Symbol Table                    prepdata.f

 Name                       Object Declared Type            Bytes Dimen Elements Attributes       References                        
                                                                                                                                    
 MP_PROCESS                 Scalar 5278     I(4)            4           scalar   COM                                                
 MXBLVL                     Param  5271     I(4)            4           scalar                    5285                              
 MXWRDH                     Param  5269     I(4)            4           scalar                    5280,5290                         
 NFILE                      Scalar 5281     I(4)            4           scalar   COM              5332,5357,5394                    
 NINT                       Func   5336                                 scalar                    5336,5344,5348,5350,5362,5367,5388
                                                                                                  ,5410                             
 NOBS3                      Scalar 5285     I(4)            4     1     7        COM                                                
 NUMOBS2                    Param  5272     I(4)            4           scalar                    5285                              
 OBS2                       Scalar 5285     R(4)            4     1     43       COM                                                
 OBS3                       Scalar 5285     R(4)            4     3     8925     COM                                                
 OBS8_8                     Scalar 5277     R(8)            8     1     2        COM              5307,5308,5317,5318               
 PFSWCH                     Common 5283                                 36                                                          
 PMAND                      Scalar 5279     R(4)            4     1     23       COM                                                
 PRFLER                     Scalar 5283     R(4)            4     1     4        COM                                                
 PROFILERINADPUPA           Scalar 5275     L(4)            4           scalar   COM              5402,5404,5409                    
 PWINDO                     Scalar 5283     R(4)            4     1     4        COM                                                
 RDATA                      Scalar 5279     R(4)            4     1     3500     COM              5296,5314,5344,5347,5348,5350,5352
                                                                                                  ,5362,5365,5367,5386,5388,5390,541
                                                                                                  0,5414,5419,5423,5425,5434,5441,54
                                                                                                  51,5458,5459,5463,5464,5475,5477,5
                                                                                                  487,5491,5493                     
 RDATA2                     Scalar 5285     R(4)            4     1     25       COM                                                
 REAL                       Func   5485                                 scalar                    5485                              
 RPTHDR                     Common 5280                                 88                                                          
 RPTLBL                     Subr   5268                                                                                             
 STNID                      Scalar 5273     CHAR            8           scalar   COM              5336,5404,5405,5406,5407,5425,5441
                                                                                                  ,5452,5459,5464,5477              
 SUBSET_D                   Scalar 5273     CHAR            8           scalar   COM                                                
 UNITNO                     Common 5281                                 116                                                         
 WRMISS                     Scalar 5278     R(4)            4           scalar   COM                                                
 XMISS                      Local  5290     R(4)            4           scalar                    5288,5290,5291,5292,5445          
 XTRHD2                     Common 5284                                 27                                                          
 YMISS                      Local  5288     R(4)            4           scalar                    5288,5347,5352,5365,5412,5449,5472

Page 121         Source Listing                  RPTLBL
2017-04-18 11:09                                 prepdata.f

   5496 C$$$  SUBPROGRAM DOCUMENTATION BLOCK
   5497 C
   5498 C SUBPROGRAM:    TIMCHK
   5499 C   PRGMMR: D. A. KEYSER     ORG: NP22       DATE: 2001-06-13
   5500 C
   5501 C ABSTRACT: PERFORMS A TIME CHECK TO SEE IF REPORT IS WITHIN PROPER
   5502 C   TIME WINDOW OF INPUT CYCLE TIME.  IF TIME CHECK FAILS WILL RETURN
   5503 C   WITH IER = 1.
   5504 C
   5505 C PROGRAM HISTORY LOG:
   5506 C 2001-06-13  D. A. KEYSER -- ORIGINAL AUTHOR (REMOVED FROM SUBR.
   5507 C    RPTLBL)
   5508 C
   5509 C USAGE:    CALL TIMCHK(DT,TIMWIN_e,TIMWIN_l,IER)
   5510 C   INPUT ARGUMENT LIST:
   5511 C     DT       - DIFFERENCE BETWEEN OBS. TIME AND CYCLE TIME (IN HOURS,
   5512 C              - REAL NUMBER PRECISION)
   5513 C     TIMWIN_e - EARLIEST TIME WINDOW (HOURS) RELATIVE TO CYCLE TIME
   5514 C              - FOR ACCEPTING REPORT ("-" IS PRIOR TO CYCLE TIME,
   5515 C              - "+" IS AFTER CYCLE TIME) (REAL NUMBER PRECISION)
   5516 C     TIMWIN_l - LATEST TIME WINDOW (HOURS) RELATIVE TO CYCLE TIME FOR
   5517 C              - ACCEPTING REPORT ("-" IS PRIOR TO CYCLE TIME, "+" IS
   5518 C              - AFTER CYCLE TIME) (REAL NUMBER PRECISION)
   5519 C
   5520 C   OUTPUT ARGUMENT LIST:
   5521 C     IER      - ERROR RETURN CODE INDICATING RESULT OF TIME CHECK
   5522 C              -   = 0 --> REPORT PASSED TIME CHECK
   5523 C              -   = 1 --> REPORT FAILED TIME CHECK & SHOULD BE PURGED
   5524 C
   5525 C   OUTPUT FILES:
   5526 C     UNIT 06  - STANDARD OUTPUT PRINT
   5527 C
   5528 C REMARKS: THIS SHOULD ONLY BE CALLED AFTER SUBROUTINE 'RPTLBL' IS
   5529 C     CALLED BECAUSE THE OBS. TIME MAY BE ADJUSTED THERE {IT ALSO
   5530 C     STORES THE OBS. TIME CORRECTION INDICATOR IN HDR(14)}.  CALLED
   5531 C     BY SUBROUTINES 'PREP', 'GETC06', 'SATEDS', 'SATBFR', 'GOESCHK',
   5532 C     'SFCDTA', 'GETSMI' AND 'GETSCATT'.
   5533 C
   5534 C ATTRIBUTES:
   5535 C   LANGUAGE: FORTRAN 90
   5536 C   MACHINE:  NCEP WCOSS
   5537 C
   5538 C$$$
   5539       SUBROUTINE TIMCHK(DT,TIMWIN_e,TIMWIN_l,IER)
   5540       PARAMETER (MXWRDH = 15)
   5541       PARAMETER (MAXOBS = 3500)
   5542       CHARACTER*8  STNID,SUBSET_d
   5543       INTEGER  IDATA(MAXOBS)
   5544       real(8)  alon_8,alat_8
   5545       COMMON/ADP/ISATOB,PMAND(23),RDATA(MAXOBS),IPRINT
   5546       COMMON/RPTHDR/SUBSET_d,STNID,HDR(2:MXWRDH),alon_8,alat_8
   5547       EQUIVALENCE (RDATA,IDATA)
   5548       IER = 0
   5549       IF(NINT(DT*100000.).LT.NINT(TIMWIN_e*100000.).OR.
   5550      $   NINT(DT*100000.).GT.NINT(TIMWIN_l*100000.))  THEN
   5551 cdak     PRINT 951, STNID,RDATA(1),RDATA(2),IDATA(9)
   5552 cd951    FORMAT(' * * TOTAL REPORT TOSSED  -ID=',A8,', LAT=',F7.2,'N, ',

Page 122         Source Listing                  TIMCHK
2017-04-18 11:09                                 prepdata.f

   5553 cdak $    'LON=',F8.2,'E, RTYP',I4,' - OUTSIDE TIME WINDOW')
   5554          IF(NINT(HDR(14)).GT.0) PRINT 100, STNID,RDATA(1),RDATA(2),
   5555      $    IDATA(9)
   5556   100    FORMAT(' * * TOTAL REPORT TOSSED  -ID=',A8,', LAT=',F7.2,'N, ',
   5557      $    'LON=',F8.2,'E, RTYP',I4,' - OUTSIDE TIME WINDOW DUE TO OBS ',
   5558      $    'TIME CORR.')
   5559          IER = 1
   5560       END IF
   5561       RETURN
   5562       END


ENTRY POINTS

  Name               
                     
 timchk_             


SYMBOL CROSS REFERENCE

 Name                       Object Declared Type            Bytes Dimen Elements Attributes       References                        
                                                                                                                                    
 100                        Label  5556                                                           5554                              
 ADP                        Common 5545                                 14100                                                       
 ALAT_8                     Scalar 5544     R(8)            8           scalar   COM                                                
 ALON_8                     Scalar 5544     R(8)            8           scalar   COM                                                
 DT                         Dummy  5539     R(4)            4           scalar   ARG,INOUT        5549,5550                         
 HDR                        Scalar 5546     R(4)            4     1     14       COM              5554                              
 IDATA                      Scalar 5543     I(4)            4     1     3500     COM              5555                              
 IER                        Dummy  5539     I(4)            4           scalar   ARG,INOUT        5548,5559                         
 IPRINT                     Scalar 5545     I(4)            4           scalar   COM                                                
 ISATOB                     Scalar 5545     I(4)            4           scalar   COM                                                
 MAXOBS                     Param  5541     I(4)            4           scalar                    5543,5545                         
 MXWRDH                     Param  5540     I(4)            4           scalar                    5546                              
 NINT                       Func   5549                                 scalar                    5549,5550,5554                    
 PMAND                      Scalar 5545     R(4)            4     1     23       COM                                                
 RDATA                      Scalar 5545     R(4)            4     1     3500     COM              5554                              
 RPTHDR                     Common 5546                                 88                                                          
 STNID                      Scalar 5542     CHAR            8           scalar   COM              5554                              
 SUBSET_D                   Scalar 5542     CHAR            8           scalar   COM                                                
 TIMCHK                     Subr   5539                                                                                             
 TIMWIN_E                   Dummy  5539     R(4)            4           scalar   ARG,INOUT        5549                              
 TIMWIN_L                   Dummy  5539     R(4)            4           scalar   ARG,INOUT        5550                              

Page 123         Source Listing                  TIMCHK
2017-04-18 11:09                                 prepdata.f

   5563 C$$$  SUBPROGRAM DOCUMENTATION BLOCK
   5564 C
   5565 C SUBPROGRAM:    LNDCHK
   5566 C   PRGMMR: D. A. KEYSER     ORG: W/NMC22    DATE: 2015-04-16
   5567 C
   5568 C ABSTRACT: CHECKS THE FOUR OR SIXTEEN (BASED ON INPUT ARGUMENT "NPTS")
   5569 C   GRID POINTS SURROUNDING A REPORT.  BASED ON THE TYPE OF CHECK WILL
   5570 C   FLAG THE REPORT WITH "ILAND=1" IF ANY ONE (ICHK=2) OR IF ALL FOUR OR
   5571 C   SIXTEEN (ICHK=1) SURROUNDING GRID POINTS EXCEED A SPECIFIED CRITICAL
   5572 C   VALUE.  FOR REPORTS IN THE N. HEMISPHERE THE GRID IS 1 DEGREE
   5573 C   LAT/LON; FOR REPORTS IN THE S. HEMISPHERE THE GRID IS 2.5 DEGREE
   5574 C   LAT/LON.
   5575 C
   5576 C PROGRAM HISTORY LOG:
   5577 C 1989-02-02  D. A. KEYSER (W/NMC22)
   5578 C 1990-01-11  D. A. KEYSER -- CONVERTED TO VS FORTRAN(77) & RESTRUCTURED
   5579 C 1992-06-30  D. A. KEYSER -- CODE GENERALIZED; GRID PASSED IN AS ARG.
   5580 C    RATHER THAN READING IN FROM FILE HERE; NEW ARG. NX, NY AND CRIT
   5581 C    ALLOW SUBR. TO BE MORE GENERAL HERE
   5582 C 2014-02-14  D. A. KEYSER -- FIXED BUG IN S.H. KXI/KYJ CALCULATION
   5583 C    WHICH LED TO ALL S.H. REPORTS NEVER HAVING "ICHK" SATISFIED,
   5584 C    MEANING ILAND WAS ALWAYS RETURNED AS 0 (E.G., FOR LAND/SEA CHECK,
   5585 C    ALL S.H. REPORTS WERE DEEMED OVER WATER REGARDLESS OF THEIR
   5586 C    LOCATION), THIS ALSO CAUSED AN ARRAY OVERFLOW SINCE KYJ COULD BE
   5587 C    CALCULATED AS 38, 1 GREATER THAN THE LIMIT; FIXED S.H. BUGS WHICH
   5588 C    CAUSED AN OVERFLOW IN KXI FOR ELON > 359.98 AND AN OVERFLOW IN KYJ
   5589 C    FOR LAT > -0.01
   5590 C 2015-04-16  D. A. KEYSER -- Added new input argument ITYC to indicate
   5591 C    whether the check being done is land/sea (=1) or geographical
   5592 C    (inside vs. outside U.S. mainland/Gulf of Mexico/Southern Ontario,
   5593 C    =2).  Added new input agrument NPTS to indicate whether the values
   5594 C    in the immediate surrounding 4 grid points (=4) or these plus the
   5595 C    next ring of 12 grid points (=16) should be tested against the
   5596 C    critical value.
   5597 C         Updated land/sea check for N.H. surface marine reports.  Now
   5598 C    has option (under certain conditions) to check 16 points around
   5599 C    obs lat/lon location {4 inner points as before (which is still an
   5600 C    option) plus also now 12 points in next, outer ring}.  If any one
   5601 C    of the 16 points is over water, the obs is deemed over water. On
   5602 C    the mask boundary (i.e., Prime Meridian or Equator), check reverts
   5603 C    back to only surrounding 4 points since 1 or more mask points are
   5604 C    not stored in outer 12 point ring in this case.  Several
   5605 C    additional mask points in key geographical locations known to be
   5606 C    over water are also converted from over land to over water (after
   5607 C    being read in).
   5608 C
   5609 C
   5610 C USAGE:    CALL LNDCHK(YLAT,ELON,ITYC,NPTS,ICHK,GRID,NX,NY,CRIT,ILAND)
   5611 C   INPUT ARGUMENT LIST:
   5612 C     YLAT     - LATITUDE OF DATA REPORT  (DEG. N+,S-)
   5613 C     ELON     - LONGITUDE OF DATA REPORT (0.0 TO 359.99 DEG. E)
   5614 C     ITYC     - INDICATES WHAT IS BEING CHECKED:
   5615 C                  =1  - LAND vs. SEA
   5616 C                  =2  - GEOGRAPHICAL (INSIDE vs. OUTSIDE U.S. MAINLAND/
   5617 C                        GULF OF MEXICO/SOUTHERN ONTARIO)
   5618 C     NPTS     - NUMBER OF GRID POINTS SURROUNDING REPORT TO BE CHECKED
   5619 C              - {SHOULD BE EITHER 4 OR 16 (I.E., 2 ROWS OUT FROM

Page 124         Source Listing                  TIMCHK
2017-04-18 11:09                                 prepdata.f

   5620 C              - REPORT), IF SOMETHING ELSE DEFAULTS TO 4}
   5621 C              - {NOTE: IF NPTS PASSED IN AS 16 AND ANY GRID POINT 2
   5622 C              - ROWS OUT NOT STORED (I.E., ON BOUNDARY) -- OR -- ITYC
   5623 C              - IS NOT 1 -- OR -- REPORT IS IN S.H., THEN ONLY THE 4
   5624 C              - SURROUNDING GRID POINTS ARE CHECKED}
   5625 C     ICHK     - TYPE OF CHECK (=1 ALL 4 OR 16 SURROUNDING GRID PTS MUST
   5626 C              - EXCEED CRITICAL VALUE; =2 ONLY 1 OF THE 4 OR 16
   5627 C              - SURROUNDING GRID PTS NEED EXCEED CRITICAL VALUE) - IF
   5628 C              - SATISFIED, OUTPUT ARGUMENT "ILAND" SET TO 1; OTHERWISE
   5629 C              - "ILAND" SET TO 0
   5630 C     GRID     - NX X NY GRID (EITHER 1 DEG IN N.H. OR 2.5 DEG IN S.H.)
   5631 C     NX       - NUMBER OF X-DIRECTION POINTS (COLUMNS) IN "GRID"
   5632 C     NY       - NUMBER OF Y-DIRECTION POINTS (ROWS) IN "GRID"
   5633 C     CRIT     - CRITICAL VALUE FOR CHECK
   5634 C
   5635 C   OUTPUT ARGUMENT LIST:
   5636 C     ILAND    - RETURN FLAG FOR CHECK (=0 "ICHK" NOT SATISFIED; =1
   5637 C              - "ICHK" IS SATISFIED)
   5638 C
   5639 C REMARKS: CALLED BY SUBROUTINES 'PREP', 'SFCDTA', 'GETC06', AND
   5640 C     'GOESDG'.
   5641 C
   5642 C ATTRIBUTES:
   5643 C   LANGUAGE: FORTRAN 90
   5644 C   MACHINE:  NCEP WCOSS
   5645 C
   5646 C$$$
   5647       SUBROUTINE LNDCHK(YLAT,ELON,ITYC,NPTS,ICHK,GRID,NX,NY,CRIT,ILAND)
   5648       REAL  GRID(NX,NY)
   5649       ILAND = 0
   5650       ELONG = ELON + 0.0051
   5651       IF(NINT(YLAT*100.).LT.0)  THEN
   5652          KXI = (NINT(ELONG*100./2.5) +  100)/100
   5653          KYJ = (NINT(YLAT*100./2.5) + 3700)/100
   5654          IF(KYJ.EQ.37)  KYJ = 36 ! account for lat > -0.01 which can
   5655                                  ! render KYJ=37 & overflow GRID array
   5656          IF(KXI.EQ.145) KXI =  1 ! account for lon > 359.98 which can
   5657                                  ! render KXI=145 & overflow GRID array
   5658       ELSE
   5659          KXI = (NINT(ELONG*100.) + 100)/100
   5660          KYJ = (NINT(YLAT*100.) + 100)/100
   5661 C IF RIGHT ON NORTH POLE, CONSIDER REPORT TO BE OVER WATER
   5662          IF(KYJ.EQ.91)  RETURN
   5663       END IF
   5664 
   5665 C If NPTS passed in as 16 but any one of the following is true:
   5666 C       - report is in S.H.,
   5667 C       - any grid point 2 rows out not stored (i.e., on boundary),
   5668 C       - ITYC is 2 (geographical test)
   5669 C  then only the 4 surrounding grid points are checked
   5670 C -----------------------------------------------------------------
   5671       if(npts.eq.16 .and.
   5672      $   nint(ylat*100.).ge.0 .and.
   5673      $   ITYC.eq.1 .and.
   5674      $   (kxi.ge.  2 .and. kxi.le. nx-2) .and.
   5675      $   (kyj.ge.  2 .and. kyj.le. ny-2)) then
   5676 C-----------------------------------------------------------------------

Page 125         Source Listing                  LNDCHK
2017-04-18 11:09                                 prepdata.f

   5677 C    CHECK SIXTEEN GRID POINTS SURROUNDING REPORT -- TWO METHODS
   5678 C-----------------------------------------------------------------------
   5679          grid(286,46) = 0. !set mask pt. near St. Lawrence Seaway to sea
   5680          grid(289,48) = 0. !set mask pt. near St. Lawrence Seaway to sea
   5681          grid(291,49) = 0. !set mask pt. near St. Lawrence Seaway to sea
   5682          grid(262,69) = 0  !set grid pt. near Canadian NW Territ. to sea
   5683          grid(357,54) = 0. !set grid pt. near Irish Sea to sea
   5684          grid( 56,26) = 0. !set grid pt. near Persian Gulf to sea
   5685 C Future: The following lat/lon values need to be converted to sea:
   5686 C           (based on Google Maps)
   5687 C           49.90N   0.40E
   5688 C           49.90N   0.10E
   5689 C           50.60N 263.10E
   5690 C           56.10N 357.10E
   5691 C           56.30N 357.70E
   5692 C           73.80N 279.50E
   5693 C           81.30N 295.90E
   5694 C           72.03N 338.75E
   5695 C           49.70N 265.50E
   5696 C           50.80N 263.30E
   5697 C           53.20N 261.70E
   5698 C           62.00N 245.90E
   5699 C           56.40N 357.80E
   5700 C           56.50N 357.90E
   5701 C           81.40N 297.40E
   5702 C           72.01N 338.73E
   5703 C           65.30N 232.80E
   5704 C           67.90N 244.90E
   5705 C           73.80N 279.70E
   5706 C           72.02N 338.74E
   5707 C  after these go on, keep watching for more points to be added to sea!
   5708          if(ichk.eq.1)  then
   5709 C CHECK 1 ---> ALL SURROUNDING PTS MUST BE OVER LAND (MOST RESTRICTIVE)
   5710          if(min(grid(kxi-1,kyj-1),grid(kxi  ,kyj-1),
   5711      $          grid(kxi+1,kyj-1),grid(kxi+2,kyj-1),
   5712      $          grid(kxi-1,kyj  ),grid(kxi  ,kyj  ),
   5713      $          grid(kxi+1,kyj  ),grid(kxi+2,kyj  ),
   5714      $          grid(kxi-1,kyj+1),grid(kxi  ,kyj+1),
   5715      $          grid(kxi+1,kyj+1),grid(kxi+2,kyj+1),
   5716      $          grid(kxi-1,kyj+2),grid(kxi  ,kyj+2),
   5717      $          grid(kxi+1,kyj+2),grid(kxi+2,kyj+2)).gt.crit) iland=1
   5718          ELSE
   5719 C CHECK 2 ---> ONLY 1 SURROUNDING PT NEED BE OVER LAND (LEAST RESTRCTVE)
   5720          if(max(grid(kxi-1,kyj-1),grid(kxi  ,kyj-1),
   5721      $          grid(kxi+1,kyj-1),grid(kxi+2,kyj-1),
   5722      $          grid(kxi-1,kyj  ),grid(kxi  ,kyj  ),
   5723      $          grid(kxi+1,kyj  ),grid(kxi+2,kyj  ),
   5724      $          grid(kxi-1,kyj+1),grid(kxi  ,kyj+1),
   5725      $          grid(kxi+1,kyj+1),grid(kxi+2,kyj+1),
   5726      $          grid(kxi-1,kyj+2),grid(kxi  ,kyj+2),
   5727      $          grid(kxi+1,kyj+2),grid(kxi+2,kyj+2)).gt.crit) iland=1
   5728          END IF
   5729       else
   5730 C-----------------------------------------------------------------------
   5731 C      CHECK FOUR GRID POINTS SURROUNDING REPORT -- TWO METHODS
   5732 C-----------------------------------------------------------------------
   5733          IF(ICHK.EQ.1)  THEN

Page 126         Source Listing                  LNDCHK
2017-04-18 11:09                                 prepdata.f

   5734 C CHECK 1 ---> ALL SURROUNDING PTS MUST BE OVER LAND (MOST RESTRICTIVE)
   5735             IF(MIN(GRID(KXI,KYJ  ),GRID(KXI+1,KYJ  ),
   5736      $             GRID(KXI,KYJ+1),GRID(KXI+1,KYJ+1)).GT.CRIT) ILAND=1
   5737          ELSE
   5738 C CHECK 2 ---> ONLY 1 SURROUNDING PT NEED BE OVER LAND (LEAST RESTRCTVE)
   5739             IF(MAX(GRID(KXI,KYJ  ),GRID(KXI+1,KYJ  ),
   5740      $             GRID(KXI,KYJ+1),GRID(KXI+1,KYJ+1)).GT.CRIT) ILAND=1
   5741          END IF
   5742 C-----------------------------------------------------------------------
   5743       end if
   5744       RETURN
   5745       END


ENTRY POINTS

  Name               
                     
 lndchk_             


SYMBOL CROSS REFERENCE

 Name                       Object Declared Type            Bytes Dimen Elements Attributes       References                        
                                                                                                                                    
 CRIT                       Dummy  5647     R(4)            4           scalar   ARG,INOUT        5717,5727,5736,5740               
 ELON                       Dummy  5647     R(4)            4           scalar   ARG,INOUT        5650                              
 ELONG                      Local  5650     R(4)            4           scalar                    5650,5652,5659                    
 GRID                       Dummy  5647     R(4)            4     2     0        ARG,INOUT        5679,5680,5681,5682,5683,5684,5710
                                                                                                  ,5711,5712,5713,5714,5715,5716,571
                                                                                                  7,5720,5721,5722,5723,5724,5725,57
                                                                                                  26,5727,5735,5736,5739,5740       
 ICHK                       Dummy  5647     I(4)            4           scalar   ARG,INOUT        5708,5733                         
 ILAND                      Dummy  5647     I(4)            4           scalar   ARG,INOUT        5649,5717,5727,5736,5740          
 ITYC                       Dummy  5647     I(4)            4           scalar   ARG,INOUT        5673                              
 KXI                        Local  5652     I(4)            4           scalar                    5652,5656,5659,5674,5710,5711,5712
                                                                                                  ,5713,5714,5715,5716,5717,5720,572
                                                                                                  1,5722,5723,5724,5725,5726,5727,57
                                                                                                  35,5736,5739,5740                 
 KYJ                        Local  5653     I(4)            4           scalar                    5653,5654,5660,5662,5675,5710,5711
                                                                                                  ,5712,5713,5714,5715,5716,5717,572
                                                                                                  0,5721,5722,5723,5724,5725,5726,57
                                                                                                  27,5735,5736,5739,5740            
 LNDCHK                     Subr   5647                                                                                             
 MAX                        Func   5720                                 scalar                    5720,5739                         
 MIN                        Func   5710                                 scalar                    5710,5735                         
 NINT                       Func   5651                                 scalar                    5651,5652,5653,5659,5660,5672     
 NPTS                       Dummy  5647     I(4)            4           scalar   ARG,INOUT        5671                              
 NX                         Dummy  5647     I(4)            4           scalar   ARG,INOUT        5648,5674                         
 NY                         Dummy  5647     I(4)            4           scalar   ARG,INOUT        5648,5675                         
 YLAT                       Dummy  5647     R(4)            4           scalar   ARG,INOUT        5651,5653,5660,5672               

Page 127         Source Listing                  LNDCHK
2017-04-18 11:09                                 prepdata.f

   5746 C$$$  SUBPROGRAM DOCUMENTATION BLOCK
   5747 C
   5748 C SUBPROGRAM:    ISEL
   5749 C   PRGMMR: D. A. KEYSER     ORG: W/NMC22    DATE: 2004-09-09
   5750 C
   5751 C ABSTRACT: FUNCTION -- CONVERTS AN UPPER-AIR DUMP REPORT TYPE TO A
   5752 C   VALUE FROM WHICH ITS PREPBUFR REPORT TYPE CAN BE DERIVED.  THE DUMP
   5753 C   REPORT TYPE IS INPUT AND THE FUNCTION RETURNS THE VALUE WHICH WILL
   5754 C   BE CONVERTED TO THE PROPER PREPBUFR REPORT TYPE BY THE CALLING
   5755 C   PROGRAM.
   5756 C
   5757 C PROGRAM HISTORY LOG:
   5758 C   UNKNOWN
   5759 C 1988-04-11  D. A. KEYSER -- DOCBLOCKED/COMMENTED
   5760 C 1990-01-11  D. A. KEYSER -- CONVERTED TO VS FORTRAN(77) &
   5761 C     RESTRUCTURED
   5762 C 1991-06-07  D. A. KEYSER -- RECOGNIZES ON29 R. TYPE FOR PROFILER RTPS
   5763 C 2001-04-06  D. A. KEYSER -- RECOGNIZES WIND PROFILERS ORIGINATING
   5764 C    FROM PILOT (PIBAL) FORMAT BULLETINS IN "PROFLR" DUMP FILE WITH
   5765 C    ON29 R.TYPE 73)
   5766 C 2004-09-09  D. A. KEYSER -- ADDED PROCESSING OF NPN AND CAP RASS DATA
   5767 C     READ FROM "RASSDA" DUMP FILE IN NEW DATA LVL CAT. 15, DUMP R.
   5768 C     TYPE 77, GET PREPBUFR R. TYPE 126, PROCESSED INTO PREPBUFR FILE
   5769 C     UNDER NEW TBL A ENTRY "RASSDA"
   5770 C
   5771 C USAGE:     XX = ISEL(ID)
   5772 C   INPUT ARGUMENT LIST:
   5773 C     ID       - DUMP REPORT TYPE
   5774 C
   5775 C REMARKS: 'ISEL' RETURNED IS VALUE WHICH WILL LATER BE USED TO GENERATE
   5776 C   PREPBUFR REPORT TYPE.  CALLED BY SUBROUTINES 'PREP' AND 'GETC06'.
   5777 C
   5778 C ATTRIBUTES:
   5779 C   LANGUAGE: FORTRAN 90
   5780 C   MACHINE:  NCEP WCOSS
   5781 C
   5782 C$$$
   5783       FUNCTION ISEL(ID)
   5784       PARAMETER  (ITYPES=18)
   5785       INTEGER  JTYPE(ITYPES),MTYPE(ITYPES)
   5786       DATA JTYPE/51,11,12,13,21,22,23,31,41,61,63,42,71,72,73,75,76,77/,
   5787      $     MTYPE/ 1, 2, 2, 2, 2, 2, 2, 3, 3, 6, 4, 7, 2, 2, 2, 2, 2, 2/
   5788       DO I = 1,ITYPES
   5789          IF(ID.EQ.JTYPE(I))  THEN
   5790             IS = MTYPE(I)
   5791             ISEL = IS
   5792             RETURN
   5793          END IF
   5794       ENDDO
   5795       IS = 9
   5796       ISEL = IS
   5797       RETURN
   5798       END

Page 128         Source Listing                  ISEL
2017-04-18 11:09 Entry Points                    prepdata.f



ENTRY POINTS

  Name             
                   
 isel_             


SYMBOL CROSS REFERENCE

 Name                       Object Declared Type            Bytes Dimen Elements Attributes       References                        
                                                                                                                                    
 I                          Local  5788     I(4)            4           scalar                    5788,5789,5790                    
 ID                         Dummy  5783     I(4)            4           scalar   ARG,INOUT        5789                              
 IS                         Local  5790     I(4)            4           scalar                    5790,5791,5795,5796               
 ISEL                       Func   5783     I(4)            4           scalar                    5791,5796                         
 ISEL@0                     Local  5783     I(4)            4           scalar                                                      
 ITYPES                     Param  5784     I(4)            4           scalar                    5785,5788                         
 JTYPE                      Local  5785     I(4)            4     1     18                        5786,5789                         
 MTYPE                      Local  5785     I(4)            4     1     18                        5787,5790                         

Page 129         Source Listing                  ISEL
2017-04-18 11:09                                 prepdata.f

   5799 C$$$  SUBPROGRAM DOCUMENTATION BLOCK
   5800 C
   5801 C SUBPROGRAM:    GETUPA
   5802 C   PRGMMR: KEYSER/LING      ORG: NP22       DATE: 2014-04-25
   5803 C
   5804 C ABSTRACT: RETRIEVES UPPER-AIR RAOB, PIBAL, DROPWINSONDE, CLASS,
   5805 C   WIND PROFILER ORIGINATING FROM PILOT (PIBAL) FORMAT BULLETINS, VAD
   5806 C   WIND & SATELLITE SOUNDING DATA (ALL TYPES EXCEPT RTOVS AND ATOVS
   5807 C   40-LVL & GOES) FROM DATA LEVEL CATEGORIES 1-5; ALL OTHER WIND
   5808 C   PROFILER DATA FROM DATA LEVEL CATEGORY 11; AND RASS TEMPERATURE
   5809 C   DATA FROM DATA LEVEL CATEGORY 15, ONE REPORT AT A TIME.  FILLS
   5810 C   DAT(NL,M) WHERE NL IS LVL (EA. CAT. HANDLED ONE -AT-A-TIME) AND M
   5811 C   IS COUNTER FOR VARIOUS DATA VARIABLES (1- "NUMDAT").  REPORTS CAN
   5812 C   HAVE ADDITIONAL "SPECIAL" PRESS. LVLS (EITHER AT APPROX. 25 OR 50
   5813 C   MB INCREMENTS) SET UP (IF SPCIAL=TRUE)
   5814 C
   5815 C PROGRAM HISTORY LOG:
   5816 C   UNKNOWN
   5817 C 1987-06-14  D. A. KEYSER -- CORRECTED ERROR IN TREATMENT OF PIBALS
   5818 C 1988-04-11  D. A. KEYSER -- DOCBLOCKED/COMMENTED; STREAMLINED
   5819 C 1989-01-25  D. A. KEYSER -- CORRECTED ERROR IN PROCESSING P(SFC) FROM
   5820 C    CAT. 2 IN 'GETUPA' WHEN INPUT PRESS. IS MISSING
   5821 C 1989-02-16  D. A. KEYSER -- PRINTS MONITOR PURGE BY CAT.; FIXED PROB.
   5822 C    'NS', 'NP', 'PINT(1)' NOT INIT. IF SATOBS=T & SIGLVL=F
   5823 C 1989-04-05  D. A. KEYSER -- ADDED SWITCH 'SPCIAL' TO PROCESS/NOT
   5824 C    PROCESS "SPECIAL"  25/50 MB PRESSURE LEVELS
   5825 C 1989-04-24  D. A. KEYSER -- ADDED CALL TO SUBR BASLIN TO PERFORM BASE-
   5826 C    LINE CHK OF NON-SAT. RPTS OUTPUT TO OI, USES SWITCH "IDELEV" TO
   5827 C    TEST FOR FAILURE
   5828 C 1989-12-13  D. A. KEYSER -- B-LINE CHECK NOW APPLIES TO ANY VALID
   5829 C    PSTN; INDIAN RAOB MASS CHK MOVED HERE FROM SUBR. STOROB
   5830 C 1990-01-11  D. A. KEYSER -- CONVERTED TO VS FORTRAN(77) & RESTRUCTURED
   5831 C 1990-09-19  D  A. KEYSER -- PERF. A DVAL TEST ON U-AIR CAT. 2 LVL 1
   5832 C    PRESS, IF UNREASONABLE ASSUMES NOT PSTN
   5833 C 1990-10-25  D. A. KEYSER -- IF NO CAT.2 U-AIR, GETS PSFC FROM 1ST LVL
   5834 C    IN CAT.3 (IF VALID)
   5835 C 1991-06-07  D. A. KEYSER -- ADDED PROCESSING OF PROFILER DATA
   5836 C    (TREATED AS CAT. 4 DATA)
   5837 C 1992-01-27  D. A. KEYSER -- 925 MB MANDATORY LEVEL DATA PROCESSED
   5838 C    FROM CAT. 8(HEIGHT), 2(TEMP/TDEP) AND 3(WIND)
   5839 C 1992-06-10  D. A. KEYSER -- TOSSES ALL DATA ON ANY CAT. 2 OR 3 LVL IF
   5840 C    PRESS. .GT. SFC. PRESS. (1ST LVL)
   5841 C 1992-07-09  D. A. KEYSER -- 925 MB LVL NOT PROC. AS CAT. 2 OR 3 IF
   5842 C    MAND. LVL;
   5843 C 1992-12-02  D. A. KEYSER -- PROCESSING OF PROFILER DATA STREAMLINED
   5844 C    SINCE UNPACKED RPT HERE CLOSER TO UNPACKED ON29 THAN PREVIOUS
   5845 C    UNPACKED PROFILER RPT VIA W3FI60; PROFLR RPTS CAN ALSO BE INPUT IN
   5846 C    ADPUPA FILE (ON29 CAT.4, R. TYPE STILL 71), SWITCH "PROFIL" NOT
   5847 C    USED BUT "NWINDO" VALID
   5848 C 1993-03-17  D. A. KEYSER -- CHG IN FORMAT OF O-PUT 'IDATA' ARRAY FROM
   5849 C    W3FI77 (PROFLR UNPKER), PASS EDITION NO. TO 'MARKP'
   5850 C 1993-05-12  D. A. KEYSER -- THE NEW "PREPBUFR TABLE VALUES" WHICH CAN
   5851 C    RANGE FROM 0-15 ARE EMPLOYED RATHER THAN THE OLD OI/SSI QUALITY
   5852 C    MARKERS; ON29 CAT. NO. IS STORED IN THE MOSITURE POSITION; ALL
   5853 C    NON-MISSING DATA ARE NOW PACKED INTO PREPBUFR FILE REGARDLESS OF
   5854 C    QUALITY; IN INTERNAL PROCESSING MSG DATA GET PREPBUFR TBL VALUE OF
   5855 C    16 RATHER THAN 10; VERT. COORD. INDIC. ADDED TO PREPBUFR TBL VALUE

Page 130         Source Listing                  ISEL
2017-04-18 11:09                                 prepdata.f

   5856 C    LIST FOR VARIABLES
   5857 C 1993-11-02  D. A. KEYSER -- MONITOR PURGE ON ALL U-AIR MAND. LVL
   5858 C    WINDS/HGHTS-TEMPS NOW PUTS SAME TBL. VALUE ON ALL SIG. LVL WINDS/
   5859 C    TEMPS & CAT.4 HGHTS IF M.P. ON MND-LVL HGHTS
   5860 C 1994-08-11  D. A. KEYSER -- WILL PROCESS CAT. 4 LVLS EVEN IF NO. OF
   5861 C    CAT. 4 LEVELS IS < SUM OF CAT. 1,3,5 LVLS; ANY CAT. 2 OR 3 LEVEL >
   5862 C    (BELOW) SFC. PRESSURE NO LONGER SKIPPED BUT KEPT WITH ALL
   5863 C    VARIABLES ON LEVEL FLAGGED; RAOBS FAILING B-LINE CHK NOW FLAG ALL
   5864 C    CAT. 4 LEVELS BELOW TOP SPANNING PRESS. (BEFORE LVLS NOT PROCESSED)
   5865 C 1995-07-12  D. A. KEYSER -- REMOVED LOGIC TO PROCESS VAS RETRIEVALS;
   5866 C    ADDED PROCESSING OF VAD (NEXRAD) WINDS
   5867 C 1995-08-24  D. A. KEYSER -- FOR 925 MB MAND. LVL, PREPBUFR TBL VALUE
   5868 C    FOR VERTICAL COORD. (PRESS) INITIALIZED TO DEFAULT (7), BEFORE WAS
   5869 C    INITIALIZED TO 16
   5870 C 1996-02-07  D. A. KEYSER -- FOR RGL-BUFR OUTPUT: ORIGINAL TESTS FOR
   5871 C    OLD PREPDA PROC. OF CAT. 4 LVLS RETAINED (TO MAKE BUFR-PREPDA FILE
   5872 C    CONTAIN DATA EXPECTED BY FERR PGM AND OI ANALYSIS)
   5873 C 1996-03-04  D. A. KEYSER -- FOR RGL-BUFR OUTPUT: MORE FIXES TO MAKE
   5874 C    BUFR-PREPDA FILE CONTAIN DATA EXPECTED BY FERR PGM & OI-ANAL
   5875 C    (DEWPT SET TO MISSING IF TEMP. BAD; SFC LVL HGHT. Q.M. SET TO 1
   5876 C    RATHER THAN 6)
   5877 C 1996-09-03  D. A. KEYSER -- ALLOW BUFR EDIT. 3 WIND PROFILER MSGS TO
   5878 C    BE PROCESSED
   5879 C 1996-10-24  D. A. KEYSER -- FOR U-AIR REPORT FAILING B-LINE CHK ANY
   5880 C    VARIABLES WITH AN EXISTING KEEP FLAG ON THEM WILL NOT BE FLAGGED
   5881 C    AS BAD OR SUSPECT
   5882 C 1997-05-01  D. A. KEYSER -- EST. REASON CODES FOR UPPER-AIR DATA
   5883 C    TYPES (CURRENTLY JUST 100, 101-103, 105 TO IDENTIFY INTERPOLATED
   5884 C    DATA FOR CQCBUFR PGM); CHGS IN LVL ON29 CATEGORY INDICATORS: SPEC.
   5885 C    LVLS GET CAT=7 RATHER THAN 6; STDOUT EXPANDED TO INCL. REASON
   5886 C    CODES
   5887 C 1997-07-02  D. A. KEYSER -- QUAL. MARKER FOR VAD WIND LEVELS WITH
   5888 C    INPUT RMS VECTOR ERROR TAG OF "B" (3.9 KNOTS) DOWNGRADED FROM
   5889 C    NEUTRAL TO SUSPECT (AT REQUEST OF NOAA/FSL)
   5890 C 1998-02-17  D. A. KEYSER -- CHANGES TO INTERFACE WITH NEW UNPACKED
   5891 C    IW3UNPBF FORMAT (RATHER THAN IW3GAD), MAINLY PRESS. STORED IN WORD
   5892 C    1, 925 MB LEVEL IN CAT. 1; REMOVED LOGIC RE: FLAGGING SIG. LVL IF
   5893 C    ALL MAND. LVLS FLAGGED; SPCIAL=F NO LONGER GENERATES SPEC. LEVELS;
   5894 C    CAT. 5 LVLS WITH WSPD=0 ARE FLAGGED; REMOVED B-LINE CHECK LOGIC
   5895 C 1998-05-15  D. A. KEYSER -- FLAGGING OF TROP LVLS WITH WSPD=0 MOVED
   5896 C    FROM SUBR. GETUPA TO STOROB BECAUSE SOME CALM TROP WINDS WEREN'T
   5897 C    BEING IDENTIFIED
   5898 C 1999-01-20  D. A. KEYSER -- ADDED N-LIST SWITCHES "IVADFL" AND
   5899 C   "IVADSP" TO SELECT VAD WIND RMSVE TOLERANCE
   5900 C 2002-01-28  D. A. KEYSER -- NOW RECOGNIZES THAT W3UNPKB7 CAN RETURN A
   5901 C     VAD WIND Q.M. OF 12 (MEANING ON REJECT LIST) OR 14 (MEANING SDM
   5902 C     PURGED) ALONG WITH EXISTING Q.M. GENERATED FROM RMS VECTOR ERROR;
   5903 C     NOW RECOGNIZES THAT W3UNPKB7 CAN RETURN A WIND PROFILER "QUALITY
   5904 C     CODE" OF 14 (MEANING EITHER ON WIND REJECT LIST OR SDM PURGED)
   5905 C     ALONG WITH EXISTING Q. CODES FROM FSL/HUB
   5906 C 2004-09-09  D. A. KEYSER -- ADDED PROCESSING OF NPN AND CAP RASS DATA
   5907 C     READ FROM "RASSDA" DUMP FILE IN NEW DATA LVL CAT. 15, DUMP R.
   5908 C     TYPE 77, GET PREPBUFR R. TYPE 126, PROCESSED INTO PREPBUFR FILE
   5909 C     UNDER NEW TBL A ENTRY "RASSDA"
   5910 C 2014-04-25  D. A. Keyser -- No longer aborts with RC=99 if number of
   5911 C     levels in a report exceeds the limit of "MXLVL".  Instead, now
   5912 C     skips the offending report(s) and, at the very end, posts a

Page 131         Source Listing                  ISEL
2017-04-18 11:09                                 prepdata.f

   5913 C     message to the JOBLOG file noting how many reports were skipped
   5914 C     due to this issue.
   5915 C 2014-04-25  Y. Ling      -- No conversion of winds from dir/speed to
   5916 C     u/v for VAD wind reports from Level 2 decoder since these are
   5917 C     already u/v and are stored in m/sec
   5918 C
   5919 C USAGE:    CALL GETUPA(*,*)
   5920 C   OUTPUT FILES:
   5921 C     UNIT 06  - STANDARD OUTPUT PRINT
   5922 C
   5923 C REMARKS: CALLED BY SUBROUTINES 'PREP' & 'SNDPRP'.
   5924 C
   5925 C ATTRIBUTES:
   5926 C   LANGUAGE: FORTRAN 90
   5927 C   MACHINE:  NCEP WCOSS
   5928 C
   5929 C$$$
   5930       SUBROUTINE GETUPA(*,*)
   5931       PARAMETER (MXWRDH = 15)
   5932       PARAMETER (MXLVL = 600)
   5933       PARAMETER (NUMVAR = 6, NUMQMS = 5)
   5934       PARAMETER (NUMDAT = NUMVAR + (2 * NUMQMS))
   5935       PARAMETER (MAXOBS = 3500)
   5936       CHARACTER*5  CTYPE
   5937       CHARACTER*8  STNPRT,STNID,SUBSET_d
   5938       LOGICAL  KTEMP,PG4243,SPCIAL
   5939       INTEGER  IDATA(MAXOBS),IQ(MXLVL,NUMQMS),IPRT(2),IR(MXLVL,NUMQMS),
   5940      $ MARKP(0:14)
   5941       REAL  PS(47)
   5942       real(8)  alon_8,alat_8
   5943       COMMON/ADP/ISATOB,PMAND(23),RDATA(MAXOBS),IPRINT
   5944       COMMON/SNDATA/DAT(MXLVL,NUMDAT)
   5945       COMMON/DATA/KOUNT,IDATE(4),IDAT10,MP_PROCESS,WRMISS
   5946       COMMON/RPTHDR/SUBSET_d,STNID,HDR(2:MXWRDH),alon_8,alat_8
   5947       COMMON/UPALIM/LEVPM,LEVST,LEVQQ,TDLIM,TDMAX,SPCIAL,ISQNUM_UPA
   5948       COMMON/PARM2/PG4243,KTEMP,i2many_lvls
   5949       COMMON/PARM3/RECCON,RWINDO,UWINDO,RECSLM,FLRECO,VWINDO,VADWIN,
   5950      $ IVADFL,IVADSP,FLDMGS,FLDMAF,FLDMFR,DROPSN,DWINDO
   5951       COMMON/PARM5/FILLZ,FILLT,FILLW,FILLM,LSWIND,LSMASS,CWINDO,NPZ
   5952       COMMON/PARM6/MODPRT,IFLUA,STNPRT(3)
   5953       COMMON/RUNSW/IRNMRK
   5954 C DATA AT PRESSURE LEVELS (MESHED SOUNDING)
   5955       EQUIVALENCE  (RDATA,IDATA),(DAT(1,NUMVAR+1),IQ)
   5956       EQUIVALENCE  (DAT(1,NUMVAR+NUMQMS+1),IR)
   5957       DATA  XMISS/99999./,YMISS/99998.8/,IMISS/99999/
   5958       DATA  PS/1000.,975.,950.,925.,900.,875.,850.,825.,800.,775.,
   5959      $          750.,725.,700.,675.,650.,625.,600.,575.,550.,525.,
   5960      $          500.,475.,450.,425.,400.,375.,350.,325.,300.,275.,
   5961      $          250.,225.,200.,175.,150.,125.,100., 85., 70., 60.,
   5962      $           50., 40., 30., 25., 20., 15., 10./
   5963       DATA  MARKP/1,3,11,2,12,2,2,2,13,2,2,2,10,14,14/
   5964 CVVVVV%%%%%TEMP FOR PRINT
   5965 cdak  DATA  IPRTF/0/
   5966 CAAAAA%%%%%
   5967 C FCN PR GETS PRESSURE FROM STANDARD ATMOSPHERE HEIGHT (Z < 11000M)
   5968       PR(Z) = 1013.25 * (((288.15 - (.0065 * Z))/288.15)**5.256)
   5969 C GET LIMITS FOR EXTRACTING DATA:

Page 132         Source Listing                  GETUPA
2017-04-18 11:09                                 prepdata.f

   5970 C    PTOP IS TOP LEVEL FOR EXTRACTING CAT. 1, 3, & SPECIAL LEVEL DATA
   5971 C    STOP IS TOP LEVEL FOR EXTRACTING CAT. 2/5 DATA
   5972 C    QTOP IS TOP LEVEL FOR EXTRACTING CAT. 1 AND 2/5 MOISTURE DATA
   5973 C    ZTOP IS TOP LEVEL FOR EXTRACTING CAT. 4/11 AND 15 DATA
   5974 C       (ZTOP IS STD ATMOS. HEIGHT CORRESPONDING TO PTOP)
   5975       PTOP = PMAND(LEVPM)
   5976       CALL W3FA03(PTOP,ZTOP,TTOP,THETA)
   5977       STOP = PMAND(LEVST)
   5978       QTOP = PMAND(LEVQQ)
   5979       ELEV = NINT(RDATA(7))
   5980 C IQMLIM IS PREPBUFR TABLE VALUE LIMIT FOR ACCEPTING RPTS
   5981       IQMLIM = 16
   5982 C IQMGUD IS THE HIGHEST 'NON-REJECTED' PREPBUFR TABLE VALUE
   5983       IQMGUD = 3
   5984       IBLIZ1 = 99
   5985       INDIAN = 0
   5986 C INDIAN=1: INDIAN MASS RAOB RPT TO BE AT LEAST FLAGGED & POSS. PURGED
   5987       IF(PG4243.AND.HDR(6).EQ.120.AND.(STNID(1:2).EQ.'42'.OR.
   5988      $ STNID(1:2).EQ.'43'))  INDIAN = 1
   5989 C***********************************************************************
   5990 C      COLLECT UPPER-AIR DATA IN DATA LEVEL CATEGORIES 1 - 5, 11, 15
   5991 C         IQ(N,3) IS NOW USED TO RECORD CATEGORY OF INPUT DATA
   5992 C***********************************************************************
   5993       DAT = XMISS
   5994       IQ = 16
   5995 C INITIALIZE ALL REASON CODES AS 100 (ORIGINAL DATA)
   5996       IR = 100
   5997       STAP = XMISS
   5998 C
   5999 C FOR EACH REPORT, DAT IS FILLED WITH UNPACKED DATA AS FOLLOWS:
   6000 C  OBSERVATIONS FOR:
   6001 C   DAT(NL,1)  - PRESSURE              DAT(NL,2)  - HEIGHT
   6002 C   DAT(NL,3)  - REPORTED TEMP (SEE #) DAT(NL,4)  - DEWPOINT TEMPERATURE
   6003 C   DAT(NL,5)  - WIND DIRECTION        DAT(NL,6)  - WIND SPEED
   6004 C  PREPBUFR TABLE VALUES FOR:
   6005 C   DAT(NL,7) - HEIGHT                DAT(NL,8)  - TEMPERATURE
   6006 C   DAT(NL,9) - DATA LEVEL CATEGORY   DAT(NL,10) - WIND
   6007 C   DAT(NL,11)- VERTICAL COORDINATE
   6008 C
   6009 C  # - SENSIBLE TEMPERATURE FOR ALL NON-SATELLITE DATA TYPES
   6010 C      VIRTUAL TEMPERATURE FOR RTOVS OR ATOVS (UNPACKED NMCEDS)
   6011 C
   6012 C NL IS COUNT OF TOTAL LVLS FROM ALL CATEGORIES (1-5, 11, 15 + SPECIAL)
   6013 C NP3 IS COUNT OF ALL LEVELS CONTAINING VALID WIND DATA IN CAT. 1,3,5
   6014 C NPZ IS COUNT OF ALL LVLS CONTAINING NON-MISSING HGHT DATA IN CAT. 1,2
   6015 C  (ONLY SIGNIFICANT WHEN SPCIAL = FALSE)
   6016       NL  = 0
   6017       NP3 = 0
   6018       NPZ = 0
   6019 C-----------------------------------------------------------------------
   6020 C        MANDATORY LEVEL MASS AND WIND DATA (DATA LEVEL CATEGORY 1)
   6021 C-----------------------------------------------------------------------
   6022 C
   6023 C NN IS NO. OF LEVELS THAT WILL BE CONSIDERED
   6024 C NM IS NO. OF MANDATORY DATA LEVELS (CAT. 1) ACTUALLY COLLECTED
   6025       NM = 0
   6026       NN = IDATA(13)

Page 133         Source Listing                  GETUPA
2017-04-18 11:09                                 prepdata.f

   6027       II = IDATA(14) - 11
   6028       NN = MIN(NN,LEVPM)
   6029       IZBEST = 99
   6030       IF(NN.LE.0)  GO TO 11
   6031       DO N = 1,NN
   6032          II = II + 11
   6033 C GET PREPBUFR TABLE VALUES FOR PRESSURE, HGHT, TEMP., MOISTURE, & WIND
   6034          IPM = NINT(RDATA(II+ 6))
   6035          IZM = NINT(RDATA(II+ 7))
   6036          ITM = NINT(RDATA(II+ 8))
   6037          IQM = NINT(RDATA(II+ 9))
   6038          IVM = NINT(RDATA(II+10))
   6039          IBTEST = 0
   6040          IF(IZM.GT.3)  IBTEST = 1
   6041          IBLIZ1 = MIN(IBLIZ1,IBTEST)
   6042 C IF REPORT IS RTOVS OR ATOVS SAT RETRIEVAL, ALL MANDATORY LEVELS
   6043 C  PROCESSED (EVEN IF DATA MISSING)
   6044          IF(ISATOB.EQ.0.AND.MIN(RDATA(II+1),RDATA(II+2)).GE.YMISS.AND.
   6045      $    (MAX(RDATA(II+4),RDATA(II+5)).GE.YMISS))  CYCLE
   6046          NL = NL + 1
   6047          IQ(NL,3) = 1
   6048          DAT(NL,1) = NINT(RDATA(II)) * 0.1
   6049          IQ(NL,5) = IPM
   6050          CALL W3FA03(DAT(NL,1),DAT(NL,2),DAT(NL,3),THETA)
   6051          IF(RDATA(II+1).LT.YMISS)  THEN
   6052             DAT(NL,2) = NINT(RDATA(II+1))
   6053             IQ(NL,1) = IZM
   6054             NPZ = NPZ + 1
   6055          END IF
   6056          IF(RDATA(II+2).LT.YMISS)  THEN
   6057             DAT(NL,3) = (NINT(RDATA(II+2)) * 0.1) + 273.16
   6058             IQ(NL,2) = ITM
   6059             IF(DAT(NL,1).GE.QTOP.AND.RDATA(II+3).LT.YMISS
   6060      $       .AND.NINT(RDATA(II+3)).GE.0)  THEN
   6061                DEWPT = DAT(NL,3) - (NINT(RDATA(II+3)) * 0.1)
   6062 C PROCESS NON-MSG MOISTURE REGARDLESS OF PREPBUFR TBL VAL
   6063                IF(MAX(IQM,ITM).LT.IQMLIM)  DAT(NL,4) = DEWPT
   6064             END IF
   6065          END IF
   6066 C IZBEST IS BEST (LOWEST) HEIGHT PREPBUFR TBL VALUE AMONGST ALL LEVELS
   6067          IZBEST = MIN(IQ(NL,1),IZBEST)
   6068 C IF KTEMP = T, THEN ALSO EXAMINE TEMP PREPBUFR TABLE VALUE FOR IZBEST
   6069          IF(KTEMP)  IZBEST = MIN(IQ(NL,2),IZBEST)
   6070          IF(MAX(RDATA(II+4),RDATA(II+5)).LT.YMISS.AND.IVM.LT.IQMLIM)THEN
   6071 C PROCESS NON-MSG WIND REGARDLESS OF PREPBUFR TABLE VALUE
   6072             IF(IQ(NL,1).LT.3)  NP3 = NP3 + 1
   6073             DAT(NL,5) = NINT(RDATA(II+4))
   6074             DAT(NL,6) = NINT(RDATA(II+5)) * 0.1
   6075             IQ(NL,4) = IVM
   6076          END IF
   6077       ENDDO
   6078    11 CONTINUE
   6079       NM = NL
   6080 C-----------------------------------------------------------------------
   6081 C        SIGNIFICANT LEVEL MASS (TEMP) DATA (DATA LEVEL CATEGORY 2)
   6082 C-----------------------------------------------------------------------
   6083 C

Page 134         Source Listing                  GETUPA
2017-04-18 11:09                                 prepdata.f

   6084 C NN IS NO. OF LEVELS THAT WILL BE CONSIDERED
   6085 C NSIG IS NO. OF SIGNIFICANT DATA (CAT. 2) LEVELS ACTUALLY COLLECTED
   6086       NSIG = 0
   6087       NN = IDATA(15)
   6088       II = IDATA(16) - 7
   6089       NP1VLD = 0
   6090       IF(NN.EQ.0)  GO TO 5694
   6091       DO N = 1,NN
   6092          II = II + 7
   6093 C GET PREPBUFR TBL VALUES FOR PRESS., TEMP., AND MOISTURE AT THIS LEVEL
   6094          IPM = NINT(RDATA(II+3))
   6095          ITM = NINT(RDATA(II+4))
   6096          IQM = NINT(RDATA(II+5))
   6097 C IF PRESSURE IS MISSING, SKIP PROCESSING OF THIS LEVEL
   6098         IF(NINT(RDATA(II)).GE.32750.OR.(NINT(RDATA(II))*0.1).LT.STOP.OR.
   6099      $    IPM.GE.IQMLIM)  CYCLE
   6100 C IF PRESSURE > STN (SFC) PRESSURE (GOOD ONLY)FLAG ALL DATA ON THIS LVL
   6101          IF(NP1VLD.EQ.1.AND.(NINT(RDATA(II))*0.1).GT.DAT(NM+1,1))  THEN
   6102           ! this should not be monitored by GSI!! (but is since qm=15)
   6103             IPM = 15
   6104             ITM = 15
   6105             IQM = 15
   6106 CVVVVV%%%%%TEMP FOR PRINT
   6107 cdak        PRINT'(" ~~~~~")'
   6108 cdak        IPRTF = 1
   6109 CAAAAA%%%%%
   6110             PRINT 1415, STNID,RDATA(1),RDATA(2),IDATA(9),RDATA(II)*.1,
   6111      $       DAT(NM+1,1)
   6112  1415 FORMAT(' * * CAT2,LVL DATA FLAGGED-ID=',A8,', LAT=',F7.2,'N, ',
   6113      $ 'LON=',F8.2,'E, RTYP',I4,' - PRESS =',F7.2,' > SFC PRESS(',F7.2,
   6114      $ ')')
   6115          END IF
   6116          IF(NINT(RDATA(II)).GE.10750)  THEN
   6117 C IF PRESSURE > 1075 MB FLAG PRESSURE ON LVL
   6118           ! this should not be monitored by GSI!! (but is since qm=15)
   6119             IPM = 15
   6120 CVVVVV%%%%%TEMP FOR PRINT
   6121 cdak        PRINT'(" ~~~~~")'
   6122 cdak        IPRTF = 1
   6123 CAAAAA%%%%%
   6124             PRINT 1215, STNID,RDATA(1),RDATA(2),IDATA(9)
   6125  1215 FORMAT(' * * CAT2,LVL PRES FLAGGED-ID=',A8,', LAT=',F7.2,'N, ',
   6126      $ 'LON=',F8.2,'E, RTYP',I4,' - PRESSURE > 1075 MB')
   6127          END IF
   6128          IF(N.EQ.1)  THEN
   6129 C CHECK PRESSURE OF FIRST CAT.2 LVL (SHOULD BE SFC) TO SEE IF REASONABLE
   6130             DVAL = 0.0
   6131             IF(ELEV.LT.YMISS)  DVAL = (NINT(RDATA(II)) * 0.1) - PR(ELEV)
   6132             IF(DVAL.GT.-75..AND.DVAL.LT.50.)  THEN
   6133 C IF SO,SET NP1VLD=1 -INDICATES THIS IS THE SURFACE & PRESSURE IS "GOOD"
   6134                NP1VLD = 1
   6135             ELSE
   6136 C ELSE, SET NP1VLD=-1 & FLAG PRESSURE ON LVL -INDICATES THIS IS THE
   6137 C  SURFACE & PRESSURE IS "BAD"
   6138 CVVVVV%%%%%TEMP FOR PRINT
   6139 cdak        PRINT'(" ~~~~~")'
   6140 cdak           IPRTF = 1

Page 135         Source Listing                  GETUPA
2017-04-18 11:09                                 prepdata.f

   6141 CAAAAA%%%%%
   6142                PRINT 915, STNID,RDATA(1),RDATA(2),IDATA(9),DVAL,ELEV
   6143   915 FORMAT(' * * CAT2,SFC PRES FLAGGED-ID=',A8,', LAT=',F7.2,'N, ',
   6144      $ 'LON=',F8.2,'E, RTYP',I4,' - PSTN DVALUE(',F7.1,') BAD, ELEV =',
   6145      $ F7.1)
   6146                NP1VLD = -1
   6147           ! this should not be monitored by GSI!! (but is since qm=15)
   6148                IPM = 15
   6149             END IF
   6150          END IF
   6151 C IF THIS IS NOT SFC LVL DON'T PROCESS LVL IF TEMP MISSING
   6152          IF((N.GT.1.OR.NP1VLD.EQ.0).AND.RDATA(II+1).GE.YMISS)  CYCLE
   6153          NL = NL + 1
   6154          IF(NL.GT.MXLVL)  THEN
   6155 C----------------------------------------------------------------------
   6156 C IF NO. OF LEVELS IN A REPORT EXCEEDS THE LIMIT OF "MXLVL", SKIP
   6157 C  REPORT AND PRINT DIAGNOSTIC
   6158             PRINT 9953, STNID,RDATA(1),RDATA(2),IDATA(9),MXLVL
   6159  9953 FORMAT(' # # TOTAL REPORT TOSSED  -ID=',A8,', LAT=',F7.2,'N, ',
   6160      $ 'LON=',F8.2,'E, RTYP',I4,' - EXCEEDS LIMIT OF',I6,' LVLS')
   6161             i2many_lvls = i2many_lvls + 1
   6162             RETURN 2
   6163 C----------------------------------------------------------------------
   6164          END IF
   6165          NSIG = NSIG + 1
   6166          IQ(NL,3) = 2
   6167          IQ(NL,5) = IPM
   6168          DAT(NL,1) = NINT(RDATA(II)) * 0.1
   6169          CALL W3FA03(DAT(NL,1),DAT(NL,2),DAT(NL,3),THETA)
   6170          IF(RDATA(II+1).LT.YMISS)  THEN
   6171             DAT(NL,3) = (NINT(RDATA(II+1)) * 0.1) + 273.16
   6172             IQ(NL,2) = ITM
   6173             IF(DAT(NL,1).GE.QTOP.AND.RDATA(II+2).LT.YMISS.AND.
   6174      $       NINT(RDATA(II+2)).GE.0)  THEN
   6175                DEWPT = DAT(NL,3) - (NINT(RDATA(II+2)) * 0.1)
   6176 C PROCESS NON-MSG MOISTURE REGARDLESS OF PREPBUFR TBL VAL
   6177                IF(MAX(IQM,ITM).LT.IQMLIM)  DAT(NL,4) = DEWPT
   6178             END IF
   6179          END IF
   6180       ENDDO
   6181 C RESET IDATA(15) TO NUMBER OF 'GOOD' CAT. 2 LEVELS ACTUALLY PROCESSED
   6182       IDATA(15) = NSIG
   6183  5694 CONTINUE
   6184 C-----------------------------------------------------------------------
   6185 C TROPOPAUSE LEVEL MASS AND WIND DATA (DATA LEVEL CATEGORY 5) -
   6186 C  TREATED LIKE DATA LEVEL CATEGORY 2
   6187 C-----------------------------------------------------------------------
   6188 C
   6189 C NN IS NO. OF LEVELS THAT WILL BE CONSIDERED
   6190 C N5 IS NO. OF TROPOPAUSE (CAT. 5) LEVELS ACTUALLY COLLECTED
   6191       N5 = 0
   6192       NN = IDATA(21)
   6193       II = IDATA(22) - 9
   6194       IF(NN.EQ.0)  GO TO 21
   6195       DO N = 1,NN
   6196          II = II + 9
   6197 C GET PREPBUFR TABLE VALUES FOR TEMP., MOISTURE AND WIND AT THIS LEVEL

Page 136         Source Listing                  GETUPA
2017-04-18 11:09                                 prepdata.f

   6198          IPM = NINT(RDATA(II+5))
   6199          ITM = NINT(RDATA(II+6))
   6200          IQM = NINT(RDATA(II+7))
   6201          IVM = NINT(RDATA(II+8))
   6202 C CHECK FOR UNREASONABLE PRESSURE, IF SO SKIP PROCESSING OF THIS LEVEL
   6203          IF(NINT(RDATA(II)).GE.10750)  CYCLE
   6204 C PROCESS NON-MSG PRESSURE REGARDLESS OF PREPBUFR TBL VAL
   6205          IF(IPM.GE.IQMLIM.OR.(NINT(RDATA(II))*0.1).LT.STOP)  CYCLE
   6206          IF(MIN(RDATA(II+1),RDATA(II+2)).GE.YMISS.AND.
   6207      $      MAX(RDATA(II+3),RDATA(II+4)).GE.YMISS)  CYCLE
   6208          NL = NL + 1
   6209          IF(NL.GT.MXLVL)  THEN
   6210 C----------------------------------------------------------------------
   6211 C IF NO. OF LEVELS IN A REPORT EXCEEDS THE LIMIT OF "MXLVL", SKIP
   6212 C  REPORT AND PRINT DIAGNOSTIC
   6213             PRINT 9953, STNID,RDATA(1),RDATA(2),IDATA(9),MXLVL
   6214             i2many_lvls = i2many_lvls + 1
   6215             RETURN 2
   6216 C----------------------------------------------------------------------
   6217          END IF
   6218          N5 = N5 + 1
   6219          IQ(NL,3) = 5
   6220          IQ(NL,5) = IPM
   6221          DAT(NL,1) = NINT(RDATA(II)) * 0.1
   6222          CALL W3FA03(DAT(NL,1),DAT(NL,2),DAT(NL,3),THETA)
   6223          IF(RDATA(II+1).LT.YMISS)  THEN
   6224             DAT(NL,3) = (NINT(RDATA(II+1)) * 0.1) + 273.16
   6225             IQ(NL,2) = ITM
   6226             IF(DAT(NL,1).GE.QTOP.AND.RDATA(II+2).LT.YMISS
   6227      $       .AND.NINT(RDATA(II+2)).GE.0)  THEN
   6228                DEWPT = DAT(NL,3) - (NINT(RDATA(II+2)) * 0.1)
   6229 C PROCESS NON-MSG MOISTURE REGARDLESS OF PREPBUFR TBL VAL
   6230                IF(MAX(IQM,ITM).LT.IQMLIM)  DAT(NL,4) = DEWPT
   6231             END IF
   6232          END IF
   6233          IF(MAX(RDATA(II+3),RDATA(II+4)).LT.YMISS.AND.IVM.LT.IQMLIM)THEN
   6234 C PROCESS NON-MSG WIND REGARDLESS OF PREPBUFR TABLE VALUE
   6235             NP3 = NP3 + 1
   6236             DAT(NL,5) = NINT(RDATA(II+3))
   6237             DAT(NL,6) = NINT(RDATA(II+4)) * 0.1
   6238             IQ(NL,4) = IVM
   6239          END IF
   6240       ENDDO
   6241 C RESET IDATA(21) TO NUMBER OF 'GOOD' CAT. 5 LEVELS ACTUALLY PROCESSED
   6242       IDATA(21) = N5
   6243    21 CONTINUE
   6244 C N125 IS THE NUMBER OF CAT. 1, 2, AND 5 LEVELS COLLECTED
   6245       N125 = NL
   6246 C-----------------------------------------------------------------------
   6247 C            WINDS AT VARIABLE PRESSURE (DATA LEVEL CATEGORY 3)
   6248 C-----------------------------------------------------------------------
   6249 C
   6250 C NN IS NO. OF LEVELS THAT WILL BE CONSIDERED
   6251 C NP IS NO. OF CAT.3 & "SPECIAL" 25 OR 50 MB LVL DATA ACTUALLY COLLECTED
   6252       NP = 0
   6253       NN = IDATA(17)
   6254       II = IDATA(18) - 6

Page 137         Source Listing                  GETUPA
2017-04-18 11:09                                 prepdata.f

   6255       IF(NN.EQ.0)  GO TO 31
   6256       DO N = 1,NN
   6257          II = II + 6
   6258 C GET PREPBUFR TABLE VALUES FOR PRESSURE AND WIND AT THIS LEVEL
   6259          IPM = NINT(RDATA(II+3))
   6260          IVM = NINT(RDATA(II+4))
   6261 C IF PRESSURE IS MISSING, SKIP PROCESSING OF THIS LEVEL
   6262         IF(NINT(RDATA(II)).GE.32750.OR.(NINT(RDATA(II))*0.1).LT.PTOP.OR.
   6263      $    IPM.GE.IQMLIM)  CYCLE
   6264 C IF PRESSURE > STN (SFC) PRESSURE (GOOD ONLY) FLAG ALL DATA ON THIS LVL
   6265          IF(NP1VLD.GE.1.AND.(NINT(RDATA(II))*0.1).GT.DAT(N125+1,1)) THEN
   6266           ! this should not be monitored by GSI!! (but is since qm=15)
   6267             IPM = 15
   6268             IVM = 15
   6269 CVVVVV%%%%%TEMP FOR PRINT
   6270 cdak        PRINT'(" ~~~~~")'
   6271 cdak        IPRTF = 1
   6272 CAAAAA%%%%%
   6273             PRINT 1515, STNID,RDATA(1),RDATA(2),IDATA(9),RDATA(II)*.1,
   6274      $       DAT(N125+1,1)
   6275  1515 FORMAT(' * * CAT3,LVL DATA FLAGGED-ID=',A8,', LAT=',F7.2,'N, ',
   6276      $ 'LON=',F8.2,'E, RTYP',I4,' - PRESS =',F7.2,' > SFC PRESS(',F7.2,
   6277      $ ')')
   6278          END IF
   6279          IF(NINT(RDATA(II)).GE.10750)  THEN
   6280 C IF PRESSURE > 1075 MB FLAG PRESSURE ON LVL
   6281           ! this should not be monitored by GSI!! (but is since qm=15)
   6282             IPM = 15
   6283 CVVVVV%%%%%TEMP FOR PRINT
   6284 cdak        PRINT'(" ~~~~~")'
   6285 cdak        IPRTF = 1
   6286 CAAAAA%%%%%
   6287             PRINT 1315, STNID,RDATA(1),RDATA(2),IDATA(9)
   6288  1315 FORMAT(' * * CAT3,LVL PRES FLAGGED-ID=',A8,', LAT=',F7.2,'N, ',
   6289      $ 'LON=',F8.2,'E, RTYP',I4,' - PRESSURE > 1075 MB')
   6290          END IF
   6291 C CHECK IF "GOOD" SFC PRESS. ALREADY PRESENT, IF NOT TRY TO GET IT HERE
   6292          IF(NP1VLD.LT.1.AND.N.EQ.1)  THEN
   6293             DVAL = 0.0
   6294             IF(ELEV.LT.YMISS)  DVAL = (NINT(RDATA(II)) * 0.1) - PR(ELEV)
   6295             IF(DVAL.GT.-75..AND.DVAL.LT.50.)  THEN
   6296                NP1VLD = 2
   6297                PRINT 1115, STNID,RDATA(1),RDATA(2),IDATA(9)
   6298  1115 FORMAT(' * * PSTN GOTTEN IN CAT.3-ID=',A8,', LAT=',F7.2,'N, ',
   6299      $ 'LON=',F8.2,'E, RTYP',I4,' - NOT AVAILABLE OR BAD IN CAT.2')
   6300             ELSE  IF(NP1VLD.EQ.0)  THEN
   6301                NP1VLD = -2
   6302           ! this should not be monitored by GSI!! (but is since qm=15)
   6303                IPM = 15
   6304 CVVVVV%%%%%TEMP FOR PRINT
   6305 cdak           PRINT'(" ~~~~~")'
   6306 cdak           IPRTF = 1
   6307 CAAAAA%%%%%
   6308                PRINT 1915, STNID,RDATA(1),RDATA(2),IDATA(9),DVAL,ELEV
   6309  1915 FORMAT(' * * PSTN GOTTEN IN CAT.3 -- BUT --'/'  SURFACE PRESSURE',
   6310      $ ' FLAGGED-ID=',A8,', LAT=',F7.2,'N, LON=',F8.2,'E, RTYP',I4,
   6311      $ ' - PSTN DVALUE(',F7.1,') BAD, ELEV =',F7.1)

Page 138         Source Listing                  GETUPA
2017-04-18 11:09                                 prepdata.f

   6312             END IF
   6313          END IF
   6314 C IF THIS IS NOT SFC LVL OR PSTN NOT GOTTEN HERE, DON'T PROCESS LVL IF
   6315 C  WIND IS BAD OR MISSING
   6316          IF((N.GT.1.OR.IABS(NP1VLD).NE.2).AND.(MAX(RDATA(II+1),
   6317      $    RDATA(II+2)).GE.YMISS.OR.IVM.GE.IQMLIM))  CYCLE
   6318          NL = NL + 1
   6319          IF(NL.GT.MXLVL)  THEN
   6320 C----------------------------------------------------------------------
   6321 C IF NO. OF LEVELS IN A REPORT EXCEEDS THE LIMIT OF "MXLVL", SKIP
   6322 C  REPORT AND PRINT DIAGNOSTIC
   6323             PRINT 9953, STNID,RDATA(1),RDATA(2),IDATA(9),MXLVL
   6324             i2many_lvls = i2many_lvls + 1
   6325             RETURN 2
   6326 C----------------------------------------------------------------------
   6327          END IF
   6328          NP = NP + 1
   6329          IQ(NL,3) = 3
   6330          IQ(NL,5) = IPM
   6331          DAT(NL,1) = NINT(RDATA(II)) * 0.1
   6332          CALL W3FA03(DAT(NL,1),DAT(NL,2),DAT(NL,3),THETA)
   6333          IF(MAX(RDATA(II+1),RDATA(II+2)).LT.YMISS.AND.IVM.LT.IQMLIM)THEN
   6334 C PROCESS NON-MSG WIND REGARDLESS OF PREPBUFR TABLE VALUE
   6335             DAT(NL,5) = NINT(RDATA(II+1))
   6336             DAT(NL,6) = NINT(RDATA(II+2)) * 0.1
   6337             IQ(NL,4) = IVM
   6338          END IF
   6339    30    CONTINUE
   6340       ENDDO
   6341 C RESET IDATA(17) TO NUMBER OF 'GOOD' CAT. 3 LEVELS ACTUALLY PROCESSED
   6342       IDATA(17) = NP
   6343    31 CONTINUE
   6344 C IF NP1VLD =  1, ASSUME FIRST CAT. 2 LEVEL FILLED IS P(SFC) & IT'S GOOD
   6345 C IF NP1VLD =  2, ASSUME FIRST CAT. 3 LEVEL FILLED IS P(SFC) {CAT.2 MSG
   6346 C  OR BAD} & IT'S GOOD
   6347 C IF NP1VLD = -1, ASSUME FIRST CAT. 2 LEVEL FILLED IS P(SFC) & IT'S BAD
   6348 C IF NP1VLD = -2, ASSUME FIRST CAT. 3 LEVEL FILLED IS P(SFC) {CAT.2 MSG}
   6349 C  & IT'S BAD
   6350 C IN ANY CASE, FILL HGHT AS ELEV W/ PREPBUFR TBL VAL. 6 IF
   6351 C   NON-MSG EXCEPT: IF NO VALID CAT.1 MASS (HGHT) & NO CAT. 2 DATA &
   6352 C   IABS(NP1VLD) IS 2, THIS IS PIBAL RPT, LEAVE SFC HGT PREPBUFR TBL VAL
   6353 C   AS MSG; OR IF ALL MAND. LVL HGHT ON REJECT LIST/SDM PURGE, SET T.V.
   6354 C   AS SUCH
   6355       IF(NP1VLD.NE.0)  THEN
   6356          NCN = NM + 1
   6357          IF(IABS(NP1VLD).EQ.2)  NCN = N125 + 1
   6358          STAP = DAT(NCN,1)
   6359          DAT(NCN,2) = ELEV
   6360          NPZ = NPZ + 1
   6361          IF(ELEV.LT.YMISS.AND.(IABS(NP1VLD).EQ.1.OR.IZBEST.LT.IQMLIM.OR.
   6362      $    IDATA(15).NE.0.OR.IDATA(9).EQ.31))  THEN
   6363             IQ(NCN,1) = 2
   6364             IF(IBLIZ1.EQ.1)  THEN
   6365                IQ(NCN,1) = 14
   6366                PRINT 71, STNID
   6367    71 FORMAT(' * * * * *  MONITOR PURGE ON ALL CAT. 1 LVL HEIGHTS FOR ',
   6368      $ 'ID = ',A8,' -- GIVE CAT. 2 OR 3 SFC HEIGHT A MONITOR PURGE ',

Page 139         Source Listing                  GETUPA
2017-04-18 11:09                                 prepdata.f

   6369      $ 'T.V.  * * * * *')
   6370             END IF
   6371          END IF
   6372       END IF
   6373       NP3 = NP3 + NP
   6374       PSTA = 1013.50
   6375 C SET PSTN TO FIRST PRESS. IN CAT. 2 (IF REASONABLE); ELSE GET FROM ELEV
   6376       IF(STAP.LT.1070..OR.STAP.LT.3275.)  THEN
   6377          PSTA = STAP
   6378 C RESET STAP TO MISSING IF SFC. P IS "BAD" (FOR LATER SUBROUTINES)
   6379          IF(NP1VLD.LT.1)  STAP = XMISS
   6380       ELSE
   6381          IF(ELEV.LT.YMISS)
   6382      $    PSTA = 1013.50 * ((288. - .0065 * ELEV)/288.)**5.256
   6383       END IF
   6384 C-----------------------------------------------------------------------
   6385 C         (RASS) TEMPERATURES BY HEIGHT (DATA LEVEL CATEGORY 15)
   6386 C-----------------------------------------------------------------------
   6387 C
   6388 C NN  IS NO. OF LEVELS THAT WILL BE CONSIDERED
   6389 C N15 IS NO. OF TEMP. BY HEIGHT (CAT. 15) LEVELS ACTUALLY COLLECTED
   6390       N15 = 0
   6391       NN = IDATA(45)
   6392       II = IDATA(46) - 3
   6393       IF(NN.EQ.0)  GO TO 4141
   6394       DO N = 1,NN
   6395          II = II + 3
   6396 C GET PREPBUFR TABLE VALUES FOR HEIGHT AND TEMP. AT THIS HEIGHT LEVEL
   6397          IZM = 2
   6398          ITM = 2
   6399 C CONVERT RASS QUALITY CODE (IF VALID) TO PREPBUFR TABLE VALUE (SEE
   6400 C  SUBROUTINE W3UNPKB7 DOCBLOCK FOR QUALITY MARKER MEANING)
   6401          IF(IDATA(II+2).GT.-1.AND.IDATA(II+2).LT.15)
   6402      $    ITM = MARKP(IDATA(II+2))
   6403 C MISSING HEIGHTS OR THOSE ABOVE THE LIMIT RESULT IN SKIPPED CAT. 15 LVL
   6404          IF(RDATA(II).GT.ZTOP-.02)  CYCLE
   6405 C DON'T PROCESS CAT. 15 LEVEL IF TEMPERATURE IS MISSING
   6406          IF(RDATA(II+1).GE.YMISS)  CYCLE
   6407          NL = NL + 1
   6408          IF(NL.GT.MXLVL)  THEN
   6409 C----------------------------------------------------------------------
   6410 C IF NO. OF LEVELS IN A REPORT EXCEEDS THE LIMIT OF "MXLVL", SKIP
   6411 C  REPORT AND PRINT DIAGNOSTIC
   6412             PRINT 9953, STNID,RDATA(1),RDATA(2),IDATA(9),MXLVL
   6413             i2many_lvls = i2many_lvls + 1
   6414             RETURN 2
   6415 C----------------------------------------------------------------------
   6416          END IF
   6417          N15 = N15 + 1
   6418          IQ(NL,3) = 15
   6419          DAT(NL,2) = NINT(RDATA(II))
   6420          IQ(NL,1) = IZM
   6421 C CALCULATE PRESSURE FROM HEIGHT USING U.S. STANDARD ATMOSPHERE AND
   6422 C  ASSIGN IT PREPBUFR TABLE VALUE 3
   6423          CALL W3FA04(DAT(NL,2),DAT(NL,1),TMPR,THETA)
   6424          IQ(NL,5) = 3
   6425          DAT(NL,3) = RDATA(II+1) ! This is VIRTUAL temperature

Page 140         Source Listing                  GETUPA
2017-04-18 11:09                                 prepdata.f

   6426          IQ(NL,2) = ITM
   6427       ENDDO
   6428 C RESET IDATA(45) TO NUMBER OF 'GOOD' CAT. 15 LEVELS ACTUALLY PROCESSED
   6429       IDATA(45) = N15
   6430  4141 CONTINUE
   6431       IF(SPCIAL)  THEN
   6432 C ALWAYS SET NPZ NON-ZERO FOR SPCIAL = TRUE TO AVOID RETAINING CAT. 4
   6433 C  LEVELS BELOW(ABOVE) LOWEST(HIGHEST) SPECIAL LEVEL IN SUBR. WNDBYZ
   6434          NPZ = 99999
   6435 C-----------------------------------------------------------------------
   6436 C SPECIAL INTERP. P-LVLS (NO DUPL W/ MAND OR SIG LVLS) -
   6437 C  TREATED AS DATA LEVEL CATEGORY 3
   6438 C  *** NOW NEVER PROCESSED FOR RTOVS AND ATOVS SATELLITE RETRIEVALS ***
   6439 C   WILL PROCESS THESE SPECIAL LEVELS AT APPROX. EVERY 25 MB UNLESS:
   6440 C  1) SUFFICIENTLY FEW 'GOOD' SIG. LEVELS ARE AVAILABLE (NOT A TEST FOR
   6441 C      VAD WIND OR NOAA PROFILER NETWORK WIND REPORTS WHICH ARE ALWAYS
   6442 C      PROCESSED AT 25 MB IF SPCIAL=TRUE)
   6443 C
   6444 C IF CASE 1) OCCURS, WILL PROCESS AT APPROX. EVERY 50 MB
   6445 C
   6446 C-----------------------------------------------------------------------
   6447          NLIM = NL
   6448          NINC = 1
   6449          IF((((IDATA(15)+IDATA(21).LE.3).AND.(MAX(IDATA(17),IDATA(19))
   6450      $    .LE.3)).OR.NLIM.LT.5).AND.IDATA(9).NE.71.AND.IDATA(9).NE.72)
   6451      $     NINC = 2
   6452 C FOR NAM OR NDAS RUNS, VAD WIND AND NOAA PROFILER NETWORK WIND REPORTS
   6453 C  PROCESSED ONLY AT 50 MB
   6454          IF((IDATA(9).EQ.71.OR.IDATA(9).EQ.72).AND.IRNMRK.EQ.6) NINC = 2
   6455          DO N = 1,47,NINC
   6456             IF(PS(N).LT.PTOP)  CYCLE
   6457             IP = PS(N)
   6458 C CHECK FOR DUPLICATE PRESSURES
   6459             DO NN = 1,NLIM
   6460                JP = NINT(DAT(NN,1))
   6461                IF(IP.EQ.JP)  CYCLE
   6462             ENDDO
   6463             NL = NL + 1
   6464             IF(NL.GT.MXLVL)  THEN
   6465 C----------------------------------------------------------------------
   6466 C IF NO. OF LEVELS IN A REPORT EXCEEDS THE LIMIT OF "MXLVL", SKIP
   6467 C  REPORT AND PRINT DIAGNOSTIC
   6468                PRINT 9953, STNID,RDATA(1),RDATA(2),IDATA(9),MXLVL
   6469                i2many_lvls = i2many_lvls + 1
   6470                RETURN 2
   6471 C----------------------------------------------------------------------
   6472             END IF
   6473             NP = NP + 1
   6474 C THE SPECIAL LEVELS ARE NOW ASSIGNED DATA LEVEL CATEGORY 7 (UNIQUELY
   6475 C  IDENTIFIES THEM)
   6476             IQ(NL,3) = 7
   6477 C PREPBUFR TBL VALUE FOR VRT. COORD. (PRESS) SET TO DEFAULT OF 2
   6478             IQ(NL,5) = 2
   6479             DAT(NL,1) = PS(N)
   6480 C EVENT#105 -  NEW PRESSURE LEVEL CREATED
   6481             IR(NL,5) = 105
   6482 C FILL-IN HEIGHTS AND TEMPERATURES WITH STD. ATMOS. VALUES FOR NOW

Page 141         Source Listing                  GETUPA
2017-04-18 11:09                                 prepdata.f

   6483             CALL W3FA03(DAT(NL,1),DAT(NL,2),DAT(NL,3),THETA)
   6484          ENDDO
   6485       END IF
   6486 C-----------------------------------------------------------------------
   6487 C             WINDS BY HEIGHT (DATA LEVEL CATEGORY 4)
   6488 C  NPN, CAP AND JAPANESE WIND PROFILER DATA (DATA LEVEL CATEGORY 11)
   6489 C    (NOTE: FROM HERE ON, DATA LEVEL CATEGORY 11 TREATED LIKE DATA LEVEL
   6490 C           CATEGORY 4, ALL REFERENCES TO DATA LEVEL CATEGORY 4 COULD
   6491 C           ALSO MEAN THESE DATA)
   6492 C-----------------------------------------------------------------------
   6493 C
   6494 C NN IS NO. OF LEVELS THAT WILL BE CONSIDERED
   6495 C NH IS NO. OF CAT. 4 HEIGHT LEVELS ACTUALLY COLLECTED
   6496       NH = 0
   6497       ISUBS  = 19
   6498       NUMLVL =  5
   6499       IF(IDATA(37).GT.0)  THEN  ! Data level category 11
   6500          ISUBS  = 37
   6501          NUMLVL = 11
   6502       END IF
   6503       NN = IDATA(ISUBS)
   6504       II = IDATA(ISUBS+1) - NUMLVL
   6505       IF(NN.EQ.0)  GO TO 41
   6506       DO N = 1,NN
   6507          II = II + NUMLVL
   6508 C GET PREPBUFR TABLE VALUES FOR HEIGHT AND WIND AT THIS HEIGHT LEVEL
   6509          IF(IDATA(37).EQ.0)  THEN ! Data level category 4
   6510             IF(IDATA(9).NE.72)  THEN
   6511                IZM = NINT(RDATA(II+3))
   6512                IVM = NINT(RDATA(II+4))
   6513             ELSE
   6514                IZM = 2
   6515                IVM = 2
   6516 C CONVERT VAD WIND QUALITY MARKER (IF VALID) TO PREPBUFR TABLE VALUE
   6517 C  (SEE SUBROUTINE W3UNPKB7 DOCBLOCK FOR QUALITY MARKER MEANING)
   6518               IF(NINT(RDATA(II+4)).EQ.12.OR.NINT(RDATA(II+4)).EQ.14)THEN
   6519                   IVM = NINT(RDATA(II+4))
   6520                ELSE  IF(NINT(RDATA(II+4)).LT.IVADSP)  THEN
   6521                   IVM =  2
   6522                ELSE IF(NINT(RDATA(II+4)).LT.IVADFL)  THEN
   6523                   IVM =  3
   6524                ELSE
   6525                   IVM = 13
   6526                END IF
   6527             END IF
   6528          ELSE   ! Data level category 11
   6529             IZM = 2
   6530             IVM = 2
   6531 C CONVERT WIND PROFILER QUALITY CODE (IF VALID) TO PREPBUFR TABLE VALUE
   6532 C  (SEE SUBROUTINE W3UNPKB7 DOCBLOCK FOR QUALITY MARKER MEANING)
   6533             IF(IDATA(II+3).GT.-1.AND.IDATA(II+3).LT.15)
   6534      $       IVM = MARKP(IDATA(II+3))
   6535          END IF
   6536          IPM = IZM
   6537 C MISSING HEIGHTS OR THOSE ABOVE LIMIT RESULT IN SKIPPED CAT. 4 LVL
   6538          IF(RDATA(II).GT.ZTOP-.02)  CYCLE
   6539 C DON'T PROCESS CAT. 4 LEVEL IF EITHER WIND COMPONENT IS MISSING

Page 142         Source Listing                  GETUPA
2017-04-18 11:09                                 prepdata.f

   6540          IF(MAX(RDATA(II+1),RDATA(II+2)).GE.YMISS) CYCLE
   6541 C PROCESS NON-MSG WIND/HGT REGARDLESS OF PREPBUFR TBL VAL
   6542          IF(MAX(IVM,IPM).LT.IQMLIM)  THEN
   6543             NL = NL + 1
   6544             IF(NL.GT.MXLVL)  THEN
   6545 C----------------------------------------------------------------------
   6546 C IF NO. OF LEVELS IN A REPORT EXCEEDS THE LIMIT OF "MXLVL", SKIP
   6547 C  REPORT AND PRINT DIAGNOSTIC
   6548                PRINT 9953, STNID,RDATA(1),RDATA(2),IDATA(9),MXLVL
   6549                i2many_lvls = i2many_lvls + 1
   6550                RETURN 2
   6551 C----------------------------------------------------------------------
   6552             END IF
   6553             NH = NH + 1
   6554             IQ(NL,3) = 4
   6555             DAT(NL,2) = NINT(RDATA(II))
   6556             IQ(NL,1) = IZM
   6557             IQ(NL,5) = IPM
   6558             IF(DAT(NL,2).EQ.ELEV.AND.IBLIZ1.EQ.1)  THEN
   6559                IQ(NL,1) = 14
   6560                PRINT 471, STNID
   6561   471 FORMAT(' * * * * *  MONITOR PURGE ON ALL CAT. 1 LVL HEIGHTS FOR ',
   6562      $ 'ID = ',A8,' -- GIVE CAT. 4 SFC HEIGHT A MONITOR PURGE ',
   6563      $ 'T.V.  * * * * *')
   6564             END IF
   6565 C HGHT PREPBUFR TBL VAL. SET TO AT BEST 3 (CAN CHG IN WNDBYZ FOR BAD
   6566 C  SPANNING HEIGHT)
   6567             IF(IQ(NL,1).LE.IQMGUD)  IQ(NL,1) = 3
   6568             IF(MAX(RDATA(II+1),RDATA(II+2)).LT.YMISS)  THEN
   6569                IF(SUBSET_d .NE. 'NC002017') THEN
   6570                   DAT(NL,5) = NINT(RDATA(II+1))
   6571                   DAT(NL,6) = NINT(RDATA(II+2)) * 0.1
   6572                ELSE
   6573 C VAD WIND REPORTS FROM LEVEL 2 DECODER STORE U-COMP/V-COMP WIND WHICH
   6574 C  IS ALREADY STORED IN M/SEC
   6575                   DAT(NL,5) = RDATA(II+1)
   6576                   DAT(NL,6) = RDATA(II+2)
   6577                END IF
   6578                IQ(NL,4) = IVM
   6579             END IF
   6580          END IF
   6581       ENDDO
   6582 C RESET IDATA(19) TO NUMBER OF 'GOOD' CAT. 4 LVLS ACTUALLY PROCESSED
   6583       IDATA(19) = NH
   6584    41 CONTINUE
   6585       IF(SUBSET_d .NE. 'NC002017')  THEN
   6586 C FOR ALL TYPES EXCEPT VAD WIND REPORTS FROM LEVEL 2 DECODER, CONVERT
   6587 C  WINDS FROM DIR/SPEED (DEGREES & M/SEC) TO GRID U-COMP/V-COMP (M/SEC)
   6588 C  (VAD WIND REPORTS FROM LEVEL 2 DECODER ARE ALREADY U-COMP/V-COMP)
   6589          DO N = 1,NL
   6590             IF(IQ(N,4).GE.16)  CYCLE
   6591             CALL UV(DAT(N,5),DAT(N,6),U,V)
   6592             DAT(N,5) = U
   6593             DAT(N,6) = V
   6594          ENDDO
   6595       END IF
   6596 C KOUNT COUNTS NO. OF REPORTS UNPACKED (& NOT SKIPPED) FROM FILE

Page 143         Source Listing                  GETUPA
2017-04-18 11:09                                 prepdata.f

   6597       KOUNT = KOUNT + 1
   6598       IPRT(1) = 0
   6599       IPRT(2) = 0
   6600 CVVVVV%%%%%TEMP FOR PRINT
   6601 cdak  STNPRT(3) = '        '
   6602 cdak  IF(IPRTF.EQ.1)  THEN
   6603 cdak     IPRT(1) = 1
   6604 cdak     IPRT(2) = 1
   6605 cdak     STNPRT(3) = STNID
   6606 cdak  END IF
   6607 cdak  IPRTF = 0
   6608 CAAAAA%%%%%
   6609 C IN MERGING, PRINT OUT COMPLETE LISTING OF RPT FOR EACH CAT. (MODPRT)
   6610       IF(MOD((KOUNT-1),MODPRT).EQ.0)  IPRT(1) = 1
   6611       IF(MODPRT.LT.0)  IPRT(1) = 0
   6612 C ALSO, CAN PRINT OUT COMPLETE LISTING FOR SPECIFIC REPORT(S)
   6613       IF(STNID.EQ.STNPRT(1).OR.STNID.EQ.STNPRT(2).OR.STNID.EQ.STNPRT(3))
   6614      $  IPRT(2) = 1
   6615 C+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
   6616 C DETAILED PRINT FOR SPECIFIED REPORT(S) -- IF ENTERED IN DATA CARDS
   6617       IF(IPRT(2).EQ.1.AND.NUMVAR.LT.11.AND.NUMQMS.LT.9)  THEN
   6618          PRINT 902, STNID
   6619   902 FORMAT(/' GETUPA: ',A8,', ALL CAT. GATHERED, PRIOR TO "SMERGE"')
   6620          DO N = 1,NL
   6621             PRINT 900, (DAT(N,K),K=1,NUMVAR)
   6622             PRINT 905, (IQ(N,L),L=1,NUMQMS)
   6623          ENDDO
   6624          PRINT 901
   6625       END IF
   6626   900 FORMAT(1X,10F10.2)
   6627   905 FORMAT('+',102X,8I3)
   6628   901 FORMAT('0',//)
   6629 C+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
   6630 C MERGE DATA LEVEL CATEGORIES INTO SINGLE PROFILE, ACCORDING TO DECR.
   6631 C  PRESSURE
   6632       CALL SMERGE(NM,NSIG,N5,NP,NH,N15,NLEV,IPRT,STOP)
   6633       IF(NLEV.LE.0)  THEN
   6634 C IF NLEV IS ZERO, SKIP REPORT AND PRINT DIAGNOSTIC
   6635          KOUNT = KOUNT - 1
   6636          PRINT 9954, STNID,RDATA(1),RDATA(2),IDATA(9)
   6637  9954 FORMAT(' # # TOTAL REPORT TOSSED  -ID=',A8,', LAT=',F7.2,'N, ',
   6638      $ 'LON=',F8.2,'E, RTYP',I4,' - NLEV=0 RETURNED FROM SMERGE')
   6639          RETURN 2
   6640       END IF
   6641       IF(IPRT(1).EQ.1.OR.IPRT(2).EQ.1)  THEN
   6642          PRINT 1903, STNID
   6643  1903 FORMAT(//,17X,'>>> COMPLETE LISTING OF DATA FOR STATION ID ',A8,
   6644      $ '  - AFTER MERGING OF UPPER-AIR CATEGORIES <<<',//)
   6645          CTYPE = 'VIRT.'
   6646          IF(ISATOB.EQ.0.AND.IDATA(9).NE.77)  CTYPE = 'SENS.'
   6647          PRINT 899, CTYPE
   6648   899 FORMAT(2X,'     UPPER-',4X,'PRESSURE',6X,'HEIGHT',4X,
   6649      $ A5,' TEMP.',4X,'DEWPOINT',4X,'U-WIND',7X,
   6650      $ 'V-WIND',5X,'HGHT',5X,'TEMP',5X,'WIND',3X,'VERT. COORD.'/,2X,
   6651      $ 'AIR CATEGORY',5X,'(MB)',9X,'(GPM)',8X,'(K)',10X,'(K)',8X,'(M/S)'
   6652      $ ,8X,'(M/S)',4X,'TV/RC',4X,'TV/RC',4X,'TV/RC',4X,'  TV/RC'/)
   6653          PRINT 7901, (IQ(N,3),(DAT(N,K),K=1,6),IQ(N,1),IR(N,1),IQ(N,2),

Page 144         Source Listing                  GETUPA
2017-04-18 11:09                                 prepdata.f

   6654      $    IR(N,2),IQ(N,4),IR(N,4),IQ(N,5),IR(N,5),N=1,NLEV)
   6655  7901    FORMAT(6X,I2,F16.2,F14.2,F12.2,F13.2,F11.2,F13.2,I6,'/',I3,
   6656      $    I5,'/',I3,I5,'/',I3,I7,'/',I3)
   6657          PRINT 7902
   6658  7902    FORMAT(//)
   6659       END IF
   6660 C CALL SUBR. 'STOROB' TO WRITE REPORT PIECES IN MOBS ARRAY
   6661       CALL STOROB(NLEV,PSTA,INDIAN,IPRT,*2090)


ENTRY POINTS

  Name               
                     
 getupa_             


SYMBOL CROSS REFERENCE

 Name                       Object Declared Type            Bytes Dimen Elements Attributes       References                        
                                                                                                                                    
 11                         Label  6078                                                           6030                              
 1115                       Label  6298                                                           6297                              
 1215                       Label  6125                                                           6124                              
 1315                       Label  6288                                                           6287                              
 1415                       Label  6112                                                           6110                              
 1515                       Label  6275                                                           6273                              
 1903                       Label  6643                                                           6642                              
 1915                       Label  6309                                                           6308                              
 2090                       Label  6663                                                           6661                              
 21                         Label  6243                                                           6194                              
 30                         Label  6339                                                                                             
 31                         Label  6343                                                           6255                              
 41                         Label  6584                                                           6505                              
 4141                       Label  6430                                                           6393                              
 471                        Label  6561                                                           6560                              
 5694                       Label  6183                                                           6090                              
 71                         Label  6367                                                           6366                              
 7901                       Label  6655                                                           6653                              
 7902                       Label  6658                                                           6657                              
 899                        Label  6648                                                           6647                              
 900                        Label  6626                                                           6621                              
 901                        Label  6628                                                           6624                              
 902                        Label  6619                                                           6618                              
 905                        Label  6627                                                           6622                              
 915                        Label  6143                                                           6142                              
 9953                       Label  6159                                                           6158,6213,6323,6412,6468,6548     
 9954                       Label  6637                                                           6636                              
 ADP                        Common 5943                                 14100                                                       
 ALAT_8                     Scalar 5942     R(8)            8           scalar   COM                                                
 ALON_8                     Scalar 5942     R(8)            8           scalar   COM                                                
 CTYPE                      Local  5936     CHAR            5           scalar                    6645,6646,6647                    
 CWINDO                     Scalar 5951     R(4)            4           scalar   COM                                                
 DAT                        Scalar 5944     R(4)            4     2     9600     COM              5993,6048,6050,6052,6057,6059,6061
                                                                                                  ,6063,6073,6074,6101,6111,6168,616
                                                                                                  9,6171,6173,6175,6177,6221,6222,62
                                                                                                  24,6226,6228,6230,6236,6237,6265,6

Page 145         Source Listing                  GETUPA
2017-04-18 11:09 Symbol Table                    prepdata.f

 Name                       Object Declared Type            Bytes Dimen Elements Attributes       References                        
                                                                                                                                    
                                                                                                  274,6331,6332,6335,6336,6358,6359,
                                                                                                  6419,6423,6425,6460,6479,6483,6555
                                                                                                  ,6558,6570,6571,6575,6576,6591,659
                                                                                                  2,6593,6621,6653                  
 DATA                       Common 5945                                 32                                                          
 DEWPT                      Local  6061     R(4)            4           scalar                    6061,6063,6175,6177,6228,6230     
 DROPSN                     Scalar 5950     R(4)            4           scalar   COM                                                
 DVAL                       Local  6130     R(4)            4           scalar                    6130,6131,6132,6142,6293,6294,6295
                                                                                                  ,6308                             
 DWINDO                     Scalar 5950     R(4)            4           scalar   COM                                                
 ELEV                       Local  5979     R(4)            4           scalar                    5979,6131,6142,6294,6308,6359,6361
                                                                                                  ,6381,6382,6558                   
 FILLM                      Scalar 5951     R(4)            4           scalar   COM                                                
 FILLT                      Scalar 5951     R(4)            4           scalar   COM                                                
 FILLW                      Scalar 5951     R(4)            4           scalar   COM                                                
 FILLZ                      Scalar 5951     R(4)            4           scalar   COM                                                
 FLDMAF                     Scalar 5950     R(4)            4           scalar   COM                                                
 FLDMFR                     Scalar 5950     R(4)            4           scalar   COM                                                
 FLDMGS                     Scalar 5950     R(4)            4           scalar   COM                                                
 FLRECO                     Scalar 5949     R(4)            4           scalar   COM                                                
 GETUPA                     Subr   5930                                                                                             
 HDR                        Scalar 5946     R(4)            4     1     14       COM              5987                              
 I2MANY_LVLS                Scalar 5948     I(4)            4           scalar   COM              6161,6214,6324,6413,6469,6549     
 IABS                       Func   6316                                 scalar                    6316,6357,6361                    
 IBLIZ1                     Local  5984     I(4)            4           scalar                    5984,6041,6364,6558               
 IBTEST                     Local  6039     I(4)            4           scalar                    6039,6040,6041                    
 IDAT10                     Scalar 5945     I(4)            4           scalar   COM                                                
 IDATA                      Scalar 5939     I(4)            4     1     3500     COM              6026,6027,6087,6088,6110,6124,6142
                                                                                                  ,6158,6182,6192,6193,6213,6242,625
                                                                                                  3,6254,6273,6287,6297,6308,6323,63
                                                                                                  42,6362,6391,6392,6401,6402,6412,6
                                                                                                  429,6449,6450,6454,6468,6499,6503,
                                                                                                  6504,6509,6510,6533,6534,6548,6583
                                                                                                  ,6636,6646                        
 IDATE                      Scalar 5945     I(4)            4     1     4        COM                                                
 IFLUA                      Scalar 5952     I(4)            4           scalar   COM                                                
 II                         Local  6027     I(4)            4           scalar                    6027,6032,6034,6035,6036,6037,6038
                                                                                                  ,6044,6045,6048,6051,6052,6056,605
                                                                                                  7,6059,6060,6061,6070,6073,6074,60
                                                                                                  88,6092,6094,6095,6096,6098,6101,6
                                                                                                  110,6116,6131,6152,6168,6170,6171,
                                                                                                  6173,6174,6175,6193,6196,6198,6199
                                                                                                  ,6200,6201,6203,6205,6206,6207,622
                                                                                                  1,6223,6224,6226,6227,6228,6233,62
                                                                                                  36,6237,6254,6257,6259,6260,6262,6
                                                                                                  265,6273,6279,6294,6316,6317,6331,
                                                                                                  6333,6335,6336,6392,6395,6401,6402
                                                                                                  ,6404,6406,6419,6425,6504,6507,651
                                                                                                  1,6512,6518,6519,6520,6522,6533,65
                                                                                                  34,6538,6540,6555,6568,6570,6571,6
                                                                                                  575,6576                          
 IMISS                      Local  5957     I(4)            4           scalar                    5957                              
 INDIAN                     Local  5985     I(4)            4           scalar                    5985,5988,6661                    
 IP                         Local  6457     I(4)            4           scalar                    6457,6461                         
 IPM                        Local  6034     I(4)            4           scalar                    6034,6049,6094,6099,6103,6119,6148

Page 146         Source Listing                  GETUPA
2017-04-18 11:09 Symbol Table                    prepdata.f

 Name                       Object Declared Type            Bytes Dimen Elements Attributes       References                        
                                                                                                                                    
                                                                                                  ,6167,6198,6205,6220,6259,6263,626
                                                                                                  7,6282,6303,6330,6536,6542,6557   
 IPRINT                     Scalar 5943     I(4)            4           scalar   COM                                                
 IPRT                       Local  5939     I(4)            4     1     2                         6598,6599,6610,6611,6614,6617,6632
                                                                                                  ,6641,6661                        
 IQ                         Scalar 5939     I(4)            4     2     3000     COM              5994,6047,6049,6053,6058,6067,6069
                                                                                                  ,6072,6075,6166,6167,6172,6219,622
                                                                                                  0,6225,6238,6329,6330,6337,6363,63
                                                                                                  65,6418,6420,6424,6426,6476,6478,6
                                                                                                  554,6556,6557,6559,6567,6578,6590,
                                                                                                  6622,6653,6654                    
 IQM                        Local  6037     I(4)            4           scalar                    6037,6063,6096,6105,6177,6200,6230
 IQMGUD                     Local  5983     I(4)            4           scalar                    5983,6567                         
 IQMLIM                     Local  5981     I(4)            4           scalar                    5981,6063,6070,6099,6177,6205,6230
                                                                                                  ,6233,6263,6317,6333,6361,6542    
 IR                         Scalar 5939     I(4)            4     2     3000     COM              5996,6481,6653,6654               
 IRNMRK                     Scalar 5953     I(4)            4           scalar   COM              6454                              
 ISATOB                     Scalar 5943     I(4)            4           scalar   COM              6044,6646                         
 ISQNUM_UPA                 Scalar 5947     I(4)            4           scalar   COM                                                
 ISUBS                      Local  6497     I(4)            4           scalar                    6497,6500,6503,6504               
 ITM                        Local  6036     I(4)            4           scalar                    6036,6058,6063,6095,6104,6172,6177
                                                                                                  ,6199,6225,6230,6398,6402,6426    
 IVADFL                     Scalar 5950     I(4)            4           scalar   COM              6522                              
 IVADSP                     Scalar 5950     I(4)            4           scalar   COM              6520                              
 IVM                        Local  6038     I(4)            4           scalar                    6038,6070,6075,6201,6233,6238,6260
                                                                                                  ,6268,6317,6333,6337,6512,6515,651
                                                                                                  9,6521,6523,6525,6530,6534,6542,65
                                                                                                  78                                
 IZBEST                     Local  6029     I(4)            4           scalar                    6029,6067,6069,6361               
 IZM                        Local  6035     I(4)            4           scalar                    6035,6040,6053,6397,6420,6511,6514
                                                                                                  ,6529,6536,6556                   
 JP                         Local  6460     I(4)            4           scalar                    6460,6461                         
 K                          Local  6621     I(4)            4           scalar                    6621,6653                         
 KOUNT                      Scalar 5945     I(4)            4           scalar   COM              6597,6610,6635                    
 KTEMP                      Scalar 5938     L(4)            4           scalar   COM              6069                              
 L                          Local  6622     I(4)            4           scalar                    6622                              
 LEVPM                      Scalar 5947     I(4)            4           scalar   COM              5975,6028                         
 LEVQQ                      Scalar 5947     I(4)            4           scalar   COM              5978                              
 LEVST                      Scalar 5947     I(4)            4           scalar   COM              5977                              
 LSMASS                     Scalar 5951     I(4)            4           scalar   COM                                                
 LSWIND                     Scalar 5951     I(4)            4           scalar   COM                                                
 MARKP                      Local  5940     I(4)            4     1     15                        5963,6402,6534                    
 MAX                        Func   6045                                 scalar                    6045,6063,6070,6177,6207,6230,6233
                                                                                                  ,6316,6333,6449,6540,6542,6568    
 MAXOBS                     Param  5935     I(4)            4           scalar                    5939,5943                         
 MIN                        Func   6028                                 scalar                    6028,6041,6044,6067,6069,6206     
 MOD                        Func   6610                                 scalar                    6610                              
 MODPRT                     Scalar 5952     I(4)            4           scalar   COM              6610,6611                         
 MP_PROCESS                 Scalar 5945     I(4)            4           scalar   COM                                                
 MXLVL                      Param  5932     I(4)            4           scalar                    5939,5944,6154,6158,6209,6213,6319
                                                                                                  ,6323,6408,6412,6464,6468,6544,654
                                                                                                  8                                 
 MXWRDH                     Param  5931     I(4)            4           scalar                    5946                              
 N                          Local  6031     I(4)            4           scalar                    6031,6091,6128,6152,6195,6256,6292
                                                                                                  ,6316,6394,6455,6456,6457,6479,650

Page 147         Source Listing                  GETUPA
2017-04-18 11:09 Symbol Table                    prepdata.f

 Name                       Object Declared Type            Bytes Dimen Elements Attributes       References                        
                                                                                                                                    
                                                                                                  6,6589,6590,6591,6592,6593,6620,66
                                                                                                  21,6622,6653,6654                 
 N125                       Local  6245     I(4)            4           scalar                    6245,6265,6274,6357               
 N15                        Local  6390     I(4)            4           scalar                    6390,6417,6429,6632               
 N5                         Local  6191     I(4)            4           scalar                    6191,6218,6242,6632               
 NCN                        Local  6356     I(4)            4           scalar                    6356,6357,6358,6359,6363,6365     
 NH                         Local  6496     I(4)            4           scalar                    6496,6553,6583,6632               
 NINC                       Local  6448     I(4)            4           scalar                    6448,6451,6454,6455               
 NINT                       Func   5979                                 scalar                    5979,6034,6035,6036,6037,6038,6048
                                                                                                  ,6052,6057,6060,6061,6073,6074,609
                                                                                                  4,6095,6096,6098,6101,6116,6131,61
                                                                                                  68,6171,6174,6175,6198,6199,6200,6
                                                                                                  201,6203,6205,6221,6224,6227,6228,
                                                                                                  6236,6237,6259,6260,6262,6265,6279
                                                                                                  ,6294,6331,6335,6336,6419,6460,651
                                                                                                  1,6512,6518,6519,6520,6522,6555,65
                                                                                                  70,6571                           
 NL                         Local  6016     I(4)            4           scalar                    6016,6046,6047,6048,6049,6050,6052
                                                                                                  ,6053,6057,6058,6059,6061,6063,606
                                                                                                  7,6069,6072,6073,6074,6075,6079,61
                                                                                                  53,6154,6166,6167,6168,6169,6171,6
                                                                                                  172,6173,6175,6177,6208,6209,6219,
                                                                                                  6220,6221,6222,6224,6225,6226,6228
                                                                                                  ,6230,6236,6237,6238,6245,6318,631
                                                                                                  9,6329,6330,6331,6332,6335,6336,63
                                                                                                  37,6407,6408,6418,6419,6420,6423,6
                                                                                                  424,6425,6426,6447,6463,6464,6476,
                                                                                                  6478,6479,6481,6483,6543,6544,6554
                                                                                                  ,6555,6556,6557,6558,6559,6567,657
                                                                                                  0,6571,6575,6576,6578,6589,6620   
 NLEV                       Local  6632     I(4)            4           scalar                    6632,6633,6654,6661               
 NLIM                       Local  6447     I(4)            4           scalar                    6447,6450,6459                    
 NM                         Local  6025     I(4)            4           scalar                    6025,6079,6101,6111,6356,6632     
 NN                         Local  6026     I(4)            4           scalar                    6026,6028,6030,6031,6087,6090,6091
                                                                                                  ,6192,6194,6195,6253,6255,6256,639
                                                                                                  1,6393,6394,6459,6460,6503,6505,65
                                                                                                  06                                
 NP                         Local  6252     I(4)            4           scalar                    6252,6328,6342,6373,6473,6632     
 NP1VLD                     Local  6089     I(4)            4           scalar                    6089,6101,6134,6146,6152,6265,6292
                                                                                                  ,6296,6300,6301,6316,6355,6357,636
                                                                                                  1,6379                            
 NP3                        Local  6017     I(4)            4           scalar                    6017,6072,6235,6373               
 NPZ                        Scalar 5951     I(4)            4           scalar   COM              6018,6054,6360,6434               
 NSIG                       Local  6086     I(4)            4           scalar                    6086,6165,6182,6632               
 NUMDAT                     Param  5934     I(4)            4           scalar                    5944                              
 NUMLVL                     Local  6498     I(4)            4           scalar                    6498,6501,6504,6507               
 NUMQMS                     Param  5933     I(4)            4           scalar                    5934,5939,5956,6617,6622          
 NUMVAR                     Param  5933     I(4)            4           scalar                    5934,5955,5956,6617,6621          
 PARM2                      Common 5948                                 12                                                          
 PARM3                      Common 5949                                 56                                                          
 PARM5                      Common 5951                                 32                                                          
 PARM6                      Common 5952                                 32                                                          
 PG4243                     Scalar 5938     L(4)            4           scalar   COM              5987                              
 PMAND                      Scalar 5943     R(4)            4     1     23       COM              5975,5977,5978                    
 PR                         Local  5968     R(4)            4           scalar                    6131,6294                         

Page 148         Source Listing                  GETUPA
2017-04-18 11:09 Symbol Table                    prepdata.f

 Name                       Object Declared Type            Bytes Dimen Elements Attributes       References                        
                                                                                                                                    
 PS                         Local  5941     R(4)            4     1     47                        5958,6456,6457,6479               
 PSTA                       Local  6374     R(4)            4           scalar                    6374,6377,6382,6661               
 PTOP                       Local  5975     R(4)            4           scalar                    5975,5976,6262,6456               
 QTOP                       Local  5978     R(4)            4           scalar                    5978,6059,6173,6226               
 RDATA                      Scalar 5943     R(4)            4     1     3500     COM              5979,6034,6035,6036,6037,6038,6044
                                                                                                  ,6045,6048,6051,6052,6056,6057,605
                                                                                                  9,6060,6061,6070,6073,6074,6094,60
                                                                                                  95,6096,6098,6101,6110,6116,6124,6
                                                                                                  131,6142,6152,6158,6168,6170,6171,
                                                                                                  6173,6174,6175,6198,6199,6200,6201
                                                                                                  ,6203,6205,6206,6207,6213,6221,622
                                                                                                  3,6224,6226,6227,6228,6233,6236,62
                                                                                                  37,6259,6260,6262,6265,6273,6279,6
                                                                                                  287,6294,6297,6308,6316,6317,6323,
                                                                                                  6331,6333,6335,6336,6404,6406,6412
                                                                                                  ,6419,6425,6468,6511,6512,6518,651
                                                                                                  9,6520,6522,6538,6540,6548,6555,65
                                                                                                  68,6570,6571,6575,6576,6636       
 RECCON                     Scalar 5949     R(4)            4           scalar   COM                                                
 RECSLM                     Scalar 5949     R(4)            4           scalar   COM                                                
 RPTHDR                     Common 5946                                 88                                                          
 RUNSW                      Common 5953                                 4                                                           
 RWINDO                     Scalar 5949     R(4)            4           scalar   COM                                                
 SMERGE                     Subr   6632                                                           6632                              
 SNDATA                     Common 5944                                 38400                                                       
 SPCIAL                     Scalar 5938     L(4)            4           scalar   COM              6431                              
 STAP                       Local  5997     R(4)            4           scalar                    5997,6358,6376,6377,6379          
 STNID                      Scalar 5937     CHAR            8           scalar   COM              5987,5988,6110,6124,6142,6158,6213
                                                                                                  ,6273,6287,6297,6308,6323,6366,641
                                                                                                  2,6468,6548,6560,6613,6618,6636,66
                                                                                                  42                                
 STNPRT                     Scalar 5937     CHAR            8     1     3        COM              6613                              
 STOP                       Local  5977     R(4)            4           scalar                    5977,6098,6205,6632               
 STOROB                     Subr   6661                                                           6661                              
 SUBSET_D                   Scalar 5937     CHAR            8           scalar   COM              6569,6585                         
 TDLIM                      Scalar 5947     R(4)            4           scalar   COM                                                
 TDMAX                      Scalar 5947     R(4)            4           scalar   COM                                                
 THETA                      Local  5976     R(4)            4           scalar                    5976,6050,6169,6222,6332,6423,6483
 TMPR                       Local  6423     R(4)            4           scalar                    6423                              
 TTOP                       Local  5976     R(4)            4           scalar                    5976                              
 U                          Local  6591     R(4)            4           scalar                    6591,6592                         
 UPALIM                     Common 5947                                 28                                                          
 UV                         Subr   6591                                                           6591                              
 UWINDO                     Scalar 5949     R(4)            4           scalar   COM                                                
 V                          Local  6591     R(4)            4           scalar                    6591,6593                         
 VADWIN                     Scalar 5949     R(4)            4           scalar   COM                                                
 VWINDO                     Scalar 5949     R(4)            4           scalar   COM                                                
 W3FA03                     Subr   5976                                                           5976,6050,6169,6222,6332,6483     
 W3FA04                     Subr   6423                                                           6423                              
 WRMISS                     Scalar 5945     R(4)            4           scalar   COM                                                
 XMISS                      Local  5957     R(4)            4           scalar                    5957,5993,5997,6379               
 YMISS                      Local  5957     R(4)            4           scalar                    5957,6044,6045,6051,6056,6059,6070
                                                                                                  ,6131,6152,6170,6173,6206,6207,622
                                                                                                  3,6226,6233,6294,6317,6333,6361,63
                                                                                                  81,6406,6540,6568                 

Page 149         Source Listing                  GETUPA
2017-04-18 11:09 Symbol Table                    prepdata.f

 Name                       Object Declared Type            Bytes Dimen Elements Attributes       References                        
                                                                                                                                    
 ZTOP                       Local  5976     R(4)            4           scalar                    5976,6404,6538                    

Page 150         Source Listing                  GETUPA
2017-04-18 11:09                                 prepdata.f

   6662       RETURN 1
   6663  2090 CONTINUE
   6664       RETURN 2
   6665       END
   6666 C$$$  SUBPROGRAM DOCUMENTATION BLOCK
   6667 C
   6668 C SUBPROGRAM:    UV
   6669 C   PRGMMR: D. A. KEYSER     ORG: W/NMC22    DATE: 1998-02-17
   6670 C
   6671 C ABSTRACT: CONVERTS WIND DIRECTION AND SPEED (METERS/SEC) TO GRID U
   6672 C   AND V COMPONENTS OF VELOCITY (METERS/SEC).
   6673 C
   6674 C PROGRAM HISTORY LOG:
   6675 C   UNKNOWN
   6676 C 1988-04-11  D. A. KEYSER -- DOCBLOCKED/COMMENTED
   6677 C 1990-01-11  D. A. KEYSER -- CONVERTED TO VS FORTRAN(77) & RESTRUCTURED
   6678 C 1991-06-07  D. A. KEYSER -- ADDED ARGUMENT 'ISUNIT' (DUE TO PROFILER)
   6679 C 1998-02-17  D. A. KEYSER -- REMOVED ARGUMENT 'ISUNIT' AND HARDWIRED
   6680 C     TO ACCEPT INPUT SPEED ONLY AS METERS/SEC; ADDED SEPARATE, NEW
   6681 C     OUTPUT AGRUMENTS (BEFORE I/O ARGUMENTS WERE SHARED)
   6682 C
   6683 C USAGE:    CALL UV(DD,FF,U,V)
   6684 C   INPUT ARGUMENT LIST:
   6685 C     DD       - DIRECTION OF WIND (DEGREES)
   6686 C     FF       - SPEED OF WIND (METERS/SEC)
   6687 C
   6688 C   OUTPUT ARGUMENT LIST:
   6689 C     U        - U-COMPONENT OF WIND VELOCITY (METERS/SEC)
   6690 C     V        - V-COMPONENT OF WIND VELOCITY (METERS/SEC)
   6691 C
   6692 C REMARKS: CALLED BY SUBROUTINES 'GETUPA', 'GETC06', 'SFCDTA' AND
   6693 C   'GETSCATT'.
   6694 C
   6695 C ATTRIBUTES:
   6696 C   LANGUAGE: FORTRAN 90
   6697 C   MACHINE:  NCEP WCOSS
   6698 C
   6699 C---------------------------------------------------------------------
   6700 C
   6701 C ENTRY:         CMDDFF      CONVERTS WIND U/V COMPONENTS TO DIR/SPD
   6702 C   PRGMMR: D. A. KEYSER     ORG: W/NMC22    DATE: 1994-08-11
   6703 C
   6704 C ABSTRACT: CONVERTS GRID U AND V COMPONENTS OF VELOCITY (METERS/SEC) TO
   6705 C   WIND DIRECTION AND SPEED (KNOTS).
   6706 C
   6707 C PROGRAM HISTORY LOG:
   6708 C   UNKNOWN
   6709 C 1994-08-11  D. A. KEYSER -- ORIGINAL AUTHOR
   6710 C
   6711 C USAGE:    CALL CMDDFF(U,V,DD,FF)
   6712 C   INPUT ARGUMENT LIST:
   6713 C     U        - U-COMPONENT OF WIND VELOCITY (METERS/SEC)
   6714 C     V        - V-COMPONENT OF WIND VELOCITY (METERS/SEC)
   6715 C
   6716 C   OUTPUT ARGUMENT LIST:
   6717 C     DD       - DIRECTION OF WIND (DEGREES)
   6718 C     FF       - SPEED OF WIND (KNOTS)

Page 151         Source Listing                  GETUPA
2017-04-18 11:09                                 prepdata.f

   6719 C
   6720 C REMARKS: CALLED BY SUBROUTINE STOROB.
   6721 C
   6722 C---------------------------------------------------------------------
   6723 C$$$
   6724       SUBROUTINE UV(DD,FF,U,V)
   6725       DATA  CONV2R/0.017453293/,FACTOR/0.5148/
   6726 
   6727       IF(FF.LE.0.0)  THEN
   6728 C IF WIND SPEED LESS THAN ZERO, WE HAVE A PROBLEM
   6729          U = 0.0
   6730          V = 0.0
   6731       ELSE
   6732          U = -FF * SIN(DD*CONV2R)
   6733          V = -FF * COS(DD*CONV2R)
   6734       END IF
   6735       RETURN
   6736 
   6737          ENTRY CMDDFF(U,V,DD,FF)
   6738       IF(U.EQ.0.0)  THEN
   6739          DD = 0.
   6740          IF(V.GT.0.0)  DD = 180.
   6741       ELSE
   6742          IF(V.EQ.0.0)  THEN
   6743             DD =  90.
   6744             IF(U.GT.0.0)  DD = 270.
   6745          ELSE
   6746             DD = (ATAN2(U,V)/CONV2R) + 180.
   6747             DD = MOD(DD,360.)
   6748          END IF
   6749       END IF
   6750       FF = SQRT(U**2 + V**2)/FACTOR
   6751       RETURN
   6752       END

Page 152         Source Listing                  UV
2017-04-18 11:09 Entry Points                    prepdata.f



ENTRY POINTS

  Name                  Name               
                                           
 cmddff_               uv_                 


SYMBOL CROSS REFERENCE

 Name                       Object Declared Type            Bytes Dimen Elements Attributes       References                        
                                                                                                                                    
 ATAN2                      Func   6746                                 scalar                    6746                              
 CMDDFF                     Subr   6737                                                                                             
 CONV2R                     Local  6725     R(4)            4           scalar                    6725,6732,6733,6746               
 COS                        Func   6733                                 scalar                    6733                              
 DD                         Dummy  6724     R(4)            4           scalar   ARG,INOUT        6732,6733,6739,6740,6743,6744,6746
                                                                                                  ,6747                             
 FACTOR                     Local  6725     R(4)            4           scalar                    6725,6750                         
 FF                         Dummy  6724     R(4)            4           scalar   ARG,INOUT        6727,6732,6733,6750               
 MOD                        Func   6747                                 scalar                    6747                              
 SIN                        Func   6732                                 scalar                    6732                              
 SQRT                       Func   6750                                 scalar                    6750                              
 U                          Dummy  6724     R(4)            4           scalar   ARG,INOUT        6729,6732,6738,6744,6746,6750     
 UV                         Subr   6724                                                                                             
 V                          Dummy  6724     R(4)            4           scalar   ARG,INOUT        6730,6733,6740,6742,6746,6750     

Page 153         Source Listing                  UV
2017-04-18 11:09                                 prepdata.f

   6753 C$$$  SUBPROGRAM DOCUMENTATION BLOCK
   6754 C
   6755 C SUBPROGRAM:    SMERGE
   6756 C   PRGMMR: D. A. KEYSER     ORG: NP22       DATE: 2004-09-09
   6757 C
   6758 C ABSTRACT: MERGES MANDATORY (DATA LEVEL CATEGORY 1), SIGNIFICANT
   6759 C   (DATA LEVEL CATEGORY 2), & TROPOPAUSE (DATA LEVEL CATEGORY 5)
   6760 C   MASS & WIND DATA FOR RAOB AND RTOVS OR ATOVS (ORIGINALLY FROM
   6761 C   UNPACKED NMCEDS FORMAT) SATELLITE SOUNDING REPORTS (RTOVS OR ATOVS
   6762 C   RETRIEVALS ONLY HAVE MASS DATA IN DATA LEVEL CATEGORIES 1 AND 2).
   6763 C
   6764 C PROGRAM HISTORY LOG:
   6765 C   UNKNOWN
   6766 C 1988-04-11  D. A. KEYSER -- DOCBLOCKED/COMMENTED, STREAMLINED
   6767 C 1989-06-15  G. J. DIMEGO -- FIXED INTEGRATION THRU HOLES BY REDEFINING
   6768 C     PLIMIT & ZLIMIT, ALSO TIGHTER LIMITS IN HYDRO CHK; MADE RO2G IN
   6769 C     SMERGE/WNDBYP CONFORM TO RAFS/GDAS VALUE
   6770 C 1989-12-13  D. A. KEYSER -- 'FILL' SWITCH NOW TESTED FOR INTERPOLATING
   6771 C     TO MISSING DATA LEVELS; DUPL. LVL CHECK NOW SEPARATE FOR CAT. 1
   6772 C     VS. CAT. 2 AND CAT. 1 VS. CAT. 5
   6773 C 1990-01-11  D. A. KEYSER -- CONVERTED TO VS FORTRAN(77) & RESTRUCTURED
   6774 C 1990-10-25  D. A. KEYSER -- CALLS FCN 'PWCLC' TO CALC PWATER FOR RAOBS
   6775 C 1992-07-09  D. A. KEYSER -- RMVED. SUBPR. FCN "QFRMTP" & REPL. W/
   6776 C     IN-LINE FCN STMNT.
   6777 C 1993-05-12  D. A. KEYSER -- THE NEW "PREPBUFR TABLE VALUES" WHICH CAN
   6778 C     RANGE FROM 0-15 ARE EMPLOYED RATHER THAN THE OLD OI/SSI QUALITY
   6779 C     MARKERS; IN INTERNAL PROCESSING MISSING DATA GET PREPBUFR TABLE
   6780 C     VALUE OF 16 RATHER THAN 10; VERTICAL COORDINATE INDIC. ADDED TO
   6781 C     PREPBUFR TBL VALUE LIST FOR VARIABLES
   6782 C 1993-09-14  D. A. KEYSER -- ADDED N-LIST SWITCH "TVIRT" TO OUTPUT
   6783 C     TEMP. AS VIRTUAL (=TRUE, DEFAULT) OR AS SENSIBLE (=FALSE) FOR
   6784 C     RAOB, RECCO/DROPS, CLASS & SFC DATA; IF VIRT. TEMP >375K (>325K
   6785 C     ABOVE 100 MB) STORES SENS. TEMP WITH "FAILED" Q.M. AND SETS DWPT
   6786 C     TEMP TO MSG; SENSIBLE TEMPERATURE FOR PROFILE SAVED IN STMP OR
   6787 C     SDAT ARRAYS (IN CASE TVIRT=FALSE)
   6788 C 1994-08-11  D. A. KEYSER -- FOR CALC. V. TEMP> 375K (> 325K ABOVE 100
   6789 C     MB), DWPT NOW SAVED (BEFORE ALWAYS SET TO MSG); ALL DUPL. PRESS.
   6790 C     CHECKS NOW REQUIRE PRESS. TO AGREE TO NEAREST 10'TH OF A MB TO BE
   6791 C     A DUPL. (WAS TO NEAREST WHOLE MB).
   6792 C 1995-07-12  D. A. KEYSER -- REMOVED LOGIC TO PROCESS VAS RETRIEVALS;
   6793 C     IF SPANNING LVL PRESS. Q.M. IS BAD INTEGR. HEIGHT Q.M. SET TO
   6794 C     BAD, IF INTEGR. LVL PRESS. Q.M. IS BAD INTEGR. HEIGHT Q.M. SET
   6795 C     TO BAD
   6796 C 1996-03-04  D. A. KEYSER -- FOR RGL-BUFR OUTPUT: MORE FIXES TO MAKE
   6797 C     BUFR-PREPDA FILE CONTAIN DATA EXPECTED BY FERR PGM & OI-ANAL
   6798 C     (INTERP./CALC. DATA CAN GET GOOD Q.M. IF SPANNING LVL DATA GOOD)
   6799 C 1997-05-01  D. A. KEYSER -- EST. REASON CODES FOR UPPER-AIR DATA
   6800 C     TYPES (CURRENTLY JUST 100, 101-103, 105 TO IDENTIFY INTERPOLATED
   6801 C     DATA FOR CQCBUFR PGM); CHGS IN LVL ON29 CATEGORY INDICATORS:
   6802 C     SPEC. LVLS GET CAT=7 RATHER THAN 6, TROP CAT=5 EXPLICITLY
   6803 C     IDENTIFED IN ALL CASES; STDOUT EXPANDED TO INCL. REASON CODES
   6804 C 1998-02-17  D. A. KEYSER -- REMOVED LOGIC RE: RAOB PWATER CALC.
   6805 C 1999-08-04  D. A. KEYSER -- REPLACED SORT ROUTINE "SHELL" (IN-LINE
   6806 C     SUBROUTINE) WITH W3LIB ROUTINE "ORDERS", MORE EFFICIENT AND
   6807 C     ALLOWS MULTIPLE ORDER SORT KEYS
   6808 C 2000-02-17  D. A. KEYSER -- NOW CALLS SUBR. FILWND FOR RAOBS AND
   6809 C     PIBALS EVEN WHEN FILLW=F TO GET INTERP. WIND LEVELS FOR BALLOON

Page 154         Source Listing                  UV
2017-04-18 11:09                                 prepdata.f

   6810 C     DRIFT LAT/LON CALC. (DISCARDS THEM PRIOR TO WRITE TO PREPBUFR
   6811 C     FILE WHEN FILLW=F)
   6812 C 2002-01-14  D. A. KEYSER -- LEVELS WITH REPORTED DWPT < "TDLIM" VALUE
   6813 C     NOW CALC. SPEC. HUM AND RETAIN DWPT IN PREPBUFR FILE, BUT MOISTURE
   6814 C     PREPBUFR TBL VALUE IS FLAGGED WITH Q.M.=15 (BEFORE, SPEC. HUM. AND
   6815 C     DWPT SET TO MISSING) VIRT. TEMP. CALC. AND ENCODED IN THIS CASE
   6816 C     (BEFORE, SET TO SENSIBLE TEMP.)
   6817 C 2004-09-09  D. A. KEYSER -- ADDED PROCESSING OF NPN AND CAP RASS DATA
   6818 C     READ FROM "RASSDA" DUMP FILE IN NEW DATA LVL CAT. 15, DUMP R.
   6819 C     TYPE 77, GET PREPBUFR R. TYPE 126, PROCESSED INTO PREPBUFR FILE
   6820 C     UNDER NEW TBL A ENTRY "RASSDA"; ADDED NEW INPUT ARGUMENT N15 FOR
   6821 C     NUMBER OF DATA LEVEL CATEGORY 15 LEVELS
   6822 C
   6823 C USAGE:    CALL SMERGE(NM,NSIG,N5,NP,NH,N15,NLEV,IPRT,STOP)
   6824 C   INPUT ARGUMENT LIST:
   6825 C     NM       - NO. OF LEVELS IN CAT.  1 (MANDATORY MASS/WIND)
   6826 C     NSIG     - NO. OF LEVELS IN CAT.  2 (SIG. MASS)
   6827 C     N5       - NO. OF LEVELS IN CAT.  5 (TROPOPAUSE)
   6828 C     NP       - NO. OF CAT. 3 & ADD'L 25 OR 50 MB PRES. LVLS
   6829 C     NH       - NO. OF LEVELS IN CAT.  4 (WINDS BY HEIGHT)
   6830 C     N15      - NO. OF LEVELS IN CAT. 15 (TEMPERATURES BY HEIGHT)
   6831 C     IPRT     - 2-WORD SWITCH, DETAILED STD. O-PUT (UNIT 6) PRT OF RPT
   6832 C     STOP     - TOP LEVEL FOR EXTRACTING CAT. 2/5 DATA
   6833 C
   6834 C   OUTPUT ARGUMENT LIST:
   6835 C     NLEV     - NUMBER OF LEVELS IN REPORT AFTER MERGING
   6836 C
   6837 C   OUTPUT FILES:
   6838 C     UNIT 06  - STANDARD OUTPUT PRINT
   6839 C
   6840 C REMARKS: CALLED BY SUBROUTINE 'GETUPA'.
   6841 C
   6842 C ATTRIBUTES:
   6843 C   LANGUAGE: FORTRAN 90
   6844 C   MACHINE:  NCEP WCOSS
   6845 C
   6846 C$$$
   6847       SUBROUTINE SMERGE(NM,NSIG,N5,NP,NH,N15,NLEV,IPRT,STOP)
   6848       PARAMETER (MXWRDH = 15)
   6849       PARAMETER (MXLVL = 600)
   6850       PARAMETER (NUMVAR = 6, NUMQMS = 5)
   6851       PARAMETER (NUMDAT = NUMVAR + (2 * NUMQMS))
   6852       PARAMETER (MAXOBS = 3500)
   6853       DIMENSION  TMP(MXLVL,NUMDAT),VTMP(MXLVL),IWORK(MXLVL),
   6854      $ DATINV(NUMDAT,MXLVL)
   6855       LOGICAL  FILLZ,FILLW,FILLM
   6856       CHARACTER*5  CTYPE
   6857       CHARACTER*8  STNID,STNPRT,SUBSET_d
   6858       INTEGER  IDATA(MAXOBS),KS(MXLVL),IQ(MXLVL,NUMQMS),
   6859      $ JQ(MXLVL,NUMQMS),IPRT(2),IC(0:16),IR(MXLVL,NUMQMS),
   6860      $ JR(MXLVL,NUMQMS)
   6861       REAL  PLIMIT(4),PRS(3)
   6862       real(8)  alon_8,alat_8
   6863       COMMON/WORD/LWI,LWR
   6864       COMMON/RPTHDR/SUBSET_d,STNID,HDR(2:MXWRDH),alon_8,alat_8
   6865       COMMON/ADP/ISATOB,PMAND(23),RDATA(MAXOBS),IPRINT
   6866       COMMON/SNDATA/DAT(MXLVL,NUMDAT)

Page 155         Source Listing                  SMERGE
2017-04-18 11:09                                 prepdata.f

   6867       COMMON/UPALIM/LEVPM,LEVST,LEVQQ,TDLIM,TDMAX,SPCIAL,ISQNUM_UPA
   6868       COMMON/PARM5/FILLZ,FILLT,FILLW,FILLM,LSWIND,LSMASS,CWINDO,NPZ
   6869       COMMON/PARM6/MODPRT,IFLUA,STNPRT(3)
   6870       EQUIVALENCE(DAT(1,NUMVAR+1),IQ),(TMP(1,NUMVAR+1),JQ),(RDATA,IDATA)
   6871       EQUIVALENCE(DAT(1,NUMVAR+NUMQMS+1),IR),(TMP(1,NUMVAR+NUMQMS+1),JR)
   6872       DATA  XMISS/99999./,YMISS/99998.8/,PLIMIT/200.,100.,50.,150./,
   6873      $ PRS/700.,600.,250./,
   6874 C PREPBUFR TABLE VALUE INTERPRETED AS: 0 - KEEP, 1 - GOOD, 2- DEFAULT,
   6875 C  3 - SUSPECT, 9 - BAD  IN DUPL. LEVEL TBL VALUE COMPARISON
   6876 C  T.V ->    0  1  2  3  4  5  6  7  8  9  10  11  12  13  14  15  16
   6877      $   IC/ 0, 1, 2, 3, 9, 9, 9, 9, 9, 9,  9,  9,  9,  9,  9,  9, 16/
   6878 C FCNS BELOW CONVERT TEMP/TD (K) & PRESS (MB) INTO SAT./ SPEC. HUM.(G/G)
   6879       ES(T) = 6.1078 * EXP((17.269 * (T - 273.16))/((T - 273.16)+237.3))
   6880       QFRMTP(T,P) = (0.622 * ES(T))/(P - (0.378 * ES(T)))
   6881       SCALE = 10.
   6882       RO2G = 287.05/(2.0 * 9.8)
   6883       LSTOP = NINT(STOP*SCALE)
   6884 C FILL TMP ARRAY W/ "MISSING" & PREPBUFR TBL VALS. AS 16 INITIALLY
   6885       TMP = XMISS
   6886       JQ = 16
   6887 C INITIALIZE ALL REASON CODES AS 100 (ORIGINAL DATA)
   6888       JR = 100
   6889 C NS IS NUMBER OF CAT. 2 AND CAT. 5 LEVELS COMBINED
   6890       NS = NSIG + N5
   6891       NSN = NS
   6892 C KLVL IS NUMBER OF CAT. 1, 2, & CAT. 5 LEVELS COMBINED
   6893       KLVL = NM + NS
   6894 C+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
   6895 C DETAILED PRINT FOR SPECIFIED REPORT(S) -- IF ENTERED IN DATA CARDS
   6896       IF(IPRT(2).EQ.1.AND.NUMVAR.LT.11.AND.NUMQMS.LT.9)  THEN
   6897          PRINT 902, STNID
   6898   902 FORMAT(/' SMERGE: ',A8,', CAT. 1,2,5 LVLS PRIOR TO DUPL. CHK')
   6899          IF(KLVL.GT.0)  THEN
   6900             DO N = 1,KLVL
   6901                PRINT 900, (DAT(N,K),K=1,NUMVAR)
   6902                PRINT 905, (IQ(N,L),L=1,NUMQMS)
   6903             ENDDO
   6904          END IF
   6905          PRINT 901
   6906       END IF
   6907 C+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
   6908   900 FORMAT(1X,10F10.2)
   6909   905 FORMAT('+',102X,8I3)
   6910   901 FORMAT('0',//)
   6911 C LASTP IS HIGHEST CAT. 2 OR CAT. 5 LVL WITH MASS INFO. (DEF = 1050 MB)
   6912       LASTP = 1050 * NINT(SCALE)
   6913       IF(NM.LE.0.OR.NS.LE.0)  GO TO 62
   6914 C***********************************************************************
   6915 C      CHECK FOR DUPLICATE LEVELS IN DATA LEVEL CATEGORIES 1, 2, & 5
   6916 C***********************************************************************
   6917 C FIRST, COMPARE CAT. 1 PRESSURE VALUES WITH CAT. 2 PRESSURE VALUES
   6918 C THEN,  COMPARE CAT. 1 PRESSURE VALUES WITH CAT. 5 PRESSURE VALUES
   6919       LOOP1: DO INDEX = 1,2
   6920          L = 1
   6921          NST = NM + 1
   6922          NUMLVL = NSIG
   6923          IF(INDEX.EQ.2)  THEN

Page 156         Source Listing                  SMERGE
2017-04-18 11:09                                 prepdata.f

   6924             NST = NM + NSIG + 1
   6925             NUMLVL = N5
   6926          END IF
   6927          IF(NUMLVL.LE.0)  CYCLE LOOP1
   6928          NLVL = (NST - 1) + NUMLVL
   6929          LOOP1n1: DO N = NST,NLVL
   6930             JP = NINT(DAT(N,1)*SCALE)
   6931             LASTP = MIN(LASTP,JP)
   6932    13       CONTINUE
   6933             IP = NINT(DAT(L,1)*SCALE)
   6934             IF(IP-JP.LT.0)  THEN
   6935                CYCLE LOOP1n1
   6936             ELSE IF(IP-JP.EQ.0)  THEN
   6937                GO TO 11
   6938             END IF
   6939             L = L + 1
   6940             IF(NM-L.LT.0)  THEN
   6941                CYCLE LOOP1
   6942             ELSE
   6943                GO TO 13
   6944             END IF
   6945    11       CONTINUE
   6946 C ALL DUPLICATE CAT. 2 AND/OR CAT. 5 PRESSURE LEVELS WILL BE SET TO 0.0
   6947             DAT(N,1) = 0.0
   6948             NSN = NSN - 1
   6949 C IF DUPLICATE LEVEL IS CATEGORY 5, ADD 60 TO CATEGORY NUMBER
   6950             IF(MOD(IQ(N,3),20).EQ.5)  IQ(L,3) = MOD(IQ(L,3),20) + 60
   6951             IF(IC(IQ(N,2)).LT.IC(IQ(L,2)))  THEN
   6952 C IF DUPL. CAT. 1 TEMP IS OF POORER QUALITY, GIVE IT THE CAT. 2/5 VALUE
   6953                IQ(L,2) = IQ(N,2)
   6954                DAT(L,3) = DAT(N,3)
   6955                IR(L,2) = IR(N,2)
   6956                IR(L,3) = IR(N,3)
   6957             END IF
   6958 C IF DUPLICATE CAT. 1 DWPT MISSING , GIVE IT THE CAT. 2/5 VALUE
   6959             IF(DAT(L,4).GE.XMISS)  DAT(L,4) = DAT(N,4)
   6960 cfix?       IF(DAT(L,4).GE.YMISS)  DAT(L,4) = DAT(N,4)
   6961 C CHECK FOR A SECOND DUPLICATE LEVEL IN CAT. 2 OR 5
   6962             IF(NINT(DAT(N+1,1)*SCALE).EQ.JP)  CYCLE LOOP1n1
   6963             L = L + 1
   6964             IF(L.GT.NM)  CYCLE LOOP1
   6965          ENDDO LOOP1n1
   6966       ENDDO LOOP1
   6967 C-----------------------------------------------------------------------
   6968 C COMPARE CAT. 2 PRESS. W/ THEMSELVES & W/ CAT. 5 PRESS.; LOOK FOR DUPL.
   6969       NST = NM + 1
   6970       LOOP2: DO N = NST,KLVL
   6971          IP = NINT(DAT(N,1)*SCALE)
   6972          LOOP2n1: DO M = NST,KLVL
   6973             IF(M.EQ.N)  CYCLE LOOP2n1
   6974             JP = NINT(DAT(M,1)*SCALE)
   6975             IF(IP.NE.JP)  CYCLE LOOP2n1
   6976 C IT MAKES NO SENSE TO COMPARE TWO ZERO'ED OUT LEVELS
   6977             IF(IP.EQ.0)  CYCLE LOOP2n1
   6978 C THE HIGHER OF THE TWO DUPL. CAT. 2/5 PRESSURE LVLS WILL BE SET TO 0.0
   6979             NSN = NSN - 1
   6980             DAT(M,1) = 0.0

Page 157         Source Listing                  SMERGE
2017-04-18 11:09                                 prepdata.f

   6981 C IF DUPLICATE LEVEL IS CATEGORY 5, ADD 60 TO CATEGORY NUMBER
   6982             IF(MOD(IQ(M,3),20).EQ.5)  IQ(N,3) = MOD(IQ(N,3),20) + 60
   6983             IF(IC(IQ(M,4)).LT.IC(IQ(N,4)))  THEN
   6984 C IF DUPL. LOWER LVL WIND IS OF POORER QUALITY, GIVE IT HIGHER LVL VALUE
   6985                IQ(N,4) = IQ(M,4)
   6986                DAT(N,5) = DAT(M,5)
   6987                DAT(N,6) = DAT(M,6)
   6988                IR(N,4) = IR(M,4)
   6989             END IF
   6990             IF(IC(IQ(M,2)).LT.IC(IQ(N,2)))  THEN
   6991 C IF DUPL. LOWER LVL TEMP IS OF POORER QUALITY, GIVE IT HIGHER LVL VALUE
   6992                IQ(N,2) = IQ(M,2)
   6993                DAT(N,3) = DAT(M,3)
   6994                IR(N,2) = IR(M,2)
   6995                IR(N,3) = IR(M,3)
   6996             END IF
   6997 C IF DUPLICATE LOWER LEVEL DWPT MISSING, GIVE IT HIGHER LVL VALUE
   6998             IF(DAT(N,4).GE.XMISS)  DAT(N,4) = DAT(M,4)
   6999 cfix?       IF(DAT(N,4).GE.YMISS)  DAT(N,4) = DAT(M,4)
   7000          ENDDO LOOP2n1
   7001       ENDDO LOOP2
   7002 C***********************************************************************
   7003    62 CONTINUE
   7004 C+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
   7005 C DETAILED PRINT FOR SPECIFIED REPORT(S) -- IF ENTERED IN DATA CARDS
   7006       IF(IPRT(2).EQ.1.AND.NUMVAR.LT.11.AND.NUMQMS.LT.9)  THEN
   7007          PRINT 903, STNID
   7008   903 FORMAT(/' SMERGE: ',A8,', CAT. 1,2,5 LVLS W/ DUPL. ZEROED OUT')
   7009          IF(KLVL.GT.0)  THEN
   7010             DO N = 1,KLVL
   7011                PRINT 900, (DAT(N,K),K=1,NUMVAR)
   7012                PRINT 905, (IQ(N,L),L=1,NUMQMS)
   7013             ENDDO
   7014          END IF
   7015          PRINT 901
   7016       END IF
   7017 C+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
   7018       IF(LASTP.LT.LSTOP)  LASTP = LSTOP
   7019 C NSTA IS TOTAL NO. OF LVLS IN ALL DATA LEVEL CATEGORIES PLUS SPEC. 25
   7020 C  OR 50MB LVLS
   7021       NSTA = NM + NS + NP + NH + N15
   7022 C IF MODPRT SMALL, STD. O-PUT PRINT NO. OF LVL IN EACH DATA LEVEL
   7023 C  CATEGORY. FOR ALL RPTS
   7024       IF(MODPRT.LE.300.AND.MODPRT.GE.0)
   7025      $ PRINT 9090,STNID,IDATA(9),NSTA,NM,NSIG,N5,NP,NH,N15,
   7026      $ REAL(LASTP)/SCALE
   7027  9090 FORMAT(1X,'ID ',A8,' DUMP RT.=',I3,', NLVLS: TOT=',I2,', CAT 1='
   7028      $,I2,', CAT 2=',I2,', CAT 5=',I2,', CAT 3+SPEC LVLS=',I2,', CAT 4='
   7029      $,I2,', CAT 15=',I2,' - TOP SIG P(W/MASS)=',F6.1,'MB')
   7030       IF(IPRT(1).EQ.1.OR.IPRT(2).EQ.1)  THEN
   7031          PRINT 1902, STNID
   7032  1902 FORMAT(//,15X,'>>> COMPLETE LISTING OF DATA FOR STATION ID ',A8,
   7033      $ '  - PRIOR TO MERGING OF UPPER-AIR CATEGORIES <<<',//)
   7034          CTYPE = 'VIRT.'
   7035          IF(ISATOB.EQ.0.AND.IDATA(9).NE.77)  CTYPE = 'SENS.'
   7036          PRINT 899, CTYPE
   7037   899 FORMAT(2X,'     UPPER-',4X,'PRESSURE',6X,'HEIGHT',4X,

Page 158         Source Listing                  SMERGE
2017-04-18 11:09                                 prepdata.f

   7038      $ A5,' TEMP.',4X,'DEWPOINT',4X,'U-WIND',7X,
   7039      $ 'V-WIND',5X,'HGHT',5X,'TEMP',5X,'WIND',3X,'VERT. COORD.'/,2X,
   7040      $ 'AIR CATEGORY',5X,'(MB)',9X,'(GPM)',8X,'(K)',10X,'(K)',8X,'(M/S)'
   7041      $ ,8X,'(M/S)',4X,'TV/RC',4X,'TV/RC',4X,'TV/RC',4X,'  TV/RC'/)
   7042          PRINT 7901, (IQ(N,3),(DAT(N,K),K=1,6),IQ(N,1),IR(N,1),IQ(N,2),
   7043      $    IR(N,2),IQ(N,4),IR(N,4),IQ(N,5),IR(N,5),N=1,NSTA)
   7044  7901    FORMAT(6X,I2,F16.2,F14.2,F12.2,F13.2,F11.2,F13.2,I6,'/',I3,
   7045      $    I5,'/',I3,I5,'/',I3,I7,'/',I3)
   7046          PRINT 7902
   7047       END IF
   7048  7902 FORMAT(//)
   7049       IF(KLVL.LE.0)  GO TO 63
   7050       KS = 0
   7051       IF(KLVL.EQ.1)  KS(1) = 1
   7052 C***********************************************************************
   7053 C               MERGE MANDATORY (DATA LEVEL CAT. 1) AND
   7054 C            SIGNIFICANT (DATA LEVEL CAT. 2,5) LEVEL DATA
   7055 C***********************************************************************
   7056 C
   7057 C FIRST, ARRANGE LEVELS IN ORDER OF DECREASING PRESSURE (FIRST ORDER
   7058 C  SORT KEY, SECOND ORDER SORT KEY IS HEIGHT)
   7059 C .. MUST SWITCH ORDER OF ELEMENTS IN DAT ARRAY - CALL IT DATINV
   7060       DO  J=1,NUMDAT
   7061          DATINV(J,1:KLVL) = DAT(1:KLVL,J)
   7062       END DO
   7063       IF(KLVL.GE.2)  THEN
   7064          CALL ORDERS( 2,IWORK,DATINV(2,1),KS,KLVL,NUMDAT,LWR,2)
   7065          CALL ORDERS(12,IWORK,DATINV(1,1),KS,KLVL,NUMDAT,LWR,2)
   7066       END IF
   7067       J = 0
   7068 C .. TMP ARRAY LIKE DATINV ARRAY, BUT P-LVLS ARRANGED PROPERLY & DUPL.
   7069 C    REMOVED, ALSO ORDER OF ELEMENTS SWITCHED BACK
   7070       DO N = 1,KLVL
   7071          L = KS(KLVL-N+1)
   7072          IF(DATINV(1,L).GE.0.4)  THEN
   7073             J = J + 1
   7074             TMP(J,1:NUMDAT) = DATINV(1:NUMDAT,L)
   7075          END IF
   7076       ENDDO
   7077 C INITIALIZE VIRTUAL TEMPERATURE ARRAY WITH REPORTED TEMPERATURE
   7078 C  {REPORTED TEMPERATURE IS SENSIBLE FOR ALL NON-SATELLITE TYPES,
   7079 C   VIRTUAL FOR RTOVS OR ATOVS (UNPACKED NMCEDS)}
   7080       VTMP = TMP(:,3)
   7081       KLVL = J
   7082       DO N = 1,KLVL
   7083          IP = NINT(TMP(N,1)*SCALE)
   7084 C TEMP PREPBUFR TBL VAL. .GE. 2 IF DWPT MSG OR .LT. TDLIM & RPT BELOW
   7085 C  400 MB OR RPT ABOVE LASTP LEVEL
   7086          IF(IP.LT.LASTP)  JQ(N,2) = MAX(2,JQ(N,2))
   7087 cfix?    IF((TMP(N,4).GE.YMISS.OR.TMP(N,4).LT.TDLIM).AND.IP.GE.
   7088          IF((TMP(N,4).GE.XMISS.OR.TMP(N,4).LT.TDLIM).AND.IP.GE.
   7089      $    400*NINT(SCALE))  JQ(N,2) = MAX(2,JQ(N,2))
   7090 C NEED VIRT. TEMP. TO COMPUTE SIG. LVL HGHTS HYDROSTATICALLY --
   7091 C FOR RAOB, REPORTED TEMP SENSIBLE, MUST CALCULATE VIRTUAL TEMP
   7092 C FOR RTOVS OR ATOVS (UNPACKED NMCEDS), REPORTED TEMP. ALREADY VIRT.
   7093 cfix?    IF(JQ(N,2).LT.16.AND.TMP(N,4).LT.YMISS.AND.TMP(N,4).GE.0.0.AND.
   7094          IF(JQ(N,2).LT.16.AND.TMP(N,4).LT.XMISS.AND.TMP(N,4).GE.0.0.AND.

Page 159         Source Listing                  SMERGE
2017-04-18 11:09                                 prepdata.f

   7095      $    JQ(N,5).NE.15.AND.ISATOB.EQ.0)  THEN
   7096 C Q (SPECIFIC HUMIDITY) USED TO CALC. VIRTUAL TEMPERATURE (IF > 0)
   7097             Q = QFRMTP(TMP(N,4),TMP(N,1))
   7098             IF(Q.GE.0.0)  THEN
   7099                TMPV = TMP(N,3) * (1.0 + (0.61 * Q))
   7100               IF(TMPV.GE.375..OR.(TMPV.GE.325.AND.TMP(N,1).LT.100.))THEN
   7101 C IF CALC. VIRT. TEMP >375 K ( >325 K ABOVE 100 MB): USE SENS. TEMP IN
   7102 C  CALC.& SET Q.M. TO 15; (KEEP DEWPOINT TEMPERATURE)
   7103           ! this should not be monitored by GSI!! (but is since qm=15)
   7104                   JQ(N,2) = 15
   7105                   PRINT 7983, STNID,TMP(N,1),N,TMP(N,3),TMP(N,4),TMPV
   7106  7983 FORMAT(' * * T FLGGD, CAT2 Z CALC W/ S.TEMP;ID=',A8,', AT LVL '
   7107      $,F6.1,'MB(',I2,') - S.TEMP (',F6.1,') AND/OR DWPT (',F6.1,') BAD',
   7108      $ ', V.TEMP=',F6.1)
   7109                ELSE
   7110                   VTMP(N) = TMPV
   7111                END IF
   7112             END IF
   7113          END IF
   7114       ENDDO
   7115 C+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
   7116 C DETAILED PRINT FOR SPECIFIED REPORT(S) -- IF ENTERED IN DATA CARDS
   7117       IF(IPRT(2).EQ.1.AND.NUMVAR+1.LT.11.AND.NUMQMS.LT.9)  THEN
   7118          PRINT 904, STNID, NUMVAR+1
   7119   904 FORMAT(/' SMERGE: ',A8,', CAT. 1,2,5 LVLS SORTED, PRIOR TO HYDRO',
   7120      $ ' - VIRT. TEMP IN COLUMN',I3)
   7121          DO N = 1,KLVL
   7122             PRINT 900, (TMP(N,K),K=1,NUMVAR),VTMP(N)
   7123             PRINT 905, (JQ(N,L),L=1,NUMQMS)
   7124          ENDDO
   7125          PRINT 901
   7126       END IF
   7127 C+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
   7128       IF(KLVL.LE.1.OR.NSN.LE.0)  GO TO 63
   7129 C-----------------------------------------------------------------------
   7130 C           COMPUTE SIGNIFICANT LEVEL HEIGHTS HYDROSTATICALLY
   7131 C-----------------------------------------------------------------------
   7132       DO N = 1,KLVL
   7133          NTT  = N
   7134          NST = NTT
   7135          IF(JQ(NTT,1).LT.16.AND.JQ(NTT,2).LT.16)  GO TO 802
   7136       ENDDO
   7137       GO TO 63
   7138   802 CONTINUE
   7139       IF(FILLZ.AND.(IPRT(1).EQ.1.OR.IPRT(2).EQ.1).AND.JQ(NTT,1).LT.16)
   7140      $ PRINT 800, STNID
   7141   800 FORMAT(/,45X,'>>> HYDROSTATIC CHECK FOR STN. ID = ',A8,' <<<',
   7142      $ //,1X,'MAND. PRES.',3X,'VIRT. TEMP',3X,'REPORTED',3X,
   7143      $ 'INTEGRATED ',3X,'TV- ',3X,'TV- ',2X,'!   NEXT SIG/MAND  ',3X,
   7144      $ 'VIRT. TEMP',3X,'INTEGR./REPORTED',2X,'TV- ',/,1X,' LEVEL (MB)',
   7145      $ 3X,'   (K)',6X,' HGHT (M)  ',2X,'HGHT (M)',5X,'TEMP',
   7146      $ 3X,'HGHT',2X,'!  PRES BELOW (MB)',3X,'    (K)  ',9X,'HGHT(M)  ',
   7147      $ 5X,'HGHT',/,66X,'!')
   7148 C SET DEFAULTS IN CASE FIRST LEVEL PREPBUFR TABLE VALUE > 7
   7149 C  (PLIMIT = 150., SET BY KPM)
   7150       PBOT = TMP(NTT,1)
   7151       KPM = 4

Page 160         Source Listing                  SMERGE
2017-04-18 11:09                                 prepdata.f

   7152       NST = NTT
   7153       LOOP3: DO N = NTT,MXLVL
   7154          PLO = TMP(N,1)
   7155          ZLO = TMP(N,2)
   7156          TLO = VTMP(N)
   7157          JQN1 = JQ(N,1)
   7158          IF(JQ(N,1).EQ.17)  THEN
   7159             JQN1 = 15
   7160          ELSE  IF(JQ(N,1).EQ.-3)  THEN
   7161             JQN1 = 3
   7162          ELSE  IF(JQ(N,1).EQ.-1)  THEN
   7163             JQN1 = 2
   7164          END IF
   7165          IZQM = MAX(JQN1,JQ(N,2))
   7166 C IF PRESSURE Q.M. IS BAD(15), THEN SET NON-MISSING IZQM AS BAD(15)
   7167          IF(JQ(N,5).EQ.15)  IZQM = MAX(15,IZQM)
   7168          IF(IZQM.LT.16.AND.IZQM.GT.3)  THEN
   7169             IZQM = 15
   7170          ELSE  IF(IZQM.LT.3)  THEN
   7171             IZQM =  2
   7172          END IF
   7173          IF(JQN1.LT.3)  THEN
   7174             PBOT = PLO
   7175 C PLIMIT IS SET BY INDEX KPM (KPM=1 - 200; KPM=2 - 100; KPM=3 - 50)
   7176             DO I = 1,3
   7177                IF(PBOT.LE.PRS(I))  KPM = I
   7178             ENDDO
   7179             NST = N + 1
   7180          END IF
   7181          NN = N + 1
   7182          IF(NN.GT.KLVL)  GO TO 63
   7183          ZNEW = ZLO - (RO2G * (VTMP(NN) + TLO) * ALOG(TMP(NN,1)/PLO))
   7184          NEWP = TMP(NN,1)
   7185          PDIF = PLO - TMP(NN,1)
   7186          ZLIMIT = 30. - (REAL(NEWP)/50.)
   7187          JQNN1 = JQ(NN,1)
   7188          IF(JQ(NN,1).EQ.17)  THEN
   7189             JQNN1 = 15
   7190          ELSE  IF(JQ(NN,1).EQ.-3)  THEN
   7191             JQNN1 = 3
   7192          ELSE  IF(JQ(NN,1).EQ.-1)  THEN
   7193             JQNN1 = 2
   7194          END IF
   7195          IF(FILLZ.AND.(IPRT(1).EQ.1.OR.IPRT(2).EQ.1).AND.JQNN1.LT.16)
   7196      $    PRINT 801, TMP(NN,1),VTMP(NN),TMP(NN,2),ZNEW,JQ(NN,2),JQNN1,
   7197      $    PLO,TLO,ZLO,IZQM
   7198   801    FORMAT(3X,F7.2,6X,F7.2,4X,F9.2,3X,F9.2,4X,I3,4X,I3,'    !  ',
   7199      $    3X,F7.2,10X,F7.2,7X,F9.2,6X,I3)
   7200          IF(JQNN1.LT.3)  THEN
   7201 C.......................................................................
   7202 C LEVEL NN CONTAINS GOOD HGHT INFO. (GENERALLY A MANDATORY LEVEL)
   7203             ZDIF = ABS(TMP(NN,2) - ZNEW)
   7204             IF(ZDIF.LT.ZLIMIT.AND.PDIF.LE.PLIMIT(KPM)+.001)  THEN
   7205                CALL HSTATS(TMP(NN,2),ZNEW,RDATA(2),RDATA(1),NEWP)
   7206                CYCLE LOOP3
   7207             END IF
   7208             IF(NN.EQ.NST)  CYCLE LOOP3

Page 161         Source Listing                  SMERGE
2017-04-18 11:09                                 prepdata.f

   7209 C IF ZLIMIT OR PLIMIT EXCEEDED SET HGHT PREPBUFR T. VAL=9 BETWEEN THIS &
   7210 C  LAST GOOD HGHT LVL (PREPBUFR TBL VAL.=17 IF FILLZ=F & NOT A MANDATORY
   7211 C  LEVEL, OTHERWISE SUBR. WNDBYP WOULD ATTEMPT A HEIGHT CALCULATION)
   7212             NEND = N
   7213             IF(FILLZ)  THEN
   7214                PUP = TMP(NN,1)
   7215                IF(ZDIF.GE.ZLIMIT)  PRINT 20, STNID,TMP(NST,1),NST,
   7216      $          TMP(NEND,1),NEND,ZDIF,ZLIMIT,PUP
   7217    20 FORMAT(' * * HGHT PREPBUFR T. V. SET TO 15, ID=',A8,', LVLS',
   7218      $ ' BETWN ',F6.1,'(',I2,')& ',F6.1,'MB(',I2,')INCL.-ZDIF(',F6.1,
   7219      $ 'M) GE ZLIMIT(',F6.1,'M)AT ',F6.1,'MB')
   7220                IF(PDIF.GT.PLIMIT(KPM)+.001)  PRINT 1920, STNID,
   7221      $          TMP(NST,1),NST,TMP(NEND,1),NEND,PLO,PUP,PLIMIT(KPM)
   7222  1920 FORMAT(' * * HGHT PREPBUFR T. V. SET TO 15, ID=',A8,', LVLS',
   7223      $ ' BETWN ',F6.1,'(',I2,')& ',F6.1,'MB(',I2,')INCL.-PDIF ',F6.1,
   7224      $ ' TO ',F6.1,'MB GT PLIMIT(',F6.1,'MB')
   7225             END IF
   7226             DO NNF = NST,NEND
   7227                JQNNF1 = JQ(NNF,1)
   7228                JQ(NNF,1) = 15
   7229                IF(.NOT.FILLZ.AND.(MOD(JQ(NNF,3),20).NE.1.OR.JQNNF1.GE.
   7230      $          16)) JQ(NNF,1) = 17
   7231             ENDDO
   7232          ELSE  IF(JQNN1.GE.16)  THEN
   7233 C.......................................................................
   7234 C LVL NN IS CAT. 1/2 LVL W/ MSG HGHT -- FILL IN NEW CALC. HGHT AND
   7235 C  PREPBUFR TABLE VALUE
   7236             TMP(NN,2) = ZNEW
   7237             IZQM2 = MAX(IZQM,JQ(NN,2))
   7238 C IF PRESSURE Q.M. IS BAD(15), THEN SET NON-MISSING IZQM2 AS BAD(15)
   7239             IF(JQ(NN,5).EQ.15)  IZQM2 = MAX(15,IZQM2)
   7240             IF(IZQM2.LT.16.AND.IZQM2.GT.3)  THEN
   7241                IZQM2 = 15
   7242             ELSE  IF(IZQM2.LT.3)  THEN
   7243                IZQM2 =  2
   7244             END IF
   7245             JQ(NN,1) = IZQM2
   7246 C EVENT#103 -  HEIGHT CREATED FROM HYDROSTATIC INTEGRATION OF RPTED DATA
   7247             IF(FILLZ)  JR(NN,1) = 103
   7248             IF(IZQM2.NE.16.AND..NOT.FILLZ)  THEN
   7249 C IF FILLZ=F & PREPBUFR TBL VAL NOT 16, SET HGT PREPBUFR TBL VAL =-1 IF
   7250 C  NON-BAD/SUSPECT, HGT PREPBUFR TBL VALUE =-3 IF SUSPECT, AND HGT
   7251 C  PREPBUFR TABLE VALUE =17 IF BAD
   7252                JQ(NN,1) = -1
   7253                IF(IZQM2.EQ.3) JQ(NN,1)=-3
   7254                IF(IZQM2.GT.3.OR.PDIF.GT.PLIMIT(KPM)+.001)  JQ(NN,1) = 17
   7255             END IF
   7256             IF(FILLZ.AND.PDIF.GT.PLIMIT(KPM)+.001)  THEN
   7257 C IF FILLZ=T, HGHT PREPBUFR TBL VALUE SET TO 15 IF PLIMIT EXCEEDED
   7258                PRINT 7821, STNID,TMP(NN,1),NN,PLO,TMP(NN,1),PLIMIT(KPM)
   7259                JQ(NN,1) = 15
   7260  7821 FORMAT(' * * HGHT PREPBUFR T. V. SET TO 15, ID = ',A8,', AT LVL '
   7261      $,F6.1,'MB(',I2,') - PDIF ',F6.1,' TO ',F6.1,'MB GT PLIMIT(',F6.1,
   7262      $ 'MB)')
   7263             END IF
   7264             IF(NN.GE.KLVL)  GO TO 63
   7265          END IF

Page 162         Source Listing                  SMERGE
2017-04-18 11:09                                 prepdata.f

   7266       ENDDO LOOP3
   7267 C***********************************************************************
   7268    63 CONTINUE
   7269 C+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
   7270 C DETAILED PRINT FOR SPECIFIED REPORT(S) -- IF ENTERED IN DATA CARDS
   7271       IF(IPRT(2).EQ.1.AND.NUMVAR+1.LT.11.AND.NUMQMS.LT.9)  THEN
   7272          PRINT 1905, STNID,NUMVAR+1
   7273  1905 FORMAT(/' SMERGE: ',A8,', CAT. 1,2,5 LVLS W/ HYDRO, CALL"WNDBYP"',
   7274      $ ' - VIRT. TEMP IN COLUMN',I3)
   7275          IF(KLVL.GT.0)  THEN
   7276             DO N = 1,KLVL
   7277                PRINT 900, (TMP(N,K),K=1,NUMVAR),VTMP(N)
   7278                PRINT 905, (JQ(N,L),L=1,NUMQMS)
   7279             ENDDO
   7280          END IF
   7281          PRINT 901
   7282       END IF
   7283 C+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
   7284 C MERGE WINDS BY PRESSURE (DATA LEVEL CAT.3 + "SPEC." 25/50MB PRES.)
   7285 C  INTO TMP ARRAY
   7286       IF(NP.GT.0)  CALL WNDBYP(NM,NS,NP,KLVL,TMP,JQ,JR,IPRT,VTMP)
   7287 C MERGE WINDS BY HEIGHT (DATA LEVEL CAT. 4) INTO TMP ARRAY
   7288       IF(NH.GT.0)  CALL WNDBYZ(NM,NS,NP,NH,KLVL,TMP,JQ,IPRT,VTMP)
   7289 C TEMPERATURES BY HEIGHT (DATA LEVEL CAT. 15) ALREADY HAVE STD. ATMOS.
   7290 C  PRESSURE AND ARE NEVER MERGED WITH ANY OTHER CATEGORY AT THIS TIME,
   7291 C  NOTHING MORE NEEDS TO BE DONE EXCEPT TRANSFER DAT ARRAY TO TMP ARRAY)
   7292       IF(N15.GT.0)  THEN
   7293          KLVL = N15
   7294          TMP = DAT
   7295       END IF
   7296 C FILL MISSING WINDS INTO TMP ARRAY IF FILLW = TRUE
   7297 C  NOTE: THIS MUST BE CALLED FOR FOR RAOB AND PIBAL REPORTS EVEN IF
   7298 C        FILLW IS FALSE BECAUSE INTERPOLATED WINDS ARE USED TO OBTAIN
   7299 C        BALLOON DRIFT LAT/LON (IF FILLW=F, INTERPOLATED WINDS ARE
   7300 C        LATER EXCLUDED)
   7301       IF(FILLW.OR.HDR(6).EQ.120)  CALL FILWND(KLVL,TMP,JQ,JR,IPRT)
   7302 C FILL MISSING DEWPOINTS INTO TMP ARRAY
   7303       IF(FILLM)  CALL FILDPT(KLVL,TMP,JQ,JR,IPRT)
   7304       DO N = 1,KLVL
   7305 C-----------------------------------------------------------------------
   7306 C  Changes to Height PREPBUFR Table Value
   7307 C-----------------------------------------------------------------------
   7308 C CHANGE T.V. FOR MISSING HEIGHTS (STANDARD ATMOSPHERE) FROM 16 TO 17
   7309          IF(JQ(N,1).EQ.16)  JQ(N,1) = 17
   7310 C IF FILLZ=F, CHANGE T.V. -1,-2,-3 TO 16
   7311          IF(JQ(N,1).LE.-1)  JQ(N,1) = 16
   7312          IF(.NOT.FILLZ.AND.MOD(JQ(N,3),20).EQ.4)  THEN
   7313 C IF FILLZ=F AND CAT. 4/15 ...
   7314             IF(JQ(N,1).GT.3.AND.JQ(N,1).LT.16)  THEN
   7315 C ... CHANGE T.V. FOR BAD HEIGHTS (4-15) TO 17
   7316                JQ(N,1) = 17
   7317             ELSE IF(JQ(N,1).NE.17)  THEN
   7318 C ... CHANGE T.V. 0-3,16 TO 16
   7319                JQ(N,1) = 16
   7320             END IF
   7321          END IF
   7322 C AT THIS POINT, HEIGHTS WITH Q.M. .GE. 16 WILL BE EXCLUDED FROM OUTPUT

Page 163         Source Listing                  SMERGE
2017-04-18 11:09                                 prepdata.f

   7323 C  PREPBUFR FILE, HOWEVER HEIGHTS WITH Q.M. 16 (INTERPOLATED FROM
   7324 C  NON-BAD BRACKETING HEIGHT LVLS WHEN FILLZ=F) WILL BE USED IN BALLOON
   7325 C  DRIFT CALC
   7326 C-----------------------------------------------------------------------
   7327 C  Changes to Wind PREPBUFR Table Value
   7328 C-----------------------------------------------------------------------
   7329 C CHANGE T.V. FOR MISSING WINDS FROM 16 TO 17
   7330          if(jq(n,4).eq.16)  jq(n,4) = 17
   7331 C IF FILLW=F, CHANGE T.V. -1,-2,-3 TO 16
   7332          if(jq(n,4).le.-1)  jq(n,4) = 16
   7333 C AT THIS POINT, WINDS WITH Q.M. .GE. 16 WILL BE EXCLUDED FROM OUTPUT
   7334 C  PREPBUFR FILE, HOWEVER WINDS WITH Q.M. 16 (INTERPOLATED FROM NON-BAD
   7335 C  BRACKETING WIND LVLS WHEN FILLW=F) WILL BE USED IN BALLOON DRIFT CALC
   7336 C-----------------------------------------------------------------------
   7337 C IF FILLT=F, RESET T PREPBUFR T. V. -1,-7, 11 BACK TO 16 TO EXCL. INFO.
   7338          IF(JQ(N,2).LE.-1.OR.JQ(N,2).EQ.17)  JQ(N,2) = 16
   7339       ENDDO
   7340 C TRANSFER TMP ARRAY BACK TO DAT ARRAY
   7341       DAT = TMP
   7342       NLEV = KLVL
   7343       RETURN
   7344       END


ENTRY POINTS

  Name               
                     
 smerge_             

Page 164         Source Listing                  SMERGE
2017-04-18 11:09 Symbol Table                    prepdata.f



SYMBOL CROSS REFERENCE

 Name                       Object Declared Type            Bytes Dimen Elements Attributes       References                        
                                                                                                                                    
 11                         Label  6945                                                           6937                              
 13                         Label  6932                                                           6943                              
 1902                       Label  7032                                                           7031                              
 1905                       Label  7273                                                           7272                              
 1920                       Label  7222                                                           7220                              
 20                         Label  7217                                                           7215                              
 62                         Label  7003                                                           6913                              
 63                         Label  7268                                                           7049,7128,7137,7182,7264          
 7821                       Label  7260                                                           7258                              
 7901                       Label  7044                                                           7042                              
 7902                       Label  7048                                                           7046                              
 7983                       Label  7106                                                           7105                              
 800                        Label  7141                                                           7140                              
 801                        Label  7198                                                           7196                              
 802                        Label  7138                                                           7135                              
 899                        Label  7037                                                           7036                              
 900                        Label  6908                                                           6901,7011,7122,7277               
 901                        Label  6910                                                           6905,7015,7125,7281               
 902                        Label  6898                                                           6897                              
 903                        Label  7008                                                           7007                              
 904                        Label  7119                                                           7118                              
 905                        Label  6909                                                           6902,7012,7123,7278               
 9090                       Label  7027                                                           7025                              
 ABS                        Func   7203                                 scalar                    7203                              
 ADP                        Common 6865                                 14100                                                       
 ALAT_8                     Scalar 6862     R(8)            8           scalar   COM                                                
 ALOG                       Func   7183                                 scalar                    7183                              
 ALON_8                     Scalar 6862     R(8)            8           scalar   COM                                                
 CTYPE                      Local  6856     CHAR            5           scalar                    7034,7035,7036                    
 CWINDO                     Scalar 6868     R(4)            4           scalar   COM                                                
 DAT                        Scalar 6866     R(4)            4     2     9600     COM              6901,6930,6933,6947,6954,6959,6962
                                                                                                  ,6971,6974,6980,6986,6987,6993,699
                                                                                                  8,7011,7042,7061,7294,7341        
 DATINV                     Local  6854     R(4)            4     2     9600                      7061,7064,7065,7072,7074          
 ES                         Local  6879     R(4)            4           scalar                    6880                              
 EXP                        Func   6879                                 scalar                    6879                              
 FILDPT                     Subr   7303                                                           7303                              
 FILLM                      Scalar 6855     L(4)            4           scalar   COM              7303                              
 FILLT                      Scalar 6868     R(4)            4           scalar   COM                                                
 FILLW                      Scalar 6855     L(4)            4           scalar   COM              7301                              
 FILLZ                      Scalar 6855     L(4)            4           scalar   COM              7139,7195,7213,7229,7247,7248,7256
                                                                                                  ,7312                             
 FILWND                     Subr   7301                                                           7301                              
 HDR                        Scalar 6864     R(4)            4     1     14       COM              7301                              
 HSTATS                     Subr   7205                                                           7205                              
 I                          Local  7176     I(4)            4           scalar                    7176,7177                         
 IC                         Local  6859     I(4)            4     1     17                        6877,6951,6983,6990               
 IDATA                      Scalar 6858     I(4)            4     1     3500     COM              7025,7035                         
 IFLUA                      Scalar 6869     I(4)            4           scalar   COM                                                
 INDEX                      Local  6919     I(4)            4           scalar                    6919,6923                         
 IP                         Local  6933     I(4)            4           scalar                    6933,6934,6936,6971,6975,6977,7083

Page 165         Source Listing                  SMERGE
2017-04-18 11:09 Symbol Table                    prepdata.f

 Name                       Object Declared Type            Bytes Dimen Elements Attributes       References                        
                                                                                                                                    
                                                                                                  ,7086,7088                        
 IPRINT                     Scalar 6865     I(4)            4           scalar   COM                                                
 IPRT                       Dummy  6847     I(4)            4     1     2        ARG,INOUT        6896,7006,7030,7117,7139,7195,7271
                                                                                                  ,7286,7288,7301,7303              
 IQ                         Scalar 6858     I(4)            4     2     3000     COM              6902,6950,6951,6953,6982,6983,6985
                                                                                                  ,6990,6992,7012,7042,7043         
 IR                         Scalar 6859     I(4)            4     2     3000     COM              6955,6956,6988,6994,6995,7042,7043
 ISATOB                     Scalar 6865     I(4)            4           scalar   COM              7035,7095                         
 ISQNUM_UPA                 Scalar 6867     I(4)            4           scalar   COM                                                
 IWORK                      Local  6853     I(4)            4     1     600                       7064,7065                         
 IZQM                       Local  7165     I(4)            4           scalar                    7165,7167,7168,7169,7170,7171,7197
                                                                                                  ,7237                             
 IZQM2                      Local  7237     I(4)            4           scalar                    7237,7239,7240,7241,7242,7243,7245
                                                                                                  ,7248,7253,7254                   
 J                          Local  7060     I(4)            4           scalar                    7060,7061,7067,7073,7074,7081     
 JP                         Local  6930     I(4)            4           scalar                    6930,6931,6934,6936,6962,6974,6975
 JQ                         Local  6859     I(4)            4     2     3000                      6886,7086,7089,7094,7095,7104,7123
                                                                                                  ,7135,7139,7157,7158,7160,7162,716
                                                                                                  5,7167,7187,7188,7190,7192,7196,72
                                                                                                  27,7228,7229,7230,7237,7239,7245,7
                                                                                                  252,7253,7254,7259,7278,7286,7288,
                                                                                                  7301,7303,7309,7311,7312,7314,7316
                                                                                                  ,7317,7319,7330,7332,7338         
 JQN1                       Local  7157     I(4)            4           scalar                    7157,7159,7161,7163,7165,7173     
 JQNN1                      Local  7187     I(4)            4           scalar                    7187,7189,7191,7193,7195,7196,7200
                                                                                                  ,7232                             
 JQNNF1                     Local  7227     I(4)            4           scalar                    7227,7229                         
 JR                         Local  6860     I(4)            4     2     3000                      6888,7247,7286,7301,7303          
 K                          Local  6901     I(4)            4           scalar                    6901,7011,7042,7122,7277          
 KLVL                       Local  6893     I(4)            4           scalar                    6893,6899,6900,6970,6972,7009,7010
                                                                                                  ,7049,7051,7061,7063,7064,7065,707
                                                                                                  0,7071,7081,7082,7121,7128,7132,71
                                                                                                  82,7264,7275,7276,7286,7288,7293,7
                                                                                                  301,7303,7304,7342                
 KPM                        Local  7151     I(4)            4           scalar                    7151,7177,7204,7220,7221,7254,7256
                                                                                                  ,7258                             
 KS                         Local  6858     I(4)            4     1     600                       7050,7051,7064,7065,7071          
 L                          Local  6902     I(4)            4           scalar                    6902,6920,6933,6939,6940,6950,6951
                                                                                                  ,6953,6954,6955,6956,6959,6963,696
                                                                                                  4,7012,7071,7072,7074,7123,7278   
 LASTP                      Local  6912     I(4)            4           scalar                    6912,6931,7018,7026,7086          
 LEVPM                      Scalar 6867     I(4)            4           scalar   COM                                                
 LEVQQ                      Scalar 6867     I(4)            4           scalar   COM                                                
 LEVST                      Scalar 6867     I(4)            4           scalar   COM                                                
 LOOP1                      Label  6919                                 scalar                    6927,6941,6964,6966               
 LOOP1N1                    Label  6929                                 scalar                    6935,6962,6965                    
 LOOP2                      Label  6970                                 scalar                    7001                              
 LOOP2N1                    Label  6972                                 scalar                    6973,6975,6977,7000               
 LOOP3                      Label  7153                                 scalar                    7206,7208,7266                    
 LSMASS                     Scalar 6868     I(4)            4           scalar   COM                                                
 LSTOP                      Local  6883     I(4)            4           scalar                    6883,7018                         
 LSWIND                     Scalar 6868     I(4)            4           scalar   COM                                                
 LWI                        Scalar 6863     I(4)            4           scalar   COM                                                
 LWR                        Scalar 6863     I(4)            4           scalar   COM              7064,7065                         
 M                          Local  6972     I(4)            4           scalar                    6972,6973,6974,6980,6982,6983,6985

Page 166         Source Listing                  SMERGE
2017-04-18 11:09 Symbol Table                    prepdata.f

 Name                       Object Declared Type            Bytes Dimen Elements Attributes       References                        
                                                                                                                                    
                                                                                                  ,6986,6987,6988,6990,6992,6993,699
                                                                                                  4,6995,6998                       
 MAX                        Func   7086                                 scalar                    7086,7089,7165,7167,7237,7239     
 MAXOBS                     Param  6852     I(4)            4           scalar                    6858,6865                         
 MIN                        Func   6931                                 scalar                    6931                              
 MOD                        Func   6950                                 scalar                    6950,6982,7229,7312               
 MODPRT                     Scalar 6869     I(4)            4           scalar   COM              7024                              
 MXLVL                      Param  6849     I(4)            4           scalar                    6853,6854,6858,6859,6860,6866,7153
 MXWRDH                     Param  6848     I(4)            4           scalar                    6864                              
 N                          Local  6900     I(4)            4           scalar                    6900,6901,6902,6929,6930,6947,6950
                                                                                                  ,6951,6953,6954,6955,6956,6959,696
                                                                                                  2,6970,6971,6973,6982,6983,6985,69
                                                                                                  86,6987,6988,6990,6992,6993,6994,6
                                                                                                  995,6998,7010,7011,7012,7042,7043,
                                                                                                  7070,7071,7082,7083,7086,7088,7089
                                                                                                  ,7094,7095,7097,7099,7100,7104,710
                                                                                                  5,7110,7121,7122,7123,7132,7133,71
                                                                                                  53,7154,7155,7156,7157,7158,7160,7
                                                                                                  162,7165,7167,7179,7181,7212,7276,
                                                                                                  7277,7278,7304,7309,7311,7312,7314
                                                                                                  ,7316,7317,7319,7330,7332,7338    
 N15                        Dummy  6847     I(4)            4           scalar   ARG,INOUT        7021,7025,7292,7293               
 N5                         Dummy  6847     I(4)            4           scalar   ARG,INOUT        6890,6925,7025                    
 NEND                       Local  7212     I(4)            4           scalar                    7212,7216,7221,7226               
 NEWP                       Local  7184     I(4)            4           scalar                    7184,7186,7205                    
 NH                         Dummy  6847     I(4)            4           scalar   ARG,INOUT        7021,7025,7288                    
 NINT                       Func   6883                                 scalar                    6883,6912,6930,6933,6962,6971,6974
                                                                                                  ,7083,7089                        
 NLEV                       Dummy  6847     I(4)            4           scalar   ARG,INOUT        7342                              
 NLVL                       Local  6928     I(4)            4           scalar                    6928,6929                         
 NM                         Dummy  6847     I(4)            4           scalar   ARG,INOUT        6893,6913,6921,6924,6940,6964,6969
                                                                                                  ,7021,7025,7286,7288              
 NN                         Local  7181     I(4)            4           scalar                    7181,7182,7183,7184,7185,7187,7188
                                                                                                  ,7190,7192,7196,7203,7205,7208,721
                                                                                                  4,7236,7237,7239,7245,7247,7252,72
                                                                                                  53,7254,7258,7259,7264            
 NNF                        Local  7226     I(4)            4           scalar                    7226,7227,7228,7229,7230          
 NP                         Dummy  6847     I(4)            4           scalar   ARG,INOUT        7021,7025,7286,7288               
 NPZ                        Scalar 6868     I(4)            4           scalar   COM                                                
 NS                         Local  6890     I(4)            4           scalar                    6890,6891,6893,6913,7021,7286,7288
 NSIG                       Dummy  6847     I(4)            4           scalar   ARG,INOUT        6890,6922,6924,7025               
 NSN                        Local  6891     I(4)            4           scalar                    6891,6948,6979,7128               
 NST                        Local  6921     I(4)            4           scalar                    6921,6924,6928,6929,6969,6970,6972
                                                                                                  ,7134,7152,7179,7208,7215,7221,722
                                                                                                  6                                 
 NSTA                       Local  7021     I(4)            4           scalar                    7021,7025,7043                    
 NTT                        Local  7133     I(4)            4           scalar                    7133,7134,7135,7139,7150,7152,7153
 NUMDAT                     Param  6851     I(4)            4           scalar                    6853,6854,6866,7060,7064,7065,7074
 NUMLVL                     Local  6922     I(4)            4           scalar                    6922,6925,6927,6928               
 NUMQMS                     Param  6850     I(4)            4           scalar                    6851,6858,6859,6860,6871,6896,6902
                                                                                                  ,7006,7012,7117,7123,7271,7278    
 NUMVAR                     Param  6850     I(4)            4           scalar                    6851,6870,6871,6896,6901,7006,7011
                                                                                                  ,7117,7118,7122,7271,7272,7277    
 ORDERS                     Subr   7064                                                           7064,7065                         
 PARM5                      Common 6868                                 32                                                          

Page 167         Source Listing                  SMERGE
2017-04-18 11:09 Symbol Table                    prepdata.f

 Name                       Object Declared Type            Bytes Dimen Elements Attributes       References                        
                                                                                                                                    
 PARM6                      Common 6869                                 32                                                          
 PBOT                       Local  7150     R(4)            4           scalar                    7150,7174,7177                    
 PDIF                       Local  7185     R(4)            4           scalar                    7185,7204,7220,7254,7256          
 PLIMIT                     Local  6861     R(4)            4     1     4                         6872,7204,7220,7221,7254,7256,7258
 PLO                        Local  7154     R(4)            4           scalar                    7154,7174,7183,7185,7197,7221,7258
 PMAND                      Scalar 6865     R(4)            4     1     23       COM                                                
 PRS                        Local  6861     R(4)            4     1     3                         6873,7177                         
 PUP                        Local  7214     R(4)            4           scalar                    7214,7216,7221                    
 Q                          Local  7097     R(4)            4           scalar                    7097,7098,7099                    
 QFRMTP                     Local  6880     R(4)            4           scalar                    7097                              
 RDATA                      Scalar 6865     R(4)            4     1     3500     COM              7205                              
 REAL                       Func   7026                                 scalar                    7026,7186                         
 RO2G                       Local  6882     R(4)            4           scalar                    6882,7183                         
 RPTHDR                     Common 6864                                 88                                                          
 SCALE                      Local  6881     R(4)            4           scalar                    6881,6883,6912,6930,6933,6962,6971
                                                                                                  ,6974,7026,7083,7089              
 SMERGE                     Subr   6847                                                                                             
 SNDATA                     Common 6866                                 38400                                                       
 SPCIAL                     Scalar 6867     R(4)            4           scalar   COM                                                
 STNID                      Scalar 6857     CHAR            8           scalar   COM              6897,7007,7025,7031,7105,7118,7140
                                                                                                  ,7215,7220,7258,7272              
 STNPRT                     Scalar 6857     CHAR            8     1     3        COM                                                
 STOP                       Dummy  6847     R(4)            4           scalar   ARG,INOUT        6883                              
 SUBSET_D                   Scalar 6857     CHAR            8           scalar   COM                                                
 TDLIM                      Scalar 6867     R(4)            4           scalar   COM              7088                              
 TDMAX                      Scalar 6867     R(4)            4           scalar   COM                                                
 TLO                        Local  7156     R(4)            4           scalar                    7156,7183,7197                    
 TMP                        Local  6853     R(4)            4     2     9600                      6885,7074,7080,7083,7088,7094,7097
                                                                                                  ,7099,7100,7105,7122,7150,7154,715
                                                                                                  5,7183,7184,7185,7196,7203,7205,72
                                                                                                  14,7215,7216,7221,7236,7258,7277,7
                                                                                                  286,7288,7294,7301,7303,7341      
 TMPV                       Local  7099     R(4)            4           scalar                    7099,7100,7105,7110               
 UPALIM                     Common 6867                                 28                                                          
 VTMP                       Local  6853     R(4)            4     1     600                       7080,7110,7122,7156,7183,7196,7277
                                                                                                  ,7286,7288                        
 WNDBYP                     Subr   7286                                                           7286                              
 WNDBYZ                     Subr   7288                                                           7288                              
 WORD                       Common 6863                                 8                                                           
 XMISS                      Local  6872     R(4)            4           scalar                    6872,6885,6959,6998,7088,7094     
 YMISS                      Local  6872     R(4)            4           scalar                    6872                              
 ZDIF                       Local  7203     R(4)            4           scalar                    7203,7204,7215,7216               
 ZLIMIT                     Local  7186     R(4)            4           scalar                    7186,7204,7215,7216               
 ZLO                        Local  7155     R(4)            4           scalar                    7155,7183,7197                    
 ZNEW                       Local  7183     R(4)            4           scalar                    7183,7196,7203,7205,7236          

Page 168         Source Listing                  SMERGE
2017-04-18 11:09                                 prepdata.f

   7345 C$$$  SUBPROGRAM DOCUMENTATION BLOCK
   7346 C
   7347 C SUBPROGRAM:    SWNTBL
   7348 C   PRGMMR: D. A. KEYSER     ORG: NP22       DATE: 2015-01-30
   7349 C
   7350 C ABSTRACT: COMPILES COUNTS FOR EACH SATWND TYPE (FOR ALL VALID COMB.
   7351 C   OF PRODUCER/SATELLITE/PRODUCT) AND SUMMARIZES EACH TYPE IN A
   7352 C   SEPARATE TABLE ACCORDING TO LATITUDE BAND (AND ALSO ACCORDING TO
   7353 C   ODD OR EVEN SATELLITE FOR GOES AND ACCORDING TO AQUA OR TERRA
   7354 C   SATELLITE FOR MODIS/POES).  INFORMATION SUCH AS TIME WINDOW,
   7355 C   OVERLAND SWITCH, & PROCESS/NO PROCESS SWITCH ALSO INCLUDED.
   7356 C
   7357 C PROGRAM HISTORY LOG:
   7358 C 1990-02-06  D. A. KEYSER (W/NMC22)
   7359 C 1993-05-31  D. A. KEYSER -- REORGANIZED TO PRINT A SEPARATE TABLE FOR
   7360 C     EACH PRODUCER/SATELLITE/PRODUCT COMBINATION PASSED IN, ALL VALID
   7361 C     COMBINATIONS NOW PRODUCE A UNIQUE TABLE
   7362 C 1996-09-03  D. A. KEYSER -- ADDED PROCESSING FOR NESDIS HI-DENSITY
   7363 C     SAT. WINDS (SWITCHES "SWINDO", "SWNLND", "JSWIND", "JSMASS"
   7364 C     EXPANDED), R.TYPES EXPANDED
   7365 C 2001-04-06  D. A. KEYSER -- N-LIST SWITCH SWINDO SPLIT INTO SWINDO_e
   7366 C     (EARLIEST TIME WINDOW) AND SWINDO_l (LATEST TIME WINDOW) FOR
   7367 C     SATWND REPORTS ("-" PRIOR TO CYCLE TIME, "+" AFTER CYCLE TIME)
   7368 C     (SAME DEFAULTS AS BEFORE)
   7369 C 2004-09-09  D. A. KEYSER -- ADDED PROCESSING OF NASA/MODIS POES AQUA/
   7370 C     TERRA SATELLITE-DERIVED WINDS, NOW POSSIBLY INCL. IN "SATWND"
   7371 C     DUMP FILE EXISTING DUMP R. TYPE 63, GET PREPBUFR R. TYPES 257
   7372 C     (IR), 258 (W.VAPOR IMGR CLOUD-TOP) AND 259 (W.WAPOR IMGR DEEP
   7373 C     LAYER), PROCESSED INTO PREPBUFR FILE UNDER EXISTING TBL A ENTRY
   7374 C     "SATWND"
   7375 C 2006-11-29  D. A. KEYSER -- MODIFIED EUMETSAT PROCESSING TO CONSIDER
   7376 C     "ODD" AND "EVEN" SATELLITES SEPARATELY FOR PROCESS/NO-PROCESS/
   7377 C     FLAG ALL/FLAG EVERY-OTHER (N-LIST SWITCHES "JSMASS"/"JSWIND"),
   7378 C     TIME WINDOW ("SWINDO_e"/"SWINDO_l"), LAND/NO-LAND ("SWNLND"), ALL
   7379 C     BY LAT BAND AND PRODUCT TYPE
   7380 C 2015-01-30  D. A. Keyser -- All references to IR satellite-derived
   7381 C     winds now expanded to refer to IR "long-wave" - this
   7382 C     differentiates them from IR "short-wave" winds which are now
   7383 C     produced from GOES but are not processed by this program.
   7384 C
   7385 C USAGE:    CALL SWNTBL
   7386 C   OUTPUT FILES:
   7387 C     UNIT 06  - STANDARD OUTPUT PRINT
   7388 C
   7389 C REMARKS: CALLED BY SUBROUTINE 'PREP  '.
   7390 C
   7391 C ATTRIBUTES:
   7392 C   LANGUAGE: FORTRAN 90
   7393 C   MACHINE:  NCEP WCOSS
   7394 C
   7395 C$$$
   7396       SUBROUTINE SWNTBL
   7397       LOGICAL  SWNLND
   7398       CHARACTER*14  NAMEB(8)
   7399       CHARACTER*47  NAME1(8),NAME2(8),NAME3(8),NAME4(8),NAME5(8),
   7400      $ NAME6(8),NAME7(8),NAME8(8),NAME9(8),NAME10(8),NAMEA(8,10)
   7401       COMMON/SATSW3/PHISWN(7),SWNLND(6,8,10),SWINDO_e(6,8,10),

Page 169         Source Listing                  SWNTBL
2017-04-18 11:09                                 prepdata.f

   7402      $ SWINDO_l(6,8,10),JSWIND(6,8,10),JSMASS(6,8,10),KEPSW(6,8,10),
   7403      $ KSKSWD(10),RFFL,QIFY,QIFN,EEQF
   7404       EQUIVALENCE (NAME1,NAMEA),(NAME2,NAMEA(1,2)),(NAME3,NAMEA(1,3)),
   7405      $ (NAME4,NAMEA(1,4)),(NAME5,NAMEA(1,5)),(NAME6,NAMEA(1,6)),
   7406      $ (NAME7,NAMEA(1,7)),(NAME8,NAMEA(1,8)),(NAME9,NAMEA(1,9)),
   7407      $ (NAME10,NAMEA(1,10))
   7408       DATA  NAME1/'>>>?????????????????????????????????????????<<<',
   7409      $            '                                               ',
   7410      $            '>>> INDIA GEOSTATIONARY IR(LW) CLOUD-DRIFT  <<<',
   7411      $            '>>>  JAPAN GEOSTATIONARY IR(LW) CLOUD-DRIFT <<<',
   7412      $            '>>>EUMETSAT GEOSTATIONARY IR(LW) CLOUD-DRIFT<<<',
   7413      $            '                                               ',
   7414      $            '>>>?????????????????????????????????????????<<<',
   7415      $            '                                               '/
   7416       DATA  NAME2/'>>>?????????????????????????????????????????<<<',
   7417      $            '                                               ',
   7418      $            '>>>     INDIA GEOSTATIONARY WATER VAPOR     <<<',
   7419      $            '>>>     JAPAN GEOSTATIONARY WATER VAPOR     <<<',
   7420      $            '>>>    EUMETSAT GEOSTATIONARY WATER VAPOR   <<<',
   7421      $            '                                               ',
   7422      $            '>>>?????????????????????????????????????????<<<',
   7423      $            '                                               '/
   7424       DATA  NAME3/'>>>?????????????????????????????????????????<<<',
   7425      $            '                                               ',
   7426      $            '>>> INDIA GEOSTATIONARY VISIBLE CLOUD-DRIFT <<<',
   7427      $            '>>> JAPAN GEOSTATIONARY VISIBLE CLOUD-DRIFT <<<',
   7428      $            '>>>EUMETSAT GEOSTATIONARY VISIBLE CLOUD-DRFT<<<',
   7429      $            '                                               ',
   7430      $            '>>>?????????????????????????????????????????<<<',
   7431      $            '                                               '/
   7432       DATA  NAME4/'>>> NESDIS GEOSTATIONARY IMGR IR(LW) CLD-DFT<<<',
   7433      $            '                                               ',
   7434      $            '>>>?????????????????????????????????????????<<<',
   7435      $            '>>>?????????????????????????????????????????<<<',
   7436      $            '>>>?????????????????????????????????????????<<<',
   7437      $            '                                               ',
   7438      $            '>>>NASA/MODIS PLR-ORBITING IMGR IR(LW) C-DFT<<<',
   7439      $            '                                               '/
   7440       DATA  NAME5/'>>> NESDIS GEOSTATIONARY VISIBLE CLOUD-DRIFT<<<',
   7441      $            '                                               ',
   7442      $            '>>>?????????????????????????????????????????<<<',
   7443      $            '>>>?????????????????????????????????????????<<<',
   7444      $            '>>>?????????????????????????????????????????<<<',
   7445      $            '                                               ',
   7446      $            '>>>?????????????????????????????????????????<<<',
   7447      $            '                                               '/
   7448       DATA  NAME6/'>>>NESDIS GEOSTATIONARY IMAGER W.VPR-CL. TOP<<<',
   7449      $            '                                               ',
   7450      $            '>>>?????????????????????????????????????????<<<',
   7451      $            '>>>?????????????????????????????????????????<<<',
   7452      $            '>>>?????????????????????????????????????????<<<',
   7453      $            '                                               ',
   7454      $            '>>>NASA/MODIS POLAR-ORBITING IMGR WV-CL. TOP<<<',
   7455      $            '                                               '/
   7456       DATA  NAME7/'>>>NESDIS GEOSTATIONARY IMAGER W.VPR-DP. LYR<<<',
   7457      $            '                                               ',
   7458      $            '>>>?????????????????????????????????????????<<<',

Page 170         Source Listing                  SWNTBL
2017-04-18 11:09                                 prepdata.f

   7459      $            '>>>?????????????????????????????????????????<<<',
   7460      $            '>>>?????????????????????????????????????????<<<',
   7461      $            '                                               ',
   7462      $            '>>>NASA/MODIS POLAR-ORBITING IMGR WV-DP. LYR<<<',
   7463      $            '                                               '/
   7464       DATA  NAME8/'>>>NESDIS GEOSTATIONARY SOUNDER W.VPR-CL.TOP<<<',
   7465      $            '                                               ',
   7466      $            '>>>?????????????????????????????????????????<<<',
   7467      $            '>>>?????????????????????????????????????????<<<',
   7468      $            '>>>?????????????????????????????????????????<<<',
   7469      $            '                                               ',
   7470      $            '>>>?????????????????????????????????????????<<<',
   7471      $            '                                               '/
   7472       DATA  NAME9/'>>>NESDIS GEOSTATIONARY SOUNDER W.VPR-DP.LYR<<<',
   7473      $            '                                               ',
   7474      $            '>>>?????????????????????????????????????????<<<',
   7475      $            '>>>?????????????????????????????????????????<<<',
   7476      $            '>>>?????????????????????????????????????????<<<',
   7477      $            '                                               ',
   7478      $            '>>>?????????????????????????????????????????<<<',
   7479      $            '                                               '/
   7480       DATA NAME10/'>>>   NESDIS GEOSTATIONARY PICTURE TRIPLET  <<<',
   7481      $            '                                               ',
   7482      $            '>>>?????????????????????????????????????????<<<',
   7483      $            '>>>?????????????????????????????????????????<<<',
   7484      $            '>>>?????????????????????????????????????????<<<',
   7485      $            '                                               ',
   7486      $            '>>>?????????????????????????????????????????<<<',
   7487      $            '                                               '/
   7488       DATA  NAMEB/'   GOES-ODD   ','   GOES-EVEN  ','INSAT/KALPANA ',
   7489      $            '  GMS/MTSAT   ',' METEOSAT-ODD ',' METEOSAT-EVEN',
   7490      $            '     AQUA     ','     TERRA    '/
   7491       PRINT 1
   7492     1 FORMAT(/,33X,'***** TABLE DETAILING THE USE OF SINGLE-LEVEL ',
   7493      $ 'SATELLITE DATA *****'/)
   7494 C***********************************************************************
   7495 C            LOOP THROUGH THE TEN POSSIBLE PRODUCT TYPES
   7496 C***********************************************************************
   7497       LOOP1: DO IPROD = 1,10
   7498 C-----------------------------------------------------------------------
   7499 C      LOOP THROUGH THE PRODUCERS FOR WHICH WE TRACK TWO DIFFERENT
   7500 C               SATELLITES (NESDIS, EUMETSAT AND NASA/MODIS)
   7501 C-----------------------------------------------------------------------
   7502          LOOP1n1: DO ITYPE = 1,7,2
   7503             IF(ITYPE.EQ.3)  CYCLE LOOP1n1
   7504             LOOP1n2: DO I = 1,6
   7505                IF(MIN(JSMASS(I,ITYPE,IPROD),JSMASS(I,ITYPE+1,IPROD),
   7506      $          JSWIND(I,ITYPE,IPROD),JSWIND(I,ITYPE+1,IPROD)).LT.9999)
   7507      $          THEN
   7508                   PRINT 33, NAMEA(ITYPE,IPROD)
   7509                   PRINT 2, NAMEB(ITYPE),NAMEB(ITYPE+1),PHISWN,PHISWN,
   7510      $            ((SWINDO_e(IPH,ITY,IPROD),IPH=1,6),ITY=ITYPE,ITYPE+1),
   7511      $             ((SWINDO_l(IPH,ITY,IPROD),IPH=1,6),ITY=ITYPE,ITYPE+1)
   7512                   PRINT 93,((SWNLND(IPH,ITY,IPROD),IPH=1,6),ITY=ITYPE,
   7513      $             ITYPE+1)
   7514                   PRINT 4,((JSWIND(IPH,ITY,IPROD),IPH=1,6),ITY=ITYPE,
   7515      $             ITYPE+1)

Page 171         Source Listing                  SWNTBL
2017-04-18 11:09                                 prepdata.f

   7516                   PRINT 5,((JSMASS(IPH,ITY,IPROD),IPH=1,6),ITY=ITYPE,
   7517      $             ITYPE+1)
   7518    33 FORMAT(/41X,A47)
   7519     2 FORMAT(/,1X,128('_') ,/,1X,'!',T29,'!',T47,A14,T79,'!',
   7520      $ T95,A14,T129,'!'/' ',128('_')/1X,'!',T29,'!',T79,'!',T129,
   7521      $ '!'/' ! PHISWN (LAT STRIPS - N )',T29,'!',7F7.0,'!',7F7.0,T129,
   7522      $ '!'/' ',128('_'),/1X,'!',T29,'!',T79,'!',T129,'!'/
   7523      $ ' ! EARLIEST TIME (HOUR*100)',T29,'!',5X,6F7.0,'  !',5X,6F7.0,
   7524      $ T129,'!'/1X,'!',T29,'!',T79,'!',T129,'!'/
   7525      $ ' !  LATEST  TIME (HOUR*100)',T29,'!',5X,6F7.0,'  !',5X,6F7.0,
   7526      $ T129,'!'/1X,'!',T29,'!',T79,'!',T129,'!')
   7527    93 FORMAT(' ! SWITCH: NO FLAG OVERLAND',T29,'!',5X,6L7,'  !',5X,6L7,
   7528      $ T129,'!'/1X,'!',T29,'!',T79,'!',T129,'!')
   7529     4 FORMAT(' ! SWITCH: PROCESS WIND RPT',T29,'!',5X,6I7,'  !',5X,6I7,
   7530      $ T129,'!'/1X,'!',T29,'!',T79,'!',T129,'!')
   7531     5 FORMAT(' ! SWITCH: PROCESS MASS RPT',T29,'!',5X,6I7,'  !',5X,6I7,
   7532      $ T129,'!'/1X,128('-'))
   7533                   PRINT 6,((KEPSW(IPH,ITY,IPROD),IPH=1,6),ITY=ITYPE,
   7534      $             ITYPE+1)
   7535     6 FORMAT(' ! NUMBER OF REPORTS KEPT',T29,'!',5X,6I7,'  !',5X,6I7,
   7536      $ T129,'!'/' ',129('_')/)
   7537                   CYCLE LOOP1n1
   7538                END IF
   7539             ENDDO LOOP1n2
   7540          ENDDO LOOP1n1
   7541 C-----------------------------------------------------------------------
   7542 C    LOOP THROUGH THE PRODUCERS FOR WHICH WE TRACK JUST ONE SATELLITE
   7543 C                           (INDIA, JAPAN)
   7544 C-----------------------------------------------------------------------
   7545          LOOP1n3: DO ITYPE = 3,4
   7546             LOOP1n4: DO I = 1,6
   7547                IF(MIN(JSMASS(I,ITYPE,IPROD),JSWIND(I,ITYPE,IPROD)).LT.
   7548      $          9999)  THEN
   7549                   PRINT 33, NAMEA(ITYPE,IPROD)
   7550                   PRINT 22, NAMEB(ITYPE),PHISWN,
   7551      $             (SWINDO_e(IPH1,ITYPE,IPROD),IPH1=1,6),
   7552      $             (SWINDO_l(IPH1,ITYPE,IPROD),IPH1=1,6)
   7553                   PRINT 923,(SWNLND(IPH,ITYPE,IPROD),IPH=1,6)
   7554                   PRINT 24,(JSWIND(IPH,ITYPE,IPROD),IPH=1,6)
   7555                   PRINT 25,(JSMASS(IPH,ITYPE,IPROD),IPH=1,6)
   7556    22 FORMAT(/,31X,78('_') ,/,31X,'!',T59,'!',T77,A14,T109,'!'/30X,
   7557      $ ' ',78('_')/31X,'!',T59,'!',T109,
   7558      $ '!'/30X,' ! PHISWN (LAT STRIPS - N )',T59,'!',7F7.0,
   7559      $ '!'/30X,' ',78('_'),/31X,'!',T59,'!',T109,'!'/30X,
   7560      $ ' ! EARLIEST TIME (HOUR*100)',T59,'!',5X,6F7.0,'  !'/30X,
   7561      $ ' !  LATEST  TIME (HOUR*100)',T59,'!',5X,6F7.0,'  !'
   7562      $ /31X,'!',T59,'!',T109,'!')
   7563   923 FORMAT(30X,' ! SWITCH: NO FLAG OVERLAND',T59,'!',5X,6L7,'  !'
   7564      $ /31X,'!',T59,'!',T109,'!')
   7565    24 FORMAT(30X,' ! SWITCH: PROCESS WIND RPT',T59,'!',5X,6I7,'  !'
   7566      $ /31X,'!',T59,'!',T109,'!')
   7567    25 FORMAT(30X,' ! SWITCH: PROCESS MASS RPT',T59,'!',5X,6I7,'  !'
   7568      $ /31X,78('-'))
   7569          PRINT 26,(KEPSW(IPH,ITYPE,IPROD),IPH=1,6)
   7570    26 FORMAT(30X,' ! NUMBER OF REPORTS KEPT',T59,'!',5X,6I7,'  !'
   7571      $ /30X,' ',78('_')/)
   7572                   CYCLE LOOP1n3

Page 172         Source Listing                  SWNTBL
2017-04-18 11:09                                 prepdata.f

   7573                END IF
   7574             ENDDO LOOP1n4
   7575          ENDDO LOOP1n3
   7576 C-----------------------------------------------------------------------
   7577       ENDDO LOOP1
   7578 C***********************************************************************
   7579       RETURN
   7580       END


ENTRY POINTS

  Name               
                     
 swntbl_             


SYMBOL CROSS REFERENCE

 Name                       Object Declared Type            Bytes Dimen Elements Attributes       References                        
                                                                                                                                    
 1                          Label  7492                                                           7491                              
 2                          Label  7519                                                           7509                              
 22                         Label  7556                                                           7550                              
 24                         Label  7565                                                           7554                              
 25                         Label  7567                                                           7555                              
 26                         Label  7570                                                           7569                              
 33                         Label  7518                                                           7508,7549                         
 4                          Label  7529                                                           7514                              
 5                          Label  7531                                                           7516                              
 6                          Label  7535                                                           7533                              
 923                        Label  7563                                                           7553                              
 93                         Label  7527                                                           7512                              
 EEQF                       Scalar 7403     R(4)            4           scalar   COM                                                
 I                          Local  7504     I(4)            4           scalar                    7504,7505,7506,7546,7547          
 IPH                        Local  7510     I(4)            4           scalar                    7510,7511,7512,7514,7516,7533,7553
                                                                                                  ,7554,7555,7569                   
 IPH1                       Local  7551     I(4)            4           scalar                    7551,7552                         
 IPROD                      Local  7497     I(4)            4           scalar                    7497,7505,7506,7508,7510,7511,7512
                                                                                                  ,7514,7516,7533,7547,7549,7551,755
                                                                                                  2,7553,7554,7555,7569             
 ITY                        Local  7510     I(4)            4           scalar                    7510,7511,7512,7514,7516,7533     
 ITYPE                      Local  7502     I(4)            4           scalar                    7502,7503,7505,7506,7508,7509,7510
                                                                                                  ,7511,7512,7513,7514,7515,7516,751
                                                                                                  7,7533,7534,7545,7547,7549,7550,75
                                                                                                  51,7552,7553,7554,7555,7569       
 JSMASS                     Scalar 7402     I(4)            4     3     480      COM              7505,7516,7547,7555               
 JSWIND                     Scalar 7402     I(4)            4     3     480      COM              7506,7514,7547,7554               
 KEPSW                      Scalar 7402     I(4)            4     3     480      COM              7533,7569                         
 KSKSWD                     Scalar 7403     I(4)            4     1     10       COM                                                
 LOOP1                      Label  7497                                 scalar                    7577                              
 LOOP1N1                    Label  7502                                 scalar                    7503,7537,7540                    
 LOOP1N2                    Label  7504                                 scalar                    7539                              
 LOOP1N3                    Label  7545                                 scalar                    7572,7575                         
 LOOP1N4                    Label  7546                                 scalar                    7574                              
 MIN                        Func   7505                                 scalar                    7505,7547                         
 NAME1                      Local  7399     CHAR            47    1     8        SAVE             7408                              

Page 173         Source Listing                  SWNTBL
2017-04-18 11:09 Symbol Table                    prepdata.f

 Name                       Object Declared Type            Bytes Dimen Elements Attributes       References                        
                                                                                                                                    
 NAME10                     Local  7400     CHAR            47    1     8        SAVE             7480                              
 NAME2                      Local  7399     CHAR            47    1     8        SAVE             7416                              
 NAME3                      Local  7399     CHAR            47    1     8        SAVE             7424                              
 NAME4                      Local  7399     CHAR            47    1     8        SAVE             7432                              
 NAME5                      Local  7399     CHAR            47    1     8        SAVE             7440                              
 NAME6                      Local  7400     CHAR            47    1     8        SAVE             7448                              
 NAME7                      Local  7400     CHAR            47    1     8        SAVE             7456                              
 NAME8                      Local  7400     CHAR            47    1     8        SAVE             7464                              
 NAME9                      Local  7400     CHAR            47    1     8        SAVE             7472                              
 NAMEA                      Local  7400     CHAR            47    2     80                        7508,7549                         
 NAMEB                      Local  7398     CHAR            14    1     8                         7488,7509,7550                    
 PHISWN                     Scalar 7401     R(4)            4     1     7        COM              7509,7550                         
 QIFN                       Scalar 7403     R(4)            4           scalar   COM                                                
 QIFY                       Scalar 7403     R(4)            4           scalar   COM                                                
 RFFL                       Scalar 7403     R(4)            4           scalar   COM                                                
 SATSW3                     Common 7401                                 11604                                                       
 SWINDO_E                   Scalar 7401     R(4)            4     3     480      COM              7510,7551                         
 SWINDO_L                   Scalar 7402     R(4)            4     3     480      COM              7511,7552                         
 SWNLND                     Scalar 7397     L(4)            4     3     480      COM              7512,7553                         
 SWNTBL                     Subr   7396                                                                                             

Page 174         Source Listing                  SWNTBL
2017-04-18 11:09                                 prepdata.f

   7581 C$$$  SUBPROGRAM DOCUMENTATION BLOCK
   7582 C
   7583 C SUBPROGRAM:    HSTATS
   7584 C   PRGMMR: D. A. KEYSER     ORG: W/NMC22    DATE: 1990-01-11
   7585 C
   7586 C ABSTRACT: COMPUTES STATISTICS FOR HYDROSTATIC CHECK OF MERGED RAOBS.
   7587 C   FOR EACH RAOB REPORT, EVERY SIGNIFICANT LEVEL IS INTEGRATED
   7588 C   HYDROSTATICALLY UP TO FIRST MANDATORY LEVEL ABOVE.  THE INTEGRATED
   7589 C   HEIGHT IS THEN COMPARED TO THE REPORTED HEIGHT AT THE MANDATORY
   7590 C   LEVEL.  THIS SUBPROGRAM SUMS UP REPORTED HEIGHTS, INTEGRATED
   7591 C   HEIGHTS, DIFFERENCES AND THEIR SQUARES AT ALL MANDATORY LEVELS
   7592 C   FOR ALL REPORTS.  FINALLY, ENTRY 'PSTATS' IS CALLED AFTER ALL
   7593 C   UPPER-AIR REPORTS HAVE BEEN EXAMINED, AND IT PRINTS A TABLE
   7594 C   OF MEAN REPORTED/INTEGRATED HEIGHT FOR EACH MAND. P-LEVEL ALONG
   7595 C   WITH THE BIAS, RMS, MAXIMUM DIFFERENCE, AND LAT/LON OF MAX. DIFF.
   7596 C
   7597 C PROGRAM HISTORY LOG:
   7598 C   UNKNOWN
   7599 C 1988-04-11  D. A. KEYSER -- DOCBLOCKED/COMMENTED
   7600 C 1990-01-11  D. A. KEYSER -- CONVERTED TO VS FORTRAN(77) & RESTRUCTURED
   7601 C
   7602 C USAGE:    CALL HSTATS(ZIN,ZOUT,XI,YJ,KP)
   7603 C   INPUT ARGUMENT LIST:
   7604 C     ZIN      - REPORTED HEIGHT AT MANDATORY PRESSURE LEVEL
   7605 C     ZOUT     - INTEGRATED HEIGHT REPORTED AT MAND. P-LEVEL
   7606 C     XI       - LONGITUDE OF REPORT (DEG.WEST)
   7607 C     YJ       - LATITUDE OF REPORT (DEG., N+,S-)
   7608 C     KP       - PRESSURE LEVEL
   7609 C
   7610 C   OUTPUT FILES:
   7611 C     UNIT 06  - STANDARD OUTPUT PRINT
   7612 C
   7613 C REMARKS: CALLED BY SUBROUTINE 'SMERGE', ENTRY 'PSTATS' IN SUBROUTINE
   7614 C   'PREP'.
   7615 C
   7616 C ATTRIBUTES:
   7617 C   LANGUAGE: FORTRAN 90
   7618 C   MACHINE:  NCEP WCOSS
   7619 C
   7620 C$$$
   7621       SUBROUTINE HSTATS(ZIN,ZOUT,XI,YJ,KP)
   7622       PARAMETER (MAXOBS = 3500)
   7623       DIMENSION  STATS(8,22),XMAX(22),YMAX(22)
   7624       COMMON/ADP/ISATOB,PMAND(23),RDATA(MAXOBS),IPRINT
   7625       DATA  STATS/176*0.0/,XMAX/22*0.0/,YMAX/22*0.0/
   7626       DO I = 1,22
   7627          K = I
   7628          IF(KP.GE.INT(PMAND(I)))  EXIT
   7629       ENDDO
   7630       ZDIF = ZOUT - ZIN
   7631       STATS(8,K) = STATS(8,K) + 1.
   7632       STATS(1,K) = STATS(1,K) + ZIN
   7633       STATS(2,K) = STATS(2,K) + ZOUT
   7634       STATS(3,K) = STATS(3,K) + ZDIF
   7635       STATS(4,K) = STATS(4,K) + (ZIN * ZIN)
   7636       STATS(5,K) = STATS(5,K) + (ZOUT * ZOUT)
   7637       STATS(6,K) = STATS(6,K) + (ZDIF * ZDIF)

Page 175         Source Listing                  HSTATS
2017-04-18 11:09                                 prepdata.f

   7638       IF(ABS(ZDIF).GT.STATS(7,K))  THEN
   7639          STATS(7,K) = ABS(ZDIF)
   7640          XMAX(K) = XI
   7641          YMAX(K) = YJ
   7642       END IF
   7643       RETURN
   7644          ENTRY PSTATS
   7645       PRINT 20
   7646    20 FORMAT(/,20X,'***** STATISTICAL ANALYSIS BY PRESSURE',
   7647      $ ' FOR HYDROSTATIC HEIGHT CHECK OF MERGED RAOBS *****',//,3X,
   7648      $ 'COUNT',5X,'PRESSURE',2X,'REPORTED MEAN',3X,'INTEGRATED MEAN',6X,
   7649      $ 'BIAS',12X,'RMS',10X,'MAXDIF',4X,'AT',4X,'LON*100',8X,'LAT*100',
   7650      $  /,15X,'(MB)',6X,'HEIGHT (M)',7X,'HEIGHT (M)',9X,'(M)',
   7651      $ 12X,'(M)',12X,'(M)',10X,'(DEG. W)',7X,'(DEG. N)')
   7652       DO K = 1,22
   7653          COUNT = MAX(1.0,STATS(8,K))
   7654          COUNT = 1.0/COUNT
   7655          DO I = 1,3
   7656             STATS(I,K) = STATS(I,K) * COUNT
   7657             STATS(I+3,K) = SQRT(STATS(I+3,K) * COUNT)
   7658          ENDDO
   7659       ENDDO
   7660       DO K = 22,1,-1
   7661          KNTT = MAX(1,INT(STATS(8,K)))
   7662          IF(STATS(1,K).EQ.0..AND.NINT(XMAX(K)*100.).EQ.0.AND.
   7663      $    NINT(YMAX(K)*100.).EQ.0)  CYCLE
   7664          IPMAND = INT(PMAND(K))
   7665          PRINT 30, KNTT,IPMAND,(STATS(I,K),I=1,3),(STATS(I,K),I=6,7),
   7666      $    XMAX(K),YMAX(K)
   7667    30    FORMAT(I7,5X,I6,7X,5(F10.3,5X),3X,2(F7.2,8X))
   7668       ENDDO
   7669       STATS = 0.0
   7670       XMAX  = 0.0
   7671       YMAX  = 0.0
   7672       RETURN
   7673       END

Page 176         Source Listing                  HSTATS
2017-04-18 11:09 Entry Points                    prepdata.f



ENTRY POINTS

  Name                  Name               
                                           
 hstats_               pstats_             


SYMBOL CROSS REFERENCE

 Name                       Object Declared Type            Bytes Dimen Elements Attributes       References                        
                                                                                                                                    
 20                         Label  7646                                                           7645                              
 30                         Label  7667                                                           7665                              
 ABS                        Func   7638                                 scalar                    7638,7639                         
 ADP                        Common 7624                                 14100                                                       
 COUNT                      Local  7653     R(4)            4           scalar                    7653,7654,7656,7657               
 HSTATS                     Subr   7621                                                                                             
 I                          Local  7626     I(4)            4           scalar                    7626,7627,7628,7655,7656,7657,7665
 INT                        Func   7628                                 scalar                    7628,7661,7664                    
 IPMAND                     Local  7664     I(4)            4           scalar                    7664,7665                         
 IPRINT                     Scalar 7624     I(4)            4           scalar   COM                                                
 ISATOB                     Scalar 7624     I(4)            4           scalar   COM                                                
 K                          Local  7627     I(4)            4           scalar                    7627,7631,7632,7633,7634,7635,7636
                                                                                                  ,7637,7638,7639,7640,7641,7652,765
                                                                                                  3,7656,7657,7660,7661,7662,7663,76
                                                                                                  64,7665,7666                      
 KNTT                       Local  7661     I(4)            4           scalar                    7661,7665                         
 KP                         Dummy  7621     I(4)            4           scalar   ARG,INOUT        7628                              
 MAX                        Func   7653                                 scalar                    7653,7661                         
 MAXOBS                     Param  7622     I(4)            4           scalar                    7624                              
 NINT                       Func   7662                                 scalar                    7662,7663                         
 PMAND                      Scalar 7624     R(4)            4     1     23       COM              7628,7664                         
 PSTATS                     Subr   7644                                                                                             
 RDATA                      Scalar 7624     R(4)            4     1     3500     COM                                                
 SQRT                       Func   7657                                 scalar                    7657                              
 STATS                      Local  7623     R(4)            4     2     176                       7625,7631,7632,7633,7634,7635,7636
                                                                                                  ,7637,7638,7639,7653,7656,7657,766
                                                                                                  1,7662,7665,7669                  
 XI                         Dummy  7621     R(4)            4           scalar   ARG,INOUT        7640                              
 XMAX                       Local  7623     R(4)            4     1     22                        7625,7640,7662,7666,7670          
 YJ                         Dummy  7621     R(4)            4           scalar   ARG,INOUT        7641                              
 YMAX                       Local  7623     R(4)            4     1     22                        7625,7641,7663,7666,7671          
 ZDIF                       Local  7630     R(4)            4           scalar                    7630,7634,7637,7638,7639          
 ZIN                        Dummy  7621     R(4)            4           scalar   ARG,INOUT        7630,7632,7635                    
 ZOUT                       Dummy  7621     R(4)            4           scalar   ARG,INOUT        7630,7633,7636                    

Page 177         Source Listing                  HSTATS
2017-04-18 11:09                                 prepdata.f

   7674 C$$$  SUBPROGRAM DOCUMENTATION BLOCK
   7675 C
   7676 C SUBPROGRAM:    WNDBYP
   7677 C   PRGMMR: D. A. KEYSER     ORG: NP22       DATE: 1999-08-04
   7678 C
   7679 C ABSTRACT: MERGES CATEGORY 3 (WINDS-BY-PRESSURE) AND SPECIAL 25 OR
   7680 C   50 MB LEVEL DATA LEVELS INTO UPPER-AIR REPORT PROFILE.  CHECKS FOR
   7681 C   DUPLICATE PRESSURES AND IF FOUND TRANSFERS HIGHEST QUALITY WIND
   7682 C   TO A CATEGORY 1,2,5 DATA LEVEL.  FINALLY, INTERPOLATES TEMPERATURE
   7683 C   AND HEIGHT TO LEVELS CONTAINING ONLY WIND INFORMATION.
   7684 C
   7685 C PROGRAM HISTORY LOG:
   7686 C   UNKNOWN
   7687 C 1988-04-11  D. A. KEYSER -- DOCBLOCKING/COMMENTING
   7688 C 1989-04-17  D. A. KEYSER -- DOCBLOCKING/COMMENTING, TESTS FOR SPEC.
   7689 C     LEVELS (UNIQUE CAT. NO. OF 6)
   7690 C 1989-06-15  G. J. DIMEGO -- MADE RO2G CONFORM TO RAFS/GDAS VALUE
   7691 C 1989-12-13  D. A. KEYSER -- 'FILL' SWITCH NOW TESTED FOR INTERPOLATING
   7692 C     TO MISSING DATA LEVELS
   7693 C 1990-01-11  D. A. KEYSER -- CONVERTED TO VS FORTRAN(77) & RESTRUCTURED
   7694 C 1993-05-12  D. A. KEYSER -- THE NEW "PREPBUFR TABLE VALUES" WHICH CAN
   7695 C     RANGE FROM 0-15 ARE EMPLOYED RATHER THAN THE OLD OI/SSI QUALITY
   7696 C     MARKERS; IN INTERNAL PROCESSING MISSING DATA GET PREPBUFR TABLE
   7697 C     VALUE OF 16 RATHER THAN 10; VERTICAL COORDINATE INDIC. ADDED TO
   7698 C     PREPBUFR TBL VALUE LIST FOR VARIABLES
   7699 C 1993-09-14  D. A. KEYSER -- SENSIBLE TEMPERATURE FOR PROFILE SAVED
   7700 C     IN STMP OR SDAT ARRAYS (IN CASE TVIRT=FALSE)
   7701 C 1993-12-21  D. A. KEYSER -- DUPL. P-LVLS NOW ENSURES THAT BEST TEMP
   7702 C     IS KEPT REGARDLESS OF HGHT TBL. VAL. & WILL NOT TRANSF. DWPT TO
   7703 C     LVL WHERE MSG UNLESS FILLM=T OR TEMP. HAS BEEN TRANSFERRED
   7704 C 1994-08-11  D. A. KEYSER --  ALL DUPL. PRESS. CHECKS NOW REQUIRE
   7705 C     PRESS. TO AGREE TO NEAREST 10'TH OF A MB TO BE A DUPL. (WAS TO
   7706 C     NEAREST WHOLE MB)
   7707 C 1995-07-12  D. A. KEYSER -- IF SPANNING LVL PRESS. Q.M. IS BAD INTEGR.
   7708 C     HGHT & TEMP Q.M. SET TO BAD, IF INTEGR. LVL PRESS. Q.M. IS BAD
   7709 C     INTEGR. HGHT & TEMP Q.M. SET TO BAD
   7710 C 1996-02-07  D. A. KEYSER -- FOR RGL-BUFR OUTPUT: ORIGINAL TESTS FOR
   7711 C     OLD PREPDA PROC. OF CAT. 3 WINDS ON LVLS ABOVE LAST NON-MISSING
   7712 C     HGHT AND TEMP. LEVELS RETAINED (TO MAKE BUFR-PREPDA FILE CONTAIN
   7713 C     DATA EXPECTED BY FERR PGM AND OI ANALYSIS)
   7714 C 1996-03-04  D. A. KEYSER -- FOR RGL-BUFR OUTPUT: MORE FIXES TO MAKE
   7715 C     BUFR-PREPDA FILE CONTAIN DATA EXPECTED BY FERR PGM & OI-ANAL
   7716 C     (DUPL. P-LVL CHECK MORE LIKE OLD "PREPDA" FORM; INTERP./CALC.
   7717 C     DATA CAN GET GOOD Q.M. IF SPANNING LVL DATA GOOD)
   7718 C 1997-05-01  D. A. KEYSER -- EST. REASON CODES FOR UPPER-AIR DATA
   7719 C     TYPES (CURRENTLY JUST 100, 101-103, 105 TO IDENTIFY INTERPOLATED
   7720 C     DATA FOR CQCBUFR PGM); CHGS IN LVL ON29 CATEGORY INDICATORS:
   7721 C     SPEC. LVLS GET CAT=7 RATHER THAN 6, CAT 2 & 3 EXPLICITLY
   7722 C     IDENTIFIED IN ALL CASES
   7723 C 1999-08-04  D. A. KEYSER -- REPLACED SORT ROUTINE "SHELL" (IN-LINE
   7724 C     SUBROUTINE) WITH W3LIB ROUTINE "ORDERS", MORE EFFICIENT AND
   7725 C     ALLOWS MULTIPLE ORDER SORT KEYS
   7726 C
   7727 C USAGE:    CALL WNDBYP(NM,NS,NP,KLVL,TMP,JQ,JR,IPRT,VTMP)
   7728 C   INPUT ARGUMENT LIST:
   7729 C     NM       - NO. OF LEVELS IN CAT. 1 (MANDATORY MASS/WIND)
   7730 C     NS       - NO. OF LEVELS IN CAT. 2,5 (SIG. MASS & TROP)

Page 178         Source Listing                  HSTATS
2017-04-18 11:09                                 prepdata.f

   7731 C     NP       - NO. OF CAT. 3 & SPECIAL 25 OR 50 MB PRES. LVLS
   7732 C     KLVL     - NO. OF COMBINED CAT. 1,2, AND 5 LEVELS WITH
   7733 C              - DUPLICATES REMOVED
   7734 C     TMP      - "MXLVL" X "NUMDAT" ARRAY HOLDING AN U-AIR REPORT'S
   7735 C              - MASS & WIND DATA IN CAT. 1,2, AND 5 AFTER MERGING
   7736 C     JQ       - "MXLVL" X "NUMQMS" ARRAY HOLDING AN U-AIR RPT'S PREPBUFR
   7737 C              - TABLE VALUES IN CAT. 1,2, AND 5 AFTER MERGING
   7738 C     JR       - "MXLVL" X "NUMQMS" ARRAY HOLDING AN U-AIR RPT'S REASON
   7739 C              - CODES IN CAT. 1,2, AND 5 AFTER MERGING
   7740 C     IPRT     - 2-WORD SWITCH, DETAILED STD. O-PUT (UNIT 6) PRT OF RPT
   7741 C     VTMP    - "MXLVL" WORD ARRAY HOLDING AN U-AIR REPORT'S VIRTUAL
   7742 C              - TEMP DATA IN CAT. 1,2, AND 5 AFTER MERGING
   7743 C
   7744 C   OUTPUT ARGUMENT LIST:
   7745 C     KLVL     - NO. OF COMBINED CAT. 1,2,3,5 AND SPECIAL 25/50 MB
   7746 C              - LEVELS WITH DUPLICATES REMOVED
   7747 C     TMP      - "MXLVL" X "NUMDAT" ARRAY HOLDING AN U-AIR REPORT'S
   7748 C              - MASS & WIND DATA IN CAT. 1,2,3,5 AND SPECIAL 25/50 MB
   7749 C              - LEVELS AFTER MERGING
   7750 C     JQ       - "MXLVL" X "NUMQMS" ARRAY HOLDING AN U-AIR RPT'S PREPBUFR
   7751 C              - TABLE VALUES IN CAT. 1,2,3,5 AND SPECIAL 25/50 MB LVLS
   7752 C              - AFTER MERGING
   7753 C     JR       - "MXLVL" X "NUMQMS" ARRAY HOLDING AN U-AIR RPT'S REASON
   7754 C              - CODES IN CAT. 1,2,3,5 AND SPECIAL 25/50 MB LEVELS
   7755 C              - AFTER MERGING
   7756 C     VTMP     - "MXLVL" WORD ARRAY HOLDING AN U-AIR REPORT'S VIRTUAL
   7757 C              - TEMP DATA IN CAT. 1,2,3,5 AND SPECIAL 25/50 MB LEVELS
   7758 C              - AFTER MERGING
   7759 C
   7760 C   OUTPUT FILES:
   7761 C     UNIT 06  - STANDARD OUTPUT PRINT
   7762 C
   7763 C REMARKS: CALLED BY SUBROUTINE 'SMERGE'.
   7764 C
   7765 C ATTRIBUTES:
   7766 C   LANGUAGE: FORTRAN 90
   7767 C   MACHINE:  NCEP WCOSS
   7768 C
   7769 C$$$
   7770       SUBROUTINE WNDBYP(NM,NS,NP,KLVL,TMP,JQ,JR,IPRT,VTMP)
   7771       PARAMETER (MXWRDH = 15)
   7772       PARAMETER (MXLVL = 600)
   7773       PARAMETER (NUMVAR = 6, NUMQMS = 5)
   7774       PARAMETER (NUMDAT = NUMVAR + (2 * NUMQMS))
   7775       DIMENSION  TMP(MXLVL,NUMDAT),KS(MXLVL),IQ(MXLVL,NUMQMS),
   7776      $ JQ(MXLVL,NUMQMS),VTMP(MXLVL),VDAT(MXLVL),IR(MXLVL,NUMQMS),
   7777      $ JR(MXLVL,NUMQMS),IWORK(MXLVL),TMPINV(NUMDAT,MXLVL)
   7778       CHARACTER*8  STNID,SUBSET_d
   7779       INTEGER  IPRT(2),IC(0:16)
   7780       real(8)  alon_8,alat_8
   7781       LOGICAL  FILLM,FILLZ,FILLT
   7782       COMMON/WORD/LWI,LWR
   7783       COMMON/RPTHDR/SUBSET_d,STNID,HDR(2:MXWRDH),alon_8,alat_8
   7784       COMMON/SNDATA/DAT(MXLVL,NUMDAT)
   7785       COMMON/PARM5/FILLZ,FILLT,FILLW,FILLM,LSWIND,LSMASS,CWINDO,NPZ
   7786       EQUIVALENCE  (DAT(1,NUMVAR+1),IQ)
   7787       EQUIVALENCE  (DAT(1,NUMVAR+NUMQMS+1),IR)

Page 179         Source Listing                  WNDBYP
2017-04-18 11:09                                 prepdata.f

   7788 C PREPBUFR TABLE VALUE INTERPRETED AS: 0 - KEEP, 1 - GOOD,
   7789 C  2- DEFAULT, 3 - SUSPECT, 9 - BAD  IN DUPL. LEVEL TBL VALUE COMPARISON
   7790 C  T.V.->      0  1  2  3  4  5  6  7  8  9  10  11  12  13  14  15  16
   7791       DATA IC/ 0, 1, 2, 3, 9, 9, 9, 9, 9, 9,  9,  9,  9,  9,  9,  9, 16/
   7792       SCALE = 10.
   7793       RO2G = 287.05/(2.0 * 9.8)
   7794 C MP IS NO. OF CAT 1,2,5 LEVELS (ARRANGED IN PROPER ORDER)
   7795       MP = NM + NS
   7796       NN = KLVL
   7797 C TRANSFER BLOCK OF CAT. 3 AND SPECIAL LEVELS FROM DAT TO TMP
   7798       DO N = 1,NP
   7799          NN = KLVL + N
   7800          MM = MP + N
   7801          VTMP(NN) = DAT(MM,3)
   7802          TMP(NN,1:NUMDAT) = DAT(MM,1:NUMDAT)
   7803       ENDDO
   7804 C KLVL NOW IS TOTAL OF CAT. 1,2,5, & 3 + SPECIAL LVLS, DUPLICATES POSS.
   7805       KLVL = NN
   7806       KS = 0
   7807 C ARRANGE LEVELS IN ORDER OF DECREASING PRESSURE (FIRST ORDER SORT KEY,
   7808 C  SECOND ORDER SORT KEY IS HEIGHT)
   7809 C .. MUST SWITCH ORDER OF ELEMENTS IN TMP ARRAY - CALL IT TMPINV
   7810       DO  J=1,NUMDAT
   7811          TMPINV(J,1:KLVL) = TMP(1:KLVL,J)
   7812       END DO
   7813       CALL ORDERS( 2,IWORK,TMPINV(2,1),KS,KLVL,NUMDAT,LWR,2)
   7814       CALL ORDERS(12,IWORK,TMPINV(1,1),KS,KLVL,NUMDAT,LWR,2)
   7815 C .. DAT ARRAY LIKE TMPINV ARRAY, BUT P-LVLS ARRANGED PROPERLY, ALSO
   7816 C    ORDER OF ELEMENTS SWITCHED BACK
   7817       DO N = 1,KLVL
   7818          L = KS(KLVL-N+1)
   7819          VDAT(N) = VTMP(L)
   7820          DAT(N,1:NUMDAT) = TMPINV(1:NUMDAT,L)
   7821       ENDDO
   7822 C+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
   7823 C DETAILED PRINT FOR SPECIFIED REPORT(S) -- IF ENTERED IN DATA CARDS
   7824       IF(IPRT(2).EQ.1.AND.NUMVAR+1.LT.11.AND.NUMQMS.LT.9)  THEN
   7825          PRINT 902, STNID,NUMVAR+1
   7826   902 FORMAT(/' WNDBYP: ',A8,', CAT. 1,2,3,5,S  W/ SORT HAS DUPL. LVLS',
   7827      $ ' - VIRT. TEMP IN COLUMN',I3)
   7828          DO N = 1,KLVL
   7829             PRINT 900, (DAT(N,K),K=1,NUMVAR),VDAT(N)
   7830             PRINT 905, (IQ(N,L),L=1,NUMQMS)
   7831          ENDDO
   7832          PRINT 901
   7833       END IF
   7834 C+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
   7835 C***********************************************************************
   7836 C          CHECK FOR DUPLICATE PRESSURES ON ADJACENT LEVELS
   7837 C  MAY RESULT IN TRANSFER OF WIND FROM CAT. 3 DATA LEVEL TO CAT. 1,2,5
   7838 C                            DATA LEVEL
   7839 C***********************************************************************
   7840       IP = NINT(DAT(1,1)*SCALE)
   7841       NCNT = 0
   7842       DO N = 2,KLVL
   7843 C "NN" IS LVL DIRECTLY BELOW "N" -- TRANSFER ALWAYS FROM N TO NN
   7844          NN = N - 1

Page 180         Source Listing                  WNDBYP
2017-04-18 11:09                                 prepdata.f

   7845          JP = NINT(DAT(N,1)*SCALE)
   7846          IF(IP.NE.JP)  GO TO 24
   7847 C HERE IS A DUPLICATE, NCNT COUNTS NO. OF DUPLICATE LEVELS
   7848          NCNT = NCNT + 1
   7849 C IN CASE ONE OF IQ(N,3)/IQ(NN,3) BELOW SET TO 7 FOR SPECIAL LVLS, NEED
   7850 C  TO TEST IT AS A CAT. 3 (ORIGINALLY SPECIAL LEVELS WERE SET TO CAT. 3)
   7851 C  (SAME TRUE FOR TROP LVLS SET TO CAT 5 BUT NEED TO BE TESTED AS CAT 2)
   7852          IQN3 = MOD(IQ(N,3),20)
   7853          IQNN3 = MOD(IQ(NN,3),20)
   7854          JQNN3 = IQ(NN,3)
   7855          IF(IQN3.EQ.5)   IQN3  = 2
   7856          IF(IQN3.EQ.7)   IQN3  = 3
   7857          IF(IQNN3.EQ.5)  IQNN3 = 2
   7858          IF(IQNN3.EQ.7)  IQNN3 = 3
   7859          IQN1  = IQ(N,1)
   7860          IQNN1 = IQ(NN,1)
   7861          IF(IQN1 .LE.-1.OR.IQN1 .EQ.17)  IQN1  = 16
   7862          IF(IQNN1.LE.-1.OR.IQNN1.EQ.17)  IQNN1 = 16
   7863          IF(IQN3.LT.IQNN3)  THEN
   7864 C-----------------------------------------------------------------------
   7865 C    CASE WHERE CAT. 3 OR SPECIAL DATA LVL ON "NN", CAT 1,2,5 DATA
   7866 C                              LVL ON "N"
   7867 C  (NOTE: THIS LOGIC IS CONVOLUTED -- SOMETIME NEEDS TO BE STREAMLINED)
   7868 C-----------------------------------------------------------------------
   7869             NFLAG = 0
   7870             MFLAG = 0
   7871             IF(IC(IQN1).LT.IC(IQNN1))  THEN
   7872 C HGHT PREPBUFR TBL VAL. FOR N BETTER THAN FOR NN (ALWAYS TRUE, NN HGHT
   7873 C  PREPBUFR TBL VAL. =16); TRANS. PRESS., HGHT, CAT. NO., & VERT. COORD.
   7874 C  INDICATOR ON LVL N TO LVL NN
   7875 C (IF HGT PREPBUFR TBL VAL. ON N NOT BETTER, NEVER TRANSF. TEMP)
   7876                MFLAG = 1
   7877                IQ(NN,1) = IQ(N,1)
   7878                DAT(NN,1) = DAT(N,1)
   7879                IR(NN,1) = IR(N,1)
   7880                IQ(NN,3) = IQ(N,3)
   7881                IQ(NN,5) = IQ(N,5)
   7882                DAT(NN,2) = DAT(N,2)
   7883                IR(NN,5) = IR(N,5)
   7884             END IF
   7885             IF(IC(IQ(N,2)).LT.IC(IQ(NN,2)))  THEN
   7886 C TEMP PREPBUFR TBL VAL FOR N BETTER THAN FOR NN (ALMOST ALWAYS TRUE, NN
   7887 C  TEMP PREPBUFR TBL VAL. =16); TRANS. TMP ON LVL N TO NN (TEMP CAN BE
   7888 C  TRANS. REGARDLESS OF HGHT PREPBUFR TABLE VALUE, ALSO MAY TRANS. CAT.
   7889 C  NO., VERT. COORD. IND. AND PRESS. IN THIS CASE)
   7890                NFLAG = 1
   7891                IQ(NN,2) = IQ(N,2)
   7892                DAT(NN,3) = DAT(N,3)
   7893                IR(NN,2) = IR(N,2)
   7894                IR(NN,3) = IR(N,3)
   7895                VDAT(NN) = VDAT(N)
   7896                IF(MFLAG.EQ.0)  THEN
   7897                   IQ(NN,3) = IQ(N,3)
   7898                   IQ(NN,5) = IQ(N,5)
   7899                   DAT(NN,1) = DAT(N,1)
   7900                   IR(NN,5) = IR(N,5)
   7901                   IF(IQ(NN,1).EQ.16)  THEN

Page 181         Source Listing                  WNDBYP
2017-04-18 11:09                                 prepdata.f

   7902 C IF HGHT T.V. ON LVL NN IS 16, GO AHEAD AND TRANSF. HGHT
   7903 C  (CAN'T BE ANY WORSE & MAY HELP IN LATER CAT. 4 PROFILE PLACEMENT)
   7904                      IQ(NN,1) = IQ(N,1)
   7905                      DAT(NN,2) = DAT(N,2)
   7906                      IR(NN,1) = IR(N,1)
   7907                   END IF
   7908                END IF
   7909             END IF
   7910 C ONLY TRANSFER DWPT ON LVL N TO LVL NN WHEN NN DWPT MSG (ALWAYS TRUE)
   7911 C  AND EITHER FILLM IS TRUE OR ABOVE TRANSF. OF TEMP & CAT. # OCCURRED
   7912             IF(DAT(NN,4).GE.9999..AND.(FILLM.OR.NFLAG.EQ.1))
   7913      $       DAT(NN,4) = DAT(N,4)
   7914          ELSE
   7915 C-----------------------------------------------------------------------
   7916 C    CASE WHERE CAT. 3 OR SPECIAL DATA LVL ON "N", CAT 1,2,5 DATA LVL
   7917 C                                ON "NN"
   7918 C ONLY TRANSFER HERE IS OF HEIGHT (ELEV) FROM LVL 2 TO LVL 1 WHEN CAT. 3
   7919 C DATA LVL W/ VALID ELEV ON "N" & CAT. 2 DATA LVL W/ MSG ELEV ON "NN" --
   7920 C    THIS CAN HAPPEN ONLY IF 1ST CAT. 2 DATA LVL HAS UNREASONABLE/MSG
   7921 C  PRESSURE & 2ND CAT. 2 DATA LVL IS SFC PRESSURE EQUAL TO FIRST CAT. 3
   7922 C                      DATA LVL WHICH HAS ELEV
   7923 C-----------------------------------------------------------------------
   7924             IF(IC(IQN1).LT.IC(IQNN1).AND.NN.EQ.1) THEN
   7925                IQ(NN,1) = IQ(N,1)
   7926                DAT(NN,2) = DAT(N,2)
   7927                IR(NN,1) = IR(N,1)
   7928             END IF
   7929          END IF
   7930 C-----------------------------------------------------------------------
   7931 C  CASE WHERE CAT. 3 OR SPECIAL DATA LVL & CAT 1,2,5 DATA LVL COULD BE
   7932 C                              EITHER WAY
   7933 C-----------------------------------------------------------------------
   7934          IQN4  = IC(IQ(N,4))
   7935          IQNN4 = IC(IQ(NN,4))
   7936         IF(IQN4.LT.IQNN4.OR.(IQN4.EQ.IQNN4.AND.IQ(N,3).EQ.IQ(NN,3)))THEN
   7937 C WIND PREPBUFR TBL V. FOR N BETTER THAN FOR NN - OR - WIND PREPBUFR TBL
   7938 C  VAL. FOR N SAME AS FOR NN AND CAT. NO. 1,5 TRANSF. FROM N TO NN --
   7939 C  TRANSFER WIND ON LVL N TO LVL NN (ALWAYS TRUE FOR SPEC. LVLS WHEN
   7940 C  ON "NN", WIND PREPBUFR TBL VALUE = 16; NEVER TRUE FOR SPEC. LVLS WHEN
   7941 C  ON "N", WIND PREPBUFR TABLE VALUE = 16)
   7942 C IF WIND IS ORIGINALLY FROM CAT. 3 LEVEL AND RETAINED LEVEL DOES NOT
   7943 C  HAVE CAT. NO. 5 (AND DOES NOT HAVE AN EARLIER CAT. 5 DUPL.), ADD 40
   7944 C  TO DATA LEVEL CATEGORY NUMBER
   7945             IF(MOD(IQ(N,3),20).EQ.3.AND.MOD(IQ(NN,3),20).NE.5.AND.
   7946      $       IQ(NN,3).LT.60)  IQ(NN,3) = MOD(IQ(NN,3),20) + 40
   7947             IQ(NN,4) = IQ(N,4)
   7948             DAT(NN,5) = DAT(N,5)
   7949             DAT(NN,6) = DAT(N,6)
   7950             IR(NN,4) = IR(N,4)
   7951          ELSE  IF(IQN4.GT.IQNN4.AND.IQ(N,3).EQ.IQ(NN,3))  THEN
   7952 C WIND PREPBUFR TBL VAL. FOR N WORSE THAN FOR NN AND CAT. NO.1,5 TRANSF.
   7953 C  FROM N TO NN -- IF GOOD WIND WAS ORIGINALLY ON CAT. 3 LEVEL AND
   7954 C  TRANSFERRED CAT. NO. IS NOT 5 (AND DOES NOT HAVE AN EARLIER CAT. 5
   7955 C  DUPL.) ADD 40 TO DATA LEVEL CATEGORY NUMBER
   7956             IF(MOD(JQNN3,20).EQ.3.AND.MOD(IQ(NN,3),20).NE.5.AND.
   7957      $       IQ(NN,3).LT.60) IQ(NN,3) = MOD(IQ(NN,3),20) + 40
   7958          END IF

Page 182         Source Listing                  WNDBYP
2017-04-18 11:09                                 prepdata.f

   7959 C CULL THE DUPLICATE PRESSURE LEVEL
   7960          DAT(N,1) = 0.0
   7961    24    CONTINUE
   7962          IP = JP
   7963       ENDDO
   7964 C+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
   7965 C DETAILED PRINT FOR SPECIFIED REPORT(S) -- IF ENTERED IN DATA CARDS
   7966       IF(IPRT(2).EQ.1.AND.NUMVAR+1.LT.11.AND.NUMQMS.LT.9)  THEN
   7967          PRINT 903, STNID,NUMVAR+1
   7968   903 FORMAT(/' WNDBYP: ',A8,', CAT. 1,2,3,5,S  W/ DUPL. ZEROED OUT',
   7969      $ ' - VIRT. TEMP IN COLUMN',I3)
   7970          DO N = 1,KLVL
   7971             PRINT 900, (DAT(N,K),K=1,NUMVAR),VDAT(N)
   7972             PRINT 905, (IQ(N,L),L=1,NUMQMS)
   7973          ENDDO
   7974          PRINT 901
   7975       END IF
   7976 C+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
   7977 C***********************************************************************
   7978 C REMOVE DUPLICATE LEVELS AND FILL ARRAY TMP
   7979       LCNT = 0
   7980       DO N = 1,KLVL
   7981          IF(DAT(N,1).LT.0.4)  CYCLE
   7982          LCNT = LCNT + 1
   7983          VTMP(LCNT) = VDAT(N)
   7984          TMP(LCNT,1:NUMDAT) = DAT(N,1:NUMDAT)
   7985       ENDDO
   7986 C RESET KLVL TO NO. OF CAT. 1,2,3,5,+ SPECIAL LEVELS (W/O DUPS)
   7987       KLVL = LCNT
   7988 C+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
   7989 C DETAILED PRINT FOR SPECIFIED REPORT(S) -- IF ENTERED IN DATA CARDS
   7990       IF(IPRT(2).EQ.1.AND.NUMVAR+1.LT.11.AND.NUMQMS.LT.9)  THEN
   7991          PRINT 904, STNID,NUMVAR+1
   7992   904 FORMAT(/' WNDBYP: ',A8,', CAT. 1,2,3,5,S  W/ DUPL. REMOVED',
   7993      $ ' - VIRT. TEMP IN COLUMN',I3)
   7994          DO N = 1,KLVL
   7995             PRINT 900, (TMP(N,K),K=1,NUMVAR),VTMP(N)
   7996             PRINT 905, (JQ(N,L),L=1,NUMQMS)
   7997          ENDDO
   7998          PRINT 901
   7999       END IF
   8000 C+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
   8001 C***********************************************************************
   8002 C   INTERP. HGHT & IF APPROP. TEMP TO CAT. 3 & SPEC. DATA LVLS WHERE
   8003 C                            EITHER MISSING
   8004 C***********************************************************************
   8005       IF(NCNT.EQ.NP)  GO TO 31
   8006       DO N = 1,KLVL
   8007          NT = N
   8008          IF(JQ(NT,1).LE.3.AND.JQ(NT,2).LE.3)  GO TO 29
   8009       ENDDO
   8010       GO TO 31
   8011    29 CONTINUE
   8012 C BOTTOM SPANNING LVL (NT)-FOR SOME REASON LOWEST B.S. LVL IN PROFILE
   8013 C  MUST HAVE HGHT & TEMP PREPBUFR TBL. VAL. .LE. 9;
   8014 C  ABOVE THIS ONLY NEED NON-MISSING HGHT & TEMP
   8015       PLO = TMP(NT,1)

Page 183         Source Listing                  WNDBYP
2017-04-18 11:09                                 prepdata.f

   8016       ZLO = TMP(NT,2)
   8017       TLO = TMP(NT,3)
   8018       VTLO = VTMP(NT)
   8019       IZQLO = JQ(NT,1)
   8020 C IF PRESSURE Q.M. IS BAD(15), THEN SET NON-MISSING IZQLO AS BAD(15)
   8021       IF(JQ(NT,5).EQ.15)  IZQLO = MAX(15,IZQLO)
   8022 C IF HGHT PREPBUFR TBL VAL. =17 IT IS POOR QUALITY CAT. 2 HGHT WHEN
   8023 C  FILLZ=F, CHG TO 15
   8024       IF(IZQLO.EQ.17)  IZQLO = 15
   8025 C IF HGHT PREPBUFR TABLE VALUE =-1 OR -3 IT IS GOOD QUALITY CAT. 2 HGHT
   8026 C  WITH FILLZ=F, CHG TO 2
   8027       IF(IZQLO.LE.-1)  IZQLO = 2
   8028       ITQLO = JQ(NT,2)
   8029 C IF PRESSURE Q.M. IS BAD(15), THEN SET NON-MISSING ITQLO AS BAD(15)
   8030       IF(JQ(NT,5).EQ.15)  ITQLO = MAX(15,ITQLO)
   8031 C NST WILL NOW REPRESENT BOTTOM SPANNING LEVEL
   8032       NST = NT
   8033       NT = NT + 1
   8034       IF(NT.GT.KLVL)  GO TO 31
   8035       LCNT = 0
   8036       IF(JQ(NT,1).NE.16.AND.JQ(NT,2).NE.16)  GO TO 29
   8037    30 CONTINUE
   8038 C LVL W/ EITHER MISSING HGHT OR MISSING TEMP FOUND, LCNT COUNTS THESE
   8039       LCNT = LCNT + 1
   8040       NT = NT + 1
   8041       IF(NT.GT.KLVL)  GO TO 31
   8042       IF(JQ(NT,1).EQ.16.OR.JQ(NT,2).EQ.16)  GO TO 30
   8043 C THIS IS TOP SPANNING LVL (NT) -- BOTH HGHT & TEMP ARE NON-MISSING
   8044       PPHI  = TMP(NT,1)
   8045       THI   = TMP(NT,3)
   8046       VTHI   = VTMP(NT)
   8047       IZQHI = JQ(NT,1)
   8048 C IF PRESSURE Q.M. IS BAD(15), THEN SET NON-MISSING IZQHI AS BAD(15)
   8049       IF(JQ(NT,5).EQ.15)  IZQHI = MAX(15,IZQHI)
   8050 C IF HGHT PREPBUFR TABLE VALUE =17 IT IS POOR QUALITY CAT. 2 HGHT WHEN
   8051 C  FILLZ=F, CHG TO 15
   8052       IF(IZQHI.EQ.17)  IZQHI = 15
   8053 C IF HGHT PREPBUFR TABLE VALUE =-1 OR -3 IT IS GOOD QUALITY CAT. 2 HGHT
   8054 C  WITH FILLZ=F, CHG TO 2
   8055       IF(IZQHI.LE.-1)  IZQHI = 2
   8056       ITQHI = JQ(NT,2)
   8057 C IF PRESSURE Q.M. IS BAD(15), THEN SET NON-MISSING ITQHI AS BAD(15)
   8058       IF(JQ(NT,5).EQ.15)  ITQHI = MAX(15,ITQHI)
   8059 C-----------------------------------------------------------------------
   8060 C LOOP THROUGH ALL IN BETWEEN LEVELS W/ MISSING HGHT AND/OR MISSING TEMP
   8061 C-----------------------------------------------------------------------
   8062       DO L = 1,LCNT
   8063 C NOW, N REPRESENTS IN BETWEEN MISSING HGHT/TEMP LEVEL; NST STILL
   8064 C  REPRESENTS BOTTOM SPANNING LEVEL & NT REPRESENTS TOP SPANNING LEVEL
   8065          N = NST + L
   8066 C CALC. THE DELTA TEMP/DELTA LOG P BETWEEN THE SPANNING LEVELS
   8067          DTDLNP = (THI - TLO)/ALOG(PPHI/PLO)
   8068          VTDLNP = (VTHI - VTLO)/ALOG(PPHI/PLO)
   8069 C THE PRESSURE ON THIS LEVEL IS KNOWN
   8070          PP = TMP(N,1)
   8071 C CALC. THE DELTA LOG P BETWEEN THE LEVEL BENEATH & THIS LEVEL
   8072          PLOG = ALOG(PP/PLO)

Page 184         Source Listing                  WNDBYP
2017-04-18 11:09                                 prepdata.f

   8073 C NOW INTERPOLATE TEMP UP TO THIS LEVEL & DETERMINE ITS PREPBUFR TBL VAL
   8074          TT  = TLO + (DTDLNP * PLOG)
   8075          VTT  = VTLO + (VTDLNP * PLOG)
   8076          ITQ = MAX(ITQLO,ITQHI)
   8077 C IF PRESSURE Q.M. IS BAD(15), THEN SET NON-MISSING ITQ AS BAD(15)
   8078          IF(JQ(N,5).EQ.15)  ITQ = MAX(15,ITQ)
   8079          IF(ITQ.LT.16.AND.ITQ.GT.3)  THEN
   8080             ITQ = 15
   8081          ELSE  IF(ITQ.LT.3)  THEN
   8082             ITQ =  2
   8083          END IF
   8084 C IS TEMP ALREADY OF GOOD QUALITY?  IF SO, WILL REMAIN ORIG. VALUE
   8085          IF(JQ(N,2).LE.3)  THEN
   8086             TT  = TMP(N,3)
   8087             VTT  = VTMP(N)
   8088             ITQ = JQ(N,2)
   8089          END IF
   8090 C NOW INTERPOLATE HGHT UP TO THIS LEVEL & DETERMINE ITS PREPBUFR TBL VAL
   8091 C  (USE VIRTUAL TEMPERATURE IN THIS CALCULATION)
   8092          ZLO = ZLO - (RO2G * (VTT + VTLO) * PLOG)
   8093          IZQ = MAX(IZQLO,IZQHI)
   8094 C IF PRESSURE Q.M. IS BAD(15), THEN SET NON-MISSING IZQ AS BAD(15)
   8095          IF(JQ(N,5).EQ.15)  IZQ = MAX(15,IZQ)
   8096          IF(IZQ.LT.16.AND.IZQ.GT.3)  THEN
   8097             IZQ = 15
   8098          ELSE  IF(IZQ.LT.3)  THEN
   8099             IZQ =  2
   8100          END IF
   8101 C IS HGHT ALREADY OF GOOD QUALITY?  IF SO, WILL REMAIN ORIG. VALUE
   8102          IF(JQ(N,1).LE.3)  THEN
   8103             ZLO = TMP(N,2)
   8104             IZQ = JQ(N,1)
   8105          END IF
   8106 C PLO, ZLO, TLO NOW ASSIGNED TO THIS LEVEL BEFORE LOOKING AT NEXT ONE
   8107          PLO = PP
   8108          TMP(N,2) = ZLO
   8109          TMP(N,3) = TT
   8110          VTMP(N)  = VTT
   8111          IF(FILLZ)  THEN
   8112 C IF FILLZ=T, ASSIGN NEW PREPBUFR TABLE VALUE FOR HEIGHT ON THIS LEVEL
   8113 C EVENT#103 -  HEIGHT CREATED FROM HYDROSTATIC INTEGRATION OF RPTED DATA
   8114             IF(JQ(N,1).GT.3)  JR(N,1) = 103
   8115             JQ(N,1) = IZQ
   8116          ELSE
   8117 C FILLZ=F & HGT PREPBUFR TBL VAL=16: THIS IS CAT 3 OR SPECIAL LVL; RESET
   8118 C  HGT PREPBUFR TBL VAL TO -1 IF GOOD OR TO 17 IF BAD SO INCL. IN LATER
   8119 C  HGT CALCULATION (WILL CHANGE BACK TO 16)
   8120             IF(JQ(N,1).EQ.16)  THEN
   8121                IF(IZQ.LE.3)  THEN
   8122                   JQ(N,1) = -1
   8123                ELSE  IF(IZQ.GT.3.AND.IZQ.LE.15) THEN
   8124                   JQ(N,1) = 17
   8125                END IF
   8126             END IF
   8127          END IF
   8128          IF(FILLT)  THEN
   8129 C IF FILLT=T, ASSIGN NEW PREPBUFR TBL VALUE FOR TEMPERATURE ON THIS LVL

Page 185         Source Listing                  WNDBYP
2017-04-18 11:09                                 prepdata.f

   8130 C EVENT#102 - TEMPERATURE CREATED FROM INTERPOLATION OF REPORTED DATA
   8131             IF(JQ(N,2).GT.3)  JR(N,2) = 102
   8132             JQ(N,2) = ITQ
   8133          ELSE
   8134 C IF FILLT=F & TEMP PREPBUFR TABLE VALUE =16 ALSO A CAT. 3 OR SPEC. LVL;
   8135 C  RESET TEMP PREPBUFR TBL VALUE TO -1 IF GOOD, OR TO 17 IF BAD SO THAT
   8136 C  IT IS USED TO CALC. PWATER (NOT USED ANYMORE TO CALC. PWATER)
   8137             IF(JQ(N,2).EQ.16)  THEN
   8138                IF(ITQ.LE.3)  THEN
   8139                   JQ(N,2) = -1
   8140                ELSE  IF(ITQ.EQ.12)  THEN
   8141                   JQ(N,2) = -ITQ
   8142                ELSE  IF(ITQ.GT.3.AND.ITQ.LE.15)  THEN
   8143                   JQ(N,2) = 17
   8144                END IF
   8145             END IF
   8146          END IF
   8147          IZQLO = IZQ
   8148 C IF BOTTOM SPANNING PRESS. Q.M. BAD(15), SET NON-MSG IZQLO AS BAD(15)
   8149          IF(JQ(NST,5).EQ.15)  IZQLO = MAX(15,IZQLO)
   8150 C IF IZQ=-1 OR -3 THIS LVL IS A GOOD QUAL. CAT. 2 Z W/ FILLZ=F, CHG TO 2
   8151          IF(IZQLO.LE.-1)  IZQLO = 2
   8152          TLO = TT
   8153          VTLO = VTT
   8154          ITQLO = ITQ
   8155 C IF BOTTOM SPANNING PRESS. Q.M. BAD(15), SET NON-MSG ITQLO AS BAD(15)
   8156          IF(JQ(NST,5).EQ.15)  ITQLO = MAX(15,ITQLO)
   8157       ENDDO
   8158 C-----------------------------------------------------------------------
   8159       GO TO 29
   8160    31 CONTINUE
   8161   900 FORMAT(1X,10F10.2)
   8162   905 FORMAT('+',102X,8I3)
   8163   901 FORMAT ('0',//)
   8164 C+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
   8165 C DETAILED PRINT FOR SPECIFIED REPORT(S) -- IF ENTERED IN DATA CARDS
   8166       IF(IPRT(2).EQ.1.AND.NUMVAR+1.LT.11.AND.NUMQMS.LT.9)  THEN
   8167          PRINT 1905, STNID,NUMVAR+1
   8168  1905 FORMAT(/' WNDBYP: ',A8,', CAT. 1-3,5,S; HGT,T INTERP. TO MSG LVL',
   8169      $ ' - VIRT. TEMP IN COLUMN',I3)
   8170          DO N = 1,KLVL
   8171             PRINT 900, (TMP(N,K),K=1,NUMVAR),VTMP(N)
   8172             PRINT 905, (JQ(N,L),L=1,NUMQMS)
   8173          ENDDO
   8174          PRINT 901
   8175       END IF
   8176 C+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
   8177 C***********************************************************************
   8178       RETURN
   8179       END

Page 186         Source Listing                  WNDBYP
2017-04-18 11:09 Entry Points                    prepdata.f



ENTRY POINTS

  Name               
                     
 wndbyp_             


SYMBOL CROSS REFERENCE

 Name                       Object Declared Type            Bytes Dimen Elements Attributes       References                        
                                                                                                                                    
 1905                       Label  8168                                                           8167                              
 24                         Label  7961                                                           7846                              
 29                         Label  8011                                                           8008,8036,8159                    
 30                         Label  8037                                                           8042                              
 31                         Label  8160                                                           8005,8010,8034,8041               
 900                        Label  8161                                                           7829,7971,7995,8171               
 901                        Label  8163                                                           7832,7974,7998,8174               
 902                        Label  7826                                                           7825                              
 903                        Label  7968                                                           7967                              
 904                        Label  7992                                                           7991                              
 905                        Label  8162                                                           7830,7972,7996,8172               
 ALAT_8                     Scalar 7780     R(8)            8           scalar   COM                                                
 ALOG                       Func   8067                                 scalar                    8067,8068,8072                    
 ALON_8                     Scalar 7780     R(8)            8           scalar   COM                                                
 CWINDO                     Scalar 7785     R(4)            4           scalar   COM                                                
 DAT                        Scalar 7784     R(4)            4     2     9600     COM              7801,7802,7820,7829,7840,7845,7878
                                                                                                  ,7882,7892,7899,7905,7912,7913,792
                                                                                                  6,7948,7949,7960,7971,7981,7984   
 DTDLNP                     Local  8067     R(4)            4           scalar                    8067,8074                         
 FILLM                      Scalar 7781     L(4)            4           scalar   COM              7912                              
 FILLT                      Scalar 7781     L(4)            4           scalar   COM              8128                              
 FILLW                      Scalar 7785     R(4)            4           scalar   COM                                                
 FILLZ                      Scalar 7781     L(4)            4           scalar   COM              8111                              
 HDR                        Scalar 7783     R(4)            4     1     14       COM                                                
 IC                         Local  7779     I(4)            4     1     17                        7791,7871,7885,7924,7934,7935     
 IP                         Local  7840     I(4)            4           scalar                    7840,7846,7962                    
 IPRT                       Dummy  7770     I(4)            4     1     2        ARG,INOUT        7824,7966,7990,8166               
 IQ                         Scalar 7775     I(4)            4     2     3000     COM              7830,7852,7853,7854,7859,7860,7877
                                                                                                  ,7880,7881,7885,7891,7897,7898,790
                                                                                                  1,7904,7925,7934,7935,7936,7945,79
                                                                                                  46,7947,7951,7956,7957,7972       
 IQN1                       Local  7859     I(4)            4           scalar                    7859,7861,7871,7924               
 IQN3                       Local  7852     I(4)            4           scalar                    7852,7855,7856,7863               
 IQN4                       Local  7934     I(4)            4           scalar                    7934,7936,7951                    
 IQNN1                      Local  7860     I(4)            4           scalar                    7860,7862,7871,7924               
 IQNN3                      Local  7853     I(4)            4           scalar                    7853,7857,7858,7863               
 IQNN4                      Local  7935     I(4)            4           scalar                    7935,7936,7951                    
 IR                         Scalar 7776     I(4)            4     2     3000     COM              7879,7883,7893,7894,7900,7906,7927
                                                                                                  ,7950                             
 ITQ                        Local  8076     I(4)            4           scalar                    8076,8078,8079,8080,8081,8082,8088
                                                                                                  ,8132,8138,8140,8141,8142,8154    
 ITQHI                      Local  8056     I(4)            4           scalar                    8056,8058,8076                    
 ITQLO                      Local  8028     I(4)            4           scalar                    8028,8030,8076,8154,8156          
 IWORK                      Local  7777     I(4)            4     1     600                       7813,7814                         

Page 187         Source Listing                  WNDBYP
2017-04-18 11:09 Symbol Table                    prepdata.f

 Name                       Object Declared Type            Bytes Dimen Elements Attributes       References                        
                                                                                                                                    
 IZQ                        Local  8093     I(4)            4           scalar                    8093,8095,8096,8097,8098,8099,8104
                                                                                                  ,8115,8121,8123,8147              
 IZQHI                      Local  8047     I(4)            4           scalar                    8047,8049,8052,8055,8093          
 IZQLO                      Local  8019     I(4)            4           scalar                    8019,8021,8024,8027,8093,8147,8149
                                                                                                  ,8151                             
 J                          Local  7810     I(4)            4           scalar                    7810,7811                         
 JP                         Local  7845     I(4)            4           scalar                    7845,7846,7962                    
 JQ                         Dummy  7770     I(4)            4     2     3000     ARG,INOUT        7996,8008,8019,8021,8028,8030,8036
                                                                                                  ,8042,8047,8049,8056,8058,8078,808
                                                                                                  5,8088,8095,8102,8104,8114,8115,81
                                                                                                  20,8122,8124,8131,8132,8137,8139,8
                                                                                                  141,8143,8149,8156,8172           
 JQNN3                      Local  7854     I(4)            4           scalar                    7854,7956                         
 JR                         Dummy  7770     I(4)            4     2     3000     ARG,INOUT        8114,8131                         
 K                          Local  7829     I(4)            4           scalar                    7829,7971,7995,8171               
 KLVL                       Dummy  7770     I(4)            4           scalar   ARG,INOUT        7796,7799,7805,7811,7813,7814,7817
                                                                                                  ,7818,7828,7842,7970,7980,7987,799
                                                                                                  4,8006,8034,8041,8170             
 KS                         Local  7775     I(4)            4     1     600                       7806,7813,7814,7818               
 L                          Local  7818     I(4)            4           scalar                    7818,7819,7820,7830,7972,7996,8062
                                                                                                  ,8065,8172                        
 LCNT                       Local  7979     I(4)            4           scalar                    7979,7982,7983,7984,7987,8035,8039
                                                                                                  ,8062                             
 LSMASS                     Scalar 7785     I(4)            4           scalar   COM                                                
 LSWIND                     Scalar 7785     I(4)            4           scalar   COM                                                
 LWI                        Scalar 7782     I(4)            4           scalar   COM                                                
 LWR                        Scalar 7782     I(4)            4           scalar   COM              7813,7814                         
 MAX                        Func   8021                                 scalar                    8021,8030,8049,8058,8076,8078,8093
                                                                                                  ,8095,8149,8156                   
 MFLAG                      Local  7870     I(4)            4           scalar                    7870,7876,7896                    
 MM                         Local  7800     I(4)            4           scalar                    7800,7801,7802                    
 MOD                        Func   7852                                 scalar                    7852,7853,7945,7946,7956,7957     
 MP                         Local  7795     I(4)            4           scalar                    7795,7800                         
 MXLVL                      Param  7772     I(4)            4           scalar                    7775,7776,7777,7784               
 MXWRDH                     Param  7771     I(4)            4           scalar                    7783                              
 N                          Local  7798     I(4)            4           scalar                    7798,7799,7800,7817,7818,7819,7820
                                                                                                  ,7828,7829,7830,7842,7844,7845,785
                                                                                                  2,7859,7877,7878,7879,7880,7881,78
                                                                                                  82,7883,7885,7891,7892,7893,7894,7
                                                                                                  895,7897,7898,7899,7900,7904,7905,
                                                                                                  7906,7913,7925,7926,7927,7934,7936
                                                                                                  ,7945,7947,7948,7949,7950,7951,796
                                                                                                  0,7970,7971,7972,7980,7981,7983,79
                                                                                                  84,7994,7995,7996,8006,8007,8065,8
                                                                                                  070,8078,8085,8086,8087,8088,8095,
                                                                                                  8102,8103,8104,8108,8109,8110,8114
                                                                                                  ,8115,8120,8122,8124,8131,8132,813
                                                                                                  7,8139,8141,8143,8170,8171,8172   
 NCNT                       Local  7841     I(4)            4           scalar                    7841,7848,8005                    
 NFLAG                      Local  7869     I(4)            4           scalar                    7869,7890,7912                    
 NINT                       Func   7840                                 scalar                    7840,7845                         
 NM                         Dummy  7770     I(4)            4           scalar   ARG,INOUT        7795                              
 NN                         Local  7796     I(4)            4           scalar                    7796,7799,7801,7802,7805,7844,7853
                                                                                                  ,7854,7860,7877,7878,7879,7880,788
                                                                                                  1,7882,7883,7885,7891,7892,7893,78

Page 188         Source Listing                  WNDBYP
2017-04-18 11:09 Symbol Table                    prepdata.f

 Name                       Object Declared Type            Bytes Dimen Elements Attributes       References                        
                                                                                                                                    
                                                                                                  94,7895,7897,7898,7899,7900,7901,7
                                                                                                  904,7905,7906,7912,7913,7924,7925,
                                                                                                  7926,7927,7935,7936,7945,7946,7947
                                                                                                  ,7948,7949,7950,7951,7956,7957    
 NP                         Dummy  7770     I(4)            4           scalar   ARG,INOUT        7798,8005                         
 NPZ                        Scalar 7785     I(4)            4           scalar   COM                                                
 NS                         Dummy  7770     I(4)            4           scalar   ARG,INOUT        7795                              
 NST                        Local  8032     I(4)            4           scalar                    8032,8065,8149,8156               
 NT                         Local  8007     I(4)            4           scalar                    8007,8008,8015,8016,8017,8018,8019
                                                                                                  ,8021,8028,8030,8032,8033,8034,803
                                                                                                  6,8040,8041,8042,8044,8045,8046,80
                                                                                                  47,8049,8056,8058                 
 NUMDAT                     Param  7774     I(4)            4           scalar                    7775,7777,7784,7802,7810,7813,7814
                                                                                                  ,7820,7984                        
 NUMQMS                     Param  7773     I(4)            4           scalar                    7774,7775,7776,7777,7787,7824,7830
                                                                                                  ,7966,7972,7990,7996,8166,8172    
 NUMVAR                     Param  7773     I(4)            4           scalar                    7774,7786,7787,7824,7825,7829,7966
                                                                                                  ,7967,7971,7990,7991,7995,8166,816
                                                                                                  7,8171                            
 ORDERS                     Subr   7813                                                           7813,7814                         
 PARM5                      Common 7785                                 32                                                          
 PLO                        Local  8015     R(4)            4           scalar                    8015,8067,8068,8072,8107          
 PLOG                       Local  8072     R(4)            4           scalar                    8072,8074,8075,8092               
 PP                         Local  8070     R(4)            4           scalar                    8070,8072,8107                    
 PPHI                       Local  8044     R(4)            4           scalar                    8044,8067,8068                    
 RO2G                       Local  7793     R(4)            4           scalar                    7793,8092                         
 RPTHDR                     Common 7783                                 88                                                          
 SCALE                      Local  7792     R(4)            4           scalar                    7792,7840,7845                    
 SNDATA                     Common 7784                                 38400                                                       
 STNID                      Scalar 7778     CHAR            8           scalar   COM              7825,7967,7991,8167               
 SUBSET_D                   Scalar 7778     CHAR            8           scalar   COM                                                
 THI                        Local  8045     R(4)            4           scalar                    8045,8067                         
 TLO                        Local  8017     R(4)            4           scalar                    8017,8067,8074,8152               
 TMP                        Dummy  7770     R(4)            4     2     9600     ARG,INOUT        7802,7811,7984,7995,8015,8016,8017
                                                                                                  ,8044,8045,8070,8086,8103,8108,810
                                                                                                  9,8171                            
 TMPINV                     Local  7777     R(4)            4     2     9600                      7811,7813,7814,7820               
 TT                         Local  8074     R(4)            4           scalar                    8074,8086,8109,8152               
 VDAT                       Local  7776     R(4)            4     1     600                       7819,7829,7895,7971,7983          
 VTDLNP                     Local  8068     R(4)            4           scalar                    8068,8075                         
 VTHI                       Local  8046     R(4)            4           scalar                    8046,8068                         
 VTLO                       Local  8018     R(4)            4           scalar                    8018,8068,8075,8092,8153          
 VTMP                       Dummy  7770     R(4)            4     1     600      ARG,INOUT        7801,7819,7983,7995,8018,8046,8087
                                                                                                  ,8110,8171                        
 VTT                        Local  8075     R(4)            4           scalar                    8075,8087,8092,8110,8153          
 WNDBYP                     Subr   7770                                                                                             
 WORD                       Common 7782                                 8                                                           
 ZLO                        Local  8016     R(4)            4           scalar                    8016,8092,8103,8108               

Page 189         Source Listing                  WNDBYP
2017-04-18 11:09                                 prepdata.f

   8180 C$$$  SUBPROGRAM DOCUMENTATION BLOCK
   8181 C
   8182 C SUBPROGRAM:    WNDBYZ
   8183 C   PRGMMR: D. A. KEYSER     ORG: NP22       DATE: 2000-02-17
   8184 C
   8185 C ABSTRACT: MERGES CATEGORY 4 (WINDS-BY-HEIGHT) DATA LEVEL DATA INTO
   8186 C   UPPER-AIR REPORT PROFILE.  CHECKS FOR ADJACENT LEVEL HEIGHTS NO
   8187 C   MORE THAN 1 METER APART AND IF FOUND TRANSFERS HIGHEST QUALITY WIND
   8188 C   TO A CAT. 1,2,5,3, SPECIAL DATA LEVEL.  INTERPOLATES PRESSURE &
   8189 C   TEMP. TO CAT. 4 DATA LEVELS WHERE PRESSURE IS MISSING. FINALLY,
   8190 C   CHECKS FOR DUPLICATE PRESSURES AND IF FOUND TRANSFERS HIGHEST
   8191 C   QUALITY WIND TO A CAT. 1,2,5,3, SPECIAL DATA LEVEL.
   8192 C
   8193 C PROGRAM HISTORY LOG:
   8194 C   UNKNOWN
   8195 C 1988-04-11  D. A. KEYSER -- DOCBLOCKING/COMMENTING
   8196 C 1989-04-17  D. A. KEYSER -- DOCBLOCKING/COMMENTING, TESTS FOR SPEC.
   8197 C     LEVELS (UNIQUE CAT. NO. OF 6)
   8198 C 1989-12-13  D. A. KEYSER -- 'FILL' SWITCH NOW TESTED FOR INTERPOLATING
   8199 C     TO MISSING DATA LEVELS
   8200 C 1990-01-11  D. A. KEYSER -- CONVERTED TO VS FORTRAN(77) & RESTRUCTURED
   8201 C 1990-10-25  D. A. KEYSER -- Q.M. FOR TEMP. INTERP. TO CAT. 4 LVL NOW
   8202 C     MIN. OF 3 (WAS 2) FOR PREPDA, THIS ENSURES THAT RPTED. TEMP. USED
   8203 C     WHEN CAT. 4 CALC. PRESS. COINCIDES W/ CAT. 1,2, OR 5 PRESS. WHICH
   8204 C     MAY HAVE TEMP. W/ Q.M. OF 2; CAT 4 HGHT Q.M. IS 9 IF EITHER
   8205 C     SPANNING P-LVL HGHT Q.M. IS 10, CAN'T LOCATE PROPER PRESS. FOR
   8206 C     CAT. 4 IN THIS CASE
   8207 C 1992-12-02  D. A. KEYSER -- U-AIR CAT. 4 CALC. PRESSURES SET TO
   8208 C     NEAREST INTEGER RATHER THAN TRUNCATED
   8209 C 1993-05-12  D. A. KEYSER -- THE NEW "PREPBUFR TABLE VALUES" WHICH CAN
   8210 C     RANGE FROM 0-15 ARE EMPLOYED RATHER THAN THE OLD OI/SSI QUALITY
   8211 C     MARKERS; IN INTERNAL PROCESSING MISSING DATA GET PREPBUFR TABLE
   8212 C     VALUE OF 16 RATHER THAN 10; VERTICAL COORDINATE INDIC. ADDED TO
   8213 C     PREPBUFR TBL VALUE LIST FOR VARIABLES
   8214 C 1993-09-14  D. A. KEYSER -- SENSIBLE TEMPERATURE FOR PROFILE SAVED
   8215 C     IN STMP OR SDAT ARRAYS (IN CASE TVIRT=FALSE)
   8216 C 1993-12-21  D. A. KEYSER -- DUPL. LVLS NOW ENSURES THAT BEST TEMP IS
   8217 C     KEPT REGARDLESS OF HGHT TBL. VAL. & WILL NOT TRANSF. DWPT TO LVL
   8218 C     WHERE MSG UNLESS FILLM=T OR TEMP. HAS BEEN TRANSF.; HGHTS MUST
   8219 C     AGREE TO NEAREST 100'TH METER TO BE DUPL.; NO LONGER SET 2 LVLS
   8220 C     WITHIN 1 MB OF EACH OTHER TO SAME PRESSURE
   8221 C 1994-08-11  D. A. KEYSER --  ALL DUPL. PRESS. CHECKS NOW REQUIRE
   8222 C     PRESS. TO AGREE TO NEAREST 10'TH OF A MB TO BE A DUPL. (WAS TO
   8223 C     NEAREST WHOLE MB); CALC. CAT. 4 PRESS. NOW STORED TO NEAREST
   8224 C     10'TH OF A MB (WAS TO NEAREST WHOLE MB)
   8225 C 1995-07-12  D. A. KEYSER -- IF SPANNING LVL PRESS. Q.M. IS BAD ALL
   8226 C     INTEGR. DATA SET TO BAD Q.M.
   8227 C 1996-03-04  D. A. KEYSER -- FOR RGL-BUFR OUTPUT: MORE FIXES TO MAKE
   8228 C     BUFR-PREPDA FILE CONTAIN DATA EXPECTED BY FERR PGM & OI-ANAL
   8229 C     (DUPL. P/Z-LVL CHECKS MORE LIKE OLD "PREPDA" FORM; INTERP./CALC.
   8230 C     DATA CAN GET GOOD Q.M. IF SPANNING LVL DATA GOOD)
   8231 C 1997-05-01  D. A. KEYSER -- WILL NOW ALWAYS RESORT ALL REPORTS BY
   8232 C     PRESSURE TO ENSURE THAT ALL REPORTS IN THE PREPBUFR FILE WILL BE
   8233 C     ARRANGED IN DECREASING PRESSURE (ERRONEOUS REPORTS MAY CONTAIN
   8234 C     HEIGHTS THAT ARE OUT OF ORDER NOW); EST. REASON CODES FOR
   8235 C     UPPER-AIR DATA TYPES (CURRENTLY JUST 100, 101-103, 105 TO
   8236 C     IDENTIFY INTERPOLATED DATA FOR CQCBUFR PGM); CHGS IN LVL ON29

Page 190         Source Listing                  WNDBYP
2017-04-18 11:09                                 prepdata.f

   8237 C     CATEGORY INDICATORS: SPEC. LVLS GET CAT=7 RATHER THAN 6, CAT=4
   8238 C     EXPLICITLY IDENTIFED IN ALL CASES
   8239 C 1998-02-17  D. A. KEYSER -- FOR SPCIAL=F, WILL GENERATE CAT. 4 PRESS
   8240 C     VIA U.S. STD. ATMOS. WHEN NO SPANNING LVLS W/ Z AVAIL.
   8241 C 1999-08-04  D. A. KEYSER -- REPLACED SORT ROUTINE "SHELL" (IN-LINE
   8242 C     SUBROUTINE) WITH W3LIB ROUTINE "ORDERS", MORE EFFICIENT AND
   8243 C     ALLOWS MULTIPLE ORDER SORT KEYS
   8244 C 2000-02-17  D. A. KEYSER -- CAT. 4 UPPER-AIR LEVELS NOW SET WIND Q.M.
   8245 C     TO AT LEAST 2 ONLY IF WIND DOES NOT HAVE AN SDM KEEP FLAG (I.E.,
   8246 C     THE KEEP FLAG ON CAT. 4 WINDS IS HONORED)
   8247 C
   8248 C USAGE:    CALL WNDBYZ(NM,NS,NP,NH,KLVL,TMP,JQ,IPRT,VTMP)
   8249 C   INPUT ARGUMENT LIST:
   8250 C     NM       - NO. OF LEVELS IN CAT. 1 (MANDATORY MASS/WIND)
   8251 C     NS       - NO. OF LEVELS IN CAT. 2,5 (SIG. MASS & TROP)
   8252 C     NP       - NO. OF CAT. 3 & SPECIAL 25 OR 50 MB PRES. LVLS
   8253 C     NH       - NO. OF LEVELS IN CAT. 4 (WINDS-BY-HEIGHT)
   8254 C     KLVL     - NO. OF COMBINED  CAT. 1,2,3,5 AND SPECIAL 25/50 MB
   8255 C              - LEVELS WITH DUPLICATES REMOVED
   8256 C     TMP      - "MXLVL" X "NUMDAT" ARRAY HOLDING AN U-AIR REPORT'S
   8257 C              - MASS & WIND DATA IN CAT. 1,2,3,5 AND SPECIAL 25/50 MB
   8258 C              - LEVELS AFTER MERGING
   8259 C     JQ       - "MXLVL" X "NUMQMS" ARRAY HOLDING AN U-AIR RPT'S
   8260 C              - PREPBUFR TABLE VALUES IN CAT. 1,2,3,5 AND SPECIAL
   8261 C              - 25/50 MB LVLS AFTER MERGING
   8262 C     IPRT     - 2-WORD SWITCH, DETAILED STD. O-PUT (UNIT 6) PRT OF RPT
   8263 C     VTMP     - "MXLVL" WORD ARRAY HOLDING AN U-AIR REPORT'S VIRTUAL
   8264 C              - TEMP DATA IN CAT. 1,2,3,5 AND SPECIAL 25/50 MB LEVELS
   8265 C              - AFTER MERGING
   8266 C
   8267 C   OUTPUT ARGUMENT LIST:
   8268 C     KLVL     - NO. OF COMBINED  CAT. 1,2,3,4,5 AND SPECIAL
   8269 C              - 25/50 MB LEVELS WITH DUPLICATES REMOVED
   8270 C     TMP      - "MXLVL" X "NUMDAT" ARRAY HOLDING AN U-AIR REPORT'S
   8271 C              - MASS & WIND DATA IN CAT. 1,2,3,4,5 AND SPECIAL
   8272 C              - 25/50 MB LEVELS AFTER MERGING
   8273 C     JQ       - "MXLVL" X "NUMQMS" ARRAY HOLDING AN U-AIR RPT'S
   8274 C              - PREPBUFR TABLE VALUES IN CAT. 1,2,3,4,5 AND SPECIAL
   8275 C              - 25/50 MB LEVELS AFTER MERGING
   8276 C
   8277 C   OUTPUT FILES:
   8278 C     UNIT 06  - STANDARD OUTPUT PRINT
   8279 C
   8280 C REMARKS: CALLED BY SUBROUTINE 'SMERGE'.
   8281 C
   8282 C ATTRIBUTES:
   8283 C   LANGUAGE: FORTRAN 90
   8284 C   MACHINE:  NCEP WCOSS
   8285 C
   8286 C$$$
   8287       SUBROUTINE WNDBYZ(NM,NS,NP,NH,KLVL,TMP,JQ,IPRT,VTMP)
   8288       PARAMETER (MXWRDH = 15)
   8289       PARAMETER (MXLVL = 600)
   8290       PARAMETER (NUMVAR = 6, NUMQMS = 5)
   8291       PARAMETER (NUMDAT = NUMVAR + (2 * NUMQMS))
   8292       PARAMETER (MAXOBS = 3500)
   8293       DIMENSION  TMP(MXLVL,NUMDAT),KS(MXLVL),IQ(MXLVL,NUMQMS),

Page 191         Source Listing                  WNDBYZ
2017-04-18 11:09                                 prepdata.f

   8294      $ JQ(MXLVL,NUMQMS),IDATA(MAXOBS),VTMP(MXLVL),VDAT(MXLVL),
   8295      $ IR(MXLVL,NUMQMS),IWORK(MXLVL),TMPINV(NUMDAT,MXLVL)
   8296       LOGICAL  SPCIAL,FILLT,FILLM
   8297       CHARACTER*8  STNID,SUBSET_d
   8298       INTEGER  IPRT(2),IC(0:16)
   8299       real(8)  alon_8,alat_8
   8300       COMMON/WORD/LWI,LWR
   8301       COMMON/ADP/ISATOB,PMAND(23),RDATA(MAXOBS),IPRINT
   8302       COMMON/RPTHDR/SUBSET_d,STNID,HDR(2:MXWRDH),alon_8,alat_8
   8303       COMMON/SNDATA/DAT(MXLVL,NUMDAT)
   8304       COMMON/UPALIM/LEVPM,LEVST,LEVQQ,TDLIM,TDMAX,SPCIAL,ISQNUM_UPA
   8305       COMMON/PARM5/FILLZ,FILLT,FILLW,FILLM,LSWIND,LSMASS,CWINDO,NPZ
   8306       EQUIVALENCE (DAT(1,NUMVAR+1),IQ),(RDATA,IDATA)
   8307       EQUIVALENCE (DAT(1,NUMVAR+NUMQMS+1),IR)
   8308 C PREPBUFR TABLE VALUE INTERPRETED AS: 0 - KEEP, 1 - GOOD,
   8309 C  2- DEFAULT, 3 - SUSPECT, 9 - BAD  IN DUPL. LEVEL TBL VALUE COMPARISON
   8310 C  T.V.->      0  1  2  3  4  5  6  7  8  9  10  11  12  13  14  15  16
   8311       DATA IC/ 0, 1, 2, 3, 9, 9, 9, 9, 9, 9,  9,  9,  9,  9,  9,  9, 16/
   8312       DATA YMISS/99998.8/
   8313 C FCN PRS CALC. PRESS. FROM ALT. FOR Z > 11000M (U.S. STANDARD ATMOSPHERE)
   8314       PRS(Z) = 226.3 * EXP(1.576106E-4 * (11000. - Z))
   8315       SCALE  = 10.
   8316       SCALE0 = 100.
   8317       G = 9.8
   8318       R = 287.05
   8319 C MH IS NO. OF CAT 1,2,5,3, & SPECIAL LEVELS (ARRANGED IN PROPER ORDER)
   8320       MH = NM + NS + NP
   8321       NN = KLVL
   8322 C TRANSFER BLOCK OF CAT. 4 LEVELS FROM DAT TO TMP
   8323       DO N = 1,NH
   8324          MM = MH + N
   8325          NN = KLVL + N
   8326          VTMP(NN) = DAT(MM,3)
   8327          TMP(NN,1:NUMDAT) = DAT(MM,1:NUMDAT)
   8328       ENDDO
   8329 C KLVL NOW IS TOTAL OF CAT. 1,2,3,5, SPECIAL & 4 LVLS, DUPL. POSS.
   8330       KLVL = NN
   8331       KS = 0
   8332 C ARRANGE LEVELS IN ORDER OF INCREASING HEIGHT (FIRST ORDER SORT KEY,
   8333 C  SECOND ORDER SORT KEY IS PRESSURE)
   8334 C .. MUST SWITCH ORDER OF ELEMENTS IN TMP ARRAY - CALL IT TMPINV
   8335       DO  J=1,NUMDAT
   8336          TMPINV(J,1:KLVL) = TMP(1:KLVL,J)
   8337       END DO
   8338       CALL ORDERS( 2,IWORK,TMPINV(1,1),KS,KLVL,NUMDAT,LWR,2)
   8339       CALL ORDERS(12,IWORK,TMPINV(2,1),KS,KLVL,NUMDAT,LWR,2)
   8340       N = 0
   8341 C+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
   8342 C DETAILED PRINT FOR SPECIFIED REPORT(S) -- IF ENTERED IN DATA CARDS
   8343       IF(IPRT(2).EQ.1.AND.NUMVAR+1.LT.11.AND.NUMQMS.LT.9)
   8344      $ PRINT 903, STNID,NUMVAR+1
   8345   903 FORMAT(/' WNDBYZ: ',A8,', CAT. 4 HGTS INSERTED, NEXT DUPL. Z CHK',
   8346      $ ' - VIRT. TEMP IN COLUMN',I3)
   8347 C+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
   8348 C .. DAT ARRAY LIKE TMPINV ARRAY, BUT P-LVLS ARRANGED PROPERLY, ALSO
   8349 C    ORDER OF ELEMENTS SWITCHED BACK
   8350       DO I = 1,KLVL

Page 192         Source Listing                  WNDBYZ
2017-04-18 11:09                                 prepdata.f

   8351          L = KS(I)
   8352          N = N + 1
   8353          VDAT(N) = VTMP(L)
   8354          DAT(N,1:NUMDAT) = TMPINV(1:NUMDAT,L)
   8355 C+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
   8356 C DETAILED PRINT FOR SPECIFIED REPORT(S) -- IF ENTERED IN DATA CARDS
   8357          IF(IPRT(2).EQ.1.AND.NUMVAR.LT.11.AND.NUMQMS.LT.9)  THEN
   8358             PRINT 900, (DAT(N,K),K=1,NUMVAR),VDAT(N)
   8359             PRINT 905, (IQ(N,J),J=1,NUMQMS)
   8360          END IF
   8361 C+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
   8362          IF(N.EQ.1)  CYCLE
   8363 C***********************************************************************
   8364 C CHECK ADJACENT LVLS: IF HGHTS ARE THE SAME TO NEAREST 100TH METER MAY
   8365 C RESULT IN TRANSFER OF WIND FROM CAT. 4 DATA LVL TO CAT. 1,2,5,3,SPEC
   8366 C                              DATA LVL
   8367 C***********************************************************************
   8368          IZ = NINT(DAT(N,2)*SCALE0)
   8369 C NM IS LVL DIRECTLY BELOW N -- TRANSFER ALWAYS FROM N TO NM
   8370          NM = N - 1
   8371          JZ = NINT(DAT(NM,2)*SCALE0)
   8372          IF(IZ.NE.JZ)  CYCLE
   8373 C DUPL. LVL CHECK SATISFIED; IN CASE ONE OF IQ(N,3)/IQ(NM,3) BELOW = 7
   8374 C FOR SPEC. LVLS, NEED TO TEST AS CAT. 3 (ORIG. SPEC. LVLS SET AS CAT 3)
   8375 C  (SAME TRUE FOR TROP LVLS SET TO CAT 5 BUT NEED TO BE TESTED AS CAT 2)
   8376          IQN3 = MOD(IQ(N,3),20)
   8377          IQNM3 = MOD(IQ(NM,3),20)
   8378          IF(IQN3.EQ.5)  IQN3  = 2
   8379          IF(IQN3.EQ.7)  IQN3  = 3
   8380          IF(IQNM3.EQ.5) IQNM3 = 2
   8381          IF(IQNM3.EQ.7) IQNM3 = 3
   8382          IF(IQN3.LT.IQNM3)  THEN
   8383 C-----------------------------------------------------------------------
   8384 C   CASE WHERE CAT. 4 DATA LVL ON "NM", CAT 1,2,5,3, SPECIAL DATA LVL
   8385 C                                  ON "N"
   8386 C  (NOTE: THIS LOGIC IS CONVOLUTED -- SOMETIME NEEDS TO BE STREAMLINED)
   8387 C-----------------------------------------------------------------------
   8388             IQN1  = IQ(N,1)
   8389             IQNM1 = IQ(NM,1)
   8390             IF(IQN1 .LE.-1.OR.IQN1 .EQ.17)  IQN1  = 16
   8391             IF(IQNM1.LE.-1.OR.IQNM1.EQ.17)  IQNM1 = 16
   8392             NFLAG = 0
   8393             MFLAG = 0
   8394             IF(IC(IQN1).LT.IC(IQNM1))  THEN
   8395 C HGHT PREPBUFR TBL VALUE FOR N BETTER THAN FOR NM (NEVER TRUE FOR SPEC.
   8396 C  LVL ON N, HGHT PREPBUFR TBL VAL=16) - TRANSFER PRESS., HGHT, CAT. NO.
   8397 C  & VERT. COORD. INDICATOR ON LEVEL N TO NM
   8398 C (NOTE: IF HGT PREPBUFR TBL VALUE ON N NOT BETTER, NEVER TRANSF. TEMP)
   8399 C IF WIND IS ORIGINALLY FROM CAT. 4 LEVEL ADD 20 TO CAT. NO.
   8400                IF(DAT(N,5).GE.YMISS.OR.DAT(N,6).GE.YMISS)
   8401      $          IQ(N,3) = MOD(IQ(N,3),20) + 20
   8402                MFLAG = 1
   8403                IQ(NM,1) = IQ(N,1)
   8404                DAT(NM,1) = DAT(N,1)
   8405                IR(NM,1) = IR(N,1)
   8406                IQ(NM,3) = IQ(N,3)
   8407                IQ(NM,5) = IQ(N,5)

Page 193         Source Listing                  WNDBYZ
2017-04-18 11:09                                 prepdata.f

   8408                DAT(NM,2) = DAT(N,2)
   8409                IR(NM,5) = IR(N,5)
   8410             END IF
   8411             IQN2  = IQ(N,2)
   8412             IQNM2 = IQ(NM,2)
   8413             IF(IQN2 .EQ.-1.OR.IQN2. EQ.17)  IQN2  = 16
   8414             IF(IQNM2.EQ.-1.OR.IQNM2.EQ.17)  IQNM2 = 16
   8415             IF(IQN2 .EQ.-12.OR.IQN2 .EQ.-14)  IQN2   = -IQN2
   8416             IF(IQNM2.EQ.-12.OR.IQNM2.EQ.-14)  IQNM2  = -IQNM2
   8417             IF(IC(IQN2).LT.IC(IQNM2))  THEN
   8418 C TEMP PREPBUFR TBL V. FOR N BETTER THAN FOR NM (NEVER TRUE FOR SPC. LVL
   8419 C  ON N, TEMP PREPBUFR TBL VAL. =16) TRANSFER TEMP ON LVL N TO LVL NM
   8420 C (TEMP CAN. BE TRANS. REGARDLESS OF HGHT PREPBUFR TABLE VALUE, ALSO MAY
   8421 C  TRANS. PRESS.,CAT. NO.,VERT. COORD. IND. IN THIS CASE)
   8422                NFLAG = 1
   8423                IQ(NM,2) = IQ(N,2)
   8424                DAT(NM,3) = DAT(N,3)
   8425                IR(NM,2) = IR(N,2)
   8426                IR(NM,3) = IR(N,3)
   8427                VDAT(NM) = VDAT(N)
   8428                IF(MFLAG.EQ.0)  THEN
   8429                   IQ(NM,3) = IQ(N,3)
   8430                   IQ(NM,5) = IQ(N,5)
   8431                   DAT(NM,1) = DAT(N,1)
   8432                   IR(NM,5) = IR(N,5)
   8433                END IF
   8434             END IF
   8435        IF(MOD(IQ(N,3),20).EQ.1.AND.IC(IQ(N,4)).LE.IC(IQ(NM,4)).AND.
   8436      $        (MFLAG.EQ.1.OR.NFLAG.EQ.1))  THEN
   8437 C IF LVL N IS CAT. 1 & WIND PREPBUFR T.V. FOR N AT LEAST AS GOOD AS FOR
   8438 C  NM AND EITHER HGHT OR TEMP HAVE BEEN TRANS., TRANF. WIND ON LVL N TO
   8439 C  NM
   8440 C (NOTE: THIS MAY BE REDUNDANT TO LOGIC TESTING FOR TRANSF. OF CAT. NO.
   8441 C        1-3,5 TO LEVEL NM JUST AFTER THIS IF-THEN-ELSE BLOCK)
   8442                IQ(NM,4) = IQ(N,4)
   8443                DAT(NM,5) = DAT(N,5)
   8444                DAT(NM,6) = DAT(N,6)
   8445                IR(NM,4) = IR(N,4)
   8446             END IF
   8447 C WILL ONLY TRANSFER DWPT ON LVL N TO LVL NM WHEN NM DWPT IS MISSING
   8448 C  AND EITHER FILLM IS TRUE OR ABOVE TRANSF. OF TEMP & CAT. # OCCURRED
   8449             IF(DAT(NM,4).GE.9999..AND.(FILLM.OR.NFLAG.EQ.1))
   8450      $       DAT(NM,4) = DAT(N,4)
   8451          END IF
   8452 C-----------------------------------------------------------------------
   8453 C  CASE WHERE CAT. 4 DATA LVL OR CAT 1,2,5,3, SPEC. DATA LVL COULD BE
   8454 C                             EITHER WAY
   8455 C-----------------------------------------------------------------------
   8456          IQN4  = IC(IQ(N,4))
   8457          IQNM4 = IC(IQ(NM,4))
   8458         IF(IQN4.LT.IQNM4.OR.(IQN4.EQ.IQNM4.AND.IQ(N,3).EQ.IQ(NM,3)))THEN
   8459 C WIND PREPBUFR TBL V. FOR N BETTER THAN FOR NM - OR - WIND PREPBUFR TBL
   8460 C  VAL. FOR N SAME AS FOR NM AND CAT. NO. 1-3,5 TRANSF. FROM N TO NM --
   8461 C  TRANSFER WIND ON LVL N TO LVL NM (NEVER TRUE FOR SPEC. LVLS WHEN ON
   8462 C  "N", WIND PREPBUFR TBL VALUE = 16; ALWAYS TRUE FOR SPEC. LVLS WHEN ON
   8463 C  "NM", WIND PREPBUFR TABLE VALUE = 16)
   8464 C IF WIND IS ORIGINALLY FROM CAT. 4 LEVEL ADD 20 TO CAT. NO.

Page 194         Source Listing                  WNDBYZ
2017-04-18 11:09                                 prepdata.f

   8465             IF(MOD(IQ(N,3),20).EQ.4)  IQ(NM,3)=MOD(IQ(NM,3),20)+20
   8466             IQ(NM,4) = IQ(N,4)
   8467 C LVL TRANS. FROM IS CAT.4 & LVL TRANS. TO HAS A MSG/BAD HGT, THEN LVL
   8468 C  TRANS. TO WIND PREPBUFR TBL VAL. IS SET TO AT LEAST 2
   8469             IF(MOD(IQ(N,3),20).EQ.4.AND.IQ(NM,1).GT.3)
   8470      $       IQ(NM,4) = MAX(2,IQ(NM,4))
   8471             IR(NM,4) = IR(N,4)
   8472             DAT(NM,5) = DAT(N,5)
   8473             DAT(NM,6) = DAT(N,6)
   8474          END IF
   8475          N = N - 1
   8476       ENDDO
   8477       KLVL = N
   8478 C+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
   8479 C DETAILED PRINT FOR SPECIFIED REPORT(S) -- IF ENTERED IN DATA CARDS
   8480       IF(IPRT(2).EQ.1.AND.NUMVAR+1.LT.11.AND.NUMQMS.LT.9)  THEN
   8481          PRINT 901
   8482          PRINT 904, STNID,NUMVAR+1
   8483   904 FORMAT(/' WNDBYZ: ',A8,', DUPL. HGHTS REMOVED, GOOD DATA TRANSF.',
   8484      $ ' - VIRT. TEMP IN COLUMN',I3)
   8485          DO N = 1,KLVL
   8486             PRINT 900, (DAT(N,K),K=1,NUMVAR),VDAT(N)
   8487             PRINT 905, (IQ(N,L),L=1,NUMQMS)
   8488          ENDDO
   8489          PRINT 901
   8490       END IF
   8491 C+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
   8492 C***********************************************************************
   8493 C    INTERP. PRESS. & IF APPROPRIATE TEMP TO LVLS WHERE PRESS. MSG
   8494 C       (NORMALLY MEANING INTERPOLATE TO THE CAT. 4 DATA LEVELS)
   8495 C***********************************************************************
   8496       DO N = 1,KLVL
   8497          NT = N
   8498          IF(DAT(N,1).LT.3275.0)  GO TO 39
   8499          IF(NPZ.EQ.0.AND.DAT(N,2).LT.32000)  THEN
   8500 C IF THIS REPORT HAS NO VALID HEIGHT LEVELS (E.G., ONLY CAT. 4 DATA AS
   8501 C  FOR PIBALS, NPN/CAP/JMA WIND PROFILERS, OR VAD WINDS; ONLY CAT. 3
   8502 C  AND 4 DATA AS FOR PIBALS OR WIND PROFILERS ORIGINALLY FROM PILOT
   8503 C  (PIBAL) FORMAT BULLETINS) THEN GET PRESSURE FROM HEIGHT VIA U.S.
   8504 C  STD. ATMOSPHERE
   8505 C  NOTE: DOES NOT APPLY WHEN SPCIAL = TRUE
   8506             CALL W3FA04(DAT(N,2),DAT(N,1),TMPR,THETA)
   8507 C EVENT#116 -  PRESS CREATED FROM RPRTED HGHT VIA U.S. STD ATMOS. VALUE
   8508             IR(N,5) = 116
   8509          ELSE
   8510 C OTHERWISE, SET MISSING PRESSURE NOT BETWEEN SPANNING PRES-LVLS TO 0.0
   8511             DAT(N,1) = 0.0
   8512          END IF
   8513       ENDDO
   8514       GO TO 33
   8515    39 CONTINUE
   8516 C NON-MISSING PRESSURE FOUND AT LVL=NT, THIS IS BOTTOM SPANNING PRESSURE
   8517       PLO = DAT(NT,1)
   8518       ZLO = DAT(NT,2)
   8519       TLO = DAT(NT,3)
   8520       VTLO = VDAT(NT)
   8521       IPQLO = IQ(NT,5)

Page 195         Source Listing                  WNDBYZ
2017-04-18 11:09                                 prepdata.f

   8522 C FOR FILLZ & FILLT = F CASES OF CAT. 2, 3, & SPEC. LVLS; RESET Z & T
   8523 C  PREPBUFR TABLE VALUES
   8524       IZQLO = IQ(NT,1)
   8525       IF(IZQLO.LE.-1)  THEN
   8526          IZQLO = 2
   8527       ELSE  IF(IZQLO.EQ.17)  THEN
   8528          IZQLO = 15
   8529       END IF
   8530       ITQLO = IQ(NT,2)
   8531 C IF PRESSURE Q.M. IS BAD(15), THEN SET NON-MISSING ITQLO AS BAD(15)
   8532       IF(IQ(NT,5).EQ.15)  ITQLO = MAX(15,ITQLO)
   8533       IF(ITQLO.EQ.-1)  THEN
   8534          ITQLO =  2
   8535       ELSE  IF(ITQLO.EQ.17)  THEN
   8536          ITQLO = 15
   8537       ELSE  IF(ITQLO.EQ.-12.OR.ITQLO.EQ.-14)  THEN
   8538          ITQLO = -ITQLO
   8539       END IF
   8540       NT = NT + 1
   8541       IF(NT.GT.KLVL)  GO TO 33
   8542       LCNT = 0
   8543       IF(DAT(NT,1).LT.3275.0)  GO TO 39
   8544    41 CONTINUE
   8545 C MISSING PRESSURE FOUND W/ A VALID PRESSURE BELOW, LCNT COUNT THESE
   8546       LCNT = LCNT + 1
   8547       NT = NT + 1
   8548       IF(NT.GT.KLVL)  THEN
   8549          IF(.NOT.SPCIAL)  THEN
   8550             NN = NT - LCNT - 1
   8551             PPREF = DAT(NN,1)
   8552 C-----------------------------------------------------------------------
   8553 C      COME HERE IF ALL REMAINING LEVELS UP HAVE MISSING PRESSURE
   8554 C    GENERATE U.S. STANDARD ATMOSPHERE PRESSURE FROM REPORTED HEIGHT
   8555 C             NOTE: DOES NOT APPLY WHEN SPCIAL = TRUE
   8556 C-----------------------------------------------------------------------
   8557             DO L = 1,LCNT
   8558                NN = NN + 1
   8559 C NN IS NOW INDEX FOR NEXT MISSING PRESSURE LEVEL IN LCNT LOOP
   8560                IF(DAT(NN,2).LT.32000) THEN
   8561                   CALL W3FA04(DAT(NN,2),PP,TMPR,THETA)
   8562                ELSE
   8563                   PP = PRS(DAT(NN,2))
   8564                END IF
   8565 C PERFORM A SANITY CHECK ON THE PRESSURE (MUST KEEP DECREASING W/ HGHT)
   8566                IF(NINT(PP*10.).LT.NINT(PPREF*10.))  THEN
   8567                   DAT(NN,1) = PP
   8568                   PPREF = DAT(NN,1)
   8569 C EVENT#116 -  PRESS CREATED FROM RPRTED HGHT VIA U.S. STD ATMOS. VALUE
   8570                   IR(NN,5) = 116
   8571                END IF
   8572             ENDDO
   8573 C-----------------------------------------------------------------------
   8574          END IF
   8575          GO TO 33
   8576       END IF
   8577       IF(DAT(NT,1).GE.3275.0)  GO TO 41
   8578 C NON-MISSING PRESSURE FOUND ABOVE MISSING PRESSURE (TOP SPANNING PRESS)

Page 196         Source Listing                  WNDBYZ
2017-04-18 11:09                                 prepdata.f

   8579       PPHI = DAT(NT,1)
   8580       ZHI = DAT(NT,2)
   8581       THI = DAT(NT,3)
   8582       VTHI = VDAT(NT)
   8583       IPQHI = IQ(NT,5)
   8584 C FOR FILLZ & FILLT = F CASES OF CAT. 2, 3, & SPEC. LVLS; RESET Z & T
   8585 C  PREPBUFR TABLE VALUES
   8586       IZQHI = IQ(NT,1)
   8587       IF(IZQHI.LE.-1)  THEN
   8588          IZQHI = 2
   8589       ELSE  IF(IZQHI.EQ.17)  THEN
   8590          IZQHI = 15
   8591       END IF
   8592       ITQHI = IQ(NT,2)
   8593 C IF PRESSURE Q.M. IS BAD(15), THEN SET NON-MISSING ITQHI AS BAD(15)
   8594       IF(IQ(NT,5).EQ.15)  ITQHI = MAX(15,ITQHI)
   8595       IF(ITQHI.EQ.-1)  THEN
   8596          ITQHI =  2
   8597       ELSE  IF(ITQHI.EQ.17)  THEN
   8598          ITQHI = 15
   8599       ELSE  IF(ITQHI.EQ.-12.OR.ITQHI.EQ.-14)  THEN
   8600          ITQHI = -ITQHI
   8601       END IF
   8602 C CALC. THE LOG OF DELTA P FOR THE TWO VALID SPANNING PRESSURE LEVELS
   8603       ALNPB = ALOG(PLO)
   8604       ALNPT = ALOG(PPHI)
   8605       DLNP = ALNPB - ALNPT
   8606       IF(DLNP.NE.0.)  GO TO 7612
   8607 C-----------------------------------------------------------------------
   8608 C PROBLEM: SPANNING PRESSURES ARE THE SAME !!!
   8609   898 CONTINUE
   8610          NN = NT - LCNT - 1
   8611          PRINT 899, STNID,RDATA(1),RDATA(2),IDATA(9),NN,NT
   8612   899 FORMAT(' > > APPARENT DUPL. LEVELS-ID=',A8,', LAT=',F7.2,'N, ',
   8613      $ 'LON=',F8.2,'E, RTYP',I4,' - BETWEEN',I4,' AND',I4/)
   8614          DO N = NN,NT
   8615 C FOR FILLZ=F CASES OF CAT. 2, 3, & SPEC. LVLS MUST RESET HGHT PREPBUFR
   8616 C  TABLE VALUE
   8617             IQHGHT = IQ(N,1)
   8618             IF(IQHGHT.LE.-1)  THEN
   8619                IQHGHT = 2
   8620             ELSE  IF(IQHGHT.EQ.17)  THEN
   8621                IQHGHT = 15
   8622             END IF
   8623             IF(NUMVAR+1.LT.11.AND.NUMQMS.LT.9)  THEN
   8624                PRINT 900, (DAT(N,K),K=1,NUMVAR),VDAT(N)
   8625                PRINT 905, IQHGHT,(IQ(N,L),L=2,NUMQMS)
   8626             END IF
   8627             IF(N.EQ.NN.OR.N.EQ.NT)  THEN
   8628 C LEVELS WITH MISSING PRESSURE IN BETWEEN GET LINEAR AVG. OF PRESSURE,
   8629 C  HEIGHT, AND TEMPERATURE OF SPANNING LVLS
   8630                DAT(N,1) = 0.5 * (DAT(NN,1) + DAT(NT,1))
   8631                DAT(N,2) = 0.5 * (DAT(NN,2) + DAT(NT,2))
   8632                DAT(N,3) = 0.5 * (DAT(NN,3) + DAT(NT,3))
   8633                VDAT(N)  = 0.5 * (VDAT(NN)  + VDAT(NT))
   8634                IQPRS1 = IQ(NN,5)
   8635                IQPRS2 = IQ(NT,5)

Page 197         Source Listing                  WNDBYZ
2017-04-18 11:09                                 prepdata.f

   8636                IQHGH1 = IQ(NN,1)
   8637                IQHGH2 = IQ(NT,1)
   8638                IF(IQHGH1.LE.-1)  THEN
   8639                   IQHGH1 = 2
   8640                ELSE  IF(IQHGH1.EQ.17)  THEN
   8641                   IQHGH1 = 15
   8642                END IF
   8643                IF(IQHGH2.LE.-1)  THEN
   8644                   IQHGH2 = 2
   8645                ELSE  IF(IQHGH2.EQ.17)  THEN
   8646                   IQHGH2 = 15
   8647                END IF
   8648                IQTMP1 = IQ(NN,2)
   8649                IQTMP2 = IQ(NT,2)
   8650                IF(IQTMP1.EQ.-1)  IQTMP1 =  2
   8651                IF(IQTMP2.EQ.-1)  IQTMP2 =  2
   8652                IF(IQTMP1.EQ.17)  IQTMP1 = 15
   8653                IF(IQTMP2.EQ.17)  IQTMP2 = 15
   8654                IF(IQTMP1.EQ.-12.OR.IQTMP1.EQ.-14)  IQTMP1 = -IQTMP1
   8655                IF(IQTMP2.EQ.-12.OR.IQTMP2.EQ.-14)  IQTMP2 = -IQTMP2
   8656                IQ(N,1) = MAX(IQHGH1,IQHGH2)
   8657                IF(IQ(N,1).LT.16.AND.IQ(N,1).GT.3)  THEN
   8658                   IQ(N,1) = 15
   8659                ELSE  IF(IQ(N,1).LT.3)  THEN
   8660                   IQ(N,1) =  2
   8661                END IF
   8662                IQ(N,2) = MAX(IQTMP1,IQTMP2)
   8663                IF(IQ(N,2).LT.16.AND.IQ(N,2).GT.3)  THEN
   8664                   IQ(N,2) = 15
   8665                ELSE  IF(IQ(N,2).LT.3)  THEN
   8666                   IQ(N,2) =  2
   8667                END IF
   8668                IF(IQPRS1.EQ.15.OR.IQPRS2.EQ.15)  THEN
   8669                   IQ(N,1) =  MAX(15,IQ(N,1))
   8670                   IQ(N,2) =  MAX(15,IQ(N,2))
   8671                END IF
   8672 
   8673                DO K = 1,5
   8674                   IF(K.EQ.4)  CYCLE
   8675 C EVENT#101 - HEIGHT CREATED FROM AVERAGING OF REPORTED DATA
   8676 C EVENT#101 - TEMPERATURE CREATED FROM AVERAGING OF REPORTED DATA
   8677 C EVENT#101 - MOISTURE CREATED FROM AVERAGING OF REPORTED DATA
   8678 C EVENT#101 - PRESSURE CREATED FROM AVERAGING OF REPORTED DATA
   8679                   IR(N,K) = 101
   8680                ENDDO
   8681 
   8682                IF(NUMVAR+1.LT.11.AND.NUMQMS.LT.9)  THEN
   8683                   PRINT 900, (DAT(N,K),K=1,NUMVAR),VDAT(N)
   8684                   PRINT 905, (IQ(N,L),L=1,NUMQMS)
   8685                END IF
   8686             END IF
   8687          ENDDO
   8688          GO TO 39
   8689  7612 CONTINUE
   8690 C-----------------------------------------------------------------------
   8691       ALNP3 = 0.5 * (ALNPB + ALNPT)
   8692       A = G * (ZHI - ZLO)/DLNP

Page 198         Source Listing                  WNDBYZ
2017-04-18 11:09                                 prepdata.f

   8693       BB = R * (TLO - THI)/DLNP
   8694       B = R * (VTLO - VTHI)/DLNP
   8695 C IF HGHT & TEMP OF SPANNING LVLS ARE SAME, TREAT LIKE DUPL SPAN. PRESS.
   8696       IF(A.EQ.0.0.AND.B.EQ.0.0)  GO TO 898
   8697       PHI3 = (G * 0.5 * (ZLO + ZHI)) + (0.125 * B * DLNP * DLNP)
   8698       NN = NT - LCNT - 1
   8699 C-----------------------------------------------------------------------
   8700 C       LOOP THROUGH ALL IN BETWEEN LEVELS W/ MISSING PRESSURE
   8701 C-----------------------------------------------------------------------
   8702       DO L = 1,LCNT
   8703 C NN NOW IN BETWEEN MSG-PRESS. LVL; NT STILL NEXT SPANNING P-LVL ABOVE
   8704          NN = NN + 1
   8705          ZZ = DAT(NN,2)
   8706          RADICL = (A * A) - (2. * B * ((G * ZZ) - PHI3))
   8707          DENOM = (A + SQRT(RADICL))
   8708          IF(RADICL.GE.0.0.AND.DENOM.NE.0.0)  GO TO 7613
   8709 C+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
   8710 C PROBLEM: RADICL.LT.0 OR DENOM.= 0 - CAN'T CALC. PRESS OR TEMP
   8711             PRINT 951, STNID,RDATA(1),RDATA(2),IDATA(9),NN
   8712   951 FORMAT(' > > CATEGORY 4 LVL TOSSED-ID=',A8,', LAT=',F7.2,'N, ',
   8713      $ 'LON=',F8.2,'E, RTYP',I4,' - PRESS, TEMP CANNOT BE CALC. ON ',
   8714      $ 'LEVEL',I4)
   8715             PRINT 106, RADICL,A,B,ZZ,DENOM
   8716   106       FORMAT(5X,'RADICL = ',G12.5,'; A = ',G12.5,'; B = ',G12.5,
   8717      $       '; HGHT(M) = ',F8.1,'; DENOM = ',G12.5)
   8718   110       CONTINUE
   8719       PRINT 107,PPHI,ZHI,VTHI,IZQHI,ITQHI,PLO,ZLO,VTLO,IZQLO,ITQLO
   8720   107 FORMAT(10X,'UPPER SPANNING LEVEL: PRES =',F8.2,'; HGHT(M) =',F9.1,
   8721      $ '; V. TEMP(K) = ',F6.2,'; HGHT T.V. = ',I2,'; TEMP T.V. = ',
   8722      $ I2/10X,'LOWER SPANNING LEVEL: PRES = ',F7.2,'; HGHT(M) = ',F8.1,
   8723      $ '; V. TEMP(K) = ',F6.2,'; HGHT T.V. = ',I2,'; TEMP T.V. = ',I2/)
   8724 C INTERP. NOT POSSIBLE, SO SET IN BETWEEN PRESS. TO 0 (SO LATER SKIPPED)
   8725             DAT(NN,1) = 0.0
   8726             CYCLE
   8727  7613    CONTINUE
   8728 C+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
   8729          ALNPS = ALNP3 - (2. * (G * ZZ - PHI3)/DENOM)
   8730          IF(ALNPS.GT.ALNPB.OR.ALNPS.LT.ALNPT)  THEN
   8731 C+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
   8732 C PROBLEM: RESULT OUTSIDE RANGE OF TOP & BOTTOM SPANNING P-LVLS
   8733             PRINT 951, STNID,RDATA(1),RDATA(2),IDATA(9),NN
   8734             PRINT 109, ALNPS,ALNPB,ALNPT,ZZ
   8735   109      FORMAT(5X,'ALNPS = ',G12.5,'; ALNPB = ',G12.5,'; ALNPT = ',
   8736      $       G12.5,'; HGHT(M) = ',F8.1)
   8737             GO TO 110
   8738          END IF
   8739 C+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
   8740 C CALCULATE PRESSURE VALUE ON THE IN BETWEEN MSG-PRESS. LEVEL
   8741          PP = EXP(ALNPS)
   8742 C CALCULATE TEMPERATURE VALUE ON THE IN BETWEEN MSG-PRESS. LEVEL
   8743          TT = TLO - ((ALNPB-ALNPS) * BB/R)
   8744          VTT = VTLO - ((ALNPB-ALNPS) * B/R)
   8745 C CALC. TEMP PREPBUFR T V (HIGHER OF 2 SPAN LVL TEMP PREPBUFR TBL VALS.)
   8746          ITQ = MAX(ITQLO,ITQHI)
   8747          IF(ITQ.LT.16.AND.ITQ.GT.3)  THEN
   8748             ITQ = 15
   8749          ELSE  IF(ITQ.LT.3)  THEN

Page 199         Source Listing                  WNDBYZ
2017-04-18 11:09                                 prepdata.f

   8750             ITQ =  2
   8751          END IF
   8752 C DETERMINE THE HIGHER OF THE 2 SPANNING LVL HEIGHT PREPBUFR TBL VALUES
   8753          IZQ = MAX(IZQLO,IZQHI)
   8754          IF(IZQ.LT.16.AND.IZQ.GT.3)  THEN
   8755             IZQ = 15
   8756          ELSE  IF(IZQ.LT.3)  THEN
   8757             IZQ =  2
   8758          END IF
   8759 C ASSIGN THE CALCULATED PRESSURE VALUE TO THE IN-BETWEEN LEVEL
   8760          DAT(NN,1) = PP
   8761 C IF HGHT PREPBUFR TABLE VALUE FOR EITHER SPANNING LEVEL IS 16, SET
   8762 C  INTERP. PRESS. LVL HGHT PREPBUFR TBL V. TO 15 S.T. HGHT WON'T BE USED
   8763 C  (CAN'T BE CERTAIN THAT THE INTERP. PRESS. IS ACCURATE SINCE SPANNING
   8764 C  HGHTS ARE STD. ATMOS.-WON'T WORRY ABOUT WINDS SINCE P-LVL LESS CRIT.)
   8765          IF(IZQ.EQ.16)  IQ(NN,1) = 15
   8766 C EVENT#103 -  PRESS CREATED FROM HYDROSTATIC INTEGRATION OF RPTED DATA
   8767 C  - OR IF NO VALID HEIGHT LEVELS IN THIS REPORT AND SPCIAL = FALSE -
   8768 C EVENT#116 -  PRESS CREATED FROM RPRTED HGHT VIA U.S. STD ATMOS. VALUE
   8769          IR(NN,5) = 103
   8770          IF(NPZ.EQ.0)  IR(NN,5) = 116
   8771          IF(IPQLO.EQ.15.OR.IPQHI.EQ.15)  THEN
   8772 C IF EITHER SPANNING PRESS. BAD(15), THEN SET ALL NON-MISSING VARIABLES
   8773 C  ON LEVEL TO BAD(15)
   8774             IQ(NN,1) = MAX(15,IQ(NN,1))
   8775             IQ(NN,2) = MAX(15,IQ(NN,2))
   8776             IQ(NN,4) = MAX(15,IQ(NN,4))
   8777             IQ(NN,5) = 15
   8778          END IF
   8779 C ASSIGN CALCULATED TEMP VALUE TO THE IN-BETWEEN LEVEL
   8780          DAT(NN,3) = TT
   8781          VDAT(NN) = VTT
   8782          IF(FILLT)  THEN
   8783 C IF FILLT=T, ASSIGN TEMP PREPBUFR TBL VAL. TO IN-BETWEEN LVL (PREPBUFR
   8784 C  TABLE VALUE .GE. 2)
   8785 C INTERP. TEMP TO NON-CAT. 4 LVL (NEVER?) GETS MINIMUM PREPBUFR TABLE
   8786 C  VALUE 2, WHILE INTERP. TEMP TO CAT. 4 LVL (ALWAYS?) GETS MINIMUM
   8787 C  PREPBUFR TABLE VALUE 3
   8788             IQ(NN,2) = MAX(2,ITQ)
   8789             IF(MOD(IQ(NN,3),20).EQ.4)  IQ(NN,2) = MAX(3,ITQ)
   8790 C EVENT#103 -  TEMP CREATED FROM HYDROSTATIC INTEGRATION OF RPTED DATA
   8791             IR(NN,2) = 103
   8792          ELSE
   8793 C IF FILLT=F, TEMP PREPBUFR TBL VAL. =16 (CAT. 4 LVL); RESET TEMP
   8794 C  PREPBUFR TBL VAL. TO -1 IF GOOD OR TO 17 IF BAD SO IT IS USED TO
   8795 C  CALC. PWATER (NOT USED ANYMORE TO CALC. PWATER)
   8796             IF(IQ(NN,2).EQ.16)  THEN
   8797                IF(ITQ.LE.3)  THEN
   8798                   IQ(NN,2) = -1
   8799                ELSE  IF(ITQ.EQ.12)  THEN
   8800                   IQ(NN,2) = -ITQ
   8801                ELSE  IF(ITQ.GT.3.AND.ITQ.LE.15)  THEN
   8802                   IQ(NN,2) = 17
   8803                END IF
   8804             END IF
   8805          END IF
   8806 C WIND PREPBUFR TABLE VALUE .GE. 2 (HOWEVER AN SDM KEEP FLAG IS HONORED)

Page 200         Source Listing                  WNDBYZ
2017-04-18 11:09                                 prepdata.f

   8807          IF(IQ(NN,4).GT.0)  IQ(NN,4) = MAX(2,IQ(NN,4))
   8808       ENDDO
   8809 C-----------------------------------------------------------------------
   8810       GO TO 39
   8811    33 CONTINUE
   8812 C+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
   8813 C DETAILED PRINT FOR SPECIFIED REPORT(S) -- IF ENTERED IN DATA CARDS
   8814       IF(IPRT(2).EQ.1.AND.NUMVAR+1.LT.11.AND.NUMQMS.LT.9)  THEN
   8815          PRINT 1905, STNID,NUMVAR+1
   8816  1905 FORMAT(/' WNDBYZ: ',A8,', AFTER INTERP. PRESS. TEMP TO MSG LVLS',
   8817      $ ' - VIRT. TEMP IN COLUMN',I3)
   8818          DO N = 1,KLVL
   8819             PRINT 900, (DAT(N,K),K=1,NUMVAR),VDAT(N)
   8820             PRINT 905, (IQ(N,L),L=1,NUMQMS)
   8821          ENDDO
   8822          PRINT 901
   8823       END IF
   8824 C+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
   8825 C***********************************************************************
   8826 C        CHECK FOR DUPLICATE PRESSURES ON ADJACENT LEVELS
   8827 C MAY RESULT IN TRANSFER OF WND FROM CAT. 4 DATA LVL TO CAT 1,2,5,3,
   8828 C                         SPEC. DATA LVL
   8829 C***********************************************************************
   8830       IP = NINT(DAT(1,1)*SCALE)
   8831       DO N = 2,KLVL
   8832 C NN IS LVL DIRECTLY BELOW N -- TRANSFER ALWAYS FROM N TO NN
   8833          NN = N - 1
   8834          JP = NINT(DAT(N,1)*SCALE)
   8835          IF(IP.NE.JP)  GO TO 24
   8836 C IN CASE ONE OF IQ(N,3)/IQ(NN,3) BELOW SET TO 7 FOR SPECIAL LVLS, NEED
   8837 C  TO TEST IT AS A CAT. 3 (ORIGINALLY SPECIAL LEVELS WERE SET TO CAT. 3)
   8838 C  (SAME TRUE FOR TROP LVLS SET TO CAT 5 BUT NEED TO BE TESTED AS CAT 2)
   8839          IQN3 = MOD(IQ(N,3),20)
   8840          IQNN3 = MOD(IQ(NN,3),20)
   8841          JQNN3 = IQ(NN,3)
   8842          IF(IQN3.EQ.5)  IQN3 = 2
   8843          IF(IQN3.EQ.7)  IQN3 = 3
   8844          IF(IQNN3.EQ.5) IQNN3 = 2
   8845          IF(IQNN3.EQ.7) IQNN3 = 3
   8846          IF(IQN3.LT.IQNN3)  THEN
   8847 C-----------------------------------------------------------------------
   8848 C     CASE WHERE CAT. 4 DATA LVL ON "NN", CAT 1,2,5,3, SPECIAL DATA LVL
   8849 C                                ON "N"
   8850 C  (NOTE: THIS LOGIC IS CONVOLUTED -- SOMETIME NEEDS TO BE STREAMLINED)
   8851 C-----------------------------------------------------------------------
   8852             IQN1  = IQ(N,1)
   8853             IQNN1 = IQ(NN,1)
   8854             IF(IQN1 .LE.-1.OR.IQN1 .EQ.17)  IQN1  = 16
   8855             IF(IQNN1.LE.-1.OR.IQNN1.EQ.17)  IQNN1 = 16
   8856             NFLAG = 0
   8857             MFLAG = 0
   8858             IF(IC(IQN1).LT.IC(IQNN1))  THEN
   8859 C HGHT PREPBUFR TBL VALUE FOR N BETTER THAN FOR NN (NEVER TRUE FOR SPEC.
   8860 C  LVL ON N, HGHT PREPBUFR TBL VAL=16) - TRANSFER PRESS., HGHT, CAT. NO.
   8861 C  & VERT. COORD. INDICATOR ON LEVEL N TO NN
   8862 C (IF HGT PREPBUFR TBL VAL. ON N NOT BETTER, NEVER TRANSF. TEMP)
   8863 C IF WIND IS ORIGINALLY FROM CAT. 4 LEVEL ADD 20 TO CAT. NO.

Page 201         Source Listing                  WNDBYZ
2017-04-18 11:09                                 prepdata.f

   8864                IF(DAT(N,5).GE.YMISS.OR.DAT(N,6).GE.YMISS)
   8865      $          IQ(N,3) = MOD(IQ(N,3),20) + 20
   8866                MFLAG = 1
   8867                IQ(NN,1) = IQ(N,1)
   8868                DAT(NN,1) = DAT(N,1)
   8869                IR(NN,1) = IR(N,1)
   8870                IQ(NN,3) = IQ(N,3)
   8871                IQ(NN,5) = IQ(N,5)
   8872                DAT(NN,2) = DAT(N,2)
   8873                IR(NN,5) = IR(N,5)
   8874             END IF
   8875             IQN2  = IQ(N,2)
   8876             IQNN2 = IQ(NN,2)
   8877             IF(IQN2 .EQ.-1.OR.IQN2. EQ.17)  IQN2  = 16
   8878             IF(IQNN2.EQ.-1.OR.IQNN2.EQ.17)  IQNN2 = 16
   8879             IF(IQN2 .EQ.-12.OR.IQN2 .EQ.-14)  IQN2  = -IQN2
   8880             IF(IQNN2.EQ.-12.OR.IQNN2.EQ.-14)  IQNN2 = -IQNN2
   8881             IF(IC(IQN2).LT.IC(IQNN2))  THEN
   8882 C TEMP PREPBUFR TBL VALUE FOR N BETTER THAN FOR NN (NEVER TRUE FOR SPEC.
   8883 C  LVL ON N, TEMP PREPBUFR TBL VAL=16) - TRANSFER TEMP ON LVL N TO NN  .
   8884 C  (TEMP CAN BE TRANS. REGARDLESS OF HGHT PREPBUFR TABLE VALUE, ALSO MAY
   8885 C  TRANSF. CAT. NO., VERT. COORD. IND AND PRESS. HERE)
   8886                NFLAG = 1
   8887                IQ(NN,2) = IQ(N,2)
   8888                DAT(NN,3) = DAT(N,3)
   8889                IR(NN,2) = IR(N,2)
   8890                IR(NN,3) = IR(N,3)
   8891                IF(MFLAG.EQ.0)  THEN
   8892                   IQ(NN,3) = IQ(N,3)
   8893                   IQ(NN,5) = IQ(N,5)
   8894                   DAT(NN,1) = DAT(N,1)
   8895                   IR(NN,5) = IR(N,5)
   8896                END IF
   8897             END IF
   8898        IF(MOD(IQ(N,3),20).EQ.1.AND.IC(IQ(N,4)).LE.IC(IQ(NN,4)))  THEN
   8899 C IF LVL N IS CAT. 1 & WIND PREPBUFR T.V. FOR N AT LEAST AS GOOD AS FOR
   8900 C  NN -- TRANSFER WIND ON LVL N TO LVL NN
   8901 C (NOTE: THIS MAY BE REDUNDANT TO LOGIC TESTING FOR TRANSF. OF CAT. NO.
   8902 C        1-3,5 TO LEVEL NN JUST AFTER THIS IF-THEN-ELSE BLOCK)
   8903                IQ(NN,4) = IQ(N,4)
   8904                DAT(NN,5) = DAT(N,5)
   8905                DAT(NN,6) = DAT(N,6)
   8906                IR(NN,4) = IR(N,4)
   8907             END IF
   8908 C WILL ONLY TRANSFER DWPT ON LVL N TO LVL NN WHEN NN DWPT IS MISSING
   8909 C  AND EITHER FILLM IS TRUE OR ABOVE TRANSF. OF TEMP & CAT. # OCCURRED
   8910             IF(DAT(NN,4).GE.9999..AND.(FILLM.OR.NFLAG.EQ.1))
   8911      $       DAT(NN,4) = DAT(N,4)
   8912          END IF
   8913 C-----------------------------------------------------------------------
   8914 C CASE WHERE CAT. 4 DATA LVL OR CAT 1,2,5,3, SPECIAL DATA LVL COULD BE
   8915 C                              EITHER WAY
   8916 C-----------------------------------------------------------------------
   8917          IQN4  = IC(IQ(N,4))
   8918          IQNN4 = IC(IQ(NN,4))
   8919         IF(IQN4.LT.IQNN4.OR.(IQN4.EQ.IQNN4.AND.IQ(N,3).EQ.IQ(NN,3)))THEN
   8920 C WIND PREPBUFR T VAL. FOR N BETTER THAN FOR NN - OR - WIND PREPBUFR TBL

Page 202         Source Listing                  WNDBYZ
2017-04-18 11:09                                 prepdata.f

   8921 C  VAL. FOR N SAME AS FOR NN AND CAT. NO. 1-3,5 TRANSF. FROM N TO NN --
   8922 C  TRANSFER WIND ON LVL N TO LVL NN (NEVER TRUE FOR SPEC. LVLS WHEN ON
   8923 C  "N", WIND PREPBUFR TBL VALUE = 16; ALWAYS TRUE FOR SPEC. LVLS WHEN ON
   8924 C  "NN", WIND PREPBUFR TABLE VALUE = 16)
   8925 C IF WIND IS ORIGINALLY FROM CAT. 4 LEVEL ADD 20 TO CAT. NO.
   8926           IF(MOD(IQ(N,3),20).EQ.4)  IQ(NN,3)=MOD(IQ(NN,3),20)+20
   8927             IQ(NN,4) = IQ(N,4)
   8928             DAT(NN,5) = DAT(N,5)
   8929             DAT(NN,6) = DAT(N,6)
   8930             IR(NN,4) = IR(N,4)
   8931             IF((IDATA(9).EQ.71.OR.IDATA(9).EQ.72).AND.MOD(IQ(N,3),20)
   8932      $       .EQ.4.AND.MOD(IQ(NN,3),20).EQ.7)  THEN
   8933 C IF VAD WIND OR NOAA PROFILER NETWORK WIND WITH SPEC. LVL UNDER CAT. 4,
   8934 C  TRANSF. HGHT(& ITS T.V.) AND CAT. FROM LVL N TO LVL NN (PLACES
   8935 C  CORRECT P-ALT ON LVL)
   8936                IQ(NN,1) = IQ(N,1)
   8937                DAT(NN,2) = DAT(N,2)
   8938                IR(NN,1) = IR(N,1)
   8939                IQ(NN,3) = IQ(N,3)
   8940             END IF
   8941          ELSE  IF(IQN4.GT.IQNN4.AND.IQ(N,3).EQ.IQ(NN,3))  THEN
   8942 C WIND PREPBUFR TBL VAL. FOR N WORSE THAN FOR NN AND CAT. NO.1,5 TRANSF.
   8943 C  FROM N TO NN -- IF GOOD WIND WAS ORIGINALLY ON CAT. 4 LEVEL AND
   8944 C  TRANSFERRED CAT. NO. IS NOT 5 (AND DOES NOT HAVE AN EARLIER CAT. 5
   8945 C  DUPL.) ADD 20 TO CAT. NO. IF OUTPUT IS TO GSI
   8946             IF(MOD(JQNN3,20).EQ.4.AND.MOD(IQ(NN,3),20).NE.5.AND.
   8947      $       IQ(NN,3).LT.60)  THEN
   8948                IQ(NN,3) = MOD(IQ(NN,3),20) + 20
   8949             END IF
   8950          END IF
   8951 C CULL THE DUPLICATE PRESSURE LEVEL
   8952          DAT(N,1) = 0.0
   8953    24    CONTINUE
   8954          IP = JP
   8955       ENDDO
   8956 C***********************************************************************
   8957 C+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
   8958 C DETAILED PRINT FOR SPECIFIED REPORT(S) -- IF ENTERED IN DATA CARDS
   8959       IF(IPRT(2).EQ.1.AND.NUMVAR.LT.11.AND.NUMQMS.LT.9)  THEN
   8960          PRINT 906, STNID
   8961   906 FORMAT(/' WNDBYZ: ',A8,', DUPL. LVLS ZEROED OUT, DATA TRANSF.')
   8962          DO N = 1,KLVL
   8963             PRINT 900, (DAT(N,K),K=1,NUMVAR)
   8964             PRINT 905, (IQ(N,L),L=1,NUMQMS)
   8965          ENDDO
   8966          PRINT 901
   8967       END IF
   8968 C+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
   8969 C***********************************************************************
   8970 C REMOVE DUPLICATE & MISSING PRESSURE LEVELS, AND FILL ARRAY TMP
   8971       M = 0
   8972 C EARLIER, ALL CAT. 4 LVLS BELOW THE 1ST NON-MSG (ORIG.) PRESS. LVL WERE
   8973 C  SET TO MISSING
   8974       DO N = 1,KLVL
   8975          IF(DAT(N,1).LT.0.4.OR.DAT(N,1).GE.3275.)  CYCLE
   8976          M = M + 1
   8977          TMP(M,1:NUMDAT) = DAT(N,1:NUMDAT)

Page 203         Source Listing                  WNDBYZ
2017-04-18 11:09                                 prepdata.f

   8978       ENDDO
   8979 C RESET KLVL TO NO. OF CAT 1,2,3,4,5,+ SPECIAL LEVELS (W/O DUPLICATES)
   8980       KLVL = M
   8981       KS = 0
   8982 C ARRANGE LEVELS IN ORDER OF DECREASING PRESSURE (FIRST ORDER SORT KEY,
   8983 C  SECOND ORDER SORT KEY IS HEIGHT)
   8984 C .. MUST SWITCH ORDER OF ELEMENTS IN TMP ARRAY - CALL IT TMPINV
   8985       DO  J=1,NUMDAT
   8986          TMPINV(J,1:KLVL) = TMP(1:KLVL,J)
   8987       END DO
   8988       CALL ORDERS( 2,IWORK,TMPINV(2,1),KS,KLVL,NUMDAT,LWR,2)
   8989       CALL ORDERS(12,IWORK,TMPINV(1,1),KS,KLVL,NUMDAT,LWR,2)
   8990 C .. DAT ARRAY LIKE TMPINV ARRAY, BUT P-LVLS ARRANGED PROPERLY, ALSO
   8991 C    ORDER OF ELEMENTS SWITCHED BACK
   8992       DO N = 1,KLVL
   8993          L = KS(KLVL-N+1)
   8994          DAT(N,1:NUMDAT) = TMPINV(1:NUMDAT,L)
   8995       ENDDO
   8996       TMP = DAT
   8997   900 FORMAT(1X,10F10.2)
   8998   905 FORMAT('+',102X,8I3)
   8999   901 FORMAT('0',//)
   9000 C+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
   9001 C DETAILED PRINT FOR SPECIFIED REPORT(S) -- IF ENTERED IN DATA CARDS
   9002       IF(IPRT(2).EQ.1.AND.NUMVAR.LT.11.AND.NUMQMS.LT.9)  THEN
   9003          PRINT 907, STNID
   9004   907 FORMAT(/' WNDBYZ: ',A8,', DUPL. & MSG PRESSURE LEVELS REMOVED; ',
   9005      $ 'RESORTED BY PRESSURE')
   9006          DO N = 1,KLVL
   9007             PRINT 900, (TMP(N,K),K=1,NUMVAR)
   9008             PRINT 905, (JQ(N,L),L=1,NUMQMS)
   9009          ENDDO
   9010          PRINT 901
   9011       END IF
   9012 C+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
   9013 C***********************************************************************
   9014       RETURN
   9015       END

Page 204         Source Listing                  WNDBYZ
2017-04-18 11:09 Entry Points                    prepdata.f



ENTRY POINTS

  Name               
                     
 wndbyz_             


SYMBOL CROSS REFERENCE

 Name                       Object Declared Type            Bytes Dimen Elements Attributes       References                        
                                                                                                                                    
 106                        Label  8716                                                           8715                              
 107                        Label  8720                                                           8719                              
 109                        Label  8735                                                           8734                              
 110                        Label  8718                                                           8737                              
 1905                       Label  8816                                                           8815                              
 24                         Label  8953                                                           8835                              
 33                         Label  8811                                                           8514,8541,8575                    
 39                         Label  8515                                                           8498,8543,8688,8810               
 41                         Label  8544                                                           8577                              
 7612                       Label  8689                                                           8606                              
 7613                       Label  8727                                                           8708                              
 898                        Label  8609                                                           8696                              
 899                        Label  8612                                                           8611                              
 900                        Label  8997                                                           8358,8486,8624,8683,8819,8963,9007
 901                        Label  8999                                                           8481,8489,8822,8966,9010          
 903                        Label  8345                                                           8344                              
 904                        Label  8483                                                           8482                              
 905                        Label  8998                                                           8359,8487,8625,8684,8820,8964,9008
 906                        Label  8961                                                           8960                              
 907                        Label  9004                                                           9003                              
 951                        Label  8712                                                           8711,8733                         
 A                          Local  8692     R(4)            4           scalar                    8692,8696,8706,8707,8715          
 ADP                        Common 8301                                 14100                                                       
 ALAT_8                     Scalar 8299     R(8)            8           scalar   COM                                                
 ALNP3                      Local  8691     R(4)            4           scalar                    8691,8729                         
 ALNPB                      Local  8603     R(4)            4           scalar                    8603,8605,8691,8730,8734,8743,8744
 ALNPS                      Local  8729     R(4)            4           scalar                    8729,8730,8734,8741,8743,8744     
 ALNPT                      Local  8604     R(4)            4           scalar                    8604,8605,8691,8730,8734          
 ALOG                       Func   8603                                 scalar                    8603,8604                         
 ALON_8                     Scalar 8299     R(8)            8           scalar   COM                                                
 B                          Local  8694     R(4)            4           scalar                    8694,8696,8697,8706,8715,8744     
 BB                         Local  8693     R(4)            4           scalar                    8693,8743                         
 CWINDO                     Scalar 8305     R(4)            4           scalar   COM                                                
 DAT                        Scalar 8303     R(4)            4     2     9600     COM              8326,8327,8354,8358,8368,8371,8400
                                                                                                  ,8404,8408,8424,8431,8443,8444,844
                                                                                                  9,8450,8472,8473,8486,8498,8499,85
                                                                                                  06,8511,8517,8518,8519,8543,8551,8
                                                                                                  560,8561,8563,8567,8568,8577,8579,
                                                                                                  8580,8581,8624,8630,8631,8632,8683
                                                                                                  ,8705,8725,8760,8780,8819,8830,883
                                                                                                  4,8864,8868,8872,8888,8894,8904,89
                                                                                                  05,8910,8911,8928,8929,8937,8952,8
                                                                                                  963,8975,8977,8994,8996           
 DENOM                      Local  8707     R(4)            4           scalar                    8707,8708,8715,8729               

Page 205         Source Listing                  WNDBYZ
2017-04-18 11:09 Symbol Table                    prepdata.f

 Name                       Object Declared Type            Bytes Dimen Elements Attributes       References                        
                                                                                                                                    
 DLNP                       Local  8605     R(4)            4           scalar                    8605,8606,8692,8693,8694,8697     
 EXP                        Func   8314                                 scalar                    8314,8741                         
 FILLM                      Scalar 8296     L(4)            4           scalar   COM              8449,8910                         
 FILLT                      Scalar 8296     L(4)            4           scalar   COM              8782                              
 FILLW                      Scalar 8305     R(4)            4           scalar   COM                                                
 FILLZ                      Scalar 8305     R(4)            4           scalar   COM                                                
 G                          Local  8317     R(4)            4           scalar                    8317,8692,8697,8706,8729          
 HDR                        Scalar 8302     R(4)            4     1     14       COM                                                
 I                          Local  8350     I(4)            4           scalar                    8350,8351                         
 IC                         Local  8298     I(4)            4     1     17                        8311,8394,8417,8435,8456,8457,8858
                                                                                                  ,8881,8898,8917,8918              
 IDATA                      Scalar 8294     I(4)            4     1     3500     COM              8611,8711,8733,8931               
 IP                         Local  8830     I(4)            4           scalar                    8830,8835,8954                    
 IPQHI                      Local  8583     I(4)            4           scalar                    8583,8771                         
 IPQLO                      Local  8521     I(4)            4           scalar                    8521,8771                         
 IPRINT                     Scalar 8301     I(4)            4           scalar   COM                                                
 IPRT                       Dummy  8287     I(4)            4     1     2        ARG,INOUT        8343,8357,8480,8814,8959,9002     
 IQ                         Scalar 8293     I(4)            4     2     3000     COM              8359,8376,8377,8388,8389,8401,8403
                                                                                                  ,8406,8407,8411,8412,8423,8429,843
                                                                                                  0,8435,8442,8456,8457,8458,8465,84
                                                                                                  66,8469,8470,8487,8521,8524,8530,8
                                                                                                  532,8583,8586,8592,8594,8617,8625,
                                                                                                  8634,8635,8636,8637,8648,8649,8656
                                                                                                  ,8657,8658,8659,8660,8662,8663,866
                                                                                                  4,8665,8666,8669,8670,8684,8765,87
                                                                                                  74,8775,8776,8777,8788,8789,8796,8
                                                                                                  798,8800,8802,8807,8820,8839,8840,
                                                                                                  8841,8852,8853,8865,8867,8870,8871
                                                                                                  ,8875,8876,8887,8892,8893,8898,890
                                                                                                  3,8917,8918,8919,8926,8927,8931,89
                                                                                                  32,8936,8939,8941,8946,8947,8948,8
                                                                                                  964                               
 IQHGH1                     Local  8636     I(4)            4           scalar                    8636,8638,8639,8640,8641,8656     
 IQHGH2                     Local  8637     I(4)            4           scalar                    8637,8643,8644,8645,8646,8656     
 IQHGHT                     Local  8617     I(4)            4           scalar                    8617,8618,8619,8620,8621,8625     
 IQN1                       Local  8388     I(4)            4           scalar                    8388,8390,8394,8852,8854,8858     
 IQN2                       Local  8411     I(4)            4           scalar                    8411,8413,8415,8417,8875,8877,8879
                                                                                                  ,8881                             
 IQN3                       Local  8376     I(4)            4           scalar                    8376,8378,8379,8382,8839,8842,8843
                                                                                                  ,8846                             
 IQN4                       Local  8456     I(4)            4           scalar                    8456,8458,8917,8919,8941          
 IQNM1                      Local  8389     I(4)            4           scalar                    8389,8391,8394                    
 IQNM2                      Local  8412     I(4)            4           scalar                    8412,8414,8416,8417               
 IQNM3                      Local  8377     I(4)            4           scalar                    8377,8380,8381,8382               
 IQNM4                      Local  8457     I(4)            4           scalar                    8457,8458                         
 IQNN1                      Local  8853     I(4)            4           scalar                    8853,8855,8858                    
 IQNN2                      Local  8876     I(4)            4           scalar                    8876,8878,8880,8881               
 IQNN3                      Local  8840     I(4)            4           scalar                    8840,8844,8845,8846               
 IQNN4                      Local  8918     I(4)            4           scalar                    8918,8919,8941                    
 IQPRS1                     Local  8634     I(4)            4           scalar                    8634,8668                         
 IQPRS2                     Local  8635     I(4)            4           scalar                    8635,8668                         
 IQTMP1                     Local  8648     I(4)            4           scalar                    8648,8650,8652,8654,8662          
 IQTMP2                     Local  8649     I(4)            4           scalar                    8649,8651,8653,8655,8662          
 IR                         Scalar 8295     I(4)            4     2     3000     COM              8405,8409,8425,8426,8432,8445,8471
                                                                                                  ,8508,8570,8679,8769,8770,8791,886

Page 206         Source Listing                  WNDBYZ
2017-04-18 11:09 Symbol Table                    prepdata.f

 Name                       Object Declared Type            Bytes Dimen Elements Attributes       References                        
                                                                                                                                    
                                                                                                  9,8873,8889,8890,8895,8906,8930,89
                                                                                                  38                                
 ISATOB                     Scalar 8301     I(4)            4           scalar   COM                                                
 ISQNUM_UPA                 Scalar 8304     I(4)            4           scalar   COM                                                
 ITQ                        Local  8746     I(4)            4           scalar                    8746,8747,8748,8749,8750,8788,8789
                                                                                                  ,8797,8799,8800,8801              
 ITQHI                      Local  8592     I(4)            4           scalar                    8592,8594,8595,8596,8597,8598,8599
                                                                                                  ,8600,8719,8746                   
 ITQLO                      Local  8530     I(4)            4           scalar                    8530,8532,8533,8534,8535,8536,8537
                                                                                                  ,8538,8719,8746                   
 IWORK                      Local  8295     I(4)            4     1     600                       8338,8339,8988,8989               
 IZ                         Local  8368     I(4)            4           scalar                    8368,8372                         
 IZQ                        Local  8753     I(4)            4           scalar                    8753,8754,8755,8756,8757,8765     
 IZQHI                      Local  8586     I(4)            4           scalar                    8586,8587,8588,8589,8590,8719,8753
 IZQLO                      Local  8524     I(4)            4           scalar                    8524,8525,8526,8527,8528,8719,8753
 J                          Local  8335     I(4)            4           scalar                    8335,8336,8359,8985,8986          
 JP                         Local  8834     I(4)            4           scalar                    8834,8835,8954                    
 JQ                         Dummy  8287     I(4)            4     2     3000     ARG,INOUT        9008                              
 JQNN3                      Local  8841     I(4)            4           scalar                    8841,8946                         
 JZ                         Local  8371     I(4)            4           scalar                    8371,8372                         
 K                          Local  8358     I(4)            4           scalar                    8358,8486,8624,8673,8674,8679,8683
                                                                                                  ,8819,8963,9007                   
 KLVL                       Dummy  8287     I(4)            4           scalar   ARG,INOUT        8321,8325,8330,8336,8338,8339,8350
                                                                                                  ,8477,8485,8496,8541,8548,8818,883
                                                                                                  1,8962,8974,8980,8986,8988,8989,89
                                                                                                  92,8993,9006                      
 KS                         Local  8293     I(4)            4     1     600                       8331,8338,8339,8351,8981,8988,8989
                                                                                                  ,8993                             
 L                          Local  8351     I(4)            4           scalar                    8351,8353,8354,8487,8557,8625,8684
                                                                                                  ,8702,8820,8964,8993,8994,9008    
 LCNT                       Local  8542     I(4)            4           scalar                    8542,8546,8550,8557,8610,8698,8702
 LEVPM                      Scalar 8304     I(4)            4           scalar   COM                                                
 LEVQQ                      Scalar 8304     I(4)            4           scalar   COM                                                
 LEVST                      Scalar 8304     I(4)            4           scalar   COM                                                
 LSMASS                     Scalar 8305     I(4)            4           scalar   COM                                                
 LSWIND                     Scalar 8305     I(4)            4           scalar   COM                                                
 LWI                        Scalar 8300     I(4)            4           scalar   COM                                                
 LWR                        Scalar 8300     I(4)            4           scalar   COM              8338,8339,8988,8989               
 M                          Local  8971     I(4)            4           scalar                    8971,8976,8977,8980               
 MAX                        Func   8470                                 scalar                    8470,8532,8594,8656,8662,8669,8670
                                                                                                  ,8746,8753,8774,8775,8776,8788,878
                                                                                                  9,8807                            
 MAXOBS                     Param  8292     I(4)            4           scalar                    8294,8301                         
 MFLAG                      Local  8393     I(4)            4           scalar                    8393,8402,8428,8436,8857,8866,8891
 MH                         Local  8320     I(4)            4           scalar                    8320,8324                         
 MM                         Local  8324     I(4)            4           scalar                    8324,8326,8327                    
 MOD                        Func   8376                                 scalar                    8376,8377,8401,8435,8465,8469,8789
                                                                                                  ,8839,8840,8865,8898,8926,8931,893
                                                                                                  2,8946,8948                       
 MXLVL                      Param  8289     I(4)            4           scalar                    8293,8294,8295,8303               
 MXWRDH                     Param  8288     I(4)            4           scalar                    8302                              
 N                          Local  8323     I(4)            4           scalar                    8323,8324,8325,8340,8352,8353,8354
                                                                                                  ,8358,8359,8362,8368,8370,8376,838
                                                                                                  8,8400,8401,8403,8404,8405,8406,84
                                                                                                  07,8408,8409,8411,8423,8424,8425,8

Page 207         Source Listing                  WNDBYZ
2017-04-18 11:09 Symbol Table                    prepdata.f

 Name                       Object Declared Type            Bytes Dimen Elements Attributes       References                        
                                                                                                                                    
                                                                                                  426,8427,8429,8430,8431,8432,8435,
                                                                                                  8442,8443,8444,8445,8450,8456,8458
                                                                                                  ,8465,8466,8469,8471,8472,8473,847
                                                                                                  5,8477,8485,8486,8487,8496,8497,84
                                                                                                  98,8499,8506,8508,8511,8614,8617,8
                                                                                                  624,8625,8627,8630,8631,8632,8633,
                                                                                                  8656,8657,8658,8659,8660,8662,8663
                                                                                                  ,8664,8665,8666,8669,8670,8679,868
                                                                                                  3,8684,8818,8819,8820,8831,8833,88
                                                                                                  34,8839,8852,8864,8865,8867,8868,8
                                                                                                  869,8870,8871,8872,8873,8875,8887,
                                                                                                  8888,8889,8890,8892,8893,8894,8895
                                                                                                  ,8898,8903,8904,8905,8906,8911,891
                                                                                                  7,8919,8926,8927,8928,8929,8930,89
                                                                                                  31,8936,8937,8938,8939,8941,8952,8
                                                                                                  962,8963,8964,8974,8975,8977,8992,
                                                                                                  8993,8994,9006,9007,9008          
 NFLAG                      Local  8392     I(4)            4           scalar                    8392,8422,8436,8449,8856,8886,8910
 NH                         Dummy  8287     I(4)            4           scalar   ARG,INOUT        8323                              
 NINT                       Func   8368                                 scalar                    8368,8371,8566,8830,8834          
 NM                         Dummy  8287     I(4)            4           scalar   ARG,INOUT        8320,8370,8371,8377,8389,8403,8404
                                                                                                  ,8405,8406,8407,8408,8409,8412,842
                                                                                                  3,8424,8425,8426,8427,8429,8430,84
                                                                                                  31,8432,8435,8442,8443,8444,8445,8
                                                                                                  449,8450,8457,8458,8465,8466,8469,
                                                                                                  8470,8471,8472,8473               
 NN                         Local  8321     I(4)            4           scalar                    8321,8325,8326,8327,8330,8550,8551
                                                                                                  ,8558,8560,8561,8563,8567,8568,857
                                                                                                  0,8610,8611,8614,8627,8630,8631,86
                                                                                                  32,8633,8634,8636,8648,8698,8704,8
                                                                                                  705,8711,8725,8733,8760,8765,8769,
                                                                                                  8770,8774,8775,8776,8777,8780,8781
                                                                                                  ,8788,8789,8791,8796,8798,8800,880
                                                                                                  2,8807,8833,8840,8841,8853,8867,88
                                                                                                  68,8869,8870,8871,8872,8873,8876,8
                                                                                                  887,8888,8889,8890,8892,8893,8894,
                                                                                                  8895,8898,8903,8904,8905,8906,8910
                                                                                                  ,8911,8918,8919,8926,8927,8928,892
                                                                                                  9,8930,8932,8936,8937,8938,8939,89
                                                                                                  41,8946,8947,8948                 
 NP                         Dummy  8287     I(4)            4           scalar   ARG,INOUT        8320                              
 NPZ                        Scalar 8305     I(4)            4           scalar   COM              8499,8770                         
 NS                         Dummy  8287     I(4)            4           scalar   ARG,INOUT        8320                              
 NT                         Local  8497     I(4)            4           scalar                    8497,8517,8518,8519,8520,8521,8524
                                                                                                  ,8530,8532,8540,8541,8543,8547,854
                                                                                                  8,8550,8577,8579,8580,8581,8582,85
                                                                                                  83,8586,8592,8594,8610,8611,8614,8
                                                                                                  627,8630,8631,8632,8633,8635,8637,
                                                                                                  8649,8698                         
 NUMDAT                     Param  8291     I(4)            4           scalar                    8293,8295,8303,8327,8335,8338,8339
                                                                                                  ,8354,8977,8985,8988,8989,8994    
 NUMQMS                     Param  8290     I(4)            4           scalar                    8291,8293,8294,8295,8307,8343,8357
                                                                                                  ,8359,8480,8487,8623,8625,8682,868
                                                                                                  4,8814,8820,8959,8964,9002,9008   
 NUMVAR                     Param  8290     I(4)            4           scalar                    8291,8306,8307,8343,8344,8357,8358

Page 208         Source Listing                  WNDBYZ
2017-04-18 11:09 Symbol Table                    prepdata.f

 Name                       Object Declared Type            Bytes Dimen Elements Attributes       References                        
                                                                                                                                    
                                                                                                  ,8480,8482,8486,8623,8624,8682,868
                                                                                                  3,8814,8815,8819,8959,8963,9002,90
                                                                                                  07                                
 ORDERS                     Subr   8338                                                           8338,8339,8988,8989               
 PARM5                      Common 8305                                 32                                                          
 PHI3                       Local  8697     R(4)            4           scalar                    8697,8706,8729                    
 PLO                        Local  8517     R(4)            4           scalar                    8517,8603,8719                    
 PMAND                      Scalar 8301     R(4)            4     1     23       COM                                                
 PP                         Local  8561     R(4)            4           scalar                    8561,8563,8566,8567,8741,8760     
 PPHI                       Local  8579     R(4)            4           scalar                    8579,8604,8719                    
 PPREF                      Local  8551     R(4)            4           scalar                    8551,8566,8568                    
 PRS                        Local  8314     R(4)            4           scalar                    8563                              
 R                          Local  8318     R(4)            4           scalar                    8318,8693,8694,8743,8744          
 RADICL                     Local  8706     R(4)            4           scalar                    8706,8707,8708,8715               
 RDATA                      Scalar 8301     R(4)            4     1     3500     COM              8611,8711,8733                    
 RPTHDR                     Common 8302                                 88                                                          
 SCALE                      Local  8315     R(4)            4           scalar                    8315,8830,8834                    
 SCALE0                     Local  8316     R(4)            4           scalar                    8316,8368,8371                    
 SNDATA                     Common 8303                                 38400                                                       
 SPCIAL                     Scalar 8296     L(4)            4           scalar   COM              8549                              
 SQRT                       Func   8707                                 scalar                    8707                              
 STNID                      Scalar 8297     CHAR            8           scalar   COM              8344,8482,8611,8711,8733,8815,8960
                                                                                                  ,9003                             
 SUBSET_D                   Scalar 8297     CHAR            8           scalar   COM                                                
 TDLIM                      Scalar 8304     R(4)            4           scalar   COM                                                
 TDMAX                      Scalar 8304     R(4)            4           scalar   COM                                                
 THETA                      Local  8506     R(4)            4           scalar                    8506,8561                         
 THI                        Local  8581     R(4)            4           scalar                    8581,8693                         
 TLO                        Local  8519     R(4)            4           scalar                    8519,8693,8743                    
 TMP                        Dummy  8287     R(4)            4     2     9600     ARG,INOUT        8327,8336,8977,8986,8996,9007     
 TMPINV                     Local  8295     R(4)            4     2     9600                      8336,8338,8339,8354,8986,8988,8989
                                                                                                  ,8994                             
 TMPR                       Local  8506     R(4)            4           scalar                    8506,8561                         
 TT                         Local  8743     R(4)            4           scalar                    8743,8780                         
 UPALIM                     Common 8304                                 28                                                          
 VDAT                       Local  8294     R(4)            4     1     600                       8353,8358,8427,8486,8520,8582,8624
                                                                                                  ,8633,8683,8781,8819              
 VTHI                       Local  8582     R(4)            4           scalar                    8582,8694,8719                    
 VTLO                       Local  8520     R(4)            4           scalar                    8520,8694,8719,8744               
 VTMP                       Dummy  8287     R(4)            4     1     600      ARG,INOUT        8326,8353                         
 VTT                        Local  8744     R(4)            4           scalar                    8744,8781                         
 W3FA04                     Subr   8506                                                           8506,8561                         
 WNDBYZ                     Subr   8287                                                                                             
 WORD                       Common 8300                                 8                                                           
 YMISS                      Local  8312     R(4)            4           scalar                    8312,8400,8864                    
 ZHI                        Local  8580     R(4)            4           scalar                    8580,8692,8697,8719               
 ZLO                        Local  8518     R(4)            4           scalar                    8518,8692,8697,8719               
 ZZ                         Local  8705     R(4)            4           scalar                    8705,8706,8715,8729,8734          

Page 209         Source Listing                  WNDBYZ
2017-04-18 11:09                                 prepdata.f

   9016 C$$$  SUBPROGRAM DOCUMENTATION BLOCK
   9017 C
   9018 C SUBPROGRAM:    FILWND
   9019 C   PRGMMR: D. A. KEYSER     ORG: NP22       DATE: 2000-02-17
   9020 C
   9021 C ABSTRACT: FILLS IN MISSING WIND INFORMATION IN THE RAOB PROFILE BY
   9022 C   INTERPOLATING BETWEEN BRACKETING LEVELS WITH QUALITY WIND DATA.
   9023 C
   9024 C PROGRAM HISTORY LOG:
   9025 C   UNKNOWN
   9026 C 1988-04-11  D. A. KEYSER -- DOCBLOCKING/COMMENTING; IF > 100 MB
   9027 C     BETWEEN BRACKETING P-LVLS SET WINDS MSG (WAS > 600 MB)
   9028 C 1989-04-24  D. A. KEYSER -- CHECKS 'FAILBL', IF TRUE WILL NOT USE
   9029 C     CAT. 4 WIND BELOW TOP SPANNNING PRESSURE FOR PSTN AS A BRACKETING
   9030 C     LVL FOR WIND
   9031 C 1990-01-11  D. A. KEYSER -- CONVERTED TO VS FORTRAN(77) & RESTRUCTURED
   9032 C 1991-01-23  D. A. KEYSER -- SPLIT OLD SUBR. 'FILLIN' INTO SEPARATE
   9033 C     WIND AND DEWPOINT INTERPOLATING SUBROUTINES
   9034 C 1993-05-12  D. A. KEYSER -- THE NEW "PREPBUFR TABLE VALUES" WHICH CAN
   9035 C     RANGE FROM 0-15 ARE EMPLOYED RATHER THAN THE OLD OI/SSI QUALITY
   9036 C     MARKERS
   9037 C 1995-07-12  D. A. KEYSER -- IF SPANNING LVL PRESS. Q.M. IS BAD INTERP.
   9038 C     WIND Q.M. SET TO BAD, IF INTERP. LVL PRESS. Q.M. IS BAD INTERP.
   9039 C     WIND Q.M. SET TO BAD
   9040 C 1996-03-04  D. A. KEYSER -- FOR RGL-BUFR OUTPUT: MORE FIXES TO MAKE
   9041 C     BUFR-PREPDA FILE CONTAIN DATA EXPECTED BY FERR PGM & OI-ANAL
   9042 C     (INTERP. DATA Q.M. CALC. SAME AS FOR OLD "PREPDA" FORM)
   9043 C 1997-05-01  D. A. KEYSER -- EST. REASON CODES FOR UPPER-AIR DATA
   9044 C     TYPES (CURRENTLY JUST 100, 101-103, 105 TO IDENTIFY INTERPOLATED
   9045 C     DATA FOR CQCBUFR PGM)
   9046 C 2000-02-17  D. A. KEYSER -- NOW CALLED FOR RAOBS AND PIBALS EVEN
   9047 C     WHEN FILLW=F TO GET INTERP. WIND LEVELS FOR BALLOON DRIFT LAT/LON
   9048 C     CALC. (DISCARDS THEM PRIOR TO WRITE TO PREPBUFR FILE WHEN FILLW=
   9049 C     F), USES DEL-PRESSURE LIMIT OF 150 MB WHEN FILLW=F (VS. 100 MB
   9050 C     LIMIT WHEN FILLW=T) AND ALLOWS SPANNING WINDS TO BE BAD WHEN
   9051 C     FILLW=F (VS. RESTR. OF NON-BAD SPANNING WINDS WHEN FILLW=T)
   9052 C
   9053 C USAGE:    CALL FILWND(KLVL,TMP,JQ,JR,IPRT)
   9054 C   INPUT ARGUMENT LIST:
   9055 C     KLVL     - NO. OF COMBINED CAT. 1,2,3,4,5 AND "SPEC" 25/50 MB
   9056 C              - LEVELS WITH DUPLICATES REMOVED
   9057 C     TMP      - "MXLVL" X "NUMDAT" ARRAY HOLDING AN U-AIR REPORT'S
   9058 C              - MASS & WIND DATA IN CAT. 1,2,3,4,5 AND "SPEC" 25/50 MB
   9059 C              - LEVELS AFTER MERGING
   9060 C     JQ       - "MXLVL" X "NUMQMS" ARRAY HOLDING AN U-AIR RPT'S PREPBUFR
   9061 C              - TABLE VALUES IN CAT. 1,2,3,4,5 AND "SPECIAL" 25/50 MB
   9062 C              - LEVELS AFTER MERGING
   9063 C     JR       - "MXLVL" X "NUMQMS" ARRAY HOLDING AN U-AIR RPT'S REASON
   9064 C              - CODES IN CAT. 1,2,3,4,5 AND "SPECIAL" 25/50 MB LEVELS
   9065 C              - AFTER MERGING
   9066 C     IPRT     - 2-WORD SWITCH, DETAILED STD. O-PUT (UNIT 6) PRT OF RPT
   9067 C
   9068 C   OUTPUT ARGUMENT LIST:
   9069 C     TMP      - "MXLVL" X "NUMDAT" ARRAY HOLDING AN U-AIR REPORT'S
   9070 C              - MASS & WIND DATA IN CAT. 1,2,3,4,5 AND "SPEC" 25/50 MB
   9071 C              - LEVELS AFTER MERGING AND WIND IS FILLED IN
   9072 C     JQ       - "MXLVL" X "NUMQMS" ARRAY HOLDING AN U-AIR RPT'S PREPBUFR

Page 210         Source Listing                  WNDBYZ
2017-04-18 11:09                                 prepdata.f

   9073 C              - TABLE VALUES IN CAT. 1,2,3,4,5 AND "SPECIAL" 25/50 MB
   9074 C              - LEVELS AFTER MERGING AND WIND IS FILLED IN
   9075 C     JR       - "MXLVL" X "NUMQMS" ARRAY HOLDING AN U-AIR RPT'S REASON
   9076 C              - CODES IN CAT. 1,2,3,4,5 AND "SPECIAL" 25/50 MB LEVELS
   9077 C              - AFTER MERGING AND WIND IS FILLED IN
   9078 C
   9079 C   OUTPUT FILES:
   9080 C     UNIT 06  - STANDARD OUTPUT PRINT
   9081 C
   9082 C REMARKS: CALLED BY SUBROUTINE 'SMERGE'.
   9083 C
   9084 C ATTRIBUTES:
   9085 C   LANGUAGE: FORTRAN 90
   9086 C   MACHINE:  NCEP WCOSS
   9087 C
   9088 C$$$
   9089       SUBROUTINE FILWND(KLVL,TMP,JQ,JR,IPRT)
   9090       PARAMETER (MXWRDH = 15)
   9091       PARAMETER (MXLVL = 600)
   9092       PARAMETER (NUMVAR = 6, NUMQMS = 5)
   9093       PARAMETER (NUMDAT = NUMVAR + (2 * NUMQMS))
   9094       DIMENSION TMP(MXLVL,NUMDAT),JQ(MXLVL,NUMQMS),IPRT(2),
   9095      $ JR(MXLVL,NUMQMS)
   9096       real(8)  alon_8,alat_8
   9097       logical  fillw
   9098       CHARACTER*8  STNID,SUBSET_d
   9099       COMMON/RPTHDR/SUBSET_d,STNID,HDR(2:MXWRDH),alon_8,alat_8
   9100       COMMON/PARM5/FILLZ,FILLT,FILLW,FILLM,LSWIND,LSMASS,CWINDO,NPZ
   9101       DATA  XMISS/99999./,YMISS/99998.8/
   9102 C-----------------------------------------------------------------------
   9103 C INTERPOLATE BETWEEN BRACKETING LEVELS
   9104 C - IF FILLW=T, BRACKETING LEVEL MUST HAVE NON-BAD WIND
   9105 C - IF FILLW=F, BRACKETING LEVEL MUST HAVE NON-MISSING WIND (CAN BE BAD)
   9106 C-----------------------------------------------------------------------
   9107 C IQMLIM IS PREPBUFR TABLE VALUE LIMIT FOR ACCEPTING A BRACKETING LEVEL
   9108       IQMLIM = 3
   9109       DELPLM = 100.
   9110       IF(.NOT.FILLW)  THEN
   9111          IQMLIM = 15
   9112          DELPLM = 150.
   9113       END IF
   9114       DO N = 1,KLVL
   9115          NT = N
   9116          IF(TMP(N,1).LT.XMISS.AND.JQ(N,4).LE.IQMLIM)  GO TO 46
   9117 cfix?    IF(TMP(N,1).LT.YMISS.AND.JQ(N,4).LE.IQMLIM)  GO TO 46
   9118       ENDDO
   9119       GO TO 48
   9120    46 CONTINUE
   9121       ULO = TMP(NT,5)
   9122       VLO = TMP(NT,6)
   9123       PLO = TMP(NT,1)
   9124       QLO = JQ(NT,4)
   9125 C IF PRESSURE Q.M. IS BAD(15), THEN SET NON-MISSING WIND Q.M. AS BAD(15)
   9126       IF(JQ(NT,5).EQ.15)  QLO = MAX(15.,QLO)
   9127       NST = NT
   9128       NT = NT + 1
   9129       IF(NT.GT.KLVL)  GO TO 48

Page 211         Source Listing                  FILWND
2017-04-18 11:09                                 prepdata.f

   9130       LCNT = 0
   9131       IF(JQ(NT,4).LE.IQMLIM)  GO TO 46
   9132    49 CONTINUE
   9133       LCNT = LCNT + 1
   9134       NT = NT + 1
   9135       IF(NT.GT.KLVL)  GO TO 48
   9136       IF(JQ(NT,4).GT.IQMLIM)  GO TO 49
   9137       UHI = TMP(NT,5)
   9138       VHI = TMP(NT,6)
   9139       PPHI = TMP(NT,1)
   9140       QHI = JQ(NT,4)
   9141 C IF PRESSURE Q.M. IS BAD(15), THEN SET NON-MISSING WIND Q.M. AS BAD(15)
   9142       IF(JQ(NT,5).EQ.15)  QHI = MAX(15.,QHI)
   9143 C IN RARE INSTANCES (E.G., WHEN CAT. 2 HGHTS GENERATED THROUGH DEEP
   9144 C  LAYERS W/O MAND-LVL HGHTS) THE SPANNING PRESSURES HERE COULD BE EQUAL
   9145 C  OR PLO COULD BE .LT. PPHI -- IN THIS CASE DON'T INTERP. (WINDS MSG)
   9146       IF(PLO.LE.PPHI)  GO TO 46
   9147       DLNP = ALOG(PPHI/PLO)
   9148 C LIMIT FOR DELTA-PRESSURE BETWEEN BRACKETING WIND LEVELS IS SET TO
   9149 C  100 MB FOR FILLW=T AND 150 MB FOR FILLW=F - IF THIS IS EXCEEDED, OR
   9150 C  IF DEL LN(P) .GT. 0.25 DON'T INTERPOLATE (ALL WINDS IN BETWEEN STAY
   9151 C  MISSING)
   9152 C  NOTE: I don't think DLNP can ever be > 0.25 as calc. here!!
   9153       IF((PLO-PPHI).GE.DELPLM.OR.DLNP.GT.0.25)  GO TO 46
   9154       DUDLNP = (UHI - ULO)/DLNP
   9155       DVDLNP = (VHI - VLO)/DLNP
   9156       DO L = 1,LCNT
   9157          N = NST + L
   9158          PLOG = ALOG(TMP(N,1)/PLO)
   9159          UU = ULO + (DUDLNP * PLOG)
   9160          VV = VLO + (DVDLNP * PLOG)
   9161          TMP(N,5) = UU
   9162          TMP(N,6) = VV
   9163          IQQ = MAX(NINT(QLO),NINT(QHI))
   9164 C IF PRESSURE Q.M. IS BAD(15), THEN SET NON-MISSING IQQ AS BAD(15)
   9165          IF(JQ(N,5).EQ.15)  IQQ = MAX(15,IQQ)
   9166          IF(IQQ.LT.16.AND.IQQ.GT.3)  THEN
   9167             IQQ = 15
   9168          ELSE  IF(IQQ.LT.3)  THEN
   9169             IQQ =  2
   9170          END IF
   9171 C EVENT#102 - WIND CREATED FROM INTERPOLATION OF REPORTED DATA
   9172          JR(N,4) = 102
   9173          JQ(N,4) = IQQ
   9174       ENDDO
   9175       GO TO 46
   9176    48 CONTINUE
   9177       IF(.NOT.FILLW)  THEN
   9178 C FOR FILLW=F, RESET PREPBUFR TABLE VALUES FOR INTERPOLATED LEVELS AS
   9179 C  FOLLOWS: MISSING LEVELS GET 16 (NO CHANGE); BAD LEVELS GET 17;
   9180 C  KEEP LEVELS GET -1; NON-BAD LEVELS 1,2,3 GET -1,-2,-3, RESP.
   9181 C  (THIS WILL LATER BE USED TO EXCLUDE THESE LEVELS FROM PREPBUFR FILE)
   9182          DO N = 1,KLVL
   9183             IF(JR(N,4).EQ.102)  THEN
   9184                IF(JQ(N,4).GT.15)  THEN
   9185                   JQ(N,4) = 16
   9186                ELSE IF(JQ(N,4).GT.3)  THEN

Page 212         Source Listing                  FILWND
2017-04-18 11:09                                 prepdata.f

   9187                   JQ(N,4) = 17
   9188                ELSE IF(JQ(N,4).EQ.0)  THEN
   9189                   JQ(N,4) = -1
   9190                ELSE
   9191                   JQ(N,4) = -JQ(N,4)
   9192                END IF
   9193             END IF
   9194          END DO
   9195       END IF
   9196 C+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
   9197 C DETAILED PRINT FOR SPECIFIED REPORT(S) -- IF ENTERED IN DATA CARDS
   9198       IF(IPRT(2).EQ.1.AND.NUMVAR.LT.11.AND.NUMQMS.LT.9)  THEN
   9199          PRINT 903, STNID
   9200   903 FORMAT(/' FILWND: ',A8,', LVLS W/ MISSING WINDS FILLED IN')
   9201          DO N = 1,KLVL
   9202             PRINT 900, (TMP(N,K),K=1,NUMVAR)
   9203             PRINT 905, (JQ(N,L),L=1,NUMQMS)
   9204          ENDDO
   9205          PRINT 901
   9206       END IF
   9207   900 FORMAT(1X,10F10.2)
   9208   905 FORMAT('+',102X,8I3)
   9209   901 FORMAT('0',//)
   9210 C+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
   9211       RETURN
   9212       END


ENTRY POINTS

  Name               
                     
 filwnd_             

Page 213         Source Listing                  FILWND
2017-04-18 11:09 Symbol Table                    prepdata.f



SYMBOL CROSS REFERENCE

 Name                       Object Declared Type            Bytes Dimen Elements Attributes       References                        
                                                                                                                                    
 46                         Label  9120                                                           9116,9131,9146,9153,9175          
 48                         Label  9176                                                           9119,9129,9135                    
 49                         Label  9132                                                           9136                              
 900                        Label  9207                                                           9202                              
 901                        Label  9209                                                           9205                              
 903                        Label  9200                                                           9199                              
 905                        Label  9208                                                           9203                              
 ALAT_8                     Scalar 9096     R(8)            8           scalar   COM                                                
 ALOG                       Func   9147                                 scalar                    9147,9158                         
 ALON_8                     Scalar 9096     R(8)            8           scalar   COM                                                
 CWINDO                     Scalar 9100     R(4)            4           scalar   COM                                                
 DELPLM                     Local  9109     R(4)            4           scalar                    9109,9112,9153                    
 DLNP                       Local  9147     R(4)            4           scalar                    9147,9153,9154,9155               
 DUDLNP                     Local  9154     R(4)            4           scalar                    9154,9159                         
 DVDLNP                     Local  9155     R(4)            4           scalar                    9155,9160                         
 FILLM                      Scalar 9100     R(4)            4           scalar   COM                                                
 FILLT                      Scalar 9100     R(4)            4           scalar   COM                                                
 FILLW                      Scalar 9097     L(4)            4           scalar   COM              9110,9177                         
 FILLZ                      Scalar 9100     R(4)            4           scalar   COM                                                
 FILWND                     Subr   9089                                                                                             
 HDR                        Scalar 9099     R(4)            4     1     14       COM                                                
 IPRT                       Dummy  9089     I(4)            4     1     2        ARG,INOUT        9198                              
 IQMLIM                     Local  9108     I(4)            4           scalar                    9108,9111,9116,9131,9136          
 IQQ                        Local  9163     I(4)            4           scalar                    9163,9165,9166,9167,9168,9169,9173
 JQ                         Dummy  9089     I(4)            4     2     3000     ARG,INOUT        9116,9124,9126,9131,9136,9140,9142
                                                                                                  ,9165,9173,9184,9185,9186,9187,918
                                                                                                  8,9189,9191,9203                  
 JR                         Dummy  9089     I(4)            4     2     3000     ARG,INOUT        9172,9183                         
 K                          Local  9202     I(4)            4           scalar                    9202                              
 KLVL                       Dummy  9089     I(4)            4           scalar   ARG,INOUT        9114,9129,9135,9182,9201          
 L                          Local  9156     I(4)            4           scalar                    9156,9157,9203                    
 LCNT                       Local  9130     I(4)            4           scalar                    9130,9133,9156                    
 LSMASS                     Scalar 9100     I(4)            4           scalar   COM                                                
 LSWIND                     Scalar 9100     I(4)            4           scalar   COM                                                
 MAX                        Func   9126                                 scalar                    9126,9142,9163,9165               
 MXLVL                      Param  9091     I(4)            4           scalar                    9094,9095                         
 MXWRDH                     Param  9090     I(4)            4           scalar                    9099                              
 N                          Local  9114     I(4)            4           scalar                    9114,9115,9116,9157,9158,9161,9162
                                                                                                  ,9165,9172,9173,9182,9183,9184,918
                                                                                                  5,9186,9187,9188,9189,9191,9201,92
                                                                                                  02,9203                           
 NINT                       Func   9163                                 scalar                    9163                              
 NPZ                        Scalar 9100     I(4)            4           scalar   COM                                                
 NST                        Local  9127     I(4)            4           scalar                    9127,9157                         
 NT                         Local  9115     I(4)            4           scalar                    9115,9121,9122,9123,9124,9126,9127
                                                                                                  ,9128,9129,9131,9134,9135,9136,913
                                                                                                  7,9138,9139,9140,9142             
 NUMDAT                     Param  9093     I(4)            4           scalar                    9094                              
 NUMQMS                     Param  9092     I(4)            4           scalar                    9093,9094,9095,9198,9203          
 NUMVAR                     Param  9092     I(4)            4           scalar                    9093,9198,9202                    
 PARM5                      Common 9100                                 32                                                          

Page 214         Source Listing                  FILWND
2017-04-18 11:09 Symbol Table                    prepdata.f

 Name                       Object Declared Type            Bytes Dimen Elements Attributes       References                        
                                                                                                                                    
 PLO                        Local  9123     R(4)            4           scalar                    9123,9146,9147,9153,9158          
 PLOG                       Local  9158     R(4)            4           scalar                    9158,9159,9160                    
 PPHI                       Local  9139     R(4)            4           scalar                    9139,9146,9147,9153               
 QHI                        Local  9140     R(4)            4           scalar                    9140,9142,9163                    
 QLO                        Local  9124     R(4)            4           scalar                    9124,9126,9163                    
 RPTHDR                     Common 9099                                 88                                                          
 STNID                      Scalar 9098     CHAR            8           scalar   COM              9199                              
 SUBSET_D                   Scalar 9098     CHAR            8           scalar   COM                                                
 TMP                        Dummy  9089     R(4)            4     2     9600     ARG,INOUT        9116,9121,9122,9123,9137,9138,9139
                                                                                                  ,9158,9161,9162,9202              
 UHI                        Local  9137     R(4)            4           scalar                    9137,9154                         
 ULO                        Local  9121     R(4)            4           scalar                    9121,9154,9159                    
 UU                         Local  9159     R(4)            4           scalar                    9159,9161                         
 VHI                        Local  9138     R(4)            4           scalar                    9138,9155                         
 VLO                        Local  9122     R(4)            4           scalar                    9122,9155,9160                    
 VV                         Local  9160     R(4)            4           scalar                    9160,9162                         
 XMISS                      Local  9101     R(4)            4           scalar                    9101,9116                         
 YMISS                      Local  9101     R(4)            4           scalar                    9101                              

Page 215         Source Listing                  FILWND
2017-04-18 11:09                                 prepdata.f

   9213 C$$$  SUBPROGRAM DOCUMENTATION BLOCK
   9214 C
   9215 C SUBPROGRAM:    FILDPT
   9216 C   PRGMMR: D. A. KEYSER     ORG: NP22       DATE: 1997-05-01
   9217 C
   9218 C ABSTRACT: FILLS IN MISSING DEWPOINT INFORMATION IN THE RAOB PROFILE
   9219 C   BY INTERPOLATING BETWEEN BRACKETING LEVELS WITH GOOD QUALITY
   9220 C   DEWPOINT DATA.
   9221 C
   9222 C PROGRAM HISTORY LOG:
   9223 C   UNKNOWN
   9224 C 1988-04-11  D. A. KEYSER -- DOCBLOCKING/COMMENTING; IF > 100 MB
   9225 C     BETWEEN BRACKETING P-LVLS SET WINDS MSG (WAS > 600 MB)
   9226 C 1989-04-24  D. A. KEYSER -- CHECKS 'FAILBL', IF TRUE WILL NOT USE
   9227 C     CAT. 4 WIND BELOW TOP SPANNNING PRESSURE FOR PSTN AS A BRACKETING
   9228 C     LVL FOR WIND
   9229 C 1990-01-11  D. A. KEYSER -- CONVERTED TO VS FORTRAN(77) & RESTRUCTURED
   9230 C 1991-01-23  D. A. KEYSER -- SPLIT OLD SUBR. 'FILLIN' INTO SEPARATE
   9231 C     WIND AND DEWPOINT INTERPOLATING SUBROUTINES
   9232 C 1993-05-12  D. A. KEYSER -- THE NEW "PREPBUFR TABLE VALUES" WHICH CAN
   9233 C     RANGE FROM 0-15 ARE EMPLOYED RATHER THAN THE OLD OI/SSI QUALITY
   9234 C     MARKERS
   9235 C 1995-07-12  D. A. KEYSER -- IF SPANNING LVL PRESS. Q.M. IS BAD INTERP.
   9236 C     DWPT IS BAD AND IS STORED AS MISSING, IF INTERP. LVL PRESS. Q.M.
   9237 C     IS BAD INTERP. DWPT IS BAD AND IS STORED AS MISSING
   9238 C 1996-03-04  D. A. KEYSER -- FOR RGL-BUFR OUTPUT: MORE FIXES TO MAKE
   9239 C     BUFR-PREPDA FILE CONTAIN DATA EXPECTED BY FERR PGM & OI-ANAL
   9240 C     (INTERP. DATA Q.M. CALC. SAME AS FOR OLD "PREPDA" FORM)
   9241 C 1997-05-01  D. A. KEYSER -- EST. REASON CODES FOR UPPER-AIR DATA
   9242 C     TYPES (CURRENTLY JUST 100, 101-103, 105 TO IDENTIFY INTERPOLATED
   9243 C     DATA FOR CQCBUFR PGM)
   9244 C
   9245 C USAGE:    CALL FILDPT(KLVL,TMP,JQ,JR,IPRT)
   9246 C   INPUT ARGUMENT LIST:
   9247 C     KLVL     - NO. OF COMBINED CAT. 1,2,3,4,5 AND "SPEC" 25/50 MB
   9248 C              - LEVELS WITH DUPLICATES REMOVED
   9249 C     TMP      - "MXLVL" X "NUMDAT" ARRAY HOLDING AN U-AIR REPORT'S
   9250 C              - MASS & WIND DATA IN CAT. 1,2,3,4,5 AND "SPEC" 25/50 MB
   9251 C              - LEVELS AFTER MERGING
   9252 C     JQ       - "MXLVL" X "NUMQMS" ARRAY HOLDING AN U-AIR RPT'S PREPBUFR
   9253 C              - TABLE VALUES IN CAT. 1,2,3,4,5 AND "SPECIAL" 25/50 MB
   9254 C              - LEVELS AFTER MERGING
   9255 C     JR       - "MXLVL" X "NUMQMS" ARRAY HOLDING AN U-AIR RPT'S REASON
   9256 C              - CODES IN CAT. 1,2,3,4,5 AND "SPECIAL" 25/50 MB LEVELS
   9257 C              - AFTER MERGING
   9258 C     IPRT     - 2-WORD SWITCH, DETAILED STD. O-PUT (UNIT 6) PRT OF RPT
   9259 C
   9260 C   OUTPUT ARGUMENT LIST:
   9261 C     TMP      - "MXLVL" X "NUMDAT" ARRAY HOLDING AN U-AIR REPORT'S
   9262 C              - MASS & WIND DATA IN CAT. 1,2,3,4,5 AND "SPEC" 25/50 MB
   9263 C              - LEVELS AFTER MERGING AND DEWPOINT IS FILLED IN
   9264 C     JQ       - "MXLVL" X "NUMQMS" ARRAY HOLDING AN U-AIR RPT'S PREPBUFR
   9265 C              - TABLE VALUES IN CAT. 1,2,3,4,5 AND "SPECIAL" 25/50 MB
   9266 C              - LEVELS AFTER MERGING & DEWPOINT IS FILLED IN
   9267 C     JR       - "MXLVL" X "NUMQMS" ARRAY HOLDING AN U-AIR RPT'S REASON
   9268 C              - CODES IN CAT. 1,2,3,4,5 AND "SPECIAL" 25/50 MB LEVELS
   9269 C              - AFTER MERGING & DEWPOINT IS FILLED IN

Page 216         Source Listing                  FILWND
2017-04-18 11:09                                 prepdata.f

   9270 C
   9271 C   OUTPUT FILES:
   9272 C     UNIT 06  - STANDARD OUTPUT PRINT
   9273 C
   9274 C REMARKS: CALLED BY SUBROUTINE 'SMERGE'.
   9275 C
   9276 C ATTRIBUTES:
   9277 C   LANGUAGE: FORTRAN 90
   9278 C   MACHINE:  NCEP WCOSS
   9279 C
   9280 C$$$
   9281       SUBROUTINE FILDPT(KLVL,TMP,JQ,JR,IPRT)
   9282       PARAMETER (MXWRDH = 15)
   9283       PARAMETER (MXLVL = 600)
   9284       PARAMETER (NUMVAR = 6, NUMQMS = 5)
   9285       PARAMETER (NUMDAT = NUMVAR + (2 * NUMQMS))
   9286       DIMENSION  TMP(MXLVL,NUMDAT),JQ(MXLVL,NUMQMS),IPRT(2),
   9287      $ JR(MXLVL,NUMQMS)
   9288       real(8)  alon_8,alat_8
   9289       CHARACTER*8  STNID,SUBSET_d
   9290       COMMON/RPTHDR/SUBSET_d,STNID,HDR(2:MXWRDH),alon_8,alat_8
   9291 C-----------------------------------------------------------------------
   9292 C   INTERPOLATE BETWEEN BRACKETING LEVELS TO FILL IN MISSING DEWPOINTS
   9293 C-----------------------------------------------------------------------
   9294       DO N = 1,KLVL
   9295          NT = N
   9296          IF(TMP(N,4).LT.9999.)  GO TO 52
   9297       ENDDO
   9298       GO TO 99
   9299    52 CONTINUE
   9300       PLO = TMP(NT,1)
   9301       DLO = TMP(NT,4)
   9302 C USE TEMPERATURE PREPBUFR TABLE VALUE
   9303       QLO = JQ(NT,2)
   9304 C IF PRESSURE Q.M. IS BAD(15), THEN SET NON-MISSING DWPT Q.M. AS BAD(15)
   9305       IF(JQ(NT,5).EQ.15)  QLO = MAX(15.,QLO)
   9306       NST = NT
   9307       NT = NT + 1
   9308       IF(NT.GT.KLVL)  GO TO 99
   9309       LCNT = 0
   9310       IF(TMP(NT,4).LT.9999.)  GO TO 52
   9311    54 CONTINUE
   9312       LCNT = LCNT + 1
   9313       NT = NT + 1
   9314       IF(NT.GT.KLVL)  GO TO 99
   9315       IF(TMP(NT,4).GT.9999.)  GO TO 54
   9316       DHI = TMP(NT,4)
   9317       PPHI = TMP(NT,1)
   9318       QHI = JQ(NT,2)
   9319 C IF PRESSURE Q.M. IS BAD(15), THEN SET NON-MISSING DWPT Q.M. AS BAD(15)
   9320       IF(JQ(NT,5).EQ.15)  QHI = MAX(15.,QHI)
   9321 C IN RARE INSTANCES (E.G., WHEN CAT. 2 HGHTS GENERATED THROUGH DEEP
   9322 C  LAYERS W/O MAND-LVL HGHTS) THE SPANNING PRESSURES HERE COULD BE EQUAL
   9323 C  OR PLO COULD BE .LT. PPHI -- IN THIS CASE DON'T INTERP. (DEWPT MSG)
   9324       IF(PLO.LE.PPHI)  GO TO 52
   9325       DLNP = ALOG(PPHI/PLO)
   9326       DTDLNP = (DHI - DLO)/DLNP

Page 217         Source Listing                  FILDPT
2017-04-18 11:09                                 prepdata.f

   9327       DO L = 1,LCNT
   9328          N = NST + L
   9329          PLOG = ALOG(TMP(N,1)/PLO)
   9330          TD = DLO + (DTDLNP * PLOG)
   9331          QQ = MAX(QLO,QHI)
   9332          QQLIM = 3.5
   9333 C IF PRESSURE Q.M. IS BAD(15), THEN SET NON-MISSING QQ AS BAD(15)
   9334          IF(JQ(N,5).EQ.15)  QQ = MAX(15.,QQ)
   9335 C ONLY STORE INTERP. TDD IF CALC. PREPBUFR TBL VAL. NON-BAD
   9336          IF(QQ.LT.QQLIM)  THEN
   9337             TMP(N,4) = TD
   9338 C EVENT#102 - MOISTURE CREATED FROM INTERPOLATION OF REPORTED DATA
   9339             JR(N,3) = 102
   9340          END IF
   9341       ENDDO
   9342       GO TO 52
   9343    99 CONTINUE
   9344 C+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
   9345 C DETAILED PRINT FOR SPECIFIED REPORT(S) -- IF ENTERED IN DATA CARDS
   9346       IF(IPRT(2).EQ.1.AND.NUMVAR.LT.11.AND.NUMQMS.LT.9)  THEN
   9347          PRINT 904, STNID
   9348   904 FORMAT(/' FILDPT: ',A8,', LVLS W/ MISSING DWPTS FILLED IN')
   9349          DO N = 1,KLVL
   9350             PRINT 900, (TMP(N,K),K=1,NUMVAR)
   9351             PRINT 905, (JQ(N,L),L=1,NUMQMS)
   9352          ENDDO
   9353          PRINT 901
   9354       END IF
   9355   900 FORMAT(1X,10F10.2)
   9356   905 FORMAT('+',102X,8I3)
   9357   901 FORMAT('0',//)
   9358 C+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
   9359       RETURN
   9360       END

Page 218         Source Listing                  FILDPT
2017-04-18 11:09 Entry Points                    prepdata.f



ENTRY POINTS

  Name               
                     
 fildpt_             


SYMBOL CROSS REFERENCE

 Name                       Object Declared Type            Bytes Dimen Elements Attributes       References                        
                                                                                                                                    
 52                         Label  9299                                                           9296,9310,9324,9342               
 54                         Label  9311                                                           9315                              
 900                        Label  9355                                                           9350                              
 901                        Label  9357                                                           9353                              
 904                        Label  9348                                                           9347                              
 905                        Label  9356                                                           9351                              
 99                         Label  9343                                                           9298,9308,9314                    
 ALAT_8                     Scalar 9288     R(8)            8           scalar   COM                                                
 ALOG                       Func   9325                                 scalar                    9325,9329                         
 ALON_8                     Scalar 9288     R(8)            8           scalar   COM                                                
 DHI                        Local  9316     R(4)            4           scalar                    9316,9326                         
 DLNP                       Local  9325     R(4)            4           scalar                    9325,9326                         
 DLO                        Local  9301     R(4)            4           scalar                    9301,9326,9330                    
 DTDLNP                     Local  9326     R(4)            4           scalar                    9326,9330                         
 FILDPT                     Subr   9281                                                                                             
 HDR                        Scalar 9290     R(4)            4     1     14       COM                                                
 IPRT                       Dummy  9281     I(4)            4     1     2        ARG,INOUT        9346                              
 JQ                         Dummy  9281     I(4)            4     2     3000     ARG,INOUT        9303,9305,9318,9320,9334,9351     
 JR                         Dummy  9281     I(4)            4     2     3000     ARG,INOUT        9339                              
 K                          Local  9350     I(4)            4           scalar                    9350                              
 KLVL                       Dummy  9281     I(4)            4           scalar   ARG,INOUT        9294,9308,9314,9349               
 L                          Local  9327     I(4)            4           scalar                    9327,9328,9351                    
 LCNT                       Local  9309     I(4)            4           scalar                    9309,9312,9327                    
 MAX                        Func   9305                                 scalar                    9305,9320,9331,9334               
 MXLVL                      Param  9283     I(4)            4           scalar                    9286,9287                         
 MXWRDH                     Param  9282     I(4)            4           scalar                    9290                              
 N                          Local  9294     I(4)            4           scalar                    9294,9295,9296,9328,9329,9334,9337
                                                                                                  ,9339,9349,9350,9351              
 NST                        Local  9306     I(4)            4           scalar                    9306,9328                         
 NT                         Local  9295     I(4)            4           scalar                    9295,9300,9301,9303,9305,9306,9307
                                                                                                  ,9308,9310,9313,9314,9315,9316,931
                                                                                                  7,9318,9320                       
 NUMDAT                     Param  9285     I(4)            4           scalar                    9286                              
 NUMQMS                     Param  9284     I(4)            4           scalar                    9285,9286,9287,9346,9351          
 NUMVAR                     Param  9284     I(4)            4           scalar                    9285,9346,9350                    
 PLO                        Local  9300     R(4)            4           scalar                    9300,9324,9325,9329               
 PLOG                       Local  9329     R(4)            4           scalar                    9329,9330                         
 PPHI                       Local  9317     R(4)            4           scalar                    9317,9324,9325                    
 QHI                        Local  9318     R(4)            4           scalar                    9318,9320,9331                    
 QLO                        Local  9303     R(4)            4           scalar                    9303,9305,9331                    
 QQ                         Local  9331     R(4)            4           scalar                    9331,9334,9336                    
 QQLIM                      Local  9332     R(4)            4           scalar                    9332,9336                         
 RPTHDR                     Common 9290                                 88                                                          
 STNID                      Scalar 9289     CHAR            8           scalar   COM              9347                              

Page 219         Source Listing                  FILDPT
2017-04-18 11:09 Symbol Table                    prepdata.f

 Name                       Object Declared Type            Bytes Dimen Elements Attributes       References                        
                                                                                                                                    
 SUBSET_D                   Scalar 9289     CHAR            8           scalar   COM                                                
 TD                         Local  9330     R(4)            4           scalar                    9330,9337                         
 TMP                        Dummy  9281     R(4)            4     2     9600     ARG,INOUT        9296,9300,9301,9310,9315,9316,9317
                                                                                                  ,9329,9337,9350                   

Page 220         Source Listing                  FILDPT
2017-04-18 11:09                                 prepdata.f

   9361 C$$$  SUBPROGRAM DOCUMENTATION BLOCK
   9362 C
   9363 C SUBPROGRAM:    STOROB
   9364 C   PRGMMR: D. A. KEYSER     ORG: NP22       DATE: 2008-09-25
   9365 C
   9366 C ABSTRACT: READS IN MERGED UPPER-AIR PROFILE VIA DAT IN COMMON BLOCK
   9367 C   AND WRITES IT TO SEPARATE MASS AND WIND 'REPORTS' (UP TO "MXLVL"
   9368 C   LEVELS)  IN MOBS.  CALLS SUBR. 'FILLX' TO ACTUALLY STORE 'REPORT'
   9369 C   INTO PREPBUFR MESSAGE.
   9370 C
   9371 C PROGRAM HISTORY LOG:
   9372 C 1987-06-14  D. A. KEYSER -- CORRECTED STORAGE LIMIT PROBLEM FOR
   9373 C     SPECIFIC HUMIDITY
   9374 C 1987-12-29  D. A. KEYSER -- ADDED SWITCH TO SKIP INDIAN MASS REPORTS
   9375 C 1988-04-11  D. A. KEYSER -- DOCBLOCKING/COMMENTING
   9376 C 1989-12-13  D. A. KEYSER -- PIBAL HGHTS STORED IN 1ST POSITION FOR A
   9377 C     WIND LEVEL (WAS ALWAYS MISSING); INDIAN TEST MOVED TO SUBR.
   9378 C     'GETUPA' AND PASSED HERE AS ARGUMENT
   9379 C 1990-01-11  D. A. KEYSER -- CONVRTED TO VS FORTRAN(77) & RESTRUCTURED
   9380 C 1992-06-10  D. A. KEYSER -- U-AIR PRESS. NOW ROUNDED RATHER THAN
   9381 C     TRUNCATED PRIOR TO BEING WRITTEN TO PREPDA FILE
   9382 C 1992-07-09  D. A. KEYSER -- RMVED. SUBPR. FCN "QFRMTP" & REPL. W/
   9383 C     IN-LINE FCN STMNT.; NOBS ARRAY NOT FILLED W/ VARIABLE IF .GT.
   9384 C     32767
   9385 C 1993-05-12  D. A. KEYSER -- SET-UP EXPANDED REPORT FORMAT, WORD 2 FOR
   9386 C     EACH MASS/WIND LVL IS PRESS. X 10MB, NEW WORD 5 FOR EACH LEVEL
   9387 C     CONTAINS 4 PACKED "PREPBUFR TBL VALUES" WHICH CAN RANGE FROM 0-15
   9388 C     AND CORRESPOND TO ON29 Q. MARKERS OR PREPRO-GENERATED Q. MARKERS
   9389 C     OR ON29 CAT. NO.; ALL NON-MISSING DATA ARE NOW PACKED INTO
   9390 C     PREPBUFR FILE REGARDLESS OF QUAL.; VERT. COORDINATE INDICATOR
   9391 C     ADDED TO PREPBUFR TABLE VALUE LIST FOR VARIABLES
   9392 C 1993-05-31  D. A. KEYSER -- CHECKS FOR TOVS RETR. (BUFR-INPUT) WHICH
   9393 C     ALREADY CONTAINS MOISTURE AS SPEC. HUMIDITY, CHKS QUAL.
   9394 C 1993-10-07  D. A. KEYSER -- MSG VALUE IN NOBS ARRAY IS 99999, ACTUAL
   9395 C     HEIGHT (NO D-VAL) STORED IN NOBS ARRAY
   9396 C 1993-11-02  D. A. KEYSER -- VARIABLE IFLUA WHEN SET TO 1 WILL FLAG
   9397 C     ALL VARIABLES WITH PREPBUFR T. VALUE=15 (VARIABLE INDIAN SET TO 1
   9398 C     ALSO FLAGS)
   9399 C 1993-12-21  D. A. KEYSER -- CAT. 4 WIND LVLS NOW HOLD P-ALT IN WORD 1
   9400 C     OF LVL INFO (NOBS) W/ TBL. VAL. IN POSITION 3 OF WORD 5 (BOTH
   9401 C     WERE MISSING)
   9402 C 1994-08-11  D. A. KEYSER -- VIRT. TEMP NOW CALC. HERE PRIOR TO WRITING
   9403 C     TO NOBS ARRAY; WORDS 6 AND 7 OF MASS LVL NOW CONTAIN SENS. TEMP
   9404 C     AND DWPT TEMP, RESP. WHILE WORDS 6 AND 7 OF WIND LEVEL CONTAIN
   9405 C     WIND DIR. AND SPEED, RESP., ALSO WORD 3 OF MASS LVL NOW CONTAINS
   9406 C     "REPORTED" TEMP
   9407 C 1995-07-12  D. A. KEYSER -- SPECIFIC HUMIDITY SET TO MISSNG IF
   9408 C     PRESSURE ON THE LEVEL HAS A BAD Q.M.
   9409 C 1995-08-24  D. A. KEYSER -- R.T. 132 DROPS SFC. DATA ALL FLAGGED FOR
   9410 C     NON-USE BY ANAL. (USED LATER AS R.T 182)
   9411 C 1996-03-04  D. A. KEYSER -- FOR RGL-BUFR OUTPUT: MORE FIXES TO MAKE
   9412 C     BUFR-PREPDA FILE CONTAIN DATA EXPECTED BY FERR PGM & OI-ANAL
   9413 C     (PIBAL TEST AND LAST "GOOD" DATA LEVEL TEST SAME AS FOR OLD
   9414 C     "PREPDA" FORM, PRESSURE ENCODED IN BUFR IS TO NEAREST WHOLE
   9415 C     MILLIBAR W/ ZERO IN TENTHS); REPORT SEQ. NUMBER STORED IN HDR(11)
   9416 C     FOR ALL "ADPUPA" REPORTS AND LATER ENCODED IN BUFR/PREPDA FILE
   9417 C 1997-05-01  D. A. KEYSER --  SUBR. 'STOROB' NO LONGER CALLED AND

Page 221         Source Listing                  FILDPT
2017-04-18 11:09                                 prepdata.f

   9418 C     REMOVED, SUBR. 'STORXX' RENAMED TO 'STOROB'; EST. REASON CODES
   9419 C     FOR UPPER-AIR DATA TYPES (CURRENTLY JUST 100, 101-103, 105 TO
   9420 C     IDENTIFY INTERPOLATED DATA FOR CQCBUFR PGM); CHGS IN LVL ON29
   9421 C     CATEGORY INDICATORS: TROP CAT=5 EXPLICITLY IDENTIFED IN ALL
   9422 C     CASES, SAME W/ CAT 2-4
   9423 C 1998-05-15  D. A. KEYSER -- FLAGGING OF TROP LVLS WITH WSPD=0 MOVED
   9424 C     FROM SUBR. GETUPA TO STOROB BECAUSE SOME CALM TROP WINDS WEREN'T
   9425 C     BEING IDENTIFIED
   9426 C 1999-08-04  D. A. KEYSER --  RADIOSONDE BALLOON DRIFT LAT/LON NOW
   9427 C     CALCULATED ON EACH LEVEL
   9428 C 2000-02-17  D. A. KEYSER -- EXPANDED BALLOON DRIFT PROCESSING TO
   9429 C     INCL. PIBALS; UPDATED DEL-TIME ON UPPER-AIR RAOB AND PIBAL LVLS
   9430 C     (ALREADY CALC. BASED ON BALLOON DRIFT) AND ENCODED INTO PREPBUFR
   9431 C     FILE W/ MNEMONIC "HRDR"; IMPR. CHECKING IN RAOB/PIBAL BALLOON
   9432 C     DRIFT LAT/LON/TIME CALC.; USES INTERPOL. WIND LEVELS FOR BALLOON
   9433 C     DRIFT LAT/LON CALC.
   9434 C 2000-12-05  D. A. KEYSER -- WIND PROFILERS WHICH COME IN DISGUISED AS
   9435 C     PIBALS ARE CHANGED TO R.T. 223 SO THEY WILL BE PROCESSED AS WIND
   9436 C     PROFILERS (DETERMINED BY STNID)
   9437 C 2001-04-06  D. A. KEYSER -- ADDED UK PROFILER ID 03501 TO LIST OF
   9438 C     PROFILERS WHICH MAY COME IN DISGUISED AS PIBALS PRIOR TO DECODER
   9439 C     CHANGE (GETS R.TYPE 223)
   9440 C 2001-09-14  D. A. KEYSER -- FINAL REPORT SEQ. NUMBER FOR RAOBS/
   9441 C     PIBALS/DROPS SAVED IN "ISQNUM_UPA" IN COMMON /UPALIM/ SO RECCOS
   9442 C     IN SUBR. GETC06 CAN STORE SEQ. NUMBER IN HDR(11), PICKING UP
   9443 C     WHERE THESE LEFT OFF
   9444 C 2003-08-22  D. A. KEYSER -- CORRECTED BUG WHICH STARTED CALCULATING
   9445 C     RADIOSONDE/PIBAL BALLOON DRIFT TIME FROM FIRST REPORTING HEIGHT
   9446 C     LEVEL RATHER THAN SURFACE LEVEL (STARTED AT 1000 MB MAND. LEVEL
   9447 C     BELOW GROUND), DRIFT LAT/LON VALUES WERE OKAY
   9448 C 2004-09-09  D. A. KEYSER -- ADDED PROCESSING OF NPN AND CAP RASS DATA
   9449 C     READ FROM "RASSDA" DUMP FILE IN NEW DATA LVL CAT. 15, DUMP R.
   9450 C     TYPE 77, GET PREPBUFR R. TYPE 126, PROCESSED INTO PREPBUFR FILE
   9451 C     UNDER NEW TBL A ENTRY "RASSDA"; NOW RETURNS 41-WORD (RATHER THAN
   9452 C     2-WORD) ARRAY "OBS2" OUT OF CALL TO IW3UNPBF, WHERE WORDS 3-41
   9453 C     CONTAIN ALTIMETER SETTING, SEA-SURFACE TEMPERATURE, SINGLE-LEVEL
   9454 C     SENSIBLE WEATHER ELEMENTS AND SST TABLE VALUE (Q.M.); RETURNS NEW
   9455 C     ARRAY ARGUMENTS "OBS3" {(5,MXBLVL,5)} AND "NOBS3" {(5)} OUT OF
   9456 C     CALL TO IW3UNPBF WHERE OBS3 CONTAINS MULTIPLE-LEVEL SENSIBLE
   9457 C     WEATHER ELEMENTS AND NOBS3 DEFINES THE NUMBER OF LEVELS OF DATA
   9458 C     IN THE OBS3(X,Y,1) TO OBS3(X,Y,5) ARRAYS (SEE IW3UNPBF DOCBLOCK
   9459 C     FOR MORE INFO); ALL NEW PARAMETERS (I.E., SST AND SENSIBLE
   9460 C     WEATHER ELEMENTS) IN OBS2 AND OBS3 ARE ENCODED INTO PREPBUFR
   9461 C     FILE, BUT ONLY IN THE MASS "PIECE" OF A REPORT (UNLESS THERE IS
   9462 C     NO MASS PIECE, THEN THEY ARE ENCODED INTO WIND PIECE); WILL NOW
   9463 C     CALC. Q AND Tv IF PQM IS 15 (BUTS SETS QQM TO 15) (E.G., FOR
   9464 C     DROPs WITH PRESS FAILING D-VAL, BEFORE Q MISSING BUT LATER CALC.
   9465 C     IN VIRTMP STEP)
   9466 C 2006-08-17  D. A. KEYSER -- MOVED BALLOON DRIFT PROCESSING OUT OF
   9467 C     THIS SUBR. (TWO PLACES - IN MASS AND WIND PROC.) INTO NEW SUBR.
   9468 C     BALLOON_DRIFT; NOW PRINTS WARNING AND SENDS DIAGNOSTIC TO JOBLOG
   9469 C     IF NUMBER OF PROCESSED MASS AND WIND LEVELS SENT TO SUBR. FILLX
   9470 C     ARE NOT THE SAME (SHOULD ALWAYS BE THE SAME!); WIND QM SET TO 15
   9471 C     IF A REPORTED WIND IS FOUND ON A LEVEL WHICH IS BELOW GROUND
   9472 C 2007-09-14  D. A. KEYSER -- CASES WHERE OBS ARE SET TO QM=15 IN ORDER
   9473 C     TO FLAG A REPORT FOR NON-USE BY ANALYSIS (EVEN THOUGH OBS MAY NOT
   9474 C     NECESSARILY BE BAD) NOW FIRST CHECK TO MAKE SURE OBS QM ISN'T

Page 222         Source Listing                  FILDPT
2017-04-18 11:09                                 prepdata.f

   9475 C     ALREADY "BAD" (> 3 AND < 15) (PREVENTS GSI FROM MONITORING TRULY
   9476 C     BAD OBS WHICH JUST HAPPEN TO BE IN REPORT GROUPS FLAGGED FOR NON-
   9477 C     USE BY ANALYSIS)
   9478 C 2008-09-25  D. A. KEYSER -- UPPER LIMIT FOR STORING Q CHANGED FROM
   9479 C     32767 MG/KG TO 99999 MG/KG TO ENSURE THAT LEVELS WITH VERY
   9480 C     HIGH SPECIFIC HUMIDITY ARE PROCESSED (THE 32767 LIMIT WAS A
   9481 C     VESTIGE FROM THE OLD I*2 PREPDA DAYS); IF NEAREST INTEGER FOR Q
   9482 C     IS 0 MG/KG, IT IS RESET TO 1 MG/KG (.001 G/KG) TO ENSURE THAT
   9483 C     LEVELS WITH VERY LOW SPECIFIC HUMIDITY ARE PROCESSED (Q MUST BE >
   9484 C     0 TO BE PROCESSED)
   9485 C
   9486 C USAGE:    CALL STOROB(NLEV,PSTA,INDIAN,IPRT,*)
   9487 C   INPUT ARGUMENT LIST:
   9488 C     NLEV     - NUMBER OF LEVELS IN REPORT AFTER MERGING
   9489 C     PSTA     - STATION PRESSURE (MB)
   9490 C     INDIAN   - INDICATOR FOR INDIAN RAOB FOR WHICH MASS RPT IS FLAGGED
   9491 C              -   (=1 IN THIS CASE, OTHERWISE = 0)
   9492 C     IPRT     - 2-WORD SWITCH, DETAILED STD. O-PUT (UNIT 6) PRT OF RPT
   9493 C
   9494 C   OUTPUT FILES:
   9495 C     UNIT 06  - STANDARD OUTPUT PRINT
   9496 C
   9497 C REMARKS: CALLED BY SUBROUTINES 'GETUPA', 'SATBFR', AND 'GOESDG'.
   9498 C
   9499 C ATTRIBUTES:
   9500 C   LANGUAGE: FORTRAN 90
   9501 C   MACHINE:  NCEP WCOSS
   9502 C
   9503 C$$$
   9504       SUBROUTINE STOROB(NLEV,PSTA,INDIAN,IPRT,*)
   9505       PARAMETER (MXWRDH = 15)
   9506       PARAMETER (MXTYPV =  3)
   9507       PARAMETER (MXWRDL =  6)
   9508       PARAMETER (MXLVL = 600)
   9509       PARAMETER (NUMVAR = 6, NUMQMS = 5)
   9510       PARAMETER (NUMDAT = NUMVAR + (2 * NUMQMS))
   9511       PARAMETER (MXBLVL = 255)
   9512       PARAMETER (MAXOBS = 3500)
   9513       PARAMETER (NUMOBS2 = 43)
   9514       CHARACTER*8  ADPTYP,STNID,STNPRT,SUBSET_d
   9515       LOGICAL  KTEMP,PROFILERinADPUPA
   9516       INTEGER  IQ(MXLVL,NUMQMS),IDATA(MAXOBS),IR(MXLVL,NUMQMS),IPRT(2)
   9517       REAL  PP(MXLVL),ZP(MXLVL),TP(MXLVL),DP(MXLVL),UP(MXLVL),VP(MXLVL)
   9518       REAL(8)  BMISS,obs8_8,alon_8,alat_8
   9519       COMMON/STRCTY/ICAT(MXLVL)
   9520       COMMON/STRMOB/MOBS(MXTYPV,MXWRDL,MXLVL)
   9521       COMMON/UNITNO/NFILE,IUNIT(28)
   9522       COMMON/ADP/ISATOB,PMAND(23),RDATA(MAXOBS),IPRINT
   9523       COMMON/SNDATA/DAT(MXLVL,NUMDAT)
   9524       COMMON/DATA/KOUNT,IDATE(4),IDAT10,MP_PROCESS,WRMISS
   9525       COMMON/UPALIM/LEVPM,LEVST,LEVQQ,TDLIM,TDMAX,SPCIAL,ISQNUM_UPA
   9526       COMMON/RPTHDR/SUBSET_d,STNID,HDR(2:MXWRDH),alon_8,alat_8
   9527       COMMON/PARM2/PG4243,KTEMP,i2many_lvls
   9528       COMMON/PARM5/FILLZ,FILLT,FILLW,FILLM,LSWIND,LSMASS,CWINDO,NPZ
   9529       COMMON/PARM6/MODPRT,IFLUA,STNPRT(3)
   9530       COMMON/LFMSFC/LFMAXI,LFMAXJ,FMESHL,FLONVT,FPOLEI,FPOLEJ,MARLND,
   9531      $ JSURFM(12),JSURFW(12),FWINDO(12),PFRALT,npkrpt(12)

Page 223         Source Listing                  STOROB
2017-04-18 11:09                                 prepdata.f

   9532       COMMON/PFSWCH/PRFLER(4),PWINDO(4),PROFILERinADPUPA
   9533       COMMON/DIRECT/OBS3(5,MXBLVL,7),OBS2(NUMOBS2),NOBS3(7),RDATA2(25),
   9534      $ obs8_8(2)
   9535       COMMON /BUFRLIB_MISSING/BMISS
   9536       EQUIVALENCE  (DAT,PP),(DAT(1,2),ZP),(DAT(1,3),TP),(DAT(1,4),DP),
   9537      $ (DAT(1,5),UP),(DAT(1,6),VP),(DAT(1,NUMVAR+1),IQ),(IDATA,RDATA)
   9538       DATA   XMISS/99999./,YMISS/99998.8/,IMISS/99999/
   9539       EQUIVALENCE  (DAT(1,NUMVAR+NUMQMS+1),IR)
   9540 C FCNS BELOW CONVERT TEMP/TD (K) & PRESS (MB) INTO SAT./ SPEC. HUM.(G/G)
   9541       ES(T) = 6.1078 * EXP((17.269 * (T - 273.16))/((T - 273.16)+237.3))
   9542       QFRMTP(T,P) = (0.622 * ES(T))/(P - (0.378 * ES(T)))
   9543       IF(IPRT(2).EQ.1)  THEN
   9544          PRINT'(1X)'
   9545          PRINT'(" ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~")'
   9546          PRINT'("       WELCOME TO STOROB FOR STN. ",A)', STNID
   9547          PRINT'(" ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~")'
   9548          PRINT'(1X)'
   9549       END IF
   9550       LL_MASS=0
   9551       LL_WIND=0
   9552       IF(NFILE.EQ.IUNIT(5))  ISQNUM_UPA = ISQNUM_UPA + 1
   9553       ADPTYP = '  RAOB  '
   9554 C 'ICALLM' INDICATES WHETHER MASS PIECE STORED IN OUTPUT FILE (IF SO =1)
   9555       ICALLM = 0
   9556 C IQMLIM IS PREPBUFR TBL V. LIMIT FOR ACCEPTING REPORTS (HERE SET TO 16)
   9557       IQMLIM = 16
   9558       IZLAST = 00
   9559       ITLAST = 00
   9560       IWLAST = 00
   9561       IZBEST = 99
   9562       IWBEST = 99
   9563       DO I = 1,NLEV
   9564          IQ1 = IQ(I,1)
   9565 C FOR NON-SAT RETR: ADD 16 TO HEIGHT PREPBUFR TABLE VAL. SO IT WILL PASS
   9566 C  PIBAL/PROFLR/VADWND TST(ALSO TST CAT.3 IN CASE OF DUPL. LVL W/ CAT.4,
   9567 C  HGHT WOULD BE IN CAT. 3) - CALL IT IQ1, RETAIN ORIG. VALUE IN IQ(I,1)
   9568 C  NOTE: EVEN IF HGT PREPBUFR TBL VAL. SET TO 3, MUST STILL ADD 16 TO
   9569 C        PREPBUFR TBL VAL. TO PASS TEST (IQMLIM=16)
   9570          IF((MOD(IQ(I,3),20).EQ.4.OR.MOD(IQ(I,3),20).EQ.3).AND.ISATOB
   9571      $    .EQ.0)  IQ1 = IQ(I,1) + 16
   9572 C IZBEST IS BEST (LOWEST) HEIGHT PREPBUFR TABLE VALUE AMONGST ALL LEVELS
   9573          IZBEST = MIN(IQ1,IZBEST)
   9574 C IF KTEMP = T, THEN ALSO EXAMINE TEMP PREPBUFR TABLE VALUE FOR IZBEST
   9575          IF(KTEMP)  IZBEST = MIN(IQ(I,2),IZBEST)
   9576 C IWBEST IS BEST (LOWEST) WIND PREPBUFR TABLE VALUE AMONGST ALL LEVELS
   9577          IWBEST = MIN(IQ(I,4),IWBEST)
   9578 C IZLAST HOLDS HIGHEST LVL NO. W/ HEIGHT PREPBUFR TBL VALUE .LT. IQMLIM
   9579          IF(IQ(I,1).LT.IQMLIM)  IZLAST = I
   9580 C ITLAST HOLDS HIGHEST LVL NO. W/ TEMP PREPBUFR TABLE VALUE .LT. IQMLIM
   9581 C  (BUT ONLY IF KTEMP = TRUE)
   9582          IF(IQ(I,2).LT.IQMLIM.AND.KTEMP) ITLAST = I
   9583 C IWLAST HOLDS HIGHEST LVL NO. W/ WIND PREPBUFR TABLE VALUE .LT. IQMLIM
   9584          IF(IQ(I,4).LT.IQMLIM)  IWLAST = I
   9585       ENDDO
   9586       NLEV = MAX(IZLAST,ITLAST,IWLAST)
   9587 C CAT. 4 HEIGHTS GET PREPBUFR TBL VALUE 8(?); PIBAL, PROFILER AND VAD
   9588 C  WIND TEST IS FOR IZBEST .GE. 16

Page 224         Source Listing                  STOROB
2017-04-18 11:09                                 prepdata.f

   9589       IF(ISATOB.EQ.0.AND.IZBEST.GE.IQMLIM.AND.IDATA(15).EQ.0)  THEN
   9590          ADPTYP = '  PIBAL '
   9591          IF(IDATA(9).EQ.72)  THEN
   9592             ADPTYP = 'VAD WIND'
   9593          ELSE  IF(IDATA(9)/10.EQ.7)  THEN
   9594             ADPTYP = 'PROFILER'
   9595          END IF
   9596       END IF
   9597       IF(IDATA(9).EQ.13.AND.STNID(1:4).EQ.'CLAS')  THEN
   9598          ADPTYP = '  CLASS '
   9599 C IF LSMASS = 9999, MASS PIECE FOR CLASS SOUNDING NOT PROCESSED
   9600          IF(LSMASS.EQ.9999)  GO TO 1080
   9601       ELSE  IF(IDATA(9).EQ.77)  THEN
   9602          ADPTYP = '  RASS  '
   9603       END IF
   9604 C PIBAL, PROFILER, VAD WIND TEST IS FOR IZBEST .GE. IQMLIM (16)
   9605       IF(IZBEST.GE.IQMLIM)  GO TO 68
   9606 C***********************************************************************
   9607 C       PACK-UP MOBS FOR MASS PART OF REPORT AND SHIP OFF TO FILLX
   9608 C***********************************************************************
   9609 C INITIALIZE ALL LEVELS OF MOBS ARRAY
   9610       MOBS = IMISS
   9611 C INITIALIZE ALL LEVELS OF ICAT ARRAY
   9612       ICAT = IMISS
   9613 C FILL PSFC*10 IN 1ST LEVEL WITH TABLE VALUE SET TO 99 TO IDENTIFY THIS
   9614 C  AS A META-DATA LEVEL - EVERYTHING ELSE IS SET TO MISSING {EXPLICITLY
   9615 C  IDENTIFIES PSTN, REMAINING PSTN DATA (CAT. 2) STORED IN PROFILE}
   9616       LL = 1
   9617 C PSTA ALWAYS .LT. XMISS ==> MAY WANT TO REMOVE IF TEST BELOW
   9618 cfix? C PSTA ALWAYS .LT. YMISS ==> MAY WANT TO REMOVE IF TEST BELOW
   9619       IF(PSTA.LT.XMISS)  THEN
   9620 cfix? IF(PSTA.LT.YMISS)  THEN
   9621          MOBS(1,1,1) = NINT(PSTA * 10.)
   9622          MOBS(2,1,1) = 99
   9623       END IF
   9624 C NOW STORE MERGED LEVELS INTO MOBS ARRAY
   9625       DO I = 1,NLEV
   9626          IF(ISATOB.EQ.3.OR.ISATOB.EQ.4)  THEN
   9627 C GOES SOUNDINGS OR RTOVS OR ATOVS 40-LEVEL SOUNDINGS
   9628             IMQ = IQ(I,3) ! SPECIFIC HUMIDITY QUALITY MARKER
   9629             JCAT  = IMISS  ! DATA LEVEL CATEGORY INDICATOR
   9630          ELSE
   9631             IMQ = IQ(I,2) ! SPEC. HUM. Q. MARKER SET TO TEMP. Q. MARKER
   9632             JCAT= IQ(I,3) ! DATA LEVEL CATEGORY INDICATOR
   9633          END IF
   9634 C CHECK FOR LEVELS W/ ABSOLUTELY NO VALID DATA -- DEPENDS ON IQMLIM AS
   9635 C  TO WHAT "BAD" DATA ARE; SUCH LEVELS ARE SKIPPED ENTIRELY
   9636          IF(MIN(IQ(I,1),IQ(I,2),IQ(I,4),IMQ).GE.IQMLIM) CYCLE
   9637 C FLAG ANY VALID WINDS ON BELOW GROUND LEVELS (NEEDED HERE FOR BALLOON
   9638 C  DRIFT PROCESSING, WILL BE TESTED AGAIN IN WIND PIECE PROCESSING)
   9639           ! this should not be monitored by GSI!! (but is since qm=15)
   9640          IF(NINT(PP(I)*10.).GT.NINT(PSTA*10.).AND.MAX(UP(I),VP(I)).LT.
   9641      $    XMISS) IQ(I,4) = 15
   9642 cfix?$    YMISS) IQ(I,4) = 15
   9643          LL = LL + 1
   9644          IMP = IQ(I,5) ! PRESSURE QUALITY MARKER
   9645          IMZ = IQ(I,1) ! HEIGHT QUALITY MARKER

Page 225         Source Listing                  STOROB
2017-04-18 11:09                                 prepdata.f

   9646          IMT = IQ(I,2) ! TEMPERATURE QUALITY MARKER
   9647          IF(JCAT.LT.IMISS)  THEN
   9648 C STORE THIS DATA LEVEL'S CATEGORY
   9649             ICAT(LL) = MOD(JCAT,20)
   9650 C THE CAT. NO. HAS 60 ADDED TO IT TO INDICATE MASS DATA CAME FROM CAT. 5
   9651             IF(JCAT.GT.60)  ICAT(LL) = 5
   9652          END IF
   9653          Q = XMISS
   9654          P = PP(I)
   9655          IP = NINT(P)
   9656          IF(DP(I).LE.9999..AND.DP(I).GE.0.0)  THEN
   9657             IF(ISATOB.EQ.4)  THEN
   9658 C 40-LVL RTOVS OR ATOVS RETR.: SPEC. HUMIDITY (G/G) STORED IN DP ARRAY;
   9659 C  ACCEPTABLE PREDPA TABLE VALUE FOR MOISTURE DEPENDS ON IQMLIM VALUE
   9660                Q = DP(I)
   9661                IF(IQ(I,3).GE.IQMLIM)  GO TO 8765
   9662             ELSE
   9663 C ALL OTHER TYPES: MUST CALCULATE SPECIFIC HUMIDITY; ALSO, STORE
   9664 C  DEWPOINT TEMPERATURE OBS (*100 DEG. C) IN WORD 6 OF MOBS MASS LEVEL
   9665 cccc before cccIF(IQ(I,5).NE.15)  Q = QFRMTP(DP(I),P)
   9666                  if(p.lt.XMISS)  q = qfrmtp(dp(i),p)
   9667 cfix?            if(p.lt.YMISS)  q = qfrmtp(dp(i),p)
   9668                  if(iq(i,5).eq.15)  imq = 15
   9669 C GOES: ACCEPTABLE PREDPA T.V. FOR MOISTURE DEPENDS ON IQMLIM VALUE
   9670                IF(ISATOB.EQ.3.AND.IQ(I,3).GE.IQMLIM)  GO TO 8765
   9671                TMPCEL = (DP(I) - 273.16) * 100.
   9672                IF(NINT(TMPCEL).LT.32767) MOBS(1,6,LL) = NINT(TMPCEL)
   9673             END IF
   9674             IF(Q.LT.XMISS)  THEN
   9675 cfix?       IF(Q.LT.YMISS)  THEN
   9676                INTQ = NINT(Q * 1.E6)
   9677                IF(INTQ.EQ.0)  INTQ = 1
   9678 C STORE SPECIFIC HUMIDITY OBS (*10**6 G/G) AND R.C. IN WORD 4 OF MOBS
   9679 C  MASS LEVEL; MUST BE < IMISS (99999) * 10**6 G/G AND > 0 - IF NOT SET
   9680 C  TO MISSING
   9681                IF(INTQ.LT.IMISS.AND.INTQ.GT.0)  THEN
   9682                   MOBS(1,4,LL) = INTQ
   9683                   MOBS(3,4,LL) = IR(I,3)
   9684                END IF
   9685             END IF
   9686          END IF
   9687  8765    CONTINUE
   9688 C STORE PRESSURE OBS (*10 MB) AND R.C. IN WORD 1 OF MOBS MASS LEVEL
   9689          MOBS(1,1,LL) = NINT(P * 10.)
   9690          MOBS(3,1,LL) = IR(I,5)
   9691 C ACCEPTABLE PREDPA TABLE VALUE FOR HEIGHT DEPENDS ON IQMLIM VALUE
   9692          IF(IQ(I,1).LT.IQMLIM)  THEN
   9693 C STORE GEOPOTENTIAL OBS (METERS) AND R.C. IN WORD 2 OF MOBS MASS LEVEL
   9694             IF(NINT(ZP(I)).LT.IMISS)  THEN
   9695                MOBS(1,2,LL) = NINT(ZP(I))
   9696                MOBS(3,2,LL) = IR(I,1)
   9697             END IF
   9698          END IF
   9699          IF(INDIAN.GT.0.OR.IFLUA.EQ.1)  THEN
   9700             IF(IMP.LE.3.OR.IMP.GT.15) IMP = 15
   9701             IF(IMZ.LE.3.OR.IMZ.GT.15) IMZ = 15
   9702             IF(IMT.LE.3.OR.IMT.GT.15) IMT = 15

Page 226         Source Listing                  STOROB
2017-04-18 11:09                                 prepdata.f

   9703             IF(IMQ.LE.3.OR.IMQ.GT.15) IMQ = 15
   9704          END IF
   9705          IF(IDATA(9).EQ.31)  THEN
   9706             IF(NINT(PSTA*10.).EQ.NINT(P*10.).AND.JSURFM(5).EQ.0)
   9707      $       THEN
   9708 C IF DROPWINSONDE RPT: FLAG ALL DATA ON SFC LVL
   9709 C (THIS DATA LATER PROCESSED AS R.T. 182; SUBSEQ. OIQC PGM DOESN'T CHK
   9710 C SFC P FOR DROPS IN R.T. 132 BUT DOES FOR SPLASH-LVL RPTS IN R.T. 182 -
   9711 C EVEN IF GOOD DON'T WANT REDUNDANCY)
   9712                IF(IMP.LE.3.OR.IMP.GT.15) IMP = 15
   9713                IF(IMZ.LE.3.OR.IMZ.GT.15) IMZ = 15
   9714                IF(IMT.LE.3.OR.IMT.GT.15) IMT = 15
   9715                IF(IMQ.LE.3.OR.IMQ.GT.15) IMQ = 15
   9716                PRINT 6415, STNID,RDATA(1),RDATA(2),IDATA(9)
   9717  6415 FORMAT(' * * CAT2,SFC DATA FLAGGED-ID=',A8,', LAT=',F7.2,'N, ',
   9718      $ 'LON=',F8.2,'E, RTYP',I4,' - PROCESSED LATER AS SPLASH-LEVEL ',
   9719      $ 'REPORT')
   9720             END IF
   9721          END IF
   9722 C STORE P, Z, T, Q PREPBUFR TABLE VALUES IN WORDS 1-4 OF MOBS MASS LEVEL
   9723          MOBS(2,1,LL) = IMP
   9724          MOBS(2,2,LL) = IMZ
   9725          MOBS(2,3,LL) = IMT
   9726          MOBS(2,4,LL) = IMQ
   9727 C ACCEPTABLE PREPBUFR TBL VALUE FOR TEMPERATURE DEPENDS ON IQMLIM VALUE
   9728          IF(IQ(I,2).LT.IQMLIM)  THEN
   9729             TVIRT = XMISS
   9730             TMPCEL = (TP(I) - 273.16) * 100.
   9731             IF(NINT(TMPCEL).LT.32767)  THEN
   9732 C STORE "REPORTED" TEMP. OBS. (*100 DEG. C) AND R.C. IN WORD 3 OF MOBS
   9733 C  MASS LEVEL (FOR RTOVS OR ATOVS SATELLITE THIS IS VIRT., ELSE SENS.)
   9734                MOBS(1,3,LL) = NINT(TMPCEL)
   9735                MOBS(3,3,LL) = IR(I,2)
   9736             END IF
   9737             IF((ISATOB.EQ.0.AND.IDATA(9).NE.77).OR.ISATOB.EQ.3)  THEN
   9738 C ALL NON-SAT. TYPES (EXCEPT RASS) & GOES SNDG. CALC. VIRTUAL TEMP. IF
   9739 C  Q NON-MSG (IF Q MSG: V. TEMP MSG) ELSE IF Q MSG TP REMAINS SENS.
   9740 C  TEMP.)
   9741                IF(Q.LT.XMISS)  THEN
   9742 cfix?          IF(Q.LT.YMISS)  THEN
   9743                   TV = TP(I) * (1.0 + (0.61 * Q))
   9744             IF(TV.GE.375..OR.(TV.GE.325.AND.PP(I).LT.100.))  THEN
   9745 C IF CALC. VIRT. TEMP >375 K ( >325 K ABOVE 100 MB) THEN: V. TEMP MSG)
   9746                   ELSE
   9747                      TVIRT = TV
   9748                   END IF
   9749                END IF
   9750             ELSE
   9751                TVIRT = TP(I)
   9752             END IF
   9753             IF(TVIRT.LT.XMISS)  THEN
   9754 cfix?       IF(TVIRT.LT.YMISS)  THEN
   9755 C STORE VIRTUAL TEMP. OBS. (*100 DEG. C) IN WORD 5 OF MOBS MASS LEVEL
   9756                TMPCEL = (TVIRT - 273.16) * 100.
   9757                IF(NINT(TMPCEL).LT.32767)  MOBS(1,5,LL) = NINT(TMPCEL)
   9758             END IF
   9759          END IF

Page 227         Source Listing                  STOROB
2017-04-18 11:09                                 prepdata.f

   9760          IF(HDR(6).EQ.120)  THEN
   9761 C.......................................................................
   9762 C              MASS REPORT BALLOON DRIFT PROCESSING
   9763 C (FILL INTO DFTLAT/DFTLON AND DFTTIM ARRAYS - LATER ENCODED INTO MASS
   9764 C         AND WIND PIECES FOR THIS REPORT IN PREPBUFR FILE)
   9765 C.......................................................................
   9766             CALL BALLOON_DRIFT(IPRT,I,PSTA,LL)
   9767          END IF
   9768       ENDDO
   9769       IF(LL.GT.0)  THEN
   9770 C SET REPORT SEQ. NUMBER TO "ISQNUM_UPA" AND STORE IN HDR(11) IF A
   9771 C  RADIOSONDE, PIBAL, DROPWINSONDE OR CLASS REPORT IN ADPUPA FILE
   9772          IF(NFILE.EQ.IUNIT(5))  HDR(11) = ISQNUM_UPA
   9773          CALL FILLX(LL,IERF)
   9774          IF(IERF.EQ.0)  THEN
   9775             ICALLM = 1
   9776             LL_MASS = LL
   9777          END IF
   9778       END IF
   9779    68 CONTINUE
   9780       IF(INDIAN.GT.0.AND.IPRINT.EQ.0)  PRINT 71, STNID
   9781    71 FORMAT(31X,'+ + + + +   INDIAN RAOB MASS REPORT FLAGGED, ID = ',
   9782      $ A8,'  + + + + +')
   9783 C***********************************************************************
   9784 C       PACK-UP MOBS FOR WIND PART OF REPORT AND SHIP OFF TO FILLX
   9785 C***********************************************************************
   9786       IF(ICALLM.EQ.1) THEN
   9787 C  DO NOT ENCODE OBS2 OR OBS3 VARIABLES WITH WIND REPORT UNLESS NO MASS
   9788 C   REPORT WAS GENERATED {EXCEPTIONS: OBS2(1-3) - RSRD, EXPRSRD, ALSE}
   9789          OBS2(4:NUMOBS2) = BMISS
   9790          OBS3 = BMISS
   9791          NOBS3 = 0
   9792       END IF
   9793 C Q.M. TESTS BELOW DEPENDENT ON IQMLIM VALUE
   9794       IF(IZBEST.GE.IQMLIM.AND.IWBEST.LT.IQMLIM.AND.IPRINT.EQ.0)
   9795      $ PRINT 87,ADPTYP,STNID,IQMLIM
   9796    87 FORMAT(25X,'* * * * *   ',A8,' MASS REPORT TOSSED, ID = ',A8,
   9797      $ ', IZBEST .GE. ',I2,'   * * * * *')
   9798  1080 CONTINUE
   9799       IF(IWBEST.GE.IQMLIM.OR.(IDATA(9).EQ.13.AND.STNID(1:4).EQ.'CLAS'
   9800      $ .AND.LSWIND.EQ.9999))  THEN
   9801 C IF LSWIND = 9999, WIND PIECE FOR CLASS SOUNDING NOT PROCESSED
   9802          IF((IZBEST.LT.IQMLIM).AND.ISATOB.EQ.0.AND.(LSWIND.EQ.0.OR.
   9803      $    STNID(1:4).NE.'CLAS'.OR.IDATA(9).NE.13).AND.IPRINT.EQ.0)
   9804      $    PRINT 88,ADPTYP,STNID,IQMLIM
   9805    88    FORMAT(25X,'* * * * *   ',A8,' WIND REPORT TOSSED,',
   9806      $    ' ID = ',A8,', IWBEST .GE. ',I2,'   * * * * *')
   9807          IF(ICALLM.EQ.0)  THEN
   9808 C---------------------------------------------------------------------
   9809 C IN THIS CASE, NO MASS PIECE WAS CALC. -- SINCE NO WIND TOSS REPORT
   9810             IF(IPRINT.EQ.0) PRINT 9954, STNID,RDATA(1),RDATA(2),IDATA(9)
   9811  9954 FORMAT(' * * TOTAL REPORT TOSSED  -ID=',A8,', LAT=',F7.2,'N, ',
   9812      $ 'LON=',F8.2,'E, RTYP',I4,' - NO VALID DATA IN STOROB')
   9813             KOUNT = KOUNT - 1
   9814             RETURN 1
   9815 C---------------------------------------------------------------------
   9816          ELSE

Page 228         Source Listing                  STOROB
2017-04-18 11:09                                 prepdata.f

   9817 C SINCE NO WIND, ALL DONE, RETURN
   9818             RETURN
   9819 C---------------------------------------------------------------------
   9820          END IF
   9821       END IF
   9822 C INITIALIZE ALL LEVELS OF MOBS ARRAY
   9823       MOBS = IMISS
   9824 C INITIALIZE ALL LEVELS OF ICAT ARRAY
   9825       ICAT = IMISS
   9826 C FILL PSFC*10 IN 1ST LEVEL WITH TABLE VALUE SET TO 99 TO IDENTIFY THIS
   9827 C  AS A META-DATA LEVEL - EVERYTHING ELSE IS SET TO MISSING {EXPLICITLY
   9828 C  IDENTIFIES PSTN, REMAINING PSTN DATA (CAT. 3) STORED IN PROFILE}
   9829       LL = 1
   9830 C PSTA ALWAYS .LT. XMISS ==> MAY WANT TO REMOVE IF TEST BELOW
   9831 cfix? C PSTA ALWAYS .LT. YMISS ==> MAY WANT TO REMOVE IF TEST BELOW
   9832       IF(PSTA.LT.XMISS)  THEN
   9833 cfix? IF(PSTA.LT.YMISS)  THEN
   9834          MOBS(1,1,1) = NINT(PSTA * 10.)
   9835          MOBS(2,1,1) = 99
   9836       END IF
   9837       HDR(6) = HDR(6) + 100
   9838 C IF PIBAL BUMP PREPBUFR REPORT TYPE BY 1 TO 221
   9839       IF(IZBEST.GE.IQMLIM.AND.IDATA(15).EQ.0.AND.NINT(HDR(6)).EQ.220)
   9840      $ THEN
   9841          HDR(6) = 221
   9842          IF(PROFILERinADPUPA)  THEN
   9843 C WIND PROFILERS ORIG. IN PILOT (PIBAL) FORMAT BULLETINS WERE DECODED
   9844 C  AS PIBALS INTO THE "ADPUPA" DUMP FILE PRIOR TO 05/14/2001.  IF THIS
   9845 C  IS A HISTORICAL RERUN, THESE NEED TO BE IDENTIFIED SO THAT THEY ARE
   9846 C  TREATED AS PROFILERS AND ASSIGNED RTYPE 223 (WILL BE WRITTEN TO
   9847 C  "PROFLR" BUFR MESSAGES & PROCESSED BY THE SUBSEQUENT PROGRAM
   9848 C  PREPOBS_PROFCQC)
   9849                PRINT 6599, STNID,RDATA(1),RDATA(2),IDATA(9),RDATA(4)
   9850  6599 FORMAT(' > > PIBAL ACTUALLY PROFLR-ID=',A8,', LAT=',F7.2,'N, ',
   9851      $ 'LON=',F8.2,'E, RTYP',I4,', TIME',F9.5,' - SET PREPBUFR R.TYPE ',
   9852      $ 'TO 223')
   9853             HDR(6) = 223
   9854          END IF
   9855       END IF
   9856 C NOW STORE MERGED LEVELS INTO MOBS ARRAY
   9857       DO I = 1,NLEV
   9858 C CHECK FOR LVLS W/ ABSOLUTELY NO VALID DATA -- DEPENDS ON IQMLIM AS
   9859 C  TO WHAT "BAD" DATA ARE; SUCH LEVELS ARE SKIPPED ENTIRELY
   9860          IF(MIN(IQ(I,1),IQ(I,2),IQ(I,4)).GE.IQMLIM)  CYCLE
   9861 C FLAG ANY VALID WINDS ON BELOW GROUND LEVELS
   9862          IF(NINT(PP(I)*10.).GT.NINT(PSTA*10.).AND.MAX(UP(I),VP(I)).LT.
   9863      $    XMISS) THEN
   9864 cfix?$    YMISS) THEN
   9865             PRINT 9515,STNID,RDATA(1),RDATA(2),IDATA(9),PP(I),PSTA
   9866  9515 FORMAT(' * * WIND OBS LVL FLAGGED -ID=',A8,', LAT=',F7.2,'N, ',
   9867      $ 'LON=',F8.2,'E, RTYP',I4,' BELOW GROUND - PRESS =',F6.1,' MB,',
   9868      $ ' PSFC =',F6.1,' MB')
   9869           ! this should not be monitored by GSI!! (but is since qm=15)
   9870             IQ(I,4) = 15
   9871          END IF
   9872          LL = LL + 1
   9873          IMP = IQ(I,5) ! PRESSURE QUALITY MARKER

Page 229         Source Listing                  STOROB
2017-04-18 11:09                                 prepdata.f

   9874          IMZ = IMISS
   9875          IMW = IQ(I,4) ! WIND QUALITY MARKER
   9876          JCAT= IQ(I,3) ! DATA LEVEL CATEGORY INDICATOR
   9877 C STORE THIS DATA LEVEL'S CATEGORY
   9878          ICAT(LL) = JCAT
   9879          IF(JCAT.GT.20)  THEN
   9880             IF(JCAT.LT.40)  THEN
   9881 C THE CAT. NO. HAS 20 ADDED TO IT TO INDICATE WIND CAME FROM CATEGORY 4
   9882 C  (ALSO, GIVE PRESSURE A REASON CODE OF 103 OR 116)
   9883                ICAT(LL) = 4
   9884                IR(I,5) = 103
   9885                IF(NPZ.EQ.0)  IR(I,5) = 116
   9886             ELSE  IF(JCAT.LT.60)  THEN
   9887 C THE CAT. NO. HAS 40 ADDED TO IT TO INDICATE WIND CAME FROM CATEGORY 3
   9888                ICAT(LL) = 3
   9889             ELSE
   9890 C THE CAT. NO. HAS 60 ADDED TO IT TO INDICATE WIND CAME FROM CATEGORY 5
   9891                ICAT(LL) = 5
   9892             END IF
   9893          END IF
   9894          IF(ICAT(LL).EQ.5)  THEN
   9895             IF(NINT(UP(I)*10.).EQ.0.AND.NINT(VP(I)*10.).EQ.0)  THEN
   9896           ! this should not be monitored by GSI!! (but is since qm=15)
   9897                IMW = 15
   9898              PRINT 6515,STNID,RDATA(1),RDATA(2),IDATA(9),UP(I)+VP(I),IMW
   9899  6515 FORMAT(' * * TROP LVL WIND FLAGGED-ID=',A8,', LAT=',F7.2,'N, ',
   9900      $ 'LON=',F8.2,'E, RTYP',I4,' - SPEED =',F7.2,' M/SEC, Q.MARK SET ',
   9901      $ 'TO ',I2)
   9902             END IF
   9903          END IF
   9904          P = PP(I)
   9905          IP = NINT(P)
   9906 C STORE PRESSURE OBS (*10 MB) AND R.C. IN WORD 1 OF MOBS WIND LEVEL
   9907          MOBS(1,1,LL) = NINT(P * 10.)
   9908          MOBS(3,1,LL) = IR(I,5)
   9909          IF(ICAT(LL).EQ.4.AND.NINT(ZP(I)).LT.IMISS)  THEN
   9910 C CAT. 4 LVL: STORE PRESSURE-ALT OBS (METERS), PREPBUFR TABLE VALUE,
   9911 C  AND R.C. IN WORD 2 OF MOBS WIND LEVEL
   9912             MOBS(1,2,LL) = NINT(ZP(I))
   9913             IMZ = 2
   9914             MOBS(3,2,LL) = IR(I,1)
   9915          END IF
   9916          IF(IFLUA.EQ.1)  THEN
   9917             IF(IMP.LE.3.OR.IMP.GT.15) IMP = 15
   9918             IF(IMZ.LE.3.OR.IMZ.GT.15) IMZ = 15
   9919             IF(IMW.LE.3.OR.IMW.GT.15) IMW = 15
   9920          END IF
   9921 C STORE P, Z, W PREPBUFR TABLE VALUES IN WORDS 1-4 OF MOBS WIND LEVEL
   9922          MOBS(2,1,LL) = IMP
   9923          MOBS(2,2,LL) = IMZ
   9924          MOBS(2,3,LL) = IMW
   9925          MOBS(2,4,LL) = IMW
   9926          JU = NINT(UP(I) * 100.)
   9927          JV = NINT(VP(I) * 100.)
   9928 C ACCEPTABLE PREPBUFR TABLE VALUE FOR WIND DEPENDS ON IQMLIM VALUE
   9929          IF(IQ(I,4).LT.IQMLIM)  THEN
   9930             IF(JU.LT.32767.AND.JV.LT.32767)  THEN

Page 230         Source Listing                  STOROB
2017-04-18 11:09                                 prepdata.f

   9931 C STORE U-COMP OBS (*100 M/SEC) AND R.C. IN WORD 3 OF MOBS WIND LEVEL
   9932                MOBS(1,3,LL) = JU
   9933                MOBS(3,3,LL) = IR(I,4)
   9934 C STORE V-COMP OBS (*100 M/SEC) AND R.C. IN WORD 4 OF MOBS WIND LEVEL
   9935                MOBS(1,4,LL) = JV
   9936                MOBS(3,4,LL) = IR(I,4)
   9937             END IF
   9938             CALL CMDDFF(UP(I),VP(I),DD,FF)
   9939             JDD = NINT(DD)
   9940             JFF = NINT(FF)
   9941             IF(MAX(JDD,JFF).LT.32767)  THEN
   9942 C STORE WIND DIRECTION (DEGREES) IN WORD 5 OF MOBS WIND LEVEL
   9943 C STORE WIND SPEED (KNOTS) IN WORD 6 OF MOBS WIND LEVEL
   9944                MOBS(1,5,LL) = JDD
   9945                MOBS(1,6,LL) = JFF
   9946             END IF
   9947          END IF
   9948          IF(ICALLM.EQ.0)  THEN
   9949             IF(HDR(6).EQ.220.OR.HDR(6).EQ.221)  THEN
   9950 C.......................................................................
   9951 C              WIND REPORT BALLOON DRIFT PROCESSING
   9952 C      -- ONLY IF MASS PIECE NOT PROCESSED FOR THIS REPORT --
   9953 C (FILL INTO DFTLAT/DFTLON AND DFTTIM ARRAYS - LATER ENCODED INTO WIND
   9954 C           WIND PIECE FOR THIS REPORT IN PREPBUFR FILE)
   9955 C (NOTE: DFTLAT/DFTLON AND DFTTIM ALREADY FILLED IF MASS PIECE WAS
   9956 C        PROCESSED SO DON'T HAVE TO REPEAT HERE FOR WIND PIECE)
   9957 C.......................................................................
   9958                CALL BALLOON_DRIFT(IPRT,I,PSTA,LL)
   9959             END IF
   9960          END IF
   9961       ENDDO
   9962 C FOLLOWING SHOULD NEVER BE SATISFIED (LL AT LEAST 1)!!!!!
   9963       IF(LL.EQ.0)  THEN
   9964          IF(ICALLM.EQ.0)  THEN
   9965             PRINT 9955, STNID,RDATA(1),RDATA(2),IDATA(9)
   9966  9955 FORMAT(' * * TOTAL REPORT TOSSED  -ID=',A8,', LAT=',F7.2,'N, ',
   9967      $ 'LON=',F8.2,'E, RTYP',I4,' - REASON YET TO BE DETERMINED')
   9968             RETURN 1
   9969          ELSE
   9970 C MASS & WIND PIECES BOTH CALC., ALL DONE, RETURN
   9971             RETURN
   9972          END IF
   9973       END IF
   9974 C SET REPORT SEQ. NUMBER TO "ISQNUM_UPA" AND STORE IN HDR(11) IF A
   9975 C  RADIOSONDE, PIBAL, DROPWINSONDE OR CLASS REPORT IN ADPUPA FILE
   9976       IF(NFILE.EQ.IUNIT(5))  HDR(11) = ISQNUM_UPA
   9977       CALL FILLX(LL,IERF)
   9978       LL_WIND = LL
   9979       IF(LL_WIND.NE.LL_MASS.AND.LL_MASS.GT.0)  THEN
   9980          PRINT 9823, STNID,LL_MASS,LL_WIND
   9981  9823 FORMAT(/10X,'-->  WARNING: ID ',A8,' HAS ',I4,' MASS LEVELS AND ',
   9982      $ I4,' WIND LEVELS - THESE SHOULD BE THE SAME AT THIS POINT!!!'/)
   9983          CALL SYSTEM('[ -n "$jlogfile" ] && $DATA/postmsg'//
   9984      $    ' "$jlogfile" "***WARNING: ID='//STNID//' HAS DIFFERENT '//
   9985      $    'NUMBER OF MASS AND WIND LEVELS AT POINT WHERE THEY SHOULD '//
   9986      $    'BE THE SAME"')
   9987       END IF

Page 231         Source Listing                  STOROB
2017-04-18 11:09                                 prepdata.f

   9988 C***********************************************************************
   9989       RETURN
   9990       END


ENTRY POINTS

  Name               
                     
 storob_             


SYMBOL CROSS REFERENCE

 Name                       Object Declared Type            Bytes Dimen Elements Attributes       References                        
                                                                                                                                    
 1080                       Label  9798                                                           9600                              
 6415                       Label  9717                                                           9716                              
 6515                       Label  9899                                                           9898                              
 6599                       Label  9850                                                           9849                              
 68                         Label  9779                                                           9605                              
 71                         Label  9781                                                           9780                              
 87                         Label  9796                                                           9795                              
 8765                       Label  9687                                                           9661,9670                         
 88                         Label  9805                                                           9804                              
 9515                       Label  9866                                                           9865                              
 9823                       Label  9981                                                           9980                              
 9954                       Label  9811                                                           9810                              
 9955                       Label  9966                                                           9965                              
 ADP                        Common 9522                                 14100                                                       
 ADPTYP                     Local  9514     CHAR            8           scalar                    9553,9590,9592,9594,9598,9602,9795
                                                                                                  ,9804                             
 ALAT_8                     Scalar 9518     R(8)            8           scalar   COM                                                
 ALON_8                     Scalar 9518     R(8)            8           scalar   COM                                                
 BALLOON_DRIFT              Subr   9766                                                           9766,9958                         
 BMISS                      Scalar 9518     R(8)            8           scalar   COM              9789,9790                         
 BUFRLIB_MISSING            Common 9535                                 8                                                           
 CMDDFF                     Subr   9938                                                           9938                              
 CWINDO                     Scalar 9528     R(4)            4           scalar   COM                                                
 DAT                        Scalar 9523     R(4)            4     2     9600     COM                                                
 DATA                       Common 9524                                 32                                                          
 DD                         Local  9938     R(4)            4           scalar                    9938,9939                         
 DIRECT                     Common 9533                                 36016                                                       
 DP                         Scalar 9517     R(4)            4     1     600      COM              9656,9660,9666,9671               
 ES                         Local  9541     R(4)            4           scalar                    9542                              
 EXP                        Func   9541                                 scalar                    9541                              
 FF                         Local  9938     R(4)            4           scalar                    9938,9940                         
 FILLM                      Scalar 9528     R(4)            4           scalar   COM                                                
 FILLT                      Scalar 9528     R(4)            4           scalar   COM                                                
 FILLW                      Scalar 9528     R(4)            4           scalar   COM                                                
 FILLX                      Subr   9773                                                           9773,9977                         
 FILLZ                      Scalar 9528     R(4)            4           scalar   COM                                                
 FLONVT                     Scalar 9530     R(4)            4           scalar   COM                                                
 FMESHL                     Scalar 9530     R(4)            4           scalar   COM                                                
 FPOLEI                     Scalar 9530     R(4)            4           scalar   COM                                                
 FPOLEJ                     Scalar 9530     R(4)            4           scalar   COM                                                
 FWINDO                     Scalar 9531     R(4)            4     1     12       COM                                                

Page 232         Source Listing                  STOROB
2017-04-18 11:09 Symbol Table                    prepdata.f

 Name                       Object Declared Type            Bytes Dimen Elements Attributes       References                        
                                                                                                                                    
 HDR                        Scalar 9526     R(4)            4     1     14       COM              9760,9772,9837,9839,9841,9853,9949
                                                                                                  ,9976                             
 I                          Local  9563     I(4)            4           scalar                    9563,9564,9570,9571,9575,9577,9579
                                                                                                  ,9582,9584,9625,9628,9631,9632,963
                                                                                                  6,9640,9641,9644,9645,9646,9654,96
                                                                                                  56,9660,9661,9666,9668,9670,9671,9
                                                                                                  683,9690,9692,9694,9695,9696,9728,
                                                                                                  9730,9735,9743,9744,9751,9766,9857
                                                                                                  ,9860,9862,9865,9870,9873,9875,987
                                                                                                  6,9884,9885,9895,9898,9904,9908,99
                                                                                                  09,9912,9914,9926,9927,9929,9933,9
                                                                                                  936,9938,9958                     
 I2MANY_LVLS                Scalar 9527     I(4)            4           scalar   COM                                                
 ICALLM                     Local  9555     I(4)            4           scalar                    9555,9775,9786,9807,9948,9964     
 ICAT                       Scalar 9519     I(4)            4     1     600      COM              9612,9649,9651,9825,9878,9883,9888
                                                                                                  ,9891,9894,9909                   
 IDAT10                     Scalar 9524     I(4)            4           scalar   COM                                                
 IDATA                      Scalar 9516     I(4)            4     1     3500     COM              9589,9591,9593,9597,9601,9705,9716
                                                                                                  ,9737,9799,9803,9810,9839,9849,986
                                                                                                  5,9898,9965                       
 IDATE                      Scalar 9524     I(4)            4     1     4        COM                                                
 IERF                       Local  9773     I(4)            4           scalar                    9773,9774,9977                    
 IFLUA                      Scalar 9529     I(4)            4           scalar   COM              9699,9916                         
 IMISS                      Local  9538     I(4)            4           scalar                    9538,9610,9612,9629,9647,9681,9694
                                                                                                  ,9823,9825,9874,9909              
 IMP                        Local  9644     I(4)            4           scalar                    9644,9700,9712,9723,9873,9917,9922
 IMQ                        Local  9628     I(4)            4           scalar                    9628,9631,9636,9668,9703,9715,9726
 IMT                        Local  9646     I(4)            4           scalar                    9646,9702,9714,9725               
 IMW                        Local  9875     I(4)            4           scalar                    9875,9897,9898,9919,9924,9925     
 IMZ                        Local  9645     I(4)            4           scalar                    9645,9701,9713,9724,9874,9913,9918
                                                                                                  ,9923                             
 INDIAN                     Dummy  9504     I(4)            4           scalar   ARG,INOUT        9699,9780                         
 INTQ                       Local  9676     I(4)            4           scalar                    9676,9677,9681,9682               
 IP                         Local  9655     I(4)            4           scalar                    9655,9905                         
 IPRINT                     Scalar 9522     I(4)            4           scalar   COM              9780,9794,9803,9810               
 IPRT                       Dummy  9504     I(4)            4     1     2        ARG,INOUT        9543,9766,9958                    
 IQ                         Scalar 9516     I(4)            4     2     3000     COM              9564,9570,9571,9575,9577,9579,9582
                                                                                                  ,9584,9628,9631,9632,9636,9641,964
                                                                                                  4,9645,9646,9661,9668,9670,9692,97
                                                                                                  28,9860,9870,9873,9875,9876,9929  
 IQ1                        Local  9564     I(4)            4           scalar                    9564,9571,9573                    
 IQMLIM                     Local  9557     I(4)            4           scalar                    9557,9579,9582,9584,9589,9605,9636
                                                                                                  ,9661,9670,9692,9728,9794,9795,979
                                                                                                  9,9802,9804,9839,9860,9929        
 IR                         Scalar 9516     I(4)            4     2     3000     COM              9683,9690,9696,9735,9884,9885,9908
                                                                                                  ,9914,9933,9936                   
 ISATOB                     Scalar 9522     I(4)            4           scalar   COM              9570,9589,9626,9657,9670,9737,9802
 ISQNUM_UPA                 Scalar 9525     I(4)            4           scalar   COM              9552,9772,9976                    
 ITLAST                     Local  9559     I(4)            4           scalar                    9559,9582,9586                    
 IUNIT                      Scalar 9521     I(4)            4     1     28       COM              9552,9772,9976                    
 IWBEST                     Local  9562     I(4)            4           scalar                    9562,9577,9794,9799               
 IWLAST                     Local  9560     I(4)            4           scalar                    9560,9584,9586                    
 IZBEST                     Local  9561     I(4)            4           scalar                    9561,9573,9575,9589,9605,9794,9802
                                                                                                  ,9839                             
 IZLAST                     Local  9558     I(4)            4           scalar                    9558,9579,9586                    

Page 233         Source Listing                  STOROB
2017-04-18 11:09 Symbol Table                    prepdata.f

 Name                       Object Declared Type            Bytes Dimen Elements Attributes       References                        
                                                                                                                                    
 JCAT                       Local  9629     I(4)            4           scalar                    9629,9632,9647,9649,9651,9876,9878
                                                                                                  ,9879,9880,9886                   
 JDD                        Local  9939     I(4)            4           scalar                    9939,9941,9944                    
 JFF                        Local  9940     I(4)            4           scalar                    9940,9941,9945                    
 JSURFM                     Scalar 9531     I(4)            4     1     12       COM              9706                              
 JSURFW                     Scalar 9531     I(4)            4     1     12       COM                                                
 JU                         Local  9926     I(4)            4           scalar                    9926,9930,9932                    
 JV                         Local  9927     I(4)            4           scalar                    9927,9930,9935                    
 KOUNT                      Scalar 9524     I(4)            4           scalar   COM              9813                              
 KTEMP                      Scalar 9515     L(4)            4           scalar   COM              9575,9582                         
 LEVPM                      Scalar 9525     I(4)            4           scalar   COM                                                
 LEVQQ                      Scalar 9525     I(4)            4           scalar   COM                                                
 LEVST                      Scalar 9525     I(4)            4           scalar   COM                                                
 LFMAXI                     Scalar 9530     I(4)            4           scalar   COM                                                
 LFMAXJ                     Scalar 9530     I(4)            4           scalar   COM                                                
 LFMSFC                     Common 9530                                 224                                                         
 LL                         Local  9616     I(4)            4           scalar                    9616,9643,9649,9651,9672,9682,9683
                                                                                                  ,9689,9690,9695,9696,9723,9724,972
                                                                                                  5,9726,9734,9735,9757,9766,9769,97
                                                                                                  73,9776,9829,9872,9878,9883,9888,9
                                                                                                  891,9894,9907,9908,9909,9912,9914,
                                                                                                  9922,9923,9924,9925,9932,9933,9935
                                                                                                  ,9936,9944,9945,9958,9963,9977,997
                                                                                                  8                                 
 LL_MASS                    Local  9550     I(4)            4           scalar                    9550,9776,9979,9980               
 LL_WIND                    Local  9551     I(4)            4           scalar                    9551,9978,9979,9980               
 LSMASS                     Scalar 9528     I(4)            4           scalar   COM              9600                              
 LSWIND                     Scalar 9528     I(4)            4           scalar   COM              9800,9802                         
 MARLND                     Scalar 9530     I(4)            4           scalar   COM                                                
 MAX                        Func   9586                                 scalar                    9586,9640,9862,9941               
 MAXOBS                     Param  9512     I(4)            4           scalar                    9516,9522                         
 MIN                        Func   9573                                 scalar                    9573,9575,9577,9636,9860          
 MOBS                       Scalar 9520     I(4)            4     3     10800    COM              9610,9621,9622,9672,9682,9683,9689
                                                                                                  ,9690,9695,9696,9723,9724,9725,972
                                                                                                  6,9734,9735,9757,9823,9834,9835,99
                                                                                                  07,9908,9912,9914,9922,9923,9924,9
                                                                                                  925,9932,9933,9935,9936,9944,9945 
 MOD                        Func   9570                                 scalar                    9570,9649                         
 MODPRT                     Scalar 9529     I(4)            4           scalar   COM                                                
 MP_PROCESS                 Scalar 9524     I(4)            4           scalar   COM                                                
 MXBLVL                     Param  9511     I(4)            4           scalar                    9533                              
 MXLVL                      Param  9508     I(4)            4           scalar                    9516,9517,9519,9520,9523          
 MXTYPV                     Param  9506     I(4)            4           scalar                    9520                              
 MXWRDH                     Param  9505     I(4)            4           scalar                    9526                              
 MXWRDL                     Param  9507     I(4)            4           scalar                    9520                              
 NFILE                      Scalar 9521     I(4)            4           scalar   COM              9552,9772,9976                    
 NINT                       Func   9621                                 scalar                    9621,9640,9655,9672,9676,9689,9694
                                                                                                  ,9695,9706,9731,9734,9757,9834,983
                                                                                                  9,9862,9895,9905,9907,9909,9912,99
                                                                                                  26,9927,9939,9940                 
 NLEV                       Dummy  9504     I(4)            4           scalar   ARG,INOUT        9563,9586,9625,9857               
 NOBS3                      Scalar 9533     I(4)            4     1     7        COM              9791                              
 NPKRPT                     Scalar 9531     I(4)            4     1     12       COM                                                
 NPZ                        Scalar 9528     I(4)            4           scalar   COM              9885                              
 NUMDAT                     Param  9510     I(4)            4           scalar                    9523                              

Page 234         Source Listing                  STOROB
2017-04-18 11:09 Symbol Table                    prepdata.f

 Name                       Object Declared Type            Bytes Dimen Elements Attributes       References                        
                                                                                                                                    
 NUMOBS2                    Param  9513     I(4)            4           scalar                    9533,9789                         
 NUMQMS                     Param  9509     I(4)            4           scalar                    9510,9516,9539                    
 NUMVAR                     Param  9509     I(4)            4           scalar                    9510,9537,9539                    
 OBS2                       Scalar 9533     R(4)            4     1     43       COM              9789                              
 OBS3                       Scalar 9533     R(4)            4     3     8925     COM              9790                              
 OBS8_8                     Scalar 9518     R(8)            8     1     2        COM                                                
 P                          Local  9654     R(4)            4           scalar                    9654,9655,9666,9689,9706,9904,9905
                                                                                                  ,9907                             
 PARM2                      Common 9527                                 12                                                          
 PARM5                      Common 9528                                 32                                                          
 PARM6                      Common 9529                                 32                                                          
 PFRALT                     Scalar 9531     R(4)            4           scalar   COM                                                
 PFSWCH                     Common 9532                                 36                                                          
 PG4243                     Scalar 9527     R(4)            4           scalar   COM                                                
 PMAND                      Scalar 9522     R(4)            4     1     23       COM                                                
 PP                         Scalar 9517     R(4)            4     1     600      COM              9640,9654,9744,9862,9865,9904     
 PRFLER                     Scalar 9532     R(4)            4     1     4        COM                                                
 PROFILERINADPUPA           Scalar 9515     L(4)            4           scalar   COM              9842                              
 PSTA                       Dummy  9504     R(4)            4           scalar   ARG,INOUT        9619,9621,9640,9706,9766,9832,9834
                                                                                                  ,9862,9865,9958                   
 PWINDO                     Scalar 9532     R(4)            4     1     4        COM                                                
 Q                          Local  9653     R(4)            4           scalar                    9653,9660,9666,9674,9676,9741,9743
 QFRMTP                     Local  9542     R(4)            4           scalar                    9666                              
 RDATA                      Scalar 9522     R(4)            4     1     3500     COM              9716,9810,9849,9865,9898,9965     
 RDATA2                     Scalar 9533     R(4)            4     1     25       COM                                                
 RPTHDR                     Common 9526                                 88                                                          
 SNDATA                     Common 9523                                 38400                                                       
 SPCIAL                     Scalar 9525     R(4)            4           scalar   COM                                                
 STNID                      Scalar 9514     CHAR            8           scalar   COM              9546,9597,9716,9780,9795,9799,9803
                                                                                                  ,9804,9810,9849,9865,9898,9965,998
                                                                                                  0,9984                            
 STNPRT                     Scalar 9514     CHAR            8     1     3        COM                                                
 STOROB                     Subr   9504                                                                                             
 STRCTY                     Common 9519                                 2400                                                        
 STRMOB                     Common 9520                                 43200                                                       
 SUBSET_D                   Scalar 9514     CHAR            8           scalar   COM                                                
 SYSTEM                     Subr   9983                                                           9983                              
 TDLIM                      Scalar 9525     R(4)            4           scalar   COM                                                
 TDMAX                      Scalar 9525     R(4)            4           scalar   COM                                                
 TMPCEL                     Local  9671     R(4)            4           scalar                    9671,9672,9730,9731,9734,9756,9757
 TP                         Scalar 9517     R(4)            4     1     600      COM              9730,9743,9751                    
 TV                         Local  9743     R(4)            4           scalar                    9743,9744,9747                    
 TVIRT                      Local  9729     R(4)            4           scalar                    9729,9747,9751,9753,9756          
 UNITNO                     Common 9521                                 116                                                         
 UP                         Scalar 9517     R(4)            4     1     600      COM              9640,9862,9895,9898,9926,9938     
 UPALIM                     Common 9525                                 28                                                          
 VP                         Scalar 9517     R(4)            4     1     600      COM              9640,9862,9895,9898,9927,9938     
 WRMISS                     Scalar 9524     R(4)            4           scalar   COM                                                
 XMISS                      Local  9538     R(4)            4           scalar                    9538,9619,9641,9653,9666,9674,9729
                                                                                                  ,9741,9753,9832,9863              
 YMISS                      Local  9538     R(4)            4           scalar                    9538                              
 ZP                         Scalar 9517     R(4)            4     1     600      COM              9694,9695,9909,9912               

Page 235         Source Listing                  STOROB
2017-04-18 11:09                                 prepdata.f

   9991 C$$$  SUBPROGRAM DOCUMENTATION BLOCK
   9992 C
   9993 C SUBPROGRAM:    BALLOON_DRIFT
   9994 C   PRGMMR: KEYSER           ORG: NP22        DATE: 2006-08-17
   9995 C
   9996 C ABSTRACT: CALCULATES RADIOSONDE AND PIBAL BALLOON DRIFT LATITUDE/
   9997 C   LONGITUDE AND TIME ON A REPORTED LEVEL AND FILLS INTO ARRAYS
   9998 C   DFTLAT, DFTLON AND DFTTIM, RESPECTIVELY.  ACCEPTS INTEGRATED HEIGHT
   9999 C   AND INTERPOLATED WIND AS LONG AS THEY ARE NON-BAD.  THESE DATA WILL
  10000 C   LATER BE ENCODED INTO PREPBUFR FILE ON EACH REPORT LEVEL. THIS
  10001 C   SUBROUTINE IS CALLED ONCE FOR EACH LEVEL IN REPORT.
  10002 C
  10003 C PROGRAM HISTORY LOG:
  10004 C   UNKNOWN
  10005 C 2006-08-17  D. A. KEYSER -- ORIGINAL AUTHOR
  10006 C
  10007 C USAGE:    CALL BALLOON_DRIFT(IPRT,I,PSTA,LL)
  10008 C   INPUT ARGUMENT LIST:
  10009 C     IPRT     - 2-WORD SWITCH, DETAILED STD. O-PUT (UNIT 6) PRT OF RPT
  10010 C     I        - INDEX POINTING TO THE CURRENT REPORT LEVEL BEING
  10011 C              - READ IN SUBROUTINE STOROB (THE "DAT" ARRAY)
  10012 C     PSTA     - STATION PRESSURE (MB)
  10013 C     LL       - INDEX POINTING TO THE CURRENT REPORT LEVEL BEING
  10014 C              - GENERATED IN SUBROUTINE STOROB
  10015 C
  10016 C   OUTPUT FILES:
  10017 C     UNIT 06  - STANDARD OUTPUT PRINT
  10018 C
  10019 C REMARKS: CALLED BY SUBROUTINE 'STOROB'.
  10020 C
  10021 C ATTRIBUTES:
  10022 C   LANGUAGE: FORTRAN 90
  10023 C   MACHINE:  NCEP WCOSS
  10024 C
  10025 C$$$
  10026       SUBROUTINE BALLOON_DRIFT(IPRT,I,PSTA,LL)
  10027       PARAMETER (MXWRDH = 15)
  10028       PARAMETER (MXLVL = 600)
  10029       PARAMETER (NUMVAR = 6, NUMQMS = 5)
  10030       PARAMETER (NUMDAT = NUMVAR + (2 * NUMQMS))
  10031       PARAMETER (MAXOBS = 3500)
  10032       CHARACTER*8 STNID,SUBSET_d
  10033       INTEGER  IQ(MXLVL,NUMQMS),IDATA(MAXOBS),IPRT(2)
  10034       REAL  PP(MXLVL),ZP(MXLVL),TP(MXLVL),DP(MXLVL),UP(MXLVL),VP(MXLVL)
  10035       real(8)  alon_8,alat_8
  10036       COMMON/ADP/ISATOB,PMAND(23),RDATA(MAXOBS),IPRINT
  10037       COMMON/SNDATA/DAT(MXLVL,NUMDAT)
  10038       COMMON/RPTHDR/SUBSET_d,STNID,HDR(2:MXWRDH),alon_8,alat_8
  10039       COMMON/DRIFT/DFTLON(MXLVL),DFTLAT(MXLVL),DFTTIM(MXLVL)
  10040       COMMON/LAUNCH/ALNCH
  10041       COMMON/SBDRIFT/ZDRIFT(MXLVL),TDRIFT(MXLVL),TDRIFTLL(MXLVL),
  10042      $ UDRIFT(MXLVL),VDRIFT(MXLVL),XDRIFT(MXLVL),YDRIFT(MXLVL),
  10043      $ TDRIFT_LL(MXLVL),KFLAG(5),LFLAG(3),PLO,IFLTIM,JJ,II
  10044       EQUIVALENCE  (DAT,PP),(DAT(1,2),ZP),(DAT(1,3),TP),(DAT(1,4),DP),
  10045      $ (DAT(1,5),UP),(DAT(1,6),VP),(DAT(1,NUMVAR+1),IQ),(IDATA,RDATA)
  10046       DATA   XMISS/99999./,YMISS/99998.8/
  10047       DATA   PI/3.141592654/

Page 236         Source Listing                  BALLOON_DRIFT
2017-04-18 11:09                                 prepdata.f

  10048       DATA   ASCRT/5.0/      ! ASCENT RATE (IN M/SEC)
  10049       DATA   CON/8.9929E-06/ ! 180.0/(PI*RADIUS OF EARTH) (RADIUS IN M
  10050 
  10051       IF(LL.EQ.2)  THEN
  10052 C COME HERE FOR FIRST LEVEL OF A NEW REPORT "PIECE" {LL = 1 IS A META-
  10053 C  DATA LEVEL IDENTIFYING SURFACE PRESSURE (HOLDS ONLY PSFC*10)}
  10054          IF(IPRT(2).EQ.1)  THEN
  10055             IF(HDR(6).EQ.120)   THEN
  10056                PRINT'(1X)'
  10057                PRINT'(" WILL PERFORM BALLOON DRIFT CALC. IN MASS ",
  10058      $          "PIECE PROCESSING FOR STN. ",A)', STNID
  10059             ELSE
  10060                PRINT'(1X)'
  10061                PRINT'(" WILL PERFORM BALLOON DRIFT CALC. IN WIND ",
  10062      $          "PIECE PROCESSING FOR STN. ",A)', STNID
  10063             END IF
  10064          END IF
  10065          DFTLON = XMISS
  10066          DFTLAT = XMISS
  10067          DFTTIM = XMISS
  10068          ZDRIFT = XMISS
  10069          UDRIFT = XMISS
  10070          VDRIFT = XMISS
  10071          XDRIFT = XMISS
  10072          YDRIFT = XMISS
  10073          TDRIFT = XMISS
  10074          TDRIFT_LL = XMISS
  10075          TDRIFTLL = XMISS
  10076          PLO = PSTA
  10077          KFLAG = 0
  10078          LFLAG = 0
  10079          IFLTIM = 0
  10080          JJ = 0
  10081          II = 0
  10082       END IF
  10083 
  10084       IQ1 = IQ(I,1)
  10085       IF(IQ(I,1).EQ.16)  IQ1 = 3
  10086 C FOR PIBALS, ACCEPT ALL NON-MISSING HEIGHTS (EVEN STD. ATMOSPHERE)
  10087       IF(HDR(6).EQ.221)  IQ1 = 3
  10088       IQ4 = IQ(I,4)
  10089       IF(IQ(I,4).EQ.16)  IQ4 = 3
  10090 
  10091 C-----------------------------------------------------------------------
  10092 C                  BALLOON DRIFT TIME CALCULATION
  10093 C-----------------------------------------------------------------------
  10094       IF(IPRT(2).EQ.1)  THEN
  10095          PRINT'(1X)'
  10096          PRINT'(" - Level ", I0, "perform balloon drift TIME ",
  10097      $    "calculation")', I
  10098       END IF
  10099 cfix? IF((ZP(I).LT.YMISS.AND.IQ1.LT.4.AND.NINT(PSTA*10.).GE.
  10100       IF((ZP(I).LT.XMISS.AND.IQ1.LT.4.AND.NINT(PSTA*10.).GE.
  10101      $ NINT(PP(I)*10.)).AND.MAX(LFLAG(1),LFLAG(2),LFLAG(3)).EQ.0)  THEN
  10102 C .. BALLOON DRIFT TIME IS A FUNCTION OF MEASURED HEIGHT, IF HEIGHT IS
  10103 C     BELOW GROUND, HARDWIRE TO LAUNCH TIME; IF HEIGHT IS MISSING OR
  10104 C     BAD, OR IF ONE OR MORE BALLOON LAT/LON CALCULATION TESTS (BELOW)

Page 237         Source Listing                  BALLOON_DRIFT
2017-04-18 11:09                                 prepdata.f

  10105 C     HAVE FAILED ON SOME PREVIOUS LEVEL, SKIP DRIFT TIME CALC. AND
  10106 C     REVERT TO PREVIOUS LEVEL TIME VALUE
  10107 C     {NOTE: LEVELS ORIG. WITH MISSING HEIGHT ARE USED IF INTEGRATED
  10108 C            HEIGHT ON THAT LEVEL IS NON-BAD OR NON-MISSING (NON-
  10109 C            STANDARD ATMOSPHERE)}
  10110          IF(IPRT(2).EQ.1) PRINT'(" Level ",I0," at press ",G0," has ",
  10111      $    "valid height with non-bad q.m. and is above ground, also ",
  10112      $    "no lat/lon calc. tests have failed on some prev. lvl, ",
  10113      $    "proceed w/ drift time calc.")', I,PP(I)
  10114          JJ = JJ + 1
  10115          ZDRIFT(JJ) = ZP(I)
  10116          IF(JJ.GT.1)  THEN
  10117             TDRIFT(JJ) = TDRIFT(JJ-1) +
  10118      $       (ZDRIFT(JJ) - ZDRIFT(JJ-1))/ASCRT
  10119             IF(IFLTIM.EQ.1)  THEN
  10120 C .. ONE OR MORE BALLOON TIME CALCULATION TESTS HAVE FAILED ON SOME
  10121 C     PREVIOUS LEVEL - REVERT THIS LEVEL (AND LATER ALL ABOVE) TO
  10122 C     PREVIOUS LEVEL TIME VALUE
  10123                IF(IPRT(2).EQ.1) PRINT'(" IFLTIM = 1 - revert back to ",
  10124      $          "previous level drift time value")'
  10125                JJ = JJ - 1
  10126             ELSE  IF(TDRIFT(JJ)-TDRIFT(JJ-1).LT.0.0)  THEN
  10127 C .. NEGATIVE TIME DIFFERENCE BETWEEN LEVELS -
  10128 C     .. IF MAGNITUDE IS LESS THAN 5 SECONDS, ADD DIFFERENCE ON TO THIS
  10129 C        LEVEL AND CONTINUE DRFIT TIME CALCULATION
  10130 C     .. OTHERWISE, REVERT THIS LEVEL (AND LATER ALL ABOVE) TO PREVIOUS
  10131 C        LEVEL TIME VALUE
  10132 C        (NOTE: IN THIS LATTER CASE, BALLOON DRIFT LAT/LON REVERTS THIS
  10133 C               AND ALL LEVELS ABOVE TO PREVIOUS LEVEL LAT/LON VALUES
  10134 C               AS WELL)
  10135                IF(ABS(TDRIFT(JJ)-TDRIFT(JJ-1)).LT.5.0)  THEN
  10136                   PRINT 8495, STNID,RDATA(1),RDATA(2),IDATA(9),PP(I),
  10137      $             TDRIFT(JJ),TDRIFT(JJ-1)
  10138  8495 FORMAT(' * * BALLOON DRFT TIME ODD-ID=',A8,', LAT=',F7.2,'N, ',
  10139      $ 'LON=',F8.2,'E, RTYP',I4,' - AT PRESSURE',F6.1,'MB, DRFT TIME ',
  10140      $ '(=',F8.2,'SEC)'/6X,'< DRFT TIME ON LVL BELOW (=',F8.2,'SEC) -',
  10141      $ ' TRANSFER DRFT TIME FROM LVL BELOW TO THIS LVL & CONTINUE ',
  10142      $ 'PROC. DRFT LAT/LON/TIME')
  10143                   TDRIFT(JJ) = TDRIFT(JJ-1)
  10144                ELSE
  10145                   PRINT 8475, STNID,RDATA(1),RDATA(2),IDATA(9),PP(I),
  10146      $             TDRIFT(JJ),TDRIFT(JJ-1)
  10147  8475 FORMAT(' * * BALLOON DRFT TIME BAD-ID=',A8,', LAT=',F7.2,'N, ',
  10148      $ 'LON=',F8.2,'E, RTYP',I4,' - AT PRESSURE',F6.1,'MB, DRIFT TIME'/
  10149      $ 6X,'(=',F8.2,'SEC) < DRIFT TIME ON LEVEL BELOW (=',F8.2,'SEC) -',
  10150      $ ' TRANSFER DRFT LAT/LON/TIME FROM LVL BELOW TO THIS LVL AND ALL',
  10151      $ ' LVLS ABOVE')
  10152                   JJ = JJ - 1
  10153                   IFLTIM = 1
  10154                END IF
  10155             ELSE  IF(ABS(TDRIFT(JJ)-TDRIFT(JJ-1)).GT.3600.)  THEN
  10156 C .. > 1-HOUR TIME DIFFERENCE BETWEEN LEVELS - REVERT THIS LEVEL (AND
  10157 C     LATER ALL ABOVE) TO PREVIOUS LEVEL TIME VALUE
  10158 C     (NOTE: BALLOON DRIFT LAT/LON REVERTS THIS AND ALL LEVELS ABOVE TO
  10159 C            PREVIOUS LEVEL LAT/LON VALUES AS WELL)
  10160                PRINT 8476, STNID,RDATA(1),RDATA(2),IDATA(9),PP(I),
  10161      $          TDRIFT(JJ),TDRIFT(JJ-1)

Page 238         Source Listing                  BALLOON_DRIFT
2017-04-18 11:09                                 prepdata.f

  10162  8476 FORMAT(' * * BALLOON DRFT TIME BAD-ID=',A8,', LAT=',F7.2,'N, ',
  10163      $ 'LON=',F8.2,'E, RTYP',I4,' - AT PRESSURE',F6.1,'MB, DRIFT TIME ',
  10164      $ '(=',F8.2/6X,'SEC) > 1 HR DIFF. THAN DRFT TIME ON LEVEL BELOW ',
  10165      $ '(=',F8.2,'SEC) - TRANSF. DRFT LAT/LON/TIME FROM LVL BELOW TO ',
  10166      $ 'THIS LVL AND ALL LVLS ABOVE')
  10167                JJ = JJ - 1
  10168                IFLTIM = 1
  10169             END IF
  10170          ELSE
  10171 C .. IF THIS IS THE FIRST LEVEL IN THE PROFILE, RELATIVE BALLOON DRIFT
  10172 C     TIME IS SET TO ZERO
  10173             TDRIFT(1) = 0.0
  10174          END IF
  10175          IF(ALNCH.LT.YMISS)  THEN
  10176 C .. ABSOLUTE BALLOON DRIFT TIME IS OBTAINED BY ADDING RELATIVE DRIFT
  10177 C     TIME TO BASELINE TIME (LAUNCH TIME) - ON FIRST VALID LEVEL OF
  10178 C     PROFILE THIS IS JUST THE LAUNCH TIME (ABSOLUTE BALLOON DRIFT TIME
  10179 C     LATER ENCODED INTO PREPBUFR FILE)
  10180             DFTTIM(LL) = ALNCH + TDRIFT(JJ)/3600.
  10181             TDRIFTLL(LL) = TDRIFT(JJ)
  10182             IF(DFTTIM(LL).GE.24.) DFTTIM(LL) = DFTTIM(LL) - 24.
  10183          END IF
  10184          IF(IPRT(2).EQ.1)  PRINT'(" I,JJ,LL,PP(I),ZDRIFT(JJ),",
  10185      $    "TDRIFT(JJ),TDRIFTLL(LL),DFTTIM(LL): ",3(I0,1X),5(G0,1X))',
  10186      $    I,JJ,LL,PP(I),ZDRIFT(JJ),TDRIFT(JJ),TDRIFTLL(LL),DFTTIM(LL)
  10187       ELSE
  10188          IF(IPRT(2).EQ.1)  THEN
  10189             IF(MAX(LFLAG(1),LFLAG(2),LFLAG(3)).EQ.1)  THEN
  10190                PRINT'(" one of the LFLAGs = 1 - revert back to ",
  10191      $          "previous level drift time value")'
  10192             ELSE
  10193                PRINT'(" Lvl ",I0," at ",G0,"mb either has missing or ",
  10194      $          "bad hght or is < elev, set drft time to launch time ",
  10195      $          "(1st lvl) or to drft time from prev lvl")', I,PP(I)
  10196             END IF
  10197          END IF
  10198          IF(LL.GT.2)  THEN
  10199             DFTTIM(LL) = DFTTIM(LL-1)
  10200             TDRIFTLL(LL) = TDRIFTLL(LL-1)
  10201          ELSE
  10202 C .. IF THIS IS THE FIRST LEVEL IN THE PROFILE, BALLOON DRIFT TIME IS
  10203 C     SIMPLY SET TO REPORTED (OR GENERATED) LAUNCH TIME
  10204             IF(ALNCH.LT.YMISS)  DFTTIM(LL) = ALNCH
  10205             TDRIFTLL(LL) = 0
  10206          END IF
  10207          IF(IPRT(2).EQ.1)  PRINT'(" I,LL,PP(I),ZP(I),IQ1,PSTA,",
  10208      $    "TDRIFTLL(LL),DFTTIM(LL): ",2(I0,1X),2(G0,1X),I0,1X,
  10209      $    3(G0,1X))', I,LL,PP(I),ZP(I),IQ1,PSTA,TDRIFTLL(LL),DFTTIM(LL)
  10210       END IF
  10211 
  10212 C-----------------------------------------------------------------------
  10213 C                BALLOON DRIFT LAT/LON CALCULATION
  10214 C-----------------------------------------------------------------------
  10215       IF(IPRT(2).EQ.1)  THEN
  10216          PRINT'(1X)'
  10217          PRINT'(" - Level ", I0,"- perform balloon drift LAT/LON ",
  10218      $    "calculation")', I

Page 239         Source Listing                  BALLOON_DRIFT
2017-04-18 11:09                                 prepdata.f

  10219       END IF
  10220       IF(MAX(ZP(I),UP(I),VP(I)).LT.XMISS.AND.MAX(IQ1,IQ4).LT.4)  THEN
  10221 cfix? IF(MAX(ZP(I),UP(I),VP(I)).LT.YMISS.AND.MAX(IQ1,IQ4).LT.4)  THEN
  10222 C .. BALLOON DRIFT LAT/LON AND TIME IS A FUNCTION OF MEASURED HEIGHT
  10223 C     AND U/V WIND, IF ANY OF THESE ARE MISSING OR BAD, SKIP DRIFT CALC.
  10224 C     AND REVERT TO PREVIOUS LEVEL VALUES {NOTE: LEVELS ORIG. WITH
  10225 C     MISSING HEIGHT ARE USED IF INTEGRATED HEIGHT ON THAT LEVEL IS NON-
  10226 C     BAD OR NON-MISSING (NON-STANDARD ATMOSPHERE); LEVELS ORIG. WITH
  10227 C     MISSING WIND ARE USED IF INTERPOLATED WIND ON THAT LEVEL IS NON-
  10228 C     BAD}
  10229          IF(IPRT(2).EQ.1) PRINT'(" Level ",I0," at press ",G0," has ",
  10230      $    "valid height and wind with non-bad q.m. on each, proceed ",
  10231      $    "w/ drift lat/lon calc.")' ,I,PP(I)
  10232          II = II + 1
  10233          IF(KFLAG(1).EQ.0)  THEN
  10234             IF(PLO-PP(I).GE.150.)  THEN
  10235 C .. IF PRESSURE LAYER BETWEEN THIS VALID WIND LEVEL AND PREVIOUS VALID
  10236 C     WIND LEVEL BELOW > 150 MB, TRANFSER DRIFT LAT/LON FROM VALID LEVEL
  10237 C     BELOW TO THIS LEVEL AND ALL LEVELS ABOVE
  10238 C     (NOTE: DRIFT TIME IS STILL CALCULATED)
  10239                PRINT 6425, STNID,RDATA(1),RDATA(2),IDATA(9),PLO
  10240  6425 FORMAT(' * * VALID WND P-LYR>150MB-ID=',A8,', LAT=',F7.2,'N, ',
  10241      $ 'LON=',F8.2,'E, RTYP',I4,'-BALLOON DR. LAT/LON ON',F6.1,'MB ',
  10242      $ 'TRANSF. TO LVLS ABOVE (DRIFT TIME IS CALCULATED)')
  10243                KFLAG(1) = 1
  10244             END IF
  10245          END IF
  10246          UDRIFT(II) = UP(I)
  10247          VDRIFT(II) = VP(I)
  10248          TDRIFT_LL(II) = TDRIFTLL(LL)
  10249          IF(II.GT.1)  THEN
  10250             XDRIFT(II) = XDRIFT(II-1) +
  10251      $                    (0.5 * (UDRIFT(II-1) + UDRIFT(II)) *
  10252      $                    (TDRIFT_LL(II) - TDRIFT_LL(II-1))
  10253      $                    * CON/(COS(PI*YDRIFT(II-1)/180.)))
  10254             YDRIFT(II) = YDRIFT(II-1) +
  10255      $                    (0.5 * (VDRIFT(II-1) + VDRIFT(II)) *
  10256      $                    (TDRIFT_LL(II) - TDRIFT_LL(II-1)) * CON)
  10257             IF(IFLTIM.EQ.1)  THEN
  10258 C .. A PROBLEM IN THE BALLOON DRIFT TIME CALCULATION (ABOVE) MEANS THE
  10259 C     BALLOON DRIFT LAT/LON IS ALSO SUSPECT - REVERT THIS LEVEL (AND
  10260 C     LATER ALL ABOVE) TO PREVIOUS LEVEL LAT/LON VALUES
  10261                IF(IPRT(2).EQ.1) PRINT'(" IFLTIM = 1 - revert back to ",
  10262      $          "previous level drift lat/lon value")'
  10263                II = II - 1
  10264             ELSE  IF(MAX(KFLAG(1),KFLAG(2),KFLAG(3),KFLAG(4), KFLAG(5))
  10265      $       .EQ.1)  THEN
  10266 C .. ONE OR MORE BALLOON LAT/LON CALCULATION TESTS HAVE FAILED ON THIS
  10267 C     OR SOME PREVIOUS LEVEL - REVERT THIS LEVEL (AND LATER ALL ABOVE)
  10268 C     TO PREVIOUS LEVEL LAT/LON VALUES
  10269 C     (NOTE: DRIFT TIME MAY STILL BE CALCULATED DEPENDING UPON TEST)
  10270                IF(IPRT(2).EQ.1) PRINT'(" one of the KFLAGs = 1 - ",
  10271      $          "revert back to previous level drift lat/lon value")'
  10272                II = II - 1
  10273             ELSE  IF(STNID.EQ.'89009   ')  THEN
  10274 C .. SOUTH POLE STATION, CAN'T CALC. BALLOON DRIFT LAT/LON - REVERT THIS
  10275 C     LEVEL (AND LATER ALL ABOVE) TO PREVIOUS LEVEL LAT/LON VALUES

Page 240         Source Listing                  BALLOON_DRIFT
2017-04-18 11:09                                 prepdata.f

  10276 C     (NOTE: DRIFT TIME IS STILL CALCULATED)
  10277                PRINT 9425, STNID,RDATA(1),RDATA(2),IDATA(9)
  10278  9425 FORMAT(' * * BALLOON LAT/LON DRFT -ID=',A8,', LAT=',F7.2,'N, ',
  10279      $ 'LON=',F8.2,'E, RTYP',I4,' - NOT CALCULATED - REPORTED LAT/LON'/
  10280      $ 10X,'USED ON ALL LEVELS - SOUTH POLE STATION (DRIFT TIME IS ',
  10281      $ 'CALCULATED)')
  10282                II = II - 1
  10283                KFLAG(2) = 1
  10284             ELSE  IF(ABS(XDRIFT(II)-XDRIFT(II-1)).GT.1.0)  THEN
  10285 C .. "UNREASONABLE" CALCULATED BALLOON DRIFT LON - REVERT THIS LEVEL
  10286 C     (AND LATER ALL ABOVE) TO PREVIOUS LEVEL LAT/LON VALUES
  10287 C     (NOTE: BALLOON DRIFT TIME REVERTS THIS AND ALL LEVELS ABOVE TO
  10288 C            PREVIOUS LEVEL TIME VALUES AS WELL)
  10289                PRINT 8425, STNID,RDATA(1),RDATA(2),IDATA(9),PP(I),
  10290      $          XDRIFT(II),XDRIFT(II-1)
  10291  8425 FORMAT(' * * BALLOON DRFT LON BAD -ID=',A8,', LAT=',F7.2,'N, ',
  10292      $ 'LON=',F8.2,'E, RTYP',I4,' - AT PRESSURE',F6.1,'MB, DRIFT LON ',
  10293      $ '(=',F8.2,'E)'/6X,'> 1 DEG. DIFFERENT THAN DRIFT LON ON LEVEL ',
  10294      $ 'BELOW (=',F7.2,'E) - TRANSFER DRIFT LAT/LON/TIME FROM LVL ',
  10295      $ 'BELOW TO THIS LVL AND ALL LVLS ABOVE')
  10296                II = II - 1
  10297                KFLAG(3) = 1
  10298                LFLAG(1) = 1
  10299                IF(LL.GT.2)  THEN
  10300                   DFTTIM(LL) = DFTTIM(LL-1)
  10301                   TDRIFTLL(LL) = TDRIFTLL(LL-1)
  10302                ELSE
  10303                   IF(ALNCH.LT.YMISS)  DFTTIM(LL) = ALNCH
  10304                   TDRIFTLL(LL) = 0
  10305                END IF
  10306                IF(IPRT(2).EQ.1) PRINT'(" updated DFTTIM(LL),",
  10307      $          "TDRIFTLL(LL): ",G0,G0)',DFTTIM(LL),TDRIFTLL(LL)
  10308             ELSE  IF(ABS(YDRIFT(II)-YDRIFT(II-1)).GT.1.0)  THEN
  10309 C .. "UNREASONABLE" CALCULATED BALLOON DRIFT LAT - REVERT THIS LEVEL
  10310 C     (AND LATER ALL ABOVE) TO PREVIOUS LEVEL LAT/LON VALUES
  10311 C     (NOTE: BALLOON DRIFT TIME REVERTS THIS AND ALL LEVELS ABOVE TO
  10312 C            PREVIOUS LEVEL TIME VALUES AS WELL)
  10313                PRINT 8426, STNID,RDATA(1),RDATA(2),IDATA(9),PP(I),
  10314      $          YDRIFT(II),YDRIFT(II-1)
  10315  8426 FORMAT(' * * BALLOON DRFT LAT BAD -ID=',A8,', LAT=',F7.2,'N, ',
  10316      $ 'LON=',F8.2,'E, RTYP',I4,' - AT PRESSURE',F6.1,'MB, DRIFT LAT ',
  10317      $ '(=',F8.2,'N)'/6X,'> 1 DEG. DIFFERENT THAN DRIFT LAT ON LEVEL ',
  10318      $ 'BELOW (=',F6.2,'N) - TRANSFER DRIFT LAT/LON/TIME FROM LVL ',
  10319      $ 'BELOW TO THIS LVL AND ALL LVLS ABOVE')
  10320                II = II - 1
  10321                KFLAG(4) = 1
  10322                LFLAG(2) = 1
  10323                IF(LL.GT.2)  THEN
  10324                   DFTTIM(LL) = DFTTIM(LL-1)
  10325                   TDRIFTLL(LL) = TDRIFTLL(LL-1)
  10326                ELSE
  10327                   IF(ALNCH.LT.YMISS)  DFTTIM(LL) = ALNCH
  10328                   TDRIFTLL(LL) = 0
  10329                END IF
  10330                IF(IPRT(2).EQ.1) PRINT'(" updated DFTTIM(LL),",
  10331      $          "TDRIFTLL(LL): ",G0,G0)', DFTTIM(LL),TDRIFTLL(LL)
  10332             ELSE  IF(ABS(YDRIFT(II)).GT.90.0)  THEN

Page 241         Source Listing                  BALLOON_DRIFT
2017-04-18 11:09                                 prepdata.f

  10333 C .. CALCULATED BALLOON DRIFT ABS(LAT) IS > 90 DEG. - REVERT THIS LEVEL
  10334 C     (AND LATER ALL ABOVE) TO PREVIOUS LEVEL LAT/LON VALUES
  10335 C     (NOTE: BALLOON DRIFT TIME REVERTS THIS AND ALL LEVELS ABOVE TO
  10336 C            PREVIOUS LEVEL TIME VALUES AS WELL)
  10337                PRINT 8427, STNID,RDATA(1),RDATA(2),IDATA(9),PP(I),
  10338      $          YDRIFT(II)
  10339  8427 FORMAT(' * * BALLOON DRFT LAT BAD -ID=',A8,', LAT=',F7.2,'N, ',
  10340      $ 'LON=',F8.2,'E, RTYP',I4,' - AT PRESSURE',F6.1,'MB, DRIFT LAT ',
  10341      $ '(=',F8.2,'N)'/6X,'FAILS GROSS CHECK - TRANSFER DRIFT LAT/LON/',
  10342      $ 'TIME FROM LVL BELOW TO THIS LVL AND ALL LVLS ABOVE')
  10343                II = II - 1
  10344                KFLAG(5) = 1
  10345                LFLAG(3) = 1
  10346                IF(LL.GT.2)  THEN
  10347                   DFTTIM(LL) = DFTTIM(LL-1)
  10348                   TDRIFTLL(LL) = TDRIFTLL(LL-1)
  10349                ELSE
  10350                   IF(ALNCH.LT.YMISS)  DFTTIM(LL) = ALNCH
  10351                   TDRIFTLL(LL) = 0
  10352                END IF
  10353                IF(IPRT(2).EQ.1) PRINT'(" updated DFTTIM(LL),",
  10354      $          "TDRIFTLL(LL): ",G0,G0)', DFTTIM(LL),TDRIFTLL(LL)
  10355             ELSE
  10356 C .. FOR NEWLY CALCULATED BALLOON DRIFT LAT/LON, ACCOUNT FOR BALLOON
  10357 C     CROSSING GREENWICH
  10358                XDRIFT(II) = MOD(XDRIFT(II)+360.0,360.0)
  10359                IF(NINT(XDRIFT(II)*100.).GT.35999)  XDRIFT(II) = 0.
  10360                PLO = PP(I)
  10361             END IF
  10362          ELSE
  10363 C .. IF THIS IS THE FIRST LEVEL IN THE PROFILE, BALLOON DRIFT LAT/LON
  10364 C     IS SET TO REPORTED LAT/LON
  10365             XDRIFT(1) = alon_8
  10366             YDRIFT(1) = alat_8
  10367          END IF
  10368 C .. STORE BALLOON DRIFT LAT/LON ON THIS LEVEL (LATER ENCODED INTO
  10369 C     PREPBUFR FILE)
  10370          DFTLON(LL) = XDRIFT(II)
  10371          DFTLAT(LL) = YDRIFT(II)
  10372          IF(IPRT(2).EQ.1)  THEN
  10373             PRINT'(" I,LL,II,PP(I),UDRIFT(II),VDRIFT(II),",
  10374      $       "TDRIFT_LL(II),DFTLON(LL),DFTLAT(LL): ",3(I0,1X),
  10375      $       6(G0,1X))', I,LL,II,PP(I),UDRIFT(II),VDRIFT(II),
  10376      $       TDRIFT_LL(II),DFTLON(LL),DFTLAT(LL)
  10377          END IF
  10378       ELSE
  10379          IF(IPRT(2).EQ.1) PRINT'(" Lvl ",I0," at ",G0,"mb either ",
  10380      $    "has missing or bad hght or wind, set drft lat/lon to rpt ",
  10381      $    "lat/lon (1st lvl) or to drft lat/lon from prev lvl")',
  10382      $    I,PP(I)
  10383          IF(LL.GT.2)  THEN
  10384             DFTLON(LL) = DFTLON(LL-1)
  10385             DFTLAT(LL) = DFTLAT(LL-1)
  10386          ELSE
  10387 C .. IF THIS IS THE FIRST LEVEL IN THE PROFILE, BALLOON DRIFT LAT/LON
  10388 C     IS SET TO REPORTED LAT/LON
  10389             DFTLON(LL) = alon_8

Page 242         Source Listing                  BALLOON_DRIFT
2017-04-18 11:09                                 prepdata.f

  10390             DFTLAT(LL) = alat_8
  10391          END IF
  10392          IF(IPRT(2).EQ.1) PRINT'(" I,LL,PP(I),ZP(I),UP(I),VP(I),IQ1,IQ4,
  10393      $    DFTLON(LL),DFTLAT(LL): ",2(I0,1X),4(G0,1X),2(I0,1X),
  10394      $    2(G0,1X))',
  10395      $    I,LL,PP(I),ZP(I),UP(I),VP(I),IQ1,IQ4,DFTLON(LL),DFTLAT(LL)
  10396       END IF
  10397 
  10398       RETURN
  10399       END


ENTRY POINTS

  Name                      
                            
 balloon_drift_             


SYMBOL CROSS REFERENCE

 Name                       Object Declared Type            Bytes Dimen Elements Attributes       References                        
                                                                                                                                    
 6425                       Label  10240                                                          10239                             
 8425                       Label  10291                                                          10289                             
 8426                       Label  10315                                                          10313                             
 8427                       Label  10339                                                          10337                             
 8475                       Label  10147                                                          10145                             
 8476                       Label  10162                                                          10160                             
 8495                       Label  10138                                                          10136                             
 9425                       Label  10278                                                          10277                             
 ABS                        Func   10135                                scalar                    10135,10155,10284,10308,10332     
 ADP                        Common 10036                                14100                                                       
 ALAT_8                     Scalar 10035    R(8)            8           scalar   COM              10366,10390                       
 ALNCH                      Scalar 10040    R(4)            4           scalar   COM              10175,10180,10204,10303,10327,1035
                                                                                                  0                                 
 ALON_8                     Scalar 10035    R(8)            8           scalar   COM              10365,10389                       
 ASCRT                      Local  10048    R(4)            4           scalar                    10048,10118                       
 BALLOON_DRIFT              Subr   10026                                                                                            
 CON                        Local  10049    R(4)            4           scalar                    10049,10253,10256                 
 COS                        Func   10253                                scalar                    10253                             
 DAT                        Scalar 10037    R(4)            4     2     9600     COM                                                
 DFTLAT                     Scalar 10039    R(4)            4     1     600      COM              10066,10371,10376,10385,10390,1039
                                                                                                  5                                 
 DFTLON                     Scalar 10039    R(4)            4     1     600      COM              10065,10370,10376,10384,10389,1039
                                                                                                  5                                 
 DFTTIM                     Scalar 10039    R(4)            4     1     600      COM              10067,10180,10182,10186,10199,1020
                                                                                                  4,10209,10300,10303,10307,10324,10
                                                                                                  327,10331,10347,10350,10354       
 DP                         Scalar 10034    R(4)            4     1     600      COM                                                
 DRIFT                      Common 10039                                7200                                                        
 HDR                        Scalar 10038    R(4)            4     1     14       COM              10055,10087                       
 I                          Dummy  10026    I(4)            4           scalar   ARG,INOUT        10084,10085,10088,10089,10097,1010
                                                                                                  0,10101,10113,10115,10136,10145,10
                                                                                                  160,10186,10195,10209,10218,10220,
                                                                                                  10231,10234,10246,10247,10289,1031
                                                                                                  3,10337,10360,10375,10382,10395   

Page 243         Source Listing                  BALLOON_DRIFT
2017-04-18 11:09 Symbol Table                    prepdata.f

 Name                       Object Declared Type            Bytes Dimen Elements Attributes       References                        
                                                                                                                                    
 IDATA                      Scalar 10033    I(4)            4     1     3500     COM              10136,10145,10160,10239,10277,1028
                                                                                                  9,10313,10337                     
 IFLTIM                     Scalar 10043    I(4)            4           scalar   COM              10079,10119,10153,10168,10257     
 II                         Scalar 10043    I(4)            4           scalar   COM              10081,10232,10246,10247,10248,1024
                                                                                                  9,10250,10251,10252,10253,10254,10
                                                                                                  255,10256,10263,10272,10282,10284,
                                                                                                  10290,10296,10308,10314,10320,1033
                                                                                                  2,10338,10343,10358,10359,10370,10
                                                                                                  371,10375,10376                   
 IPRINT                     Scalar 10036    I(4)            4           scalar   COM                                                
 IPRT                       Dummy  10026    I(4)            4     1     2        ARG,INOUT        10054,10094,10110,10123,10184,1018
                                                                                                  8,10207,10215,10229,10261,10270,10
                                                                                                  306,10330,10353,10372,10379,10392 
 IQ                         Scalar 10033    I(4)            4     2     3000     COM              10084,10085,10088,10089           
 IQ1                        Local  10084    I(4)            4           scalar                    10084,10085,10087,10100,10209,1022
                                                                                                  0,10395                           
 IQ4                        Local  10088    I(4)            4           scalar                    10088,10089,10220,10395           
 ISATOB                     Scalar 10036    I(4)            4           scalar   COM                                                
 JJ                         Scalar 10043    I(4)            4           scalar   COM              10080,10114,10115,10116,10117,1011
                                                                                                  8,10125,10126,10135,10137,10143,10
                                                                                                  146,10152,10155,10161,10167,10180,
                                                                                                  10181,10186                       
 KFLAG                      Scalar 10043    I(4)            4     1     5        COM              10077,10233,10243,10264,10283,1029
                                                                                                  7,10321,10344                     
 LAUNCH                     Common 10040                                4                                                           
 LFLAG                      Scalar 10043    I(4)            4     1     3        COM              10078,10101,10189,10298,10322,1034
                                                                                                  5                                 
 LL                         Dummy  10026    I(4)            4           scalar   ARG,INOUT        10051,10180,10181,10182,10186,1019
                                                                                                  8,10199,10200,10204,10205,10209,10
                                                                                                  248,10299,10300,10301,10303,10304,
                                                                                                  10307,10323,10324,10325,10327,1032
                                                                                                  8,10331,10346,10347,10348,10350,10
                                                                                                  351,10354,10370,10371,10375,10376,
                                                                                                  10383,10384,10385,10389,10390,1039
                                                                                                  5                                 
 MAX                        Func   10101                                scalar                    10101,10189,10220,10264           
 MAXOBS                     Param  10031    I(4)            4           scalar                    10033,10036                       
 MOD                        Func   10358                                scalar                    10358                             
 MXLVL                      Param  10028    I(4)            4           scalar                    10033,10034,10037,10039,10041,1004
                                                                                                  2,10043                           
 MXWRDH                     Param  10027    I(4)            4           scalar                    10038                             
 NINT                       Func   10100                                scalar                    10100,10101,10359                 
 NUMDAT                     Param  10030    I(4)            4           scalar                    10037                             
 NUMQMS                     Param  10029    I(4)            4           scalar                    10030,10033                       
 NUMVAR                     Param  10029    I(4)            4           scalar                    10030,10045                       
 PI                         Local  10047    R(4)            4           scalar                    10047,10253                       
 PLO                        Scalar 10043    R(4)            4           scalar   COM              10076,10234,10239,10360           
 PMAND                      Scalar 10036    R(4)            4     1     23       COM                                                
 PP                         Scalar 10034    R(4)            4     1     600      COM              10101,10113,10136,10145,10160,1018
                                                                                                  6,10195,10209,10231,10234,10289,10
                                                                                                  313,10337,10360,10375,10382,10395 
 PSTA                       Dummy  10026    R(4)            4           scalar   ARG,INOUT        10076,10100,10209                 
 RDATA                      Scalar 10036    R(4)            4     1     3500     COM              10136,10145,10160,10239,10277,1028
                                                                                                  9,10313,10337                     
 RPTHDR                     Common 10038                                88                                                          

Page 244         Source Listing                  BALLOON_DRIFT
2017-04-18 11:09 Symbol Table                    prepdata.f

 Name                       Object Declared Type            Bytes Dimen Elements Attributes       References                        
                                                                                                                                    
 SBDRIFT                    Common 10041                                19248                                                       
 SNDATA                     Common 10037                                38400                                                       
 STNID                      Scalar 10032    CHAR            8           scalar   COM              10058,10062,10136,10145,10160,1023
                                                                                                  9,10273,10277,10289,10313,10337   
 SUBSET_D                   Scalar 10032    CHAR            8           scalar   COM                                                
 TDRIFT                     Scalar 10041    R(4)            4     1     600      COM              10073,10117,10126,10135,10137,1014
                                                                                                  3,10146,10155,10161,10173,10180,10
                                                                                                  181,10186                         
 TDRIFTLL                   Scalar 10041    R(4)            4     1     600      COM              10075,10181,10186,10200,10205,1020
                                                                                                  9,10248,10301,10304,10307,10325,10
                                                                                                  328,10331,10348,10351,10354       
 TDRIFT_LL                  Scalar 10043    R(4)            4     1     600      COM              10074,10248,10252,10256,10376     
 TP                         Scalar 10034    R(4)            4     1     600      COM                                                
 UDRIFT                     Scalar 10042    R(4)            4     1     600      COM              10069,10246,10251,10375           
 UP                         Scalar 10034    R(4)            4     1     600      COM              10220,10246,10395                 
 VDRIFT                     Scalar 10042    R(4)            4     1     600      COM              10070,10247,10255,10375           
 VP                         Scalar 10034    R(4)            4     1     600      COM              10220,10247,10395                 
 XDRIFT                     Scalar 10042    R(4)            4     1     600      COM              10071,10250,10284,10290,10358,1035
                                                                                                  9,10365,10370                     
 XMISS                      Local  10046    R(4)            4           scalar                    10046,10065,10066,10067,10068,1006
                                                                                                  9,10070,10071,10072,10073,10074,10
                                                                                                  075,10100,10220                   
 YDRIFT                     Scalar 10042    R(4)            4     1     600      COM              10072,10253,10254,10308,10314,1033
                                                                                                  2,10338,10366,10371               
 YMISS                      Local  10046    R(4)            4           scalar                    10046,10175,10204,10303,10327,1035
                                                                                                  0                                 
 ZDRIFT                     Scalar 10041    R(4)            4     1     600      COM              10068,10115,10118,10186           
 ZP                         Scalar 10034    R(4)            4     1     600      COM              10100,10115,10209,10220,10395     

Page 245         Source Listing                  BALLOON_DRIFT
2017-04-18 11:09                                 prepdata.f

  10400 C$$$  SUBPROGRAM DOCUMENTATION BLOCK
  10401 C
  10402 C SUBPROGRAM:    FILLX
  10403 C   PRGMMR: Keyser           ORG: NP22        DATE: 2016-11-30
  10404 C
  10405 C ABSTRACT: SENDS EACH FILLED REPORT PASSED IN THROUGH "HDR/MOBS/
  10406 C   IPMSL/PWAT/xRAD/REQV/CLTOP" ARRAYS TO PREPBUFR ENCODER
  10407 C   (SUBROUTINE W3FIZZ), AND ACCUMULATES COUNTS BY PREPBUFR REPORT
  10408 C   TYPE.  THIS SUBROUTINE ALSO CAN PRINT SOME FILLED DATA REPORTS IN
  10409 C   THE "HDR/MOBS/IPMSL/PWAT/xRAD/REQV/CLTOP" ARRAYS TO STANDARD
  10410 C   OUTPUT (BASED ON THE VALUE OF 'MODPRT').
  10411 C
  10412 C PROGRAM HISTORY LOG:
  10413 C   UNKNOWN
  10414 C 1987-03-10  D. A. KEYSER -- OLD SUBR. 'FILLX' AND 'FILLXX' COMBINED
  10415 C 1988-04-11  D. A. KEYSER -- DOCBLOCKING/COMMENTING
  10416 C 1990-01-11  D. A. KEYSER -- CONVERTED TO VS FORTRAN(77)
  10417 C 1991-01-03  D. A. KEYSER -- NO LONGER NEED TO WRITE OUT 72-RECORDS FOR
  10418 C    AVN PREPDA FILE, REMOVED FROM CODE
  10419 C 1992-07-09  D. A. KEYSER -- INCR. MAX. NO. BYTES WRITTEN TO PREPDA
  10420 C    FILE FROM 5200K TO 10000K W/ STOP 89 (& LOG MSG.) IF EXCEEDED;
  10421 C    INCR. MAX. NO. RECORDS WRITTEN TO PREPDA FILE FROM 172 TO 272 W/
  10422 C    STOP 79 (& LOG MSG.) IF EXCEEDED
  10423 C 1992-08-07  D. A. KEYSER -- STOP 69 ADDED FOR OVERFLOW PACKING
  10424 C    FULL-WORD ARRAY TO 16-BIT ARRAY (& LOG MSG.)
  10425 C 1992-09-08  D. A. KEYSER -- ADDED CALL TO W3AI39 TO CONVERT STN. ID
  10426 C     FROM ASCII TO EBCDIC ON CRAY PRIOR TO WRITE TO PREPDA FILE;
  10427 C     STATION ID PACKED INTO 16-BIT WORDS 3-5
  10428 C 1993-05-31  D. A. KEYSER -- CHANGED DEF. VALUES & ORDER FOR NAMELIST
  10429 C     SWITCH "IUNIT"
  10430 C 1993-07-28  D. A. KEYSER -- OPTION TO PASS FILLED REPORTS THROUGH
  10431 C     INTERFACE TO ENCODE IN BUFR/PREPDA FILE ADDED, BUT INTERFACE NOT
  10432 C     YET READY
  10433 C 1993-10-07  D. A. KEYSER -- STREAMLINED W3FIZZ W/ MORE VARIABLES
  10434 C     PASSED THRU COMMON
  10435 C 1995-07-12  D. A. KEYSER -- ADDED OUTPUT ARG. 'IERF' (RETURN CODE -
  10436 C     SEE BELOW)
  10437 C 1996-09-03  D. A. KEYSER -- PROCESSING OF TOVS RADIANCES PARTIALLY
  10438 C     DONE (SWITCH "TOVRAD")
  10439 C 1996-10-24  D. A. KEYSER -- ADDED STD. OUTPUT (UNIT 6) PRINT OF TOVS
  10440 C     REPORT RADIANCES/OTHER INFO. BASED ON "MODPRT"
  10441 C 1997-05-01  D. A. KEYSER -- STDOUT EXPANDED TO INCL. REASON CODES
  10442 C 1999-08-04  D. A. KEYSER -- ADDED PRINT FOR NEW VARIABLES POAF AND
  10443 C     DGOT FOR ALL AIRCRAFT TYPES
  10444 C 2000-02-17  D. A. KEYSER -- ADDED PRINT FOR NEW VARIABLE RFFL FOR
  10445 C     NESDIS (GOES) SATWND TYPES
  10446 C 2000-09-22  D. A. KEYSER -- ADDED THE PRINTING OF QUIKSCAT SCATTER-
  10447 C     OMETER WINDS
  10448 C 2001-04-06  D. A. KEYSER -- NOW PROCESSES SSM/I RAIN RATE UNDER R.TYP
  10449 C     150; ACCOUNTS FOR SUBR. W3UNPKB7 OUTPUTTING GOES PWATER AS AS MM
  10450 C     (PRECISE TO 10**2) RATHER THAN MM*100;  ACCOUNTS FOR SUBR.
  10451 C     IW3UNPBF OUTPUTTING SSM/I TPW IN MM (PRECISE TO 10**1) RATHER
  10452 C     THAN MM*10; PRINTS MDCRS TURB. INDEX; PRINTS GOES SFC PRESS.
  10453 C     FOR PW REPORTS
  10454 C 2001-06-19  D. A. KEYSER -- CAN NOW LIST GOES 1x1 FOV CLOUD TOP
  10455 C     REPORTS UNDER R.T. 151
  10456 C 2001-01-28  D. A. KEYSER -- ADDED PRINT FOR NEW VARIABLE "PCAT" FOR

Page 246         Source Listing                  BALLOON_DRIFT
2017-04-18 11:09                                 prepdata.f

  10457 C     ALL AIRCRAFT TYPES
  10458 C 2003-07-10  D. A. KEYSER -- ADDED PRINT OF FLAG TBL VALUE FOR
  10459 C     "RESTRICTIONS ON REDISTRIBUTION" FOR ALL SINGLE-LEVEL REPORTS
  10460 C 2004-09-09  D. A. KEYSER -- ADDED PROCESSING OF MESONET DATA, READ
  10461 C     FROM "MSONET" DUMP FILE DUMP R. TYPE 540, GET PREPBUFR R. TYPE
  10462 C     188/288, PROCESSED INTO PREPBUFR FILE UNDER NEW TBL A ENTRY
  10463 C     "MSONET"; ADDED PROCESSING OF GPS-IPW DATA, READ FROM "GPSIPW"
  10464 C     DUMP FILE DUMP R. TYPE 74, GET PREPBUFR R. TYPE 153, PROCESSED
  10465 C     BY NEW SUBR. "GETGPSIPW" INTO PREPBUFR FILE UNDER NEW TBL A ENTRY
  10466 C     "GPSIPW"; NOW PRINTS "*" (FORMAT OVERFLOW) FOR MISSING QUALITY
  10467 C     MARKS (BEFORE SET THEM TO "15"); PRINTS MDCRS FLIGHT NUMBER;
  10468 C     PRINTS MESONET PROVIDER AND SUB-PROVIDER ID STRINGS;  RAIN RATE
  10469 C     (SSM/I) IS NOW ENCODED WITH STANDARD MNEMONIC REQV INSTEAD OF
  10470 C     LOCAL MNEMONIC REQ6 (STILL HIGH PRECISION, BUFRTABLE HAS OPERATOR
  10471 C     DESCRIPTORS)
  10472 C 2007-09-14  D. A. KEYSER -- MODIFIED TO PROCESS TAMDAR AND CANADIAN
  10473 C     AMDAR AIRCRAFT REPORTS (FORMER GET PREPBUFR REPORT TYPE 134/234
  10474 C     AND ENCODES NEW PARAMETERS "TRBX" AND "ROLF" INTO PREPBUFR FILE;
  10475 C     LATTER GET PREPBUFR REPORT TYPE 135/125); MODIFIED TO PROCESS
  10476 C     WINDSAT SCATTEROMETER REPORTS, READ FROM NEW "WDSATR" DUMP FILE
  10477 C     (GETS PREPBUFR REPORT TYPE 289 AND ENCODES NEW PARAMETERS MRWVC,
  10478 C     MRLWC, WSST, MWD10, MWS10, WSEQC1, CHSQ, PHER, SPDE, SSTE, CLDE
  10479 C     AND VPRE IN PREPBUFR FILE UNDER NEW MESSAGE TYPE "WDSATR);
  10480 C     MODIFIED TO HANDLE RETURN OF NEW ARGUMENT "RDATA2" FROM CALLS TO
  10481 C     W3UNPKB7 [1-DIM 21-WORD ARRAY WHICH HOLDS ADDITIONAL VALUES
  10482 C     DECODED DIRECTLY FROM BUFR (AND NOT IN "RDATA" ARRAY), FOR SOME
  10483 C     PARAMETERS REPLACING WHAT HAD BEEN RETURNED IN "RDATA" ARRAY (IN
  10484 C     THE HEADER)]; ADDED LISTING OF PERCENT CONFIDENCE BASED ON -
  10485 C     EUMETSAT QUALITY INDEX WITH FORECAST CONSISTENCY TEST, EUMETSAT
  10486 C     QUALITY INDEX WITHOUT FORECAST CONSISTENCY TEST AND NESDIS
  10487 C     EXPECTED ERROR FOR SATWND TYPES
  10488 C 2008-04-10  D. A. KEYSER -- CAN HANDLE RADIOSONDE TYPES > 99 WHICH
  10489 C     WILL SOON BE INTRODUCED INTO THE BUFR DATABASE (BASED ON NOVEMBER
  10490 C     2007 WMO BUFR UPDATE)
  10491 C 2008-09-25  D. A. KEYSER -- CAN NOW PROCESS ASCAT SCATTEROMETER
  10492 C     WIND DATA READING FROM REPROCESSED DUMP FILE IN UNIT 39, ENCODING
  10493 C     INTO NEW PREPBUFR REPORT TYPE 290 UNDER NEW PREPBUFR MESSAGE TYPE
  10494 C     "ASCATW" VIA NEW NAMELIST SWITCHES "JPASCD" (DEF=6*9999) AND
  10495 C     IAWNDO (DEF=-3,+3); 1-DIM ARRAY OBS2 RETURNED FROM IW3UNPBF
  10496 C     INCREASED FROM 41 TO 42 WORDS TO HOLD MOISTURE QUALITY (CODE
  10497 C     TABLE) FOR MDCRS REPORTS
  10498 C 2014-04-25  D. A. Keyser -- 1-dim array OBS2 returned from IW3UNPBF
  10499 C     increased from 42 to 43 words to hold satellite zenith angle
  10500 C     (degrees, for all SATWND types).
  10501 C 2016-08-15  D. A. Keyser -- Add zenith total delay and its error to
  10502 C     listings for GPS-IPW/ZTD reports in report type 153.
  10503 C 2016-09-05  S. Melchior --
  10504 C      - Diagnostic output print statements formatted to accommodate
  10505 C        increased precision now in latitude and longitude.
  10506 C 2016-11-25  D. A. Keyser --
  10507 C      - Adds instantaneous altitude rate (IALR) to listings for TAMDARB
  10508 C        reports in report type 134/234.
  10509 C      - Add flight number (ACID) to listings for AMDARB reports (only)
  10510 C        in report type 131/231.
  10511 C 2016-11-30  D. A. Keyser --
  10512 C      - Replace machine length lat/lon {HDR(3), HDR(2)} with R*8 lat/
  10513 C        lon (ALAT_8, ALON_8) in print statements.

Page 247         Source Listing                  BALLOON_DRIFT
2017-04-18 11:09                                 prepdata.f

  10514 C        BENEFIT: Values are now precise to 10**5 degrees (was not the
  10515 C                 case after 2016-09-05 change above).
  10516 C
  10517 C USAGE:    CALL FILLX(LL,IERF)
  10518 C   INPUT ARGUMENT LIST:
  10519 C     LL       - IF .GE. 0 - THE NUMBER OF LEVELS IN THE REPORT
  10520 C              - PIECE; IF = -1 - FLAG TO INDICATE THAT REPORT
  10521 C              - CONTAINS ONLY RADIANCES (EITHER RTOVS, ATOVS, GOES,
  10522 C              - OR SSM/I); IF -2 - FLAG TO INDICATE THAT REPORT
  10523 C              - CONTAINS ONLY PRECIPITABLE WATER DATA (EITHER GOES,
  10524 C              - SSM/I OR GPS-IPW), OR ONLY RAIN RATE DATA (SSM/I),
  10525 C              - OR ONLY CLOUD TOP DATA (GOES)
  10526 C
  10527 C   OUTPUT ARGUMENT LIST:
  10528 C     IERF     - RETURN CODE (=0 - REPORT SUCCESSFULLY ENCODED INTO
  10529 C              - PREPBUFR FILE; =1 - REPORT NOT ENCODED INTO PREPBUFR
  10530 C              - FILE - PROBLEM!)
  10531 C
  10532 C   OUTPUT FILES:
  10533 C     UNIT 06  - STANDARD OUTPUT PRINT
  10534 C
  10535 C REMARKS: CALLED BY SUBROUTINES 'GETC06', 'SFCDTA', 'STOROB',
  10536 C   'GETPWATER', 'GETSMI' AND 'GETSCATT'.
  10537 C
  10538 C ATTRIBUTES:
  10539 C   LANGUAGE: FORTRAN 90
  10540 C   MACHINE:  NCEP WCOSS
  10541 C
  10542 C$$$
  10543       SUBROUTINE FILLX(LL,IERF)
  10544       PARAMETER (MXWRDH = 15)
  10545       PARAMETER (MXTYPV =  3)
  10546       PARAMETER (MXWRDL =  6)
  10547       PARAMETER (MXLVL = 600)
  10548       PARAMETER (MXPWT =  5)
  10549       PARAMETER (MXBLVL = 255)
  10550       PARAMETER (MAXOBS = 3500)
  10551       PARAMETER (NUMOBS2 = 43)
  10552       LOGICAL  TOVRAD,GOESRD,TOVEDS
  10553       real(8)  obs8_8,alon_8,alat_8
  10554       CHARACTER*8  STNPRT,STNID,CRES1,CRES2,SUBSET_d
  10555       CHARACTER*9  TSLTT1,TSLTT2,TSLTB1,TSLTB2
  10556       CHARACTER*10 MSLTT1,ZSLTT1,MSLTT2,ZSLTT2,MSLTB1,ZSLTB1,MSLTB2,
  10557      $ ZSLTB2
  10558       CHARACTER*11  CBULL,CRES2_save
  10559       INTEGER  ICHN(35),IDATA(MAXOBS)
  10560       COMMON/STRCTY/ICAT(MXLVL)
  10561       COMMON/STRPWT/PWAT(MXTYPV,MXPWT)
  10562       COMMON/STRMSL/IPMSL(MXTYPV)
  10563       COMMON/STRMOB/MOBS(MXTYPV,MXWRDL,MXLVL)
  10564       COMMON/STRRRT/REQV
  10565       COMMON/ADP/ISATOB,PMAND(23),RDATA(MAXOBS),IPRINT
  10566       COMMON/DATA/KOUNT,IDATE(4),IDAT10,MP_PROCESS,WRMISS
  10567       COMMON/RPTHDR/SUBSET_d,STNID,HDR(2:MXWRDH),alon_8,alat_8
  10568       COMMON/LEVELS/MLEV
  10569       COMMON/UNITNO/NFILE,IUNIT(28)
  10570       COMMON/PARM6/MODPRT,IFLUA,STNPRT(3)

Page 248         Source Listing                  FILLX
2017-04-18 11:09                                 prepdata.f

  10571       COMMON/TVSWCH/TOVEDS(2),TOVBFR(2),TR80KM,KNTTOV(2),
  10572      $ KSKPTV(2),KNOPTV(2),KIPTTV(2),KMSGTV(2),KBDYTV(2),KTIMTV(2),
  10573      $ KLNDTV(2),KSEATV(2),KREDTV(2),KJFLAG(2)
  10574       COMMON/RADANC/RTRAD(35),GRAD(18),IGCHN(18),SOZANG,SAZANG,OZONE,
  10575      $ SKINT,CLDAMT,TOVRAD,TOVRTV,GOESRD(2)
  10576       COMMON/CLDTOP/CLTOP(2,3)
  10577       COMMON/ACFTSW/AWINDO(2,9),AIRLND(6,9),JAWIND(6,9),JAMASS(6,9),
  10578      $ IACFTL(9),IACFTH(9),PHIACF(7),KEPAC(6,9),AIFNOW(9),POAF,TRBX(5),
  10579      $ FLACMS(9),PCAT,ROLF,aMSTQ,RIALR
  10580       COMMON/SATSW3/PHISWN(7),SWNLND(6,8,10),SWINDO_e(6,8,10),
  10581      $ SWINDO_l(6,8,10),JSWIND(6,8,10),JSMASS(6,8,10),KEPSW(6,8,10),
  10582      $ KSKSWD(10),RFFL,QIFY,QIFN,EEQF
  10583       COMMON/MISWCH/XWINDO(6,4),JPSSMI(6,4),SRAD(7),KNTSMI(4),KTIMM(4),
  10584      $ KSKPMI,KMSGMI,KBDYMI
  10585       COMMON/COUNT/KKTYPE(100:299)
  10586       COMMON/SFCBFR/ALTIMR,PRSS
  10587       COMMON/DIRECT/OBS3(5,MXBLVL,7),OBS2(NUMOBS2),NOBS3(7),RDATA2(25),
  10588      $ obs8_8(2)
  10589       COMMON/XTRHD2/CRES1,CRES2,CBULL
  10590       EQUIVALENCE(IDATA,RDATA)
  10591       DATA  ICHN/1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,
  10592      $ 22,23,24,25,26,27,28,29,30,31,32,33,34,35/
  10593       DATA YMISS/99998.8/,IMISS/99999/
  10594 C INITIALIZE CERTAIN VARIABLES TO AVOID COMPILER WARNINGS
  10595       MODKNT = -1
  10596       IERF = 0
  10597 C NEWPRT CONTROLS INTERVAL BETWEEN STANDARD OUTPUT PRINT (FROM REPORT
  10598 C  IN "HDR/MOBS/IPMSL/PWAT/xRAD/REQV/CLTOP" ARRAYS)
  10599 C MODPRT CONTROLS INTERVAL BETWEEN STANDARD OUTPUT OF REPORTS AS THEY
  10600 C  ARE MERGED IN THE GETUPA AND SATELLITE SOUNDING SUBROUTINES
  10601       IF(MODPRT.GE.0)  THEN
  10602          NEWPRT = MODPRT/4
  10603          MODKNT = MOD((KOUNT-1),NEWPRT)
  10604       END IF
  10605 C CAN ALSO PRINT OUT FILLED REPORT IN "HDR/MOBS/IPMSL/PWAT/xRAD/REQV/
  10606 C  CLTOP" ARRAYS FOR SPECIFIC REPORT(S)
  10607       IF(STNID.EQ.STNPRT(1).OR.STNID.EQ.STNPRT(2).OR.STNID.EQ.
  10608      $ STNPRT(3))  MODKNT = 0
  10609       IF(LL.LT.1)  THEN
  10610          MLEV = 0
  10611       ELSE
  10612          MLEV = LL
  10613 C THE MAXIMUM NUMBER OF LEVELS PROCESSED IS MXLVL
  10614          MLEV = MIN(MLEV,MXLVL)
  10615       END IF
  10616 C ENCODE REPORT INTO PREPBUFR DATASET
  10617       CALL W3FIZZ(IERF)
  10618       IF(IERF.NE.0)  RETURN
  10619 C+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
  10620 C OPTION TO PRINT LISTING OF ALL REPORTS (NORMALLY COMMENTED OUT)
  10621 C     PRINT 9091, STNID,NINT(HDR(6))
  10622 C9091 FORMAT(1X,'STN. ',A8,'  PREPBUFR REPORT TYPE =',I4)
  10623 C+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
  10624 C ACCUMULATE COUNTS OF ENCODED REPORTS ACCORDING TO PREPBUFR REPORT TYPE
  10625       KKTYPE(NINT(HDR(6))) = KKTYPE(NINT(HDR(6))) + 1
  10626       IF(MODKNT.NE.0)  RETURN
  10627 C PRINTS OUT DATA FOR AN OCCASIONAL REPORT (DEPENDING ON MODPRT/NEWPRT)

Page 249         Source Listing                  FILLX
2017-04-18 11:09                                 prepdata.f

  10628 C**********************************************************************
  10629 C       SET UP FORMAT OF STANDARD OUTPUT (UNIT 06) REPORT PRINTOUT
  10630 C**********************************************************************
  10631 C GET DEFAULT HEADER LABELS FOR TEMP., MOISTURE, HEIGHT & PRESSURE
  10632       ZSLTT1 = '   HEIGHT '
  10633       ZSLTB1 = '  (METERS)'
  10634       TSLTT1 = ' RPT. TMP'
  10635       TSLTB1 = '  (*100C)'
  10636       MSLTT1 = '      Q   '
  10637       MSLTB1 = '   (MG/KG)'
  10638       IF(HDR(6).GE.200)  THEN
  10639 C CORRECT HEADER LABELS FOR U-WIND AND V-WIND FOR WIND REPORTS
  10640          TSLTT1 = '   U-WIND'
  10641          TSLTB1 = '(*100M/S)'
  10642          MSLTT1 = '    V-WIND'
  10643          MSLTB1 = ' (*100M/S)'
  10644       ELSE
  10645          IF((NFILE.EQ.IUNIT(7)  .AND.TOVEDS(1)).OR.
  10646      $      (NFILE.EQ.IUNIT(7)+1.AND.TOVEDS(2)))  THEN
  10647 C CORRECT HGHT LBL TO THICK. TO 1000 MB FOR RTOVS OR ATOVS SAT. SNDINGS
  10648             ZSLTT1 = '  THK-1000'
  10649             ZSLTB1 = '   MB (M) '
  10650          END IF
  10651       END IF
  10652       ZSLTB2 = ZSLTB1
  10653       ZSLTT2 = ZSLTT1
  10654       TSLTT2 = TSLTT1
  10655       TSLTB2 = TSLTB1
  10656       MSLTT2 = MSLTT1
  10657       MSLTB2 = MSLTB1
  10658       IF(NFILE.NE.IUNIT(8))  THEN
  10659          PRINT 905, KOUNT,STNID,alat_8,alon_8,MLEV,HDR(4),NINT(HDR(6)),
  10660      $    NINT(HDR(8)),NINT(HDR(7)),NINT(HDR(9)),NINT(HDR(10))
  10661   905 FORMAT(/'>> (',I6,') ID ',A8,' @',F11.5,' N LAT/',F10.5,' E LON:',
  10662      $ '# LVLS=',I4,'  D-TIM=',F9.5,' HR  ANL RT=',I3,'/',I4,'  DUMP ',
  10663      $ 'RT=',I3,'  IT=',I3.3,' ELV=',I5)
  10664       ELSE
  10665          PRINT 915, KOUNT,STNID,alat_8,alon_8,MLEV,HDR(4),NINT(HDR(6)),
  10666      $    NINT(HDR(7)),NINT(HDR(9)),NINT(HDR(10)),NINT(RDATA2(2))
  10667   915 FORMAT(/'>> (',I6,') ID ',A8,' @',F11.5,' N LAT/',F10.5,' E LON:',
  10668      $ ' # LVLS=',I4,'  DHR=',F9.5,' HR  RTP: PRP=',I3,' DMP=',I3,'; ',
  10669      $ 'ITP=',I3.3,' ELV=',I5,' #FOV=',I2)
  10670       END IF
  10671       IF(HDR(6).EQ.102)  THEN
  10672          PRINT 961, SRAD
  10673   961 FORMAT(5X,'CHN.  1 -- BTEMP=',F8.2,'K;  CHN.  2 -- BTEMP=',F8.2,
  10674      $ 'K;  CHN.  3 -- BTEMP=',F8.2,'K;  CHN.  4 -- BTEMP=',F8.2,'K'/5X,
  10675      $ 'CHN.  5 -- BTEMP=',F8.2,'K;  CHN.  6 -- BTEMP=',F8.2,'K;  CHN.',
  10676      $ '  7 -- BTEMP=',F8.2,'K')
  10677          PRINT 999
  10678          RETURN
  10679       ELSE  IF(LL.EQ.-1)  THEN
  10680          GO TO 6666
  10681       ELSE  IF(LL.EQ.-2)  THEN
  10682          IF(HDR(6).EQ.150)  THEN
  10683             PRINT 969, REQV*3600.
  10684   969 FORMAT(5X,'RAIN RATE=',F8.3,' MM/HOUR')

Page 250         Source Listing                  FILLX
2017-04-18 11:09                                 prepdata.f

  10685          ELSE  IF(HDR(6).EQ.151)  THEN
  10686             PRINT 977, CLTOP(1,1),NINT(CLTOP(2,1)),NINT(CLTOP(1,2)),
  10687      $       CLTOP(1,3)
  10688   977 FORMAT(5X,'CLOUD TOP PRESSURE=',F7.1,' MB - Q.M. = ',I2,', TOTAL',
  10689      $ ' CLOUD COVER=',I3,' %, CLOUD TOP TEMPERATURE=',F6.2)
  10690          ELSE  IF(HDR(6).EQ.152)  THEN
  10691             PRINT 967, PWAT(1,1),NINT(PWAT(2,1))
  10692   967 FORMAT(5X,'TOTAL COLUMN PRECIP. WATER=',F7.1,' MM - Q.M. = ',I2)
  10693          ELSE  IF(HDR(6).EQ.153)  THEN
  10694             PRINT 986, PWAT(1,1),NINT(PWAT(2,1)),PRSS
  10695   986 FORMAT(5X,'TOTAL COLUMN PRECIP. WATER=',F7.1,' MM - Q.M. = ',I2/
  10696      $ 5X,'SURFACE PRESSURE= ',F6.1,' MB')
  10697             if(idata(43).gt.0)  then
  10698                if(rdata(idata(44)+4).lt.ymiss) then
  10699                   print 987, rdata(idata(44)+4),rdata(idata(44)+5)
  10700   987 format(5X,'ZTD=',F8.4,' M, Error in ZTD= ',F7.4,' M')
  10701                end if
  10702             end if
  10703          ELSE  IF(HDR(6).GT.155)  THEN
  10704             PRINT 966, (PWAT(1,I),NINT(PWAT(2,I)),I=2,5),PRSS
  10705   966 FORMAT(
  10706      $ 5X,'1.0 TO 0.9 SIGMA PRECIP. WATER=',F7.1,' MM - Q.M. = ',I2/
  10707      $ 5X,'0.9 TO 0.7 SIGMA PRECIP. WATER=',F7.1,' MM - Q.M. = ',I2/
  10708      $ 5X,'0.7 TO 0.3 SIGMA PRECIP. WATER=',F7.1,' MM - Q.M. = ',I2/
  10709      $ 5X,'0.3 TO 0.0 SIGMA PRECIP. WATER=',F7.1,' MM - Q.M. = ',I2/
  10710      $ 5X,'SURFACE PRESSURE= ',F6.1,' MB')
  10711          END IF
  10712          PRINT 999
  10713          RETURN
  10714       END IF
  10715       IF(MLEV.EQ.1)  THEN
  10716 C SINGLE-LEVEL DATA PRINTS HERE
  10717          IF(NFILE.NE.IUNIT(5)+1.AND.NFILE.NE.IUNIT(5)+2) PRINT 909,
  10718      $    ZSLTT1,TSLTT1,MSLTT1,ZSLTB1,TSLTB1,MSLTB1,NINT(OBS2(1))
  10719   909 FORMAT(1X,'  PRES ',A10,A9,A10,'   --TBL VALS-   -R. CODES--! '/
  10720      $ 1X,'(*10MB)',A10,A9,A10,14X,'    {MOD(100)}! RESTRICTED FLAG:',
  10721      $ I5)
  10722          JPIP1 = MOBS(1,1,1)
  10723          JPIP2 = MOBS(1,2,1)
  10724          JPIP3 = MOBS(1,3,1)
  10725          JPIP4 = MOBS(1,4,1)
  10726          JPIP6 = MOBS(1,6,1)
  10727 cdak     KPIP1 = MIN(15,MOBS(2,1,1))
  10728          KPIP1 = MOBS(2,1,1)
  10729 cdak     KPIP2 = MIN(15,MOBS(2,2,1))
  10730          KPIP2 = MOBS(2,2,1)
  10731 cdak     KPIP3 = MIN(15,MOBS(2,3,1))
  10732          KPIP3 = MOBS(2,3,1)
  10733 cdak     KPIP4 = MIN(15,MOBS(2,4,1))
  10734          KPIP4 = MOBS(2,4,1)
  10735          LPIP1 = MOD(MOBS(3,1,1),100)
  10736          LPIP2 = MOD(MOBS(3,2,1),100)
  10737          LPIP3 = MOD(MOBS(3,3,1),100)
  10738          LPIP4 = MOD(MOBS(3,4,1),100)
  10739          IF(ICAT(1).LT.IMISS)  THEN
  10740             IF(HDR(6).LT.200)  THEN
  10741                IF(ISATOB.NE.3.AND.ISATOB.NE.4)  KPIP4 = ICAT(1)

Page 251         Source Listing                  FILLX
2017-04-18 11:09                                 prepdata.f

  10742             ELSE
  10743                KPIP4 = ICAT(1)
  10744             END IF
  10745          END IF
  10746          IF(IPMSL(1).LT.YMISS)  THEN
  10747             PRINT 994, JPIP1,JPIP2,JPIP3,JPIP4,KPIP1,KPIP2,KPIP3,KPIP4,
  10748      $       LPIP1,LPIP2,LPIP3,LPIP4,IPMSL(1),IPMSL(2)
  10749   994 FORMAT(1X,I6,I10,I9,I10,1X,2X,4(1X,I2),2X,4I3.2,'! PMSL=',I6,
  10750      $ ' (*10MB), Q.M.(PMSL)=',I2)
  10751          ELSE IF(HDR(6).GE.200.AND.NFILE.EQ.IUNIT(6).AND.JPIP6.LT.IMISS)
  10752      $    THEN
  10753             PRINT 4994, JPIP1,JPIP2,JPIP3,JPIP4,KPIP1,KPIP2,KPIP3,KPIP4,
  10754      $       LPIP1,LPIP2,LPIP3,LPIP4,JPIP6,KPIP4
  10755  4994 FORMAT(1X,I6,I10,I9,I10,1X,2X,4(1X,I2),2X,4I3.2,'! WSPD=',I6,
  10756      $ ' (*10M/S), Q.M.(WSPD)=',I2)
  10757          ELSE  IF(NFILE.EQ.IUNIT(6)+3)  THEN ! Mesonet
  10758             PRINT 8995, JPIP1,JPIP2,JPIP3,JPIP4,KPIP1,KPIP2,KPIP3,KPIP4,
  10759      $       LPIP1,LPIP2,LPIP3,LPIP4,CRES1,CRES2
  10760  8995 FORMAT(1X,I6,I10,I9,I10,1X,2X,4(1X,I2),2X,4I3.2,'! PRVSTG= ',A8,
  10761      $ ', SPRVSTG= ',A8)
  10762          ELSE  IF(NFILE.EQ.IUNIT(5)+1.OR.NFILE.EQ.IUNIT(5)+2)  THEN
  10763             CRES2_save = CRES2//'   '
  10764             if(CRES2.eq.'        ')  then
  10765                if(IDATA(10).eq.103) then
  10766                   CRES2_save = ' -missing- '
  10767                else
  10768                   CRES2_save = 'not encoded'
  10769                end if
  10770             end if
  10771             PRINT 910, ZSLTT1,TSLTT1,MSLTT1,ZSLTB1,TSLTB1,MSLTB1,
  10772      $       NINT(OBS2(1)),CRES2_save
  10773   910 FORMAT(1X,'  PRES ',A10,A9,A10,'   --TBL VALS-   -R. CODES--! '/
  10774      $ 1X,'(*10MB)',A10,A9,A10,14X,'    {MOD(100)}! RESTRICTED FLAG:',
  10775      $ I5,', FLIGHT NUMBER=',A11)
  10776             IF(NFILE.EQ.IUNIT(5)+1)  THEN
  10777                PRINT 2994, JPIP1,JPIP2,JPIP3,JPIP4,KPIP1,KPIP2,KPIP3,
  10778      $          KPIP4,LPIP1,LPIP2,LPIP3,LPIP4,PCAT,NINT(POAF),
  10779      $          (NINT(TRBX(I)),I=1,4),NINT(aMSTQ)
  10780  2994 FORMAT(1X,I6,I10,I9,I10,1X,2X,4(1X,I2),2X,4I3.2,'! TEMP PREC=',
  10781      $ F5.2,'K; CF: PH FLT=',I1,', TRB INDX(1-4)=',4I2,', MSTQ=',I2)
  10782             ELSE
  10783                PRINT 8994, JPIP1,JPIP2,JPIP3,JPIP4,KPIP1,KPIP2,KPIP3,
  10784      $          KPIP4,LPIP1,LPIP2,LPIP3,LPIP4,PCAT,NINT(POAF),
  10785      4          NINT(TRBX(5)),NINT(ROLF),RIALR
  10786  8994 FORMAT(1X,I6,I10,I9,I10,1X,2X,4(1X,I2),2X,4I3.2,'! T PREC=',F5.2,
  10787      $ 'K; CF: PH FLT=',I1,', TRB IDX=',I2,', ROLL ANG FL=',I1,
  10788      $ ', IALR=',F6.3,'M/SEC')
  10789             END IF
  10790          ELSE  IF(NFILE.EQ.IUNIT(5)+3.AND.(MIN(RFFL,QIFY,QIFN,EEQF,
  10791      $    OBS2(NUMOBS2)).LT.YMISS))  THEN
  10792             PRINT 3994, JPIP1,JPIP2,JPIP3,JPIP4,KPIP1,KPIP2,KPIP3,KPIP4,
  10793      $       LPIP1,LPIP2,LPIP3,LPIP4,NINT(RFFL),NINT(QIFY),NINT(QIFN),
  10794      $       NINT(EEQF),OBS2(NUMOBS2)
  10795  3994 FORMAT(1X,I6,I10,I9,I10,1X,2X,4(1X,I2),2X,4I3.2,'! RFFL, QIFY, ',
  10796      $ 'QIFN, EEQF: ',4I4,'; SAZA=',F6.2)
  10797          ELSE  IF(NFILE.EQ.IUNIT(6)+6)  THEN
  10798             PRINT 6994, JPIP1,JPIP2,JPIP3,JPIP4,KPIP1,KPIP2,KPIP3,KPIP4,

Page 252         Source Listing                  FILLX
2017-04-18 11:09                                 prepdata.f

  10799      $       LPIP1,LPIP2,LPIP3,LPIP4,NINT(RDATA2(3)),NINT(RDATA2(4)),
  10800      $       RDATA2(8)*100.0
  10801  6994 FORMAT(1X,I6,I10,I9,I10,1X,2X,4(1X,I2),2X,4I3.2,'! CELL # = ',I4,
  10802      $ '; ROW # = ',I4,'; SPRR =',F6.1,'%')
  10803          ELSE  IF(NFILE.EQ.IUNIT(6)+7)  THEN
  10804             PRINT 6995, JPIP1,JPIP2,JPIP3,JPIP4,KPIP1,KPIP2,KPIP3,KPIP4,
  10805      $       LPIP1,LPIP2,LPIP3,LPIP4,NINT(RDATA2(2)),(RDATA2(II),
  10806      $       II=9,11),RDATA2(14),RDATA2(13),NINT(RDATA2(15)),
  10807      $       (RDATA2(II),II=16,21),REQV*3600,NINT(RDATA2(12))
  10808  6995 FORMAT(1X,I6,I10,I9,I10,1X,2X,4(1X,I2),2X,4I3.2,'!ACAV ',I2,
  10809      $ '|SST1 ',F6.2,'K|MRWVC ',F6.2,'MM|MRLWC ',F5.2,'MM|MWS10 ',F6.2,
  10810      $ 'M/S'/'MWD10 ',F6.2,'|WSEQC1',I10,'|CHSQ ',F5.2,'|PHER ',F5.1,
  10811      $ '|SPDE ',F5.2,'M/S|SSTE ',F6.2,'K|CLDE ',F6.3,'MM|VPRE ',F5.2,
  10812      $ 'MM|REQV',F8.3,'MM/HR|WSST ',I2)
  10813          ELSE  IF(NFILE.EQ.IUNIT(6)+8)  THEN
  10814             PRINT 6996, JPIP1,JPIP2,JPIP3,JPIP4,KPIP1,KPIP2,KPIP3,KPIP4,
  10815      $       LPIP1,LPIP2,LPIP3,LPIP4,NINT(RDATA2(3)),NINT(RDATA2(22)),
  10816      $       RDATA2(23),RDATA2(24)
  10817  6996 FORMAT(1X,I6,I10,I9,I10,1X,2X,4(1X,I2),2X,4I3.2,'! CELL # = ',I4,
  10818      $ '; WVCQ = ',I10,'; BSCD =',F6.1,'; LKCS = ',F7.3)
  10819          ELSE
  10820             PRINT 1994, JPIP1,JPIP2,JPIP3,JPIP4,KPIP1,KPIP2,KPIP3,KPIP4,
  10821      $       LPIP1,LPIP2,LPIP3,LPIP4
  10822  1994 FORMAT(1X,I6,I10,I9,I10,1X,2X,4(1X,I2),2X,4I3.2,'!')
  10823          END IF
  10824       ELSE
  10825          PRINT 902, ZSLTT1,TSLTT1,MSLTT1,ZSLTT2,TSLTT2,MSLTT2,ZSLTB1,
  10826      $    TSLTB1,MSLTB1,ZSLTB2,TSLTB2,MSLTB2
  10827   902 FORMAT(1X,'  PRES ',A10,A9,A10,'   --TBL VALS-   -R. CODES--!   ',
  10828      $ 'PRES ',A10,A9,A10,'   --TBL VALS-   -R. CODES--'/1X,'(*10MB)',
  10829      $ A10,A9,A10,14X,'    {MOD(100)}! (*10MB)',A10,A9,A10,14X,'    ',
  10830      $ '{MOD(100)}')
  10831          NSLEV = MLEV
  10832          IF(MOD(MLEV,2).NE.0)  NSLEV = NSLEV + 1
  10833          NSLEV = NSLEV/2
  10834          DO I = 1,NSLEV
  10835             JPIP1 = MOBS(1,1,I)
  10836             JPIC1 = MOBS(1,1,I+NSLEV)
  10837             JPIP2 = MOBS(1,2,I)
  10838             JPIC2 = MOBS(1,2,I+NSLEV)
  10839             JPIP3 = MOBS(1,3,I)
  10840             JPIC3 = MOBS(1,3,I+NSLEV)
  10841             JPIP4 = MOBS(1,4,I)
  10842             JPIC4 = MOBS(1,4,I+NSLEV)
  10843 cdak        KPIP1 = MIN(15,MOBS(2,1,I))
  10844             KPIP1 = MOBS(2,1,I)
  10845 cdak        KPIC1 = MIN(15,MOBS(2,1,I+NSLEV))
  10846             KPIC1 = MOBS(2,1,I+NSLEV)
  10847 cdak        KPIP2 = MIN(15,MOBS(2,2,I))
  10848             KPIP2 = MOBS(2,2,I)
  10849 cdak        KPIC2 = MIN(15,MOBS(2,2,I+NSLEV))
  10850             KPIC2 = MOBS(2,2,I+NSLEV)
  10851 cdak        KPIP3 = MIN(15,MOBS(2,3,I))
  10852             KPIP3 = MOBS(2,3,I)
  10853 cdak        KPIC3 = MIN(15,MOBS(2,3,I+NSLEV))
  10854             KPIC3 = MOBS(2,3,I+NSLEV)
  10855 cdak        KPIP4 = MIN(15,MOBS(2,4,I))

Page 253         Source Listing                  FILLX
2017-04-18 11:09                                 prepdata.f

  10856             KPIP4 = MOBS(2,4,I)
  10857 cdak        KPIC4 = MIN(15,MOBS(2,4,I+NSLEV))
  10858             KPIC4 = MOBS(2,4,I+NSLEV)
  10859             LPIP1 = MOD(MOBS(3,1,I),100)
  10860             LPIC1 = MOD(MOBS(3,1,I+NSLEV),100)
  10861             LPIP2 = MOD(MOBS(3,2,I),100)
  10862             LPIC2 = MOD(MOBS(3,2,I+NSLEV),100)
  10863             LPIP3 = MOD(MOBS(3,3,I),100)
  10864             LPIC3 = MOD(MOBS(3,3,I+NSLEV),100)
  10865             LPIP4 = MOD(MOBS(3,4,I),100)
  10866             LPIC4 = MOD(MOBS(3,4,I+NSLEV),100)
  10867             IF(HDR(6).LT.200)  THEN
  10868                IF(ISATOB.NE.3.AND.ISATOB.NE.4)  THEN
  10869                   IF(ICAT(I).LT.IMISS)  KPIP4 = ICAT(I)
  10870                   IF(ICAT(I+NSLEV).LT.IMISS)  KPIC4 = ICAT(I+NSLEV)
  10871                END IF
  10872             ELSE
  10873                IF(ICAT(I).LT.IMISS)  KPIP4 = ICAT(I)
  10874                IF(ICAT(I+NSLEV).LT.IMISS)  KPIC4 = ICAT(I+NSLEV)
  10875             END IF
  10876             PRINT 94, JPIP1,JPIP2,JPIP3,JPIP4,KPIP1,KPIP2,KPIP3,KPIP4,
  10877      $       LPIP1,LPIP2,LPIP3,LPIP4,JPIC1,JPIC2,JPIC3,JPIC4,KPIC1,
  10878      $       KPIC2,KPIC3,KPIC4,LPIC1,LPIC2,LPIC3,LPIC4
  10879    94 FORMAT(1X,I6,I10,I9,I10,1X,2X,4(1X,I2),2X,4I3.2,'! ',I6,I10,I9,
  10880      $ I10,1X,2X,4(1X,I2),2X,4I3.2)
  10881          ENDDO
  10882       END IF
  10883  6666 CONTINUE
  10884       IF(NFILE.EQ.IUNIT(7))  THEN
  10885          IF(TOVRAD)  THEN
  10886             PRINT 2995, SOZANG,SAZANG,OZONE,SKINT
  10887  2995 FORMAT(/1X,'RTOVS RADIANCES: ZENITH ANGLE (DEG): SOLAR=',F8.2,
  10888      $ ', SATELLITE=',F8.2,'; OZONE=',F6.0,'(DOBSON); SKIN TEMP=',F7.1,
  10889      $ 'K')
  10890             PRINT 2996, (ICHN(I),RTRAD(I),I=1,32)
  10891  2996 FORMAT(5X,'CHN.',I3,' -- BTEMP=',F8.2,'K;  CHN.',I3,' -- BTEMP=',
  10892      $ F8.2,'K;  CHN.',I3,' -- BTEMP=',F8.2,'K;  CHN.',I3,' -- BTEMP=',
  10893      $ F8.2,'K')
  10894          END IF
  10895       ELSE IF(NFILE.EQ.IUNIT(7)+1)  THEN
  10896          IF(TOVRAD)  THEN
  10897             PRINT 3995, SOZANG,SAZANG,OZONE,SKINT
  10898  3995 FORMAT(/1X,'ATOVS RADIANCES: ZENITH ANGLE (DEG): SOLAR=',F8.2,
  10899      $ ', SATELLITE=',F8.2,'; OZONE=',F6.0,'(DOBSON); SKIN TEMP=',F7.1,
  10900      $ 'K')
  10901             PRINT 3996, (ICHN(I),RTRAD(I),I=1,35)
  10902  3996 FORMAT(5X,'CHN.',I3,' -- BTEMP=',F8.2,'K;  CHN.',I3,' -- BTEMP=',
  10903      $ F8.2,'K;  CHN.',I3,' -- BTEMP=',F8.2,'K;  CHN.',I3,' -- BTEMP=',
  10904      $ F8.2,'K')
  10905          END IF
  10906       END IF
  10907       IF(NFILE.EQ.IUNIT(8))  THEN
  10908          IF((GOESRD(1).AND.STNID(1:1).NE.'H').OR.
  10909      $      (GOESRD(2).AND.STNID(1:1).EQ.'H'))  THEN
  10910             IF(IGCHN(1).NE.-99999)  THEN
  10911                PRINT 997, SOZANG,SAZANG,SKINT,CLDAMT
  10912   997 FORMAT(/1X,'GOES RADIANCES:: ZENITH ANGLE (DEG): SOLAR=',F8.2,

Page 254         Source Listing                  FILLX
2017-04-18 11:09                                 prepdata.f

  10913      $ ', SATELLITE=',F8.2,'; SKIN TEMP=',F8.2,'K; CLOUD AMT=',F5.0,
  10914      $ '(CODE TBL)')
  10915                PRINT 998, (IGCHN(I),GRAD(I),I=1,18)
  10916   998 FORMAT(5X,'CHN.',I3,' -- BTEMP=',F8.2,'K;  CHN.',I3,' -- BTEMP=',
  10917      $ F8.2,'K;  CHN.',I3,' -- BTEMP=',F8.2,'K')
  10918             END IF
  10919          END IF
  10920       END IF
  10921       PRINT 999
  10922   999 FORMAT(' ')
  10923 C**********************************************************************
  10924       RETURN
  10925       END


ENTRY POINTS

  Name              
                    
 fillx_             


SYMBOL CROSS REFERENCE

 Name                       Object Declared Type            Bytes Dimen Elements Attributes       References                        
                                                                                                                                    
 1994                       Label  10822                                                          10820                             
 2994                       Label  10780                                                          10777                             
 2995                       Label  10887                                                          10886                             
 2996                       Label  10891                                                          10890                             
 3994                       Label  10795                                                          10792                             
 3995                       Label  10898                                                          10897                             
 3996                       Label  10902                                                          10901                             
 4994                       Label  10755                                                          10753                             
 6666                       Label  10883                                                          10680                             
 6994                       Label  10801                                                          10798                             
 6995                       Label  10808                                                          10804                             
 6996                       Label  10817                                                          10814                             
 8994                       Label  10786                                                          10783                             
 8995                       Label  10760                                                          10758                             
 902                        Label  10827                                                          10825                             
 905                        Label  10661                                                          10659                             
 909                        Label  10719                                                          10717                             
 910                        Label  10773                                                          10771                             
 915                        Label  10667                                                          10665                             
 94                         Label  10879                                                          10876                             
 961                        Label  10673                                                          10672                             
 966                        Label  10705                                                          10704                             
 967                        Label  10692                                                          10691                             
 969                        Label  10684                                                          10683                             
 977                        Label  10688                                                          10686                             
 986                        Label  10695                                                          10694                             
 987                        Label  10700                                                          10699                             
 994                        Label  10749                                                          10747                             
 997                        Label  10912                                                          10911                             
 998                        Label  10916                                                          10915                             
 999                        Label  10922                                                          10677,10712,10921                 

Page 255         Source Listing                  FILLX
2017-04-18 11:09 Symbol Table                    prepdata.f

 Name                       Object Declared Type            Bytes Dimen Elements Attributes       References                        
                                                                                                                                    
 ACFTSW                     Common 10577                                1148                                                        
 ADP                        Common 10565                                14100                                                       
 AIFNOW                     Scalar 10578    R(4)            4     1     9        COM                                                
 AIRLND                     Scalar 10577    R(4)            4     2     54       COM                                                
 ALAT_8                     Scalar 10553    R(8)            8           scalar   COM              10659,10665                       
 ALON_8                     Scalar 10553    R(8)            8           scalar   COM              10659,10665                       
 ALTIMR                     Scalar 10586    R(4)            4           scalar   COM                                                
 AMSTQ                      Scalar 10579    R(4)            4           scalar   COM              10779                             
 AWINDO                     Scalar 10577    R(4)            4     2     18       COM                                                
 CBULL                      Scalar 10558    CHAR            11          scalar   COM                                                
 CLDAMT                     Scalar 10575    R(4)            4           scalar   COM              10911                             
 CLDTOP                     Common 10576                                24                                                          
 CLTOP                      Scalar 10576    R(4)            4     2     6        COM              10686,10687                       
 COUNT                      Common 10585                                800                                                         
 CRES1                      Scalar 10554    CHAR            8           scalar   COM              10759                             
 CRES2                      Scalar 10554    CHAR            8           scalar   COM              10759,10763,10764                 
 CRES2_SAVE                 Local  10558    CHAR            11          scalar                    10763,10766,10768,10772           
 DATA                       Common 10566                                32                                                          
 DIRECT                     Common 10587                                36016                                                       
 EEQF                       Scalar 10582    R(4)            4           scalar   COM              10790,10794                       
 FILLX                      Subr   10543                                                                                            
 FLACMS                     Scalar 10579    R(4)            4     1     9        COM                                                
 GOESRD                     Scalar 10552    L(4)            4     1     2        COM              10908,10909                       
 GRAD                       Scalar 10574    R(4)            4     1     18       COM              10915                             
 HDR                        Scalar 10567    R(4)            4     1     14       COM              10625,10638,10659,10660,10665,1066
                                                                                                  6,10671,10682,10685,10690,10693,10
                                                                                                  703,10740,10751,10867             
 I                          Local  10704    I(4)            4           scalar                    10704,10779,10834,10835,10836,1083
                                                                                                  7,10838,10839,10840,10841,10842,10
                                                                                                  844,10846,10848,10850,10852,10854,
                                                                                                  10856,10858,10859,10860,10861,1086
                                                                                                  2,10863,10864,10865,10866,10869,10
                                                                                                  870,10873,10874,10890,10901,10915 
 IACFTH                     Scalar 10578    I(4)            4     1     9        COM                                                
 IACFTL                     Scalar 10578    I(4)            4     1     9        COM                                                
 ICAT                       Scalar 10560    I(4)            4     1     600      COM              10739,10741,10743,10869,10870,1087
                                                                                                  3,10874                           
 ICHN                       Local  10559    I(4)            4     1     35                        10591,10890,10901                 
 IDAT10                     Scalar 10566    I(4)            4           scalar   COM                                                
 IDATA                      Scalar 10559    I(4)            4     1     3500     COM              10697,10698,10699,10765           
 IDATE                      Scalar 10566    I(4)            4     1     4        COM                                                
 IERF                       Dummy  10543    I(4)            4           scalar   ARG,INOUT        10596,10617,10618                 
 IFLUA                      Scalar 10570    I(4)            4           scalar   COM                                                
 IGCHN                      Scalar 10574    I(4)            4     1     18       COM              10910,10915                       
 II                         Local  10805    I(4)            4           scalar                    10805,10806,10807                 
 IMISS                      Local  10593    I(4)            4           scalar                    10593,10739,10751,10869,10870,1087
                                                                                                  3,10874                           
 IPMSL                      Scalar 10562    I(4)            4     1     3        COM              10746,10748                       
 IPRINT                     Scalar 10565    I(4)            4           scalar   COM                                                
 ISATOB                     Scalar 10565    I(4)            4           scalar   COM              10741,10868                       
 IUNIT                      Scalar 10569    I(4)            4     1     28       COM              10645,10646,10658,10717,10751,1075
                                                                                                  7,10762,10776,10790,10797,10803,10
                                                                                                  813,10884,10895,10907             
 JAMASS                     Scalar 10577    I(4)            4     2     54       COM                                                
 JAWIND                     Scalar 10577    I(4)            4     2     54       COM                                                

Page 256         Source Listing                  FILLX
2017-04-18 11:09 Symbol Table                    prepdata.f

 Name                       Object Declared Type            Bytes Dimen Elements Attributes       References                        
                                                                                                                                    
 JPIC1                      Local  10836    I(4)            4           scalar                    10836,10877                       
 JPIC2                      Local  10838    I(4)            4           scalar                    10838,10877                       
 JPIC3                      Local  10840    I(4)            4           scalar                    10840,10877                       
 JPIC4                      Local  10842    I(4)            4           scalar                    10842,10877                       
 JPIP1                      Local  10722    I(4)            4           scalar                    10722,10747,10753,10758,10777,1078
                                                                                                  3,10792,10798,10804,10814,10820,10
                                                                                                  835,10876                         
 JPIP2                      Local  10723    I(4)            4           scalar                    10723,10747,10753,10758,10777,1078
                                                                                                  3,10792,10798,10804,10814,10820,10
                                                                                                  837,10876                         
 JPIP3                      Local  10724    I(4)            4           scalar                    10724,10747,10753,10758,10777,1078
                                                                                                  3,10792,10798,10804,10814,10820,10
                                                                                                  839,10876                         
 JPIP4                      Local  10725    I(4)            4           scalar                    10725,10747,10753,10758,10777,1078
                                                                                                  3,10792,10798,10804,10814,10820,10
                                                                                                  841,10876                         
 JPIP6                      Local  10726    I(4)            4           scalar                    10726,10751,10754                 
 JPSSMI                     Scalar 10583    I(4)            4     2     24       COM                                                
 JSMASS                     Scalar 10581    I(4)            4     3     480      COM                                                
 JSWIND                     Scalar 10581    I(4)            4     3     480      COM                                                
 KBDYMI                     Scalar 10584    I(4)            4           scalar   COM                                                
 KBDYTV                     Scalar 10572    I(4)            4     1     2        COM                                                
 KEPAC                      Scalar 10578    I(4)            4     2     54       COM                                                
 KEPSW                      Scalar 10581    I(4)            4     3     480      COM                                                
 KIPTTV                     Scalar 10572    I(4)            4     1     2        COM                                                
 KJFLAG                     Scalar 10573    I(4)            4     1     2        COM                                                
 KKTYPE                     Scalar 10585    I(4)            4     1     200      COM              10625                             
 KLNDTV                     Scalar 10573    I(4)            4     1     2        COM                                                
 KMSGMI                     Scalar 10584    I(4)            4           scalar   COM                                                
 KMSGTV                     Scalar 10572    I(4)            4     1     2        COM                                                
 KNOPTV                     Scalar 10572    I(4)            4     1     2        COM                                                
 KNTSMI                     Scalar 10583    I(4)            4     1     4        COM                                                
 KNTTOV                     Scalar 10571    I(4)            4     1     2        COM                                                
 KOUNT                      Scalar 10566    I(4)            4           scalar   COM              10603,10659,10665                 
 KPIC1                      Local  10846    I(4)            4           scalar                    10846,10877                       
 KPIC2                      Local  10850    I(4)            4           scalar                    10850,10878                       
 KPIC3                      Local  10854    I(4)            4           scalar                    10854,10878                       
 KPIC4                      Local  10858    I(4)            4           scalar                    10858,10870,10874,10878           
 KPIP1                      Local  10728    I(4)            4           scalar                    10728,10747,10753,10758,10777,1078
                                                                                                  3,10792,10798,10804,10814,10820,10
                                                                                                  844,10876                         
 KPIP2                      Local  10730    I(4)            4           scalar                    10730,10747,10753,10758,10777,1078
                                                                                                  3,10792,10798,10804,10814,10820,10
                                                                                                  848,10876                         
 KPIP3                      Local  10732    I(4)            4           scalar                    10732,10747,10753,10758,10777,1078
                                                                                                  3,10792,10798,10804,10814,10820,10
                                                                                                  852,10876                         
 KPIP4                      Local  10734    I(4)            4           scalar                    10734,10741,10743,10747,10753,1075
                                                                                                  4,10758,10778,10784,10792,10798,10
                                                                                                  804,10814,10820,10856,10869,10873,
                                                                                                  10876                             
 KREDTV                     Scalar 10573    I(4)            4     1     2        COM                                                
 KSEATV                     Scalar 10573    I(4)            4     1     2        COM                                                
 KSKPMI                     Scalar 10584    I(4)            4           scalar   COM                                                
 KSKPTV                     Scalar 10572    I(4)            4     1     2        COM                                                

Page 257         Source Listing                  FILLX
2017-04-18 11:09 Symbol Table                    prepdata.f

 Name                       Object Declared Type            Bytes Dimen Elements Attributes       References                        
                                                                                                                                    
 KSKSWD                     Scalar 10582    I(4)            4     1     10       COM                                                
 KTIMM                      Scalar 10583    I(4)            4     1     4        COM                                                
 KTIMTV                     Scalar 10572    I(4)            4     1     2        COM                                                
 LEVELS                     Common 10568                                4                                                           
 LL                         Dummy  10543    I(4)            4           scalar   ARG,INOUT        10609,10612,10679,10681           
 LPIC1                      Local  10860    I(4)            4           scalar                    10860,10878                       
 LPIC2                      Local  10862    I(4)            4           scalar                    10862,10878                       
 LPIC3                      Local  10864    I(4)            4           scalar                    10864,10878                       
 LPIC4                      Local  10866    I(4)            4           scalar                    10866,10878                       
 LPIP1                      Local  10735    I(4)            4           scalar                    10735,10748,10754,10759,10778,1078
                                                                                                  4,10793,10799,10805,10815,10821,10
                                                                                                  859,10877                         
 LPIP2                      Local  10736    I(4)            4           scalar                    10736,10748,10754,10759,10778,1078
                                                                                                  4,10793,10799,10805,10815,10821,10
                                                                                                  861,10877                         
 LPIP3                      Local  10737    I(4)            4           scalar                    10737,10748,10754,10759,10778,1078
                                                                                                  4,10793,10799,10805,10815,10821,10
                                                                                                  863,10877                         
 LPIP4                      Local  10738    I(4)            4           scalar                    10738,10748,10754,10759,10778,1078
                                                                                                  4,10793,10799,10805,10815,10821,10
                                                                                                  865,10877                         
 MAXOBS                     Param  10550    I(4)            4           scalar                    10559,10565                       
 MIN                        Func   10614                                scalar                    10614,10790                       
 MISWCH                     Common 10583                                264                                                         
 MLEV                       Scalar 10568    I(4)            4           scalar   COM              10610,10612,10614,10659,10665,1071
                                                                                                  5,10831,10832                     
 MOBS                       Scalar 10563    I(4)            4     3     10800    COM              10722,10723,10724,10725,10726,1072
                                                                                                  8,10730,10732,10734,10735,10736,10
                                                                                                  737,10738,10835,10836,10837,10838,
                                                                                                  10839,10840,10841,10842,10844,1084
                                                                                                  6,10848,10850,10852,10854,10856,10
                                                                                                  858,10859,10860,10861,10862,10863,
                                                                                                  10864,10865,10866                 
 MOD                        Func   10603                                scalar                    10603,10735,10736,10737,10738,1083
                                                                                                  2,10859,10860,10861,10862,10863,10
                                                                                                  864,10865,10866                   
 MODKNT                     Local  10595    I(4)            4           scalar                    10595,10603,10608,10626           
 MODPRT                     Scalar 10570    I(4)            4           scalar   COM              10601,10602                       
 MP_PROCESS                 Scalar 10566    I(4)            4           scalar   COM                                                
 MSLTB1                     Local  10556    CHAR            10          scalar                    10637,10643,10657,10718,10771,1082
                                                                                                  6                                 
 MSLTB2                     Local  10556    CHAR            10          scalar                    10657,10826                       
 MSLTT1                     Local  10556    CHAR            10          scalar                    10636,10642,10656,10718,10771,1082
                                                                                                  5                                 
 MSLTT2                     Local  10556    CHAR            10          scalar                    10656,10825                       
 MXBLVL                     Param  10549    I(4)            4           scalar                    10587                             
 MXLVL                      Param  10547    I(4)            4           scalar                    10560,10563,10614                 
 MXPWT                      Param  10548    I(4)            4           scalar                    10561                             
 MXTYPV                     Param  10545    I(4)            4           scalar                    10561,10562,10563                 
 MXWRDH                     Param  10544    I(4)            4           scalar                    10567                             
 MXWRDL                     Param  10546    I(4)            4           scalar                    10563                             
 NEWPRT                     Local  10602    I(4)            4           scalar                    10602,10603                       
 NFILE                      Scalar 10569    I(4)            4           scalar   COM              10645,10646,10658,10717,10751,1075
                                                                                                  7,10762,10776,10790,10797,10803,10
                                                                                                  813,10884,10895,10907             

Page 258         Source Listing                  FILLX
2017-04-18 11:09 Symbol Table                    prepdata.f

 Name                       Object Declared Type            Bytes Dimen Elements Attributes       References                        
                                                                                                                                    
 NINT                       Func   10625                                scalar                    10625,10659,10660,10665,10666,1068
                                                                                                  6,10691,10694,10704,10718,10772,10
                                                                                                  778,10779,10784,10785,10793,10794,
                                                                                                  10799,10805,10806,10807,10815     
 NOBS3                      Scalar 10587    I(4)            4     1     7        COM                                                
 NSLEV                      Local  10831    I(4)            4           scalar                    10831,10832,10833,10834,10836,1083
                                                                                                  8,10840,10842,10846,10850,10854,10
                                                                                                  858,10860,10862,10864,10866,10870,
                                                                                                  10874                             
 NUMOBS2                    Param  10551    I(4)            4           scalar                    10587,10791,10794                 
 OBS2                       Scalar 10587    R(4)            4     1     43       COM              10718,10772,10791,10794           
 OBS3                       Scalar 10587    R(4)            4     3     8925     COM                                                
 OBS8_8                     Scalar 10553    R(8)            8     1     2        COM                                                
 OZONE                      Scalar 10574    R(4)            4           scalar   COM              10886,10897                       
 PARM6                      Common 10570                                32                                                          
 PCAT                       Scalar 10579    R(4)            4           scalar   COM              10778,10784                       
 PHIACF                     Scalar 10578    R(4)            4     1     7        COM                                                
 PHISWN                     Scalar 10580    R(4)            4     1     7        COM                                                
 PMAND                      Scalar 10565    R(4)            4     1     23       COM                                                
 POAF                       Scalar 10578    R(4)            4           scalar   COM              10778,10784                       
 PRSS                       Scalar 10586    R(4)            4           scalar   COM              10694,10704                       
 PWAT                       Scalar 10561    R(4)            4     2     15       COM              10691,10694,10704                 
 QIFN                       Scalar 10582    R(4)            4           scalar   COM              10790,10793                       
 QIFY                       Scalar 10582    R(4)            4           scalar   COM              10790,10793                       
 RADANC                     Common 10574                                320                                                         
 RDATA                      Scalar 10565    R(4)            4     1     3500     COM              10698,10699                       
 RDATA2                     Scalar 10587    R(4)            4     1     25       COM              10666,10799,10800,10805,10806,1080
                                                                                                  7,10815,10816                     
 REQV                       Scalar 10564    R(4)            4           scalar   COM              10683,10807                       
 RFFL                       Scalar 10582    R(4)            4           scalar   COM              10790,10793                       
 RIALR                      Scalar 10579    R(4)            4           scalar   COM              10785                             
 ROLF                       Scalar 10579    R(4)            4           scalar   COM              10785                             
 RPTHDR                     Common 10567                                88                                                          
 RTRAD                      Scalar 10574    R(4)            4     1     35       COM              10890,10901                       
 SATSW3                     Common 10580                                11604                                                       
 SAZANG                     Scalar 10574    R(4)            4           scalar   COM              10886,10897,10911                 
 SFCBFR                     Common 10586                                8                                                           
 SKINT                      Scalar 10575    R(4)            4           scalar   COM              10886,10897,10911                 
 SOZANG                     Scalar 10574    R(4)            4           scalar   COM              10886,10897,10911                 
 SRAD                       Scalar 10583    R(4)            4     1     7        COM              10672                             
 STNID                      Scalar 10554    CHAR            8           scalar   COM              10607,10659,10665,10908,10909     
 STNPRT                     Scalar 10554    CHAR            8     1     3        COM              10607,10608                       
 STRCTY                     Common 10560                                2400                                                        
 STRMOB                     Common 10563                                43200                                                       
 STRMSL                     Common 10562                                12                                                          
 STRPWT                     Common 10561                                60                                                          
 STRRRT                     Common 10564                                4                                                           
 SUBSET_D                   Scalar 10554    CHAR            8           scalar   COM                                                
 SWINDO_E                   Scalar 10580    R(4)            4     3     480      COM                                                
 SWINDO_L                   Scalar 10581    R(4)            4     3     480      COM                                                
 SWNLND                     Scalar 10580    R(4)            4     3     480      COM                                                
 TOVBFR                     Scalar 10571    R(4)            4     1     2        COM                                                
 TOVEDS                     Scalar 10552    L(4)            4     1     2        COM              10645,10646                       
 TOVRAD                     Scalar 10552    L(4)            4           scalar   COM              10885,10896                       
 TOVRTV                     Scalar 10575    R(4)            4           scalar   COM                                                

Page 259         Source Listing                  FILLX
2017-04-18 11:09 Symbol Table                    prepdata.f

 Name                       Object Declared Type            Bytes Dimen Elements Attributes       References                        
                                                                                                                                    
 TR80KM                     Scalar 10571    R(4)            4           scalar   COM                                                
 TRBX                       Scalar 10578    R(4)            4     1     5        COM              10779,10785                       
 TSLTB1                     Local  10555    CHAR            9           scalar                    10635,10641,10655,10718,10771,1082
                                                                                                  6                                 
 TSLTB2                     Local  10555    CHAR            9           scalar                    10655,10826                       
 TSLTT1                     Local  10555    CHAR            9           scalar                    10634,10640,10654,10718,10771,1082
                                                                                                  5                                 
 TSLTT2                     Local  10555    CHAR            9           scalar                    10654,10825                       
 TVSWCH                     Common 10571                                108                                                         
 UNITNO                     Common 10569                                116                                                         
 W3FIZZ                     Subr   10617                                                          10617                             
 WRMISS                     Scalar 10566    R(4)            4           scalar   COM                                                
 XTRHD2                     Common 10589                                27                                                          
 XWINDO                     Scalar 10583    R(4)            4     2     24       COM                                                
 YMISS                      Local  10593    R(4)            4           scalar                    10593,10698,10746,10791           
 ZSLTB1                     Local  10556    CHAR            10          scalar                    10633,10649,10652,10718,10771,1082
                                                                                                  5                                 
 ZSLTB2                     Local  10557    CHAR            10          scalar                    10652,10826                       
 ZSLTT1                     Local  10556    CHAR            10          scalar                    10632,10648,10653,10718,10771,1082
                                                                                                  5                                 
 ZSLTT2                     Local  10556    CHAR            10          scalar                    10653,10825                       

Page 260         Source Listing                  FILLX
2017-04-18 11:09                                 prepdata.f

  10926 C$$$  SUBPROGRAM DOCUMENTATION BLOCK
  10927 C
  10928 C SUBPROGRAM:    GETC06
  10929 C   PRGMMR: Keyser           ORG: NP22        DATE: 2016-11-30
  10930 C
  10931 C ABSTRACT: RETRIEVES SINGLE LEVEL {AIRCRAFT FLIGHT-LEVEL, SATWND (ALL
  10932 C   TYPES), RECCO} REPORTS FROM DATA LEVEL CAT. 6.  RECCOS MAY INCLUDE
  10933 C   EITHER A MANDATORY LEVEL GEOPOTENTIAL OBS OR A MEAN SEA-LEVEL
  10934 C   PRESSURE OBS IF SUFFICIENTLY "NEAR" A MANDATORY PRESSURE LEVEL OR
  10935 C   THE SURFACE.  CALLS FILLX TO WRITE REPORT TO PREPBUFR FILE.
  10936 C
  10937 C PROGRAM HISTORY LOG:
  10938 C   UNKNOWN
  10939 C 1988-04-11  D. A. KEYSER -- DOCBLOCKING/COMMENTING
  10940 C 1988-08-24  D. A. KEYSER -- SATWNDS FROM NAT. HURRICANE CENTER P-LVL
  10941 C     CHANGED FROM 850 MB TO 900 MB
  10942 C 1988-10-28  D. A. KEYSER -- SUBR. NAME CHGED FROM 'AIRCFT' TO 'GETC06'
  10943 C 1989-03-15  D. A. KEYSER -- ADDED SWITCH 'PGCALM' (=T PURGES CALM
  10944 C     AIRCRAFT FLIGHT LEVEL WIND REPORTS)
  10945 C 1989-12-13  D. A. KEYSER -- REPORT SUB-TYPE DETERMINATION MOVED FROM
  10946 C     SUBR. 'PREP' TO HERE; HANDLES MASS PIECE AS WELL AS WIND PIECE;
  10947 C     QM FOR ACFT PIREP ('P????P', 'XX999 ') WINDS BUMPED FROM 1 OR 2
  10948 C     TO 3
  10949 C 1990-01-04  D. A. KEYSER -- FUNCTION PR(Z) BETTER DEFINED
  10950 C 1990-01-11  D. A. KEYSER -- CONVERTED TO VS FORTRAN(77) & RESTRUCTURED
  10951 C 1990-02-06  D. A. KEYSER -- ADDED NEW SWITCH 'PHISWN' TO CATEGORIZE
  10952 C     SAT. RPTS (CAT. 6) ACCORDING 6 TO LAT. BANDS
  10953 C 1990-07-11  D  A. KEYSER -- HONORS NEW AIRCFT Q. MARKS, AIRCFT FILE
  10954 C     CHECKED IN 'PREPACFT' PRIOR TO THIS PGM; SWITCH 'PGCALM' NO
  10955 C     LONGER NEEDED, REMOVED; SWITCH 'FGGE' REMOVED FROM N-LIST (FALSE)
  10956 C 1991-01-03  D. A. KEYSER -- INSAT RPTS MISPLACED (NORTH OF 40N) ARE
  10957 C     TOSSED
  10958 C 1992-07-01  D. A. KEYSER -- CAN PROCESS NESDIS GRADIENT WINDS FROM
  10959 C     SATWND FILE, WITH OI/SSI R. TYPE 244/254 (LO/HI)
  10960 C 1992-07-09  D. A. KEYSER -- NOBS ARRAY NOT FILLED W/ VARIABLE IF
  10961 C     IF .GT. 32767
  10962 C 1992-08-07  D. A. KEYSER -- THE QUALITY MARK FOR BOTH MASS (TEMP)
  10963 C     AND WIND FOR CONV'L/AMDAR AIRCFT COMING FROM RAW PROD AIRCFT
  10964 C     UNPKD ON29 D-SET IS NOW OBTAINED FROM THE FIRST Q.M. POSITION
  10965 C     RATHER THAN THE SECOND OR FOURTH POSITION FOR TEMP & WIND, RESP.;
  10966 C     THE TEST FOR AMDAR AIRCRAFT REPORTS NO LONGER LOOKS FOR AN 'A'
  10967 C     IN THE 6'TH POSITION OF THE STN. ID (ONLY LOOKS FOR 'Z'); ADDED
  10968 C     GEOGRAPHICAL TEST TO N-LIST SWITCH "AWINDO" (TIME WINDOW CAN VARY
  10969 C     BASED ON IN/OUTSIDE U.S. MAINLAND/ADJOINING REGIONS); ADDED
  10970 C     N-LIST SWITCH "PGAFUS" TO ALLOW CONV'L AIREP/PIREP ACFT FLT LVL
  10971 C     RPTS OVER U.S. MAINLAND/ADJOINING REGIONS TO BE TOSSED IF .GT.
  10972 C     100 MDCRS RPTS HERE
  10973 C 1992-12-02  D. A. KEYSER -- IMPR. STD O-PUT (UNIT 6) PRINT RE: CAT. 6
  10974 C     MASS/WIND RPTS W/ BAD/MSG DATA; ACFT RPTS W/ BAD/MSG TEMP NO
  10975 C     LONGER PROCESS MASS PIECE (PREPDA); MDCRS RPTS USE NEW, EXPAND.
  10976 C     Q.M. (MARKN), CHGS. SSI/OI Q.M. ON MDCRS WIND FROM 2 TO 1
  10977 C 1993-05-12  D. A. KEYSER -- SET-UP EXPANDED REPORT FORMAT, WORD 2 FOR
  10978 C     EACH MASS/WIND LVL IS PRESS. X 10MB, NEW WORD 5 FOR EACH LEVEL
  10979 C     CONTAINS 4 PACKED "PREPBUFR TBL VALUES" WHICH CAN RANGE FROM 0-15
  10980 C     AND CORRESPOND TO ON29 Q. MARKERS OR PREPRO-GENERATED Q. MARKERS;
  10981 C     ALL NON-MISSING DATA ARE NOW PACKED INTO PREPBUFR FILE REGARDLESS
  10982 C     OF QUALITY; HIGH LEVEL PRESSURES (MB * 10) NOW ROUNDED TO NEAREST

Page 261         Source Listing                  FILLX
2017-04-18 11:09                                 prepdata.f

  10983 C     WHOLE NUMBER RATHER THAN TRUNCATED WHEN CONVERTED TO INTEGER
  10984 C 1993-05-31  D. A. KEYSER -- REDEFINED AND ADDED NEW OI/SSI R. TYPES
  10985 C     FOR ALL VALID SATWND PRODUCER/SATELLITE/PRODUCT COMB.; EACH
  10986 C     SATWND REPORT NOW IDENTIFIED EXPLICITLY BY PRODUCER/SATELLITE
  10987 C     COMBINATION AND BY PRODUCT, THESE ARE USED TO TEST EXPANDED
  10988 C     3-DIM. N-LIST SWITCHES "SWINDO", "SWNLND", "JSWIND", AND "JSMASS"
  10989 C     TO DETERMINE IF SATWND RPT. IS TO BE PROCESSED
  10990 C 1993-10-07  D. A. KEYSER -- MSG VALUE IN NOBS ARRAY IS 99999, ACTUAL
  10991 C     HEIGHT (NO D-VAL) STORED IN NOBS ARRAY
  10992 C 1993-11-02  D. A. KEYSER -- ADDED N-LIST SWITCH 'RECSLM' TO PROCESS
  10993 C     (=T) OR NOT PROCESS (=F) CAT. 6 RECCO MASS LEVELS (DEF= T); ALL
  10994 C     CAT. 6 LEVEL DATA NOW STORE ON29 CAT. IN MOIST. TBL VAL. SLOT;
  10995 C     FOLLOWING PERTAINS TO SINGLE-LVL CAT. 1 RECCOS: NO LONGER O-PUT
  10996 C     SFC. PRESS. (ONLY) IN 1ST LVL OF MASS/WIND RPT; NOW PROCESSED IN
  10997 C     THIS SUBROUTINE; MAND. P-LVL STILL INCL. GEOPOT. BUT TEMP,
  10998 C     MOIST., WIND & ELEV NOW TREATED ON 2ND LVL LIKE CAT. 6 (PRESS.
  10999 C     EST. FROM GEOPOT., ELEV, AND TEMP); VARIABLE IFLC6 WHEN SET 1
  11000 C     WILL FLAG ALL VARIABLES WITH PREPBUFR T. VALUE=15
  11001 C 1993-12-21  D. A. KEYSER -- CAT. 6 WIND LVLS NOW HOLD P-ALT IN WORD 1
  11002 C     OF LVL INFO (NOBS) W/ TBL. VAL. IN POSITION 3 OF WORD 5 (BOTH
  11003 C     WERE MISSING)
  11004 C 1994-07-19  D. A. KEYSER -- FOLLOWING PERTAINS TO SINGLE-LVL CAT.
  11005 C     2/3 RECCOS: NO LONGER O-PUT SFC. PRESS. (ONLY) IN 1ST LVL OF
  11006 C     MASS/WIND RPT; NOW PROCESSED IN SUBR. 'GETC06'; PSTN-LVL STILL
  11007 C     INCL. BUT GEOPOT. NOW ZERO RATHER THAN 'ELEV' ALSO TEMP, MOIST.,
  11008 C     WIND & ELEV NOW TREATED ON 2ND LVL LIKE CAT. 6 (PRESS. EST. FROM
  11009 C     GEOPOT., ELEV, AND TEMP)
  11010 C 1994-08-11  D. A. KEYSER -- WORDS 6 AND 7 OF MASS LVL NOW CONTAIN
  11011 C     SENS. TEMP AND DWPT TEMP, RESP. WHILE WORDS 6 AND 7 OF WIND LVL
  11012 C     CONTAIN WIND DIR. AND SPEED, RESP.; ALSO WORD 3 OF MASS LVL NOW
  11013 C     CONTAINS "REPORTED" TEMP ADDED N-LIST SWITCH 'IACARL' TO INDICATE
  11014 C     FLOOR (METERS) FOR MDCRS; CONV'L/AMDAR QCACFT WSPD INCR. Q.M. NOW
  11015 C     KEPT IN COMMON FOR EA. REPORT; RPT SEQ. NO. NOW STORED IN WORD 12
  11016 C     OF HDR FOR CONV'L/AMDAR AIRCFT (=KOUNT)
  11017 C 1995-07-12  D. A. KEYSER -- SATWND TEMPS HI- & LO-LVL NOW COMBINED
  11018 C     IN R. TYPES 140-149; GOES-EVN & GOES-ODD SATWND SATWND (MASS/
  11019 C     WIND) R.TYPES NOW SEPARATE; ADDED N-LIST SWITCH "PHIACF", DEFINES
  11020 C     LAT. BANDS FOR SELECTING ACFT RPTS; EXPAND. N-LIST SWITCHES
  11021 C     "AIRLND", "JAWIND", "JAMASS" TO (6,4) ARRAYS TO SELECT BY LAT.
  11022 C     BAND
  11023 C 1995-08-24  D. A. KEYSER -- R.T. 132 CAT.2 SNGL-LVL RECCOS SFC. DATA
  11024 C     (PMSL, Z) FLAGGED FOR NON-USE BY ANAL. (USED LATER AS R.T 182)
  11025 C 1996-02-07  D. A. KEYSER -- NAMELIST SWITCHES 'JSMASS' AND 'JSWIND'
  11026 C     NOW HAVE MORE POSSIBLE VALUES THAN 0 OR 9999, THIS ALLOWS
  11027 C     CERTAIN COMBINATIONS OF SATELLITE PRODUCERS/PRODUCTS AND EVEN
  11028 C     CERTAIN GOES-EVEN AND ODD SATELLITE NUMBERS TO BE PROCESSED BUT
  11029 C     FLAGGED FOR NON-USE BY THE ANALYSIS; NOW RECOGNIZES THAT GOES
  11030 C     SATWND STNID SUFFIX CHARACTER DIFFERS FOR EVERY-OTHER ODD ('A'
  11031 C     OR 'C') OR EVEN ('B' OR 'D') SATELLITE
  11032 C 1996-03-04  D. A. KEYSER -- FOR RGL-BUFR OUTPUT: MORE FIXES TO MAKE
  11033 C     BUFR-PREPDA FILE CONTAIN DATA EXPECTED BY FERR PGM & OI-ANAL
  11034 C     (PRESSURE ENCODED IN BUFR IS TO NEAREST WHOLE MILLIBAR W/ ZERO IN
  11035 C     TENTHS)
  11036 C 1996-09-03  D. A. KEYSER -- ADDED PROCESSING FOR NESDIS HI-DENSITY
  11037 C     SAT. WINDS (SWITCHES "SWINDO", "SWNLND", "JSWIND", "JSMASS"
  11038 C     EXPANDED), R.TYPES EXPANDED; CAN READ WSPD IN M/SEC X 10 FROM
  11039 C     ON29 CAT.8, C.FIG. 924 IF AVAILABLE

Page 262         Source Listing                  FILLX
2017-04-18 11:09                                 prepdata.f

  11040 C 1997-01-31  D. A. KEYSER -- AIRCRAFT DATA CAN NOW BE FLAGGED OR
  11041 C     TOSSED IF BELOW "FLOOR" OR WIND IS MISSING
  11042 C 1997-06-02  D. A. KEYSER -- AMDAR ACFT REPORTS NOW IDENTIFIED BY
  11043 C     LOGICAL SWITCH "AMDAR" (SET IN SUBR. UNPREP) RATHER THAN BY A 'Z'
  11044 C     IN 6'TH POSITION OF STNID SINCE STNID AT THIS POINT NOW CONTAINS
  11045 C     ACTUAL AMDAR STNID (UP TO 8-CHARACTERS, NO LONGER 'Z' IN 6'TH POS.
  11046 C     OF STNID)
  11047 C 1997-10-06  D. A. KEYSER -- ADDED LOGIC TO PROCESS NEW TYPES OF
  11048 C     NESDIS HI-DENS SATWNDS
  11049 C 1998-02-17  D. A. KEYSER -- WSPD IN M/SEC * 10 NOW READ DIRECTLY FROM
  11050 C     CAT 6. (NOT CAT. 8), SAME FOR PRESSURE (IF NON-MSG, ELSE CALC.
  11051 C     FROM P-ALT AS BEFORE); REMOVED LOGIC RE: FLAGGING AIREP/PIREP
  11052 C     OVER CONUS; AMDAR AIRCFT PHASE OF FLT. INDIC. NOW USED TO STORE
  11053 C     SPECIAL REPORT SUB-TYPE IN HDR(8)
  11054 C 1998-06-15  D. A. KEYSER -- STREAMLINED THE PROCESSING OF CAT. 6
  11055 C     RECCOS W/ EITHER MAND LVL GEOPOT. OBS OR MEAN SEA-LVL PRESS. OBS
  11056 C 1999-08-04  D. A. KEYSER -- ADDED STORAGE (FOR LATER ENCODING) OF
  11057 C     PHASE OF FLIGHT (POAF) FOR ALL ACFT TYPES AND DEGREE OF
  11058 C     TURBULENCE (DGOT) FOR NON-MDCRS ACFT TYPES; ADDED PROCESSING OF
  11059 C     MDCRS MOISTURE DATA; FOREIGN SATWND SWITCHES NOW CONTROL IR
  11060 C     C-DRFT AND VIS. C-DRFT SEPARATELY (STILL SAME R.TYPES); ADDED
  11061 C     PROCESSING OF FOREIGN WATER VAPOR SATWNDS WITH NEW R.TYPES 250
  11062 C     (GMS), 254 (EUMETSAT), AND 256 (INSAT)
  11063 C 2000-02-17  D. A. KEYSER -- ADDED STORAGE (FOR LATER ENCODING) OF
  11064 C     NESDIS RECURSIVE FILTER FLAG (RFFL) FOR NESDIS (GOES) SATWND
  11065 C     TYPES; MOVED GOES SATWND Q.M. ASSIGNMENT BASED ON RFFL FROM
  11066 C     SUBROUTINE IW3UNPBF TO THIS SUBROUTINE
  11067 C 2000-12-05  D. A. KEYSER -- RECOGNIZES SATWIND REPORTS WITH NEW
  11068 C     8-CHAR. STNID FORMAT; ALL CAT. 6 TYPES NOW STORE SPEC. HUMIDITY
  11069 C     AS MOISTURE VARIABLE RATHER THAN DEWPOINT DEPR.
  11070 C 2001-04-06  D. A. KEYSER -- PRINTS DIAG. IF TDEW < TDLIM FOR MDCRS;
  11071 C     N-LIST SWITCH SWINDO SPLIT INTO SWINDO_e (EARLIEST TIME WINDOW)
  11072 C     AND SWINDO_l (LATEST TIME WINDOW) FOR SATWND REPORTS ("-" PRIOR
  11073 C     TO CYCLE TIME, "+" AFTER CYCLE TIME) (SAME DEFAULTS AS BEFORE);
  11074 C     SUBR. "RPTLBL" NOW HAS INPUT ARGS. "TIMWIN_e" (EARLIEST TIME
  11075 C     WINDOW) AND "TIMWIN_l" (LATEST TIME WINDOW) REPL. "TIMWIN" (+/-
  11076 C     TIME WINDOW) ("-" PRIOR TO CYCLE TIME, "+" AFTER CYCLE TIME),
  11077 C     ALLOWS THE 2 TO BE DIFFERENT; READS IN THE 4 MDCRS TURBULENCE
  11078 C     INDECES
  11079 C 2001-06-19  D. A. KEYSER -- NEW SUBR. "TIMCHK" DOES TIME WINDOW CHECK
  11080 C     SEPARATE FROM "RPTLBL"
  11081 C 2001-09-14  D. A. KEYSER -- REPORT SEQ. NUMBER STORED IN HDR(11) FOR
  11082 C     SATELLITE-DERIVED WIND REPORTS LATER ENCODED IN PREPBUFR FILE
  11083 C     UNDER MESSAGE TYPE "SATWND", AND FOR RECCOS LATER ENCODED UNDER
  11084 C     MESSAGE TYPE "ADPUPA" (RECCO SEQ. NUMBER WILL BEGIN WHERE RAOBS/
  11085 C     PIBALS/DROPS LEFT OFF IN "ADPUPA")
  11086 C 2002-01-14  D. A. KEYSER -- ADDED N-LIST SWITCH "IACFTH" WHICH ALLOWS
  11087 C     AIRCRAFT DATA TO BE FLAGGED IF ABOVE A LIMITING ALTITUDE; LEVELS
  11088 C     WITH CALC. DWPT < "TDLIM" VALUE NOW RETAIN SPEC. HUM AND CALC.
  11089 C     DWPT IN PREPBUFR FILE, BUT MOISTURE PREPBUFR TBL VALUE IS FLAGGED
  11090 C     WITH Q.M.=15 IN SUBR. FIZZ01 (BEFORE, SPEC. HUM. AND DWPT SET TO
  11091 C     MISSING) VIRT. TEMP. CALC. AND ENCODED IN THIS CASE  (BEFORE, SET
  11092 C     TO SENSIBLE TEMP.)
  11093 C 2002-01-28  D. A. KEYSER -- READS PRECISION OF TEMP. OBS. OUT OF
  11094 C     "AIRCAR" AND "AIRCFT" DUMP FILES (CAT. 8, CODE FIG. 915) (LATER
  11095 C     ENDCODED INTO PREPBUFR FILE)
  11096 C 2004-09-09  D. A. KEYSER -- ADDED PROCESSING OF EAMDAR ACFT RPTS NOW

Page 263         Source Listing                  FILLX
2017-04-18 11:09                                 prepdata.f

  11097 C     POSSIBLY INCL. IN "AIRCFT" DUMP FILE DUMP R. TYPE 41, SUBTYPE 6,
  11098 C     INCL. WITH EXISTING PREPBUFR R. TYPES 131/231, PROCESSED INTO
  11099 C     PREPBUFR FILE UNDER EXISTING TBL A ENTRY "AIRCFT"; ADDED
  11100 C     PROCESSING OF NASA/MODIS POES AQUA/TERRA SATELLITE-DERIVED WINDS,
  11101 C     NOW POSSIBLY INCL. IN "SATWND" DUMP FILE EXISTING DUMP R. TYPE
  11102 C     63, GET PREPBUFR R. TYPES 257 (IR), 258 (W.VAPOR IMGR CLOUD-TOP)
  11103 C     AND 259 (W.WAPOR IMGR DEEP LAYER), PROCESSED INTO PREPBUFR FILE
  11104 C     UNDER EXISTING TBL A ENTRY "SATWND"; NOW RETURNS 41-WORD (RATHER
  11105 C     THAN 2-WORD) ARRAY "OBS2" OUT OF CALL TO IW3UNPBF, WHERE WORDS
  11106 C     3-41 CONTAIN ALTIMETER SETTING, SEA-SURFACE TEMPERATURE, SINGLE-
  11107 C     LEVEL SENSIBLE WEATHER ELEMENTS AND SST TABLE VALUE (Q.M.);
  11108 C     RETURNS NEW ARRAY ARGUMENTS "OBS3" {(5,MXBLVL,5)} AND "NOBS3"
  11109 C     {(5)} OUT OF CALL TO IW3UNPBF WHERE OBS3 CONTAINS MULTIPLE-LEVEL
  11110 C     SENSIBLE WEATHER ELEMENTS AND NOBS3 DEFINES THE NUMBER OF LEVELS
  11111 C     OF DATA IN THE OBS3(X,Y,1) TO OBS3(X,Y,5) ARRAYS (SEE IW3UNPBF
  11112 C     DOCBLOCK FOR MORE INFO); ALL NEW PARAMETERS (I.E., SST AND
  11113 C     SENSIBLE WEATHER ELEMENTS) IN OBS2 AND OBS3 ARE ENCODED INTO
  11114 C     PREPBUFR FILE, BUT ONLY IN THE MASS "PIECE" OF A REPORT (UNLESS
  11115 C     THERE IS NO MASS PIECE, THEN THEY ARE ENCODED INTO WIND PIECE)
  11116 C 2005-07-01  D. A. KEYSER -- NOW STORES A VALUE 1 INTO REPORT SUBTYPE
  11117 C     (HEADER WORD 8) FOR RECCO REPORTS IN REPORT TYPE 132/232 - LATER
  11118 C     GETS ENCODED INTO PREPBUFR UNDER MNEMONIC "TSB" (SUBR. PREP
  11119 C     STORES THIS AS 2 FOR DROPS - THIS ALLOWS DROPS AND RECCOS TO BE
  11120 C     DIFFERENTIATED IN PREPBUFR)
  11121 C 2006-11-29  D. A. KEYSER -- MODIFIED EUMETSAT PROCESSING TO CONSIDER
  11122 C     "ODD" AND "EVEN" SATELLITES SEPARATELY FOR PROCESS/NO-PROCESS/
  11123 C     FLAG ALL/FLAG EVERY-OTHER (N-LIST SWITCHES "JSMASS"/"JSWIND"),
  11124 C     TIME WINDOW ("SWINDO_e"/"SWINDO_l"), LAND/NO-LAND ("SWNLND"), ALL
  11125 C     BY LAT BAND AND PRODUCT TYPE
  11126 C 2007-09-14  D. A. KEYSER -- ACCOUNTS FOR HIGH-DENSITY JMA SATELLITE
  11127 C     WINDS DERIVED FROM BUFR BULLETINS IN NC005044-NC005046 CONTAINING
  11128 C     RFF QUALITY INDICATOR, THE Q.C. TESTS FOR RFF ARE LIMITED ONLY TO
  11129 C     THE NESDIS GOES AND NASA/POES SATWINDS AT THIS TIME; MODIFIED TO
  11130 C     PROCESS TAMDAR AND CANADIAN AMDAR AIRCRAFT REPORTS (FORMER GET
  11131 C     PREPBUFR REPORT TYPE 134/234 AND ENCODES NEW PARAMETERS "TRBX"
  11132 C     AND "ROLF" INTO PREPBUFR FILE; LATTER GET PREPBUFR REPORT TYPE
  11133 C     135/125); IF AIFNOW=FALSE, NOW FLAGS ALL ACFT REPORTS AS BAD IF
  11134 C     WIND IS MISSING BUT TEMP IS PRESENT (USED TO FLAG ONLY MDCRS
  11135 C     HERE AND TOSS ALL OTHER TYPES DUE TO CONCERN ABOUT PREPACQC),
  11136 C     POINT IS MOOT BECAUSE AIFNOW NOW SET TO TRUE TO PROCESS ALL ACFT
  11137 C     TYPE TEMP REPORTS WHEN WIND DATA ARE MISSING; NOW FLAGS ALL ACFT
  11138 C     REPORTS BELOW "FLOOR" LEVEL (USED TO FLAG ONLY MDCRS HERE AND TOSS
  11139 C     ALL OTHER TYPES DUE TO CONCERN ABOUT PREPACQC); NOW HANDLES
  11140 C     SATWINDS FROM NEW INDIAN KALPANA SATELLITE (REPORTS HAVE SUFFIX
  11141 C     CHARACTER "K" IN STATION ID); ACCOUNTS FOR EUMETSAT MSG
  11142 C     (METEOSAT-8 AND UP) SATWINDS CONTAINING RFF QUALITY INDICATOR;
  11143 C     ADDED READING IN OF PERCENT CONFIDENCE BASED ON - EUMETSAT QUALITY
  11144 C     INDEX WITH FORECAST CONSISTENCY TEST (FROM CAT. 8 CODE TABLE 356),
  11145 C     EUMETSAT QUALITY INDEX WITHOUT FORECAST CONSISTENCY TEST (FROM
  11146 C     CAT. 8 CODE TABLE 357) AND NESDIS EXPECTED ERROR (FROM CAT. 8 CODE
  11147 C     TABLE 358) FOR SATWND TYPES; CASES WHERE OBS ARE SET TO QM=15 IN
  11148 C     ORDER TO FLAG A REPORT FOR NON-USE BY ANALYSIS (EVEN THOUGH OBS
  11149 C     MAY NOT NECESSARILY BE BAD) NOW FIRST CHECK TO MAKE SURE OBS QM
  11150 C     ISN'T ALREADY "BAD" (> 3 AND < 15) (PREVENTS GSI FROM MONITORING
  11151 C     TRULY BAD OBS WHICH JUST HAPPEN TO BE IN REPORT GROUPS FLAGGED FOR
  11152 C     NON-USE BY ANALYSIS); THE SINGLE DEGREE OF TURBULENCE VALUE IS NO
  11153 C     LONGER RETURNED FROM IW3UNPBF IN CAT. 8, CODE FIGURE 916, IT HAS

Page 264         Source Listing                  FILLX
2017-04-18 11:09                                 prepdata.f

  11154 C     BEEN REPLACED WITH EXPANDED DEGREE OF TURBULENCE INFORMATION NOW
  11155 C     INCLUDED IN THE MULTIPLE-LEVEL SENSIBLE WEATHER ELEMENT ARRAY OBS3
  11156 C     RETURNED FROM IW3UNPBF; AIRCRAFT REPORTS WITH MISSING WIND AND
  11157 C     TEMP ARE STILL ENCODED INTO PREPBUFR FILE AS A MASS REPORT IF
  11158 C     OTHER ANCILLARY INFO (E.G., SENSIBLE WX ELEMENTS LIKE TURBULENCE,
  11159 C     ICING, CLOUD) IS PRESENT (MAINLY PIREPS) AND NEW N-LIST SWITCH
  11160 C     WRMISS IS TRUE - BEFORE SUCH OBS WITHOUT ANY WIND AND TEMP DATA
  11161 C     WERE ALWAYS SKIPPED
  11162 C 2008-09-25  D. A. KEYSER -- 1-DIM ARRAY OBS2 RETURNED FROM IW3UNPBF
  11163 C     INCREASED FROM 41 TO 42 WORDS TO HOLD MOISTURE QUALITY (CODE
  11164 C     TABLE) FOR MDCRS REPORTS; UPPER LIMIT FOR STORING Q CHANGED FROM
  11165 C     32767 MG/KG TO 99999 MG/KG TO ENSURE THAT LEVELS WITH VERY
  11166 C     HIGH SPECIFIC HUMIDITY ARE PROCESSED (THE 32767 LIMIT WAS A
  11167 C     VESTIGE FROM THE OLD I*2 PREPDA DAYS); IF NEAREST INTEGER FOR Q
  11168 C     IS 0 MG/KG, IT IS RESET TO 1 MG/KG (.001 G/KG) TO ENSURE THAT
  11169 C     LEVELS WITH VERY LOW SPECIFIC HUMIDITY ARE PROCESSED (Q MUST BE >
  11170 C     0 TO BE PROCESSED)
  11171 C 2014-04-25  D. A. Keyser -- For all satellite-derived wind reports,
  11172 C     now encodes PREPBUFR report sub-type (mnemonic "TSB", previously
  11173 C     missing) as BUFR satellite id times 10 plus "Satellite Derived
  11174 C     Wind Computation Method ("SWCM" - BUFR code table 0-02-023),
  11175 C     allows GSI to identify cloud-top vs. deep-layer WV winds and IR
  11176 C     vs. visible winds for METEOSAT and JMA since, unlike NESDIS, both
  11177 C     have same report types (250-JMA & 254-EUMETSAT for WV, 242/252-
  11178 C     JMA & 243/253-EUMETSAT for IR/VIS).
  11179 C 2015-01-30  D. A. Keyser -- All references to IR satellite-derived
  11180 C     winds now expanded to refer to IR "long-wave" - this
  11181 C     differentiates them from IR "short-wave" winds which are now
  11182 C     produced from GOES but are not processed by this program.
  11183 C 2015-03-11  D. A. Keyser -- Corrected bug which was not encoding SQN
  11184 C     (sequence number) properly for AIRCAR type when SQN was > 99998.
  11185 C 2016-02-08  S. Melchior --
  11186 C      - Processes two new aircraft data types in AIRCFT message type:
  11187 C        Korean AMDAR (BUFR) and Catch-all AMDAR (BUFR).  Either pre-
  11188 C        version 7 BUFR or new version 7 BUFR for Catch-All AMDAR,
  11189 C        MDCRS and E-AMDAR can be handled.
  11190 C          - The following arrays' dimensions were increased and
  11191 C            defaults adjusted: AWINDO, AIRLND, JAWIND, JAMASS, IACFTL,
  11192 C            IACFTH, AIFNOW, FLACMS, KSKALM, KSKAHM, KEPAC, KSKNOW,
  11193 C            INAC.
  11194 C      - Fixed a bug which allowed an aircraft report "mass piece" to
  11195 C        be encoded into the PREPBUFR file in cases when everything was
  11196 C        missing other than the restriction indicators (mnemonics RSRD
  11197 C        and EXPRSRD).
  11198 C 2016-09-05  S. Melchior --
  11199 C      - Diagnostic output some print statements formatted to
  11200 C        accommodate increased precision now in latitude and longitude.
  11201 C 2016-10-27  C. Hill --
  11202 C      - TAMDARB AIRCFT message type added to handle BUFR form of TAMDAR
  11203 C        reports.  Allows for older (pre-2011) and newer TAMDAR data to
  11204 C        be processed.  The array sizes of AWINDO, AIRLND, JAWIND, JAMASS,
  11205 C        IACFTL, IACFTH, AIFNOW, FLACMS, KSKALM, KSKAHM, KEPAC, KSKNOW,
  11206 C        and INAC were all increased to (6,9).
  11207 C 2016-11-25  D. A. Keyser --
  11208 C      - Encodes instantaneous altitude rate (IALR) into PREPBUFR file
  11209 C        for TAMDARB reports in report type 134/234 (returned from c.f.
  11210 C        932 in call to IW3UNPBF).

Page 265         Source Listing                  FILLX
2017-04-18 11:09                                 prepdata.f

  11211 C      - Corrected a bug in 2016-10-27 update: TAMDARB reports now get
  11212 C        proper report type 134/234 (were getting 131/231).
  11213 C      - Encode report subtype (TSB) of 1 for new Panasonic TAMDARB
  11214 C        reports (distinguishes them from legacy AirDAT TAMDAR BUFR
  11215 C        reports which had the default TSB value of 0).
  11216 C 2016-11-30  D. A. Keyser --
  11217 C      - Replace machine length lat/lon {HDR(3), HDR(2)} with R*8 lat/
  11218 C        lon (ALAT_8, ALON_8) in some print statements.
  11219 C        BENEFIT: Values are now precise to 10**5 degrees (was not the
  11220 C                 case after 2016-09-05 change above).
  11221 C
  11222 C
  11223 C USAGE:    CALL GETC06(NN,CYCLET,*,*)
  11224 C   INPUT ARGUMENT LIST:
  11225 C     NN       - UPPER-AIR FILE INDICATOR {=1 ADPUPA/RECCO; =2 MDCRS
  11226 C              - AIRCRAFT; =3 AIREP/PIREP, AMDAR, EAMDAR, TAMDAR(M/B),
  11227 C              - CAMDAR, KAMDAR AND AMDARB AIRCRAFT; =4 SATELLITE
  11228 C              - (CLOUD-DRIFT, W. VAPOR, VISIBLE, ETC)}
  11229 C     CYCLET   - CYCLE TIME (IN HOURS UTC)
  11230 C
  11231 C   OUTPUT FILES:
  11232 C     UNIT 06  - STANDARD OUTPUT PRINT
  11233 C
  11234 C REMARKS: CALLED BY SUBROUTINE 'PREP'.
  11235 C
  11236 C ATTRIBUTES:
  11237 C   LANGUAGE: FORTRAN 90
  11238 C   MACHINE:  NCEP WCOSS
  11239 C
  11240 C$$$
  11241       SUBROUTINE GETC06(NN,CYCLET,*,*)
  11242       PARAMETER (MXWRDH = 15)
  11243       PARAMETER (MXTYPV =  3)
  11244       PARAMETER (MXWRDL =  6)
  11245       PARAMETER (MXLVL = 600)
  11246       PARAMETER (MXBLVL = 255)
  11247       PARAMETER (MAXOBS = 3500)
  11248       PARAMETER (NUMOBS2 = 43)
  11249       CHARACTER*8  STNID,CRES1,CRES2,SUBSET_d
  11250       CHARACTER*11 CBULL
  11251       LOGICAL  AIRLND,SWNLND,RECSLM,AIFNOW,FLRECO,WRMISS
  11252       REAL P(100)
  11253       REAL(8)  BMISS,obs8_8,alon_8,alat_8
  11254       INTEGER IDATA(MAXOBS),JNSTR(10,8),MOBS1(MXTYPV,MXWRDL),ISQNUM(4),
  11255      $ ITIMES(4),INAC(9)
  11256       COMMON/STRCTY/ICAT(MXLVL)
  11257       COMMON/STRMOB/MOBS(MXTYPV,MXWRDL,MXLVL)
  11258       COMMON/LNDSEA/GDSH(145,37),GDUS(362,91),GDNH(362,91)
  11259       COMMON/ADP/ISATOB,PMAND(23),RDATA(MAXOBS),IPRINT
  11260       COMMON/DATA/KOUNT,IDATE(4),IDAT10,MP_PROCESS,WRMISS
  11261       COMMON/RPTHDR/SUBSET_d,STNID,HDR(2:MXWRDH),alon_8,alat_8
  11262       COMMON/ACFTSW/AWINDO(2,9),AIRLND(6,9),JAWIND(6,9),JAMASS(6,9),
  11263      $ IACFTL(9),IACFTH(9),PHIACF(7),KEPAC(6,9),AIFNOW(9),POAF,TRBX(5),
  11264      $ FLACMS(9),PCAT,ROLF,aMSTQ,RIALR
  11265       COMMON/SATSW3/PHISWN(7),SWNLND(6,8,10),SWINDO_e(6,8,10),
  11266      $ SWINDO_l(6,8,10),JSWIND(6,8,10),JSMASS(6,8,10),KEPSW(6,8,10),
  11267      $ KSKSWD(10),RFFL,QIFY,QIFN,EEQF

Page 266         Source Listing                  GETC06
2017-04-18 11:09                                 prepdata.f

  11268       COMMON/UPALIM/LEVPM,LEVST,LEVQQ,TDLIM,TDMAX,SPCIAL,ISQNUM_UPA
  11269       COMMON/PARM3/RECCON,RWINDO,UWINDO,RECSLM,FLRECO,VWINDO,VADWIN,
  11270      $ IVADFL,IVADSP,FLDMGS,FLDMAF,FLDMFR,DROPSN,DWINDO
  11271       COMMON/SKPCNT/KSKPUA,KSKPSF,KMSGUA,KMSGSF,KBDYUA,KBDYSF,KTIMUA,
  11272      $ KTIMSF,KSKNSW,KSKREC,KNOATS,KNTUPA,KNTCAR,KNTAIR,KNTSWN,KNTPRO,
  11273      $ KNTVAD,KNTRAS,KNTDUM(3),KNTSFC,KNTSHP,KNTSLP,KNTMSO,KNTSPL,
  11274      $ KSKSWN,KSKACF,KNDCDE(3),KSKCLS,KSKTHN,KSKOMR(2),KSKALM(9),
  11275      $ KSKAHM(9),KSKNOW(9),KSKDRP
  11276       COMMON/LFMSFC/LFMAXI,LFMAXJ,FMESHL,FLONVT,FPOLEI,FPOLEJ,MARLND,
  11277      $ JSURFM(12),JSURFW(12),FWINDO(12),PFRALT,npkrpt(12)
  11278       COMMON/XTRHD2/CRES1,CRES2,CBULL
  11279       COMMON/DIRECT/OBS3(5,MXBLVL,7),OBS2(NUMOBS2),NOBS3(7),RDATA2(25),
  11280      $ obs8_8(2)
  11281       COMMON /BUFRLIB_MISSING/BMISS
  11282       EQUIVALENCE  (IDATA,RDATA)
  11283       DATA INAC/0,1,1,3,4,5,1,1,4/
  11284       DATA JNSTR/
  11285 C
  11286 C                   NESDIS/GOES-ODD               NESDIS/GOES-EVEN
  11287 C ---> NSW:  ---------------1------------- ---------------2-------------
  11288 C ---> IPD:   1  2  3  4  5  6  7  8  9 10  1  2  3  4  5  6  7  8  9 10
  11289 C                            W  W  S  S                    W  W  S  S
  11290 C             C  V  B  I  Z CT DL CT DL  P  C  V  B  I  Z CT DL CT DL  P
  11291      $       -1,-1,-1, 5,11, 6, 7, 8, 9,15,-1,-1,-1, 5,11, 6, 7, 8, 9,15
  11292 C
  11293 C             INDIAN/INSAT/KALPANA(GEOST.)     JAPAN/GMS/MTSAT (GEOST.)
  11294 C ---> NSW:  ---------------3------------- ---------------4-------------
  11295 C ---> IPD:   1  2  3  4  5  6  7  8  9 10  1  2  3  4  5  6  7  8  9 10
  11296 C                            W  W  S  S                    W  W  S  S
  11297 C             C  V  B  I  Z CT DL CT DL  P  C  V  B  I  Z CT DL CT DL  P
  11298      $,       1,16, 1,-1,-1,-1,-1,-1,-1,-1, 2,10, 2,-1,-1,-1,-1,-1,-1,-1
  11299 C
  11300 C              EUMETSAT/METEO-ODD (GEOST.)   EUMETSAT/METEO-EVEN(GEOST.)
  11301 C ---> NSW:  ---------------5------------- ---------------6-------------
  11302 C ---> IPD:   1  2  3  4  5  6  7  8  9 10  1  2  3  4  5  6  7  8  9 10
  11303 C                            W  W  S  S                    W  W  S  S
  11304 C             C  V  B  I  Z CT DL CT DL  P  C  V  B  I  Z CT DL CT DL  P
  11305      $,       3,14, 3,-1,-1,-1,-1,-1,-1,-1, 3,14, 3,-1,-1,-1,-1,-1,-1,-1
  11306 C
  11307 C                NASA/MODIS AQUA (POES)       NASA/MODIS TERRA (POES)
  11308 C ---> NSW:  ---------------7------------- ---------------8-------------
  11309 C ---> IPD:   1  2  3  4  5  6  7  8  9 10  1  2  3  4  5  6  7  8  9 10
  11310 C                            W  W  S  S                    W  W  S  S
  11311 C             C  V  B  I  Z CT DL CT DL  P  C  V  B  I  Z CT DL CT DL  P
  11312      $,      -1,-1,-1,17,-1,18,19,-1,-1,-1,-1,-1,-1,17,-1,18,19,-1,-1,-1
  11313      $/
  11314 
  11315       DATA  XMISS/99999./,YMISS/99998.8/,LL0/0/,ITIMES/4*0/,ISQNUM/4*0/,
  11316      $ IMISS/99999/
  11317 C FCNS PRS, PR CALC. PRESS. FROM ALT. FOR Z > 11000M, Z < 11000M; RESP
  11318 C  (U.S. STANDARD ATMOSPHERE)
  11319       PRS(Z) = 226.3 * EXP(1.576106E-4 * (11000. - Z))
  11320       PR(Z) = 1013.25 * (((288.15 - (.0065 * Z))/288.15)**5.256)
  11321 CWAS  PR(Z) = 1013.5 * (((288. - (.0065 * Z))/288.)**5.256)
  11322 C FCN PRE CALC. PRESS. FROM ALT. (FOR Z > 11000M), TEMPERATURE, AND AN
  11323 C  EXISTING PRESSURE AND ITS CORRESPONDING GEOPOTENTIAL HEIGHT
  11324       PRE(PMND,TEMP,Z,ZMND)

Page 267         Source Listing                  GETC06
2017-04-18 11:09                                 prepdata.f

  11325      $ = PMND * (((TEMP - (.0065 * (Z - ZMND)))/TEMP)**5.256)
  11326 C FCNS BELOW CONVERT SAT./SPEC. HUM.(G/G) & PRESS(MB) INTO TEMP/TD(K)
  11327       AS(Q,PPPP) = ALOG((Q * PPPP)/(6.1078 * ((0.378 * Q) + 0.622)))
  11328       TFRMQP(Q,PPPP) = ((237.3 * AS(Q,PPPP))/(17.269-AS(Q,PPPP))+273.16)
  11329 
  11330       IF(ITIMES(NN).EQ.0)  THEN
  11331 C FOR FIRST CALL TO SUBR. FOR PARTICULAR UNIT NUMBER, INITIALIZE ISQNUM
  11332 C  (NOTE: FOR RECCOS IN NN=1, INITIALIZE WITH SEQ. NUMBER FROM LAST
  11333 C         REPORT PROCESSED FROM ADPUPA FILE IN SUBR. STOROB)
  11334          ISQNUM(NN) = 0
  11335          IF(NN.EQ.1)  ISQNUM(NN) = ISQNUM_UPA
  11336          ITIMES(NN) = 1
  11337       END IF
  11338       IFLC6 = 0
  11339       KLVL = IDATA(23)
  11340 C THE MAXIMUM NUMBER OF LEVELS PROCESSED IS MXLVL
  11341       KLVL = MIN(KLVL,MXLVL)
  11342 C-----------------------------------------------------------------------
  11343 C    FOR ALL DATA LEVEL CAT. 6 TYPES CHECK FOR ZERO LEVELS OF DATA --
  11344 C    IF SO TOSS
  11345 C    FOR NON-AIRCRAFT RPTS CHECK FOR .GT. 1 LVL  OF DATA -- IF SO TOSS
  11346 C-----------------------------------------------------------------------
  11347       IF(KLVL.LE.0)  THEN
  11348          PRINT 950, STNID,RDATA(1),RDATA(2),IDATA(9)
  11349   950 FORMAT(' * * TOTAL REPORT TOSSED  -ID=',A8,', LAT=',F7.2,'N, ',
  11350      $ 'LON=',F8.2,'E, RTYP',I4,' - NUMBER LEVELS = 0 IN GETC06')
  11351          RETURN 2
  11352       ELSE  IF(IDATA(9).NE.41.AND.KLVL.GT.1)  THEN
  11353          PRINT 2951, STNID,RDATA(1),RDATA(2),IDATA(9)
  11354  2951 FORMAT(' * * TOTAL REPORT TOSSED  -ID=',A8,', LAT=',F7.2,'N, ',
  11355      $ 'LON=',F8.2,'E, RTYP',I4,' - NUMBER OF LEVELS > 1 IN GETC06')
  11356          RETURN 2
  11357       END IF
  11358 C-----------------------------------------------------------------------
  11359 C IQMLIM IS PREPBUFR TABLE VALUE LIMIT FOR ACCEPTING REPORTS
  11360 C IQMGUD IS THE HIGHEST 'NON-REJECTED' PREPBUFR TABLE VALUE
  11361       IQMLIM = 16
  11362       IQMGUD = 3
  11363 C INITIALIZE CERTAIN VARIABLES TO AVOID COMPILER WARNINGS
  11364       IPD = 1
  11365       IBNDA = 1
  11366       IBAND = 1
  11367       NAC = 1
  11368       NSW = 1
  11369       IUS = 1
  11370       IPPM= 99
  11371       IGM = 99
  11372       IPM = 99
  11373       IZM = 99
  11374       IQM = 99
  11375       PP   = XMISS
  11376       ZZ   = XMISS
  11377       IF(IDATA(9).EQ.31)  THEN
  11378 C***********************************************************************
  11379 C                 CHECKS ON RECONNAISSANCE (R. TYPE 31)
  11380 C***********************************************************************
  11381          INSTR = 2

Page 268         Source Listing                  GETC06
2017-04-18 11:09                                 prepdata.f

  11382 C SET UP FOR LATER CHECK IF RECCO IS W/I TIME WINDOW (RWINDO)
  11383          TIMWIN_e = -RWINDO * .01
  11384          TIMWIN_l =  RWINDO * .01
  11385 C***********************************************************************
  11386       ELSE  IF(IDATA(9).EQ.63)  THEN
  11387 C***********************************************************************
  11388 C      CHECKS ON SATELLITE (SATWND) MASS/WIND REPORTS (R. TYPE 63)
  11389 C***********************************************************************
  11390 C-----------------------------------------------------------------------
  11391 C DETERMINE RPT SUBTYPE (IBAND,NSW,IPD); WHERE:
  11392 C  IBAND IS LAT BAND INDEX
  11393 C  NSW IS DEFINED AS FOLLOWS:
  11394 C           =1-NESDIS/GOES-ODD;
  11395 C           =2-NESDIS/GOES-EVEN;
  11396 C           =3-INDIA/INSAT OR KALPANA - ALL SATS. (GEOSTATIONARY);
  11397 C           =4-JAPAN/GMS OR MTSAT -ALL SATS. or GOES-09 (GEOSTATIONARY);
  11398 C           =5-EUMETSAT/METEOSAT-ODD  (GEOSTATIONARY);
  11399 C           =6-EUMETSAT/METEOSAT-EVEN (GEOSTATIONARY);
  11400 C           =7-NASA/MODIS AQUA (POLAR-ORBITING);
  11401 C           =8-NASA/MODIS TERRA (POLAR-ORBITING)
  11402 C IPD IS DEFINED AS FOLLOWS:
  11403 C           = 1-CONVENTIONAL IR (LONG-WAVE) CLOUD DRIFT (CLOUD TOP);
  11404 C           = 2-CONVENTIONAL IMAGER WATER VPR (CLOUD TOP OR DEEP LAYER);
  11405 C           = 3-CONVENTIONAL VISIBLE CLOUD DRIFT (CLOUD TOP);
  11406 C           = 4-HIGH-DENSITY IR  (LONG-WAVE) CLOUD DRIFT (CLOUD TOP);
  11407 C           = 5-HIGH-DENSITY VISIBLE CLOUD DRIFT (CLOUD TOP);
  11408 C           = 6-HIGH-DENSITY IMAGER WATER VAPOR (CLOUD TOP);
  11409 C           = 7-HIGH-DENSITY IMAGER WATER VAPOR (DEEP LAYER);
  11410 C           = 8-HIGH-DENSITY SOUNDER WATER VAPOR (CLOUD TOP);
  11411 C           = 9-HIGH-DENSITY SOUNDER WATER VAPOR (DEEP LAYER);
  11412 C           =10-PICTURE TRIPLET CLOUD DRIFT
  11413 C-----------------------------------------------------------------------
  11414 C IDENTIFY LATITUDE (PHISWN) BAND INDEX ---> IBAND
  11415          DO IBAND = 1,5
  11416             IF(NINT(RDATA(1)*100.).LT.(NINT(PHISWN(IBAND+1)*100.)-0.5))
  11417      $       GO TO 1700
  11418          ENDDO
  11419          IBAND = 6
  11420  1700    CONTINUE
  11421 C.......................................................................
  11422 C IDENTIFY PRODUCT INDEX ---> IPD
  11423 C DETERMINED FROM CHARACTER IN POSITION 8 OF STN. ID AND FROM CLOUD
  11424 C  MASK INDICATOR
  11425 C
  11426 C   CHARACTER IN POSITION 8 OF STN. ID:
  11427 C        1 - 'C' ---> CONVENTIONAL IR (LONG-WAVE) CLOUD-DRIFT (ALWAYS
  11428 C                     CLOUD TOP)
  11429 C        2 - 'V' ---> CONVENTIONAL IMAGER WATER VAPOR (CLOUD TOP OR
  11430 C                     DEEP LAYER)
  11431 C        3 - 'B' ---> CONVENTIONAL VISIBLE CLOUD-DRIFT (ALWAYS CLD TOP)
  11432 C        4 - 'I' ---> HIGH-DENSITY IR (LONG-WAVE) CLOUD-DRIFT (ALWAYS
  11433 C                     CLOUD TOP)
  11434 C        5 - 'Z' ---> HIGH-DENSITY VISIBLE CLOUD-DRIFT (ALWAYS CLD TOP)
  11435 C        6 - 'W' ---> HIGH-DENSITY IMAGER WATER VAPOR (CLOUD TOP)
  11436 C        7 - 'W' ---> HIGH-DENSITY IMAGER WATER VAPOR (DEEP LAYER)
  11437 C        8 - 'T' ---> HIGH-DENS SOUNDER BAND 10 WATER VAPOR (CLOUD TOP)
  11438 C            'L' ---> HIGH-DENS SOUNDER BAND 11 WATER VAPOR (CLOUD TOP)

Page 269         Source Listing                  GETC06
2017-04-18 11:09                                 prepdata.f

  11439 C        9 - 'T' ---> HIGH-DENS SOUNDER BAND 10 WATER VAPOR (DEEP LAYER)
  11440 C            'L' ---> HIGH-DENS SOUNDER BAND 11 WATER VAPOR (DEEP LAYER)
  11441 C       10 - 'P' ---> PICTURE TRIPLET CLOUD DRIFT
  11442 C
  11443 C   CLOUD MASK INDICATOR (STORED IN BYTE 3 OF HEADER RESERVE CHARACTER
  11444 C    WORD 5):
  11445 C            '9' ---> MISSING - REVERTS TO CLOUD TOP
  11446 C            '1' ---> DEEP LAYER MEAN
  11447 C            '2' ---> CLOUD TOP
  11448 C
  11449          IF(STNID(8:8).EQ.'V') THEN
  11450             IPD = 2
  11451          ELSE  IF(STNID(8:8).EQ.'B') THEN
  11452             IPD = 3
  11453          ELSE  IF(STNID(8:8).EQ.'I') THEN
  11454             IPD = 4
  11455          ELSE  IF(STNID(8:8).EQ.'Z') THEN
  11456             IPD = 5
  11457          ELSE  IF(STNID(8:8).EQ.'W') THEN
  11458             IF(CRES1(3:3).NE.'1')  THEN
  11459                IPD = 6
  11460             ELSE
  11461                IPD = 7
  11462             END IF
  11463          ELSE  IF(STNID(8:8).EQ.'T'.OR.STNID(8:8).EQ.'L') THEN
  11464             IF(CRES1(3:3).NE.'1')  THEN
  11465                IPD = 8
  11466             ELSE
  11467                IPD = 9
  11468             END IF
  11469          ELSE  IF(STNID(8:8).EQ.'P') THEN
  11470             IPD = 10
  11471          END IF
  11472 C.......................................................................
  11473 C IDENTIFY PRODUCER/SATELLITE INDEX ---> NSW
  11474 C DETERMINED FROM CHARACTER IN POSITION 1 OF STN. ID
  11475 C  POS. 1 STNID:'A','C'--> GOES-ODD SAT
  11476 C               'B','D'--> GOES-EVEN SAT
  11477 C               'W','Y'--> METEOSAT-ODD SAT (GEOSTATIONARY)
  11478 C               'X','Z'--> METEOSAT-EVEN SAT (GEOSTATIONARY)
  11479 C               'K' -----> KALPANA-ALL SAT (GEOSTATIONARY)
  11480 C               'V' -----> INSAT-ALL SAT (GEOSTATIONARY)
  11481 C               'P','R'--> GMS/MTSAT-EVEN SAT or GOES-09 (GEOSTATIONARY)
  11482 C               'O','Q'--> GMS/MTSAT-ODD SAT (GEOSTATIONARY)
  11483 C               'U' -----> AQUA SAT (POLAR-ORBITING)
  11484 C               'T' -----> TERRA SAT (POLAR-ORBITING)
  11485          NSW = 0
  11486          IF(STNID(1:1).EQ.'A'.OR.STNID(1:1).EQ.'C')  THEN
  11487             NSW = 1
  11488          ELSE  IF(STNID(1:1).EQ.'B'.OR.STNID(1:1).EQ.'D')  THEN
  11489             NSW = 2
  11490          ELSE  IF(STNID(1:1).EQ.'W'.OR.STNID(1:1).EQ.'Y')  THEN
  11491             NSW = 5
  11492          ELSE  IF(STNID(1:1).EQ.'X'.OR.STNID(1:1).EQ.'Z')  THEN
  11493             NSW = 6
  11494          ELSE  IF(STNID(1:1).GE.'O'.AND.STNID(1:1).LE.'R')  THEN
  11495             NSW = 4

Page 270         Source Listing                  GETC06
2017-04-18 11:09                                 prepdata.f

  11496          ELSE  IF(STNID(1:1).EQ.'V'.OR.STNID(1:1).EQ.'K')  THEN
  11497             NSW = 3
  11498          ELSE  IF(STNID(1:1).EQ.'U')  THEN
  11499             NSW = 7
  11500          ELSE  IF(STNID(1:1).EQ.'T')  THEN
  11501             NSW = 8
  11502          END IF
  11503 C.......................................................................
  11504          IF(NSW.EQ.0)  THEN
  11505 C THIS RPT'S PRODUCER/SAT. COMB. IS NOT VALID - SKIP IT (BUT KEEP COUNT)
  11506             PRINT 954, STNID,RDATA(1),RDATA(2),IDATA(9)
  11507   954 FORMAT(' * * TOTAL REPORT TOSSED  -ID=',A8,', LAT=',F7.2,'N, ',
  11508      $ 'LON=',F8.2,'E, RTYP',I4,' - PRODUCER/SAT COMBINATION INVALID')
  11509             KSKNSW = KSKNSW + 1
  11510             RETURN 2
  11511          END IF
  11512 C.......................................................................
  11513          INSTR = JNSTR(IPD,NSW)
  11514          IF(INSTR.LT.0)  THEN
  11515 C THIS REPORT DOESN'T HAVE A PREPBUFR REPORT TYPE ASSOCIATED WITH ITS
  11516 C  PRODUCER/SATELLITE/PRODUCT COMBINATION - SKIP IT (BUT KEEP COUNT)
  11517             PRINT 955, STNID,RDATA(1),RDATA(2),IDATA(9)
  11518   955 FORMAT(' * * TOTAL REPORT TOSSED  -ID=',A8,', LAT=',F7.2,'N, ',
  11519      $ 'LON=',F8.2,'E, RTYP',I4,' - NO R. TYPE FOR PRODUCER/SAT/PROD ',
  11520      $ 'COMBINATION')
  11521             KSKNSW = KSKNSW + 1
  11522             RETURN 2
  11523          END IF
  11524 C-----------------------------------------------------------------------
  11525 C KEEP/EXCLUDE RPT BASED ON: PROCESS NEITHER MASS NOR WIND; LAND/OCEAN;
  11526 C  TIME WINDOW: ARRAY (IBAND,NSW,IPD); IBAND, NSW, IPD AS DEFINED ABOVE
  11527 C-----------------------------------------------------------------------
  11528 C CHECK IF NEITHER MASS NOR WIND DATA FROM THIS TYPE IS TO BE PROCESSED
  11529          IF(JSWIND(IBAND,NSW,IPD).EQ.9999.AND.JSMASS(IBAND,NSW,IPD).EQ.
  11530      $    9999)  THEN
  11531             KSKSWD(IPD) = KSKSWD(IPD) + 1
  11532             RETURN 2
  11533          ELSE  IF(JSWIND(IBAND,NSW,IPD).EQ.0.OR.JSMASS(IBAND,NSW,IPD)
  11534      $    .EQ.0)  THEN
  11535          ELSE
  11536             IF(JSWIND(IBAND,NSW,IPD).EQ.99.OR.
  11537      $       JSMASS(IBAND,NSW,IPD).EQ.99)  THEN
  11538                IFLC6 = 1
  11539             ELSE  IF(JSWIND(IBAND,NSW,IPD).EQ.299.OR.
  11540      $       JSMASS(IBAND,NSW,IPD).EQ.299)  THEN
  11541                IF(STNID(1:1).EQ.'C'.OR.STNID(1:1).EQ.'D'.OR.
  11542      $            STNID(1:1).EQ.'Y'.OR.STNID(1:1).EQ.'Z')  IFLC6 = 1
  11543             ELSE  IF(JSWIND(IBAND,NSW,IPD).EQ.199.OR.
  11544      $       JSMASS(IBAND,NSW,IPD).EQ.199)  THEN
  11545                IF(STNID(1:1).EQ.'A'.OR.STNID(1:1).EQ.'B'.OR.
  11546      $            STNID(1:1).EQ.'W'.OR.STNID(1:1).EQ.'X')  IFLC6 = 1
  11547             END IF
  11548          END IF
  11549 C SPECIAL CHECK ON INDIAN SATWNDS: ON RARE OCCASIONS LATITUDE IS MIS-
  11550 C  PROCESSED PLACING RPT IN ARCTIC RGN -- SKIP RPTS W/ LAT > 40 DEG. N
  11551          IF(NSW.EQ.3.AND.NINT(RDATA(1)*100.).GT.4000)  THEN
  11552             PRINT 5952, STNID,RDATA(1),RDATA(2),IDATA(9)

Page 271         Source Listing                  GETC06
2017-04-18 11:09                                 prepdata.f

  11553  5952 FORMAT(' * * INDIAN SATWIND TOSSED-ID=',A8,', LAT=',F7.2,'N, ',
  11554      $ 'LON=',F8.2,'E, RTYP',I4,' - LATITUDE MISPLACED')
  11555             RETURN 2
  11556          END IF
  11557 C TEST FOR OVERLAND SATWND REPORTS
  11558          IF(.NOT.SWNLND(IBAND,NSW,IPD))  THEN
  11559 C CALL SUBR. LNDCHK TO SEE IF RPT SATISFIES OVER LAND CRITERIA
  11560             IF(NINT(RDATA(1)*100.).LT.0)  THEN
  11561               CALL LNDCHK(RDATA(1),RDATA(2),1,4,2,GDSH,145,37,0.5,ILAND)
  11562             ELSE
  11563               CALL LNDCHK(RDATA(1),RDATA(2),1,4,2,GDNH,362,91,0.5,ILAND)
  11564             END IF
  11565             IF(ILAND.NE.0)  THEN
  11566 C RPT SATISFIES OVER LAND CRITERIA PROCESS BUT FLAG ALL VARIABLES W/
  11567 C  PREPBUFR TABLE VALUE OF 15
  11568              IF(IPRINT.EQ.0) PRINT 1956,STNID,RDATA(1),RDATA(2),IDATA(9)
  11569  1956 FORMAT(' + + TOTAL REPORT FLAGGED -ID=',A8,', LAT=',F7.2,'N, ',
  11570      $ 'LON=',F8.2,'E, RTYP',I4,' - OVER LAND SATWIND REPORT')
  11571                IF(IFLC6.EQ.0)  KSKSWN = KSKSWN + 1
  11572                IFLC6 = 1
  11573             END IF
  11574          END IF
  11575 C SET UP FOR LATER CHECK IF SAT. REPORT IS WITHIN TIME WINDOW
  11576 C  {SWINDO_e(IBAND,NSW,IPD) - EARLIEST TIME WINDOW RELATIVE TO CYCLE
  11577 C  TIME FOR ACCEPTING REPORTS; SWINDO_l(IBAND,NSW,IPD) - LATEST TIME
  11578 C  WINDOW RELATIVE TO CYCLE TIME FOR ACCEPTING REPORTS}
  11579          TIMWIN_e = SWINDO_e(IBAND,NSW,IPD) * .01
  11580          TIMWIN_l = SWINDO_l(IBAND,NSW,IPD) * .01
  11581 C***********************************************************************
  11582       ELSE
  11583 C***********************************************************************
  11584 C CHECKS ON ACFT FLT-LVL (AIREP/PIREP, AMDAR, EAMDAR, MDCRS,
  11585 C  TAMDAR(M/B), CAMDAR, KAMDAR, AMDARB) RPTS (R. TYPE 41)
  11586 C***********************************************************************
  11587 C-----------------------------------------------------------------------
  11588 C DETERMINE AIRCRAFT FLIGHT-LEVEL TYPE (IBNDA,NAC); WHERE: IBNDA IS LAT
  11589 C              BAND INDEX AND NAC IS DEFINED AS FOLLOWS:
  11590 C   {=1-AIREP/PIREP-PRESET!; =2-AMDAR; =3-EAMDAR; =4-MDCRS; =5-TAMDARM;
  11591 C    =6-CAMDAR; =7-KAMDAR; =8-AMDARB; =9-TAMDARB}
  11592 C-----------------------------------------------------------------------
  11593 C IDENTIFY LATITUDE (PHIACF) BAND INDEX ---> IBNDA
  11594          DO IBNDA = 1,5
  11595             IF(NINT(RDATA(1)*100.).LT.(NINT(PHIACF(IBNDA+1)*100.)-0.5))
  11596      $       GO TO 6700
  11597          ENDDO
  11598          IBNDA = 6
  11599  6700    CONTINUE
  11600 C.......................................................................
  11601 C IDENTIFY AIRCRAFT TYPE INDEX ---> NAC
  11602          IF(IDATA(10).EQ.3)  THEN
  11603             NAC = 2
  11604          ELSE  IF(IDATA(10).EQ.6)  THEN
  11605             NAC = 3
  11606          ELSE  IF(IDATA(10).EQ.8.OR.IDATA(10).EQ.12.OR.IDATA(10).EQ.13)
  11607      $    THEN
  11608             NAC = 5
  11609          ELSE  IF(IDATA(10).EQ.9)  THEN

Page 272         Source Listing                  GETC06
2017-04-18 11:09                                 prepdata.f

  11610             NAC = 6
  11611          ELSE  IF(IDATA(10).EQ.11)  THEN
  11612             NAC = 7
  11613          ELSE  IF(IDATA(10).EQ.103)  THEN
  11614             NAC = 8
  11615          ELSE  IF(IDATA(10).EQ.10)  THEN
  11616             NAC = 9
  11617          ELSE  IF(NN.EQ.2)  THEN
  11618             NAC = 4
  11619          END IF
  11620 C-----------------------------------------------------------------------
  11621 C     DETERMINE AIRCRAFT GEOGRAPHICAL LOCATION, IUS (=1-OUTSIDE US
  11622 C    MAINLND/G. MEXICO/SO. ONTARIO - PRESET!; =2-INSIDE THIS REGION)
  11623 C-----------------------------------------------------------------------
  11624          IF(NINT(RDATA(1)*100.).GE.0)  THEN
  11625             CALL LNDCHK(RDATA(1),RDATA(2),2,4,2,GDUS,362,91,0.5,ILAND)
  11626             IF(ILAND.NE.0)  IUS = 2
  11627          END IF
  11628 C-----------------------------------------------------------------------
  11629 C KEEP OR EXCLUDE ACFT RPT BASED ON: 0 LVL CHK; PROCESS NEITHER MASS NOR
  11630 C  WIND; AND LAND/OCEAN {ARRAY(IBNDA,NAC)}; ALSO BASED ON TIME WINDOW
  11631 C {ARRAY(IUS,NAC)} -- (IBNDA IS LAT BAND; NAC IS RPT SUBTYPE; IUS IS
  11632 C                        GEOGRAPHICAL LOCATION)
  11633 C      (AIREP/PIREP RPTS OVER U.S. MAINLAND MAY BE EXCLUDED)
  11634 C   MAY ALSO EXCLUDE ACFT TYPES BELOW USER-SPECIFIED PRESSURE ALTITUDE
  11635 C   MAY ALSO EXCLUDE ACFT TYPES ABOVE USER-SPECIFIED PRESSURE ALTITUDE
  11636 C   MAY ALSO EXCLUDE ACFT TYPES IF MASS DATA AVAILABLE BUT WIND DATA MSG
  11637 C-----------------------------------------------------------------------
  11638 C CHECK IF NEITHER MASS NOR WIND DATA FROM THIS TYPE IS TO BE PROCESSED
  11639          IF(JAWIND(IBNDA,NAC).NE.0.AND.JAMASS(IBNDA,NAC).NE.0)  RETURN 2
  11640 C SET UP FOR LATER CHK IF ACFT. RPT IS W/I TIME WINDOW {AWINDO(IUS,NAC)}
  11641          TIMWIN_e = -AWINDO(IUS,NAC) * .01
  11642          TIMWIN_l =  AWINDO(IUS,NAC) * .01
  11643          INSTR = INAC(NAC)
  11644 C TEST FOR OVERLAND AIRCRAFT REPORTS
  11645          IF(.NOT.AIRLND(IBNDA,NAC))  THEN
  11646 C CALL SUBR. LNDCHK TO SEE IF RPT SATISFIES OVER LAND CRITERIA
  11647             IF(NINT(RDATA(1)*100.).LT.0)  THEN
  11648               CALL LNDCHK(RDATA(1),RDATA(2),1,4,2,GDSH,145,37,0.5,ILAND)
  11649             ELSE
  11650               CALL LNDCHK(RDATA(1),RDATA(2),1,4,2,GDNH,362,91,0.5,ILAND)
  11651             END IF
  11652             IF(ILAND.NE.0)  THEN
  11653 C RPT SATISFIES OVER LAND CRITERIA PROCESS BUT FLAG ALL VARIABLES W/
  11654 C  PREPBUFR TABLE VALUE OF 15
  11655              IF(IPRINT.EQ.0) PRINT 2355,STNID,RDATA(1),RDATA(2),IDATA(9)
  11656  2355 FORMAT(' + + TOTAL REPORT FLAGGED -ID=',A8,', LAT=',F7.2,'N, ',
  11657      $ 'LON=',F8.2,'E, RTYP',I4,' - OVER LAND AIRCRAFT REPORT')
  11658                IF(IFLC6.EQ.0)  KSKACF = KSKACF + 1
  11659                IFLC6 = 1
  11660             END IF
  11661          END IF
  11662          IF(IDATA(23).EQ.1)  THEN
  11663             IF(NINT(RDATA(IDATA(24)+1)).LT.IACFTL(NAC))   THEN
  11664 C REPORT HAS PRESSURE ALTITUDE LESS THAN 'IACFTL(NAC)' METERS
  11665 C   PROCESS BUT FLAG ALL VARIABLES WITH PREPBUFR TABLE VALUE OF 15
  11666                IF(IPRINT.EQ.0)  PRINT 2455, STNID,RDATA(1),RDATA(2),

Page 273         Source Listing                  GETC06
2017-04-18 11:09                                 prepdata.f

  11667      $          IDATA(9),NINT(RDATA(IDATA(24)+1)),IACFTL(NAC)
  11668  2455 FORMAT(' + + TOTAL REPORT FLAGGED -ID=',A8,', LAT=',F7.2,'N, ',
  11669      $ 'LON=',F8.2,'E, RTYP',I4,' - PRESSURE-ALT(',I5,'M) <',I5,'M')
  11670                IF(IFLC6.EQ.0)  KSKALM(NAC) = KSKALM(NAC) + 1
  11671                IFLC6 = 1
  11672             ELSE  IF(NINT(RDATA(IDATA(24)+1)).GT.IACFTH(NAC))   THEN
  11673 C REPORT HAS PRESSURE ALTITUDE GREATER THAN 'IACFTH(NAC)' METERS
  11674 C   PROCESS BUT FLAG ALL VARIABLES WITH PREPBUFR TABLE VALUE OF 15
  11675                IF(IPRINT.EQ.0)  PRINT 3455, STNID,RDATA(1),RDATA(2),
  11676      $          IDATA(9),NINT(RDATA(IDATA(24)+1)),IACFTH(NAC)
  11677  3455 FORMAT(' + + TOTAL REPORT FLAGGED -ID=',A8,', LAT=',F7.2,'N, ',
  11678      $ 'LON=',F8.2,'E, RTYP',I4,' - PRESSURE-ALT(',I5,'M) > ',I5,'M')
  11679                IF(IFLC6.EQ.0)  KSKAHM(NAC) = KSKAHM(NAC) + 1
  11680                IFLC6 = 1
  11681             END IF
  11682             IF(.NOT.AIFNOW(NAC))  THEN
  11683             IF(MAX(RDATA(IDATA(24)+4),RDATA(IDATA(24)+5)).GE.YMISS) THEN
  11684 C RPT HAS MISSING WIND BUT MAY HAVE VALID MASS DATA, AND AIFNOW(NAC)=F
  11685 C   PROCESS BUT FLAG ALL VARIABLES W/ PREPBUFR TABLE VALUE OF 15
  11686               IF(IPRINT.EQ.0)PRINT 2855,STNID,RDATA(1),RDATA(2),IDATA(9)
  11687  2855 FORMAT(' + + TOTAL REPORT FLAGGED -ID=',A8,', LAT=',F7.2,'N, ',
  11688      $ 'LON=',F8.2,'E, RTYP',I4,' - WIND DIRECTION AND/OR SPEED MISSG')
  11689                   IF(IFLC6.EQ.0)  KSKNOW(NAC) = KSKNOW(NAC) + 1
  11690                   IFLC6 = 1
  11691                END IF
  11692             END IF
  11693          END IF
  11694       END IF
  11695 C***********************************************************************
  11696 C***********************************************************************
  11697 C-----------------------------------------------------------------------
  11698 C CALL SUBR. 'RPTLBL' TO STORE REPORT HEADER INTO HDR(4),HDR(5),HDR(7),
  11699 C                          HDR(9)-HDR(15), ALAT_8, ALON_8
  11700 C-----------------------------------------------------------------------
  11701       CALL RPTLBL(CYCLET)
  11702 C-----------------------------------------------------------------------
  11703 C        CALL SUBR. 'TIMCHK' TO CHECK IF REPORT IS W/I PROPER
  11704 C              TIME WINDOW OF CYCLE TIME (IER =1 TOSS RPT)
  11705 C-----------------------------------------------------------------------
  11706       CALL TIMCHK(HDR(4),TIMWIN_e,TIMWIN_l,IER)
  11707       IF(IER.EQ.1)  THEN
  11708          KTIMUA = KTIMUA + 1
  11709          RETURN 2
  11710       END IF
  11711 C CURRENTLY ONLY RECCOS AND AIRCRAFT (ALL TYPES) NEED TO EXAMINE DATA
  11712 C  LEVEL CAT. 8
  11713       ICF351 = 0
  11714       ICF352 = 0
  11715       JCF914 = 0
  11716       ICF914 = 0
  11717       POAF   = XMISS
  11718       ROLF   = XMISS
  11719       RIALR  = XMISS
  11720       PCAT   = XMISS
  11721       TRBX   = XMISS
  11722       aMSTQ  = XMISS
  11723       RFFL   = XMISS

Page 274         Source Listing                  GETC06
2017-04-18 11:09                                 prepdata.f

  11724       QIFY   = XMISS
  11725       QIFN   = XMISS
  11726       EEQF   = XMISS
  11727       IWM_RFFL = IMISS
  11728       AMANDZ = XMISS
  11729       AMANDP = XMISS
  11730       AMSLPR = XMISS
  11731       IF(IDATA(27).GT.0)  THEN
  11732          L = IDATA(28) - 4
  11733          DO I = 1,IDATA(27)
  11734             L = L + 4
  11735             IF(NINT(RDATA(L+1)).EQ.914)  THEN
  11736                IF(RDATA(L).LT.YMISS) THEN
  11737                   JCF914 = 1
  11738                   IF(NINT(RDATA(L)).EQ.7)  ICF914 = 1
  11739                   POAF = RDATA(L)
  11740                END IF
  11741                CYCLE
  11742             ELSE  IF(NINT(RDATA(L+1)).EQ.915)  THEN
  11743                IF(RDATA(L).LT.YMISS)  PCAT = RDATA(L) * 0.01
  11744             ELSE IF(NINT(RDATA(L+1)).GE.926.AND.NINT(RDATA(L+1)).LE.930)
  11745      $       THEN
  11746                IF(RDATA(L).LT.YMISS) TRBX(NINT(RDATA(L+1))-925)=RDATA(L)
  11747                CYCLE
  11748             ELSE  IF(NINT(RDATA(L+1)).EQ.931)  THEN
  11749                IF(RDATA(L).LT.YMISS)  ROLF = RDATA(L)
  11750                CYCLE
  11751             ELSE  IF(NINT(RDATA(L+1)).EQ.932)  THEN
  11752                IF(RDATA(L).LT.YMISS)  RIALR = RDATA(L) * 0.001
  11753                CYCLE
  11754             ELSE  IF(NINT(RDATA(L+1)).EQ.351)  THEN
  11755                IF(MAX(RDATA(L),RDATA(L+2)).LT.YMISS)  THEN
  11756                   ICF351 = 1
  11757                   AMANDZ = RDATA(L)
  11758                   AMANDP = RDATA(L+2)
  11759                   AMNDZQ = RDATA(L+3)
  11760                END IF
  11761                CYCLE
  11762             ELSE IF(NINT(RDATA(L+1)).EQ.352)  THEN
  11763                IF(RDATA(L).LT.YMISS)  THEN
  11764                   ICF352 = 1
  11765                   AMSLPR = RDATA(L)
  11766                END IF
  11767                CYCLE
  11768             ELSE IF(NINT(RDATA(L+1)).EQ.355)  THEN
  11769                IF(RDATA(L).LT.YMISS)  THEN
  11770 C USE RFF TO SET WIND Q. MARK FOR NESDIS/GOES AND NASA/POES MODIS WINDS
  11771                   RFFL = RDATA(L)
  11772                   IF(NSW.EQ.1.OR.NSW.EQ.2.OR.NSW.EQ.7.OR.NSW.EQ.8) THEN
  11773                      IF(NINT(RFFL).GT.84)  THEN
  11774                         IWM_RFFL = 1
  11775                      ELSE  IF(NINT(RFFL).GT.55)  THEN
  11776                         IWM_RFFL = 2
  11777                      ELSE  IF(NINT(RFFL).GT.49)  THEN
  11778                         IWM_RFFL = 3
  11779                      ELSE
  11780                         IWM_RFFL = 13

Page 275         Source Listing                  GETC06
2017-04-18 11:09                                 prepdata.f

  11781                      END IF
  11782                   END IF
  11783                END IF
  11784                CYCLE
  11785             ELSE IF(NINT(RDATA(L+1)).EQ.356)  THEN
  11786                IF(RDATA(L).LT.YMISS)  QIFY = RDATA(L)
  11787                CYCLE
  11788             ELSE IF(NINT(RDATA(L+1)).EQ.357)  THEN
  11789                IF(RDATA(L).LT.YMISS)  QIFN = RDATA(L)
  11790                CYCLE
  11791             ELSE IF(NINT(RDATA(L+1)).EQ.358)  THEN
  11792                IF(RDATA(L).LT.YMISS)  EEQF = RDATA(L)
  11793                CYCLE
  11794             END IF
  11795          ENDDO
  11796          IF(JCF914.EQ.0)  ICF914 = 1
  11797       END IF
  11798 
  11799       IF(OBS2(42).LT.YMISS) aMSTQ = OBS2(42)
  11800 
  11801 C FLRECO = TRUE MEANS THIS REPORT IS A RECCO WITH EITHER A MANDATORY
  11802 C  LEVEL GEOPOTENTIAL OR A MEAN SEA-LEVEL PRESSURE OBS INCLUDED (CAN
  11803 C  HAVE RECCOS WITH NEITHER OF THESE ADDITIONAL OBS, IN THIS CASE
  11804 C  FLRECO REMAINS FALSE)
  11805       FLRECO = (ICF351.EQ.1.OR.ICF352.EQ.1)
  11806 
  11807       IF(NN.EQ.3)  THEN
  11808 C FOR AIREP/PIREP, AMDAR, EAMDAR, TAMDAR(M/B), CAMDAR, KAMDAR AND
  11809 C   AMDARB AIRCRAFT, STORE WORD 8 OF REPORT HEADER (REPORT "SUBTYPE")
  11810 C   AS FOLLOWS:
  11811 C   - DEFAULT IS HDR(8) = 0
  11812 C   - IF AMDAR, EAMDAR OR CAMDAR AND PHASE OF FLIGHT INDICATOR IS 7
  11813 C      (MEANING AIRCRAFT IS "BANKING") STORE HDR(8) = 2 (ABOVE,
  11814 C       ICF914=1)
  11815 C   - IF AMDAR, EAMDAR OR CAMDAR AND PHASE OF FLIGHT INDICATOR IS
  11816 C      MISSING (MEANING AIRCRAFT IS LIKELY "BANKING")
  11817 C      STORE HDR(8) = 2 (ABOVE, ICF914=1)
  11818 C   - IF AIREP/PIREP AND SOURCE OF REPORT IS AFWA STORE HDR(8) = 1
  11819 C   - IF TAMDARB STORE HDR(8) = 1
  11820          HDR(8) = 0.
  11821          IF(NAC.EQ.2.OR.NAC.EQ.3.OR.NAC.EQ.6)  THEN
  11822             IF(ICF914.EQ.1)  HDR(8) = 2.
  11823          ELSE  IF(NAC.EQ.1)  THEN
  11824             IF(CRES2(1:1).EQ.'C')  HDR(8) = 1.
  11825          ELSE  IF(NAC.EQ.9)  THEN
  11826             HDR(8) = 1.
  11827          END IF
  11828       ELSE  IF(NN.EQ.1)  THEN
  11829 C STORE WORD 8 OF REPORT HEADER (REPORT "SUBTYPE") AS 1 FOR RECCOS
  11830 C  (STORED AS 2 FOR DROPS IN SUBR. PREP)
  11831          IF(IDATA(9).EQ.31)  HDR(8) = 1.
  11832       ELSE  IF(NN.EQ.4)  THEN
  11833 C STORE WORD 8 OF REPORT HEADER (REPORT "SUBTYPE") AS:
  11834 C   BUFR SATELLITE ID TIMES 10 PLUS "SATELLITE DERIVED WIND COMPUTATION
  11835 C   METHOD ("SWCM" - BUFR CODE TABLE 0-02-023) FOR ALL SATELLITE-
  11836 C   DERIVED WIND TYPES
  11837          SWCM = 0

Page 276         Source Listing                  GETC06
2017-04-18 11:09                                 prepdata.f

  11838          IF(CRES1(3:3).EQ.'1')  THEN
  11839             SWCM = 5 ! WV IMAGER/SOUNDER DEEP-LAYER
  11840          ELSE
  11841             IF(IPD.EQ.1.OR.IPD.EQ.4)  THEN
  11842                SWCM = 1 ! IR
  11843             ELSE IF(IPD.EQ.2.OR.IPD.EQ.6.OR.IPD.EQ.8)  THEN
  11844                SWCM = 3 ! WV IMAGER/SOUNDER CLOUD-TOP
  11845             ELSE IF(IPD.EQ.3.OR.IPD.EQ.5)  THEN
  11846                SWCM = 2 ! VISIBLE
  11847             ELSE IF(IPD.EQ.10)  THEN
  11848                SWCM = 4 ! PICTURE-PAIR OR PICTURE-TRIPLET
  11849             END IF
  11850          END IF
  11851          SAID = MIN(HDR(15),999.)
  11852          HDR(8) = SAID*10. + SWCM
  11853       END IF
  11854 C***********************************************************************
  11855 C    CONVERT PRESSURE ALTITUDE TO PRESSURE (VIA U.S. STD. ATMOS. EST.)
  11856 C***********************************************************************
  11857 C PRESSURE INITIALIZED AS MISSING
  11858       P = XMISS
  11859       DO K = 1,KLVL
  11860          L = (9 * (K - 1)) + IDATA(24)
  11861          IF(RDATA(L).LT.YMISS)  P(K) = RDATA(L) * 0.1
  11862          ZZZ = NINT(RDATA(L+1))
  11863          IF(ZZZ.LT.XMISS.AND.P(K).GE.XMISS)  THEN
  11864 cfix?    IF(ZZZ.LT.YMISS.AND.P(K).GE.YMISS)  THEN
  11865 C IF DATA LEVEL CAT. 6 PRESSURE IS MISSING, MUST CALC. IT FROM P-ALT.
  11866             IF(NINT(ZZZ).LE.11000)  THEN
  11867                P(K) = PR(ZZZ)
  11868             ELSE
  11869                P(K) = PRS(ZZZ)
  11870             END IF
  11871          END IF
  11872          IF(P(K).GE.XMISS)  THEN
  11873 cfix?    IF(P(K).GE.YMISS)  THEN
  11874 C IF PRESSURE ON ANY LVL IS MSG SKIP THIS TOT. RPT (ASSUMES ONLY 1 LVL)
  11875             PRINT 2959, STNID,alat_8,alon_8,IDATA(9),K
  11876  2959 FORMAT(' * * TOTAL REPORT TOSSED  -ID=',A8,', LAT=',F10.5,'N, ',
  11877      $ 'LON=',F11.5,'E, RTYP',I4,' - PRESS ON LEVEL',I3,' IS MISSING')
  11878             RETURN 2
  11879          END IF
  11880       ENDDO
  11881 C***********************************************************************
  11882 C UNPACKED RPT SUCCESSFULLY PASSED ALL PRELIMINARY CHECKS - CONTINUE ON
  11883 C***********************************************************************
  11884       KOUNT = KOUNT + 1
  11885       ISQNUM(NN) = ISQNUM(NN) + 1
  11886 C GET R. TYPE (SET UP WITH '2' AS 1ST DIGIT, LIKE FOR WIND PIECE)
  11887       NHDR6 = ((ISEL(IDATA(9)) + 20) * 10) + INSTR
  11888 C***********************************************************************
  11889 C                  FILL IN MASS INFORMATION FOR REPORT
  11890 C***********************************************************************
  11891 C 'ICALLM' INDICATES WHETHER MASS PIECE STORED IN OUTPUT FILE {IF SO =1;
  11892 C  IF NOT = -99 (NOT PROCESSED) OR = -1 (MSG. TEMP) OR = 0 (BAD TEMP)}
  11893       ICALLM = -99
  11894 C SKIP MASS REPORT: IF ACFT & JAMASS(IBNDA,NAC) = 9999;

Page 277         Source Listing                  GETC06
2017-04-18 11:09                                 prepdata.f

  11895 C                   IF SATWND(ALL TYPES) & JSMASS(IBAND,NSW,IPD) = 9999;
  11896 C                   IF FLRECO = F AND RECSLM = F
  11897       IF((IDATA(9).EQ.41.AND.JAMASS(IBNDA,NAC).NE.0)
  11898      $ .OR.(IDATA(9).EQ.63.AND.JSMASS(IBAND,NSW,IPD).EQ.9999)
  11899      $ .OR.(IDATA(9).EQ.31.AND..NOT.FLRECO.AND..NOT.RECSLM)) GO TO 1900
  11900       NI  = MOD((NHDR6/10),10)
  11901       IF(NI.EQ.5.AND.NHDR6.NE.251)  THEN
  11902 C THIS MASS REPORT DOESN'T HAVE A PREPBUFR REPORT TYPE ASSOCIATED WITH
  11903 C  ITS PRODUCER/SATELLITE/PRODUCT COMBINATION - SKIP IT
  11904          PRINT 7955, STNID,RDATA(1),RDATA(2),IDATA(9)
  11905  7955 FORMAT(' # # MASS REPORT TOSSED   -ID=',A8,', LAT=',F7.2,'N, ',
  11906      $ 'LON=',F8.2,'E, RTYP',I4,' - NO R. TYPE FOR PRODUCER/SAT/PROD ',
  11907      $ 'COMBINATION')
  11908          GO TO 1900
  11909       END IF
  11910       ICALLM = 0
  11911 C IGOODT INDICATES AT LEAST 1 LVL WITH VALID TEMP FOUND (=0 NO; =1 YES)
  11912       IGOODT = 0
  11913 C GET PREPBUFR REPORT TYPE
  11914       HDR(6) = NHDR6 - 100
  11915       IF(NHDR6.EQ.251)  HDR(6) = 144
  11916       LL = 0
  11917 C INITIALIZE BOTTOM TWO LEVELS OF MOBS ARRAY (NEED TWO LEVELS IN CASE
  11918 C  FLRECO = TRUE)
  11919       MOBS(1:MXTYPV,1:MXWRDL,1:2) = IMISS
  11920 C INITIALIZE BOTTOM TWO LEVELS OF ICAT ARRAY
  11921       ICAT(1:2) = IMISS
  11922       IF(FLRECO)  THEN
  11923 C-----------------------------------------------------------------------
  11924 C       RECCOS WITH EITHER REPORTED MANDATORY LEVEL GEOPOTENTIAL
  11925 C             OR WITH REPORTED MEAN SEA-LEVEL PRESSURE
  11926 C-----------------------------------------------------------------------
  11927          ICALLM = 1
  11928          IGOODT = 1
  11929          IF(ICF351.EQ.1)  THEN
  11930 C.......................................................................
  11931 C           RECCOS WITH REPORTED MANDATORY LEVEL GEOPOTENTIAL
  11932 C WILL GENERATE A CATEGORY 1 MOBS MASS DATA LEVEL WITH PRESSURE AND HGHT
  11933 C.......................................................................
  11934             JCAT = 1
  11935 C STORE PRESSURE AND HEIGHT OBS INTO PP AND ZZ
  11936             PP = AMANDP
  11937             ZZ = AMANDZ
  11938 C STORE PRESSURE AND HEIGHT PREPBUFR TABLE VALUES
  11939             IPPM = 2
  11940             IGM  = NINT(AMNDZQ)
  11941          ELSE
  11942 C.......................................................................
  11943 C             RECCOS WITH REPORTED MEAN SEA-LEVEL PRESSURE
  11944 C WILL GENERATE A CATEGORY 2 MOBS MASS DATA LEVEL WITH PRESSURE AND HGHT
  11945 C (CAT. 2 DATA LEVEL IS SURFACE, PRESS=PMSL=PSTN AND HGHT=0 AT SEA-LVL)
  11946 C.......................................................................
  11947             JCAT = 2
  11948 C STORE PRESSURE AND HEIGHT OBS INTO PP AND ZZ
  11949             PP = NINT(AMSLPR)/10.
  11950             ZZ = 0.
  11951 C STORE PRESSURE AND HEIGHT PREPBUFR TABLE VALUES

Page 278         Source Listing                  GETC06
2017-04-18 11:09                                 prepdata.f

  11952             IPPM = 2
  11953             IGM  = 2
  11954             IF(JSURFM(5).EQ.0)  THEN
  11955 C FLAG PRESSURE AND HEIGHT ON THIS CAT. 2 MOBS LEVEL
  11956 C  SINCE THIS DATA IS LATER PROCESSED AS A SPLASH-LEVEL SURFACE REPORT
  11957 C  (PREPBUFR REPORT TYPE 182) (SUBSEQUENT OIQC PROGRAM DOESN'T CHECK SFC
  11958 C  PRESSURE FOR PREPBUFR REPORT TYPE 132 BUT DOES CHECK IT FOR PREPBUFR
  11959 C  REPORT TYPE 182 - EVEN IF GOOD DON'T WANT REDUNDANCY)
  11960                IF(IPPM.LE.3.OR.IPPM.GT.15) IPPM = 15
  11961                IF(IGM .LE.3.OR.IGM .GT.15) IGM  = 15
  11962                PRINT 6495, STNID,RDATA(1),RDATA(2),IDATA(9)
  11963  6495 FORMAT(' * * RECONNAISSANCE W/PMSL-ID=',A8,', LAT=',F7.2,'N, ',
  11964      $ 'LON=',F8.2,'E, RTYP',I4,' - SFC P,Z FLAGGED; PROCESSED LATER',
  11965      $ ' AS R.TYPE 182')
  11966             END IF
  11967 C IF PRESSURE IS MISSING OR UNREASONABLE, SKIP PROCESSING OF TOTAL RPT
  11968             IF(PP.LT.938.25.OR.PP.GT.1063.25.OR.IPPM.GE.IQMLIM)  THEN
  11969                KOUNT = KOUNT - 1
  11970              IF(IPRINT.EQ.0) PRINT 3989,STNID,RDATA(1),RDATA(2),IDATA(9)
  11971  3989 FORMAT(' * * TOTAL REPORT TOSSED  -ID=',A8,', LAT=',F7.2,'N, ',
  11972      $ 'LON=',F8.2,'E, RTYP',I4,' - INVALID PSTN FOR RECCO REPORT')
  11973                RETURN 2
  11974             END IF
  11975 C.......................................................................
  11976          END IF
  11977          LL = LL + 1
  11978 C STORE PRESSURE OBS (*10 MB) IN WORD 1 OF MOBS MASS LEVEL
  11979          MOBS(1,1,LL) = NINT(PP * 10.)
  11980          ICAT(LL) = JCAT
  11981          IF(IFLC6.EQ.1)  THEN
  11982             IF(IPPM.LE.3.OR.IPPM.GT.15) IPPM = 15
  11983             IF(IGM .LE.3.OR.IPPM.GT.15) IGM  = 15
  11984          END IF
  11985 C STORE P,Z PREPBUFR TABLE VALUES IN WORDS 1-2 OF MOBS MASS LEVEL
  11986          MOBS(2,1,LL) = IPPM
  11987          MOBS(2,2,LL) = IGM
  11988 C STORE GEOPOTENTIAL OBS (METERS) IN WORD 2 OF MOBS MASS LEVEL
  11989          IF(IGM.LT.IQMLIM)  MOBS(1,2,LL) = NINT(ZZ)
  11990       END IF
  11991 C-----------------------------------------------------------------------
  11992 C   STORE MASS DATA INTO CATEGORY 6 MOBS DATA LEVEL (ASSUMES KLVL = 1)
  11993 C-----------------------------------------------------------------------
  11994       DO KM = 1,KLVL
  11995          JT = 32767
  11996          LL = LL + 1
  11997          L = (9 * (KM - 1)) + IDATA(24)
  11998          ZZZ = NINT(RDATA(L+1))
  11999 C FILL IN PREPBUFR TABLE VALUES
  12000          IZM = NINT(RDATA(L+7))
  12001          ITM = NINT(RDATA(L+8))
  12002          IQM = NINT(RDATA(L+9))
  12003          IF(IDATA(9).EQ.63)  THEN
  12004             IWM = NINT(RDATA(L+10))
  12005             IF(IWM_RFFL.LT.IMISS.AND.IWM.EQ.2)  IWM = IWM_RFFL
  12006 C FOR SATWND REPORTS, A REJECT, PURGE, OR FAIL FLAG ON WIND IS
  12007 C  TRANSFERRED TO HEIGHT (LATER PRESSURE), TEMPERATURE AND MOISTURE
  12008             IF(IWM.GT.11)   THEN

Page 279         Source Listing                  GETC06
2017-04-18 11:09                                 prepdata.f

  12009                IZM = IWM
  12010                ITM = IWM
  12011                IQM = IWM
  12012             END IF
  12013          END IF
  12014          IPM = IZM
  12015 C PROCESS NON-MISSING TEMP REGARDLESS OF PREPBUFR TABLE VALUE
  12016          IF(ITM.LT.IQMLIM.AND.RDATA(L+2).LT.YMISS)  THEN
  12017             IGOODT = 1
  12018             JT = NINT((RDATA(L+2)/10.) *  100.0)
  12019             IF(JT.GE.32767)  GO TO 15
  12020 C STORE REPORTED (SENSIBLE) TEMP OBS (*100 DEG. C) IN WORD 3 OF MOBS
  12021 C  MASS LEVEL (UNLESS FLRECO = TRUE AND RECSLM = FALSE)
  12022             IF(RECSLM.OR..NOT.FLRECO)  MOBS(1,3,LL) = JT
  12023             IF(FLRECO.OR.NN.EQ.2.OR.NN.EQ.3)  THEN
  12024 C PROCESS NON-MISSING MOISTURE FOR AIRCRAFT (ALL TYPES) OR FLRECO = TRUE
  12025 C  (NOTE: HERE INPUT MOISTURE VARIABLE IS SPEC. HUMIDITY IN G/KG)
  12026                IF(RDATA(L+3).LE.9999.)  THEN
  12027                   IF(IQM.LT.IQMLIM.AND.RDATA(L+3).GE.0)  THEN
  12028                      Q  = RDATA(L+3) * 0.001 ! SPEC. HUM. IN G/G
  12029                      INTQ = NINT(Q*1.E6)
  12030                      IF(INTQ.EQ.0)  INTQ = 1
  12031                      DP = TFRMQP(Q,P(KM))
  12032                      TMPCEL = (DP - 273.16) * 100.
  12033                      IF(RECSLM.OR.NN.EQ.2)  THEN
  12034 C STORE SPEC HUMIDITY OBS (*10**6 G/G) IN WORD 4 OF MOBS MASS LEVEL
  12035 C  {MUST BE < IMISS (99999) AND > 0} (UNLESS FLRECO = TRUE AND RECSLM =
  12036 C  FALSE)
  12037                         IF(INTQ.GT.0.AND.INTQ.LT.IMISS)MOBS(1,4,LL)=INTQ
  12038 C STORE DEWPOINT TEMP OBS (*100 DEG. C) IN WORD 6 OF MOBS MASS LEVEL
  12039 C  (UNLESS FLRECO = TRUE AND RECSLM = FALSE)
  12040                         IF(NINT(TMPCEL).LT.32767)
  12041      $                   MOBS(1,6,LL)=NINT(TMPCEL)
  12042 C STORE VIRT TEMP OBS (*100 DEG. C) IN WORD 5 OF MOBS MASS LEVEL (UNLESS
  12043 C  FLRECO = TRUE AND RECSLM = FALSE)
  12044                         TT = (NINT(RDATA(L+2)) * 0.1) + 273.16
  12045                         JT = NINT(100.0*((TT*(1.0 +(.61*Q)))-273.16))
  12046                         IF(JT.LT.32767) MOBS(1,5,LL) = JT
  12047                      END IF
  12048                   END IF
  12049                END IF
  12050             END IF
  12051          ELSE
  12052             IF(.NOT.FLRECO)  THEN
  12053 C IF TEMP IS BAD OR MISSING, NEVER PROCESS MASS PIECE UNLESS FLRECO = T
  12054                IF(RDATA(L+2).GE.YMISS)  ICALLM = -1
  12055                GO TO 7000
  12056             END IF
  12057          END IF
  12058    15    CONTINUE
  12059          IF(FLRECO)  THEN
  12060 C FOR FLRECO = TRUE, GET A BETTER EST. OF CAT. 6 PRESS. THAN JUST STD.
  12061 C  ATMOS. (VIA FUNCTION 'PRE') SINCE GEOPOTENTIAL (ZZ) ALWAYS VALID
  12062             IF(JT.GE.32767.OR.ITM.GT.IQMGUD)  THEN
  12063 C IF TEMP ON CAT. 6 LVL IS MISSING, MUST EST. VIA U.S. STD. ATMOS. VALUE
  12064                CALL W3FA03(P(1),DUM1,TEMP,DUM2)
  12065             ELSE

Page 280         Source Listing                  GETC06
2017-04-18 11:09                                 prepdata.f

  12066 C ELSE, VALID TEMP HERE IS VIRT(SENS) IF SP. HUM. AVAILABLE(NOT AVAIL.)
  12067                TEMP = (REAL(JT)/100.0) + 273.16
  12068             END IF
  12069             P(1) = PRE(PP,TEMP,ZZZ,ZZ)
  12070          END IF
  12071 C STORE PRESSURE OBS (*10 MB) IN WORD 1 OF MOBS MASS LEVEL
  12072          MOBS(1,1,LL) = NINT(P(KM) * 10.)
  12073          IF(.NOT.FLRECO.OR.RECSLM)  THEN
  12074             IF(IFLC6.EQ.1)  THEN
  12075                IF(IPM.LE.3.OR.IPM.GT.15) IPM = 15
  12076                IF(IZM.LE.3.OR.IZM.GT.15) IZM = 15
  12077                IF(ITM.LE.3.OR.ITM.GT.15) ITM = 15
  12078                IF(IQM.LE.3.OR.IQM.GT.15) IQM = 15
  12079             END IF
  12080          ELSE
  12081             IPM = 2
  12082             IF(IFLC6.EQ.1)  IPM = 15
  12083             ITM = 15
  12084             IZM = 15
  12085             IQM = 15
  12086          END IF
  12087          ICAT(LL) = 6
  12088 C STORE P, Z, T, Q PREPBUFR TABLE VALUES IN WORDS 1-4 OF MOBS MASS LEVEL
  12089          MOBS(2,1,LL) = IPM
  12090          MOBS(2,2,LL) = IZM
  12091          MOBS(2,3,LL) = ITM
  12092          MOBS(2,4,LL) = IQM
  12093 C STORE PRESSURE ALTITUDE OBS (METERS) IN WORD 2 OF MOBS MASS LEVEL
  12094 C  (UNLESS FLRECO = TRUE AND RECSLM = FALSE)
  12095          IF(RECSLM.OR..NOT.FLRECO)  THEN
  12096             IF(NINT(ZZZ).LT.IMISS)  MOBS(1,2,LL) = NINT(ZZZ)
  12097          END IF
  12098          ICALLM = 1
  12099       ENDDO
  12100 C-----------------------------------------------------------------------
  12101  7000 CONTINUE
  12102       IF(ICALLM.EQ.1)  THEN
  12103          IF(LL.GT.1)  THEN
  12104 C IF THERE ARE TWO MOBS LEVELS (CAN ONLY HAPPEN FOR FLRECO = TRUE),
  12105 C  RESTORE THEM BY DECREASING PRESSURE
  12106             IPL1 = MOBS(1,1,1)
  12107             IPL2 = MOBS(1,1,2)
  12108             IF(IPL1.LT.IPL2)  THEN
  12109                MOBS1 = MOBS(:,:,1)
  12110                MOBS(:,:,1) = MOBS(:,:,2)
  12111                MOBS(:,:,2) = MOBS1
  12112                ICAT1 = ICAT(1)
  12113                ICAT(1) = ICAT(2)
  12114                ICAT(2) = ICAT1
  12115             END IF
  12116          END IF
  12117 C SET REPORT SEQ. NUMBER TO "ISQNUM(1)" IF RECCO, OR TO "ISQNUM(3) IF
  12118 C  AIREP/PIREP, AMDAR, EAMDAR, TAMDARM, CAMDAR, KAMDAR, AMDARB OR
  12119 C  TAMDARB AIRCFT, OR TO "ISQNUM(4)" IF SATELLITE (CLOUD-DRIFT,
  12120 C  W. VAPOR, VISIBLE, ETC) AND STORE IN HDR(11)
  12121 C  {NOTE: "ISQNUM(2)" FOR MDCRS AIRCFT IS NOT USED HERE SINCE HDR(11)
  12122 C         HAS ALREADY BEEN FILLED IN SUBR. RPTLBL, THUS THE TEST FOR

Page 281         Source Listing                  GETC06
2017-04-18 11:09                                 prepdata.f

  12123 C         MISSING BELOW}
  12124 ccdak    IF(HDR(11).GE.YMISS)  HDR(11) = ISQNUM(NN)
  12125                                        !SQN can now be > XMISS (99999.)
  12126          IF(HDR(11).GE.YMISS*10.)  HDR(11) = ISQNUM(NN)
  12127 C NOW CALL FILLX TO INITIATE PROCESS TO ENCODE RPT INTO PREPBUFR FILE
  12128          CALL FILLX(LL,IERF)
  12129          IF(IERF.EQ.1)  THEN
  12130             ICALLM = -99
  12131          ELSE
  12132             IF(IGOODT.EQ.0.AND.IPRINT.EQ.0)  PRINT 787, STNID
  12133   787 FORMAT(7X,'* * * * *   NO VALID TEMP INFORMATION IN ID = ',A8,
  12134      $' ON ANY LVL, MASS PIECE STORED BUT ONLY W/ P-ALTITUDE * * * * *')
  12135 C+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
  12136 C OPTION TO PRINT LISTING OF ALL MASS RPTS (NORM. COMMENTED OUT)
  12137 C           PRINT 9091, STNID,IDATA(9),NINT(HDR(6))
  12138 C9091 FORMAT(1X,'STN. ',A8,'DUMP R. TYPE = ',I3,'  PREPBUFR REPORT ',
  12139 C    $ 'TYPE =',I4)
  12140 C+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
  12141          END IF
  12142       END IF
  12143  1900 CONTINUE
  12144 C***********************************************************************
  12145 C                  FILL IN WIND INFORMATION FOR REPORT
  12146 C***********************************************************************
  12147       IF(ICALLM.EQ.1) THEN
  12148 C  DO NOT ENCODE OBS2 OR OBS3 VARIABLES WITH WIND REPORT UNLESS NO MASS
  12149 C   REPORT WAS GENERATED {EXCEPTIONS: OBS2(1-3) - RSRD, EXPRSRD, ALSE}
  12150          OBS2(4:NUMOBS2) = BMISS
  12151          OBS3 = BMISS
  12152          NOBS3 = 0
  12153       END IF
  12154 C 'ICALLW' INDICATES WHETHER WIND PIECE STORED IN OUTPUT FILE {IF SO =1;
  12155 C  IF NOT = -99 (NOT PROCESSED) OR = -1 (MSG. WIND) OR = 0 (BAD WIND)}
  12156       ICALLW = -99
  12157 C SKIP WIND REPORT: IF ACFT & JAWIND(IBNDA,NAC) = 9999;
  12158 C                   IF SATWND(ALL TYPES) & JSWIND(IBAND,NSW,IPD) = 9999;
  12159       IF((IDATA(9).EQ.41.AND.JAWIND(IBNDA,NAC).NE.0)
  12160      $ .OR.(IDATA(9).EQ.63.AND.JSWIND(IBAND,NSW,IPD).EQ.9999)) GOTO 1800
  12161       ICALLW = 0
  12162 C GET PREPBUFR REPORT TYPE (NOTE: FOR SOME TYPES, HIGH- VS. LOW-LEVEL
  12163 C  SAT. WIND RPTS GET DIFFERENT R. TYPES)
  12164       IF(IDATA(9).EQ.63)  THEN
  12165          IF(P(1).LE.800.00001.AND.(NHDR6.EQ.242.OR.NHDR6.EQ.243))
  12166      $    NHDR6 = NHDR6 + 10
  12167       END IF
  12168       HDR(6) = NHDR6
  12169       LL =  0
  12170 C INITIALIZE BOTTOM TWO LEVELS OF MOBS ARRAY (NEED TWO LEVELS IN CASE
  12171 C  FLRECO = TRUE)
  12172       MOBS(1:MXTYPV,1:MXWRDL,1:2) = IMISS
  12173 C INITIALIZE BOTTOM TWO LEVELS OF ICAT ARRAY
  12174       ICAT(1:2) = IMISS
  12175 C-----------------------------------------------------------------------
  12176 C   STORE WIND DATA INTO CATEGORY 6 MOBS DATA LEVEL (ASSUMES KLVL = 1)
  12177 C-----------------------------------------------------------------------
  12178       DO KW = 1,KLVL
  12179          LL = LL + 1

Page 282         Source Listing                  GETC06
2017-04-18 11:09                                 prepdata.f

  12180          L = (9 * (KW - 1)) + IDATA(24)
  12181          ZZZ = NINT(RDATA(L+1))
  12182 C FILL IN PREPBUFR TABLE VALUES
  12183          IPM = NINT(RDATA(L+ 7))
  12184          IWM = NINT(RDATA(L+10))
  12185          IF(IDATA(9).EQ.63)  THEN
  12186 C FOR SATWND REPORTS, WIND Q.M. IS BASED ON RFFL VALUE (SEE ABOVE)
  12187 C  (Note: Now that RFFL is encoded in PREPBUFR file, it may be
  12188 C         best to eventually let anal determine quality based on RFFL)
  12189             IF(IWM_RFFL.LT.IMISS.AND.IWM.EQ.2)  IWM = IWM_RFFL
  12190 C FOR SATWND REPORTS, A REJECT, PURGE, OR FAIL FLAG ON WIND IS
  12191 C  TRANSFERRED TO PRESSURE
  12192             IF(IWM.GT.11)   IPM = IWM
  12193          END IF
  12194 C STORE PRESSURE OBS (*10 MB) IN WORD 1 OF MOBS WIND LEVEL
  12195          MOBS(1,1,LL) = NINT(P(KW) * 10.)
  12196          IZM = 15
  12197          IF(NINT(ZZZ).LT.IMISS)  THEN
  12198 C STORE PRESSURE ALTITUDE OBS (METERS) IN WORD 2 OF MOBS WIND LEVEL
  12199             MOBS(1,2,LL) = NINT(ZZZ)
  12200             IZM = IPM
  12201          END IF
  12202          IF(IFLC6.EQ.1)  THEN
  12203             IF(IPM.LE.3.OR.IPM.GT.15) IPM = 15
  12204             IF(IZM.LE.3.OR.IZM.GT.15) IZM = 15
  12205             IF(IWM.LE.3.OR.IWM.GT.15) IWM = 15
  12206          END IF
  12207          ICAT(LL) = 6
  12208 C STORE P, Z, W PREPBUFR TABLE VALUES IN WORDS 1-4 OF MOBS WIND LEVEL
  12209          MOBS(2,1,LL) = IPM
  12210          MOBS(2,2,LL) = IZM
  12211          MOBS(2,3,LL) = IWM
  12212          MOBS(2,4,LL) = IWM
  12213 C PROCESS NON-MSG WIND REGARDLESS OF PREPBUFR TABLE VALUE
  12214          IF(IWM.GE.IQMLIM.OR.MAX(RDATA(L+4),RDATA(L+5)).GE.YMISS)  THEN
  12215             IF(MAX(RDATA(L+4),RDATA(L+5)).GE.YMISS)  ICALLW = -1
  12216             GO TO 6000
  12217          END IF
  12218 C CONVERT WIND DIRECTION & SPEED TO U- AND V-COMPONENTS
  12219          CALL UV(RDATA(L+4),RDATA(L+5)*0.1,UCOMP,VCOMP)
  12220          IF(MAX(NINT(UCOMP*100.),NINT(VCOMP*100.)).LT.32767)  THEN
  12221 C STORE U-COMP OBS (*100 M/SEC) IN WORD 3 OF MOBS WIND LEVEL
  12222             MOBS(1,3,LL) = NINT((UCOMP * 100.0) + 0.005)
  12223 C STORE V-COMP OBS (*100 M/SEC) IN WORD 4 OF MOBS WIND LEVEL
  12224             MOBS(1,4,LL) = NINT((VCOMP * 100.0) + 0.005)
  12225          else
  12226            print 1681, stnid,kw
  12227  1681 format(5X,'* * * * *   WIND REPORT TOSSED, ID = ',A8,', LEVEL',I3
  12228      $,' EITHER U- OR V-COMP ERRONEOUSLY LARGE, SET TO MISSING  * * * ',
  12229      $ '* *')
  12230            icallw = -1
  12231            go to 6000
  12232          END IF
  12233          JDD = NINT(RDATA(L+4))
  12234          JFF = NINT(RDATA(L+5) * 0.19425)
  12235          IF(MAX(JDD,JFF).LT.32767)  THEN
  12236 C STORE WIND DIRECTION OBS (DEGREES) IN WORD 5 OF MOBS WIND LEVEL

Page 283         Source Listing                  GETC06
2017-04-18 11:09                                 prepdata.f

  12237 C STORE WIND SPEED OBS (KNOTS) IN WORD 6 OF MOBS WIND LEVEL
  12238             MOBS(1,5,LL) = JDD
  12239             MOBS(1,6,LL) = JFF
  12240          END IF
  12241          ICALLW = 1
  12242       ENDDO
  12243 C-----------------------------------------------------------------------
  12244  6000 CONTINUE
  12245       IF(ICALLW.EQ.1)  THEN
  12246          IF(LL.GT.1)  THEN
  12247 C IF THERE ARE TWO MOBS LEVELS (CAN ONLY HAPPEN FOR FLRECO = TRUE),
  12248 C  RESTORE THEM BY DECREASING PRESSURE
  12249             IPL1 = MOBS(1,1,1)
  12250             IPL2 = MOBS(1,1,2)
  12251             IF(IPL1.LT.IPL2)  THEN
  12252                MOBS1 = MOBS(:,:,1)
  12253                MOBS(:,:,1) = MOBS(:,:,2)
  12254                MOBS(:,:,2) = MOBS1
  12255                ICAT1 = ICAT(1)
  12256                ICAT(1) = ICAT(2)
  12257                ICAT(2) = ICAT1
  12258             END IF
  12259          END IF
  12260 C SET REPORT SEQ. NUMBER TO "ISQNUM(1)" IF RECCO, OR TO "ISQNUM(3) IF
  12261 C  AIREP/PIREP, AMDAR, EAMDAR, TAMDARM, CAMDAR, KAMDAR, AMDARB OR
  12262 C  TAMDARB AIRCFT, OR TO "ISQNUM(4)" IF SATELLITE (CLOUD-DRIFT,
  12263 C  W.VAPOR, VISIBLE, ETC) AND STORE IN HDR(11)
  12264 C  {NOTE: "ISQNUM(2)" FOR MDCRS AIRCFT IS NOT USED HERE SINCE HDR(11)
  12265 C         HAS ALREADY BEEN FILLED IN SUBR. RPTLBL, THUS THE TEST FOR
  12266 C         MISSING BELOW}
  12267 ccdak    IF(HDR(11).GE.YMISS)  HDR(11) = ISQNUM(NN)
  12268                                        !SQN can now be > XMISS (99999.)
  12269          IF(HDR(11).GE.YMISS*10.)  HDR(11) = ISQNUM(NN)
  12270 C NOW CALL FILLX TO PUT THIS REPORT INTO BLOCK OF REPORTS
  12271          CALL FILLX(LL,IERF)
  12272          IF(IERF.EQ.1)  THEN
  12273             ICALLW = -99
  12274 C        ELSE
  12275 C+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
  12276 C OPTION TO PRINT LISTING OF ALL DATA LEVEL CAT. 6 WIND RPTS (NORMALLY
  12277 C                         . COMMENTED OUT)
  12278 C           PRINT 9090, STNID,IDATA(9),NINT(HDR(6))
  12279 C9090 FORMAT(1X,'STN. ',A8,'DUMP R. TYPE = ',I3,'  PREPBUFR REPORT ',
  12280 C    $ 'TYPE =',I4)
  12281 C+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
  12282          END IF
  12283       END IF
  12284 C***********************************************************************
  12285  1800 CONTINUE
  12286       IF(IPRINT.EQ.0)  THEN
  12287          IF(ICALLW.EQ.1)  THEN
  12288             IF(ICALLM.EQ.0)  PRINT 679, STNID,KM,ITM
  12289   679 FORMAT(6X,'* * * * *   MASS REPORT TOSSED, ID = ',A8,', LEVEL',I3,
  12290      $ ' IW3UNPBF TEMP Q.M. IS BAD (PREPBUFR TABLE VALUE=',I2,
  12291      $ ')   * * * * *')
  12292             IF(ICALLM.EQ.-1)  PRINT 1679, STNID,KM
  12293  1679 FORMAT(24X,'* * * * *   MASS REPORT TOSSED, ID = ',A8,', LEVEL',I3

Page 284         Source Listing                  GETC06
2017-04-18 11:09                                 prepdata.f

  12294      $,' TEMP IS MISSING   * * * * *')
  12295          ELSE  IF(ICALLM.EQ.1)  THEN
  12296             IF(ICALLW.EQ.0)  PRINT 680, STNID,KW,IWM
  12297   680 FORMAT(6X,'* * * * *   WIND REPORT TOSSED, ID = ',A8,', LEVEL',I3,
  12298      $ ' IW3UNPBF WIND Q.M. IS BAD (PREPBUFR TABLE VALUE=',I2,
  12299      $ ')   * * * * *')
  12300             IF(ICALLW.EQ.-1)  PRINT 1680, STNID,KW
  12301  1680 FORMAT(24X,'* * * * *   WIND REPORT TOSSED, ID = ',A8,', LEVEL',I3
  12302      $,' WIND IS MISSING   * * * * *')
  12303          END IF
  12304       END IF
  12305       IF(ICALLM.EQ.1.OR.ICALLW.EQ.1)  THEN
  12306          IF(IDATA(9).EQ.63) KEPSW(IBAND,NSW,IPD)= KEPSW(IBAND,NSW,IPD)+1
  12307          IF(IDATA(9).EQ.41) KEPAC(IBNDA,NAC) = KEPAC(IBNDA,NAC) + 1
  12308          RETURN 1
  12309       ELSE
  12310          IF(WRMISS) THEN
  12311             IF(NN.EQ.3) THEN
  12312 C IF N-LIST SWITCH WRMISS IS TRUE, NO VALID TEMP OR WIND DATA PRESENT
  12313 C  AND REPORT IS FROM "AIRCFT" MESSAGE TYPE, CHECK FOR PRESENCE OF ANY
  12314 C  ANCILLARY INFORMATION (E.G., SENSIBLE WEATHER ELEMENTS) - IF SOME IS
  12315 C  FOUND, WILL ENCODE AS A MASS REPORT (EVEN THOUGH THIS INFO IS NOT
  12316 C  DIRECTLY USED BY ASSIMILATION, IT MIGHT BE USEFUL FOR VERIFICATION
  12317 C  OR IN OTHER WAYS)
  12318 c
  12319 c  bug fix dak 2/3/16: If the only non-missing ancillary information
  12320 c   found is RSRD or EXPRSRD {stored in OBS2(1) and OBS2(2)}, then
  12321 c   CHANGE to NOT encode a mass report because it would later cause
  12322 c   PREPACQC to fail since a place holder for NRLQMS is not encoded
  12323 c   into pre-QC PRPEBUFR file in this case (NRLQMS is in the PRSLEVLA
  12324 c   replication which in this case would be zero) -- fortunately a
  12325 c   failure has never occurred because AMDAR reports (only type
  12326 c   restricted) have never had both a missing temperature & wind
  12327 c    (lines commented out below fix the bug)
  12328 ccccccccccccc  NMOBS2 = 0
  12329                NMHDR  = 0
  12330 ccccccccccccc  DO I = 1,2
  12331 ccccccccccccc     IF(OBS2(I).LT.YMISS) THEN
  12332 ccccccccccccc        NMOBS2 = 1
  12333 ccccccccccccc        EXIT
  12334 ccccccccccccc     END IF
  12335 ccccccccccccc  ENDDO
  12336 ccccccccccccc  IF(NMOBS2.EQ.0) THEN
  12337                   IF(MIN(ROLF,RIALR,POAF,TRBX(5),PCAT).LT.YMISS) NMHDR=1
  12338 ccccccccccccc  END IF
  12339 ccccccccccccc  IF(MAX(NOBS3(2),NOBS3(3),NOBS3(6),NOBS3(7),NMOBS2,NMHDR)
  12340                IF(MAX(NOBS3(2),NOBS3(3),NOBS3(6),NOBS3(7),NMHDR)
  12341      $          .GT.0) THEN
  12342                   LL = 1
  12343 C GET PREPBUFR REPORT TYPE (STORE AS MASS PIECE)
  12344                   HDR(6) = NHDR6 - 100
  12345                   IF(NHDR6.EQ.251)  HDR(6) = 144
  12346 C SET REPORT SEQ. NUMBER TO "ISQNUM(1)" IF RECCO, OR TO "ISQNUM(3) IF
  12347 C  AIREP/PIREP, AMDAR, EAMDAR, TAMDAR(M/B), CAMDAR, KAMDAR, AMDARB OR
  12348 C  AIRCFT, OR TO "ISQNUM(4)" IF SATELLITE (CLOUD-DRIFT, W. VAPOR,
  12349 C  VISIBLE, ETC) AND STORE IN HDR(11)
  12350 C  {NOTE: "ISQNUM(2)" FOR MDCRS AIRCFT IS NOT USED HERE SINCE HDR(11)

Page 285         Source Listing                  GETC06
2017-04-18 11:09                                 prepdata.f

  12351 C         HAS ALREADY BEEN FILLED IN SUBR. RPTLBL, THUS THE TEST FOR
  12352 C         MISSING BELOW}
  12353 ccdak             IF(HDR(11).GE.YMISS)  HDR(11) = ISQNUM(NN)
  12354                                        !SQN can now be > XMISS (99999.)
  12355                   IF(HDR(11).GE.YMISS*10.)  HDR(11) = ISQNUM(NN)
  12356 C NOW CALL FILLX TO PUT THIS REPORT INTO BLOCK OF REPORTS
  12357                   CALL FILLX(LL,IERF)
  12358                   IF(IERF.EQ.0)  THEN
  12359                      IF(IPRINT.EQ.0)  PRINT 9787, STNID
  12360  9787 FORMAT(1X,'* * * NO VALID TEMP/WIND INFO IN ID = ',A8,' ON ANY ',
  12361      $ 'LVL, MASS PIECE STORED BUT ONLY W/ ANCILLARY (E.G. SENS WX ',
  12362      $ 'ELM) DATA * * *')
  12363          IF(IDATA(9).EQ.63) KEPSW(IBAND,NSW,IPD)= KEPSW(IBAND,NSW,IPD)+1
  12364          IF(IDATA(9).EQ.41) KEPAC(IBNDA,NAC) = KEPAC(IBNDA,NAC) + 1
  12365                      RETURN 1
  12366                   END IF
  12367                END IF
  12368             END IF
  12369          END IF
  12370          KOUNT = KOUNT - 1
  12371          IF(IPRINT.EQ.0)  PRINT 959,STNID,alat_8,alon_8,IDATA(9)
  12372   959 FORMAT(' * * TOTAL REPORT TOSSED  -ID=',A8,', LAT=',F10.5,'N, ',
  12373      $ 'LON=',F11.5,'E, RTYP',I4,' - NO VALID DATA IN GETC06')
  12374          RETURN 2
  12375       END IF
  12376       END


ENTRY POINTS

  Name               
                     
 getc06_             

Page 286         Source Listing                  GETC06
2017-04-18 11:09 Symbol Table                    prepdata.f



SYMBOL CROSS REFERENCE

 Name                       Object Declared Type            Bytes Dimen Elements Attributes       References                        
                                                                                                                                    
 15                         Label  12058                                                          12019                             
 1679                       Label  12293                                                          12292                             
 1680                       Label  12301                                                          12300                             
 1681                       Label  12227                                                          12226                             
 1700                       Label  11420                                                          11417                             
 1800                       Label  12285                                                          12160                             
 1900                       Label  12143                                                          11899,11908                       
 1956                       Label  11569                                                          11568                             
 2355                       Label  11656                                                          11655                             
 2455                       Label  11668                                                          11666                             
 2855                       Label  11687                                                          11686                             
 2951                       Label  11354                                                          11353                             
 2959                       Label  11876                                                          11875                             
 3455                       Label  11677                                                          11675                             
 3989                       Label  11971                                                          11970                             
 5952                       Label  11553                                                          11552                             
 6000                       Label  12244                                                          12216,12231                       
 6495                       Label  11963                                                          11962                             
 6700                       Label  11599                                                          11596                             
 679                        Label  12289                                                          12288                             
 680                        Label  12297                                                          12296                             
 7000                       Label  12101                                                          12055                             
 787                        Label  12133                                                          12132                             
 7955                       Label  11905                                                          11904                             
 950                        Label  11349                                                          11348                             
 954                        Label  11507                                                          11506                             
 955                        Label  11518                                                          11517                             
 959                        Label  12372                                                          12371                             
 9787                       Label  12360                                                          12359                             
 ACFTSW                     Common 11262                                1148                                                        
 ADP                        Common 11259                                14100                                                       
 AIFNOW                     Scalar 11251    L(4)            4     1     9        COM              11682                             
 AIRLND                     Scalar 11251    L(4)            4     2     54       COM              11645                             
 ALAT_8                     Scalar 11253    R(8)            8           scalar   COM              11875,12371                       
 ALOG                       Func   11327                                scalar                    11327                             
 ALON_8                     Scalar 11253    R(8)            8           scalar   COM              11875,12371                       
 AMANDP                     Local  11729    R(4)            4           scalar                    11729,11758,11936                 
 AMANDZ                     Local  11728    R(4)            4           scalar                    11728,11757,11937                 
 AMNDZQ                     Local  11759    R(4)            4           scalar                    11759,11940                       
 AMSLPR                     Local  11730    R(4)            4           scalar                    11730,11765,11949                 
 AMSTQ                      Scalar 11264    R(4)            4           scalar   COM              11722,11799                       
 AS                         Local  11327    R(4)            4           scalar                    11328                             
 AWINDO                     Scalar 11262    R(4)            4     2     18       COM              11641,11642                       
 BMISS                      Scalar 11253    R(8)            8           scalar   COM              12150,12151                       
 BUFRLIB_MISSING            Common 11281                                8                                                           
 CBULL                      Scalar 11250    CHAR            11          scalar   COM                                                
 CRES1                      Scalar 11249    CHAR            8           scalar   COM              11458,11464,11838                 
 CRES2                      Scalar 11249    CHAR            8           scalar   COM              11824                             
 CYCLET                     Dummy  11241    R(4)            4           scalar   ARG,INOUT        11701                             
 DATA                       Common 11260                                32                                                          
 DIRECT                     Common 11279                                36016                                                       

Page 287         Source Listing                  GETC06
2017-04-18 11:09 Symbol Table                    prepdata.f

 Name                       Object Declared Type            Bytes Dimen Elements Attributes       References                        
                                                                                                                                    
 DP                         Local  12031    R(4)            4           scalar                    12031,12032                       
 DROPSN                     Scalar 11270    R(4)            4           scalar   COM                                                
 DUM1                       Local  12064    R(4)            4           scalar                    12064                             
 DUM2                       Local  12064    R(4)            4           scalar                    12064                             
 DWINDO                     Scalar 11270    R(4)            4           scalar   COM                                                
 EEQF                       Scalar 11267    R(4)            4           scalar   COM              11726,11792                       
 EXP                        Func   11319                                scalar                    11319                             
 FILLX                      Subr   12128                                                          12128,12271,12357                 
 FLACMS                     Scalar 11264    R(4)            4     1     9        COM                                                
 FLDMAF                     Scalar 11270    R(4)            4           scalar   COM                                                
 FLDMFR                     Scalar 11270    R(4)            4           scalar   COM                                                
 FLDMGS                     Scalar 11270    R(4)            4           scalar   COM                                                
 FLONVT                     Scalar 11276    R(4)            4           scalar   COM                                                
 FLRECO                     Scalar 11251    L(4)            4           scalar   COM              11805,11899,11922,12022,12023,1205
                                                                                                  2,12059,12073,12095               
 FMESHL                     Scalar 11276    R(4)            4           scalar   COM                                                
 FPOLEI                     Scalar 11276    R(4)            4           scalar   COM                                                
 FPOLEJ                     Scalar 11276    R(4)            4           scalar   COM                                                
 FWINDO                     Scalar 11277    R(4)            4     1     12       COM                                                
 GDNH                       Scalar 11258    R(4)            4     2     32942    COM              11563,11650                       
 GDSH                       Scalar 11258    R(4)            4     2     5365     COM              11561,11648                       
 GDUS                       Scalar 11258    R(4)            4     2     32942    COM              11625                             
 GETC06                     Subr   11241                                                                                            
 HDR                        Scalar 11261    R(4)            4     1     14       COM              11706,11820,11822,11824,11826,1183
                                                                                                  1,11851,11852,11914,11915,12126,12
                                                                                                  168,12269,12344,12345,12355       
 I                          Local  11733    I(4)            4           scalar                    11733                             
 IACFTH                     Scalar 11263    I(4)            4     1     9        COM              11672,11676                       
 IACFTL                     Scalar 11263    I(4)            4     1     9        COM              11663,11667                       
 IBAND                      Local  11366    I(4)            4           scalar                    11366,11415,11416,11419,11529,1153
                                                                                                  3,11536,11537,11539,11540,11543,11
                                                                                                  544,11558,11579,11580,11898,12160,
                                                                                                  12306,12363                       
 IBNDA                      Local  11365    I(4)            4           scalar                    11365,11594,11595,11598,11639,1164
                                                                                                  5,11897,12159,12307,12364         
 ICALLM                     Local  11893    I(4)            4           scalar                    11893,11910,11927,12054,12098,1210
                                                                                                  2,12130,12147,12288,12292,12295,12
                                                                                                  305                               
 ICALLW                     Local  12156    I(4)            4           scalar                    12156,12161,12215,12230,12241,1224
                                                                                                  5,12273,12287,12296,12300,12305   
 ICAT                       Scalar 11256    I(4)            4     1     600      COM              11921,11980,12087,12112,12113,1211
                                                                                                  4,12174,12207,12255,12256,12257   
 ICAT1                      Local  12112    I(4)            4           scalar                    12112,12114,12255,12257           
 ICF351                     Local  11713    I(4)            4           scalar                    11713,11756,11805,11929           
 ICF352                     Local  11714    I(4)            4           scalar                    11714,11764,11805                 
 ICF914                     Local  11716    I(4)            4           scalar                    11716,11738,11796,11822           
 IDAT10                     Scalar 11260    I(4)            4           scalar   COM                                                
 IDATA                      Scalar 11254    I(4)            4     1     3500     COM              11339,11348,11352,11353,11377,1138
                                                                                                  6,11506,11517,11552,11568,11602,11
                                                                                                  604,11606,11609,11611,11613,11615,
                                                                                                  11655,11662,11663,11667,11672,1167
                                                                                                  6,11683,11686,11731,11732,11733,11
                                                                                                  831,11860,11875,11887,11897,11898,
                                                                                                  11899,11904,11962,11970,11997,1200
                                                                                                  3,12159,12160,12164,12180,12185,12

Page 288         Source Listing                  GETC06
2017-04-18 11:09 Symbol Table                    prepdata.f

 Name                       Object Declared Type            Bytes Dimen Elements Attributes       References                        
                                                                                                                                    
                                                                                                  306,12307,12363,12364,12371       
 IDATE                      Scalar 11260    I(4)            4     1     4        COM                                                
 IER                        Local  11706    I(4)            4           scalar                    11706,11707                       
 IERF                       Local  12128    I(4)            4           scalar                    12128,12129,12271,12272,12357,1235
                                                                                                  8                                 
 IFLC6                      Local  11338    I(4)            4           scalar                    11338,11538,11542,11546,11571,1157
                                                                                                  2,11658,11659,11670,11671,11679,11
                                                                                                  680,11689,11690,11981,12074,12082,
                                                                                                  12202                             
 IGM                        Local  11371    I(4)            4           scalar                    11371,11940,11953,11961,11983,1198
                                                                                                  7,11989                           
 IGOODT                     Local  11912    I(4)            4           scalar                    11912,11928,12017,12132           
 ILAND                      Local  11561    I(4)            4           scalar                    11561,11563,11565,11625,11626,1164
                                                                                                  8,11650,11652                     
 IMISS                      Local  11316    I(4)            4           scalar                    11316,11727,11919,11921,12005,1203
                                                                                                  7,12096,12172,12174,12189,12197   
 INAC                       Local  11255    I(4)            4     1     9                         11283,11643                       
 INSTR                      Local  11381    I(4)            4           scalar                    11381,11513,11514,11643,11887     
 INTQ                       Local  12029    I(4)            4           scalar                    12029,12030,12037                 
 IPD                        Local  11364    I(4)            4           scalar                    11364,11450,11452,11454,11456,1145
                                                                                                  9,11461,11465,11467,11470,11513,11
                                                                                                  529,11531,11533,11536,11537,11539,
                                                                                                  11540,11543,11544,11558,11579,1158
                                                                                                  0,11841,11843,11845,11847,11898,12
                                                                                                  160,12306,12363                   
 IPL1                       Local  12106    I(4)            4           scalar                    12106,12108,12249,12251           
 IPL2                       Local  12107    I(4)            4           scalar                    12107,12108,12250,12251           
 IPM                        Local  11372    I(4)            4           scalar                    11372,12014,12075,12081,12082,1208
                                                                                                  9,12183,12192,12200,12203,12209   
 IPPM                       Local  11370    I(4)            4           scalar                    11370,11939,11952,11960,11968,1198
                                                                                                  2,11983,11986                     
 IPRINT                     Scalar 11259    I(4)            4           scalar   COM              11568,11655,11666,11675,11686,1197
                                                                                                  0,12132,12286,12359,12371         
 IQM                        Local  11374    I(4)            4           scalar                    11374,12002,12011,12027,12078,1208
                                                                                                  5,12092                           
 IQMGUD                     Local  11362    I(4)            4           scalar                    11362,12062                       
 IQMLIM                     Local  11361    I(4)            4           scalar                    11361,11968,11989,12016,12027,1221
                                                                                                  4                                 
 ISATOB                     Scalar 11259    I(4)            4           scalar   COM                                                
 ISEL                       Func   11887    I(4)            4           scalar                    11887                             
 ISQNUM                     Local  11254    I(4)            4     1     4                         11315,11334,11335,11885,12126,1226
                                                                                                  9,12355                           
 ISQNUM_UPA                 Scalar 11268    I(4)            4           scalar   COM              11335                             
 ITIMES                     Local  11255    I(4)            4     1     4                         11315,11330,11336                 
 ITM                        Local  12001    I(4)            4           scalar                    12001,12010,12016,12062,12077,1208
                                                                                                  3,12091,12288                     
 IUS                        Local  11369    I(4)            4           scalar                    11369,11626,11641,11642           
 IVADFL                     Scalar 11270    I(4)            4           scalar   COM                                                
 IVADSP                     Scalar 11270    I(4)            4           scalar   COM                                                
 IWM                        Local  12004    I(4)            4           scalar                    12004,12005,12008,12009,12010,1201
                                                                                                  1,12184,12189,12192,12205,12211,12
                                                                                                  212,12214,12296                   
 IWM_RFFL                   Local  11727    I(4)            4           scalar                    11727,11774,11776,11778,11780,1200
                                                                                                  5,12189                           
 IZM                        Local  11373    I(4)            4           scalar                    11373,12000,12009,12014,12076,1208

Page 289         Source Listing                  GETC06
2017-04-18 11:09 Symbol Table                    prepdata.f

 Name                       Object Declared Type            Bytes Dimen Elements Attributes       References                        
                                                                                                                                    
                                                                                                  4,12090,12196,12200,12204,12210   
 JAMASS                     Scalar 11262    I(4)            4     2     54       COM              11639,11897                       
 JAWIND                     Scalar 11262    I(4)            4     2     54       COM              11639,12159                       
 JCAT                       Local  11934    I(4)            4           scalar                    11934,11947,11980                 
 JCF914                     Local  11715    I(4)            4           scalar                    11715,11737,11796                 
 JDD                        Local  12233    I(4)            4           scalar                    12233,12235,12238                 
 JFF                        Local  12234    I(4)            4           scalar                    12234,12235,12239                 
 JNSTR                      Local  11254    I(4)            4     2     80                        11284,11513                       
 JSMASS                     Scalar 11266    I(4)            4     3     480      COM              11529,11533,11537,11540,11544,1189
                                                                                                  8                                 
 JSURFM                     Scalar 11277    I(4)            4     1     12       COM              11954                             
 JSURFW                     Scalar 11277    I(4)            4     1     12       COM                                                
 JSWIND                     Scalar 11266    I(4)            4     3     480      COM              11529,11533,11536,11539,11543,1216
                                                                                                  0                                 
 JT                         Local  11995    I(4)            4           scalar                    11995,12018,12019,12022,12045,1204
                                                                                                  6,12062,12067                     
 K                          Local  11859    I(4)            4           scalar                    11859,11860,11861,11863,11867,1186
                                                                                                  9,11872,11875                     
 KBDYSF                     Scalar 11271    I(4)            4           scalar   COM                                                
 KBDYUA                     Scalar 11271    I(4)            4           scalar   COM                                                
 KEPAC                      Scalar 11263    I(4)            4     2     54       COM              12307,12364                       
 KEPSW                      Scalar 11266    I(4)            4     3     480      COM              12306,12363                       
 KLVL                       Local  11339    I(4)            4           scalar                    11339,11341,11347,11352,11859,1199
                                                                                                  4,12178                           
 KM                         Local  11994    I(4)            4           scalar                    11994,11997,12031,12072,12288,1229
                                                                                                  2                                 
 KMSGSF                     Scalar 11271    I(4)            4           scalar   COM                                                
 KMSGUA                     Scalar 11271    I(4)            4           scalar   COM                                                
 KNDCDE                     Scalar 11274    I(4)            4     1     3        COM                                                
 KNOATS                     Scalar 11272    I(4)            4           scalar   COM                                                
 KNTAIR                     Scalar 11272    I(4)            4           scalar   COM                                                
 KNTCAR                     Scalar 11272    I(4)            4           scalar   COM                                                
 KNTDUM                     Scalar 11273    I(4)            4     1     3        COM                                                
 KNTMSO                     Scalar 11273    I(4)            4           scalar   COM                                                
 KNTPRO                     Scalar 11272    I(4)            4           scalar   COM                                                
 KNTRAS                     Scalar 11273    I(4)            4           scalar   COM                                                
 KNTSFC                     Scalar 11273    I(4)            4           scalar   COM                                                
 KNTSHP                     Scalar 11273    I(4)            4           scalar   COM                                                
 KNTSLP                     Scalar 11273    I(4)            4           scalar   COM                                                
 KNTSPL                     Scalar 11273    I(4)            4           scalar   COM                                                
 KNTSWN                     Scalar 11272    I(4)            4           scalar   COM                                                
 KNTUPA                     Scalar 11272    I(4)            4           scalar   COM                                                
 KNTVAD                     Scalar 11273    I(4)            4           scalar   COM                                                
 KOUNT                      Scalar 11260    I(4)            4           scalar   COM              11884,11969,12370                 
 KSKACF                     Scalar 11274    I(4)            4           scalar   COM              11658                             
 KSKAHM                     Scalar 11275    I(4)            4     1     9        COM              11679                             
 KSKALM                     Scalar 11274    I(4)            4     1     9        COM              11670                             
 KSKCLS                     Scalar 11274    I(4)            4           scalar   COM                                                
 KSKDRP                     Scalar 11275    I(4)            4           scalar   COM                                                
 KSKNOW                     Scalar 11275    I(4)            4     1     9        COM              11689                             
 KSKNSW                     Scalar 11272    I(4)            4           scalar   COM              11509,11521                       
 KSKOMR                     Scalar 11274    I(4)            4     1     2        COM                                                
 KSKPSF                     Scalar 11271    I(4)            4           scalar   COM                                                
 KSKPUA                     Scalar 11271    I(4)            4           scalar   COM                                                
 KSKREC                     Scalar 11272    I(4)            4           scalar   COM                                                

Page 290         Source Listing                  GETC06
2017-04-18 11:09 Symbol Table                    prepdata.f

 Name                       Object Declared Type            Bytes Dimen Elements Attributes       References                        
                                                                                                                                    
 KSKSWD                     Scalar 11267    I(4)            4     1     10       COM              11531                             
 KSKSWN                     Scalar 11274    I(4)            4           scalar   COM              11571                             
 KSKTHN                     Scalar 11274    I(4)            4           scalar   COM                                                
 KTIMSF                     Scalar 11272    I(4)            4           scalar   COM                                                
 KTIMUA                     Scalar 11271    I(4)            4           scalar   COM              11708                             
 KW                         Local  12178    I(4)            4           scalar                    12178,12180,12195,12226,12296,1230
                                                                                                  0                                 
 L                          Local  11732    I(4)            4           scalar                    11732,11734,11735,11736,11738,1173
                                                                                                  9,11742,11743,11744,11746,11748,11
                                                                                                  749,11751,11752,11754,11755,11757,
                                                                                                  11758,11759,11762,11763,11765,1176
                                                                                                  8,11769,11771,11785,11786,11788,11
                                                                                                  789,11791,11792,11860,11861,11862,
                                                                                                  11997,11998,12000,12001,12002,1200
                                                                                                  4,12016,12018,12026,12027,12028,12
                                                                                                  044,12054,12180,12181,12183,12184,
                                                                                                  12214,12215,12219,12233,12234     
 LEVPM                      Scalar 11268    I(4)            4           scalar   COM                                                
 LEVQQ                      Scalar 11268    I(4)            4           scalar   COM                                                
 LEVST                      Scalar 11268    I(4)            4           scalar   COM                                                
 LFMAXI                     Scalar 11276    I(4)            4           scalar   COM                                                
 LFMAXJ                     Scalar 11276    I(4)            4           scalar   COM                                                
 LFMSFC                     Common 11276                                224                                                         
 LL                         Local  11916    I(4)            4           scalar                    11916,11977,11979,11980,11986,1198
                                                                                                  7,11989,11996,12022,12037,12041,12
                                                                                                  046,12072,12087,12089,12090,12091,
                                                                                                  12092,12096,12103,12128,12169,1217
                                                                                                  9,12195,12199,12207,12209,12210,12
                                                                                                  211,12212,12222,12224,12238,12239,
                                                                                                  12246,12271,12342,12357           
 LL0                        Local  11315    I(4)            4           scalar                    11315                             
 LNDCHK                     Subr   11561                                                          11561,11563,11625,11648,11650     
 LNDSEA                     Common 11258                                284996                                                      
 MARLND                     Scalar 11276    I(4)            4           scalar   COM                                                
 MAX                        Func   11683                                scalar                    11683,11755,12214,12215,12220,1223
                                                                                                  5,12340                           
 MAXOBS                     Param  11247    I(4)            4           scalar                    11254,11259                       
 MIN                        Func   11341                                scalar                    11341,11851,12337                 
 MOBS                       Scalar 11257    I(4)            4     3     10800    COM              11919,11979,11986,11987,11989,1202
                                                                                                  2,12037,12041,12046,12072,12089,12
                                                                                                  090,12091,12092,12096,12106,12107,
                                                                                                  12109,12110,12111,12172,12195,1219
                                                                                                  9,12209,12210,12211,12212,12222,12
                                                                                                  224,12238,12239,12249,12250,12252,
                                                                                                  12253,12254                       
 MOBS1                      Local  11254    I(4)            4     2     18                        12109,12111,12252,12254           
 MOD                        Func   11900                                scalar                    11900                             
 MP_PROCESS                 Scalar 11260    I(4)            4           scalar   COM                                                
 MXBLVL                     Param  11246    I(4)            4           scalar                    11279                             
 MXLVL                      Param  11245    I(4)            4           scalar                    11256,11257,11341                 
 MXTYPV                     Param  11243    I(4)            4           scalar                    11254,11257,11919,12172           
 MXWRDH                     Param  11242    I(4)            4           scalar                    11261                             
 MXWRDL                     Param  11244    I(4)            4           scalar                    11254,11257,11919,12172           
 NAC                        Local  11367    I(4)            4           scalar                    11367,11603,11605,11608,11610,1161
                                                                                                  2,11614,11616,11618,11639,11641,11

Page 291         Source Listing                  GETC06
2017-04-18 11:09 Symbol Table                    prepdata.f

 Name                       Object Declared Type            Bytes Dimen Elements Attributes       References                        
                                                                                                                                    
                                                                                                  642,11643,11645,11663,11667,11670,
                                                                                                  11672,11676,11679,11682,11689,1182
                                                                                                  1,11823,11825,11897,12159,12307,12
                                                                                                  364                               
 NHDR6                      Local  11887    I(4)            4           scalar                    11887,11900,11901,11914,11915,1216
                                                                                                  5,12166,12168,12344,12345         
 NI                         Local  11900    I(4)            4           scalar                    11900,11901                       
 NINT                       Func   11416                                scalar                    11416,11551,11560,11595,11624,1164
                                                                                                  7,11663,11667,11672,11676,11735,11
                                                                                                  738,11742,11744,11746,11748,11751,
                                                                                                  11754,11762,11768,11773,11775,1177
                                                                                                  7,11785,11788,11791,11862,11866,11
                                                                                                  940,11949,11979,11989,11998,12000,
                                                                                                  12001,12002,12004,12018,12029,1204
                                                                                                  0,12041,12044,12045,12072,12096,12
                                                                                                  181,12183,12184,12195,12197,12199,
                                                                                                  12220,12222,12224,12233,12234     
 NMHDR                      Local  12329    I(4)            4           scalar                    12329,12337,12340                 
 NN                         Dummy  11241    I(4)            4           scalar   ARG,INOUT        11330,11334,11335,11336,11617,1180
                                                                                                  7,11828,11832,11885,12023,12033,12
                                                                                                  126,12269,12311,12355             
 NOBS3                      Scalar 11279    I(4)            4     1     7        COM              12152,12340                       
 NPKRPT                     Scalar 11277    I(4)            4     1     12       COM                                                
 NSW                        Local  11368    I(4)            4           scalar                    11368,11485,11487,11489,11491,1149
                                                                                                  3,11495,11497,11499,11501,11504,11
                                                                                                  513,11529,11533,11536,11537,11539,
                                                                                                  11540,11543,11544,11551,11558,1157
                                                                                                  9,11580,11772,11898,12160,12306,12
                                                                                                  363                               
 NUMOBS2                    Param  11248    I(4)            4           scalar                    11279,12150                       
 OBS2                       Scalar 11279    R(4)            4     1     43       COM              11799,12150                       
 OBS3                       Scalar 11279    R(4)            4     3     8925     COM              12151                             
 OBS8_8                     Scalar 11253    R(8)            8     1     2        COM                                                
 P                          Local  11252    R(4)            4     1     100                       11858,11861,11863,11867,11869,1187
                                                                                                  2,12031,12064,12069,12072,12165,12
                                                                                                  195                               
 PARM3                      Common 11269                                56                                                          
 PCAT                       Scalar 11264    R(4)            4           scalar   COM              11720,11743,12337                 
 PFRALT                     Scalar 11277    R(4)            4           scalar   COM                                                
 PHIACF                     Scalar 11263    R(4)            4     1     7        COM              11595                             
 PHISWN                     Scalar 11265    R(4)            4     1     7        COM              11416                             
 PMAND                      Scalar 11259    R(4)            4     1     23       COM                                                
 POAF                       Scalar 11263    R(4)            4           scalar   COM              11717,11739,12337                 
 PP                         Local  11375    R(4)            4           scalar                    11375,11936,11949,11968,11979,1206
                                                                                                  9                                 
 PR                         Local  11320    R(4)            4           scalar                    11867                             
 PRE                        Local  11324    R(4)            4           scalar                    12069                             
 PRS                        Local  11319    R(4)            4           scalar                    11869                             
 Q                          Local  12028    R(4)            4           scalar                    12028,12029,12031,12045           
 QIFN                       Scalar 11267    R(4)            4           scalar   COM              11725,11789                       
 QIFY                       Scalar 11267    R(4)            4           scalar   COM              11724,11786                       
 RDATA                      Scalar 11259    R(4)            4     1     3500     COM              11348,11353,11416,11506,11517,1155
                                                                                                  1,11552,11560,11561,11563,11568,11
                                                                                                  595,11624,11625,11647,11648,11650,
                                                                                                  11655,11663,11666,11667,11672,1167

Page 292         Source Listing                  GETC06
2017-04-18 11:09 Symbol Table                    prepdata.f

 Name                       Object Declared Type            Bytes Dimen Elements Attributes       References                        
                                                                                                                                    
                                                                                                  5,11676,11683,11686,11735,11736,11
                                                                                                  738,11739,11742,11743,11744,11746,
                                                                                                  11748,11749,11751,11752,11754,1175
                                                                                                  5,11757,11758,11759,11762,11763,11
                                                                                                  765,11768,11769,11771,11785,11786,
                                                                                                  11788,11789,11791,11792,11861,1186
                                                                                                  2,11904,11962,11970,11998,12000,12
                                                                                                  001,12002,12004,12016,12018,12026,
                                                                                                  12027,12028,12044,12054,12181,1218
                                                                                                  3,12184,12214,12215,12219,12233,12
                                                                                                  234                               
 RDATA2                     Scalar 11279    R(4)            4     1     25       COM                                                
 REAL                       Func   12067                                scalar                    12067                             
 RECCON                     Scalar 11269    R(4)            4           scalar   COM                                                
 RECSLM                     Scalar 11251    L(4)            4           scalar   COM              11899,12022,12033,12073,12095     
 RFFL                       Scalar 11267    R(4)            4           scalar   COM              11723,11771,11773,11775,11777     
 RIALR                      Scalar 11264    R(4)            4           scalar   COM              11719,11752,12337                 
 ROLF                       Scalar 11264    R(4)            4           scalar   COM              11718,11749,12337                 
 RPTHDR                     Common 11261                                88                                                          
 RPTLBL                     Subr   11701                                                          11701                             
 RWINDO                     Scalar 11269    R(4)            4           scalar   COM              11383,11384                       
 SAID                       Local  11851    R(4)            4           scalar                    11851,11852                       
 SATSW3                     Common 11265                                11604                                                       
 SKPCNT                     Common 11271                                252                                                         
 SPCIAL                     Scalar 11268    R(4)            4           scalar   COM                                                
 STNID                      Scalar 11249    CHAR            8           scalar   COM              11348,11353,11449,11451,11453,1145
                                                                                                  5,11457,11463,11469,11486,11488,11
                                                                                                  490,11492,11494,11496,11498,11500,
                                                                                                  11506,11517,11541,11542,11545,1154
                                                                                                  6,11552,11568,11655,11666,11675,11
                                                                                                  686,11875,11904,11962,11970,12132,
                                                                                                  12226,12288,12292,12296,12300,1235
                                                                                                  9,12371                           
 STRCTY                     Common 11256                                2400                                                        
 STRMOB                     Common 11257                                43200                                                       
 SUBSET_D                   Scalar 11249    CHAR            8           scalar   COM                                                
 SWCM                       Local  11837    R(4)            4           scalar                    11837,11839,11842,11844,11846,1184
                                                                                                  8,11852                           
 SWINDO_E                   Scalar 11265    R(4)            4     3     480      COM              11579                             
 SWINDO_L                   Scalar 11266    R(4)            4     3     480      COM              11580                             
 SWNLND                     Scalar 11251    L(4)            4     3     480      COM              11558                             
 TDLIM                      Scalar 11268    R(4)            4           scalar   COM                                                
 TDMAX                      Scalar 11268    R(4)            4           scalar   COM                                                
 TEMP                       Local  12064    R(4)            4           scalar                    12064,12067,12069                 
 TFRMQP                     Local  11328    R(4)            4           scalar                    12031                             
 TIMCHK                     Subr   11706                                                          11706                             
 TIMWIN_E                   Local  11383    R(4)            4           scalar                    11383,11579,11641,11706           
 TIMWIN_L                   Local  11384    R(4)            4           scalar                    11384,11580,11642,11706           
 TMPCEL                     Local  12032    R(4)            4           scalar                    12032,12040,12041                 
 TRBX                       Scalar 11263    R(4)            4     1     5        COM              11721,11746,12337                 
 TT                         Local  12044    R(4)            4           scalar                    12044,12045                       
 UCOMP                      Local  12219    R(4)            4           scalar                    12219,12220,12222                 
 UPALIM                     Common 11268                                28                                                          
 UV                         Subr   12219                                                          12219                             
 UWINDO                     Scalar 11269    R(4)            4           scalar   COM                                                

Page 293         Source Listing                  GETC06
2017-04-18 11:09 Symbol Table                    prepdata.f

 Name                       Object Declared Type            Bytes Dimen Elements Attributes       References                        
                                                                                                                                    
 VADWIN                     Scalar 11269    R(4)            4           scalar   COM                                                
 VCOMP                      Local  12219    R(4)            4           scalar                    12219,12220,12224                 
 VWINDO                     Scalar 11269    R(4)            4           scalar   COM                                                
 W3FA03                     Subr   12064                                                          12064                             
 WRMISS                     Scalar 11251    L(4)            4           scalar   COM              12310                             
 XMISS                      Local  11315    R(4)            4           scalar                    11315,11375,11376,11717,11718,1171
                                                                                                  9,11720,11721,11722,11723,11724,11
                                                                                                  725,11726,11728,11729,11730,11858,
                                                                                                  11863,11872                       
 XTRHD2                     Common 11278                                27                                                          
 YMISS                      Local  11315    R(4)            4           scalar                    11315,11683,11736,11743,11746,1174
                                                                                                  9,11752,11755,11763,11769,11786,11
                                                                                                  789,11792,11799,11861,12016,12054,
                                                                                                  12126,12214,12215,12269,12337,1235
                                                                                                  5                                 
 ZZ                         Local  11376    R(4)            4           scalar                    11376,11937,11950,11989,12069     
 ZZZ                        Local  11862    R(4)            4           scalar                    11862,11863,11866,11867,11869,1199
                                                                                                  8,12069,12096,12181,12197,12199   

Page 294         Source Listing                  GETC06
2017-04-18 11:09                                 prepdata.f

  12377 C$$$  SUBPROGRAM DOCUMENTATION BLOCK
  12378 C
  12379 C SUBPROGRAM:    SATEDS
  12380 C   PRGMMR: D. A. KEYSER     ORG: NP22       DATE: 2014-11-25
  12381 C
  12382 C ABSTRACT: UNPACKS RETRIEVAL DATA FROM RTOVS OR ATOVS BUFR DATA DUMP
  12383 C   FILE ONE REPORT AT A TIME, TRANSLATING INTO UNPACKED NMCEDS FORMAT
  12384 C   (TRANSLATES ONLY THOSE VALUES IN ORIGINAL NMCEDS FORMAT NEEDED BY
  12385 C   THIS PROGRAM).  PERFORMS SEVERAL CHECKS ON THE DATA, AND
  12386 C   ACCUMULATES COUNTS FOR VALID REPORTS BEFORE CALLING SUBROUTINES TO
  12387 C   ACTUALLY PROCESS REPORTS.
  12388 C
  12389 C PROGRAM HISTORY LOG:
  12390 C   UNKNOWN
  12391 C 1987-06-14  D. A. KEYSER -- ADDED CAPABILITY TO PROCESS DMSP AND VAS
  12392 C 1988-04-11  D. A. KEYSER -- DOCBLOCKING/COMMENTING
  12393 C 1988-08-24  D. A. KEYSER -- EXPANDED TO INCLUDE DMSP F-9 SATELLITE
  12394 C 1988-09-14  D. A. KEYSER -- MODIFIED TO PROCESS TOVS PHYS. RETRIEVALS
  12395 C 1988-10-25  D. A. KEYSER -- ALL REFERENCES TO ON29 TOVS REMOVED
  12396 C 1989-04-24  D. A. KEYSER -- REMOVED CHECK OF VIRGS EDIT FLAG AND ADDED
  12397 C     CHECK OF TOVS FILTER FLAG
  12398 C 1989-05-12  D. A. KEYSER -- POS. 1 IN TOVS STN. ID NOW NADIR DIST.
  12399 C     INDICATOR (1-9; 1 BY NADIR & 9 AT LIMB), POS. 2-5 ARE LAST 4
  12400 C     DIGITS OF LOGICAL REC. NO., POS. 6 REMAINS SATELLITE/PATH
  12401 C     CHARACTER
  12402 C 1989-12-13  D. A. KEYSER -- TOVS FILTER FLAG TEST IGNORED & STN. ID
  12403 C     CALC. AS PRIOR TO 89-05-12 CHG. ABOVE IF PROD./ADPUPA DATE READ
  12404 C     IN IS PRIOR TO 89-05-31/12Z - ALLOWS FOR PREPRO RERUNS OF
  12405 C     HISTORICAL CASES
  12406 C 1990-01-11  D. A. KEYSER -- CONVERTED TO VS FORTRAN(77) & RESTRUCTURED
  12407 C 1990-07-11  D. A. KEYSER -- SWITCH 'FGGE' REMOVED FROM N-LIST (FALSE)
  12408 C 1990-10-25  D. A. KEYSER -- ADDED PROC. TOVS PWATER IN SUBR.
  12409 C     'PWATER'; NEW SUBR. 'UNPO29' + ENTRIES NOW UNPACKS VAS RETR. FROM
  12410 C     D-SETS INTO UNPACKED ON29 FORMAT (STREAMLINED)
  12411 C 1991-06-24  D. A. KEYSER -- CAN READ IN EITHER PACKED 16-BIT OR FULL
  12412 C     WORD DIRECTORY FILE
  12413 C 1991-09-10  D. A. KEYSER -- FFGET FOR RETR DCTY REPLACED W/ SEQ. READ;
  12414 C     SWITCHES 'EVTSAT','ODTSAT','EVDSAT','ODDSAT' REMOVED FROM N-LIST
  12415 C     (NO SAT. NO. TEST)
  12416 C 1992-08-07  D. A. KEYSER -- STOP 69 ADDED FOR OVERFLOW PACKING
  12417 C     FULL-WORD ARRAY TO 16-BIT ARRAY (& LOG MSG.)
  12418 C 1993-05-12  D. A. KEYSER -- THE NEW "PREPBUFR TABLE VALUES" WHICH CAN
  12419 C     RANGE FROM 0-15 ARE EMPLOYED RATHER THAN THE OLD OI/SSI QUALITY
  12420 C     MARKERS; SUBR. "TWOBIT" REPLACED BY W3LIB ROUTINE "GBYTES"
  12421 C 1993-05-31  D. A. KEYSER -- RENAMED SUBR. "SATSND" TO "SATEDS";
  12422 C     REMOVED SECTION WHICH STD. O-PUT PRINTS OF COUNTS FOR ALL SAT.
  12423 C     RETR. TYPES AND PLACED IN NEW SUBR. "SNDTBL"; CHANGED DEF. VALUES
  12424 C     & ORDER FOR N-LIST SWITCH "IUNIT"; N-LIST SWITCH "IRTRV" EXPANDED
  12425 C     TO 3-DIM. W/ 3'RD ELEM. REFERRING TO SAT./RETR. TYPE (HERE ALWAYS
  12426 C     = 1)
  12427 C 1993-11-02  D. A. KEYSER -- VARIABLE IFLUA WHEN SET TO 1 WILL FLAG
  12428 C     ALL VARIABLES WITH PREPBUFR T. VALUE=15
  12429 C 1994-08-11  D. A. KEYSER -- ADDED PROCESSING OF TOVS VIA INPUT FILE
  12430 C     WHICH RETURNS UNPACKED ON29 FORMAT (NEVER OPER'L), INVOKED IF
  12431 C     TOVS DCTY FILE EMPTY; MACHINE CHAR. TYPE NOW USED FOR ASCII/
  12432 C     EBCDIC CONVERSION TEST RATHER THAN 'LW' VALUE
  12433 C 1995-07-12  D. A. KEYSER -- REMOVED LOGIC TO PROCESS VAS RETRIEVALS

Page 295         Source Listing                  GETC06
2017-04-18 11:09                                 prepdata.f

  12434 C 1996-09-03  D. A. KEYSER -- CAN NOW RETURN NMCEDS FORMAT FOR TOVS
  12435 C     RETR. IN NEW BUFR DATA DUMP FILES (SWITCH 'IEDSTP', NEW SUBR.
  12436 C     W3TOVEDS)
  12437 C 1996-10-24  D. A. KEYSER -- ADDED CALL TO BUFRLIB "DATEBF" TO RETURN
  12438 C     CENTER DATE FROM TOVS BUFR DATA DUMP FILES (SIMPLIFIES OTHER
  12439 C     TIME-CHECKING PROCEDURES); STREAMLINED PARTS OF THIS SUBR. (UNIT
  12440 C     NO. DESIG.,ETC.); NOW PRINTS COUNT OF RPTS. OUTSIDE TIME WINDOW
  12441 C 1998-02-17  D. A. KEYSER -- REMOVED NEED TO REPACK TO 16-BIT ARRAY;
  12442 C     REMOVED LOGIC RE: UNPACKING REPORT FROM PHYSICAL NMCEDS OR ON29
  12443 C     FILE; REMOVED LOGIC RE: DMSP PROCESSING; REMOVED LOGIC RE: TOVS
  12444 C     PWATER PROCESSING
  12445 C 1998-05-15  D. A. KEYSER -- ADDED PROCESSING OF RTOVS DATA BASED ON
  12446 C     NEW NAMELIST SWITCH "RTOVS", NEW IN-LINE ROUTINE W3RTVEDS ADDED
  12447 C     FOR INTERFACE WITH RTOVS RETURNING PARTIAL NMCEDS FORMAT, 250 KM
  12448 C     RTOVS SAMPLING ACCOMPL. VIA PROCESSING ONLY EVERY 4'TH RETRIEVAL;
  12449 C     ADDED KOUNTS FOR REJECTED TOVS/RTOVS NMCEDS DATA PROCESSING,
  12450 C     SUMMARIZED IN STDOUT PRINT AT END OF PROGRAM
  12451 C 1998-06-15  D. A. KEYSER -- REMOVED ALL LOGIC PERTAINING TO TOVS
  12452 C     PROCESSING (SUBR. 'TOVSID' & 'TDEW' NO LONGER CALLED - REMOVED,
  12453 C     N-LIST SWITCH 'RTOVS' REMOVED; N*/PTLY-CLDY PATH NO LONGER
  12454 C     POSSIBLE); RTOVS 250KM SUB-SAMPLING NOW DEPENDS UPON VALUE IN
  12455 C     FILTER FLAG AS WAS THE CASE FOR TOVS (FIX BY NESDIS) (BEFORE
  12456 C     250KM SUB-SAMPLING WAS EST. BY PROCESSING EVERY 4'TH RTOVS RPT)
  12457 C 1999-01-20  D. A. KEYSER -- REPL. N-LIST SWITCH "SATLND" WITH NEW
  12458 C     SWITCHES "ISATLS" AND "JSATLS" TO HANDLE LAND/SEA SELECTION FOR
  12459 C     SATELLITE SNDGS/RADIANCES AND GOES PW RETR. SEPARATELY (ALSO CAN
  12460 C     NOW SELECT JUST LAND AS WELL AS JUST SEA OR EVERYWHERE)
  12461 C 2000-02-17  D. A. KEYSER -- SUBR. W3CNVTOV RENAMED TO W3CNVXTOVS
  12462 C     (HANDLES RTOVS AND NEW ATOVS), W3RTVEDS RENAMED TO W3XTOVSEDS
  12463 C     (HANDLES RTOVS AND NEW ATOVS), AND W3TOVMND RENAMED TO W3XTOVSMND
  12464 C     (HANDLES RTOVS AND ATOVS); CAN NOW PROCESS ATOVS DATA VIA SUBR.
  12465 C     W3XTOVSEDS (NMCEDS FORMAT); CHAR. 7 OF STNID NOW INDICATES RTOVS
  12466 C     (='R') OR ATOVS (='A') (WAS BLANK); IF FILTER FLAG=-99 AND
  12467 C     TR80KM=F, PROCESS ONLY EVERY 4'TH UNPACKED RTOVS RETRIEVAL TO
  12468 C     SIMULATE 250 KM SUB-SAMPLING (RTOVS DUMP FILE PRIOR TO 7/1/1998
  12469 C     - NO FILTER FLAG INFORMATION AVAILABLE - NEEDED FOR HISTORICAL
  12470 C     CDAS RUNS)
  12471 C 2001-04-06  D. A. KEYSER -- SUBR. "RPTLBL" NOW HAS INPUT ARGS.
  12472 C     "TIMWIN_e" (EARLIEST TIME WINDOW) AND "TIMWIN_l" (LATEST TIME
  12473 C     WINDOW) REPL. "TIMWIN" (+/- TIME WINDOW) ("-" PRIOR TO CYCLE
  12474 C     TIME, "+" AFTER CYCLE TIME), ALLOWS THE 2 TO BE DIFFERENT
  12475 C 2001-06-19  D. A. KEYSER -- NEW SUBR. "TIMCHK" DOES TIME WINDOW CHECK
  12476 C     SEPARATE FROM "RPTLBL"; N-LIST SWITCHES "IWINDO", "SATMST",
  12477 C     "ISATLS", "IRTRV" AND "KTOP" NOW MORE SPECIFIC TO POINT TO PAIRS
  12478 C     OF EVEN OR ODD GOES SATS. (NOT USEFUL HERE) AND TO THE 4 POSSIBLE
  12479 C     REPORT TYPES THAT CAN BE GENERATED FROM RTOVS/ ATOVS AND GOES
  12480 C     SNDG/RAD/RETR. DATA
  12481 C 2001-08-01  D. A. KEYSER -- N-LIST SWITCH IWINDO SPLIT INTO IWINDO_e
  12482 C     (EARLIEST TIME WINDOW) AND IWINDO_l (LATEST TIME WINDOW) FOR
  12483 C     SATELLITE SOUNDING/RETRIEVAL/RADIANCE REPORTS ("-" PRIOR TO CYCLE
  12484 C     TIME, "+" AFTER CYCLE TIME) (SAME DEFAULTS AS BEFORE)
  12485 C     WORD 6 SO IT CAN LATER BE ENCODED INTO PREPBUFR FILE
  12486 C 2001-10-10  D. A. KEYSER -- PASSES PREPBUFR CENTER DATE INTO SUBR.
  12487 C     W3CNVXTOVS SO IT CAN PROPERLY DETERMINE BUFR SATELLITE ID
  12488 C     WHICH IS NOW RETURNED FROM W3CNVXTOVS ID IN UNPACKED IW3UNPBF
  12489 C     WORD 6 (SO IT CAN LATER BE ENCODED INTO PREPBUFR FILE)
  12490 C 2014-11-25  D. A. Keyser -- Removed input argument "IDATE" (central

Page 296         Source Listing                  GETC06
2017-04-18 11:09                                 prepdata.f

  12491 C     date) from call to subr. W3CNVXTOVS since year {IDATE(1)} is no
  12492 C     longer needed to obtain BUFR satellite ID.
  12493 C
  12494 C USAGE:    CALL SATEDS
  12495 C   INPUT FILES:
  12496 C     UNIT GG   - RTOVS BUFR DATA FILE (SOUNDINGS/RETRIEVALS/RADIANCES)
  12497 C     UNIT GG+1 - ATOVS BUFR DATA FILE (SOUNDINGS/RETRIEVALS/RADIANCES)
  12498 C    (WHERE GG IS UNIT NUMBER DEFINED AS IUNIT(7) IN NAMELIST "&PARM")
  12499 C
  12500 C   OUTPUT FILES:
  12501 C     UNIT 06  - STANDARD OUTPUT PRINT
  12502 C
  12503 C REMARKS: CALLED BY SUBROUTINE 'PREP'.  FOR PROCESSING OF RTOVS OR
  12504 C   ATOVS RADIANCE/40-LEVEL RETRIEVAL REPORTS FILE SEE SUBROUTINE
  12505 C   SATBFR.
  12506 C
  12507 C ATTRIBUTES:
  12508 C   LANGUAGE: FORTRAN 90
  12509 C   MACHINE:  NCEP WCOSS
  12510 C
  12511 C$$$
  12512       SUBROUTINE SATEDS
  12513 CCC
  12514 C  SAT. & PATH (INSTRUMENT) INDICATED BY CHARACTER 6 OF STATION ID
  12515 C  SAT. NO. DESIG'N: ODD1  - 3,7,11,15,19,...; ODD2  - 1,5, 9,13,17,...
  12516 C                    EVEN1 - 2,6,10,14,18,...; EVEN2 - 4,8,12,16,20,...
  12517 C          SUFFIX A,E ---> CLEAR  PATH FROM ODD1  (A) OR ODD2  (E) SAT.
  12518 C          SUFFIX S,W ---> CLEAR  PATH FROM EVEN1 (S) OR EVEN2 (W) SAT.
  12519 C          SUFFIX C,G ---> CLOUDY PATH FROM ODD1  (C) OR ODD2  (G) SAT.
  12520 C          SUFFIX U,Y ---> CLOUDY PATH FROM EVEN1 (U) OR EVEN2 (Y) SAT.
  12521 C          SUFFIX D,H ---> OTHER  PATH FROM ODD1  (D) OR ODD2  (H) SAT.
  12522 C          SUFFIX V,Z ---> OTHER  PATH FROM EVEN1 (V) OR EVEN2 (Z) SAT.
  12523 C
  12524 C  RTOVS VS. ATOVS INDICATED BY CHARACTER 7 OF STN. ID ("R" OR "A")
  12525 C
  12526 CCC
  12527       PARAMETER (MXWRDH = 15)
  12528       PARAMETER (MXBLVL = 255)
  12529       PARAMETER (MAXOBS = 3500)
  12530       PARAMETER (NUMOBS2 = 43)
  12531       CHARACTER*4  SAMPLE(2)
  12532       CHARACTER*5  CTYPE(2)
  12533       CHARACTER*8   STNPRT,STNID,DSNAME,SUBSET_d
  12534       LOGICAL  SATMST,TR80KM,TOVEDS
  12535       INTEGER  IBUF(140),JRTRV(3),NUMOB(5,4,2,4,4),KEPOB(5,4,2,4),
  12536      $ MSTOB(5,4,2,4),IDATA(MAXOBS),KSATOB(3),IDSAT(4),ISAMPLE(2)
  12537       INTEGER(8) IDSDMP_8
  12538       REAL(8)  BMISS,obs8_8,alon_8,alat_8
  12539       COMMON/ADP/ISATOB,PMAND(23),RDATA(MAXOBS),IPRINT
  12540       COMMON/DATA/KOUNT,IDATE(4),IDAT10,MP_PROCESS,WRMISS
  12541       COMMON/RPTHDR/SUBSET_d,STNID,HDR(2:MXWRDH),alon_8,alat_8
  12542       COMMON/UPALIM/LEVPM,LEVST,LEVQQ,TDLIM,TDMAX,SPCIAL,ISQNUM_UPA
  12543       COMMON/UNITNO/NFILE,IUNIT(28)
  12544       COMMON/TVSWCH/TOVEDS(2),TOVBFR(2),TR80KM,KNTTOV(2),
  12545      $ KSKPTV(2),KNOPTV(2),KIPTTV(2),KMSGTV(2),KBDYTV(2),KTIMTV(2),
  12546      $ KLNDTV(2),KSEATV(2),KREDTV(2),KJFLAG(2)
  12547       COMMON/SATSW2/PHI(6),IRTRV(5,4,4),KTOP(5,4,4),IWINDO_e(5,4,4),

Page 297         Source Listing                  SATEDS
2017-04-18 11:09                                 prepdata.f

  12548      $ IWINDO_l(5,4,4),SATMST(5,4,4),ISATLS(5,4,4)
  12549       COMMON/PARM6/MODPRT,IFLUA,STNPRT(3)
  12550       COMMON/DIRECT/OBS3(5,MXBLVL,7),OBS2(NUMOBS2),NOBS3(7),RDATA2(25),
  12551      $ obs8_8(2)
  12552       COMMON /BUFRLIB_MISSING/BMISS
  12553       EQUIVALENCE (RDATA,IDATA)
  12554       DATA  JRTRV/272,99999,544/,KNTRPT/0/,CTYPE/'RTOVS','ATOVS'/,
  12555      $ MFIRST/0/,SAMPLE/' 4TH','11TH'/,ISAMPLE/4,11/
  12556       NN = 1
  12557   700 CONTINUE
  12558 C KOUNT COUNTS NO. REPORTS UNPACKED (& NOT SKIPPED) FROM FILE
  12559       KOUNT = 0
  12560 C NN WILL INDICATE WHICH FILE IS BEING EXAMINED:
  12561 C    NN = 1 ===> RTOVS
  12562 C    NN = 2 ===> ATOVS
  12563       IF(.NOT.TOVEDS(NN))  GO TO 110
  12564 C INITIALIZE NUMOB, KEPOB, AND MSTOB ARRAYS
  12565       NUMOB = 0
  12566       KEPOB = 0
  12567       MSTOB = 0
  12568 C CYCLET IS TIME THE DATA IS CENTERED ON (CYCLE TIME)
  12569       CYCLET = IDATE(4)
  12570       IDSAT = 0
  12571       NFILE = IUNIT(7) + NN - 1
  12572       PRINT 2002, CTYPE(NN),NFILE
  12573  2002 FORMAT(//,37X,' ***** ',A5,' SATELLITE RETRIEVAL FILE    UNIT =',
  12574      $ I4,' *****')
  12575       PRINT 550, IDATE
  12576   550 FORMAT(25X,'LOOKING FOR FILE WITH CENTER DATE: ',2X,I4.4,
  12577      $ 2('-',I2.2),1X,I2.2,'Z  BASED ON PRODUCTION DATE'/33X,'--> --> ',
  12578      $ ' RETRIEVALS RETURNED IN UNPACKED NMCEDS FORMAT <-- <--')
  12579       IF(.NOT.TR80KM)  THEN
  12580          PRINT 581
  12581   581    FORMAT(/27X,'-->  ORIGINAL FULL RESOLUTION REPORTS ARE ',
  12582      $    'FILTERED TO 250 KM RESOLUTION  <--'/)
  12583       ELSE
  12584          PRINT 583
  12585   583    FORMAT(/37X,'-->  ALL REPORTS (AT FULL RESOLUTION) ARE ',
  12586      $    'PROCESSED  <--'/)
  12587       END IF
  12588 C KNTRPT WILL COUNT NUMBER OF RPTS SUCCESSFULLY DECODED FOR EACH FILE
  12589       KNTRPT = 0
  12590       GO TO 1400
  12591 C#######################################################################
  12592 C#######################################################################
  12593  1410 CONTINUE
  12594 C KSKPTV WILL COUNT NO. OF DECODED REPORTS SKIPPED (VARIOUS REASONS)
  12595       KSKPTV(NN) = KSKPTV(NN) + 1
  12596  1400 CONTINUE
  12597 C ATTEMPT TO DECODE THE NEXT RTOVS OR ATOVS REPORT
  12598       OBS2   = BMISS  ! initialize obs2   array before reading any rpts
  12599       OBS3   = BMISS  ! initialize obs3   array before reading any rpts
  12600       NOBS3  = 0      ! initialize nobs3  array before reading any rpts
  12601       obs8_8 = bmiss  ! initialize obs8_8 array before reading any rpts
  12602       RDATA2 = BMISS  ! initialize rdata2 array before reading any rpts
  12603       CALL W3XTOVSEDS(NFILE,IDATEM,IBUF,KSATOB,PBOT,DSNAME,IDSDAT,
  12604      $ IDSDMP_8,IER)

Page 298         Source Listing                  SATEDS
2017-04-18 11:09                                 prepdata.f

  12605       IFLUA = 0
  12606 C.......................................................................
  12607       IF(IER.EQ.-3)  THEN
  12608          PRINT 8002, NFILE
  12609  8002    FORMAT(/' *** ERROR RETURNING DATA SET INFORMATION IN FIRST ',
  12610      $    'CALL TO FILE IN UNIT',I4,' -- THIS MAY BE A NULL FILE -- ',
  12611      $    'GO TO NEXT FILE'/)
  12612          RETURN
  12613 C.......................................................................
  12614       ELSE  IF(IER.EQ.1)  THEN
  12615 C IER = 1 RETURNS DATA SET INFO (ONLY) AFTER FIRST CALL
  12616          PRINT 7000, DSNAME,IDSDAT,IDSDMP_8
  12617  7000    FORMAT(//22X,'--> DATA SET INFORMATION: NAME: ',A8,'; DATE: ',
  12618      $    I10.10,'; DUMP TIME: ',I12.12,' <--'//)
  12619 C DOES DATE FROM DATA SET MATCH NCEP PRODUCTION DATE?
  12620          IF(IDSDAT.NE.IDAT10)  THEN
  12621             PRINT 324
  12622   324 FORMAT(/13X,'>>>>>   P R O B L E M :   D A T E   D O E S   N O T',
  12623      $ '   M A T C H   P R O D U C T I O N   D A T E   <<<<<'/)
  12624             RETURN
  12625          END IF
  12626          GO TO 1400
  12627 C.......................................................................
  12628       ELSE  IF(IER.LT.0.OR.IER.GT.2)  THEN
  12629 C ERROR DECODING REPORT, DO NOT DECODE ANY MORE REPORTS AT THIS POINT
  12630          PRINT 572, NFILE,KNTRPT+1,IER
  12631   572 FORMAT(/' >>>>>  B U F R   D E C O D E   E R R O R   O N   UNIT',
  12632      $ I3,'   --   R E P O R T   C N T .   ',I5,'   --   I E R   ',I5,
  12633      $ '  <<<<<'/)
  12634          GO TO 961
  12635 C.......................................................................
  12636       ELSE  IF(IER.EQ.2)  THEN
  12637 C IF IER = 2, HAVE HIT END-OF-FILE, ALL REPORTS PROCESSED - GO SUMMARIZE
  12638          GO TO 961
  12639 C.......................................................................
  12640       END IF
  12641 C A REPORT WAS SUCCESSFULLY DECODED
  12642       KNTRPT = KNTRPT + 1
  12643       ELON  = REAL(IBUF(6)) * 0.01
  12644       IF(IBUF(6).LT.0)   ELON = 360.00 + (REAL(IBUF(6)) * 0.01)
  12645       IF(NINT(ELON*100.).EQ.36000)  ELON = 0.
  12646 C ID1ST5 HOLDS FIRST 5 POSITIONS IN GENERATED STATION IDENTICATION
  12647 C  = (NADIR DIST. INDICATOR * 10000) + LAST 4 DIGITS OF KNTRPT
  12648 C    (KNTRPT IS REPORT COUNT NUMBER)
  12649 C .. NADIR PROX. INDICATOR ITSELF STORED IN IBUF(16)
  12650       ID1ST5 = (IBUF(16) * 10000) + MOD(KNTRPT,10000)
  12651 C W3XTOVSMND CALC. MAND LVL Z, T & STORES THEM IN COMMON FOR W3CNVXTOVS
  12652       CALL W3XTOVSMND(IBUF,JFLAG)
  12653       IF(JFLAG.NE.0)  THEN
  12654          KJFLAG(NN) = KJFLAG(NN) + 1
  12655 C IF STATUS FLAG (JFLAG) RETURNED FROM W3XTOVSMND IS NON-ZERO, SKIP RPT
  12656          PRINT 8755, ID1ST5,IBUF(5)*0.01,ELON,JFLAG
  12657  8755 FORMAT(' * * TOTAL REPORT TOSSED  -ID=',I6,', LAT=',F7.2,'N, ',
  12658      $ 'LON=',F8.2,'E - JFLAG FROM W3XTOVSMND =',I3)
  12659 C GO BACK AND UNPACK NEXT REPORT
  12660          GO TO 1410
  12661       END IF

Page 299         Source Listing                  SATEDS
2017-04-18 11:09                                 prepdata.f

  12662 C-----------------------------------------------------------------------
  12663 C         REPORT COUNTS STORED IN ARRAY: NUMOB(IBAND,INSTR,MS,NS,1)
  12664 C         WHERE: IBAND IS LAT. BAND INDEX, INSTR IS PATH TYPE INDEX
  12665 C               MS IS LAND/OCEAN SWITCH AND NS IS SAT # INDEX
  12666 C   ** PERFORM CHECKS ON SATELLITE NUMBER AND PATH, TOSS IF PROBLEM **
  12667 C-----------------------------------------------------------------------
  12668 C.......................................................................
  12669 C IDENTIFY LATITUDE (PHI) BAND INDEX ---> IBAND
  12670 C.......................................................................
  12671       DO IBAND = 1,4
  12672          IF(IBUF(5).LT.(NINT(PHI(IBAND+1)*100.)-0.5))  GO TO 1800
  12673       ENDDO
  12674 C NOTE: IN RARE EVENT THAT LAT. MSG, IBAND SET TO 5 (RPT. LATER SKIPPED)
  12675       IBAND = 5
  12676  1800 CONTINUE
  12677 C.......................................................................
  12678 C IDENTIFY SATELLITE NUMBER INDEX ---> NS (=1 EVEN SAT. ; =2 ODD  SAT.)
  12679 C.......................................................................
  12680       NS = 0
  12681 C SATELLITE NUMBER IN IBUF(1)
  12682       IF(MOD(IBUF(1),2).EQ.0)  THEN
  12683          NS = 1
  12684       ELSE  IF(MOD(IBUF(1),2).NE.0)  THEN
  12685          NS = 2
  12686       ELSE
  12687 C IF REPORT NOT FROM AN OPERATIONAL SATELLITE SKIP IT
  12688          KNOPTV(NN) = KNOPTV(NN) + 1
  12689          PRINT 8758, ID1ST5,IBUF(5)*0.01,ELON
  12690  8758 FORMAT(' * * TOTAL REPORT TOSSED  -ID=',I6,', LAT=',F7.2,'N, ',
  12691      $ 'LON=',F8.2,'E - FROM NON-OPERATIONAL SATELLITE')
  12692 C GO BACK AND DECODE NEXT REPORT
  12693          GO TO 1410
  12694       END IF
  12695       IDSAT(NS) = IBUF(1)
  12696 C.......................................................................
  12697 C IDENTIFY PATH ---> INSTR {=1 CLEAR; 3 CLOUDY}
  12698 C  (NOTE: INSTR = 2 IS NOT A POSSIBILITY)
  12699 C.......................................................................
  12700 C  IF IBUF(12) = 545 ---> CLOUDY
  12701 C  IF IBUF(12) = 273 ---> CLEAR
  12702       IF(IBUF(12).EQ.545)  THEN
  12703          INSTR = 3
  12704       ELSE  IF(IBUF(12).EQ.273)  THEN
  12705          INSTR = 1
  12706       ELSE
  12707 C IF PATH (INSTRUMENT) NOT RECOGNIZED SKIP (NOTE: SHOULD NEVER HAPPEN)
  12708          KIPTTV(NN) = KIPTTV(NN) + 1
  12709          PRINT 8759, ID1ST5,IBUF(5)*0.01,ELON,IBUF(12)
  12710  8759 FORMAT(' * * TOTAL REPORT TOSSED  -ID=',I6,', LAT=',F7.2,'N, ',
  12711      $ 'LON=',F8.2,'E - HAS INVALID PATH (RETRIEVAL TYPE=',I5,')')
  12712 C GO BACK AND DECODE NEXT REPORT
  12713          GO TO 1410
  12714       END IF
  12715 C.......................................................................
  12716 C IDENTIFY OVERLAND/OCEANIC SWITCH ---> MS (MS=1 OVERLAND; MS=2 OCEANIC)
  12717 C  IF IBUF(8) = 0 ---> CONSIDERED OCEANIC
  12718 C  IF IBUF(8) > 0 ---> CONSIDERED OVERLAND

Page 300         Source Listing                  SATEDS
2017-04-18 11:09                                 prepdata.f

  12719 C.......................................................................
  12720       MS = 2
  12721       IF(IBUF(8).GT.0)  MS = 1
  12722 C-----------------------------------------------------------------------
  12723 C  PERFORM SERIES OF CHECKS ON THE UNPACKED REPORT, MAY TOSS IF PROBLEM
  12724 C-----------------------------------------------------------------------
  12725 C NUMOB ACCUMULATES TOTAL NUMBER OF REPORTS
  12726       NUMOB(IBAND,INSTR,MS,NS,1) = NUMOB(IBAND,INSTR,MS,NS,1) + 1
  12727 C-----------------------------------------------------------------------
  12728 C CHECK FILTER FLAG - IF TR80KM=F PROCESS ONLY "GOOD" REPORTS (250 KM
  12729 C  RESOLUTION); IF TR80KM=T PROCESS BOTH "GOOD" AND "REDUNDANT" REPORTS
  12730 C  (FULL RESOLUTION - 80 KM FOR RTOVS AND 40 KM FOR ATOVS)
  12731       IF(IBUF(20).GT.1)  THEN
  12732 C INVALID FILTER FLAG, SKIP TO NEXT REPORT
  12733          KREDTV(NN) = KREDTV(NN) + 1
  12734          PRINT 8757, ID1ST5,IBUF(5)*0.01,ELON,IBUF(20)
  12735  8757 FORMAT(' * * TOTAL REPORT TOSSED  -ID=',I6,', LAT=',F7.2,'N, ',
  12736      $ 'LON=',F8.2,'E - INVALID FILTER FLAG OF ',I3)
  12737          GO TO 1410
  12738       END IF
  12739       IF(.NOT.TR80KM)  THEN
  12740          IF(IBUF(20).EQ.1) THEN
  12741 C FILTER FLAG =1 INDICATES REDUNDANT RETRIEVAL, SKIP TO NEXT REPORT
  12742             KREDTV(NN) = KREDTV(NN) + 1
  12743             GO TO 1410
  12744          ELSE  IF(IBUF(20).EQ.-99) THEN
  12745 C FILTER FLAG IS MISSING (=-99), ESTIMATE 250 KM SAMPLING BY PROCESSING
  12746 C  ONLY EVERY 4'TH RETRIEVAL FOR RTOVS AND EVERY 11'TH RETRIEVAL FOR
  12747 C  ATOVS
  12748             IF(MFIRST.EQ.0)  THEN
  12749                PRINT 9823, SAMPLE(NN)
  12750  9823 FORMAT(/10X,'-->  WARNING: FILTER FLAG IS MISSING -- ESTIMATE 25',
  12751      $ '0 KM SAMPLING BY PROCESSING ONLY EVERY ',A4,', RETRIEVAL  <--'/)
  12752                MFIRST = 1
  12753             END IF
  12754             IF(MOD(KNTRPT-1,ISAMPLE(NN)).NE.0)  THEN
  12755                KREDTV(NN) = KREDTV(NN) + 1
  12756                GO TO 1410
  12757             END IF
  12758          END IF
  12759       END IF
  12760 C W3CNVXTOVS: REFORMAT AS UNPACKED IW3UNPBF AND APPEND PROPER SUFFIX
  12761 C  CHARACTER TO STATION ID
  12762       CALL W3CNVXTOVS(IBUF,RDATA,STNID,INSTR,ID1ST5,NN)
  12763 C CALL CHKREP TO CHECK FOR MSG LAT/LON & FOR REPORT OUTSIDE SEARCH AREA
  12764       CALL CHKREP(KMSGTV(NN),KBDYTV(NN),*1410)

Page 301         Source Listing                  SATEDS
2017-04-18 11:09 Entry Points                    prepdata.f



ENTRY POINTS

  Name               
                     
 sateds_             


SYMBOL CROSS REFERENCE

 Name                       Object Declared Type            Bytes Dimen Elements Attributes       References                        
                                                                                                                                    
 110                        Label  12829                                                          12563                             
 1400                       Label  12596                                                          12590,12626,12823                 
 1410                       Label  12593                                                          12660,12693,12713,12737,12743,1275
                                                                                                  6,12764,12774,12780,12814         
 1800                       Label  12676                                                          12672                             
 2002                       Label  12573                                                          12572                             
 2100                       Label  12794                                                          12786,12789                       
 324                        Label  12622                                                          12621                             
 550                        Label  12576                                                          12575                             
 572                        Label  12631                                                          12630                             
 581                        Label  12581                                                          12580                             
 583                        Label  12585                                                          12584                             
 700                        Label  12557                                                          12832                             
 7000                       Label  12617                                                          12616                             
 8002                       Label  12609                                                          12608                             
 8755                       Label  12657                                                          12656                             
 8757                       Label  12735                                                          12734                             
 8758                       Label  12690                                                          12689                             
 8759                       Label  12710                                                          12709                             
 961                        Label  12824                                                          12634,12638                       
 9823                       Label  12750                                                          12749                             
 ADP                        Common 12539                                14100                                                       
 ALAT_8                     Scalar 12538    R(8)            8           scalar   COM                                                
 ALON_8                     Scalar 12538    R(8)            8           scalar   COM                                                
 BMISS                      Scalar 12538    R(8)            8           scalar   COM              12598,12599,12601,12602           
 BUFRLIB_MISSING            Common 12552                                8                                                           
 CHKREP                     Subr   12764                                                          12764                             
 CTYPE                      Local  12532    CHAR            5     1     2                         12554,12572                       
 CYCLET                     Local  12569    R(4)            4           scalar                    12569,12802                       
 DATA                       Common 12540                                32                                                          
 DIRECT                     Common 12550                                36016                                                       
 DSNAME                     Local  12533    CHAR            8           scalar                    12603,12616                       
 ELON                       Local  12643    R(4)            4           scalar                    12643,12644,12645,12656,12689,1270
                                                                                                  9,12734                           
 HDR                        Scalar 12541    R(4)            4     1     14       COM              12811                             
 IBAND                      Local  12671    I(4)            4           scalar                    12671,12672,12675,12726,12772,1277
                                                                                                  8,12784,12786,12788,12789,12793,12
                                                                                                  797,12809,12810,12818,12819,12820,
                                                                                                  12821                             
 IBUF                       Local  12535    I(4)            4     1     140                       12603,12643,12644,12650,12652,1265
                                                                                                  6,12672,12682,12684,12689,12695,12
                                                                                                  702,12704,12709,12721,12731,12734,
                                                                                                  12740,12744,12762                 
 ID1ST5                     Local  12650    I(4)            4           scalar                    12650,12656,12689,12709,12734,1276

Page 302         Source Listing                  SATEDS
2017-04-18 11:09 Symbol Table                    prepdata.f

 Name                       Object Declared Type            Bytes Dimen Elements Attributes       References                        
                                                                                                                                    
                                                                                                  2                                 
 IDAT10                     Scalar 12540    I(4)            4           scalar   COM              12620                             
 IDATA                      Scalar 12536    I(4)            4     1     3500     COM                                                
 IDATE                      Scalar 12540    I(4)            4     1     4        COM              12569,12575                       
 IDATEM                     Local  12603    I(4)            4           scalar                    12603                             
 IDSAT                      Local  12536    I(4)            4     1     4                         12570,12695,12828                 
 IDSDAT                     Local  12603    I(4)            4           scalar                    12603,12616,12620                 
 IDSDMP_8                   Local  12537    I(8)            8           scalar                    12604,12616                       
 IER                        Local  12604    I(4)            4           scalar                    12604,12607,12614,12628,12630,1263
                                                                                                  6,12811,12812                     
 IFLUA                      Scalar 12549    I(4)            4           scalar   COM              12605,12784,12790,12793           
 INSTR                      Local  12703    I(4)            4           scalar                    12703,12705,12726,12762,12789,1279
                                                                                                  3,12818,12819,12820,12821         
 IPRINT                     Scalar 12539    I(4)            4           scalar   COM                                                
 IRTRV                      Scalar 12547    I(4)            4     3     80       COM              12784,12786,12788,12789,12793     
 ISAMPLE                    Local  12536    I(4)            4     1     2                         12555,12754                       
 ISATLS                     Scalar 12548    I(4)            4     3     80       COM              12772,12778                       
 ISATOB                     Scalar 12539    I(4)            4           scalar   COM                                                
 ISQNUM_UPA                 Scalar 12542    I(4)            4           scalar   COM                                                
 IUNIT                      Scalar 12543    I(4)            4     1     28       COM              12571                             
 IWINDO_E                   Scalar 12547    I(4)            4     3     80       COM              12809                             
 IWINDO_L                   Scalar 12548    I(4)            4     3     80       COM              12810                             
 JFLAG                      Local  12652    I(4)            4           scalar                    12652,12653,12656                 
 JRTRV                      Local  12535    I(4)            4     1     3                         12554,12793                       
 KBDYTV                     Scalar 12545    I(4)            4     1     2        COM              12764                             
 KEP                        Local  12818    I(4)            4           scalar                    12818,12821                       
 KEPOB                      Local  12535    I(4)            4     4     160                       12566,12821,12828                 
 KIPTTV                     Scalar 12545    I(4)            4     1     2        COM              12708                             
 KJFLAG                     Scalar 12546    I(4)            4     1     2        COM              12654                             
 KLNDTV                     Scalar 12546    I(4)            4     1     2        COM              12773                             
 KMSGTV                     Scalar 12545    I(4)            4     1     2        COM              12764                             
 KNOPTV                     Scalar 12545    I(4)            4     1     2        COM              12688                             
 KNTRPT                     Local  12554    I(4)            4           scalar                    12554,12589,12630,12642,12650,1275
                                                                                                  4                                 
 KNTTOV                     Scalar 12544    I(4)            4     1     2        COM              12830                             
 KOUNT                      Scalar 12540    I(4)            4           scalar   COM              12559,12830                       
 KREDTV                     Scalar 12546    I(4)            4     1     2        COM              12733,12742,12755                 
 KSATOB                     Local  12536    I(4)            4     1     3                         12603                             
 KSEATV                     Scalar 12546    I(4)            4     1     2        COM              12779                             
 KSKPTV                     Scalar 12545    I(4)            4     1     2        COM              12595                             
 KTIMTV                     Scalar 12545    I(4)            4     1     2        COM              12813                             
 KTOP                       Scalar 12547    I(4)            4     3     80       COM              12797                             
 LEVPM                      Scalar 12542    I(4)            4           scalar   COM              12797                             
 LEVQQ                      Scalar 12542    I(4)            4           scalar   COM                                                
 LEVST                      Scalar 12542    I(4)            4           scalar   COM                                                
 MAXOBS                     Param  12529    I(4)            4           scalar                    12536,12539                       
 MFIRST                     Local  12555    I(4)            4           scalar                    12555,12748,12752                 
 MOD                        Func   12650                                scalar                    12650,12682,12684,12754           
 MODPRT                     Scalar 12549    I(4)            4           scalar   COM                                                
 MP_PROCESS                 Scalar 12540    I(4)            4           scalar   COM                                                
 MS                         Local  12720    I(4)            4           scalar                    12720,12721,12726,12770,12818,1281
                                                                                                  9,12820,12821                     
 MST                        Local  12818    I(4)            4           scalar                    12818,12820                       
 MSTOB                      Local  12536    I(4)            4     4     160                       12567,12819,12820,12828           
 MXBLVL                     Param  12528    I(4)            4           scalar                    12550                             

Page 303         Source Listing                  SATEDS
2017-04-18 11:09 Symbol Table                    prepdata.f

 Name                       Object Declared Type            Bytes Dimen Elements Attributes       References                        
                                                                                                                                    
 MXWRDH                     Param  12527    I(4)            4           scalar                    12541                             
 NFILE                      Scalar 12543    I(4)            4           scalar   COM              12571,12572,12603,12608,12630     
 NINT                       Func   12645                                scalar                    12645,12672                       
 NN                         Local  12556    I(4)            4           scalar                    12556,12563,12571,12572,12595,1265
                                                                                                  4,12688,12708,12733,12742,12749,12
                                                                                                  754,12755,12762,12764,12773,12779,
                                                                                                  12813,12828,12830,12831,12832     
 NOBS3                      Scalar 12550    I(4)            4     1     7        COM              12600                             
 NS                         Local  12680    I(4)            4           scalar                    12680,12683,12685,12695,12726,1277
                                                                                                  2,12778,12784,12786,12788,12789,12
                                                                                                  793,12797,12809,12810,12818,12819 
 NUMOB                      Local  12535    I(4)            4     5     640                       12565,12726,12828                 
 NUMOBS2                    Param  12530    I(4)            4           scalar                    12550                             
 OBS2                       Scalar 12550    R(4)            4     1     43       COM              12598                             
 OBS3                       Scalar 12550    R(4)            4     3     8925     COM              12599                             
 OBS8_8                     Scalar 12538    R(8)            8     1     2        COM              12601                             
 PARM6                      Common 12549                                32                                                          
 PBOT                       Local  12603    R(4)            4           scalar                    12603                             
 PHI                        Scalar 12547    R(4)            4     1     6        COM              12672                             
 PMAND                      Scalar 12539    R(4)            4     1     23       COM                                                
 RDATA                      Scalar 12539    R(4)            4     1     3500     COM              12762                             
 RDATA2                     Scalar 12550    R(4)            4     1     25       COM              12602                             
 REAL                       Func   12643                                scalar                    12643,12644                       
 RPTHDR                     Common 12541                                88                                                          
 RPTLBL                     Subr   12802                                                          12802                             
 SAMPLE                     Local  12531    CHAR            4     1     2                         12555,12749                       
 SATEDS                     Subr   12512                                                                                            
 SATMST                     Scalar 12534    L(4)            4     3     80       COM              12818,12819                       
 SATSW2                     Common 12547                                1944                                                        
 SNDPRP                     Subr   12818                                                          12818                             
 SNDTBL                     Subr   12828                                                          12828                             
 SPCIAL                     Scalar 12542    R(4)            4           scalar   COM                                                
 STNID                      Scalar 12533    CHAR            8           scalar   COM              12762                             
 STNPRT                     Scalar 12533    CHAR            8     1     3        COM                                                
 SUBSET_D                   Scalar 12533    CHAR            8           scalar   COM                                                
 TDLIM                      Scalar 12542    R(4)            4           scalar   COM                                                
 TDMAX                      Scalar 12542    R(4)            4           scalar   COM                                                
 TIMCHK                     Subr   12811                                                          12811                             
 TIMWIN_E                   Local  12809    R(4)            4           scalar                    12809,12811                       
 TIMWIN_L                   Local  12810    R(4)            4           scalar                    12810,12811                       
 TOVBFR                     Scalar 12544    R(4)            4     1     2        COM                                                
 TOVEDS                     Scalar 12534    L(4)            4     1     2        COM              12563                             
 TR80KM                     Scalar 12534    L(4)            4           scalar   COM              12579,12739                       
 TVSWCH                     Common 12544                                108                                                         
 UNITNO                     Common 12543                                116                                                         
 UPALIM                     Common 12542                                28                                                          
 W3CNVXTOVS                 Subr   12762                                                          12762                             
 W3XTOVSEDS                 Subr   12603                                                          12603                             
 W3XTOVSMND                 Subr   12652                                                          12652                             
 WRMISS                     Scalar 12540    R(4)            4           scalar   COM                                                

Page 304         Source Listing                  SATEDS
2017-04-18 11:09                                 prepdata.f

  12765 C-----------------------------------------------------------------------
  12766 C KEEP OR EXCLUDE RETRIEVALS BASED ON LAND/OCEAN, LAT BAND, SAT.#, RETR.
  12767 C  TYPE, TOP LVL, & TIME WINDOW INDECES - ARRAY (IBAND,NS) WHERE IBAND
  12768 C IS LATITUDE BAND INDEX AND NS IS SATELLITE NUMBER INDEX DEFINED ABOVE
  12769 C-----------------------------------------------------------------------
  12770       IF(MS.EQ.1)  THEN
  12771 C CHECK IF OVERLAND REPORTS ARE TO BE EXCLUDED {ISATLS(IBAND,NS,1) = 2}
  12772          IF(ISATLS(IBAND,NS,1).EQ.2)  THEN
  12773             KLNDTV(NN) = KLNDTV(NN) + 1
  12774             GO TO 1410
  12775          END IF
  12776       ELSE
  12777 C CHECK IF OCEANIC REPORTS ARE TO BE EXCLUDED {ISATLS(IBAND,NS,1) = 1}
  12778          IF(ISATLS(IBAND,NS,1).EQ.1)  THEN
  12779             KSEATV(NN) = KSEATV(NN) + 1
  12780             GO TO 1410
  12781          END IF
  12782       END IF
  12783 C FLAG ALL RETRIEVALS (IRTRV(IBAND,NS,1) = 9999)
  12784       IF(IRTRV(IBAND,NS,1).EQ.9999)  IFLUA = 1
  12785 C KEEP ALL RETRIEVALS (IRTRV(IBAND,NS,1) = 0)
  12786       IF(IRTRV(IBAND,NS,1).EQ.0)  GO TO 2100
  12787 C CHECK FOR COND WHERE ONLY ONE PATH (RETR. INSTR. TYPE) IS NOT-FLAGGED
  12788       IF(IRTRV(IBAND,NS,1).LE.3)  THEN
  12789          IF(IRTRV(IBAND,NS,1).EQ.INSTR)  GO TO 2100
  12790          IFLUA = 1
  12791       END IF
  12792 C CHECK FOR COND WHERE ONLY ONE PATH (RETR. INSTR. TYPE) IS FLAGGED
  12793       IF(IRTRV(IBAND,NS,1).EQ.JRTRV(INSTR))  IFLUA = 1
  12794  2100 CONTINUE
  12795 C LEVPM RESET TO LIMITING UPPER MAND. PRESS. LEVEL TO PROCESS DATA
  12796 C  (NO PROBLEM CHANGING SWITCH SINCE ALL NON-SAT. U-AIR PROCESSING DONE)
  12797       LEVPM = KTOP(IBAND,NS,1)
  12798 C-----------------------------------------------------------------------
  12799 C CALL SUBR. 'RPTLBL' TO STORE REPORT HEADER INTO HDR(4),HDR(5),HDR(7),
  12800 C                          HDR(9)-HDR(15), ALAT_8, ALON_8
  12801 C-----------------------------------------------------------------------
  12802       CALL RPTLBL(CYCLET)
  12803 C-----------------------------------------------------------------------
  12804 C        CALL SUBR. 'TIMCHK' TO CHECK IF REPORT IS W/I PROPER
  12805 C              TIME WINDOW OF CYCLE TIME (IER =1 TOSS RPT)
  12806 C-----------------------------------------------------------------------
  12807 C TIMWIN_e AND TIMWIN_l ARE THE TIME WINDOWS (RELATIVE TO CYCLE TIME)
  12808 C  FOR ACCEPTING REPORTS (EARLIEST AND LATEST, RESPECTIVELY)
  12809       TIMWIN_e = IWINDO_e(IBAND,NS,1)
  12810       TIMWIN_l = IWINDO_l(IBAND,NS,1)
  12811       CALL TIMCHK(HDR(4),TIMWIN_e,TIMWIN_l,IER)
  12812       IF(IER.EQ.1)  THEN
  12813         KTIMTV(NN) = KTIMTV(NN) + 1
  12814          GO TO 1410
  12815       END IF
  12816 C CALL SUBR. SNDPRP TO PROCESS THE SATELLITE RETRIEVAL
  12817 C KEP AND MST COUNT TOTAL RETR. KEPT AND RETR. WITH MOISTURE KEPT, RESP.
  12818       CALL SNDPRP(MS,INSTR,SATMST(IBAND,NS,1),MST,KEP)
  12819       IF(SATMST(IBAND,NS,1))  MSTOB(IBAND,INSTR,MS,1) =
  12820      $ MSTOB(IBAND,INSTR,MS,1) + MST
  12821       KEPOB(IBAND,INSTR,MS,1) = KEPOB(IBAND,INSTR,MS,1) + KEP

Page 305         Source Listing                  SATEDS
2017-04-18 11:09                                 prepdata.f

  12822 C GO BACK AND DECODE NEXT REPORT
  12823       GO TO 1400
  12824   961 CONTINUE
  12825 C-----------------------------------------------------------------------
  12826 C-----------------------------------------------------------------------
  12827 C FINISHED PROCESSING RPTS IN THIS FILE; SUBR. SNDTBL SUMMARIZES IN TBL
  12828       CALL SNDTBL(IDSAT,NUMOB,KEPOB,MSTOB,NN)
  12829   110 CONTINUE
  12830       KNTTOV(NN) = KOUNT
  12831       NN = NN + 1
  12832       IF(NN.LE.2)  GO TO 700
  12833       RETURN
  12834       END
  12835 C$$$  SUBPROGRAM DOCUMENTATION BLOCK
  12836 C
  12837 C SUBPROGRAM:    SNDTBL
  12838 C   PRGMMR: D. A. KEYSER     ORG: NP22       DATE: 2001-08-01
  12839 C
  12840 C ABSTRACT: GENERATES A TABLE WHICH SUMMARIZES SATELLITE RADIANCE/
  12841 C   RETRIEVAL REPORT COUNTS FOR RTOVS, ATOVS AND GOES.  TABLE BREAKS
  12842 C   UP THE COUNTS ACCORDING TO LATITUDE BAND, PATH (INSTRUMENT),
  12843 C   SATELLITE (EVEN/ODD OR, FOR GOES, 2 EVEN AND 2 ODD), AND OCEAN/
  12844 C   LAND.  THE TOTAL NUMBER OF REPORTS IS PRINTED AS WELL AS THE NUMBER
  12845 C   ACTUALLY KEPT AND THE NUMBER KEPT WITH VALID MOISTURE INFORMATION.
  12846 C
  12847 C PROGRAM HISTORY LOG:
  12848 C 1993-05-31  D. A. KEYSER (W/NMC22) -- ORIGINAL AUTHOR
  12849 C 1993-11-02  D. A. KEYSER (W/NMC22) -- FOR SATBFR=T, SUMMARY TABLE
  12850 C     EXPANDED TO INCL. COUNTS FROM BOTH NESDIS 40-LVL & NMC I/A RETR.
  12851 C 1995-07-12  D. A. KEYSER (W/NMC22) -- MODIFIED TO INCLUDE SUMMARY
  12852 C     OF GOES RETRIEVAL COUNTS, VAS SUMMARY REMOVED
  12853 C 1996-09-03  D. A. KEYSER -- CAN PROCESS RETR. FROM GOES-ODD SAT (AS
  12854 C     WAS FOR GOES-EVEN SAT)
  12855 C 1998-06-15  D. A. KEYSER -- REMOVED ALL LOGIC PERTAINING TO TOVS
  12856 C     PROCESSING
  12857 C 1999-01-20  D. A. KEYSER -- REPL. N-LIST SWITCH "SATLND" WITH NEW
  12858 C     SWITCHES "ISATLS" AND "JSATLS" TO HANDLE LAND/SEA SELECTION FOR
  12859 C     SATELLITE SNDGS/RADIANCES AND GOES PW RETR. SEPARATELY (ALSO CAN
  12860 C     NOW SELECT JUST LAND AS WELL AS JUST SEA OR EVERYWHERE)
  12861 C 2000-02-17  D. A. KEYSER -- NOW PROCESS ATOVS DATA
  12862 C 2001-06-19  D. A. KEYSER -- CAN NOW PRINT GOES 1x1 FOV CLOUD TOP
  12863 C     REPORTS; N-LIST SWITCHES "IWINDO", "SATMST", "ISATLS", "IRTRV"
  12864 C     AND "KTOP" NOW MORE SPECIFIC TO POINT TO PAIRS OF EVEN OR ODD
  12865 C     GOES SATS. AND TO THE 4 POSSIBLE REPORT TYPES THAT CAN BE
  12866 C     GENERATED FROM RTOVS/ATOVS AND GOES SNDG/RAD/RETR. DATA (OLD
  12867 C     SWITCHES "JSATLS" AND "FLGOES" NO LONGER NEEDED AND REMOVED);
  12868 C     SUBR. STREAMLINED TO PRESENT IMPROVED TABLES, INPUT ARG. "IDSAT"
  12869 C     OF LENGTH 4 REPL. OLD ARG. "IEVSAT" AND "IODSAT"
  12870 C 2001-08-01  D. A. KEYSER -- N-LIST SWITCH IWINDO SPLIT INTO IWINDO_e
  12871 C     (EARLIEST TIME WINDOW) AND IWINDO_l (LATEST TIME WINDOW) FOR
  12872 C     SATELLITE SOUNDING/RETRIEVAL/RADIANCE REPORTS ("-" PRIOR TO CYCLE
  12873 C     TIME, "+" AFTER CYCLE TIME) (SAME DEFAULTS AS BEFORE)
  12874 C
  12875 C USAGE:    CALL SNDTBL(IDSAT,NUMOB,KEPOB,MSTOB,NN)
  12876 C   INPUT ARGUMENT LIST:
  12877 C     IDSAT     - 4-WORD ARRAY HOLDING SATELLITE NO.: WORD 1 - EVEN
  12878 C               - RTOVS OR ATOVS, EVEN-1 GOES; WORD 2 - ODD RTOVS OR

Page 306         Source Listing                  SATEDS
2017-04-18 11:09                                 prepdata.f

  12879 C               - ATOVS, ODD-1 GOES; WORD 3 - EVEN-2 GOES (DOES NOT
  12880 C               - APPLY TO RTOVS OR ATOVS); WORD 4 - ODD-2 GOES (DOES
  12881 C               - NOT APPLY TO RTOVS OR ATOVS)
  12882 C     NUMOB     - (5,4,2,4,4) ARRAY HOLDING TOTAL COUNT BY LAT. BAND,
  12883 C               - PATH, LAND OR SEA, SAT. NUMBER, AND REPORT TYPE
  12884 C     KEPOB     - (5,4,2,4) ARRAY HOLDING KEPT COUNT BY LAT. BAND,
  12885 C               - PATH, LAND OR SEA, AND REPORT TYPE
  12886 C     MSTOB     - (5,4,2,4) ARRAY HOLDING KEPT MOISTURE COUNT BY LAT.
  12887 C               - BAND, PATH, LAND OR SEA, AND REPORT TYPE
  12888 C     NN        - SWITCH TO INDICATE SATELLITE TYPE - EITHER
  12889 C               - RTOVS (NN=1), ATOVS (NN=2) OR GOES (NN=3)
  12890 C
  12891 C   OUTPUT FILES:
  12892 C     UNIT 06  - STANDARD OUTPUT PRINT
  12893 C
  12894 C REMARKS: CALLED BY SUBROUTINES 'SATEDS', 'SATBFR' AND 'GOESDG'.
  12895 C
  12896 C ATTRIBUTES:
  12897 C   LANGUAGE: FORTRAN 90
  12898 C   MACHINE:  NCEP WCOSS
  12899 C
  12900 C$$$
  12901       SUBROUTINE SNDTBL(IDSAT,NUMOB,KEPOB,MSTOB,NN)
  12902       PARAMETER (MAXOBS = 3500)
  12903       LOGICAL  SATMST
  12904       CHARACTER*3   CCAP_1(3),CCAP_3(3),CCAP_4(3)
  12905       CHARACTER*5   CSATEL(4)
  12906       CHARACTER*6   CABEL(4)
  12907       INTEGER  NUMOB(5,4,2,4,4),KEPOB(5,4,2,4),MSTOB(5,4,2,4),IDSAT(4)
  12908       COMMON/ADP/ISATOB,PMAND(23),RDATA(MAXOBS),IPRINT
  12909       COMMON/SATSW2/PHI(6),IRTRV(5,4,4),KTOP(5,4,4),IWINDO_e(5,4,4),
  12910      $ IWINDO_l(5,4,4),SATMST(5,4,4),ISATLS(5,4,4)
  12911       COMMON/GOSWCH/GOESND(2),GOESPW(2),GOESCT(2),KNTGIT,KNTGIS,KNTGIP,
  12912      $ KSKPGI,KNDCGI,KNOPGI,KMSGGI,KBDYGI,KTIMGI(3),KLNDGI(3),KSEAGI(3),
  12913      $ KNTGIC,KNOCTP
  12914       DATA  CSATEL/'RTOVS','ATOVS','GOES ','?????'/
  12915       DATA  CABEL/'EVEN-1',' ODD-1','EVEN-2',' ODD-2'/
  12916       DATA  CCAP_1/'I/L','XXX','O/Q'/
  12917       DATA  CCAP_3/'J/M','XXX','P/R'/
  12918       DATA  CCAP_4/'K/N','XXX','S/T'/
  12919       NN = MIN(NN,4)
  12920       PRINT 101, CSATEL(NN)
  12921   101 FORMAT(/,42X,'***** TABLE DETAILING USE OF ',A5,' DATA *****')
  12922       IF(ISATOB.NE.3)  THEN
  12923          PRINT 102, CSATEL(NN),IDSAT(1),IDSAT(2)
  12924   102    FORMAT(/32X,'(FOR ',A5,' SATELLITES - EVEN SAT. NO. IS',I4,
  12925      $    ', ODD SAT. NO. IS',I4,')')
  12926          PRINT 103
  12927   103    FORMAT(//
  12928      $ 24X,'PHI',17X,'- LATITUDE BANDS AS NOTED IN &LDTA'/
  12929      $ 24X,'MOISTURE SWITCH     - T (USE) OR F (EXCLUDE) - SEE SATMST ',
  12930      $ 'IN &LDTA'/
  12931      $ 24X,'LAND/SEA SWITCH     - AS BELOW - SEE ISATLS IN &LDTA'/
  12932      $ 24X,'PATH TYPE SWITCH    - AS BELOW - SEE IRTRV  IN &LDTA'/
  12933      $ 24X,'  (IRTRV DOES NOT APPLY TO RADIANCES!!!)'/)
  12934          PRINT 105
  12935   105    FORMAT(37X,'0 - PROCESS ALL TYPES'/

Page 307         Source Listing                  SNDTBL
2017-04-18 11:09                                 prepdata.f

  12936      $ 37X,'1 - FLAG ALL BUT CLEAR-COLUMN TYPES',9X,'(PATH W,S,A OR E)'/
  12937      $ 37X,'3 - FLAG ALL BUT CLOUDY TYPES',15X,'(PATH Y,U,C OR G)'/
  12938      $ 34X,'9999 - FLAG ALL TYPES'/
  12939      $ 35X,'272 - FLAG ONLY CLEAR-COLUMN TYPES',12X,'(PATH W,S,A OR E)'/
  12940      $ 35X,'544 - FLAG ONLY CLOUDY TYPES',18X,'(PATH Y,U,C OR G)'/)
  12941          PRINT 106
  12942   106    FORMAT(24X,'TOP LEVEL',11X,'- INDEX OF TOPMOST MAND. PRES',
  12943      $    'SURE IN WHICH TO PROCESS DATA - SEE KTOP IN &LDTA'/)
  12944          PRINT 201, PHI,PHI,
  12945      $    ((SATMST(ILAT,ISAT,1),ILAT=1,5),ISAT=1,2),
  12946      $    ((ISATLS(ILAT,ISAT,1),ILAT=1,5),ISAT=1,2),
  12947      $    (( IRTRV(ILAT,ISAT,1),ILAT=1,5),ISAT=1,2),
  12948      $    ((  KTOP(ILAT,ISAT,1),ILAT=1,5),ISAT=1,2),
  12949      $  ((IWINDO_e(ILAT,ISAT,1),ILAT=1,5),ISAT=1,2),
  12950      $  ((IWINDO_l(ILAT,ISAT,1),ILAT=1,5),ISAT=1,2)
  12951   201    FORMAT(//1X,126('_')
  12952      $    /' !',T29,'!',T50,'EVEN SAT',T78,'!',T98,'ODD SAT',T127,'!'
  12953      $    /1X,126('_')
  12954      $    /' !',T29,'!',T78,'!',T127,'!'
  12955      $   /' ! PHI (LAT. STRIPS-DEG. N)',T29,'!',6F8.0,'!',6F8.0,T127,'!'
  12956      $    /1X,126('_')
  12957      $    /' !',T29,'!',T78,'!',T127,'!'
  12958      $    /' ! MOISTURE SWITCH    ',10X,T29,2('!',4X,5L8,4X),T127,'!'
  12959      $    /' !',T29,'!',T78,'!',T127,'!'
  12960      $    /' ! LAND/SEA SWITCH    ',10X,T29,2('!',4X,5I8,4X),T127,'!'
  12961      $    /' !',T29,'!',T78,'!',T127,'!'
  12962      $    /' ! PATH TYPE SWITCH   ',10X,T29,2('!',4X,5I8,4X),T127,'!'
  12963      $    /' !',T29,'!',T78,'!',T127,'!'
  12964      $    /' ! TOP LEVEL          ',10X,T29,2('!',4X,5I8,4X),T127,'!'
  12965      $    /' !',T29,'!',T78,'!',T127,'!'
  12966      $    /' ! EARLIEST TIME (HOURS)',8X,T29,2('!',4X,5I8,4X),T127,'!'
  12967      $    /' !',T29,'!',T78,'!',T127,'!'
  12968      $    /' ! LATEST   TIME (HOURS)',8X,T29,2('!',4X,5I8,4X),T127,'!')
  12969          PRINT 202, ((NUMOB(ILAT,1,1,ISAT,1)+
  12970      $                NUMOB(ILAT,1,2,ISAT,1),ILAT=1,5),ISAT=1,2),
  12971      $              ((NUMOB(ILAT,3,1,ISAT,1)+
  12972      $                NUMOB(ILAT,3,2,ISAT,1),ILAT=1,5),ISAT=1,2)
  12973   202    FORMAT(1X,126('.')
  12974      $    /' !',T29,'!',T78,'!',T127,'!'
  12975      $    /' ! TOTAL CNT -CLEAR W/S/A/E ',T29,2('!',4X,5I8,4X),T127,'!'
  12976      $    /' !',T29,'!',T78,'!',T127,'!'
  12977      $    /' ! TOTAL CNT -CLDY  Y/U/C/G ',T29,2('!',4X,5I8,4X),T127,'!'
  12978      $    /1X,126('_'))
  12979          PRINT 203, PHI,PHI
  12980   203    FORMAT(///1X,126('_')
  12981      $    /' !',T29,'!',T38,'OVERLAND REPORT COUNT',T78,
  12982      $              '!',T90,'OCEANIC REPORT COUNT',T127,'!'
  12983      $    /1X,126('_')
  12984      $    /' !',T29,'!',T78,'!',T127,'!'
  12985      $   /' ! PHI (LAT. STRIPS-DEG. N)',T29,'!',6F8.0,'!',6F8.0,T127,'!'
  12986      $    )
  12987          PRINT 204, ((NUMOB(ILAT,1,ILS,1,1)+
  12988      $                NUMOB(ILAT,1,ILS,2,1),ILAT=1,5),ILS=1,2),
  12989      $              ((NUMOB(ILAT,3,ILS,1,1)+
  12990      $                NUMOB(ILAT,3,ILS,2,1),ILAT=1,5),ILS=1,2)
  12991   204    FORMAT(1X,126('_')
  12992      $    /' !',T29,'!',T78,'!',T127,'!'

Page 308         Source Listing                  SNDTBL
2017-04-18 11:09                                 prepdata.f

  12993      $    /' ! TOTAL CNT -CLEAR W/S/A/E ',T29,2('!',4X,5I8,4X),T127,'!'
  12994      $    /' !',T29,'!',T78,'!',T127,'!'
  12995      $    /' ! TOTAL CNT -CLDY  Y/U/C/G ',T29,2('!',4X,5I8,4X),T127,'!')
  12996          PRINT 205, ((KEPOB(ILAT,1,ILS,1),ILAT=1,5),ILS=1,2),
  12997      $              ((KEPOB(ILAT,3,ILS,1),ILAT=1,5),ILS=1,2)
  12998   205    FORMAT(1X,126('.')
  12999      $    /' !',T29,'!',T78,'!',T127,'!'
  13000      $    /' ! KEPT - CLEAR  W/S/A/E ',T29,2('!',4X,5I8,4X),T127,'!'
  13001      $    /' !',T29,'!',T78,'!',T127,'!'
  13002      $    /' ! KEPT -  CLDY  Y/U/C/G ',T29,2('!',4X,5I8,4X),T127,'!')
  13003          PRINT 206, ((MSTOB(ILAT,1,ILS,1),ILAT=1,5),ILS=1,2),
  13004      $              ((MSTOB(ILAT,3,ILS,1),ILAT=1,5),ILS=1,2)
  13005   206    FORMAT(1X,126('.')
  13006      $    /' !',T29,'!',T78,'!',T127,'!'
  13007      $    /' ! KEPT MOIST-CLEAR W/S/A/E ',T29,2('!',4X,5I8,4X),T127,'!'
  13008      $    /' !',T29,'!',T78,'!',T127,'!'
  13009      $    /' ! KEPT MOIST- CLDY Y/U/C/G ',T29,2('!',4X,5I8,4X),T127,'!'
  13010      $    /1X,126('_')//)
  13011       ELSE
  13012          PRINT 402, IDSAT
  13013   402    FORMAT(/10X,'(FOR GOES SATELLITES - EVEN-1 SAT. NO. IS',I4,
  13014      $    ', ODD-1 SAT. NO. IS',I4,', EVEN-2 SAT. NO. IS',I4,', ODD-2 ',
  13015      $    'SAT. NO. IS',I4,')')
  13016          PRINT 103
  13017          PRINT 115
  13018   115    FORMAT(37X,'0 - PROCESS ALL TYPES'/
  13019      $ 37X,'1 - FLAG ALL BUT CLEAR-COLUMN TYPES',9X,'(PATH I,L,O OR Q)'/
  13020      $ 37X,'3 - FLAG ALL BUT CLOUDY TYPES',15X,'(PATH J,M,P OR R)'/
  13021      $ 37X,'4 - FLAG ALL BUT UNKNOWN TYPES',14X,'(PATH K,N,S OR T)'/
  13022      $ 34X,'9999 - FLAG ALL TYPES'/
  13023      $ 35X,'272 - FLAG ONLY CLEAR-COLUMN TYPES',12X,'(PATH I,L,O OR Q)'/
  13024      $ 35X,'544 - FLAG ONLY CLOUDY TYPES',18X,'(PATH J,M,P OR R)'/
  13025      $ 35X,'118 - FLAG ONLY UNKNOWN TYPES',17X,'(PATH K,N,S OR T)'/)
  13026          PRINT 106
  13027          DO  II=1,3,2
  13028             PRINT 401, CABEL(II),CABEL(II+1),PHI,PHI,
  13029      $       (((SATMST(ILAT,ISAT,ITP),ILAT=1,5),ISAT=II,II+1),ITP=2,2),
  13030      $       (((ISATLS(ILAT,ISAT,ITP),ILAT=1,5),ISAT=II,II+1),ITP=2,4),
  13031      $       ((( IRTRV(ILAT,ISAT,ITP),ILAT=1,5),ISAT=II,II+1),ITP=2,4),
  13032      $       (((  KTOP(ILAT,ISAT,ITP),ILAT=1,5),ISAT=II,II+1),ITP=2,2),
  13033      $     (((IWINDO_e(ILAT,ISAT,ITP),ILAT=1,5),ISAT=II,II+1),ITP=2,4),
  13034      $     (((IWINDO_l(ILAT,ISAT,ITP),ILAT=1,5),ISAT=II,II+1),ITP=2,4)
  13035   401       FORMAT(//1X,126('_')
  13036      $       /' !',T29,'!',T49,A6,' SAT',T78,'!',T95,A6,' SAT',T127,'!'
  13037      $       /1X,126('_')
  13038      $       /' !',T29,'!',T78,'!',T127,'!'
  13039      $   /' ! PHI (LAT. STRIPS-DEG. N)',T29,'!',6F8.0,'!',6F8.0,T127,'!'
  13040      $       /1X,126('_'),
  13041      $       /' !',T29,'!',T78,'!',T127,'!'
  13042      $       /' ! MOISTURE SWITCH -     ',T29,'!',T78,'!',T127,'!'
  13043      $       /' !   SOUNDINGS           ',T29,2('!',4X,5L8,4X),T127,'!'
  13044      $       /' !',T29,'!',T78,'!',T127,'!',
  13045      $       /' ! LAND/SEA SWITCH -     ',T29,'!',T78,'!',T127,'!'
  13046      $       /' !   RADIANCES/SOUNDINGS ',T29,2('!',4X,5I8,4X),T127,'!'
  13047      $       /' !   PWATER RETRIEVALS   ',T29,2('!',4X,5I8,4X),T127,'!'
  13048      $       /' !   CLOUD TOP RETRIEVALS',T29,2('!',4X,5I8,4X),T127,'!'
  13049      $       /' !',T29,'!',T78,'!',T127,'!',

Page 309         Source Listing                  SNDTBL
2017-04-18 11:09                                 prepdata.f

  13050      $       /' ! PATH TYPE SWITCH -    ',T29,'!',T78,'!',T127,'!'
  13051      $       /' !   SOUNDINGS           ',T29,2('!',4X,5I8,4X),T127,'!'
  13052      $       /' !   PWATER RETRIEVALS   ',T29,2('!',4X,5I8,4X),T127,'!'
  13053      $       /' !   CLOUD TOP RETRIEVALS',T29,2('!',4X,5I8,4X),T127,'!'
  13054      $       /' !',T29,'!',T78,'!',T127,'!',
  13055      $       /' ! TOP LEVEL -           ',T29,'!',T78,'!',T127,'!'
  13056      $       /' !   SOUNDINGS           ',T29,2('!',4X,5I8,4X),T127,'!'
  13057      $       /' !',T29,'!',T78,'!',T127,'!',
  13058      $       /' ! EARLIEST TIME (HRx100) - ',T29,'!',T78,'!',T127,'!'
  13059      $       /' !   RADIANCES/SOUNDINGS ',T29,2('!',4X,5I8,4X),T127,'!'
  13060      $       /' !   PWATER RETRIEVALS   ',T29,2('!',4X,5I8,4X),T127,'!'
  13061      $       /' !   CLOUD TOP RETRIEVALS',T29,2('!',4X,5I8,4X),T127,'!'
  13062      $       /' !',T29,'!',T78,'!',T127,'!',
  13063      $       /' ! LATEST   TIME (HRx100) - ',T29,'!',T78,'!',T127,'!'
  13064      $       /' !   RADIANCES/SOUNDINGS ',T29,2('!',4X,5I8,4X),T127,'!'
  13065      $       /' !   PWATER RETRIEVALS   ',T29,2('!',4X,5I8,4X),T127,'!'
  13066      $       /' !   CLOUD TOP RETRIEVALS',T29,2('!',4X,5I8,4X),T127,'!')
  13067             PRINT 403,CCAP_1(II),((((NUMOB(ILAT,1,1,ISAT,ITP)+
  13068      $                               NUMOB(ILAT,1,2,ISAT,ITP)),ILAT=1,5)
  13069      $ ,                                         ISAT=II,II+1),ITP=2,3),
  13070      $                CCAP_3(II),((((NUMOB(ILAT,3,1,ISAT,ITP)+
  13071      $                               NUMOB(ILAT,3,2,ISAT,ITP)),ILAT=1,5)
  13072      $ ,                                         ISAT=II,II+1),ITP=2,3),
  13073      $                CCAP_4(II),((((NUMOB(ILAT,4,1,ISAT,ITP)+
  13074      $                               NUMOB(ILAT,4,2,ISAT,ITP)),ILAT=1,5)
  13075      $ ,                                         ISAT=II,II+1),ITP=4,4)
  13076   403       FORMAT(1X,126('.')
  13077      $       /' !',T29,'!',T78,'!',T127,'!'
  13078      $       /' ! TOTAL COUNT -             ',T29,'!',T78,'!',T127,'!'
  13079      $       /' !   CLEAR -           (',A3,')',T29,'!',T78,'!',T127,'!'
  13080      $       /' !     RADIANCES/SOUNDINGS',T29,2('!',4X,5I8,4X),T127,'!'
  13081      $       /' !     PWATER RETRIEVALS  ',T29,2('!',4X,5I8,4X),T127,'!'
  13082      $       /' !',T29,'!',T78,'!',T127,'!',
  13083      $       /' !   CLOUDY -          (',A3,')',T29,'!',T78,'!',T127,'!'
  13084      $       /' !     RADIANCES/SOUNDINGS',T29,2('!',4X,5I8,4X),T127,'!'
  13085      $       /' !     PWATER RETRIEVALS  ',T29,2('!',4X,5I8,4X),T127,'!'
  13086      $       /' !',T29,'!',T78,'!',T127,'!',
  13087      $       /' !   UNKNOWN -         (',A3,')',T29,'!',T78,'!',T127,'!'
  13088      $      /' !     CLOUD TOP RETRIEVALS',T29,2('!',4X,5I8,4X),T127,'!'
  13089      $       /1X,126('_'))
  13090          END DO
  13091          PRINT 404, PHI,PHI
  13092   404    FORMAT(///1X,126('_')
  13093      $    /' !',T29,'!',T38,'OVERLAND REPORT COUNT',T78,
  13094      $              '!',T90,'OCEANIC REPORT COUNT',T127,'!'
  13095      $    /1X,126('_')
  13096      $    /' !',T29,'!',T78,'!',T127,'!'
  13097      $   /' ! PHI (LAT. STRIPS-DEG. N)',T29,'!',6F8.0,'!',6F8.0,T127,'!'
  13098      $    )
  13099          PRINT 405, ((((NUMOB(ILAT,1,ILS,1,ITP)+
  13100      $                  NUMOB(ILAT,1,ILS,2,ITP)+
  13101      $                  NUMOB(ILAT,1,ILS,3,ITP)+
  13102      $                  NUMOB(ILAT,1,ILS,4,ITP)),ILAT=1,5),
  13103      $                                           ILS=1,2),ITP=2,3),
  13104      $              ((((NUMOB(ILAT,3,ILS,1,ITP)+
  13105      $                  NUMOB(ILAT,3,ILS,2,ITP)+
  13106      $                  NUMOB(ILAT,3,ILS,3,ITP)+

Page 310         Source Listing                  SNDTBL
2017-04-18 11:09                                 prepdata.f

  13107      $                  NUMOB(ILAT,3,ILS,4,ITP)),ILAT=1,5),
  13108      $                                           ILS=1,2),ITP=2,3),
  13109      $              ((((NUMOB(ILAT,4,ILS,1,ITP)+
  13110      $                  NUMOB(ILAT,4,ILS,2,ITP)+
  13111      $                  NUMOB(ILAT,4,ILS,3,ITP)+
  13112      $                  NUMOB(ILAT,4,ILS,4,ITP)),ILAT=1,5),
  13113      $                                           ILS=1,2),ITP=4,4)
  13114   405    FORMAT(1X,126('_')
  13115      $    /' !',T29,'!',T78,'!',T127,'!'
  13116      $    /' ! TOTAL COUNT -            ',T29,'!',T78,'!',T127,'!'
  13117      $    /' !   CLEAR -       (I/L/O/Q)',T29,'!',T78,'!',T127,'!'
  13118      $    /' !     RADIANCES/SOUNDINGS  ',T29,2('!',4X,5I8,4X),T127,'!'
  13119      $    /' !     PWATER RETRIEVALS    ',T29,2('!',4X,5I8,4X),T127,'!'
  13120      $    /' !',T29,'!',T78,'!',T127,'!',
  13121      $    /' !   CLOUDY -      (J/M/P/R)',T29,'!',T78,'!',T127,'!'
  13122      $    /' !     RADIANCES/SOUNDINGS  ',T29,2('!',4X,5I8,4X),T127,'!'
  13123      $    /' !     PWATER RETRIEVALS    ',T29,2('!',4X,5I8,4X),T127,'!'
  13124      $    /' !',T29,'!',T78,'!',T127,'!',
  13125      $    /' !   UNKNOWN -     (K/N/S/T)',T29,'!',T78,'!',T127,'!'
  13126      $    /' !     CLOUD TOP RETRIEVALS ',T29,2('!',4X,5I8,4X),T127,'!')
  13127          PRINT 406,(((KEPOB(ILAT,1,ILS,ITP),ILAT=1,5),
  13128      $                                       ILS=1,2),ITP=2,3),
  13129      $             (((KEPOB(ILAT,3,ILS,ITP),ILAT=1,5),
  13130      $                                       ILS=1,2),ITP=2,3),
  13131      $             (((KEPOB(ILAT,4,ILS,ITP),ILAT=1,5),
  13132      $                                       ILS=1,2),ITP=4,4)
  13133   406    FORMAT(1X,126('.')
  13134      $    /' !',T29,'!',T78,'!',T127,'!'
  13135      $    /' ! KEPT -                   ',T29,'!',T78,'!',T127,'!'
  13136      $    /' !   CLEAR -       (I/L/O/Q)',T29,'!',T78,'!',T127,'!'
  13137      $    /' !     RADIANCES/SOUNDINGS  ',T29,2('!',4X,5I8,4X),T127,'!'
  13138      $    /' !     PWATER RETRIEVALS    ',T29,2('!',4X,5I8,4X),T127,'!'
  13139      $    /' !',T29,'!',T78,'!',T127,'!',
  13140      $    /' !   CLOUDY -      (J/M/P/R)',T29,'!',T78,'!',T127,'!'
  13141      $    /' !     RADIANCES/SOUNDINGS  ',T29,2('!',4X,5I8,4X),T127,'!'
  13142      $    /' !     PWATER RETRIEVALS    ',T29,2('!',4X,5I8,4X),T127,'!'
  13143      $    /' !',T29,'!',T78,'!',T127,'!',
  13144      $    /' !   UNKNOWN -     (K/N/S/T)',T29,'!',T78,'!',T127,'!'
  13145      $    /' !     CLOUD TOP RETRIEVALS ',T29,2('!',4X,5I8,4X),T127,'!')
  13146          PRINT 407, (((MSTOB(ILAT,1,ILS,ITP),ILAT=1,5),
  13147      $                                        ILS=1,2),ITP=2,2),
  13148      $              (((MSTOB(ILAT,3,ILS,ITP),ILAT=1,5),
  13149      $                                        ILS=1,2),ITP=2,2)
  13150   407    FORMAT(1X,126('.')
  13151      $    /' !',T29,'!',T78,'!',T127,'!'
  13152      $    /' ! KEPT MOISTURE -          ',T29,'!',T78,'!',T127,'!'
  13153      $    /' !   CLEAR -       (I/L/O/Q)',T29,'!',T78,'!',T127,'!'
  13154      $    /' !     SOUNDINGS            ',T29,2('!',4X,5I8,4X),T127,'!'
  13155      $    /' !',T29,'!',T78,'!',T127,'!',
  13156      $    /' !   CLOUDY -      (J/M/P/R)',T29,'!',T78,'!',T127,'!'
  13157      $    /' !     SOUNDINGS            ',T29,2('!',4X,5I8,4X),T127,'!'
  13158      $    /1X,126('_')//)
  13159 
  13160       END IF
  13161       RETURN
  13162       END

Page 311         Source Listing                  SNDTBL
2017-04-18 11:09 Entry Points                    prepdata.f



ENTRY POINTS

  Name               
                     
 sndtbl_             


SYMBOL CROSS REFERENCE

 Name                       Object Declared Type            Bytes Dimen Elements Attributes       References                        
                                                                                                                                    
 101                        Label  12921                                                          12920                             
 102                        Label  12924                                                          12923                             
 103                        Label  12927                                                          12926,13016                       
 105                        Label  12935                                                          12934                             
 106                        Label  12942                                                          12941,13026                       
 115                        Label  13018                                                          13017                             
 201                        Label  12951                                                          12944                             
 202                        Label  12973                                                          12969                             
 203                        Label  12980                                                          12979                             
 204                        Label  12991                                                          12987                             
 205                        Label  12998                                                          12996                             
 206                        Label  13005                                                          13003                             
 401                        Label  13035                                                          13028                             
 402                        Label  13013                                                          13012                             
 403                        Label  13076                                                          13067                             
 404                        Label  13092                                                          13091                             
 405                        Label  13114                                                          13099                             
 406                        Label  13133                                                          13127                             
 407                        Label  13150                                                          13146                             
 ADP                        Common 12908                                14100                                                       
 CABEL                      Local  12906    CHAR            6     1     4                         12915,13028                       
 CCAP_1                     Local  12904    CHAR            3     1     3                         12916,13067                       
 CCAP_3                     Local  12904    CHAR            3     1     3                         12917,13070                       
 CCAP_4                     Local  12904    CHAR            3     1     3                         12918,13073                       
 CSATEL                     Local  12905    CHAR            5     1     4                         12914,12920,12923                 
 GOESCT                     Scalar 12911    R(4)            4     1     2        COM                                                
 GOESND                     Scalar 12911    R(4)            4     1     2        COM                                                
 GOESPW                     Scalar 12911    R(4)            4     1     2        COM                                                
 GOSWCH                     Common 12911                                100                                                         
 IDSAT                      Dummy  12901    I(4)            4     1     4        ARG,INOUT        12923,13012                       
 II                         Local  13027    I(4)            4           scalar                    13027,13028,13029,13030,13031,1303
                                                                                                  2,13033,13034,13067,13069,13070,13
                                                                                                  072,13073,13075                   
 ILAT                       Local  12945    I(4)            4           scalar                    12945,12946,12947,12948,12949,1295
                                                                                                  0,12969,12970,12971,12972,12987,12
                                                                                                  988,12989,12990,12996,12997,13003,
                                                                                                  13004,13029,13030,13031,13032,1303
                                                                                                  3,13034,13067,13068,13070,13071,13
                                                                                                  073,13074,13099,13100,13101,13102,
                                                                                                  13104,13105,13106,13107,13109,1311
                                                                                                  0,13111,13112,13127,13129,13131,13
                                                                                                  146,13148                         
 ILS                        Local  12987    I(4)            4           scalar                    12987,12988,12989,12990,12996,1299
                                                                                                  7,13003,13004,13099,13100,13101,13

Page 312         Source Listing                  SNDTBL
2017-04-18 11:09 Symbol Table                    prepdata.f

 Name                       Object Declared Type            Bytes Dimen Elements Attributes       References                        
                                                                                                                                    
                                                                                                  102,13103,13104,13105,13106,13107,
                                                                                                  13108,13109,13110,13111,13112,1311
                                                                                                  3,13127,13128,13129,13130,13131,13
                                                                                                  132,13146,13147,13148,13149       
 IPRINT                     Scalar 12908    I(4)            4           scalar   COM                                                
 IRTRV                      Scalar 12909    I(4)            4     3     80       COM              12947,13031                       
 ISAT                       Local  12945    I(4)            4           scalar                    12945,12946,12947,12948,12949,1295
                                                                                                  0,12969,12970,12971,12972,13029,13
                                                                                                  030,13031,13032,13033,13034,13067,
                                                                                                  13068,13069,13070,13071,13072,1307
                                                                                                  3,13074,13075                     
 ISATLS                     Scalar 12910    I(4)            4     3     80       COM              12946,13030                       
 ISATOB                     Scalar 12908    I(4)            4           scalar   COM              12922                             
 ITP                        Local  13029    I(4)            4           scalar                    13029,13030,13031,13032,13033,1303
                                                                                                  4,13067,13068,13069,13070,13071,13
                                                                                                  072,13073,13074,13075,13099,13100,
                                                                                                  13101,13102,13103,13104,13105,1310
                                                                                                  6,13107,13108,13109,13110,13111,13
                                                                                                  112,13113,13127,13128,13129,13130,
                                                                                                  13131,13132,13146,13147,13148,1314
                                                                                                  9                                 
 IWINDO_E                   Scalar 12909    I(4)            4     3     80       COM              12949,13033                       
 IWINDO_L                   Scalar 12910    I(4)            4     3     80       COM              12950,13034                       
 KBDYGI                     Scalar 12912    I(4)            4           scalar   COM                                                
 KEPOB                      Dummy  12901    I(4)            4     4     160      ARG,INOUT        12996,12997,13127,13129,13131     
 KLNDGI                     Scalar 12912    I(4)            4     1     3        COM                                                
 KMSGGI                     Scalar 12912    I(4)            4           scalar   COM                                                
 KNDCGI                     Scalar 12912    I(4)            4           scalar   COM                                                
 KNOCTP                     Scalar 12913    I(4)            4           scalar   COM                                                
 KNOPGI                     Scalar 12912    I(4)            4           scalar   COM                                                
 KNTGIC                     Scalar 12913    I(4)            4           scalar   COM                                                
 KNTGIP                     Scalar 12911    I(4)            4           scalar   COM                                                
 KNTGIS                     Scalar 12911    I(4)            4           scalar   COM                                                
 KNTGIT                     Scalar 12911    I(4)            4           scalar   COM                                                
 KSEAGI                     Scalar 12912    I(4)            4     1     3        COM                                                
 KSKPGI                     Scalar 12912    I(4)            4           scalar   COM                                                
 KTIMGI                     Scalar 12912    I(4)            4     1     3        COM                                                
 KTOP                       Scalar 12909    I(4)            4     3     80       COM              12948,13032                       
 MAXOBS                     Param  12902    I(4)            4           scalar                    12908                             
 MIN                        Func   12919                                scalar                    12919                             
 MSTOB                      Dummy  12901    I(4)            4     4     160      ARG,INOUT        13003,13004,13146,13148           
 NN                         Dummy  12901    I(4)            4           scalar   ARG,INOUT        12919,12920,12923                 
 NUMOB                      Dummy  12901    I(4)            4     5     640      ARG,INOUT        12969,12970,12971,12972,12987,1298
                                                                                                  8,12989,12990,13067,13068,13070,13
                                                                                                  071,13073,13074,13099,13100,13101,
                                                                                                  13102,13104,13105,13106,13107,1310
                                                                                                  9,13110,13111,13112               
 PHI                        Scalar 12909    R(4)            4     1     6        COM              12944,12979,13028,13091           
 PMAND                      Scalar 12908    R(4)            4     1     23       COM                                                
 RDATA                      Scalar 12908    R(4)            4     1     3500     COM                                                
 SATMST                     Scalar 12903    L(4)            4     3     80       COM              12945,13029                       
 SATSW2                     Common 12909                                1944                                                        
 SNDTBL                     Subr   12901                                                                                            

Page 313         Source Listing                  SNDTBL
2017-04-18 11:09                                 prepdata.f

  13163 C$$$  SUBPROGRAM DOCUMENTATION BLOCK
  13164 C
  13165 C SUBPROGRAM:    SNDPRP
  13166 C   PRGMMR: D. A. KEYSER     ORG: NP22       DATE: 1998-06-15
  13167 C
  13168 C ABSTtACT: PREPROCESSES RTOVS OR ATOVS SATELLITE RETRIEVALS
  13169 C   ORIGINALLY UNPACKED IN NMCEDS FORMAT.  SETS UP VALUES FOR REPORT
  13170 C   TYPE IN HDR(6) AND COMPUTES THICKNESS RELATIVE TO 1000 MB HEIGHT.
  13171 C   FINALLY, CALLS SUBROUTINE 'GETUPA' TO BEGIN PROCESSING REPORT.
  13172 C
  13173 C PROGRAM HISTORY LOG:
  13174 C   UNKNOWN
  13175 C 1987-06-14  D. A. KEYSER -- ADDED CAPABILITY TO PROCESS DMSP AND VAS;
  13176 C     OLD SUBR. TIREPT RENAMED; OLD SUBR. TIRPT REMOVED
  13177 C 1988-04-11  D. A. KEYSER -- DOCBLOCKING/COMMENTING
  13178 C 1988-08-24  D. A. KEYSER -- CHGED OI R.T. 'OTHER' TOVS RETR TO 160,170
  13179 C 1990-01-11  D. A. KEYSER -- CONVERTED TO VS FORTRAN(77) & RESTRUCTURED
  13180 C 1993-05-31  D. A. KEYSER -- "KMAX" NOW APPLIES TO ALL VARIABLES AND
  13181 C     TO MAND. AND SIGNIF. LVLS FOR ALL SAT. RETR. TYPES; REDEFINED
  13182 C     OI/SSI REPORT TYPES FOR SATELLITE RETRIEVALS
  13183 C 1995-07-12  D. A. KEYSER -- REMOVED LOGIC TO PROCESS VAS RETRIEVALS
  13184 C 1998-06-15  D. A. KEYSER -- REMOVED ALL LOGIC PERTAINING TO TOVS
  13185 C     PROCESSING
  13186 C
  13187 C USAGE:    CALL SNDPRP(MS,INSTR,MSTSAT,MST,KEP)
  13188 C   INPUT ARGUMENT LIST:
  13189 C     MS       - OVERLAND (=1), OCEANIC (=2) SWITCH
  13190 C     INSTR    - RETRIEVAL INSTRUMENT TYPE (PATH) SWITCH
  13191 C              - (EITHER 1 OR 3)
  13192 C     MSTSAT   - LOGICAL SWITCH TO PROCESS MOISTURE (IF = TRUE)
  13193 C
  13194 C   OUTPUT ARGUMENT LIST:
  13195 C     MST      - SWITCH IF MOISTURE WAS PROCESSED (=1, OTHERWISE =0)
  13196 C     KEP      - SWITCH IF REPORT IS TO BE KEPT (=1, OTHERWISE =0)
  13197 C
  13198 C REMARKS: CALLED BY SUBROUTINE 'SATEDS'.
  13199 C
  13200 C ATTRIBUTES:
  13201 C   LANGUAGE: FORTRAN 90
  13202 C   MACHINE:  NCEP WCOSS
  13203 C
  13204 C$$$
  13205       SUBROUTINE SNDPRP(MS,INSTR,MSTSAT,MST,KEP)
  13206       PARAMETER (MXWRDH = 15)
  13207       PARAMETER (MAXOBS = 3500)
  13208       LOGICAL  MSTSAT
  13209       CHARACTER*8  STNID,SUBSET_d
  13210       INTEGER  IDATA(MAXOBS)
  13211       real(8)  alon_8,alat_8
  13212       COMMON/ADP/ISATOB,PMAND(23),RDATA(MAXOBS),IPRINT
  13213       COMMON/RPTHDR/SUBSET_d,STNID,HDR(2:MXWRDH),alon_8,alat_8
  13214       COMMON/UPALIM/LEVPM,LEVST,LEVQQ,TDLIM,TDMAX,SPCIAL,ISQNUM_UPA
  13215       EQUIVALENCE  (IDATA,RDATA)
  13216       DATA  XMISS/99999./,YMISS/99998.8/
  13217       MST = 0
  13218 C IDENTIFY PROPER PREPBUFR REPORT TYPE FOR RTOVS OR ATOVS
  13219 C  RETRIEVALS....

Page 314         Source Listing                  SNDPRP
2017-04-18 11:09                                 prepdata.f

  13220 C    OCEANIC  ---> 171 (CLEAR), 173 (CLOUDY)
  13221 C    OVERLAND ---> 161 (CLEAR), 163 (CLOUDY)
  13222 C ALL RETRIEVAL TYPES CONTAIN ONLY CATEGORY 1 (MANDATORY LEVEL) INFO.
  13223       IDATA(15) = 0
  13224       IDATA(17) = 0
  13225       IDATA(19) = 0
  13226       IDATA(21) = 0
  13227       HDR(6) = 160 + (10 * (MS - 1)) + INSTR
  13228 C LEVPM NO LARGER THAN NUMBER OF MAND. LVLS; RESET LEVST & LEVQQ = LEVPM
  13229       LEVPM = MIN(LEVPM,IDATA(13))
  13230       LEVST = LEVPM
  13231       LEVQQ = LEVPM
  13232       L1 = IDATA(14)
  13233       Z1000 = RDATA(L1+1)
  13234       DO K = 1,LEVPM
  13235          L = (11 * (K - 1)) + IDATA(14)
  13236 C HEIGHT IS CONVERTED TO THICKNESS RELATIVE TO 1000 MB HEIGHT
  13237          IF(MAX(Z1000,RDATA(L+1)).LT.YMISS.AND.Z1000.NE.0.)
  13238      $    RDATA(L+1) = RDATA(L+1) - Z1000
  13239 C CHECK FOR VALID MOISTURE DATA FOR SETTING SWITCH FOR TABLE
  13240          IF(.NOT.MSTSAT)  RDATA(L+3) = XMISS
  13241          IF(RDATA(L+3).LT.YMISS.AND.RDATA(L+3).GE.0)  MST = 1
  13242          RDATA(L+4) = XMISS
  13243          RDATA(L+5) = XMISS
  13244       ENDDO
  13245 C CALL SUBR. GETUPA TO PROCESS THE RTOVS OR ATOVS SATELLITE RETRIEVAL
  13246       CALL GETUPA(*30,*25)


ENTRY POINTS

  Name               
                     
 sndprp_             

Page 315         Source Listing                  SNDPRP
2017-04-18 11:09 Symbol Table                    prepdata.f



SYMBOL CROSS REFERENCE

 Name                       Object Declared Type            Bytes Dimen Elements Attributes       References                        
                                                                                                                                    
 25                         Label  13250                                                          13246                             
 30                         Label  13247                                                          13246                             
 ADP                        Common 13212                                14100                                                       
 ALAT_8                     Scalar 13211    R(8)            8           scalar   COM                                                
 ALON_8                     Scalar 13211    R(8)            8           scalar   COM                                                
 GETUPA                     Subr   13246                                                          13246                             
 HDR                        Scalar 13213    R(4)            4     1     14       COM              13227                             
 IDATA                      Scalar 13210    I(4)            4     1     3500     COM              13223,13224,13225,13226,13229,1323
                                                                                                  2,13235                           
 INSTR                      Dummy  13205    I(4)            4           scalar   ARG,INOUT        13227                             
 IPRINT                     Scalar 13212    I(4)            4           scalar   COM                                                
 ISATOB                     Scalar 13212    I(4)            4           scalar   COM                                                
 ISQNUM_UPA                 Scalar 13214    I(4)            4           scalar   COM                                                
 K                          Local  13234    I(4)            4           scalar                    13234,13235                       
 KEP                        Dummy  13205    I(4)            4           scalar   ARG,INOUT        13248,13251                       
 L                          Local  13235    I(4)            4           scalar                    13235,13237,13238,13240,13241,1324
                                                                                                  2,13243                           
 L1                         Local  13232    I(4)            4           scalar                    13232,13233                       
 LEVPM                      Scalar 13214    I(4)            4           scalar   COM              13229,13230,13231,13234           
 LEVQQ                      Scalar 13214    I(4)            4           scalar   COM              13231                             
 LEVST                      Scalar 13214    I(4)            4           scalar   COM              13230                             
 MAX                        Func   13237                                scalar                    13237                             
 MAXOBS                     Param  13207    I(4)            4           scalar                    13210,13212                       
 MIN                        Func   13229                                scalar                    13229                             
 MS                         Dummy  13205    I(4)            4           scalar   ARG,INOUT        13227                             
 MST                        Dummy  13205    I(4)            4           scalar   ARG,INOUT        13217,13241,13252                 
 MSTSAT                     Dummy  13205    L(4)            4           scalar   ARG,INOUT        13240                             
 MXWRDH                     Param  13206    I(4)            4           scalar                    13213                             
 PMAND                      Scalar 13212    R(4)            4     1     23       COM                                                
 RDATA                      Scalar 13212    R(4)            4     1     3500     COM              13233,13237,13238,13240,13241,1324
                                                                                                  2,13243                           
 RPTHDR                     Common 13213                                88                                                          
 SNDPRP                     Subr   13205                                                                                            
 SPCIAL                     Scalar 13214    R(4)            4           scalar   COM                                                
 STNID                      Scalar 13209    CHAR            8           scalar   COM                                                
 SUBSET_D                   Scalar 13209    CHAR            8           scalar   COM                                                
 TDLIM                      Scalar 13214    R(4)            4           scalar   COM                                                
 TDMAX                      Scalar 13214    R(4)            4           scalar   COM                                                
 UPALIM                     Common 13214                                28                                                          
 XMISS                      Local  13216    R(4)            4           scalar                    13216,13240,13242,13243           
 YMISS                      Local  13216    R(4)            4           scalar                    13216,13237,13241                 
 Z1000                      Local  13233    R(4)            4           scalar                    13233,13237,13238                 

Page 316         Source Listing                  SNDPRP
2017-04-18 11:09                                 prepdata.f

  13247    30 CONTINUE
  13248       KEP = 1
  13249       RETURN
  13250    25 CONTINUE
  13251       KEP = 0
  13252       MST = 0
  13253       RETURN
  13254       END
  13255 C$$$  SUBPROGRAM DOCUMENTATION BLOCK
  13256 C
  13257 C SUBPROGRAM:    SATBFR
  13258 C   PRGMMR: D. A. KEYSER     ORG: NP22       DATE: 2001-10-10
  13259 C
  13260 C ABSTRACT: DECODES RADIANCES AND/OR 40-LEVEL RETRIEVALS FROM
  13261 C   INPUT RTOVS AND ATOVS BUFR DATA DUMP FILES, PROCESSING ONE REPORT
  13262 C   AT A TIME.  PERFORMS SEVERAL CHECKS ON THE DATA, AND ACCUMULATES
  13263 C   COUNTS FOR VALID REPORTS BEFORE CALLING SUBROUTINES TO ACTUALLY
  13264 C   PROCESS REPORTS INTO THE REQUESTED OUTPUT FORMAT.
  13265 C
  13266 C PROGRAM HISTORY LOG:
  13267 C   UNKNOWN
  13268 C 1993-05-31  D. A. KEYSER -- ORIGINAL AUTHOR
  13269 C 1993-11-02  D. A. KEYSER -- VARIABLE IFLUA WHEN SET TO 1 WILL FLAG
  13270 C     ALL VARIABLES WITH PREPBUFR T. VAL=15; CAN NOW PROCESS MIXTURE OF
  13271 C     NESDIS 40LVL & NMC I/A RETR.
  13272 C 1993-12-21  D. A. KEYSER -- ONLY TOVS I/A RETR. SET ELEV TO HGHT OF
  13273 C     1ST (SFC) LVL & ONLY TOVS I/A RETR. SET PSTN (1ST LVL) TO PBOT
  13274 C     VALUE RETURNED FROM W3FI80, NESDIS 40-LVL RETR. CAN'T GET A PSTN
  13275 C 1996-09-03  D. A. KEYSER -- PROCESSING OF TOVS RADIANCES PARTIALLY
  13276 C     DONE (SWITCH "TOVRAD")
  13277 C 1996-10-24  D. A. KEYSER -- LOGIC ADDED TO PROCESS TOVS RADIANCES
  13278 C     FROM BUFR DUMP FILE AND ENCODE THEM INTO PREPBUFR FILE, CALL TO
  13279 C     W3FI80 REPLACED BY W3TOVUNP, N-LIST SWITCHES "TOVRAD" AND
  13280 C     "TOVRTV" ADDED TO PROCESS RADIANCES AND RETRIEVALS RESP.; LOGIC
  13281 C     RELATED TO INTERACTIVE RETR. PROCESSING REMOVED; ADDED CALL TO
  13282 C     BUFRLIB "DATEBF" TO RETURN CENTER DATE FOR TOVS BUFR DATA DUMP
  13283 C     FILES (SIMPLIFIES OTHER TIME-CHECKING PROCEDURES)
  13284 C 1997-05-01  D. A. KEYSER -- EST. REASON CODES FOR UPPER-AIR DATA
  13285 C     TYPES (CURRENTLY JUST 100); STDOUT EXPANDED TO INCL. REASON CODES
  13286 C 1998-05-15  D. A. KEYSER -- ADDED PROCESSING OF RTOVS DATA BASED ON
  13287 C     NEW NAMELIST SWITCH "RTOVS", NEW IN-LINE ROUTINE W3RTVUNP ADDED
  13288 C     FOR INTERFACE WITH RTOVS DATA RETURNING 40-LVL/RADIANCES
  13289 C 1998-06-15  D. A. KEYSER -- REMOVED ALL LOGIC PERTAINING TO TOVS
  13290 C     PROCESSING (SUBR. 'TOVSID' & 'TDEW' NO LONGER CALLED - REMOVED,
  13291 C     N-LIST SWITCH 'RTOVS' REMOVED; N*/PTLY-CLDY PATH NO LONGER
  13292 C     POSSIBLE); RTOVS 250KM SUB-SAMPLING NOW DEPENDS UPON VALUE IN
  13293 C     FILTER FLAG AS WAS THE CASE FOR TOVS (FIX BY NESDIS) (BEFORE
  13294 C     250KM SUB-SAMPLING WAS EST. BY PROCESSING EVERY 4'TH RTOVS REPORT)
  13295 C 1999-01-20  D. A. KEYSER -- REPL. N-LIST SWITCH "SATLND" WITH NEW
  13296 C     SWITCHES "ISATLS" AND "JSATLS" TO HANDLE LAND/SEA SELECTION FOR
  13297 C     SATELLITE SNDGS/RADIANCES AND GOES PW RETR. SEPARATELY (ALSO CAN
  13298 C     NOW SELECT JUST LAND AS WELL AS JUST SEA OR EVERYWHERE)
  13299 C 2000-02-17  D. A. KEYSER -- SUBR. W3RTVUNP RENAMED TO W3RTOVSUNP; CAN
  13300 C     NOW PROCESS ATOVS DATA VIA NEW SUBR. W3ATOVSUNP (40-LVL/35
  13301 C     RADIANCES); IF FILTER FLAG=-99 AND TR80KM=F, PROCESS ONLY EVERY
  13302 C     4'TH UNPACKED RTOVS RETRIEVAL TO SIMULATE 250 KM SUB-SAMPLING
  13303 C     (RTOVS DUMP FILE PRIOR TO 7/1/1998 - NO FILTER FLAG INFORMATION

Page 317         Source Listing                  SNDPRP
2017-04-18 11:09                                 prepdata.f

  13304 C     AVAILABLE - NEEDED FOR HISTORICAL CDAS RUNS)
  13305 C 2001-04-06  D. A. KEYSER -- SUBR. "RPTLBL" NOW HAS INPUT ARGS.
  13306 C     "TIMWIN_e" (EARLIEST TIME WINDOW) AND "TIMWIN_l" (LATEST TIME
  13307 C     WINDOW) REPL. "TIMWIN" (+/- TIME WINDOW) ("-" PRIOR TO CYCLE
  13308 C     TIME, "+" AFTER CYCLE TIME), ALLOWS THE 2 TO BE DIFFERENT
  13309 C 2001-06-19  D. A. KEYSER -- NEW SUBR. "TIMCHK" DOES TIME WINDOW CHECK
  13310 C     SEPARATE FROM "RPTLBL"; N-LIST SWITCHES "IWINDO", "SATMST",
  13311 C     "ISATLS", "IRTRV" AND "KTOP" NOW MORE SPECIFIC TO POINT TO PAIRS
  13312 C     OF EVEN OR ODD GOES SATS. (NOT USEFUL HERE) AND TO THE 4 POSSIBLE
  13313 C     REPORT TYPES THAT CAN BE GENERATED FROM RTOVS/ ATOVS AND GOES
  13314 C     SNDG/RAD/RETR. DATA
  13315 C 2001-08-01  D. A. KEYSER -- N-LIST SWITCH IWINDO SPLIT INTO IWINDO_e
  13316 C     (EARLIEST TIME WINDOW) AND IWINDO_l (LATEST TIME WINDOW) FOR
  13317 C     SATELLITE SOUNDING/RETRIEVAL/RADIANCE REPORTS ("-" PRIOR TO CYCLE
  13318 C     TIME, "+" AFTER CYCLE TIME) (SAME DEFAULTS AS BEFORE); IN
  13319 C     RESPONSE TO CHANGE TO SUBR. W3ATOVSUNP, NOW PASSES IER=0 INTO
  13320 C     SUBR. UPON FIRST CALL FOR ATOVS DATA (SIGNALS INPUT BUFR FILE
  13321 C     IS A DATA DUMP)
  13322 C 2001-10-10  D. A. KEYSER -- STORES BUFR SATELLITE ID IN UNPACKED
  13323 C     IW3UNPBF WORD 6 SO IT CAN LATER BE ENCODED INTO PREPBUFR FILE
  13324 C
  13325 C USAGE:    CALL SATBFR
  13326 C   INPUT FILES:
  13327 C     UNIT GG   - RTOVS BUFR DATA FILE (SOUNDINGS/RETRIEVALS/RADIANCES)
  13328 C     UNIT GG+1 - ATOVS BUFR DATA FILE (SOUNDINGS/RETRIEVALS/RADIANCES)
  13329 C    (WHERE GG IS UNIT NUMBER DEFINED AS IUNIT(7) IN NAMELIST "&PARM")
  13330 C
  13331 C   OUTPUT FILES:
  13332 C     UNIT 06  - STANDARD OUTPUT PRINT
  13333 C
  13334 C REMARKS: CALLED BY SUBROUTINE 'PREP'.  FOR PROCESSING OF RTOVS OR
  13335 C   ATOVS DATA RETURNED IN UNPACKED NMCEDS FORMAT, SEE SUBROUTINE
  13336 C   SATEDS.
  13337 C
  13338 C ATTRIBUTES:
  13339 C   LANGUAGE: FORTRAN 90
  13340 C   MACHINE:  NCEP WCOSS
  13341 C
  13342 C$$$
  13343       SUBROUTINE SATBFR
  13344 CCC
  13345 C  SATELLITE AND PATH (INSTR.) INDICATED BY  CHARACTER 8 OF STN. ID
  13346 C  SAT. NO. DESIG'N: ODD1  - 3,7,11,15,19,...; ODD2  - 1,5, 9,13,17,...
  13347 C                    EVEN1 - 2,6,10,14,18,...; EVEN2 - 4,8,12,16,20,...
  13348 C          SUFFIX A,E ---> CLEAR  PATH FROM ODD1  (A) OR ODD2  (E) SAT.
  13349 C          SUFFIX S,W ---> CLEAR  PATH FROM EVEN1 (S) OR EVEN2 (W) SAT.
  13350 C          SUFFIX C,G ---> CLOUDY PATH FROM ODD1  (C) OR ODD2  (G) SAT.
  13351 C          SUFFIX U,Y ---> CLOUDY PATH FROM EVEN1 (U) OR EVEN2 (Y) SAT.
  13352 C
  13353 C  RTOVS VS. ATOVS INDICATED BY CHARACTER 7 OF STN. ID ("R" OR "A")
  13354 C
  13355 CCC
  13356       PARAMETER (MXWRDH = 15)
  13357       PARAMETER (MXLVL = 600)
  13358       PARAMETER (NUMVAR = 6, NUMQMS = 5)
  13359       PARAMETER (NUMDAT = NUMVAR + (2 * NUMQMS))
  13360       PARAMETER (MXBLVL = 255)

Page 318         Source Listing                  SATBFR
2017-04-18 11:09                                 prepdata.f

  13361       PARAMETER (MAXOBS = 3500)
  13362       PARAMETER (NUMOBS2 = 43)
  13363       CHARACTER*4  SAMPLE(2)
  13364       CHARACTER*5  CTYPE(2)
  13365       CHARACTER*8  STNID,STNPRT,DSNAME,SUBSET_d
  13366       LOGICAL  TR80KM,SATMST,TOVRAD,TOVRTV,TOVBFR
  13367       INTEGER  NUMOB(5,4,2,4,4),KEPOB(5,4,2,4),MSTOB(5,4,2,4),JRTRV(3),
  13368      $ IPRT(2),IQ(MXLVL,NUMQMS),JQ(MXLVL,NUMQMS),IDATA(MAXOBS),
  13369      $ IR(MXLVL,NUMQMS),JR(MXLVL,NUMQMS),KSATOB(11),IRTCHN(35),IDSAT(4),
  13370      $ ISAMPLE(2)
  13371       INTEGER(8) IDSDMP_8
  13372       REAL  PP(MXLVL),ZP(MXLVL),TP(MXLVL),QP(MXLVL),TMP(MXLVL,NUMDAT),
  13373      $ CLAL(MXLVL),CLAM(MXLVL),RSATOB(17)
  13374       REAL(8)  BMISS,obs8_8,alon_8,alat_8
  13375       COMMON/UNITNO/NFILE,IUNIT(28)
  13376       COMMON/ADP/ISATOB,PMAND(23),RDATA(MAXOBS),IPRINT
  13377       COMMON/TVSWCH/TOVEDS(2),TOVBFR(2),TR80KM,KNTTOV(2),
  13378      $ KSKPTV(2),KNOPTV(2),KIPTTV(2),KMSGTV(2),KBDYTV(2),KTIMTV(2),
  13379      $ KLNDTV(2),KSEATV(2),KREDTV(2),KJFLAG(2)
  13380       COMMON/SATSW2/PHI(6),IRTRV(5,4,4),KTOP(5,4,4),IWINDO_e(5,4,4),
  13381      $ IWINDO_l(5,4,4),SATMST(5,4,4),ISATLS(5,4,4)
  13382       COMMON/DATA/KOUNT,IDATE(4),IDAT10,MP_PROCESS,WRMISS
  13383       COMMON/RPTHDR/SUBSET_d,STNID,HDR(2:MXWRDH),alon_8,alat_8
  13384       COMMON/SNDATA/DAT(MXLVL,NUMDAT)
  13385       COMMON/PARM6/MODPRT,IFLUA,STNPRT(3)
  13386       COMMON/RADANC/RTRAD(35),GRAD(18),IGCHN(18),SOZANG,SAZANG,OZONE,
  13387      $ SKINT,CLDAMT,TOVRAD,TOVRTV,GOESRD(2)
  13388       COMMON/DIRECT/OBS3(5,MXBLVL,7),OBS2(NUMOBS2),NOBS3(7),RDATA2(25),
  13389      $ obs8_8(2)
  13390       COMMON /BUFRLIB_MISSING/BMISS
  13391       EQUIVALENCE (DAT,PP),(DAT(1,2),ZP),(DAT(1,3),TP),(DAT(1,4),QP),
  13392      $ (DAT(1,NUMVAR+1),IQ),(TMP(1,NUMVAR+1),JQ),(RDATA,IDATA)
  13393       EQUIVALENCE(DAT(1,NUMVAR+NUMQMS+1),IR),(TMP(1,NUMVAR+NUMQMS+1),JR)
  13394       DATA  XMISS/99999./,JRTRV/272,99999,544/,CTYPE/'RTOVS','ATOVS'/,
  13395      $ MFIRST/0/,SAMPLE/' 4TH','11TH'/,ISAMPLE/4,11/,IMISS/99999/,
  13396      $ YMISS/99998.8/
  13397       NN = 1
  13398   700 CONTINUE
  13399 C KOUNT COUNTS NO. OF REPORTS UNPACKED (& NOT SKIPPED) FROM FILE
  13400       KOUNT = 0
  13401 C NN WILL INDICATE WHICH FILE IS BEING EXAMINED:
  13402 C    NN = 1 ===> RTOVS
  13403 C    NN = 2 ===> ATOVS
  13404       IF(.NOT.TOVBFR(NN))  GO TO 110
  13405 C INITIALIZE NUMOB, KEPOB, AND MSTOB ARRAYS
  13406       NUMOB = 0
  13407       KEPOB = 0
  13408       MSTOB = 0
  13409       IDSAT = 0
  13410       NFILE = IUNIT(7) + NN - 1
  13411       PRINT 9013, CTYPE(NN),NFILE
  13412  9013 FORMAT(//28X,'***** ',A5,' SATELLITE RADIANCE/40-LEVEL ',
  13413      $ 'RETRIEVAL FILE    UNIT =',I4,' *****')
  13414       PRINT 550, IDATE
  13415   550 FORMAT(25X,'LOOKING FOR FILE WITH CENTER DATE: ',2X,I4.4,
  13416      $ 2('-',I2.2),1X,I2.2,'Z  BASED ON PRODUCTION DATE')
  13417       IF(.NOT.TR80KM)  THEN

Page 319         Source Listing                  SATBFR
2017-04-18 11:09                                 prepdata.f

  13418          PRINT 581
  13419   581    FORMAT(/27X,'-->  ORIGINAL FULL RESOLUTION REPORTS ARE ',
  13420      $    'FILTERED TO 250 KM RESOLUTION  <--'/)
  13421       ELSE
  13422          PRINT 583
  13423   583    FORMAT(/37X,'-->  ALL REPORTS (AT FULL RESOLUTION) ARE ',
  13424      $    'PROCESSED  <--'/)
  13425       END IF
  13426 C KNTRPT WILL COUNT NUMBER OF RPTS SUCCESSFULLY DECODED FOR EACH FILE
  13427       KNTRPT = 0
  13428 C INITIALIZE RTRAD, DAT, CLAL & CLAM ARRAYS {ONLY NEED TO DO THIS PRIOR
  13429 C  TO 1ST CALL TO W3RTOVSUNP/W3ATOVSUNP SINCE THESE SUBR. WILL ALWAYS
  13430 C  INITALIZE 1ST 40 WORDS IN THESE ARRAYS (IF APPLICABLE TO SUBROUTINE)
  13431 C  PRIOR TO DECODING EACH RETRIEVAL}
  13432       RTRAD = XMISS
  13433       DAT   = XMISS
  13434       CLAL  = XMISS
  13435       CLAM  = XMISS
  13436 C FOR ATOVS REPORTS, SET IER TO 0 TO INDICATE TO W3ATOVSUNP THAT INPUT
  13437 C  BUFR FILE IS A DATA DUMP
  13438       IF(NN.EQ.2)  IER   = 0
  13439       GO TO 1400
  13440 C#######################################################################
  13441 C#######################################################################
  13442  1410 CONTINUE
  13443 C KSKPTV WILL COUNT NO. OF DECODED REPORTS SKIPPED (VARIOUS REASONS)
  13444       KSKPTV(NN) = KSKPTV(NN) + 1
  13445  1400 CONTINUE
  13446 C INITIALIZE IQ, TMP AND JQ ARRAYS PRIOR TO EACH CALL
  13447       IQ  = 16
  13448       TMP = XMISS
  13449       JQ  = 16
  13450 C INITIALIZE ALL REASON CODES AS 100 (ORIGINAL DATA) PRIOR TO EACH CALL
  13451       IR = 100
  13452       JR = 100
  13453       OBS2   = BMISS  ! initialize obs2   array before reading any rpts
  13454       OBS3   = BMISS  ! initialize obs3   array before reading any rpts
  13455       NOBS3  = 0      ! initialize nobs3  array before reading any rpts
  13456       obs8_8 = bmiss  ! initialize obs8_8 array before reading any rpts
  13457       RDATA2 = BMISS  ! initialize rdata2 array before reading any rpts
  13458       IF(NN.EQ.1)  THEN
  13459 C ATTEMPT TO DECODE THE NEXT RTOVS REPORT
  13460          CALL W3RTOVSUNP(NFILE,IDATEM,PP,TP,QP,CLAL,CLAM,NLVL,IRTCHN,
  13461      $    RTRAD,NCHN,STNID,KSATOB,RSATOB,DSNAME,IDSDAT,IDSDMP_8,IER)
  13462       ELSE
  13463 C ATTEMPT TO DECODE THE NEXT ATOVS REPORT
  13464          CALL W3ATOVSUNP(NFILE,IDATEM,PP,TP,QP,NLVL,IRTCHN,RTRAD,NCHN,
  13465      $    STNID,KSATOB,RSATOB,DSNAME,IDSDAT,IDSDMP_8,IER)
  13466       END IF
  13467       IFLUA = 0
  13468 C.......................................................................
  13469       IF(IER.EQ.-3)  THEN
  13470          PRINT 8002, NFILE
  13471  8002    FORMAT(/' *** ERROR RETURNING DATA SET INFORMATION IN FIRST ',
  13472      $    'CALL TO FILE IN UNIT',I4,' -- THIS MAY BE A NULL FILE -- ',
  13473      $    'GO TO NEXT FILE'/)
  13474          RETURN

Page 320         Source Listing                  SATBFR
2017-04-18 11:09                                 prepdata.f

  13475 C.......................................................................
  13476       ELSE  IF(IER.EQ.1)  THEN
  13477 C IER = 1 RETURNS DATA SET INFO (ONLY) AFTER FIRST CALL
  13478          PRINT 7000, DSNAME,IDSDAT,IDSDMP_8
  13479  7000    FORMAT(//22X,'--> DATA SET INFORMATION: NAME: ',A8,'; DATE: ',
  13480      $    I10.10,'; DUMP TIME: ',I12.12,' <--'//)
  13481 C DOES DATE FROM DATA SET MATCH NCEP PRODUCTION DATE?
  13482          IF(IDSDAT.NE.IDAT10)  THEN
  13483             PRINT 324
  13484   324 FORMAT(/13X,'>>>>>   P R O B L E M :   D A T E   D O E S   N O T',
  13485      $ '   M A T C H   P R O D U C T I O N   D A T E   <<<<<'/)
  13486             RETURN
  13487          END IF
  13488          GO TO 1400
  13489 C.......................................................................
  13490       ELSE  IF(IER.LT.0.OR.IER.GT.2)  THEN
  13491 C ERROR DECODING REPORT, DO NOT DECODE ANY MORE REPORTS AT THIS POINT
  13492          PRINT 572, NFILE,KNTRPT+1,IER
  13493   572 FORMAT(/' >>>>>  B U F R   D E C O D E   E R R O R   O N   UNIT',
  13494      $ I3,'   --   R E P O R T   C N T .   ',I5,'   --   I E R   ',I5,
  13495      $ '  <<<<<'/)
  13496          GO TO 10
  13497 C.......................................................................
  13498       ELSE  IF(IER.EQ.2)  THEN
  13499 C IF IER = 2, HAVE HIT END-OF-FILE, ALL REPORTS PROCESSED
  13500          GO TO 10
  13501 C.......................................................................
  13502       END IF
  13503 C A REPORT WAS SUCCESSFULLY DECODED
  13504       SKINT  = RSATOB(6)
  13505       OZONE  = RSATOB(8)
  13506       SOZANG = RSATOB(11)
  13507       SAZANG = RSATOB(12)
  13508       KNTRPT = KNTRPT + 1
  13509       CYCLET = IDATE(4)
  13510 C INITIALIZE UNPACKED IW3UNPBF FORMATTED ARRAY FOR THIS REPORT
  13511       RDATA = XMISS
  13512       RDATA(3) =  0.
  13513       RDATA(5) =  0.
  13514       IDATA(6) = KSATOB(1)
  13515       RDATA(7) = RSATOB(4)
  13516       IDATA(8) = IMISS
  13517       IDATA(9) = 61
  13518       RDATA(10)=  0.
  13519       IDATA(13:42) = 0
  13520 C FILL UNPACKED IW3UNPBF RDATA WORDS 1, 2, 4 WITH LAT, LON, OBS. TIME
  13521       IF(RSATOB(2).LT.XMISS)  RDATA(1) = RSATOB(2)
  13522       IF(RSATOB(3).LT.XMISS)  RDATA(2) = RSATOB(3)
  13523       IF(RSATOB(1).LT.XMISS)  RDATA(4) = RSATOB(1)
  13524 cfix? IF(RSATOB(2).LT.YMISS)  RDATA(1) = RSATOB(2)
  13525 cfix? IF(RSATOB(3).LT.YMISS)  RDATA(2) = RSATOB(3)
  13526 cfix? IF(RSATOB(1).LT.YMISS)  RDATA(4) = RSATOB(1)
  13527 C-----------------------------------------------------------------------
  13528 C         REPORT COUNTS STORED IN ARRAY: NUMOB(IBAND,INSTR,MS,NS,1)
  13529 C         WHERE: IBAND IS LAT. BAND INDEX, INSTR IS PATH TYPE INDEX
  13530 C               MS IS LAND/OCEAN SWITCH AND NS IS SAT # INDEX
  13531 C   ** PERFORM CHECKS ON SATELLITE NUMBER AND PATH, TOSS IF PROBLEM **

Page 321         Source Listing                  SATBFR
2017-04-18 11:09                                 prepdata.f

  13532 C-----------------------------------------------------------------------
  13533 C.......................................................................
  13534 C IDENTIFY LATITUDE (PHI) BAND INDEX ---> IBAND
  13535 C.......................................................................
  13536       DO IBAND = 1,4
  13537          IF(NINT(RDATA(1)*100.).LT.(NINT(PHI(IBAND+1)*100.)-0.5))
  13538      $    GO TO 1800
  13539       ENDDO
  13540 C NOTE: IN RARE EVENT THAT LAT. MSG, IBAND SET TO 5 (RPT. LATER SKIPPED)
  13541       IBAND = 5
  13542  1800 CONTINUE
  13543 C.......................................................................
  13544 C IDENTIFY SATELLITE NUMBER INDEX ---> NS (=1 EVEN SAT. ; =2 ODD  SAT.)
  13545 C.......................................................................
  13546       NS = 0
  13547       IF(STNID(8:8).GE.'S'.AND.STNID(8:8).LE.'Z')  THEN
  13548          NS = 1
  13549       ELSE  IF(STNID(8:8).GE.'A'.AND.STNID(8:8).LE.'H')  THEN
  13550          NS = 2
  13551       ELSE
  13552 C IF REPORT NOT FROM AN OPERATIONAL SATELLITE SKIP IT
  13553          KNOPTV(NN) = KNOPTV(NN) + 1
  13554          PRINT 8758, STNID,RDATA(1),RDATA(2)
  13555  8758 FORMAT(' * * TOTAL REPORT TOSSED  -ID=',A8,', LAT=',F7.2,'N, ',
  13556      $ 'LON=',F8.2,'E - FROM NON-OPERATIONAL SATELLITE')
  13557 C GO BACK AND DECODE NEXT REPORT
  13558          GO TO 1410
  13559       END IF
  13560       IDSAT(NS) = KSATOB(1)
  13561 C.......................................................................
  13562 C IDENTIFY PATH ---> INSTR {=1 CLEAR; =3 CLOUDY}
  13563 C  (NOTE: INSTR = 2 IS NOT A POSSIBILITY)
  13564 C.......................................................................
  13565       INSTR = MOD(KSATOB(2),10)
  13566       IF(INSTR.NE.1.AND.INSTR.NE.3)  THEN
  13567 C IF PATH (INSTRUMENT) NOT RECOGNIZED SKIP (NOTE: SHOULD NEVER HAPPEN)
  13568          KIPTTV(NN) = KIPTTV(NN) + 1
  13569          PRINT 8759, STNID,RDATA(1),RDATA(2),KSATOB(2)
  13570  8759 FORMAT(' * * TOTAL REPORT TOSSED  -ID=',A8,', LAT=',F7.2,'N, ',
  13571      $ 'LON=',F8.2,'E, RTYP',I4,' - HAS INVALID PATH')
  13572 C GO BACK AND DECODE NEXT REPORT
  13573          GO TO 1410
  13574       END IF
  13575 C.......................................................................
  13576 C IDENTIFY OVERLAND/OCEANIC SWITCH ---> MS (=1 OVERLAND; =2 OCEANIC)
  13577 C.......................................................................
  13578       MS = 2
  13579       IF(KSATOB(2).LT.170)  MS = 1
  13580 C-----------------------------------------------------------------------
  13581 C  PERFORM SERIES OF CHECKS ON THE UNPACKED REPORT, MAY TOSS IF PROBLEM
  13582 C-----------------------------------------------------------------------
  13583 C NUMOB ACCUMULATES TOTAL NUMBER OF REPORTS
  13584       NUMOB(IBAND,INSTR,MS,NS,1) = NUMOB(IBAND,INSTR,MS,NS,1) + 1
  13585 C CALL CHKREP TO CHECK FOR MSG LAT/LON & FOR REPORT OUTSIDE SEARCH AREA
  13586       CALL CHKREP(KMSGTV(NN),KBDYTV(NN),*1410)

Page 322         Source Listing                  SATBFR
2017-04-18 11:09 Entry Points                    prepdata.f



ENTRY POINTS

  Name               
                     
 satbfr_             


SYMBOL CROSS REFERENCE

 Name                       Object Declared Type            Bytes Dimen Elements Attributes       References                        
                                                                                                                                    
 10                         Label  13776                                                          13496,13500                       
 110                        Label  13781                                                          13404                             
 1400                       Label  13445                                                          13439,13488,13775                 
 1410                       Label  13442                                                          13558,13573,13586,13603,13610,1361
                                                                                                  6,13629,13635,13648,13683,13723,13
                                                                                                  764                               
 1800                       Label  13542                                                          13538                             
 1903                       Label  13748                                                          13747                             
 324                        Label  13484                                                          13483                             
 550                        Label  13415                                                          13414                             
 572                        Label  13493                                                          13492                             
 581                        Label  13419                                                          13418                             
 583                        Label  13423                                                          13422                             
 6666                       Label  13765                                                          13685,13728                       
 700                        Label  13398                                                          13784                             
 7000                       Label  13479                                                          13478                             
 7901                       Label  13757                                                          13756                             
 7902                       Label  13760                                                          13759                             
 8002                       Label  13471                                                          13470                             
 8757                       Label  13627                                                          13626                             
 8758                       Label  13555                                                          13554                             
 8759                       Label  13570                                                          13569                             
 899                        Label  13751                                                          13750                             
 9013                       Label  13412                                                          13411                             
 9823                       Label  13642                                                          13641                             
 9954                       Label  13721                                                          13720                             
 9955                       Label  13726                                                          13725                             
 ADP                        Common 13376                                14100                                                       
 ALAT_8                     Scalar 13374    R(8)            8           scalar   COM                                                
 ALON_8                     Scalar 13374    R(8)            8           scalar   COM                                                
 BMISS                      Scalar 13374    R(8)            8           scalar   COM              13453,13454,13456,13457           
 BUFRLIB_MISSING            Common 13390                                8                                                           
 CHKREP                     Subr   13586                                                          13586                             
 CLAL                       Local  13373    R(4)            4     1     600                       13434,13460                       
 CLAM                       Local  13373    R(4)            4     1     600                       13435,13460                       
 CLDAMT                     Scalar 13387    R(4)            4           scalar   COM                                                
 CTYPE                      Local  13364    CHAR            5     1     2                         13394,13411                       
 CYCLET                     Local  13509    R(4)            4           scalar                    13509,13591                       
 DAT                        Scalar 13384    R(4)            4     2     9600     COM              13433,13712,13733,13756           
 DATA                       Common 13382                                32                                                          
 DIRECT                     Common 13388                                36016                                                       
 DSNAME                     Local  13365    CHAR            8           scalar                    13461,13465,13478                 
 FILLX                      Subr   13680                                                          13680                             
 GOESRD                     Scalar 13387    R(4)            4     1     2        COM                                                

Page 323         Source Listing                  SATBFR
2017-04-18 11:09 Symbol Table                    prepdata.f

 Name                       Object Declared Type            Bytes Dimen Elements Attributes       References                        
                                                                                                                                    
 GRAD                       Scalar 13386    R(4)            4     1     18       COM                                                
 HDR                        Scalar 13383    R(4)            4     1     14       COM              13600,13677                       
 IBAND                      Local  13536    I(4)            4           scalar                    13536,13537,13541,13584,13598,1359
                                                                                                  9,13608,13614,13655,13659,13665,13
                                                                                                  671,13691,13700,13771,13772,13773 
 IDAT10                     Scalar 13382    I(4)            4           scalar   COM              13482                             
 IDATA                      Scalar 13368    I(4)            4     1     3500     COM              13514,13516,13517,13519           
 IDATE                      Scalar 13382    I(4)            4     1     4        COM              13414,13509                       
 IDATEM                     Local  13460    I(4)            4           scalar                    13460,13464                       
 IDSAT                      Local  13369    I(4)            4     1     4                         13409,13560,13780                 
 IDSDAT                     Local  13461    I(4)            4           scalar                    13461,13465,13478,13482           
 IDSDMP_8                   Local  13371    I(8)            8           scalar                    13461,13465,13478                 
 IER                        Local  13438    I(4)            4           scalar                    13438,13461,13465,13469,13476,1349
                                                                                                  0,13492,13498,13600,13601         
 IERF                       Local  13680    I(4)            4           scalar                    13680,13681                       
 IFLUA                      Scalar 13385    I(4)            4           scalar   COM              13467,13660,13666,13673           
 IGCHN                      Scalar 13386    I(4)            4     1     18       COM                                                
 IMISS                      Local  13395    I(4)            4           scalar                    13395,13516                       
 INSTR                      Local  13565    I(4)            4           scalar                    13565,13566,13584,13665,13671,1377
                                                                                                  1,13772,13773                     
 IPRINT                     Scalar 13376    I(4)            4           scalar   COM                                                
 IPRT                       Local  13368    I(4)            4     1     2                         13738,13739,13741,13742,13745,1374
                                                                                                  6,13764                           
 IQ                         Scalar 13368    I(4)            4     2     3000     COM              13447,13703,13704,13705,13710,1375
                                                                                                  6                                 
 IQBEST                     Local  13678    I(4)            4           scalar                    13678,13710,13772                 
 IR                         Scalar 13369    I(4)            4     2     3000     COM              13451,13756                       
 IRTCHN                     Local  13369    I(4)            4     1     35                        13460,13464                       
 IRTRV                      Scalar 13380    I(4)            4     3     80       COM              13655,13659,13665,13671           
 ISAMPLE                    Local  13370    I(4)            4     1     2                         13395,13646                       
 ISATLS                     Scalar 13381    I(4)            4     3     80       COM              13608,13614                       
 ISATOB                     Scalar 13376    I(4)            4           scalar   COM                                                
 IUNIT                      Scalar 13375    I(4)            4     1     28       COM              13410                             
 IWINDO_E                   Scalar 13380    I(4)            4     3     80       COM              13598                             
 IWINDO_L                   Scalar 13381    I(4)            4     3     80       COM              13599                             
 JQ                         Local  13368    I(4)            4     2     3000                      13449                             
 JR                         Local  13369    I(4)            4     2     3000                      13452                             
 JRTRV                      Local  13367    I(4)            4     1     3                         13394,13665                       
 K                          Local  13756    I(4)            4           scalar                    13756                             
 KBDYTV                     Scalar 13378    I(4)            4     1     2        COM              13586                             
 KEPOB                      Local  13367    I(4)            4     4     160                       13407,13771,13780                 
 KIPTTV                     Scalar 13378    I(4)            4     1     2        COM              13568                             
 KJFLAG                     Scalar 13379    I(4)            4     1     2        COM                                                
 KLNDTV                     Scalar 13379    I(4)            4     1     2        COM              13609                             
 KMSGTV                     Scalar 13378    I(4)            4     1     2        COM              13586                             
 KNOPTV                     Scalar 13378    I(4)            4     1     2        COM              13553                             
 KNTRPT                     Local  13427    I(4)            4           scalar                    13427,13492,13508,13646           
 KNTTOV                     Scalar 13377    I(4)            4     1     2        COM              13782                             
 KOUNT                      Scalar 13382    I(4)            4           scalar   COM              13400,13676,13682,13737,13741,1378
                                                                                                  2                                 
 KREDTV                     Scalar 13379    I(4)            4     1     2        COM              13625,13634,13647                 
 KSATOB                     Local  13369    I(4)            4     1     11                        13461,13465,13514,13560,13565,1356
                                                                                                  9,13579,13623,13626,13632,13636,13
                                                                                                  677                               
 KSEATV                     Scalar 13379    I(4)            4     1     2        COM              13615                             

Page 324         Source Listing                  SATBFR
2017-04-18 11:09 Symbol Table                    prepdata.f

 Name                       Object Declared Type            Bytes Dimen Elements Attributes       References                        
                                                                                                                                    
 KSKPTV                     Scalar 13378    I(4)            4     1     2        COM              13444                             
 KTIMTV                     Scalar 13378    I(4)            4     1     2        COM              13602                             
 KTOP                       Scalar 13380    I(4)            4     3     80       COM              13700                             
 MAXOBS                     Param  13361    I(4)            4           scalar                    13368,13376                       
 MFIRST                     Local  13395    I(4)            4           scalar                    13395,13640,13644                 
 MIN                        Func   13710                                scalar                    13710                             
 MOD                        Func   13565                                scalar                    13565,13646,13741                 
 MODPRT                     Scalar 13385    I(4)            4           scalar   COM              13741,13742                       
 MP_PROCESS                 Scalar 13382    I(4)            4           scalar   COM                                                
 MS                         Local  13578    I(4)            4           scalar                    13578,13579,13584,13606,13771,1377
                                                                                                  2,13773                           
 MSTOB                      Local  13367    I(4)            4     4     160                       13408,13772,13773,13780           
 MXBLVL                     Param  13360    I(4)            4           scalar                    13388                             
 MXLVL                      Param  13357    I(4)            4           scalar                    13368,13369,13372,13373,13384     
 MXWRDH                     Param  13356    I(4)            4           scalar                    13383                             
 N                          Local  13699    I(4)            4           scalar                    13699,13700,13701,13703,13704,1370
                                                                                                  5,13710,13712,13756               
 NCHN                       Local  13461    I(4)            4           scalar                    13461,13464                       
 NFILE                      Scalar 13375    I(4)            4           scalar   COM              13410,13411,13460,13464,13470,1349
                                                                                                  2                                 
 NINT                       Func   13537                                scalar                    13537                             
 NLEV                       Local  13698    I(4)            4           scalar                    13698,13702,13712,13715,13756,1376
                                                                                                  4                                 
 NLVL                       Local  13460    I(4)            4           scalar                    13460,13464,13699                 
 NN                         Local  13397    I(4)            4           scalar                    13397,13404,13410,13411,13438,1344
                                                                                                  4,13458,13553,13568,13586,13602,13
                                                                                                  609,13615,13625,13634,13641,13646,
                                                                                                  13647,13780,13782,13783,13784     
 NOBS3                      Scalar 13388    I(4)            4     1     7        COM              13455                             
 NS                         Local  13546    I(4)            4           scalar                    13546,13548,13550,13560,13584,1359
                                                                                                  8,13599,13608,13614,13655,13659,13
                                                                                                  665,13671,13691,13700             
 NUMDAT                     Param  13359    I(4)            4           scalar                    13372,13384,13712                 
 NUMOB                      Local  13367    I(4)            4     5     640                       13406,13584,13780                 
 NUMOBS2                    Param  13362    I(4)            4           scalar                    13388                             
 NUMQMS                     Param  13358    I(4)            4           scalar                    13359,13368,13369,13393           
 NUMVAR                     Param  13358    I(4)            4           scalar                    13359,13392,13393                 
 OBS2                       Scalar 13388    R(4)            4     1     43       COM              13453                             
 OBS3                       Scalar 13388    R(4)            4     3     8925     COM              13454                             
 OBS8_8                     Scalar 13374    R(8)            8     1     2        COM              13456                             
 OZONE                      Scalar 13386    R(4)            4           scalar   COM              13505                             
 PARM6                      Common 13385                                32                                                          
 PHI                        Scalar 13380    R(4)            4     1     6        COM              13537                             
 PMAND                      Scalar 13376    R(4)            4     1     23       COM              13700                             
 PP                         Scalar 13372    R(4)            4     1     600      COM              13460,13464,13700,13701,13703     
 PSTA                       Local  13736    R(4)            4           scalar                    13736,13764                       
 QP                         Scalar 13372    R(4)            4     1     600      COM              13460,13464,13691,13705           
 RADANC                     Common 13386                                320                                                         
 RDATA                      Scalar 13376    R(4)            4     1     3500     COM              13511,13512,13513,13515,13518,1352
                                                                                                  1,13522,13523,13537,13554,13569,13
                                                                                                  626,13720,13725                   
 RDATA2                     Scalar 13388    R(4)            4     1     25       COM              13457                             
 RPTHDR                     Common 13383                                88                                                          
 RPTLBL                     Subr   13591                                                          13591                             
 RSATOB                     Local  13373    R(4)            4     1     17                        13461,13465,13504,13505,13506,1350

Page 325         Source Listing                  SATBFR
2017-04-18 11:09 Symbol Table                    prepdata.f

 Name                       Object Declared Type            Bytes Dimen Elements Attributes       References                        
                                                                                                                                    
                                                                                                  7,13515,13521,13522,13523,13701   
 RTRAD                      Scalar 13386    R(4)            4     1     35       COM              13432,13461,13464                 
 SAMPLE                     Local  13363    CHAR            4     1     2                         13395,13641                       
 SATBFR                     Subr   13343                                                                                            
 SATMST                     Scalar 13366    L(4)            4     3     80       COM              13691                             
 SATSW2                     Common 13380                                1944                                                        
 SAZANG                     Scalar 13386    R(4)            4           scalar   COM              13507                             
 SKINT                      Scalar 13387    R(4)            4           scalar   COM              13504                             
 SNDATA                     Common 13384                                38400                                                       
 SNDTBL                     Subr   13780                                                          13780                             
 SOZANG                     Scalar 13386    R(4)            4           scalar   COM              13506                             
 STNID                      Scalar 13365    CHAR            8           scalar   COM              13461,13465,13547,13549,13554,1356
                                                                                                  9,13626,13720,13725,13744,13747   
 STNPRT                     Scalar 13365    CHAR            8     1     3        COM              13744                             
 STOROB                     Subr   13764                                                          13764                             
 SUBSET_D                   Scalar 13365    CHAR            8           scalar   COM                                                
 TIMCHK                     Subr   13600                                                          13600                             
 TIMWIN_E                   Local  13598    R(4)            4           scalar                    13598,13600                       
 TIMWIN_L                   Local  13599    R(4)            4           scalar                    13599,13600                       
 TMP                        Local  13372    R(4)            4     2     9600                      13448,13712,13733                 
 TOVBFR                     Scalar 13366    L(4)            4     1     2        COM              13404                             
 TOVEDS                     Scalar 13377    R(4)            4     1     2        COM                                                
 TOVRAD                     Scalar 13366    L(4)            4           scalar   COM              13676,13719,13737                 
 TOVRTV                     Scalar 13366    L(4)            4           scalar   COM              13679                             
 TP                         Scalar 13372    R(4)            4     1     600      COM              13460,13464,13704                 
 TR80KM                     Scalar 13366    L(4)            4           scalar   COM              13417,13631                       
 TVSWCH                     Common 13377                                108                                                         
 UNITNO                     Common 13375                                116                                                         
 W3ATOVSUNP                 Subr   13464                                                          13464                             
 W3RTOVSUNP                 Subr   13460                                                          13460                             
 WRMISS                     Scalar 13382    R(4)            4           scalar   COM                                                
 XMISS                      Local  13394    R(4)            4           scalar                    13394,13432,13433,13434,13435,1344
                                                                                                  8,13511,13521,13522,13523,13691,13
                                                                                                  703,13704,13705                   
 YMISS                      Local  13396    R(4)            4           scalar                    13396                             
 ZP                         Scalar 13372    R(4)            4     1     600      COM                                                

Page 326         Source Listing                  SATBFR
2017-04-18 11:09                                 prepdata.f

  13587 C-----------------------------------------------------------------------
  13588 C CALL SUBR. 'RPTLBL' TO STORE REPORT HEADER INTO HDR(4),HDR(5),HDR(7),
  13589 C                          HDR(9)-HDR(15), ALAT_8, ALON_8
  13590 C-----------------------------------------------------------------------
  13591       CALL RPTLBL(CYCLET)
  13592 C-----------------------------------------------------------------------
  13593 C        CALL SUBR. 'TIMCHK' TO CHECK IF REPORT IS W/I PROPER
  13594 C              TIME WINDOW OF CYCLE TIME (IER =1 TOSS RPT)
  13595 C-----------------------------------------------------------------------
  13596 C TIMWIN_e AND TIMWIN_l ARE THE TIME WINDOWS (RELATIVE TO CYCLE TIME)
  13597 C  FOR ACCEPTING REPORTS (EARLIEST AND LATEST, RESPECTIVELY)
  13598       TIMWIN_e = IWINDO_e(IBAND,NS,1)
  13599       TIMWIN_l = IWINDO_l(IBAND,NS,1)
  13600       CALL TIMCHK(HDR(4),TIMWIN_e,TIMWIN_l,IER)
  13601       IF(IER.EQ.1)  THEN
  13602          KTIMTV(NN) = KTIMTV(NN) + 1
  13603          GO TO 1410
  13604       END IF
  13605 C.......................................................................
  13606       IF(MS.EQ.1)  THEN
  13607 C CHECK IF OVERLAND REPORTS ARE TO BE EXCLUDED {ISATLS(IBAND,NS,1) = 2}
  13608          IF(ISATLS(IBAND,NS,1).EQ.2)  THEN
  13609             KLNDTV(NN) = KLNDTV(NN) + 1
  13610             GO TO 1410
  13611          END IF
  13612       ELSE
  13613 C CHECK IF OCEANIC REPORTS ARE TO BE EXCLUDED {ISATLS(IBAND,NS,1) = 1}
  13614          IF(ISATLS(IBAND,NS,1).EQ.1)  THEN
  13615             KSEATV(NN) = KSEATV(NN) + 1
  13616             GO TO 1410
  13617          END IF
  13618       END IF
  13619 C.......................................................................
  13620 C CHECK FILTER FLAG - IF TR80KM=F PROCESS ONLY "GOOD" REPORTS (250 KM
  13621 C  RESOLUTION); IF TR80KM=T PROCESS BOTH "GOOD" AND "REDUNDANT" REPORTS
  13622 C  (FULL RESOLUTION - 80 KM FOR RTOVS AND 40 KM FOR ATOVS)
  13623       IF(KSATOB(7).GT.1)  THEN
  13624 C INVALID FILTER FLAG, SKIP TO NEXT REPORT
  13625          KREDTV(NN) = KREDTV(NN) + 1
  13626          PRINT 8757, STNID,RDATA(1),RDATA(2),KSATOB(7)
  13627  8757 FORMAT(' * * TOTAL REPORT TOSSED  -ID=',A8,', LAT=',F7.2,'N, ',
  13628      $ 'LON=',F8.2,'E - INVALID FILTER FLAG ( > 1) OF ',I2)
  13629          GO TO 1410
  13630       END IF
  13631       IF(.NOT.TR80KM)  THEN
  13632          IF(KSATOB(7).EQ.1)  THEN
  13633 C FILTER FLAG =1 INDICATES REDUNDANT RETRIEVAL, SKIP TO NEXT REPORT
  13634             KREDTV(NN) = KREDTV(NN) + 1
  13635             GO TO 1410
  13636          ELSE  IF(KSATOB(7).EQ.-99) THEN
  13637 C FILTER FLAG IS MISSING (=-99), ESTIMATE 250 KM SAMPLING BY PROCESSING
  13638 C  ONLY EVERY 4'TH RETRIEVAL FOR RTOVS AND EVERY 11'TH RETRIEVAL FOR
  13639 C  ATOVS
  13640             IF(MFIRST.EQ.0)  THEN
  13641                PRINT 9823, SAMPLE(NN)
  13642  9823 FORMAT(/10X,'-->  WARNING: FILTER FLAG IS MISSING -- ESTIMATE 25',
  13643      $ '0 KM SAMPLING BY PROCESSING ONLY EVERY ',A4,', RETRIEVAL  <--'/)

Page 327         Source Listing                  SATBFR
2017-04-18 11:09                                 prepdata.f

  13644                MFIRST = 1
  13645             END IF
  13646             IF(MOD(KNTRPT-1,ISAMPLE(NN)).NE.0)  THEN
  13647                KREDTV(NN) = KREDTV(NN) + 1
  13648                GO TO 1410
  13649             END IF
  13650          END IF
  13651       END IF
  13652 C.......................................................................
  13653 C CHECK IF RPTS FROM ALL PATHS ARE TO BE KEPT {IRTRV(IBAND,NS,1) = 0}
  13654 C  (WHERE IBAND IS LAT BAND AND NS IS SAT. NO. INDEX) -- NO MORE CHECKS
  13655       IF(IRTRV(IBAND,NS,1).EQ.0)  THEN
  13656 C.......................................................................
  13657 C CHECK IF RPTS FROM ALL PATHS ARE TO BE FLAGGED {IRTRV(IBAND,NS,1) =
  13658 C  9999} (WHERE IBAND AND NS AS BEFORE) - DOES NOT APPLY TO RADIANCES!!
  13659       ELSE  IF(IRTRV(IBAND,NS,1).EQ.9999)  THEN
  13660          IFLUA = 1
  13661 C.......................................................................
  13662 C CHECK IF RPTS FROM ONLY ONE PATH ARE TO BE FLAGGED {IRTRV(IBAND,NS,1)
  13663 C  = 272 OR 544} (WHERE IBAND AND NS AS BEFORE) - DOES NOT APPLY TO
  13664 C  RADIANCES!!
  13665       ELSE  IF(IRTRV(IBAND,NS,1).EQ.JRTRV(INSTR))  THEN
  13666          IFLUA = 1
  13667 C.......................................................................
  13668 C CHECK IF RPTS FROM ONLY ONE PATH ARE TO BE NON-FLAGGED
  13669 C  {IRTRV(IBAND,NS,1) = 1, 2, OR 3} (WHERE IBAND AND NS AS BEFORE) -
  13670 C  DOES NOT APPLY TO RADIANCES!!
  13671       ELSE  IF(IRTRV(IBAND,NS,1).LE.3.AND.IRTRV(IBAND,NS,1).NE.INSTR)
  13672      $ THEN
  13673          IFLUA = 1
  13674       END IF
  13675 C.......................................................................
  13676       IF(TOVRAD)  KOUNT = KOUNT + 1
  13677       HDR(6) = KSATOB(2)
  13678       IQBEST = 99
  13679       IF(.NOT.TOVRTV)  THEN
  13680          CALL FILLX(-1,IERF)
  13681          IF(IERF.EQ.1)  THEN
  13682             KOUNT = KOUNT - 1
  13683             GO TO 1410
  13684          END IF
  13685          GO TO 6666
  13686       END IF
  13687 C*********************************************************************
  13688 C            40-LEVEL RETRIEVAL PART OF REPORT IS PROCESSED HERE
  13689 C***********************************************************************
  13690 C IF MOISTURE IS TO BE EXCLUDED, RESET QP ARRAY TO MISSING
  13691       IF(.NOT.SATMST(IBAND,NS,1))  QP = XMISS
  13692 C-----------------------------------------------------------------------
  13693 C            LOOP THROUGH ALL LEVELS OF DECODED RETRIEVAL
  13694 C       LEVELS ABOVE PMAND(KTOP(IBAND,NS,1)) ARE NOT PROCESSED
  13695 C           LEVELS BELOW BOTTOM PRESSURE ARE NOT PROCESSED
  13696 C ASSIGN DEFAULT PREPBUFR TBL VALUES TO NON-MSG PRESS, TEMP, SPEC. HUM.
  13697 C-----------------------------------------------------------------------
  13698       NLEV = 0
  13699       DO N = 1,NLVL
  13700          IF(PP(N)+.000005.LT.PMAND(KTOP(IBAND,NS,1)))  EXIT

Page 328         Source Listing                  SATBFR
2017-04-18 11:09                                 prepdata.f

  13701          IF(PP(N).GT.RSATOB(5))  CYCLE
  13702          NLEV = NLEV + 1
  13703          IF(PP(N).LT.XMISS)  IQ(N,5) = 2
  13704          IF(TP(N).LT.XMISS)  IQ(N,2) = 2
  13705          IF(QP(N).GE.0.0.AND.QP(N).LT.XMISS)  IQ(N,3) = 2
  13706 cfix?    IF(PP(N).LT.YMISS)  IQ(N,5) = 2
  13707 cfix?    IF(TP(N).LT.YMISS)  IQ(N,2) = 2
  13708 cfix?    IF(QP(N).GE.0.0.AND.QP(N).LT.YMISS)  IQ(N,3) = 2
  13709 C IQBEST: BEST (LOWEST) MOISTURE PREPBUFR TBL V. AMONGST ALL VALID LVLS
  13710          IQBEST = MIN(IQ(N,3),IQBEST)
  13711 C TEMPORARILY STORE DATA ON ALL VALID LEVELS IN "TMP" ARRAY
  13712          TMP(NLEV,1:NUMDAT) = DAT(N,1:NUMDAT)
  13713       ENDDO
  13714 C-----------------------------------------------------------------------
  13715       IF(NLEV.LE.0)  THEN
  13716 C.......................................................................
  13717 C IF NLEV IS ZERO (SHOULD NEVER HAPPEN), SKIP RETRIEVAL PART OF REPORT
  13718 C  (MAY STILL HAVE RADIANCE PART) AND PRINT DIAGNOSTIC
  13719          IF(.NOT.TOVRAD)  THEN
  13720             PRINT 9954, STNID,RDATA(1),RDATA(2)
  13721  9954 FORMAT(' # # TOTAL REPORT TOSSED  -ID=',A8,', LAT=',F7.2,'N, ',
  13722      $ 'LON=',F8.2,'E - NO LEVELS PROCESSED IN SUBROUTINE SATBFR')
  13723             GO TO 1410
  13724          ELSE
  13725             PRINT 9955, STNID,RDATA(1),RDATA(2)
  13726  9955 FORMAT(' * * RETR. PART SKIPPED   -ID=',A8,', LAT=',F7.2,'N, ',
  13727      $ 'LON=',F8.2,'E - NO LEVELS PROCESSED IN SUBROUTINE SATBFR')
  13728             GO TO 6666
  13729          END IF
  13730 C.......................................................................
  13731       END IF
  13732 C TRANSFER "TMP" ARRAY BACK TO "DAT" ARRAY
  13733       DAT = TMP
  13734 C PSTA HOLDS STN. PRESS., HERE NOT AVAILABLE, SO SET PSTA TO 1099.50 SO
  13735 C  NO OTHER LEVEL WILL EVER MATCH IT
  13736       PSTA = 1099.50
  13737       IF(.NOT.TOVRAD)  KOUNT = KOUNT + 1
  13738       IPRT(1) = 0
  13739       IPRT(2) = 0
  13740 C PRINT OUT COMPLETE LISTING OF REPORT (BASED ON MODPRT)
  13741       IF(MOD((KOUNT-1),MODPRT).EQ.0)  IPRT(1) = 1
  13742       IF(MODPRT.LT.0)  IPRT(1) = 0
  13743 C ALSO, CAN PRINT OUT COMPLETE LISTING FOR SPECIFIC REPORT(S)
  13744       IF(STNID.EQ.STNPRT(1).OR.STNID.EQ.STNPRT(2).OR.STNID.EQ.STNPRT(3))
  13745      $ IPRT(2) = 1
  13746       IF(IPRT(1).EQ.1.OR.IPRT(2).EQ.1)  THEN
  13747          PRINT 1903, STNID
  13748  1903 FORMAT(//,37X,'>>> COMPLETE LISTING OF DATA FOR STATION ID ',A8,
  13749      $ ' <<<',//)
  13750          PRINT 899
  13751   899 FORMAT(2X,'PRESSURE',6X,'HEIGHT',4X,'TEMPERATURE',4X,'SP. HUM.',
  13752      $ 4X,'U-WIND',7X,'V-WIND',5X,'HGHT',5X,'TEMP',5X,'SP. HUM',5X,
  13753      $ 'WIND',3X,'VERT. COORD.'/,4X,'(MB)',9X,'(GPM)',8X,'(K)',9X,
  13754      $ '(G/G)',7X,'(M/S)',8X,'(M/S)',4X,'TV/RC',4X,'TV/RC',6X,'TV/RC',
  13755      $ 5X,'TV/RC',6X,'TV/RC'/)
  13756          PRINT 7901, ((DAT(N,K),K=1,6),(IQ(N,K),IR(N,K),K=1,5),N=1,NLEV)
  13757  7901 FORMAT(1X,F8.2,F13.2,F13.2,F14.5,F11.2,F13.2,I5,'/',I3,I5,'/',

Page 329         Source Listing                  SATBFR
2017-04-18 11:09                                 prepdata.f

  13758      $ I3,I7,'/',I3,I6,'/',I3,I7,'/',I3)
  13759          PRINT 7902
  13760  7902    FORMAT(//)
  13761       END IF
  13762 C-----------------------------------------------------------------------
  13763 C CALL SUBR. 'STOROB' TO WRITE REPORT PIECES IN MOBS ARRAY
  13764       CALL STOROB(NLEV,PSTA,0,IPRT,*1410)
  13765  6666 CONTINUE
  13766 C***********************************************************************
  13767 C      BOTH 40-LEVEL RETRIEVAL AND RADIANCE PART OF REPORT COME HERE
  13768 C***********************************************************************
  13769 C KEPOB ACCUM. NO. OF RPTS PROCESSED AND MSTOB ACCUM. NO. OF RPTS WITH
  13770 C  RETR. MOISTURE PROCESSED, BOTH ACCORDING TO OVERLAND OR OCEANIC
  13771       KEPOB(IBAND,INSTR,MS,1) = KEPOB(IBAND,INSTR,MS,1) + 1
  13772       IF(IQBEST.LT.16) MSTOB(IBAND,INSTR,MS,1) =
  13773      $                 MSTOB(IBAND,INSTR,MS,1) + 1
  13774 C GO BACK AND DECODE NEXT REPORT
  13775       GO TO 1400
  13776    10 CONTINUE
  13777 C***********************************************************************
  13778 C***********************************************************************
  13779 C FINISHED PROCESSING RPTS IN THIS FILE; SUBR. SNDTBL SUMMARIZES IN TBL
  13780       CALL SNDTBL(IDSAT,NUMOB,KEPOB,MSTOB,NN)
  13781   110 CONTINUE
  13782       KNTTOV(NN) = KOUNT
  13783       NN = NN + 1
  13784       IF(NN.LE.2)  GO TO 700
  13785       RETURN
  13786       END
  13787 C$$$  SUBPROGRAM DOCUMENTATION BLOCK
  13788 C
  13789 C SUBPROGRAM:    GOESDG
  13790 C   PRGMMR: Keyser           ORG: NP22       DATE: 2016-11-30
  13791 C
  13792 C ABSTRACT: DECODES GOES REPORTS FROM INPUT BUFR DATA DUMP FILE,
  13793 C   PROCESSING ONE REPORT AT A TIME.  DEPENDING UPON USER REQUEST MAY
  13794 C   PROCESS SOUNDINGS/RADIANCES, AND/OR PRECIP. WATER RETRIEVALS, AND/
  13795 C   OR CLOUD TOP RETRIEVALS INTO UNIQUE OUTPUT REPORTS.  IN ADDITION
  13796 C   USER MAY SELECT BETWEEN 5x5 FOV (LOW-RESOLUTION) OR 1x1 FOV (HIGH-
  13797 C   RESOLUTION).  FINALLY, ACCUMULATES COUNTS FOR VALID REPORTS BEFORE
  13798 C   CALLING SUBROUTINES TO ACTUALLY PROCESS REPORTS INTO THE REQUESTED
  13799 C   OUTPUT FORMAT.
  13800 C
  13801 C PROGRAM HISTORY LOG:
  13802 C   UNKNOWN
  13803 C 1995-07-12  D. A. KEYSER -- ORIGINAL AUTHOR
  13804 C 1995-08-24  D. A. KEYSER -- GOES SNDG SFC DATA (T,Q,Z) PREPDA
  13805 C     TABLE VALUES SET TO AT BEST SUSPECT
  13806 C 1996-09-03  D. A. KEYSER -- CAN PROCESS RETR. FROM GOES-ODD SAT (AS
  13807 C     WAS FOR GOES-EVEN SAT)
  13808 C 1997-05-01  D. A. KEYSER -- EST. REASON CODES FOR UPPER-AIR DATA
  13809 C     TYPES (CURRENTLY JUST 100); STDOUT EXPANDED TO INCL. REASON CODES
  13810 C 1997-07-02  D. A. KEYSER -- MODIFIED THE PROCESSING OF GOES DATA
  13811 C     TO READ FROM SINGLE BUFR DUMP FILE USING W3LIB ROUTINE W3UNPK77
  13812 C     (RATHER THAN OLD READ FROM 2 WMO BUFR FILES WHICH USED W3FI77),
  13813 C     ALSO READS IN AND PROCESSES 18-CHANNELS OF BRIGHTNESS TEMPERATURE
  13814 C     (IF REQUESTED FROM NEW N-LIST SWITCH "GOESRD")

Page 330         Source Listing                  SATBFR
2017-04-18 11:09                                 prepdata.f

  13815 C 1997-07-22  D. A. KEYSER -- NAMELIST SWITCH "IWINDO" FOR GOES DATA
  13816 C     (LAST 10 WORDS) REDEFINED FROM WHOLE HOURS TO HOURS * 100 TO GIVE
  13817 C     MORE PRECISION IN DEFINING GOES TIME WINDOW
  13818 C 1997-08-28  D. A. KEYSER -- CORRECTS FOR CALC. NEGATIVE TOP LAYER P.
  13819 C     WATER WHICH CAN NOW OCCUR DUE TO ROUND-OFF ERROR IN INPUT BUFR
  13820 C     DUMP FILE - SETS TO ZERO IF > -1 MM, ELSE TOSSES PWATER REPORT;
  13821 C     TOSSES PWATER REPORT IF ANY OF THE LAYER VALUES ARE MISSING OR
  13822 C     < ZERO
  13823 C 1997-09-18  D. A. KEYSER -- STORES SKIN TEMP., CLOUD AMT., SOLAR
  13824 C     ZENITH ANG., AND SAT. ZENITH ANG. IN COMMON WHEN PROCESSING GOES
  13825 C     RADIANCES (LATER ENCODED INTO PREPBUFR)
  13826 C 1997-10-06  D. A. KEYSER -- STORES FOV# INTO COMMON FOR LATER
  13827 C     ENCODING INTO PREPBUFR
  13828 C 1998-06-14  D. A. KEYSER -- NEW LOGICAL N-LIST SWITCH "FLGOES" IS A
  13829 C     4-WORD ARRAY WHICH ALLOWS ALL SNDG/RETR DATA FROM EVERY OTHER
  13830 C     EVEN OR ODD GOES SATELLITE TO BE FLAGGED FOR NON-USE BY THE
  13831 C     ANALYSIS (NEEDED WHEN 2 EVENS OR ODDS ARE PRODUCING DATA BUT ONLY
  13832 C     ONE IS USED OPERATIONALLY), CHAR. 6 OF GOES STNID IS NOW UNIQUE
  13833 C     FOR TWO DIFFERENT, BUT CONSECUTIVE, EVEN OR ODD SATELLITES)
  13834 c 1999-01-20  D. A. KEYSER -- REPL. N-LIST SWITCH "SATLND" WITH NEW
  13835 C     SWITCHES "ISATLS" AND "JSATLS" TO HANDLE LAND/SEA SELECTION FOR
  13836 C     SATELLITE SNDGS/RADIANCES AND GOES PW RETR. SEPARATELY (ALSO CAN
  13837 C     NOW SELECT JUST LAND AS WELL AS JUST SEA OR EVERYWHERE)
  13838 C 2000-12-05  D. A. KEYSER -- RECOGNIZES GOES SNDG/RAD REPORTS WITH
  13839 C     NEW 8-CHAR. STNID FORMAT
  13840 C 2001-04-06  D. A. KEYSER -- PRINTS DIAG. IF TDEW < TDLIM; SUBR.
  13841 C     "PWATER" RENAMED TO "GETPWATER", NOW RETURNS IERF=1 IF REPORT NOT
  13842 C     ENCODED INTO PREPBUFR FILE (INSTEAD OF MST=0); ACCOUNTS FOR SUBR.
  13843 C     W3UNPKB7 OUTPUTTING GOES RAD. AS K (PRECISE TO 10**2) RATHER THAN
  13844 C     K*100; ACCOUNTS FOR SUBR. W3UNPKB7 OUTPUTTING GOES PWATER AS AS
  13845 C     MM (PRECISE TO 10**2) RATHER THAN MM*100; ACCOUNTS FOR SUBR.
  13846 C     W3UNPKB7 OUTPUTTING GOES SKIN TEMP AS K (PRECISE TO 10**2) RATHER
  13847 C     THAN K*100; ACCOUNTS FOR SUBR. W3UNPKB7 OUTPUTTING GOES SOLAR AND
  13848 C     SAT. ZENITH ANGLE AS DEGREES (PRECISE TO 10**2) RATHER THAN
  13849 C     DEG*100; SUBR. "RPTLBL" NOW HAS INPUT ARGS. "TIMWIN_e" (EARLIEST
  13850 C     TIME WINDOW) AND "TIMWIN_l" (LATEST TIME WINDOW) REPL. "TIMWIN"
  13851 C     (+/- TIME WINDOW) ("-" PRIOR TO CYCLE TIME, "+" AFTER CYCLE
  13852 C     TIME), ALLOWS THE 2 TO BE DIFFERENT; READS IN GOES SFC PRESSURE
  13853 C     (FROM CAT. 8, CF 262) FOR PW REPORTS
  13854 C 2001-06-19  D. A. KEYSER -- CAN NOW PROCESS GOES 1x1 FOV CLOUD TOP
  13855 c     REPORTS INTO PREPBUFR FILE UNDER R.T. 151 (MNEMONICS ARE "CDTP"/
  13856 C     CLOUD TOP PRESSURE, "TOCC"/CLOUD COVER, "GCDTT"/CLOUD TOP TEMP.);
  13857 C     NEW SUBR. "TIMCHK" DOES TIME WINDOW CHECK SEPARATE FROM "RPTLBL";
  13858 C     SUBR. STREAMLINED, WITH NEW SUBR. "GOESCHK" NOW PERFORMING CHECKS
  13859 C     ON SEPARATE RPT TYPES BEING PROCESSED; N-LIST SWITCHES "GOESND",
  13860 C     "GOESPW", "GOESRD" AND NEW "GOESCT" NOW LENGTH 2 TO PROCESS THE
  13861 C     4 GOESND TYPES FORM EITHER 5X5 OR 1X1 FOV; N-LIST SWITCHES
  13862 C     "IWINDO", "SATMST", "ISATLS", "IRTRV" AND "KTOP" NOW MORE
  13863 C     SPECIFIC TO POINT TO PAIRS OF EVEN OR ODD GOES SATS. AND TO THE
  13864 C     4 POSSIBLE REPORT TYPES THAT CAN BE GENERATED FROM RTOVS/ATOVS
  13865 C     AND GOES SNDG/RAD/RETR. DATA (OLD SWITCHES "JSATLS" AND "FLGOES"
  13866 C     NO LONGER NEEDED AND REMOVED)
  13867 C 2001-08-01  D. A. KEYSER -- N-LIST SWITCH IWINDO SPLIT INTO IWINDO_e
  13868 C     (EARLIEST TIME WINDOW) AND IWINDO_l (LATEST TIME WINDOW) FOR
  13869 C     SATELLITE SOUNDING/RETRIEVAL/RADIANCE REPORTS ("-" PRIOR TO CYCLE
  13870 C     TIME, "+" AFTER CYCLE TIME) (SAME DEFAULTS AS BEFORE)
  13871 C 2002-01-14  D. A. KEYSER -- LEVELS WITH REPORTED DWPT < "TDLIM" VALUE

Page 331         Source Listing                  SATBFR
2017-04-18 11:09                                 prepdata.f

  13872 C     NOW CALC. SPEC. HUM AND RETAIN DWPT IN PREPBUFR FILE, BUT
  13873 C     MOISTURE PREPBUFR TABLE VALUE IS FLAGGED WITH Q.M.=15 IN SUBR.
  13874 C     FIZZ01 (BEFORE, SPEC. HUM. AND DWPT SET TO MISSING) VIRT. TEMP.
  13875 C     CALC. AND ENCODED IN THIS CASE  (BEFORE, SET TO SENSIBLE TEMP.)
  13876 C 2007-09-14  D. A. KEYSER -- MODIFIED TO HANDLE RETURN OF NEW ARGUMENT
  13877 C     "RDATA2" FROM CALLS TO W3UNPKB7 [1-DIM 21-WORD ARRAY WHICH HOLDS
  13878 C     ADDITIONAL VALUES DECODED DIRECTLY FROM BUFR (AND NOT IN "RDATA"
  13879 C     ARRAY), FOR SOME PARAMETERS REPLACING WHAT HAD BEEN RETURNED IN
  13880 C     "RDATA" ARRAY (IN THE HEADER)]; CAN NOW HANDLE GOES 1x1
  13881 C     SOUNDINGS/PW/RADIANCES IN MESSAGE TYPE "NC003003"; GOES
  13882 C     SOUNDINGS/PW/RADIANCES ONLY PROCESSED IF MESSAGE TYPE IS
  13883 C     "NC003001" (5x5) OR "NC003003" (1x1), GOES CLOUD-TOP RETR ONLY
  13884 C     PROCESSED IF MESSAGE TYPE IS "NC003002" (NEEDED WHEN 1x1 SNDGS
  13885 C     ARE STORED WITH CLOUD IN GOESND DUMP SINCE FORMER ALSO CONTAIN
  13886 C     CLOUD INFO WHICH WE DO NOT WANT TO PROCESS)
  13887 C 2015-04-16 JWhiting -- Fixed bug in GOES TOCC encoding; now populates
  13888 C     CLTOP(1,2) with TOCC value directly from RDATA2(25) passed from
  13889 C     W3UNPKB7 (had looked for it in cat 8 c.f. 258 passed in from
  13890 C     W3UNPKB7 in RDATA array but this was changed long ago to hold
  13891 C     cloud amount and not total cloud cover, and the former is missing
  13892 C     in GOES cloud reports).
  13893 C 2016-11-30  D. A. KEYSER -- Accounts for new output argument "OBS8_8"
  13894 C     returned from W3UNPKB7 for unpacked reports (REAL*8 2-word array
  13895 C     containing latitude and longitude of report).
  13896 C
  13897 C USAGE:    CALL GOESDG
  13898 C   INPUT FILES:
  13899 C     UNIT HH   - GOES BUFR DATA FILE (5x5 AND/OR 1x1 FOV SOUNDINGS/
  13900 C                 RETRIEVALS/RADIANCES)
  13901 C    (WHERE HH IS UNIT NUMBER DEFINED AS IUNIT(8) IN NAMELIST "&PARM")
  13902 C
  13903 C   OUTPUT FILES:
  13904 C     UNIT 06  - STANDARD OUTPUT PRINT
  13905 C
  13906 C REMARKS: CALLED BY SUBROUTINE 'PREP'.
  13907 C
  13908 C ATTRIBUTES:
  13909 C   LANGUAGE: FORTRAN 90
  13910 C   MACHINE:  NCEP WCOSS
  13911 C
  13912 C$$$
  13913       SUBROUTINE GOESDG
  13914 CCC
  13915 C  SATELLITE & PATH (INSTRUMENT) INDICATED BY CHARACTER 8 OF STN. ID
  13916 
  13917 C          SUFFIX I ---> CLEAR COLUMN PATH FROM EVEN-1 SATELLITE
  13918 C          SUFFIX J ---> CLOUDY       PATH FROM EVEN-1 SATELLITE
  13919 C          SUFFIX K ---> UNKNOWN      PATH FROM EVEN-1 SATELLITE
  13920 C                {GOES-04(248), GOES-08(252), GOES-12(256), ...}
  13921 
  13922 C          SUFFIX O ---> CLEAR COLUMN PATH FROM EVEN-2 SATELLITE
  13923 C          SUFFIX P ---> CLOUDY       PATH FROM EVEN-2 SATELLITE
  13924 C          SUFFIX S ---> UNKNOWN      PATH FROM EVEN-2 SATELLITE
  13925 C                {GOES-06(250), GOES-10(254), GOES-14(258), ...}
  13926 
  13927 C          SUFFIX L ---> CLEAR COLUMN PATH FROM ODD-1  SATELLITE
  13928 C          SUFFIX M ---> CLOUDY       PATH FROM ODD-1  SATELLITE

Page 332         Source Listing                  GOESDG
2017-04-18 11:09                                 prepdata.f

  13929 C          SUFFIX N ---> UNKNOWN      PATH FROM ODD-1  SATELLITE
  13930 C                {GOES-09(253), GOES-13(257), ...}
  13931 
  13932 C          SUFFIX Q ---> CLEAR COLUMN PATH FROM ODD-2  SATELLITE
  13933 C          SUFFIX R ---> CLOUDY       PATH FROM ODD-2  SATELLITE
  13934 C          SUFFIX T ---> UNKNOWN      PATH FROM ODD-2  SATELLITE
  13935 C                {GOES-07(251), GOES-11(255), GOES-15(259), ...}
  13936 
  13937 CCC
  13938       PARAMETER (MXWRDH = 15)
  13939       PARAMETER (MXLVL = 600)
  13940       PARAMETER (NUMVAR = 6, NUMQMS = 5)
  13941       PARAMETER (NUMDAT = NUMVAR + (2 * NUMQMS))
  13942       PARAMETER (MXBLVL = 255)
  13943       PARAMETER (MAXOBS = 3500)
  13944       PARAMETER (NUMOBS2 = 43)
  13945       CHARACTER*1  CIDGST(4,4)
  13946       CHARACTER*8  STNID,STNPRT,DSNAME,SUBSET_d
  13947       LOGICAL  SATMST,GOESND,GOESPW,GOESCT,GOESRD
  13948       INTEGER  NUMOB(5,4,2,4,4),KEPOB(5,4,2,4),MSTOB(5,4,2,4),
  13949      $ IDATA(MAXOBS),JRTRV(4),IQ(MXLVL,NUMQMS),IPRT(2),IRTYP(3),
  13950      $ JCAT8(4),JNDEX(4),ITYPP(2,3),IR(MXLVL,NUMQMS),IDSAT(4)
  13951       INTEGER(8) IDSDMP_8
  13952       REAL  PP(MXLVL),ZP(MXLVL),TP(MXLVL),DP(MXLVL)
  13953       REAL(8)  BMISS,obs8_8,alon_8,alat_8
  13954       COMMON/LNDSEA/GDSH(145,37),GDUS(362,91),GDNH(362,91)
  13955       COMMON/UNITNO/NFILE,IUNIT(28)
  13956       COMMON/ADP/ISATOB,PMAND(23),RDATA(MAXOBS),IPRINT
  13957       COMMON/GOSWCH/GOESND(2),GOESPW(2),GOESCT(2),KNTGIT,KNTGIS,KNTGIP,
  13958      $ KSKPGI,KNDCGI,KNOPGI,KMSGGI,KBDYGI,KTIMGI(3),KLNDGI(3),KSEAGI(3),
  13959      $ KNTGIC,KNOCTP
  13960       COMMON/RADANC/RTRAD(35),GRAD(18),IGCHN(18),SOZANG,SAZANG,OZONE,
  13961      $ SKINT,CLDAMT,TOVRAD,TOVRTV,GOESRD(2)
  13962       COMMON/CLDTOP/CLTOP(2,3)
  13963       COMMON/SATSW2/PHI(6),IRTRV(5,4,4),KTOP(5,4,4),IWINDO_e(5,4,4),
  13964      $ IWINDO_l(5,4,4),SATMST(5,4,4),ISATLS(5,4,4)
  13965       COMMON/DATA/KOUNT,IDATE(4),IDAT10,MP_PROCESS,WRMISS
  13966       COMMON/RPTHDR/SUBSET_d,STNID,HDR(2:MXWRDH),alon_8,alat_8
  13967       COMMON/SNDATA/DAT(MXLVL,NUMDAT)
  13968       COMMON/PARM6/MODPRT,IFLUA,STNPRT(3)
  13969       COMMON/PWSWCH/PWT(5),IQMPW
  13970       COMMON/SFCBFR/ALTIMR,PRSS
  13971       COMMON/SKPSUB/SUBSKP(0:255,0:200)
  13972       COMMON/DIRECT/OBS3(5,MXBLVL,7),OBS2(NUMOBS2),NOBS3(7),RDATA2(25),
  13973      $ obs8_8(2)
  13974       COMMON /BUFRLIB_MISSING/BMISS
  13975       EQUIVALENCE (DAT,PP),(DAT(1,2),ZP),(DAT(1,3),TP),(DAT(1,4),DP),
  13976      $ (DAT(1,NUMVAR+1),IQ),(RDATA,IDATA)
  13977       EQUIVALENCE  (DAT(1,NUMVAR+NUMQMS+1),IR)
  13978       DATA  JRTRV/272,99999,544,118/,IRTYP/0,99999,1/,
  13979 C               -- EVEN-1 -      -- ODD-1 --
  13980      $ CIDGST/'I','?','J','K', 'L','?','M','N',
  13981 C               -- EVEN-2 -      -- ODD-2 --
  13982      $        'O','?','P','S', 'Q','?','R','T'/,
  13983      $ XMISS/99999./,YMISS/99998.8/,IMISS/99999/
  13984      $ ITYPP/6,8,-99,-99,7,9/
  13985       DATA  JCAT8/251,252,253,254/,JNDEX/  5,  2,  3,  4/

Page 333         Source Listing                  GOESDG
2017-04-18 11:09                                 prepdata.f

  13986       PWT = XMISS
  13987 C KNTALL COUNTS NO. OF RPTS SUCESSFULLY UNPKD (MAY OR MAY NOT HAVE BEEN
  13988 C  SKIPPED)
  13989       KNTALL = 0
  13990 C KOUNT COUNTS NO. OF REPORTS SUCCESSFULLY UNPACKED AND NOT SKIPPED
  13991       KOUNT = 0
  13992 C KNTGIS COUNTS NO. OF SOUNDING/RADIANCE REPORTS ACTUALLY PROCESSED
  13993       KNTGIS= 0
  13994 C KNTGIP COUNTS NO. OF PRECIP. WATER RETRIEVALS ACTUALLY PROCESSED
  13995       KNTGIP= 0
  13996 C KNTGIC COUNTS NO. OF CLOUD TOP RETRIEVALS ACTUALLY PROCESSED
  13997       KNTGIC= 0
  13998 C INITIALIZE NUMOB, KEPOB, AND MSTOB ARRAYS
  13999       NUMOB = 0
  14000       KEPOB = 0
  14001       MSTOB = 0
  14002       IDSAT = 0
  14003       PRINT 9003, IUNIT(8)
  14004  9003 FORMAT(//32X,' ***** GOES SATELLITE SOUNDING/RETRIEVAL/RADIANCE',
  14005      $ ' FILE    UNIT =',I4,' *****')
  14006       PRINT 550, IDATE
  14007   550 FORMAT(31X,'LOOKING FOR FILE WITH CENTER DATE: ',2X,I4.4,
  14008      $ 2('-',I2.2),1X,I2.2,'Z  BASED ON PRODUCTION DATE')
  14009       IF(GOESRD(1))  PRINT 588
  14010   588 FORMAT(/49X,'==>  WILL PROCESS 5x5 RADIANCES  <==')
  14011       IF(GOESRD(2))  PRINT 688
  14012   688 FORMAT(/49X,'==>  WILL PROCESS 1x1 RADIANCES  <==')
  14013       IF(GOESND(1))  PRINT 586
  14014   586 FORMAT(/44X,'==>  WILL PROCESS 5x5 PROFILE SOUNDINGS  <==')
  14015       IF(GOESND(2))  PRINT 686
  14016   686 FORMAT(/44X,'==>  WILL PROCESS 1x1 PROFILE SOUNDINGS  <==')
  14017       IF(GOESPW(1))  PRINT 587
  14018   587 FORMAT(/44X,'==>  WILL PROCESS 5x5 PRECIPITABLE WATER  <==')
  14019       IF(GOESPW(2))  PRINT 687
  14020   687 FORMAT(/44X,'==>  WILL PROCESS 1x1 PRECIPITABLE WATER  <==')
  14021       IF(GOESCT(1))  PRINT 689
  14022   689 FORMAT(/46X,'==>  WILL PROCESS 5x5 CLOUD TOP DATA  <==')
  14023       IF(GOESCT(2))  PRINT 690
  14024   690 FORMAT(/46X,'==>  WILL PROCESS 1x1 CLOUD TOP DATA  <==')
  14025       CYCLET = IDATE(4)
  14026 C ASSUME THAT ALL MESSAGES IN BUFR DUMP FILE SHOULD BE READ AND DECODED
  14027 C  (TIME WINDOW CHECK LATER ON CAN FILTER REPORTS OUTSIDE OF
  14028 C  REQUESTED TIME LIMITS) -- SET RANGE TO - 3-HOURS + 2-HOURS
  14029       IETIME = -3
  14030       ILTIME = +2
  14031 C KNTRPT WILL COUNT NUMBER OF CALLS TO REPORT DECODER
  14032       KNTRPT = 0
  14033       IFLAG = 0
  14034       GO TO 1400
  14035 C***********************************************************************
  14036 C***********************************************************************
  14037  1410 CONTINUE
  14038 C KSKPGI WILL COUNT NO. OF DECODED REPORTS SKIPPED (VARIOUS REASONS)
  14039       KSKPGI = KSKPGI + 1
  14040  1400 CONTINUE
  14041 C INIT. GRAD, IGCHN ARRAYS ALONG W/ OTHER RADIANCE ANCILLARY INFO
  14042       GRAD   = XMISS

Page 334         Source Listing                  GOESDG
2017-04-18 11:09                                 prepdata.f

  14043       IGCHN  = IMISS
  14044       SOZANG = XMISS
  14045       SAZANG = XMISS
  14046       SKINT  = XMISS
  14047       CLDAMT = XMISS
  14048 C INIT. CLOUD TOP DATA
  14049       CLTOP  = XMISS
  14050 C ATTEMPT TO DECODE THE NEXT REPORT
  14051       IRET = 0
  14052       OBS2   = BMISS  ! initialize obs2   array before reading any rpts
  14053       OBS3   = BMISS  ! initialize obs3   array before reading any rpts
  14054       NOBS3  = 0      ! initialize nobs3  array before reading any rpts
  14055       obs8_8 = bmiss  ! initialize obs8_8 array before reading any rpts
  14056       RDATA2 = BMISS  ! initialize rdata2 array before reading any rpts
  14057       CALL W3UNPKB7(IDATE,IETIME,ILTIME,IUNIT(8),RDATA,STNID,DSNAME,
  14058      $ RDATA2,obs8_8,IDSDAT,IDSDMP_8,SUBSET_d,SUBSKP,IRET)
  14059 C.......................................................................
  14060       IF(IRET.EQ.1)  THEN
  14061          IFLAG = 1
  14062 C IRET = 1 RETURNS DATA SET INFO (ONLY) AFTER FIRST CALL
  14063          PRINT 7000, DSNAME,IDSDAT,IDSDMP_8
  14064  7000    FORMAT(//22X,'--> DATA SET INFORMATION: NAME: ',A8,'; DATE: ',
  14065      $    I10.10,'; DUMP TIME: ',I12.12,' <--'//)
  14066 C DOES DATE FROM DATA SET MATCH NCEP PRODUCTION DATE?
  14067          IF(IDSDAT.NE.IDAT10)  THEN
  14068             PRINT 324
  14069   324 FORMAT(/13X,'>>>>>   P R O B L E M :   D A T E   D O E S   N O T',
  14070      $ '   M A T C H   P R O D U C T I O N   D A T E   <<<<<'/)
  14071             RETURN
  14072          END IF
  14073          GO TO 1400
  14074 C.......................................................................
  14075       ELSE  IF(IRET.GT.2)  THEN
  14076 C ERROR DECODING THIS REPORT, GO ON TO NEXT REPORT
  14077          PRINT 572, IUNIT(8),KNTRPT+1,IRET
  14078   572    FORMAT(/' * * ERROR DECODING GOES REPORT ON UNIT',I3,' -- ',
  14079      $    'REPORT CNT. ',I5,' -- IRET ',I5,' --> GO ON TO NEXT RPT'/)
  14080          KNDCGI = KNDCGI + 1
  14081          GO TO 1410
  14082 C.......................................................................
  14083       ELSE  IF(IRET.EQ.2)  THEN
  14084 C IF IER = 2, HAVE HIT END-OF-FILE, ALL GOES REPORTS PROCESSED
  14085          IF(IFLAG.LE.0)  THEN
  14086             PRINT 8003, IUNIT(8)
  14087  8003       FORMAT(/' *** ERROR RETURNING DATA SET INFORMATION IN ',
  14088      $       'FIRST CALL TO FILE IN UNIT ',I3,' -- THIS MAY BE A NULL',
  14089      $       ' FILE -- GO TO NEXT FILE'/)
  14090          ELSE  IF(IFLAG.EQ.1)  THEN
  14091             PRINT 8002
  14092  8002    FORMAT(/' * * NO REPORTS CURRENTLY PRESENT IN THIS DATA FILE,',
  14093      $    ' GO TO NEXT FILE'/)
  14094          END IF
  14095          GO TO 110
  14096 C.......................................................................
  14097       END IF
  14098 C A REPORT WAS SUCCESSFULLY DECODED
  14099       IFLAG = 2

Page 335         Source Listing                  GOESDG
2017-04-18 11:09                                 prepdata.f

  14100       KNTRPT = KNTRPT + 1
  14101       KNTALL = KNTALL + 1
  14102 C-----------------------------------------------------------------------
  14103 C  REPORT COUNTS LATER STORED IN ARRAY: NUMOB(IBAND,INSTR,MS,NSS,NTYP)
  14104 C        WHERE: IBAND IS LAT. BAND INDEX, INSTR IS PATH TYPE INDEX
  14105 C             MS IS LAND/OCEAN SWITCH, NSS IS SAT # INDEX, AND
  14106 C     NTYP IS REPORT TYPE (=2 RAD/SNDG, =3 PW RETR., =4 CL. TOP RETR.)
  14107 C    ** WILL LATER PERFORM CHECKS SATELLITE NUMBER AND PATH FOR EACH
  14108 C    TYPE OF REPORT PROCESSED INTO PREPBUFR FILE AND TOSS IF PROBLEM **
  14109 C-----------------------------------------------------------------------
  14110 C.......................................................................
  14111 C IDENTIFY LATITUDE (PHI) BAND INDEX ---> IBAND
  14112 C.......................................................................
  14113       DO IBAND = 1,4
  14114          IF(NINT(RDATA(1)*100.).LT.(NINT(PHI(IBAND+1)*100.)-0.5))
  14115      $    GO TO 1800
  14116       ENDDO
  14117 C NOTE: IN RARE EVENT THAT LAT. MSG, IBAND SET TO 5 (RPT. LATER SKIPPED)
  14118       IBAND = 5
  14119  1800 CONTINUE
  14120 C.......................................................................
  14121 C IDENTIFY SAT. NO. INDEX ---> NSS (=1 EVEN-1 SAT.; =2 ODD-1  SAT.;
  14122 C                                   =3 EVEN-2 SAT.; =4 ODD-2  SAT.)
  14123 C IDENTIFY PATH ------> INSTR (=1 CLEAR; =3 CLOUDY; =4 UNKNOWN)
  14124 C  (NOTE: INSTR = 2 IS NOT A POSSIBILITY)
  14125 C              (BOTH BASED ON CHARACTER 8 OF STATION ID)
  14126 C.......................................................................
  14127       DO II = 1,4
  14128          DO JJ = 1,4
  14129             IF(STNID(8:8).EQ.CIDGST(JJ,II))  GO TO 1501
  14130          ENDDO
  14131       ENDDO
  14132 C. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .
  14133 C IF SATELLITE NUMBER/ PATH NOT RECOGNIZED, SKIP REPORT
  14134       KNOPGI = KNOPGI + 1
  14135       PRINT 8758, STNID,RDATA(1),RDATA(2)
  14136  8758 FORMAT(' * * DECODED REPORT TOSSED-ID=',A8,', LAT=',F7.2,'N, ',
  14137      $ 'LON=',F8.2,'E - SATELLITE NUMBER/PATH NOT RECOGNIZED')
  14138       GO TO 1410
  14139 C. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .
  14140  1501 CONTINUE
  14141       NSS   = II
  14142       INSTR = JJ
  14143       IDSAT(NSS) = IDATA(6)
  14144 C.......................................................................
  14145 C IDENTIFY OVERLAND/OCEANIC SWITCH ---> MS (=1 OVERLAND; =2 OCEANIC)
  14146 C.......................................................................
  14147       MS = 2
  14148       IF(NINT(RDATA(1)*100.).LT.0)  THEN
  14149          CALL LNDCHK(RDATA(1),RDATA(2),1,4,2,GDSH,145,37,0.5,ILAND)
  14150       ELSE
  14151          CALL LNDCHK(RDATA(1),RDATA(2),1,4,2,GDNH,362,91,0.5,ILAND)
  14152       END IF
  14153       IF(ILAND.NE.0)  MS = 1
  14154 C.......................................................................
  14155 C CALL CHKREP TO CHECK DECODED RPT FOR MSG LAT/LON OR O-SIDE SEARCH AREA
  14156 C  (WILL APPLY RESULT OF CHECK LATER IN EACH INDIVIDUAL PROCESSED RPT)

Page 336         Source Listing                  GOESDG
2017-04-18 11:09                                 prepdata.f

  14157       KFLG_CHKREP = 0
  14158       CALL CHKREP(KMSGGI,KBDYGI,*1078)


ENTRY POINTS

  Name               
                     
 goesdg_             


SYMBOL CROSS REFERENCE

 Name                       Object Declared Type            Bytes Dimen Elements Attributes       References                        
                                                                                                                                    
 1078                       Label  14160                                                          14158                             
 1079                       Label  14162                                                          14159                             
 110                        Label  14562                                                          14095                             
 13                         Label  14342                                                          14188,14306                       
 14                         Label  14362                                                          14354,14359                       
 1400                       Label  14040                                                          14034,14073,14561                 
 1410                       Label  14037                                                          14081,14138,14560                 
 15                         Label  14364                                                          14361                             
 1501                       Label  14140                                                          14129                             
 1800                       Label  14119                                                          14115                             
 1811                       Label  14485                                                          14403,14446                       
 1903                       Label  14323                                                          14322                             
 1911                       Label  14556                                                          14508                             
 324                        Label  14069                                                          14068                             
 550                        Label  14007                                                          14006                             
 572                        Label  14078                                                          14077                             
 586                        Label  14014                                                          14013                             
 587                        Label  14018                                                          14017                             
 588                        Label  14010                                                          14009                             
 686                        Label  14016                                                          14015                             
 687                        Label  14020                                                          14019                             
 688                        Label  14012                                                          14011                             
 689                        Label  14022                                                          14021                             
 690                        Label  14024                                                          14023                             
 7000                       Label  14064                                                          14063                             
 7901                       Label  14333                                                          14331                             
 7902                       Label  14336                                                          14335                             
 8002                       Label  14092                                                          14091                             
 8003                       Label  14087                                                          14086                             
 8758                       Label  14136                                                          14135                             
 899                        Label  14326                                                          14325                             
 9003                       Label  14004                                                          14003                             
 950                        Label  14566                                                          14565                             
 9757                       Label  14200                                                          14199                             
 9758                       Label  14230                                                          14229                             
 9759                       Label  14234                                                          14233                             
 9954                       Label  14297                                                          14296                             
 9955                       Label  14302                                                          14301                             
 9985                       Label  14443                                                          14442                             
 9986                       Label  14449                                                          14448                             
 9987                       Label  14472                                                          14471                             
 9988                       Label  14477                                                          14476                             

Page 337         Source Listing                  GOESDG
2017-04-18 11:09 Symbol Table                    prepdata.f

 Name                       Object Declared Type            Bytes Dimen Elements Attributes       References                        
                                                                                                                                    
 ADP                        Common 13956                                14100                                                       
 ALAT_8                     Scalar 13953    R(8)            8           scalar   COM                                                
 ALON_8                     Scalar 13953    R(8)            8           scalar   COM                                                
 ALTIMR                     Scalar 13970    R(4)            4           scalar   COM                                                
 BMISS                      Scalar 13953    R(8)            8           scalar   COM              14052,14053,14055,14056           
 BUFRLIB_MISSING            Common 13974                                8                                                           
 CHKREP                     Subr   14158                                                          14158                             
 CIDGST                     Local  13945    CHAR            1     2     16                        13980,14129                       
 CLDAMT                     Scalar 13961    R(4)            4           scalar   COM              14047,14217                       
 CLDTOP                     Common 13962                                24                                                          
 CLTOP                      Scalar 13962    R(4)            4     2     6        COM              14049,14519,14521,14522,14523,1452
                                                                                                  7                                 
 CYCLET                     Local  14025    R(4)            4           scalar                    14025,14167                       
 DAT                        Scalar 13967    R(4)            4     2     9600     COM              14248,14331                       
 DATA                       Common 13965                                32                                                          
 DEWPT                      Local  14273    R(4)            4           scalar                    14273,14277                       
 DIRECT                     Common 13972                                36016                                                       
 DP                         Scalar 13952    R(4)            4     1     600      COM              14277                             
 DSNAME                     Local  13946    CHAR            8           scalar                    14057,14063                       
 FILLX                      Subr   14346                                                          14346,14535                       
 GDNH                       Scalar 13954    R(4)            4     2     32942    COM              14151                             
 GDSH                       Scalar 13954    R(4)            4     2     5365     COM              14149                             
 GDUS                       Scalar 13954    R(4)            4     2     32942    COM                                                
 GETPWATER                  Subr   14457                                                          14457                             
 GOESCHK                    Subr   14185                                                          14185,14400,14505                 
 GOESCT                     Scalar 13947    L(4)            4     1     2        COM              14021,14023,14494,14495           
 GOESDG                     Subr   13913                                                                                            
 GOESND                     Scalar 13947    L(4)            4     1     2        COM              14013,14015,14180,14181,14228,1424
                                                                                                  1                                 
 GOESPW                     Scalar 13947    L(4)            4     1     2        COM              14017,14019,14384,14385           
 GOESRD                     Scalar 13947    L(4)            4     1     2        COM              14009,14011,14180,14181,14190     
 GOSWCH                     Common 13957                                100                                                         
 GRAD                       Scalar 13960    R(4)            4     1     18       COM              14042,14207                       
 HDR                        Scalar 13966    R(4)            4     1     14       COM              14185,14239,14400,14505,14534     
 I                          Local  14204    I(4)            4           scalar                    14204,14206,14207,14211,14512     
 IBAND                      Local  14113    I(4)            4           scalar                    14113,14114,14118,14183,14186,1418
                                                                                                  7,14259,14274,14369,14370,14371,14
                                                                                                  398,14401,14402,14463,14503,14506,
                                                                                                  14507,14544                       
 IDAT10                     Scalar 13965    I(4)            4           scalar   COM              14067                             
 IDATA                      Scalar 13949    I(4)            4     1     3500     COM              14143,14195,14196,14197,14198,1419
                                                                                                  9,14206,14209,14210,14211,14246,14
                                                                                                  252,14253,14254,14255,14408,14409,
                                                                                                  14411,14510,14511,14512           
 IDATE                      Scalar 13965    I(4)            4     1     4        COM              14006,14025,14057                 
 IDSAT                      Local  13950    I(4)            4     1     4                         14002,14143,14571                 
 IDSDAT                     Local  14058    I(4)            4           scalar                    14058,14063,14067                 
 IDSDMP_8                   Local  13951    I(8)            8           scalar                    14058,14063                       
 IERF                       Local  14346    I(4)            4           scalar                    14346,14347,14457,14458,14535,1453
                                                                                                  6                                 
 IERG                       Local  14187    I(4)            4           scalar                    14187,14188,14402,14403,14507,1450
                                                                                                  8                                 
 IETIME                     Local  14029    I(4)            4           scalar                    14029,14057                       
 IFLAG                      Local  14033    I(4)            4           scalar                    14033,14061,14085,14090,14099     
 IFLUA                      Scalar 13968    I(4)            4           scalar   COM              14187,14402,14457,14507,14523     

Page 338         Source Listing                  GOESDG
2017-04-18 11:09 Symbol Table                    prepdata.f

 Name                       Object Declared Type            Bytes Dimen Elements Attributes       References                        
                                                                                                                                    
 IGCHN                      Scalar 13960    I(4)            4     1     18       COM              14043,14206,14375                 
 II                         Local  14127    I(4)            4           scalar                    14127,14129,14141,14254,14256,1425
                                                                                                  7,14259,14262,14265,14266,14267,14
                                                                                                  269,14270,14271,14273,14274,14275,
                                                                                                  14278,14409,14412,14413,14414,1441
                                                                                                  8,14419,14420,14424,14425,14426   
 ILAND                      Local  14149    I(4)            4           scalar                    14149,14151,14153                 
 ILTIME                     Local  14030    I(4)            4           scalar                    14030,14057                       
 IMISS                      Local  13983    I(4)            4           scalar                    13983,14043                       
 INSTR                      Local  14142    I(4)            4           scalar                    14142,14183,14185,14239,14369,1437
                                                                                                  0,14371,14398,14400,14457,14463,14
                                                                                                  503,14505,14544                   
 IPRINT                     Scalar 13956    I(4)            4           scalar   COM                                                
 IPRT                       Local  13949    I(4)            4     1     2                         14313,14314,14316,14317,14320,1432
                                                                                                  1,14354,14359                     
 IQ                         Scalar 13949    I(4)            4     2     3000     COM              14249,14264,14267,14271,14278,1428
                                                                                                  1,14285,14286,14287,14331         
 IQBEST                     Local  14240    I(4)            4           scalar                    14240,14281,14370                 
 IQMPW                      Scalar 13969    I(4)            4           scalar   COM              14407,14426                       
 IR                         Scalar 13950    I(4)            4     2     3000     COM              14251,14331                       
 IRET                       Local  14051    I(4)            4           scalar                    14051,14058,14060,14075,14077,1408
                                                                                                  3                                 
 IRTRV                      Scalar 13963    I(4)            4     3     80       COM              14187,14402,14507                 
 IRTYP                      Local  13949    I(4)            4     1     3                         13978,14239                       
 ISATLS                     Scalar 13964    I(4)            4     3     80       COM              14187,14402,14507                 
 ISATOB                     Scalar 13956    I(4)            4           scalar   COM                                                
 ITYPP                      Local  13950    I(4)            4     2     6                         13984,14457                       
 IUNIT                      Scalar 13955    I(4)            4     1     28       COM              14003,14057,14077,14086,14168     
 IWINDO_E                   Scalar 13963    I(4)            4     3     80       COM              14186,14401,14506                 
 IWINDO_L                   Scalar 13964    I(4)            4     3     80       COM              14186,14401,14506                 
 J                          Local  14195    I(4)            4           scalar                    14195,14205,14206,14207           
 JCAT8                      Local  13950    I(4)            4     1     4                         13985,14424                       
 JJ                         Local  14128    I(4)            4           scalar                    14128,14129,14142                 
 JNDEX                      Local  13950    I(4)            4     1     4                         13985,14425                       
 JRTRV                      Local  13949    I(4)            4     1     4                         13978                             
 K                          Local  14331    I(4)            4           scalar                    14331                             
 KBDYGI                     Scalar 13958    I(4)            4           scalar   COM              14158                             
 KEPOB                      Local  13948    I(4)            4     4     160                       14000,14369,14463,14544,14571     
 KFLG_CHKREP                Local  14157    I(4)            4           scalar                    14157,14161,14185,14400,14505     
 KLNDGI                     Scalar 13958    I(4)            4     1     3        COM                                                
 KMSGGI                     Scalar 13958    I(4)            4           scalar   COM              14158                             
 KNDCGI                     Scalar 13958    I(4)            4           scalar   COM              14080                             
 KNOCTP                     Scalar 13959    I(4)            4           scalar   COM              14550                             
 KNOPGI                     Scalar 13958    I(4)            4           scalar   COM              14134                             
 KNTALL                     Local  13989    I(4)            4           scalar                    13989,14101,14565                 
 KNTGIC                     Scalar 13959    I(4)            4           scalar   COM              13997,14545                       
 KNTGIP                     Scalar 13957    I(4)            4           scalar   COM              13995,14460                       
 KNTGIS                     Scalar 13957    I(4)            4           scalar   COM              13993,14366                       
 KNTGIT                     Scalar 13957    I(4)            4           scalar   COM              14568                             
 KNTRPT                     Local  14032    I(4)            4           scalar                    14032,14077,14100                 
 KOUNT                      Scalar 13965    I(4)            4           scalar   COM              13991,14225,14312,14316,14348,1445
                                                                                                  6,14467,14532,14539,14568         
 KSEAGI                     Scalar 13958    I(4)            4     1     3        COM                                                
 KSKPGI                     Scalar 13958    I(4)            4           scalar   COM              14039                             
 KTIMGI                     Scalar 13958    I(4)            4     1     3        COM                                                

Page 339         Source Listing                  GOESDG
2017-04-18 11:09 Symbol Table                    prepdata.f

 Name                       Object Declared Type            Bytes Dimen Elements Attributes       References                        
                                                                                                                                    
 KTOP                       Scalar 13963    I(4)            4     3     80       COM              14259                             
 L8                         Local  14210    I(4)            4           scalar                    14210,14212,14213,14214,14215,1421
                                                                                                  6,14217,14218,14219,14220,14221,14
                                                                                                  511,14513,14514,14516,14518,14519,
                                                                                                  14520,14521                       
 LNDCHK                     Subr   14149                                                          14149,14151                       
 LNDSEA                     Common 13954                                284996                                                      
 LOOP1                      Label  14411                                scalar                    14416,14418,14419,14420,14421,1442
                                                                                                  8,14431                           
 LOOP1N1                    Label  14423                                scalar                    14430                             
 MATCH                      Local  14410    I(4)            4           scalar                    14410,14421,14422,14427           
 MAX                        Func   14197                                scalar                    14197,14285,14286,14287,14434,1447
                                                                                                  0                                 
 MAXOBS                     Param  13943    I(4)            4           scalar                    13949,13956                       
 MIN                        Func   14281                                scalar                    14281,14311,14435                 
 MOD                        Func   14316                                scalar                    14316                             
 MODPRT                     Scalar 13968    I(4)            4           scalar   COM              14316,14317                       
 MP_PROCESS                 Scalar 13965    I(4)            4           scalar   COM                                                
 MS                         Local  14147    I(4)            4           scalar                    14147,14153,14183,14185,14239,1436
                                                                                                  9,14370,14371,14398,14400,14457,14
                                                                                                  463,14503,14505,14544             
 MSTOB                      Local  13948    I(4)            4     4     160                       14001,14370,14371,14571           
 MXBLVL                     Param  13942    I(4)            4           scalar                    13972                             
 MXLVL                      Param  13939    I(4)            4           scalar                    13949,13950,13952,13967           
 MXWRDH                     Param  13938    I(4)            4           scalar                    13966                             
 N                          Local  14255    I(4)            4           scalar                    14255,14282,14331,14332,14411     
 NCT                        Local  14172    I(4)            4           scalar                    14172,14524,14529,14540,14560     
 NFILE                      Scalar 13955    I(4)            4           scalar   COM              14168                             
 NINT                       Func   14114                                scalar                    14114,14148,14213,14214,14216,1421
                                                                                                  7,14218,14220,14253,14259,14262,14
                                                                                                  266,14267,14270,14271,14273,14275,
                                                                                                  14278,14413,14418,14419,14424,1442
                                                                                                  6,14435,14436,14439,14441,14514,14
                                                                                                  516,14518,14520                   
 NLEV                       Local  14170    I(4)            4           scalar                    14170,14261,14262,14264,14266,1426
                                                                                                  7,14270,14271,14277,14278,14281,14
                                                                                                  285,14286,14287,14291,14332,14343,
                                                                                                  14351,14354,14355,14359,14363,1436
                                                                                                  5,14456,14467,14532,14539,14560   
 NN                         Local  14423    I(4)            4           scalar                    14423,14424,14425,14427,14570,1457
                                                                                                  1                                 
 NOBS3                      Scalar 13972    I(4)            4     1     7        COM              14054                             
 NPW                        Local  14171    I(4)            4           scalar                    14171,14461,14532,14539,14560     
 NRAD                       Local  14169    I(4)            4           scalar                    14169,14226,14295,14312,14343,1434
                                                                                                  9,14351,14355,14365,14456,14467,14
                                                                                                  532,14539,14560                   
 NRADL                      Local  14197    I(4)            4           scalar                    14197,14204                       
 NSS                        Local  14141    I(4)            4           scalar                    14141,14143,14183,14186,14187,1425
                                                                                                  9,14274,14398,14401,14402,14503,14
                                                                                                  506,14507                         
 NSTRT                      Local  14422    I(4)            4           scalar                    14422,14423                       
 NUMDAT                     Param  13941    I(4)            4           scalar                    13967                             
 NUMOB                      Local  13948    I(4)            4     5     640                       13999,14183,14398,14503,14571     
 NUMOBS2                    Param  13944    I(4)            4           scalar                    13972                             
 NUMQMS                     Param  13940    I(4)            4           scalar                    13941,13949,13950,13977           

Page 340         Source Listing                  GOESDG
2017-04-18 11:09 Symbol Table                    prepdata.f

 Name                       Object Declared Type            Bytes Dimen Elements Attributes       References                        
                                                                                                                                    
 NUMVAR                     Param  13940    I(4)            4           scalar                    13941,13976,13977                 
 OBS2                       Scalar 13972    R(4)            4     1     43       COM              14052                             
 OBS3                       Scalar 13972    R(4)            4     3     8925     COM              14053                             
 OBS8_8                     Scalar 13953    R(8)            8     1     2        COM              14055,14058                       
 OZONE                      Scalar 13960    R(4)            4           scalar   COM                                                
 PARM6                      Common 13968                                32                                                          
 PBOT                       Local  14245    R(4)            4           scalar                    14245,14253,14311                 
 PHI                        Scalar 13963    R(4)            4     1     6        COM              14114                             
 PMAND                      Scalar 13956    R(4)            4     1     23       COM              14259                             
 PP                         Scalar 13952    R(4)            4     1     600      COM              14262                             
 PRSS                       Scalar 13970    R(4)            4           scalar   COM              14406,14414                       
 PSTA                       Local  14311    R(4)            4           scalar                    14311,14354,14359                 
 PWSWCH                     Common 13969                                24                                                          
 PWT                        Scalar 13969    R(4)            4     1     5        COM              13986,14405,14425,14434,14435,1443
                                                                                                  6,14438,14439,14441,14448,14452,14
                                                                                                  470                               
 RADANC                     Common 13960                                320                                                         
 RDATA                      Scalar 13956    R(4)            4     1     3500     COM              14057,14114,14135,14148,14149,1415
                                                                                                  1,14199,14207,14213,14214,14215,14
                                                                                                  216,14217,14218,14219,14220,14221,
                                                                                                  14229,14233,14252,14253,14257,1425
                                                                                                  9,14262,14265,14266,14267,14269,14
                                                                                                  270,14271,14273,14274,14275,14278,
                                                                                                  14296,14301,14413,14414,14418,1441
                                                                                                  9,14420,14424,14425,14426,14442,14
                                                                                                  448,14471,14476,14514,14516,14518,
                                                                                                  14519,14520,14521                 
 RDATA2                     Scalar 13972    R(4)            4     1     25       COM              14056,14058,14527                 
 RPTHDR                     Common 13966                                88                                                          
 RPTLBL                     Subr   14167                                                          14167                             
 RTRAD                      Scalar 13960    R(4)            4     1     35       COM                                                
 SATMST                     Scalar 13947    L(4)            4     3     80       COM              14274                             
 SATSW2                     Common 13963                                1944                                                        
 SAZANG                     Scalar 13960    R(4)            4           scalar   COM              14045,14221                       
 SFCBFR                     Common 13970                                8                                                           
 SKINT                      Scalar 13961    R(4)            4           scalar   COM              14046,14215                       
 SKPSUB                     Common 13971                                205824                                                      
 SNDATA                     Common 13967                                38400                                                       
 SNDTBL                     Subr   14571                                                          14571                             
 SOZANG                     Scalar 13960    R(4)            4           scalar   COM              14044,14219                       
 STNID                      Scalar 13946    CHAR            8           scalar   COM              14057,14129,14135,14180,14181,1419
                                                                                                  9,14229,14233,14296,14301,14319,14
                                                                                                  322,14384,14385,14442,14448,14471,
                                                                                                  14476,14494,14495                 
 STNPRT                     Scalar 13946    CHAR            8     1     3        COM              14319,14320                       
 STOROB                     Subr   14354                                                          14354,14359                       
 SUBSET_D                   Scalar 13946    CHAR            8           scalar   COM              14058,14179,14383,14493           
 SUBSKP                     Scalar 13971    R(4)            4     2     51456    COM              14058                             
 TOVRAD                     Scalar 13961    R(4)            4           scalar   COM                                                
 TOVRTV                     Scalar 13961    R(4)            4           scalar   COM                                                
 TP                         Scalar 13952    R(4)            4     1     600      COM              14270                             
 UNITNO                     Common 13955                                116                                                         
 W3UNPKB7                   Subr   14057                                                          14057                             
 WRMISS                     Scalar 13965    R(4)            4           scalar   COM                                                
 XMISS                      Local  13983    R(4)            4           scalar                    13983,13986,14042,14044,14045,1404

Page 341         Source Listing                  GOESDG
2017-04-18 11:09 Symbol Table                    prepdata.f

 Name                       Object Declared Type            Bytes Dimen Elements Attributes       References                        
                                                                                                                                    
                                                                                                  6,14047,14049,14245,14248,14405,14
                                                                                                  406,14414                         
 YMISS                      Local  13983    R(4)            4           scalar                    13983,14252,14257,14265,14269,1427
                                                                                                  4,14420,14434,14470,14527         
 ZP                         Scalar 13952    R(4)            4     1     600      COM              14266                             

Page 342         Source Listing                  GOESDG
2017-04-18 11:09                                 prepdata.f

  14159       GO TO 1079
  14160  1078 CONTINUE
  14161       KFLG_CHKREP = 1
  14162  1079 CONTINUE
  14163 C-----------------------------------------------------------------------
  14164 C CALL SUBR. 'RPTLBL' TO STORE REPORT HEADER INTO HDR(4),HDR(5),HDR(7),
  14165 C                          HDR(9)-HDR(15), ALAT_8, ALON_8
  14166 C-----------------------------------------------------------------------
  14167       CALL RPTLBL(CYCLET)
  14168       NFILE = IUNIT(8)
  14169       NRAD = 0
  14170       NLEV = 0
  14171       NPW  = 0
  14172       NCT  = 0
  14173 C***********************************************************************
  14174 C            SOUNDING AND/OR RADIANCE REPORT IS PROCESSED HERE
  14175 C     (NOTE 1: 1x1 FOV HAVE "H" IN CHAR. 1 OF STNID; 5x5 FOV DO NOT)
  14176 C  (NOTE 2: ASSUMED TO BE ONLY IN INPUT MSG TYPES NC003001 OR NC003003)
  14177 C
  14178 C***********************************************************************
  14179       IF(SUBSET_d.EQ.'NC003001'.OR.SUBSET_d.EQ.'NC003003') THEN
  14180       IF(((GOESRD(1).OR.GOESND(1)).AND.STNID(1:1).NE.'H').OR.
  14181      $   ((GOESRD(2).OR.GOESND(2)).AND.STNID(1:1).EQ.'H'))  THEN
  14182 C NUMOB ACCUMULATES TOTAL NUMBER OF REPORTS
  14183          NUMOB(IBAND,INSTR,MS,NSS,2) = NUMOB(IBAND,INSTR,MS,NSS,2) + 1
  14184 C CALL SUBR. GOESCHK TO PERFORM CHECKS ON THE REPORT
  14185          CALL GOESCHK(1,KFLG_CHKREP,MS,INSTR,HDR(4),
  14186      $    IWINDO_e(IBAND,NSS,2),IWINDO_l(IBAND,NSS,2),
  14187      $    ISATLS(IBAND,NSS,2),IRTRV(IBAND,NSS,2),IFLUA,IERG)
  14188          IF(IERG.EQ.1) GO TO 13
  14189 C REPORT HAS PASSED ALL CHECKS
  14190          IF(GOESRD(1).OR.GOESRD(2))  THEN
  14191 C-----------------------------------------------------------------------
  14192 C                   PROCESS RADIANCE PART OF REPORT
  14193 C     (INCLUDES ANCILLARY INFORMATION FOUND IN DATA LEVEL CAT. 8)
  14194 C-----------------------------------------------------------------------
  14195             J = IDATA(42) - 3
  14196             IF(IDATA(41).GT.0)  THEN
  14197                NRADL = MAX(IDATA(41),18)
  14198                IF(IDATA(41).NE.18)  THEN
  14199                   PRINT 9757, STNID,RDATA(1),RDATA(2),IDATA(41)
  14200  9757 FORMAT(' # # RADIANCE REPORT PROB.-ID=',A8,', LAT=',F7.2,'N, ',
  14201      $ 'LON=',F8.2,'E - NUMBER OF CHANNELS=',I2,'(NOT 18); ONLY 1-18 ',
  14202      $ 'PROCESSED')
  14203                END IF
  14204                DO I = 1,NRADL
  14205                   J = J + 3
  14206                   IGCHN(I) = IDATA(J)
  14207                   GRAD(I)  = RDATA(J+1)
  14208                ENDDO
  14209                IF(IDATA(27).GT.0)  THEN
  14210                   L8 = IDATA(28) - 4
  14211                   DO I = 1,IDATA(27)
  14212                      L8 = L8 + 4
  14213                      IF(NINT(RDATA(L8+1)).LT.255) CYCLE
  14214                      IF(NINT(RDATA(L8+1)).EQ.255)  THEN
  14215                         SKINT = RDATA(L8)

Page 343         Source Listing                  GOESDG
2017-04-18 11:09                                 prepdata.f

  14216                      ELSE  IF(NINT(RDATA(L8+1)).EQ.258)  THEN
  14217                         CLDAMT = NINT(RDATA(L8))
  14218                      ELSE  IF(NINT(RDATA(L8+1)).EQ.260)  THEN
  14219                         SOZANG = RDATA(L8)
  14220                      ELSE  IF(NINT(RDATA(L8+1)).EQ.261)  THEN
  14221                         SAZANG = RDATA(L8)
  14222                      END IF
  14223                   ENDDO
  14224                END IF
  14225                KOUNT = KOUNT + 1
  14226                NRAD = 1
  14227             ELSE
  14228                IF(.NOT.GOESND(1).AND..NOT.GOESND(2))  THEN
  14229                   PRINT 9758, STNID,RDATA(1),RDATA(2)
  14230  9758 FORMAT(' * * TOT. RPT TOSSED- STNID = ',A8,'(SNDG/RADIANCE) @ ',
  14231      $ 'LAT = ',F6.2,' N  LON = ',F7.2,' E    -- NO RADIANCES FOUND')
  14232                ELSE
  14233                   PRINT 9759, STNID,RDATA(1),RDATA(2)
  14234  9759 FORMAT(' # # RAD. PART SKPPD- STNID = ',A8,'(SNDG/RADIANCE) @ ',
  14235      $ 'LAT = ',F6.2,' N  LON =',F8.2,' E    -- NO RADIANCES FOUND')
  14236                END IF
  14237             END IF
  14238          END IF
  14239          HDR(6) = 164 + (10 * (MS - 1)) + IRTYP(INSTR)
  14240          IQBEST = 99
  14241          IF(GOESND(1).OR.GOESND(2))  THEN
  14242 C-----------------------------------------------------------------------
  14243 C              PROCESS SOUNDING (PROFILE) PART OF REPORT
  14244 C-----------------------------------------------------------------------
  14245             PBOT = XMISS
  14246             IF(IDATA(39).GT.0)  THEN
  14247 C INITIALIZE DAT AND IQ ARRAYS
  14248                DAT = XMISS
  14249                IQ  = 16
  14250 C INITIALIZE ALL REASON CODES AS 100 (ORIGINAL DATA)
  14251                IR = 100
  14252                IF(RDATA(IDATA(40)).LT.YMISS)
  14253      $          PBOT = NINT(RDATA(IDATA(40))) * 0.1
  14254                II = IDATA(40) - 9
  14255                DO N = 1,IDATA(39)
  14256                   II = II + 9
  14257                   IF(RDATA(II).GE.YMISS)  CYCLE
  14258 C LEVELS ABOVE PMAND(KTOP(IBAND,NSS,2)) ARE NOT PROCESSED
  14259                   IF(NINT(RDATA(II))*0.1.LT.PMAND(KTOP(IBAND,NSS,2)))
  14260      $             EXIT
  14261                   NLEV = NLEV + 1
  14262                   PP(NLEV) = NINT(RDATA(II)) * 0.1
  14263 C PREPBUFR TBL VALUE FOR VRT. COORD. (PRESS) SET TO DEF.(2)
  14264                   IQ(NLEV,5) = 2
  14265                   IF(RDATA(II+1).LT.YMISS)  THEN
  14266                      ZP(NLEV) = NINT(RDATA(II+1))
  14267                      IQ(NLEV,1) = NINT(RDATA(II+6))
  14268                   END IF
  14269                   IF(RDATA(II+2).LT.YMISS)  THEN
  14270                      TP(NLEV) = (NINT(RDATA(II+2)) * 0.1) + 273.16
  14271                      IQ(NLEV,2) = NINT(RDATA(II+7))
  14272                   END IF

Page 344         Source Listing                  GOESDG
2017-04-18 11:09                                 prepdata.f

  14273                   DEWPT = (NINT(RDATA(II+3)) * 0.1) + 273.16
  14274                   IF(SATMST(IBAND,NSS,2).AND.RDATA(II+3).LT.YMISS.AND.
  14275      $             NINT(RDATA(II)).GE.1000)  THEN
  14276 C DWPT MUST BE ON PRESSURE .GE. 100 MB TO BE PROCESSED
  14277                      DP(NLEV) = DEWPT
  14278                      IQ(NLEV,3) = NINT(RDATA(II+8))
  14279                   END IF
  14280 C IQBEST: BEST (LOWEST) MOISTURE PREPBUFR TBL V. AMONGST ALL VALID LVLS
  14281                   IQBEST = MIN(IQ(NLEV,3),IQBEST)
  14282                   IF(N.EQ.1)  THEN
  14283 C IF THIS IS THE 1ST (SFC) LVL & SEQNLT=T, SET PREPBUFR TBL VALUE TO AT
  14284 C  BEST SUSPECT (3) FOR ALL DATA ON THIS LEVEL
  14285                      IQ(NLEV,1) = MAX(IQ(NLEV,1),3)
  14286                      IQ(NLEV,2) = MAX(IQ(NLEV,2),3)
  14287                      IQ(NLEV,3) = MAX(IQ(NLEV,3),3)
  14288                   END IF
  14289                ENDDO
  14290             END IF
  14291             IF(NLEV.LT.1)  THEN
  14292 C.......................................................................
  14293 C IF NLEV IS 0 (SHOULD NEVER HAPPEN), SKIP SOUNDING PART OF REPORT (MAY
  14294 C  STILL HAVE RADIANCE PART) AND PRINT DIAGNOSTIC
  14295                IF(NRAD.EQ.0)  THEN
  14296                   PRINT 9954, STNID,RDATA(1),RDATA(2)
  14297  9954 FORMAT(' * * TOT. RPT TOSSED- STNID = ',A8,'(SNDG/RADIANCE) @ ',
  14298      $ 'LAT = ',F6.2,' N  LON = ',F7.2,' E    -- NO LVLS PROCESSED IN ',
  14299      $ 'SUBR. GOESDG')
  14300                ELSE
  14301                   PRINT 9955, STNID,RDATA(1),RDATA(2)
  14302  9955 FORMAT(' # # SNDG PART SKPPD- STNID = ',A8,'(SNDG/RADIANCE) @ ',
  14303      $ 'LAT = ',F6.2,' N  LON = ',F7.2,' E    -- NO LVLS PROCESSED IN ',
  14304      $ 'SUBR. GOESDG')
  14305                END IF
  14306                GO TO 13
  14307 C.......................................................................
  14308             END IF
  14309 C PSTA HOLDS SURFACE (STN) PRESSURE, PBOT; IF PBOT IS MSG SET PSTA TO
  14310 C  1099.50 SO NO OTHER LEVEL WILL EVER MATCH IT
  14311             PSTA = MIN(PBOT,1099.50)
  14312             IF(NRAD.EQ.0)  KOUNT = KOUNT + 1
  14313             IPRT(1) = 0
  14314             IPRT(2) = 0
  14315 C PRINT OUT COMPLETE LISTING OF REPORT (BASED ON MODPRT)
  14316             IF(MOD((KOUNT-1),MODPRT).EQ.0)  IPRT(1) = 1
  14317             IF(MODPRT.LT.0)  IPRT(1) = 0
  14318 C ALSO, CAN PRINT OUT COMPLETE LISTING FOR SPECIFIC REPORT(S)
  14319             IF(STNID.EQ.STNPRT(1).OR.STNID.EQ.STNPRT(2).OR.STNID.EQ.
  14320      $       STNPRT(3))  IPRT(2) = 1
  14321             IF(IPRT(1).EQ.1.OR.IPRT(2).EQ.1)  THEN
  14322                PRINT 1903, STNID
  14323  1903 FORMAT(//32X,'>>> COMPLETE LISTING OF SOUNDING DATA FOR STATION ',
  14324      $ 'ID ',A8,' <<<',//)
  14325                PRINT 899
  14326   899 FORMAT(2X,'PRESSURE',6X,'HEIGHT',4X,'TEMPERATURE',4X,'DEWPOINT',
  14327      $ 4X,'U-WIND',7X,'V-WIND',5X,'HGHT',5X,'TEMP',5X,'DEWPOINT',5X,
  14328      $ 'WIND',3X,'VERT. COORD.'/4X,'(MB)',9X,'(GPM)',8X,'(K)',9X,
  14329      $ '(K)',9X,'(M/S)',8X,'(M/S)',4X,'TV/RC',4X,'TV/RC',6X,'TV/RC',6X,

Page 345         Source Listing                  GOESDG
2017-04-18 11:09                                 prepdata.f

  14330      $ 'TV/RC',6X,'TV/RC'/)
  14331                PRINT 7901, ((DAT(N,K),K=1,6),(IQ(N,K),IR(N,K),K=1,5),
  14332      $          N=1,NLEV)
  14333  7901 FORMAT(1X,F8.2,F13.2,F13.2,F11.2,F14.2,F13.2,I5,'/',I3,I5,'/',I3,
  14334      $    I7,'/',I3,I7,'/',I3,I7,'/',I3)
  14335                PRINT 7902
  14336  7902          FORMAT(//)
  14337             END IF
  14338          END IF
  14339 C-----------------------------------------------------------------------
  14340       END IF
  14341       END IF
  14342    13 CONTINUE
  14343       IF(NRAD.EQ.1.AND.NLEV.EQ.0)  THEN
  14344 C COME HERE WHEN SNDG/RAD REPORT HAS ONLY A RADIANCE PART
  14345 C CALL FILLX TO PROCESS RADIANCE DATA
  14346          CALL FILLX(-1,IERF)
  14347          IF(IERF.EQ.1)  THEN
  14348             KOUNT = KOUNT - 1
  14349             NRAD = 0
  14350          END IF
  14351       ELSE IF(NRAD.EQ.0.AND.NLEV.GT.0)  THEN
  14352 C COME HERE WHEN SNDG/RAD REPORT HAS ONLY A SOUNDING PART
  14353 C CALL SUBR. 'STOROB' TO WRITE REPORT PIECES FROM SOUNDING IN MOBS ARRAY
  14354          CALL STOROB(NLEV,PSTA,0,IPRT,*14)
  14355       ELSE  IF(NRAD.EQ.1.AND.NLEV.GT.0)  THEN
  14356 C COME HERE WHEN SNDG/RAD REPORT HAS BOTH A SOUNDING AND RADIANCE PART
  14357 C CALL SUBR. 'STOROB' TO WRITE REPORT PIECES FROM SOUNDING IN MOBS ARRAY
  14358 C  AND PROCESS RADIANCE PART AS WELL
  14359          CALL STOROB(NLEV,PSTA,0,IPRT,*14)
  14360       END IF
  14361       GO TO 15
  14362    14 CONTINUE
  14363       NLEV = 0
  14364    15 CONTINUE
  14365       IF(NLEV+NRAD.GT.0)  THEN
  14366          KNTGIS = KNTGIS + 1
  14367 C KEPOB ACCUM. NO. OF RPTS PROCESSED AND MSTOB ACCUM. NO. OF RPTS WITH
  14368 C  RETR. MOISTURE PROCESSED, BOTH ACCORDING TO OVERLAND OR OCEANIC
  14369          KEPOB(IBAND,INSTR,MS,2) = KEPOB(IBAND,INSTR,MS,2) + 1
  14370          IF(IQBEST.LT.16) MSTOB(IBAND,INSTR,MS,2) =
  14371      $    MSTOB(IBAND,INSTR,MS,2)+1
  14372       END IF
  14373 C SET IGCHN(1) = -99999 TO SIGNAL ANY SUBSEQUENT CALLS TO SUBR.
  14374 C  FILLX FOR THIS DECODED REPORT TO NOT PRINT RADIANCES AGAIN
  14375       IGCHN(1) = -99999
  14376 C***********************************************************************
  14377 C              PRECIPITABLE WATER REPORT IS PROCESSED HERE
  14378 C      (THIS IS A UNIQUE REPORT FROM THE SOUNDING/RADIANCE REPORT)
  14379 C      (NOTE 1: 1x1 FOV HAVE "H" IN CHAR. 1 OF STNID; 5x5 FOV DO NOT)
  14380 C  (NOTE 2: ASSUMED TO BE ONLY IN INPUT MSG TYPES NC003001 OR NC003003)
  14381 C
  14382 C***********************************************************************
  14383       IF(SUBSET_d.EQ.'NC003001'.OR.SUBSET_d.EQ.'NC003003') THEN
  14384       IF((GOESPW(1).AND.STNID(1:1).NE.'H').OR.
  14385      $   (GOESPW(2).AND.STNID(1:1).EQ.'H'))  THEN
  14386 C-----------------------------------------------------------------------

Page 346         Source Listing                  GOESDG
2017-04-18 11:09                                 prepdata.f

  14387 C                  STORE PRECIPITABLE WATER RETRIEVALS
  14388 C   A REPORT MAY CONTAIN PRECIP. WATER IN THE ANY/ALL OF THE FOLLOWING:
  14389 C                          1.0 TO 0.9 SIGMA LAYER
  14390 C                          0.9 TO 0.7 SIGMA LAYER
  14391 C                          0.7 TO 0.3 SIGMA LAYER
  14392 C                          0.3 TO 0.0 SIGMA LAYER
  14393 C            (PRECIPITABLE WATER STORED IN UNITS OF MILLIMETERS)
  14394 C     THE PREPBUFR TABLE VALUE IS ASSUMED TO BE THE SAME FOR ALL LAYERS
  14395 C   THE REPORT MAY ALSO CONTAIN SURFACE PRESSURE (STORED IN PASCALS)
  14396 C-----------------------------------------------------------------------
  14397 C NUMOB ACCUMULATES TOTAL NUMBER OF REPORTS
  14398          NUMOB(IBAND,INSTR,MS,NSS,3) = NUMOB(IBAND,INSTR,MS,NSS,3) + 1
  14399 C CALL SUBR. GOESCHK TO PERFORM CHECKS ON THE REPORT
  14400          CALL GOESCHK(2,KFLG_CHKREP,MS,INSTR,HDR(4),
  14401      $    IWINDO_e(IBAND,NSS,3),IWINDO_l(IBAND,NSS,3),
  14402      $    ISATLS(IBAND,NSS,3),IRTRV(IBAND,NSS,3),IFLUA,IERG)
  14403          IF(IERG.EQ.1) GO TO 1811
  14404 C REPORT HAS PASSED ALL CHECKS
  14405          PWT(2:5) = XMISS
  14406          PRSS = XMISS
  14407          IQMPW = 16
  14408          IF(IDATA(27).NE.0)  THEN
  14409             II = IDATA(28) - 4
  14410             MATCH = 0
  14411             LOOP1: DO N = 1,IDATA(27)
  14412                II = II + 4
  14413                IF(NINT(RDATA(II+1)).EQ.262)  THEN
  14414                   IF(RDATA(II).LT.XMISS)  PRSS = RDATA(II)
  14415 cfix?             IF(RDATA(II).LT.YMISS)  PRSS = RDATA(II)
  14416                   CYCLE LOOP1
  14417                END IF
  14418                IF(NINT(RDATA(II+1)).LT.251) CYCLE LOOP1
  14419                IF(NINT(RDATA(II+1)).GT.254) CYCLE LOOP1
  14420                IF(RDATA(II).GE.YMISS)  CYCLE LOOP1
  14421                IF(MATCH.GT.3)  CYCLE LOOP1
  14422                NSTRT = MATCH + 1
  14423                LOOP1n1: DO NN = NSTRT,4
  14424                   IF(NINT(RDATA(II+1)).EQ.JCAT8(NN)) THEN
  14425                      PWT(JNDEX(NN)) = RDATA(II)
  14426                      IQMPW = NINT(RDATA(II+2))
  14427                      MATCH = NN
  14428                      CYCLE LOOP1
  14429                   END IF
  14430                ENDDO LOOP1n1
  14431             ENDDO LOOP1
  14432          END IF
  14433 C TOTAL & ALL LAYER P.W. VALUES MUST BE > 0 & NON-MISSING TO PROCESS RPT
  14434          IF(MAX(PWT(5),PWT(2),PWT(3),PWT(4)).LT.YMISS.AND.
  14435      $    MIN(NINT(PWT(5)*10.),NINT(PWT(2)*10.),NINT(PWT(3)*10.),
  14436      $    NINT(PWT(4)*10.)).GE.0)  THEN
  14437 C CALCULATE TOP LAYER PRECIPTABLE WATER (THIS IS STORED, NOT TOTAL P.W.)
  14438             PWT(5) = PWT(5) - (PWT(2) + PWT(3) + PWT(4))
  14439             IF(NINT(PWT(5)*10.).LT.0)  THEN
  14440 C IF TOP LAYER PRECIP. WATER IS NEG. BUT > -1 MM, STORE AS 0, ELSE SKIP
  14441                IF(NINT(PWT(5)*10.).LT.-10)  THEN
  14442                PRINT 9985, STNID,RDATA(1),RDATA(2)
  14443  9985 FORMAT(' * * TOT. RPT TOSSED- STNID = ',A8,'(P. WATER)     AT ',

Page 347         Source Listing                  GOESDG
2017-04-18 11:09                                 prepdata.f

  14444      $ 'LAT = ',F6.2,' N  LON = ',F7.2,' E    -- CALC. TOP LAYER ',
  14445      $ 'P.WATER NEGATIVE')
  14446                   GO TO 1811
  14447                END IF
  14448                PRINT 9986, STNID,RDATA(1),RDATA(2),PWT(5)
  14449  9986 FORMAT(' # # TOP LYR PW CHGD- STNID = ',A8,'(P. WATER)     AT ',
  14450      $ 'LAT = ',F6.2,' N  LON = ',F7.2,' E    -- CALC. NEG. (',F4.1,
  14451      $ ' MM), SET TO 0')
  14452                PWT(5) = 0.0
  14453             END IF
  14454 C CALL GETPWATER TO STORE THIS REPORT (IF INPUT DECODED REPORT DID NOT
  14455 C  PRODUCE A SNDG/RADIANCE REPORT, INCREMENT KOUNT BY ONE
  14456             IF(NLEV+NRAD.LT.1)  KOUNT = KOUNT + 1
  14457             CALL GETPWATER(ITYPP(MS,INSTR),IFLUA,IERF)
  14458             IF(IERF.EQ.0)  THEN
  14459 C PRECIP. WATER REPORT SUCCESFULLY STORED (AT LEAST 1 LAYER PRESENT)
  14460                KNTGIP = KNTGIP + 1
  14461                NPW = 1
  14462 C KEPOB ACCUM. NO. OF RPTS PROCESSED ACCORDING TO OVERLAND OR OCEANIC
  14463                KEPOB(IBAND,INSTR,MS,3) = KEPOB(IBAND,INSTR,MS,3) + 1
  14464             ELSE
  14465 C IF PWATER NOT STORED & INPUT DECODED REPORT ALSO DID NOT PRODUCE A
  14466 C  SNDG/RADNCE REPORT, DECREASE KOUNT BY 1
  14467                IF(NLEV+NRAD.LT.1)  KOUNT = KOUNT - 1
  14468             END IF
  14469          ELSE
  14470             IF(MAX(PWT(5),PWT(2),PWT(3),PWT(4)).GE.YMISS)  THEN
  14471                PRINT 9987, STNID,RDATA(1),RDATA(2)
  14472  9987 FORMAT(' * * TOT. RPT TOSSED- STNID = ',A8,'(P. WATER)     AT ',
  14473      $ 'LAT = ',F6.2,' N  LON = ',F7.2,' E    -- 1 OR MORE INPUT ',
  14474      $ 'P.WATERS MISSING')
  14475             ELSE
  14476                PRINT 9988, STNID,RDATA(1),RDATA(2)
  14477  9988 FORMAT(' * * TOT. RPT TOSSED- STNID = ',A8,'(P. WATER)     AT ',
  14478      $ 'LAT = ',F6.2,' N  LON = ',F7.2,' E    -- 1 OR MORE INPUT ',
  14479      $ 'P.WATRS NEGATIVE')
  14480             END IF
  14481          END IF
  14482 C-----------------------------------------------------------------------
  14483       END IF
  14484       END IF
  14485  1811 CONTINUE
  14486 C***********************************************************************
  14487 C                  CLOUD TOP REPORT IS PROCESSED HERE
  14488 C   (THIS IS A UNIQUE REPORT FROM THE SOUNDING/RADIANCE AND PW REPORTS)
  14489 C      (NOTE 1: 1x1 FOV HAVE "H" IN CHAR. 1 OF STNID; 5x5 FOV DO NOT)
  14490 C           (NOTE 2: ASSUMED TO BE ONLY IN INPUT MSG TYPE NC003002)
  14491 C
  14492 C***********************************************************************
  14493       IF(SUBSET_d.EQ.'NC003002') THEN
  14494       IF((GOESCT(1).AND.STNID(1:1).NE.'H').OR.
  14495      $   (GOESCT(2).AND.STNID(1:1).EQ.'H'))  THEN
  14496 C-----------------------------------------------------------------------
  14497 C                      STORE CLOUD TOP RETRIEVALS
  14498 C                     CLOUD TOP PRESSURE (PASCALS)
  14499 C                     TOTAL CLOUD COVER (PER CENT)
  14500 C                    CLOUD TOP TEMPERATURE (KELVIN)

Page 348         Source Listing                  GOESDG
2017-04-18 11:09                                 prepdata.f

  14501 C-----------------------------------------------------------------------
  14502 C NUMOB ACCUMULATES TOTAL NUMBER OF REPORTS
  14503          NUMOB(IBAND,INSTR,MS,NSS,4) = NUMOB(IBAND,INSTR,MS,NSS,4) + 1
  14504 C CALL SUBR. GOESCHK TO PERFORM CHECKS ON THE REPORT
  14505          CALL GOESCHK(3,KFLG_CHKREP,MS,INSTR,HDR(4),
  14506      $    IWINDO_e(IBAND,NSS,4),IWINDO_l(IBAND,NSS,4),
  14507      $    ISATLS(IBAND,NSS,4),IRTRV(IBAND,NSS,4),IFLUA,IERG)
  14508          IF(IERG.EQ.1) GO TO 1911
  14509 C REPORT HAS PASSED ALL CHECKS
  14510          IF(IDATA(27).GT.0)  THEN
  14511             L8 = IDATA(28) - 4
  14512             DO I = 1,IDATA(27)
  14513                L8 = L8 + 4
  14514                IF(NINT(RDATA(L8+1)).LT.256)  THEN
  14515                   CYCLE
  14516                ELSE  IF(NINT(RDATA(L8+1)).GT.257)  THEN
  14517                   EXIT
  14518                ELSE  IF(NINT(RDATA(L8+1)).EQ.256)  THEN
  14519                   CLTOP(1,3) = RDATA(L8) ! store c.t. temperature
  14520                ELSE  IF(NINT(RDATA(L8+1)).EQ.257)  THEN
  14521                   CLTOP(1,1) = RDATA(L8) ! store c.t. pressure
  14522                   CLTOP(2,1) = 2.
  14523                   IF(IFLUA.EQ.1)  CLTOP(2,1)= 15
  14524                   NCT = 1   ! NOTE REPORTS WITH VALID CLOUD TOP PRESSURE
  14525                END IF
  14526             ENDDO
  14527             IF(RDATA2(25).LT.YMISS) CLTOP(1,2) = RDATA2(25) ! store TOCC
  14528 C CURRENTLY, ONLY REPORTS WITH VALID CLOUD TOP PRESSURE ARE PROCESSED
  14529             IF(NCT.EQ.1)  THEN
  14530 C CALL FILLX TO PROCESS THIS REPORT (IF INPUT DECODED REPORT DID NOT
  14531 C  PRODUCE A SNDG/RADIANCE OR PW REPORT, INCREMENT KOUNT BY ONE)
  14532                IF(NLEV+NRAD+NPW.LT.1)  KOUNT = KOUNT + 1
  14533 C PREPBUFR REPORT TYPE IS SET TO 151
  14534                HDR(6) = 151
  14535                CALL FILLX(-2,IERF)
  14536                IF(IERF.NE.0)  THEN
  14537 C IF CLOUD TOP REPORT NOT STORED & INPUT DECODED REPORT ALSO DID NOT
  14538 C  PRODUCE A SNDG/RADNCE OR PW REPORT, DECREASE KOUNT BY 1
  14539                   IF(NLEV+NRAD+NPW.LT.1)  KOUNT = KOUNT - 1
  14540                   NCT = 0
  14541                ELSE
  14542 C CLOUD TOP REPORT SUCCESFULLY STORED
  14543 C KEPOB ACCUM. NO. OF RPTS PROCESSED ACCORDING TO OVERLAND OR OCEANIC
  14544                   KEPOB(IBAND,INSTR,MS,4) = KEPOB(IBAND,INSTR,MS,4) + 1
  14545                   KNTGIC = KNTGIC + 1
  14546                END IF
  14547             ELSE
  14548 C KEEP A COUNT OF REPORTS WITH MISSING CLOUD TOP PRESSURE BUT WITH
  14549 C  OTHER VALID CLOUD TOP DATA
  14550                KNOCTP = KNOCTP + 1
  14551             END IF
  14552          END IF
  14553       END IF
  14554       END IF ! SUBSET_d.EQ.'NC003002'
  14555 C***********************************************************************
  14556  1911 CONTINUE
  14557 C GO BACK AND DECODE NEXT REPORT (ACCUMULATE SKIPPED INPUT REPORT COUNT

Page 349         Source Listing                  GOESDG
2017-04-18 11:09                                 prepdata.f

  14558 C  IF NEITHER A GOES SOUNDING/RADIANCE NOR A PRECIP. WATER REPORT NOR A
  14559 C  CLOUD TOP REPORT GENERATED)
  14560       IF(NPW+NCT+NLEV+NRAD.EQ.0)  GO TO 1410
  14561       GO TO 1400
  14562   110 CONTINUE
  14563 C***********************************************************************
  14564 C***********************************************************************
  14565       PRINT 950, KNTALL
  14566   950 FORMAT(13X,'===>  A TOTAL OF ',I6,'  REPORTS WERE DECODED, ',
  14567      $ 'WHETHER KEPT OR SKIPPED  <===',/)
  14568       KNTGIT = KOUNT
  14569 C FINISHED PROCESSING GOES REPORTS.; SUBR. SNDTBL SUMMARIZES IN TABLE
  14570       NN = 3
  14571       CALL SNDTBL(IDSAT,NUMOB,KEPOB,MSTOB,NN)
  14572       RETURN
  14573       END
  14574 C$$$  SUBPROGRAM DOCUMENTATION BLOCK
  14575 C
  14576 C SUBPROGRAM:    GOESCHK
  14577 C   PRGMMR: D. A. KEYSER     ORG: NP22       DATE: 2001-08-01
  14578 C
  14579 C ABSTRACT: PERFORMS CHECKS ON GOES SOUNDING/RADIANCE, GOES
  14580 C   PRECIPITABLE WATER AND GOES CLOUD TOP REPORTS.  SUCH THINGS AS
  14581 C   REPORT OUTSIDE DOMAIN, REPORT OUTSIDE TIME WINDOW, REPORT OVER LAND
  14582 C   OR OVER OCEAN (WHEN OR OTHER NOT WANTED), OR REPORT WITH UNWANTED
  14583 C   PATH (E.G., CLEAR. CLOUDY, ETC.) ARE CHECKED.  REPORTS FAILING
  14584 C   CHECKS MAY RETURN WITH IER = 1 (IN WHICH CASE THEY ARE SKIPPED) OR
  14585 C   WITH IER = 0 BUT IFLUA = 1 {IN WHICH CASE THEY WILL BE PROCESSED
  14586 C   BUT WITH Q.M. = 15 (EXCEPT FOR RADIANCES WHICH ARE STILL PROCESSED
  14587 C   SINCE THAT CANNOT BE FLAGGED)}.
  14588 C
  14589 C PROGRAM HISTORY LOG:
  14590 C 2001-06-13  D. A. KEYSER -- ORIGINAL AUTHOR
  14591 C 2001-08-01  D. A. KEYSER -- REPLACED INPUT ARGUMENT "JWINDO" WITH
  14592 C     NEW INPUT ARGUMENTS "JWINDO_e" AND "JWINDO_l" TO ALLOW THE
  14593 C     EARLIEST TIME WINDOW TO BE DIFFERENT FROM THE LATEST TIME WINDOW
  14594 C     IN TIME CHECK (FOR BOTH, "-" MEANS PRIOR TO CYCLE TIME, "+"
  14595 C     MEANS AFTER CYCLE TIME)
  14596 C
  14597 C USAGE:    CALL GOESCHK(ITP,KFLG_CHKREP,MS,INSTR,HDR4,JWINDO_e,
  14598 C                        JWINDO_l,JSATLS,JRTRV,IFLUA,IER)
  14599 C   INPUT ARGUMENT LIST:
  14600 C     ITP      - TYPE OF GOES REPORT (=1 RADIANCE/SOUNDING;
  14601 C              - =2 PRECIPITABLE WATER; =3 CLOUD TOP)
  14602 C     KFLG_CHKREP
  14603 C              - INDICATOR AS TO WHETHER PREVIOUS CALL TO SUBR. CHKREP
  14604 C              - RETURNED WITH MISSING LAT/LON OR LAT/LON OUTSIDE
  14605 C              - SEARCH AREA FOR DECODED REPORT
  14606 C     MS       - OVERLAND/OCEANIC SWITCH (=1 OVERLAND; =2 OCEANIC)
  14607 C     INSTR    - RETRIEVAL PATH TYPE INDEX (=1 CLEAR; =3 CLOUDY; =4
  14608 C              - UNKNOWN; =2 IS NOT A POSSIBILITY))
  14609 C     HDR4     - OBSERVATION TIME MINUS CYCLE TIME (IN HOURS, REAL
  14610 C              - PRECISION)
  14611 C     JWINDO_e - EARLIEST TIME WINDOW FOR ACCEPTING REPORTS (RELATIVE
  14612 C              - TO CYCLE TIME, "-" IS PRIOR, "+" IS AFTER) (IN HOURS
  14613 C              - * 100.) (BASED ON INPUT NAMELIST SWITCH "IWINDO_e"
  14614 C              - FOR THIS REPORT'S LATITUDE BAND, SATELLITE NUMBER,

Page 350         Source Listing                  GOESDG
2017-04-18 11:09                                 prepdata.f

  14615 C              - AND REPORT TYPE)
  14616 C     JWINDO_l - LATEST TIME WINDOW FOR ACCEPTING REPORTS (RELATIVE
  14617 C              - TO CYCLE TIME, "-" IS PRIOR, "+" IS AFTER) (IN HOURS
  14618 C              - * 100.) (BASED ON INPUT NAMELIST SWITCH "IWINDO_l"
  14619 C              - FOR THIS REPORT'S LATITUDE BAND, SATELLITE NUMBER,
  14620 C              - AND REPORT TYPE)
  14621 C     JSATLS   - LAND/SEA SWITCH (=0 PROCESS ALL REPORTS; =1 PROCESS
  14622 C              - ONLY REPORTS OVER LAND; =2 PROCESS ONLY REPORTS OVER
  14623 C              - OCEAN) (BASED ON INPUT NAMELIST SWITCH "JSATLS" FOR
  14624 C              - THIS REPORT'S LATITUDE BAND, SATELLITE NUMBER, AND
  14625 C              - REPORT TYPE)
  14626 C     JRTRV    - SATELLITE PATH TYPE SWITCH (BASED ON INPUT NAMELIST
  14627 C              - SWITCH "IRTRV" FOR THIS REPORT'S LATITUDE BAND,
  14628 C              - SATELLITE NUMBER, AND REPORT TYPE) (SEE MAIN PROGRAM
  14629 C              - DOCBLOCK FOR POSSIBLE VALUES FOR IRTRV)
  14630 C
  14631 C   OUTPUT ARGUMENT LIST:
  14632 C     IFLUA    - FLAG ALL VARIABLES WITH PREPBUFR TABLE VALUE OF 15 IF
  14633 C              - THIS IS 1; OTHERWISE DO NOT FLAG (= 0)
  14634 C     IER      - RETURN CODE (=0 REPORT SHOULD NOT BE SKIPPED
  14635 C              - REGARDLESS OF VALUE FOR IFLUA; =1 REPORT SHOULD BE
  14636 C              - SKIPPED)
  14637 C
  14638 C   OUTPUT FILES:
  14639 C     UNIT 06  - STANDARD OUTPUT PRINT
  14640 C
  14641 C REMARKS: CALLED BY SUBROUTINE 'GOESDG'.
  14642 C
  14643 C ATTRIBUTES:
  14644 C   LANGUAGE: FORTRAN 90
  14645 C   MACHINE:  NCEP WCOSS
  14646 C
  14647 C$$$
  14648       SUBROUTINE GOESCHK(ITP,KFLG_CHKREP,MS,INSTR,HDR4,JWINDO_e,
  14649      $ JWINDO_l,JSATLS,JRTRV,IFLUA,IER)
  14650       INTEGER  KRTRV(4)
  14651       COMMON/GOSWCH/GOESND(2),GOESPW(2),GOESCT(2),KNTGIT,KNTGIS,KNTGIP,
  14652      $ KSKPGI,KNDCGI,KNOPGI,KMSGGI,KBDYGI,KTIMGI(3),KLNDGI(3),KSEAGI(3),
  14653      $ KNTGIC,KNOCTP
  14654       DATA  KRTRV/272,99999,544,118/
  14655       IER = 0
  14656       IFLUA = 0
  14657 C-----------------------------------------------------------------------
  14658 C       PERFORM SERIES OF CHECKS ON REPORT, MAY TOSS IF PROBLEM
  14659 C-----------------------------------------------------------------------
  14660 C CHECK RESULTS FROM EARLIER CALL TO CHKREP AND FLAG REPORTS WITH
  14661 C  MISSING LAT/LON OR OUTSIDE REPORT AREA
  14662       IF(KFLG_CHKREP.EQ.1) THEN
  14663          IER = 1
  14664          RETURN
  14665       END IF
  14666 C-----------------------------------------------------------------------
  14667 C        CALL SUBR. 'TIMCHK' TO CHECK IF REPORT IS W/I PROPER
  14668 C              TIME WINDOW OF CYCLE TIME (IER =1 TOSS RPT)
  14669 C-----------------------------------------------------------------------
  14670 C TIMWIN_e AND TIMWIN_l ARE THE TIME WINDOWS (RELATIVE TO CYCLE TIME)
  14671 C  FOR ACCEPTING REPORTS (EARLIEST AND LATEST, RESPECTIVELY)

Page 351         Source Listing                  GOESCHK
2017-04-18 11:09                                 prepdata.f

  14672 C  (HERE JWINDO_e AND JWINDO_l ARE IN UNITS OF HOURS * 100.)
  14673       TIMWIN_e = REAL(JWINDO_e) * .01
  14674       TIMWIN_l = REAL(JWINDO_l) * .01
  14675       CALL TIMCHK(HDR4,TIMWIN_e,TIMWIN_l,IER)
  14676       IF(IER.EQ.1)  THEN
  14677          KTIMGI(ITP) = KTIMGI(ITP) + 1
  14678          RETURN
  14679       END IF
  14680 C.......................................................................
  14681       IF(MS.EQ.1)  THEN
  14682 C CHECK IF OVERLAND REPORTS ARE TO BE EXCLUDED (JSATLS = 2)
  14683          IF(JSATLS.EQ.2)  THEN
  14684             KLNDGI(ITP) = KLNDGI(ITP) + 1
  14685             IER = 1
  14686             RETURN
  14687          END IF
  14688       ELSE
  14689 C.......................................................................
  14690 C CHECK IF OCEANIC REPORTS ARE TO BE EXCLUDED (JSATLS = 1)
  14691          IF(JSATLS.EQ.1)  THEN
  14692             KSEAGI(ITP) = KSEAGI(ITP) + 1
  14693             IER = 1
  14694             RETURN
  14695          END IF
  14696       END IF
  14697 C.......................................................................
  14698 C UNKNOWN PATH NOT ALLOWED UNLESS TYPE IS CLOUD TOP
  14699       IF(INSTR.EQ.4.AND.ITP.NE.3)  THEN
  14700          IER = 1
  14701          RETURN
  14702       END IF
  14703 C.......................................................................
  14704 C CHECK IF RPTS FROM ALL PATHS ARE TO BE KEPT (JRTRV = 0) -- NO MORE
  14705 C  CHECKS NECESSARY IF THIS IS THE CASE
  14706       IF(JRTRV.EQ.0)  THEN
  14707 C.......................................................................
  14708 C CHECK IF RPTS FROM ALL PATHS TO BE FLAGGED (JRTRV =9999) - DOES NOT
  14709 C  APPLY TO RADIANCES!!
  14710       ELSE  IF(JRTRV.EQ.9999)  THEN
  14711          IFLUA = 1
  14712 C.......................................................................
  14713 C CHECK IF RPTS FROM ONLY ONE PATH ARE TO BE FLAGGED (JRTRV = 272, 544,
  14714 C  OR 118) - DOES NOT APPLY TO RADIANCES!!
  14715       ELSE  IF(JRTRV.EQ.KRTRV(INSTR))  THEN
  14716          IFLUA = 1
  14717 C.......................................................................
  14718 C CHECK IF RPTS FROM ONLY ONE PATH ARE TO BE NON-FLAGGED
  14719 C  (JRTRV = 1, 3, OR 4) - DOES NOT APPLY TO RADIANCES!!
  14720       ELSE IF(JRTRV.LE.4.AND.JRTRV.NE.INSTR) THEN
  14721          IFLUA = 1
  14722 C.......................................................................
  14723       END IF
  14724       RETURN
  14725       END

Page 352         Source Listing                  GOESCHK
2017-04-18 11:09 Entry Points                    prepdata.f



ENTRY POINTS

  Name                
                      
 goeschk_             


SYMBOL CROSS REFERENCE

 Name                       Object Declared Type            Bytes Dimen Elements Attributes       References                        
                                                                                                                                    
 GOESCHK                    Subr   14648                                                                                            
 GOESCT                     Scalar 14651    R(4)            4     1     2        COM                                                
 GOESND                     Scalar 14651    R(4)            4     1     2        COM                                                
 GOESPW                     Scalar 14651    R(4)            4     1     2        COM                                                
 GOSWCH                     Common 14651                                100                                                         
 HDR4                       Dummy  14648    R(4)            4           scalar   ARG,INOUT        14675                             
 IER                        Dummy  14649    I(4)            4           scalar   ARG,INOUT        14655,14663,14675,14676,14685,1469
                                                                                                  3,14700                           
 IFLUA                      Dummy  14649    I(4)            4           scalar   ARG,INOUT        14656,14711,14716,14721           
 INSTR                      Dummy  14648    I(4)            4           scalar   ARG,INOUT        14699,14715,14720                 
 ITP                        Dummy  14648    I(4)            4           scalar   ARG,INOUT        14677,14684,14692,14699           
 JRTRV                      Dummy  14649    I(4)            4           scalar   ARG,INOUT        14706,14710,14715,14720           
 JSATLS                     Dummy  14649    I(4)            4           scalar   ARG,INOUT        14683,14691                       
 JWINDO_E                   Dummy  14648    I(4)            4           scalar   ARG,INOUT        14673                             
 JWINDO_L                   Dummy  14649    I(4)            4           scalar   ARG,INOUT        14674                             
 KBDYGI                     Scalar 14652    I(4)            4           scalar   COM                                                
 KFLG_CHKREP                Dummy  14648    I(4)            4           scalar   ARG,INOUT        14662                             
 KLNDGI                     Scalar 14652    I(4)            4     1     3        COM              14684                             
 KMSGGI                     Scalar 14652    I(4)            4           scalar   COM                                                
 KNDCGI                     Scalar 14652    I(4)            4           scalar   COM                                                
 KNOCTP                     Scalar 14653    I(4)            4           scalar   COM                                                
 KNOPGI                     Scalar 14652    I(4)            4           scalar   COM                                                
 KNTGIC                     Scalar 14653    I(4)            4           scalar   COM                                                
 KNTGIP                     Scalar 14651    I(4)            4           scalar   COM                                                
 KNTGIS                     Scalar 14651    I(4)            4           scalar   COM                                                
 KNTGIT                     Scalar 14651    I(4)            4           scalar   COM                                                
 KRTRV                      Local  14650    I(4)            4     1     4                         14654,14715                       
 KSEAGI                     Scalar 14652    I(4)            4     1     3        COM              14692                             
 KSKPGI                     Scalar 14652    I(4)            4           scalar   COM                                                
 KTIMGI                     Scalar 14652    I(4)            4     1     3        COM              14677                             
 MS                         Dummy  14648    I(4)            4           scalar   ARG,INOUT        14681                             
 REAL                       Func   14673                                scalar                    14673,14674                       
 TIMCHK                     Subr   14675                                                          14675                             
 TIMWIN_E                   Local  14673    R(4)            4           scalar                    14673,14675                       
 TIMWIN_L                   Local  14674    R(4)            4           scalar                    14674,14675                       

Page 353         Source Listing                  GOESCHK
2017-04-18 11:09                                 prepdata.f

  14726 C$$$  SUBPROGRAM DOCUMENTATION BLOCK
  14727 C
  14728 C SUBPROGRAM:    GETPWATER
  14729 C   PRGMMR: D. A. KEYSER     ORG: NP22       DATE: 2007-09-14
  14730 C
  14731 C ABSTRACT: PREPROCESSES PRECIP. WATER AS A UNIQUE REPORT.  THERE CAN
  14732 C   BE AS MANY AS 5 TYPES STORED (TOTAL COLUMN - SSM/I OR GPS-IPW; 1.0
  14733 C   TO 0.9 SIGMA LAYER - GOES; 0.9 TO 0.7 SIGMA LAYER - GOES; 0.7 TO
  14734 C   0.3 SIGMA LAYER - GOES; AND 0.3 TO 0.0 SIGMA LAYER - GOES).  THE
  14735 C   PRECIP. WATER OBS AND PREPBUFR TABLE VALUE ARE STORED IN THE PWAT
  14736 C   ARRAY.  ASSUMES THAT HDR(4), HDR(5), HDR(7), HDR(9)-HDR(15), ALAT_8
  14737 C   AND ALON_8 HAVE ALREADY BEEN FILLED IN FOR REPORT.
  14738 C
  14739 C PROGRAM HISTORY LOG:
  14740 C 1990-09-17  D. A. KEYSER (W/NMC22)
  14741 C 1993-05-12  D. A. KEYSER -- SET-UP EXPANDED REPORT FORMAT WORD 2 FOR
  14742 C     EACH MASS/WIND LVL IS PRESS. X 10MB, NEW WORD 5 FOR EACH LEVEL
  14743 C     CONTAINS 4 PACKED "PREPBUFR TBL VALUES" WHICH CAN RANGE FROM 0-15
  14744 C     AND CORRESPOND TO ON29 Q. MARKERS OR PREPRO-GENERATED Q. MARKERS;
  14745 C     ALL NON-MISSING DATA ARE NOW PACKED INTO PREPBUFR FILE
  14746 C 1993-07-28  D. A. KEYSER -- R.TYPE 151-153 PWATER NOW STORED IN MM*10
  14747 C     RATHER THAN MM
  14748 C 1995-07-12  D. A. KEYSER -- PRECIP. WATER 'NOBS' PROCESSING MODIFIED
  14749 C     TO HANDLE > 1 LEVEL, P-SLOT VALUE IDENTIFIES PRECIP. WATER
  14750 C     'TYPE'; R.TYPES 151-159 USED FOR PRECIP. WATER
  14751 C 1998-02-17  D. A. KEYSER -- REMOVED LOGIC RE: PROCESSING OF RAOB AND
  14752 C     TOVS PWATER
  14753 C 2001-04-06  D. A. KEYSER -- SUBR. "PWATER" RENAMED TO "GETPWATER",
  14754 C     NOW RETURNS IERF=1 IF REPORT NOT ENCODED INTO PREPBUFR FILE
  14755 C     (INSTEAD OF MST=0); ACCOUNTS FOR SUBR. W3UNPKB7 OUTPUTTING GOES
  14756 C     PWATER AS AS MM (PRECISE TO 10**2) RATHER THAN MM*100;  ACCOUNTS
  14757 C     FOR SUBR. IW3UNPBF OUTPUTTING SSM/I TPW IN MM (PRECISE TO 10**1)
  14758 C     RATHER THAN MM*10
  14759 C 2004-09-09  D. A. KEYSER -- ADDED PROCESSING OF GPS-IPW DATA, READ
  14760 C     FROM "GPSIPW" DUMP FILE DUMP R. TYPE 74, GET PREPBUFR R. TYPE
  14761 C     153, PROCESSED BY NEW SUBR. "GETGPSIPW" INTO PREPBUFR FILE UNDER
  14762 C     NEW TBL A ENTRY "GPSIPW"; REMOVED INPUT ARGUMENT "MS" (LAND/SEA
  14763 C     SWITCH) AS IT IS NOT USED ANYWHERE IN CODE (ELEVATION PROCESSING
  14764 C     REMOVED LONG AGO)
  14765 C 2007-09-14  D. A. KEYSER -- CASES WHERE OBS ARE SET TO QM=15 IN ORDER
  14766 C     TO FLAG A REPORT FOR NON-USE BY ANALYSIS (EVEN THOUGH OBS MAY NOT
  14767 C     NECESSARILY BE BAD) NOW FIRST CHECK TO MAKE SURE OBS QM ISN'T
  14768 C     ALREADY "BAD" (> 3 AND < 15) (PREVENTS GSI FROM MONITORING TRULY
  14769 C     BAD OBS WHICH JUST HAPPEN TO BE IN REPORT GROUPS FLAGGED FOR NON-
  14770 C     USE BY ANALYSIS)
  14771 C 2008-09-25  D. A. KEYSER -- UPPER LIMIT FOR STORING Q CHANGED FROM
  14772 C     32767 MG/KG TO 99999 MG/KG TO ENSURE THAT REPORTS WITH VERY
  14773 C     HIGH SPECIFIC HUMIDITY ARE PROCESSED (THE 32767 LIMIT WAS A
  14774 C     VESTIGE FROM THE OLD I*2 PREPDA DAYS)
  14775 C
  14776 C USAGE:    CALL GETPWATER(ITYP,IFLUA,IERF)
  14777 C   INPUT ARGUMENT LIST:
  14778 C     ITYP     - TYPE OF DATA (=2 SSM/I; =3 GPS-IPW; =6 GOES/LAND/
  14779 C              - CLEAR; =7 GOES/LAND/CLOUDY; =8 GOES/OCEAN/CLEAR; =9
  14780 C              - GOES/OCEAN/CLOUDY - THESE ARE CURRENTLY THE ONLY
  14781 C              - POSSIBILITIES)
  14782 C     IFLUA    - FLAG ALL VARIABLES WITH PREPBUFR TABLE VALUE OF 15 IF

Page 354         Source Listing                  GOESCHK
2017-04-18 11:09                                 prepdata.f

  14783 C              - THIS IS 1; OTHERWISE DO NOT FLAG (= 0)
  14784 C
  14785 C   OUTPUT ARGUMENT LIST:
  14786 C     IERF     - RETURN CODE (=0 - REPORT SUCCESSFULLY ENCODED INTO
  14787 C              - PREPBUFR FILE; =1 - REPORT NOT ENCODED INTO PREPBUFR
  14788 C              - FILE - PROBLEM!)
  14789 C
  14790 C   OUTPUT FILES:
  14791 C     UNIT 06  - STANDARD OUTPUT PRINT
  14792 C
  14793 C REMARKS: CURRENTLY SET-UP TO PROCESSES EITHER SSM/I P. WATER (AS R.
  14794 C   TYPE 152), GPS-IPW P. WATER (AS R. TYPE 153) OR GOES P. WATER (AS
  14795 C   R. TYPES 156-159, BASED ON RETR. TYPE AND LAND/OCEAN).  CALLED BY
  14796 C   SUBROUTINES 'GOESDG', 'GETSMI' AND 'GETGPSIPW'.
  14797 C
  14798 C ATTRIBUTES:
  14799 C   LANGUAGE: FORTRAN 90
  14800 C   MACHINE:  NCEP WCOSS
  14801 C
  14802 C$$$
  14803       SUBROUTINE GETPWATER(ITYP,IFLUA,IERF)
  14804       PARAMETER (MXWRDH = 15)
  14805       PARAMETER (MXTYPV =  3)
  14806       PARAMETER (MXPWT =  5)
  14807       PARAMETER (MAXOBS = 3500)
  14808       CHARACTER*8  STNID,SUBSET_d
  14809       INTEGER  IDATA(MAXOBS)
  14810       real(8)  alon_8,alat_8
  14811       COMMON/STRPWT/PWAT(MXTYPV,MXPWT)
  14812       COMMON/DATA/KOUNT,IDATE(4),IDAT10,MP_PROCESS,WRMISS
  14813       COMMON/RPTHDR/SUBSET_d,STNID,HDR(2:MXWRDH),alon_8,alat_8
  14814       COMMON/ADP/ISATOB,PMAND(23),RDATA(MAXOBS),IPRINT
  14815       COMMON/PWSWCH/PWT(5),IQMPW
  14816       DATA XMISS/99999./,IMISS/99999/
  14817       EQUIVALENCE  (RDATA,IDATA)
  14818       IERF = 1
  14819       HDR(6) = 150 + ITYP
  14820       LLFLAG = 0
  14821 C INITIALIZE PWAT ARRAY
  14822       PWAT = XMISS
  14823       DO KK = 1,5
  14824 C "PWT" IS PRECIP. WATER (MM) {MUST BE > 0 AND < IMISS (99999)}
  14825          IF(NINT(PWT(KK)*10.).LT.0.OR.NINT(PWT(KK)*10.).GE.IMISS)
  14826      $    CYCLE
  14827          LLFLAG = 1
  14828          IF(IFLUA.EQ.1.AND.(IQMPW.LE.3.OR.IQMPW.GT.15))  IQMPW = 15
  14829 C STORE PRECIPITABLE WATER OBS (MM TO NEAREST 10**1 PRECISION) AND
  14830 C  PREPBUFR TABLE VALUE IN PWAT ARRAY
  14831          PWAT(1,KK) = PWT(KK)
  14832          PWAT(2,KK) = REAL(IQMPW)
  14833  1300    CONTINUE
  14834       ENDDO
  14835       IF(LLFLAG.EQ.0)  RETURN
  14836 C CALL FILLX TO FILL RPT INTO OUTPUT BUFFER (KOUNT KEPT BY CALLING PGM)
  14837       CALL FILLX(-2,IERF)
  14838 C+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
  14839 CCCCC IF(IERF.EQ.0)  THEN

Page 355         Source Listing                  GETPWATER
2017-04-18 11:09                                 prepdata.f

  14840 C OPTION TO PRINT LISTING OF ALL PRECIP. WATER RPTS (NORM. COMM. OUT)
  14841 CCCCC    PRINT 9091, STNID,IDATA(9),NINT(HDR(6)),IQMPW
  14842 C9091 FORMAT(1X,'STN. ',A8,'  DUMP R. TYPE = ',I3,'  PREPBUFR REPORT ',
  14843 CCCCC$ 'TYPE =',I4,' PWATER PREPBUFR TBL VAL. =',I3)
  14844 CCCCC END IF
  14845 C+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
  14846       RETURN
  14847       END


ENTRY POINTS

  Name                  
                        
 getpwater_             


SYMBOL CROSS REFERENCE

 Name                       Object Declared Type            Bytes Dimen Elements Attributes       References                        
                                                                                                                                    
 1300                       Label  14833                                                                                            
 ADP                        Common 14814                                14100                                                       
 ALAT_8                     Scalar 14810    R(8)            8           scalar   COM                                                
 ALON_8                     Scalar 14810    R(8)            8           scalar   COM                                                
 DATA                       Common 14812                                32                                                          
 FILLX                      Subr   14837                                                          14837                             
 GETPWATER                  Subr   14803                                                                                            
 HDR                        Scalar 14813    R(4)            4     1     14       COM              14819                             
 IDAT10                     Scalar 14812    I(4)            4           scalar   COM                                                
 IDATA                      Scalar 14809    I(4)            4     1     3500     COM                                                
 IDATE                      Scalar 14812    I(4)            4     1     4        COM                                                
 IERF                       Dummy  14803    I(4)            4           scalar   ARG,INOUT        14818,14837                       
 IFLUA                      Dummy  14803    I(4)            4           scalar   ARG,INOUT        14828                             
 IMISS                      Local  14816    I(4)            4           scalar                    14816,14825                       
 IPRINT                     Scalar 14814    I(4)            4           scalar   COM                                                
 IQMPW                      Scalar 14815    I(4)            4           scalar   COM              14828,14832                       
 ISATOB                     Scalar 14814    I(4)            4           scalar   COM                                                
 ITYP                       Dummy  14803    I(4)            4           scalar   ARG,INOUT        14819                             
 KK                         Local  14823    I(4)            4           scalar                    14823,14825,14831,14832           
 KOUNT                      Scalar 14812    I(4)            4           scalar   COM                                                
 LLFLAG                     Local  14820    I(4)            4           scalar                    14820,14827,14835                 
 MAXOBS                     Param  14807    I(4)            4           scalar                    14809,14814                       
 MP_PROCESS                 Scalar 14812    I(4)            4           scalar   COM                                                
 MXPWT                      Param  14806    I(4)            4           scalar                    14811                             
 MXTYPV                     Param  14805    I(4)            4           scalar                    14811                             
 MXWRDH                     Param  14804    I(4)            4           scalar                    14813                             
 NINT                       Func   14825                                scalar                    14825                             
 PMAND                      Scalar 14814    R(4)            4     1     23       COM                                                
 PWAT                       Scalar 14811    R(4)            4     2     15       COM              14822,14831,14832                 
 PWSWCH                     Common 14815                                24                                                          
 PWT                        Scalar 14815    R(4)            4     1     5        COM              14825,14831                       
 RDATA                      Scalar 14814    R(4)            4     1     3500     COM                                                
 REAL                       Func   14832                                scalar                    14832                             
 RPTHDR                     Common 14813                                88                                                          
 STNID                      Scalar 14808    CHAR            8           scalar   COM                                                
 STRPWT                     Common 14811                                60                                                          

Page 356         Source Listing                  GETPWATER
2017-04-18 11:09 Symbol Table                    prepdata.f

 Name                       Object Declared Type            Bytes Dimen Elements Attributes       References                        
                                                                                                                                    
 SUBSET_D                   Scalar 14808    CHAR            8           scalar   COM                                                
 WRMISS                     Scalar 14812    R(4)            4           scalar   COM                                                
 XMISS                      Local  14816    R(4)            4           scalar                    14816,14822                       

Page 357         Source Listing                  GETPWATER
2017-04-18 11:09                                 prepdata.f

  14848 C$$$  SUBPROGRAM DOCUMENTATION BLOCK
  14849 C
  14850 C SUBPROGRAM:    SFCDTA
  14851 C   PRGMMR: KEYSER           ORG: NP22       DATE: 2015-04-16
  14852 C
  14853 C ABSTRACT: PERFORMS SEVERAL FUNCTIONS: UNPACKS SURFACE RPTS (IW3UNPBF
  14854 C   FORMAT) ONE AT A TIME, PERFORMING SEVERAL CHECKS SUCH AS WHETHER
  14855 C   REPORT IS WITHIN TIME LIMIT OR DATA EXTRACTION BOUNDARY.  {HANDLES
  14856 C   FOUR SFC DATA FILES: 'ADPSFC', 'SFCSHP', 'SFCBOG' AND 'MSONET' AS
  14857 C   WELL AS U-AIR FILE 'ADPUPA' (LATTER FOR SPLASH-LEVEL DATA FROM
  14858 C   EITHER DROPWINSONDES OR RECCOS WITH PMSL OBS)}.
  14859 C
  14860 C PROGRAM HISTORY LOG:
  14861 C   UNKNOWN
  14862 C 1986-12-10  D. A. KEYSER (W/NMC22)
  14863 C 1987-06-14  D. A. KEYSER -- PLACED MINIMUM ON DEWPOINT REPORTS
  14864 C 1988-04-11  D. A. KEYSER -- DOCBLOCKING/COMMENTING; STREAMLINED
  14865 C 1988-09-14  D. A. KEYSER -- PROCESS SPLASH-LVL DROPS. AS MARINE SFC.
  14866 C 1988-12-22  D. A. KEYSER -- SUBR. 'SFCDTA' STREAMLINED, SWITCH PBOGUS
  14867 C    ADDED, SWITCH SFSHIP RENAMED SFMRNE, SWITCH SFC512 RENAMED SFCMAN
  14868 C 1989-02-16  D. A. KEYSER -- TIME WINDOW TYPE DEPENDENT; KEEP/TOSS
  14869 C    TYPE DEPENDENT; LAND CHECK IN SEPARATE SUBROUTINE
  14870 C 1989-12-13  D. A. KEYSER -- REMOVED PROCESSING OF WIND PART OF SPL-LVL
  14871 C    DROPS; OI R.T.=282 NOW USED FOR BUOYS W/ MSG. PRESSURE BUT VALID
  14872 C    WINDS, PRESS. SET TO 1013 MB; WIND R.T=283 (CHGD TO 284 ON
  14873 C    90-10-23 TO MAKE ROOM FOR SSM/I W. SPD) NOW ANALOGOUS TO MASS R.T.
  14874 C    =183; FOR OUTPUT TO OI, ADD'L OI R.TYPES ADDED FOR CASES OF MSG
  14875 C    PMSL AND/OR MSG PSTN THESE CAN NOW BE KEPT IN MOST CASES
  14876 C 1990-01-05  D. A. KEYSER -- CONVERTED TO VS FORTRAN(77) & RESTRUCTURED
  14877 C 1990-10-25  D. A. KEYSER -- NEW SUBR. 'UNPO29' + ENTRIES NOW FORMATS
  14878 C    REPORTS IN UNPACKED ON29 (STREAMLINED)
  14879 C 1991-01-03  D. A. KEYSER -- PMSL BOGUS R. TYPE EXPANDED (190-POINT,
  14880 C    191-PAOBS, 193-DIGIT.)
  14881 C 1991-05-14  D. A. KEYSER -- HONORS OPC PMSL AND WIND Q.M. FOR MARINE
  14882 C    RPTS; MARINE RPTS NOT TOSSED IF ONLY TEMP BAD; G.LAKES MARINE W/
  14883 C    GOOD ELEV SET R.T.=183 & W/ ELEV=0 TOSSED
  14884 C 1991-09-10  D. A. KEYSER -- ATLAS BUOY TEST MORE STRINGENT
  14885 C 1991-11-19  D. A. KEYSER -- SWITCH 'WNDADJ' ALLOWS W. SPEED FROM
  14886 C    MOORED BUOYS W/ ANEM. HGHT .LT. 10 M TO BE ADJUSTED TO HGHT OF 10
  14887 C    M VIA CALL TO SUBR. 'CFL'
  14888 C 1992-07-09  D. A. KEYSER -- RMVED. SUBPR. FCN "QFRMTP" & REPL. W/
  14889 C    IN-LINE FCN STMNT.; NOBS ARRAY NOT FILLED W/ VARIABLE IF .GT.
  14890 C    32767
  14891 C 1992-08-07  D. A. KEYSER -- ATLAS BUOY TEST MORE STRINGENT
  14892 C 1993-05-12  D. A. KEYSER -- SET-UP EXPANDED REPORT FORMAT, WORD 2 FOR
  14893 C    EACH MASS/WIND LVL IS PRESS. X 10MB, NEW WORD 5 FOR EACH LEVEL
  14894 C    CONTAINS 4 PACKED "PREPBUFR TBL VALUES" WHICH CAN RANGE FROM 0-15
  14895 C    AND CORRESPOND TO ON29 Q. MARKERS OR PREPRO-GENERATED Q. MARKERS;
  14896 C    ALL NON-MISSING DATA ARE NOW PACKED INTO PREPBUFR FILE
  14897 C 1993-05-31  D. A. KEYSER -- CHANGED DEF. VALUES & ORDER FOR NAMELIST
  14898 C    SWITCH "IUNIT"
  14899 C 1993-07-28  D. A. KEYSER -- REPORT TYPE 183 NOW ESTIMATES PSTN FROM
  14900 C    REPORTED PMSL AND TEMP RATHER THAN FROM STAND. ATMOS.
  14901 C 1993-09-14  D. A. KEYSER -- ADDED N-LIST SWITCH "TVIRT" TO OUTPUT
  14902 C    TEMP. AS VIRTUAL (=TRUE, DEFAULT) OR AS SENSIBLE (=FALSE)
  14903 C 1993-10-07  D. A. KEYSER -- PGM RUNS TO COMPL. W/ C.CODE=04 IF EITHER
  14904 C    ADPUPA OR ADPSFC CONTAIN NO RPTS; MSG VALUE IN NOBS ARRAY IS

Page 358         Source Listing                  GETPWATER
2017-04-18 11:09                                 prepdata.f

  14905 C    99999, ACTUAL HEIGHT (NO D-VAL) STORED IN NOBS ARRAY; ORDER FOR
  14906 C    PROCESSING SFC DATA REARRANGED S.T.: 1ST ALL LAND TYPES, NEXT ALL
  14907 C    MARINE TYPES, FINALLY ALL PMSL BOGUS TYPES
  14908 C 1993-11-02  D. A. KEYSER -- VARIABLE IFLSF WHEN SET TO 1 WILL FLAG
  14909 C    ALL VARIABLES WITH PREPBUFR T. VALUE=15
  14910 C 1993-12-21  D. A. KEYSER -- FOR REPORTS WITH BAD PMSL TBL VALUE, SETS
  14911 C    PSTN TBL VALUE TO 15 (AND VICE VERSA), ALSO IF PSTN MADE FROM PMSL
  14912 C    VIA FCN, SET ITS TBL VAL. TO MAXIMUM OF 8 OR PMSL TBL VAL.
  14913 C 1994-07-19  D. A. KEYSER -- ATLAS BUOYS HAVE ON29 R. TYPE 562 NOT
  14914 C    561 AFTER 2/23/94, CHANGED TEST (ALSO TIGHTENED LAT TEST TO +/- 10
  14915 C    DEG. N. LAT FROM +/- 20 DEG. N. LAT)
  14916 C 1994-08-11  D. A. KEYSER -- WORDS 6 AND 7 OF MASS LVL NOW CONTAIN
  14917 C    SENS. TEMP AND DWPT TEMP, RESP. WHILE WORDS 6 AND 7 OF WIND LVL
  14918 C    CONTAIN WIND DIR. AND SPEED, RESP.; ALSO WORD 3 OF MASS LVL NOW
  14919 C    CONTAINS "REPORTED" TEMP
  14920 C 1995-08-24  D. A. KEYSER -- R.T. 182 RECCOS W/ EST. PMSL CORRECTED TO
  14921 C    GET SFC. HGHT OF ZERO RATHER THAN FROM REPORTED ELEV (P-ALT); DVAL
  14922 C    CHECK ON R.T. 182 PRESS. CHGD FROM LOW- LIMIT OF -75MB TO -215MB
  14923 C    TO ACCEPT PRESS. IN HURRICANE SITUATIONS
  14924 C 1996-03-04  D. A. KEYSER -- FOR RGL-BUFR OUTPUT: MORE FIXES TO MAKE
  14925 C    BUFR-PREPDA FILE CONTAIN DATA EXPECTED BY FERR PGM & OI-ANAL
  14926 C    (PRESSURE ENCODED IN BUFR IS TO NEAREST WHOLE MILLIBAR W/ ZERO IN
  14927 C    TENTHS); ALL SURFACE REPORTS SET HEIGHT Q.M. TO PSTN Q.M. VALUE
  14928 C    PRIOR TO STORING RPT IN NOBS ARRAY & SUBSEQ. ENCODING IN PREPBUFR
  14929 C    (USED TO ALWAYS ASSIGN HEIGHT A NEUTRAL Q.M.)
  14930 C 1996-09-03  D. A. KEYSER -- ADDED SWITCH "MSGPSF" TO PROCESS SFC LAND
  14931 C    RPTS W/ MISSING PSTN AND PMSL (STD. ATMS. PSTN USED) (NOT PROC. IN
  14932 C    OPERATIONS); CAN READ WSPD IN M/S X 10 FROM ON29 CAT.8, C.FIG. 924
  14933 C    IF AVAILABLE
  14934 C 1997-09-18  D. A. KEYSER -- REDEFINED N-LIST SWITCH "MSGPSF=T" TO USE
  14935 C    ALTIMETER SETTING FOR PMSL WHEN OBS. PMSL & PSTN ARE MISSING; CAN
  14936 C    STORE ALTIM. SETTING IN COMMON (LATER ENCODES INTO PREPBUFR)
  14937 C 1997-10-06  D. A. KEYSER -- ALL LOGIC RE: PROCESSING OF ASYNPOTIC SFC
  14938 C    REPORTS (OBSOLETE) REMOVED
  14939 C 1998-02-17  D. A. KEYSER -- WSPD IN M/SEC * 10 NOW READ DIRECTLY FROM
  14940 C    CAT 6. (NOT CAT. 8); REMOVED LOGIC TO ADJ. MOORED BUOY WSPD TO
  14941 C    ALT. OF 10 METERS
  14942 C 1998-06-15  D. A. KEYSER -- STREAMLINED THE PROCESSING OF CAT. 6
  14943 C    RECCOS W/ EITHER MAND LVL GEOPOT. OBS OR MEAN SEA-LVL PRESS. OBS
  14944 C 1999-08-04  D. A. KEYSER -- UPDATED LOGIC TO PROPERLY PROCESS
  14945 C    AUSTRALIAN SEA-LEVEL PRESSURE BOGUS DATA (PAOBS); R.C. =4 NOW
  14946 C    OCCURS IF EITHER NO ADPUPA OR ADPSFC REPORTS WERE PROCESSED INTO
  14947 C    PREPBUFR FILE, BEFORE IT OCCURRED ONLY IF EITHER NO ADPUPA OR
  14948 C    ADPSFC REPORTS WERE READ IN
  14949 C 1999-11-04  D. A. KEYSER -- SWITCHES "FWINDO", "JSURFM" AND "JSURFW"
  14950 C    ARE NOW ABLE TO ACT ON SURFACE LAND SYNOPTIC AND METAR DATA
  14951 C    SEPARATELY; CAN NOW SKIP OVER INPUT BUFR MESSAGES IN DATA DUMP
  14952 C    FILES IF THE BUFR TYPE/SUBTYPE IS SET TO BE EXCLUDED (BEFORE
  14953 C    EXCLUSION OCCURRED ONLY AFTER REPORT WAS DECODED FROM DUMP FILE),
  14954 C    THIS MAKES THIS PROGRAM MORE EFFICIENT IN THESE CASES (NOTE:
  14955 C    APPLIES ONLY TO U-AIR AND SURFACE LAND DATA READ IN VIA FUNCTION
  14956 C    IW3UNPBF)
  14957 C 2000-09-22  D. A. KEYSER -- ADDED PROCESSING OF AUTOMATED TIDE GAUGE
  14958 C     STN DATA (SFC MARINE TYPE, ON29 R.T. 533), N-LIST SWITCHES
  14959 C     "FWINDO", "JSURFM" AND "JSURFW" EXPANDED FROM 8 TO 9 WORDS
  14960 C 2000-12-05  D. A. KEYSER -- CHANGED ON29 REPORT TYPE (T29) FOR SFC
  14961 C     MARINE AUTOMATED TIDE GAUGE REPORTS FROM 533 TO 532 SO THEY AGREE

Page 359         Source Listing                  GETPWATER
2017-04-18 11:09                                 prepdata.f

  14962 C     WITH REPORT TYPE IN QUIPS PROCESSING; N-LIST SWITCH "MSGPSF"
  14963 C     REPL. BY SWITCH "PFRALT" WHICH PROCESSES METARS W/ MISSING
  14964 C     PRESSURE BY CALC. PSTN FROM ALTIMETER, THESE GET NEW R.T.
  14965 C     187/287; METARS W/ MISSING WDIR & WSPD .LE. 3M/SEC ENCODE WSPD
  14966 C     OBS/QM IN NEW MNEM. "SOB" AND "SQM"; FOR IRNMRK=4 (RUC) ALL BUOYS
  14967 C     W/ MISSING PRESSURE BUT VALID WIND ARE PROC. W/ R.T. 282 (PRESS.
  14968 C     SET TO 1013.3MB, JUST LIKE ATLAS BUOYS)
  14969 C 2001-04-06  D. A. KEYSER -- PRINTS DIAG. IF TDEW < TDLIM; SUBR.
  14970 C     "RPTLBL" NOW HAS INPUT ARGS. "TIMWIN_e" (EARLIEST TIME WINDOW)
  14971 C     AND "TIMWIN_l" (LATEST TIME WINDOW) REPL. "TIMWIN" (+/- TIME
  14972 C     WINDOW) ("-" PRIOR TO CYCLE TIME, "+" AFTER CYCLE TIME), ALLOWS
  14973 C     THE 2 TO BE DIFFERENT
  14974 C 2001-06-19  D. A. KEYSER -- NEW SUBR. "TIMCHK" DOES TIME WINDOW CHECK
  14975 C     SEPARATE FROM "RPTLBL"
  14976 C 2001-09-14  D. A. KEYSER -- REPORT SEQ. NUMBER STORED IN HDR(11) FOR
  14977 C     SURFACE LAND AND SURFACE MARINE REPORTS LATER ENCODED IN PREPBUFR
  14978 C     FILE UNDER MESSAGE TYPES "ADPSFC" AND "SFCSHP"
  14979 C 2002-01-14  D. A. KEYSER -- LEVELS WITH REPORTED DWPT < "TDLIM" VALUE
  14980 C     NOW CALC. SPEC. HUM AND RETAIN DWPT IN PREPBUFR FILE, BUT
  14981 C     MOISTURE PREPBUFR TABLE VALUE IS FLAGGED WITH Q.M.=15 IN SUBR.
  14982 C     FIZZ01 (BEFORE, SPEC. HUM. AND DWPT SET TO MISSING) VIRT. TEMP.
  14983 C     CALC. AND ENCODED IN THIS CASE  (BEFORE, SET TO SENSIBLE TEMP.)
  14984 C 2002-01-28  D. A. KEYSER -- CORRECTED ERROR INTRODUCED ~1/9/2001
  14985 C     WHICH RESULTED IN NO MASS REPORTS BEING ENCODED INTO THE RUC
  14986 C     VERSION OF THE PREPBUFR FILE FOR MOORED AND DRIFTING BUOYS
  14987 C     (AFFECTED ONLY THE RUC AND ONLY THESE DATA TYPES)
  14988 C 2004-01-09  D. A. KEYSER -- SWITCH SUBSKP (NOW IN NAMELIST) SECOND
  14989 C     DIMENSION CHANGED FROM 1:200 TO 0:200 TO ACCOUNT FOR WMO RES. 40
  14990 C     SYNOP REPORTS WITH BUFR SUBTYPE 000; ITYP = 1 (AND PROCESSING
  14991 C     SWITCHES ASSOCIATED WITH IT) NOW INCLUDE WMO RES. 40 SYNOPS
  14992 C     (THIS WAS AN OVERSIGHT WHEN RES. 40 SYNOPS WERE SPLIT FROM
  14993 C     REMAINING SYNOPS IN ADPSFC DUMP FILE IN SUMMER OF 2003, BUT
  14994 C     IT CAUSED NO HARM TO DATE)
  14995 C 2004-09-09  D. A. KEYSER -- ADDED PROCESSING OF MESONET DATA, READ
  14996 C     FROM "MSONET" DUMP FILE DUMP R. TYPE 540, GET PREPBUFR R. TYPE
  14997 C     188/288, PROCESSED INTO PREPBUFR FILE UNDER NEW TBL A ENTRY
  14998 C     "MSONET", THESE CAN HAVE AN ELEVATION Q.M. - IF IT'S POOR SET
  14999 C     PSTN AND PMSL (IF PRESENT) Q.M. TO 15 (BAD), IF IT'S FAIR SET
  15000 C     PSTN AND PMSL (IF PRESENT) Q.M. TO 3 (SUSPECT); EXPANDED
  15001 C     NAMELIST SWITCHES FWINDO, JSURFM AND JSURFW FROM 9-WORDS TO 11-
  15002 C     WORDS TO ADD MESONET IN WORD 9 AND MOBILE SYNOPTIC LAND IN WORD
  15003 C     10; IF MESONET REPORT HAS A MISSING PSTN (PMSL ALWAYS MISSING)
  15004 C     BUT A VALID ALTIMETER SETTING, GENERATE PSTN FROM OBSERVED
  15005 C     ALTIMETER AND ELEV. (CHAR. 8 OF STNID IS SET TO 'a' TO IDENTIFY
  15006 C     THESE); IF MESONET REPORT HAS A MISSING PSTN (PMSL ALWAYS
  15007 C     MISSING) AND A MISSING ALTIMETER SETTING, GENERATE PSTN FROM STD.
  15008 C     ATMOS. PMSL, OBSERVED TEMP. AND ELEV. (CHAR. 8 OF STNID IS SET
  15009 C     TO 'x' TO IDENTIFY THESE); ADDED PROCESSING OF MOBILE SFC
  15010 C     SYNOPTIC LAND RPTS NOW POSSIBLY INCL. IN "ADPSFC" DUMP FILE DUMP
  15011 C     R. TYPE 514, INCL. WITH EXISTING PREPBUFR R. TYPES 181/183/281/
  15012 C     284, PROCESSED INTO PREPBUFR FILE UNDER EXISTING TBL A ENTRY
  15013 C     "ADPSFC"; NOW RETURNS 41-WORD (RATHER THAN 2-WORD) ARRAY "OBS2"
  15014 C     OUT OF CALL TO IW3UNPBF, WHERE WORDS 3-41 CONTAIN ALTIMETER
  15015 C     SETTING (WHICH HAD BEEN RETURNED IN CAT. 8, C.F. 20, NOW ONLY
  15016 C     ALTIMETER TBL. VAL. RETURNED FROM HERE), SEA-SURFACE TEMPERATURE,
  15017 C     SINGLE-LEVEL SENSIBLE WEATHER ELEMENTS AND SST TABLE VALUE
  15018 C     (Q.M.); RETURNS NEW ARRAY ARGUMENTS "OBS3" {(5,MXBLVL,5)} AND

Page 360         Source Listing                  GETPWATER
2017-04-18 11:09                                 prepdata.f

  15019 C     "NOBS3" {(5)} OUT OF CALL TO IW3UNPBF WHERE OBS3 CONTAINS
  15020 C     MULTIPLE-LEVEL SENSIBLE WEATHER ELEMENTS AND NOBS3 DEFINES THE
  15021 C     NUMBER OF LEVELS OF DATA IN THE OBS3(X,Y,1) TO OBS3(X,Y,5) ARRAYS
  15022 C     (SEE IW3UNPBF DOCBLOCK FOR MORE INFO); ALL NEW PARAMETERS (I.E.,
  15023 C     SST AND SENSIBLE WEATHER ELEMENTS) IN OBS2 AND OBS3 ARE ENCODED
  15024 C     INTO PREPBUFR FILE, BUT ONLY IN THE MASS "PIECE" OF A REPORT
  15025 C     (UNLESS THERE IS NO MASS PIECE, THEN THEY ARE ENCODED INTO WIND
  15026 C     PIECE)
  15027 C 2006-08-17  D. A. KEYSER -- MODIFIED THE FUNCTION WHICH CALC. PSTN
  15028 C     FROM ALTIMETER SETTING BASED ON REQUEST BY JOHN DERBER
  15029 C 2007-09-14  D. A. KEYSER -- CASES WHERE OBS ARE SET TO QM=15 IN ORDER
  15030 C     TO FLAG A REPORT FOR NON-USE BY ANALYSIS (EVEN THOUGH OBS MAY NOT
  15031 C     NECESSARILY BE BAD) NOW FIRST CHECK TO MAKE SURE OBS QM ISN'T
  15032 C     ALREADY "BAD" (> 3 AND < 15) (PREVENTS GSI FROM MONITORING TRULY
  15033 C     BAD OBS WHICH JUST HAPPEN TO BE IN REPORT GROUPS FLAGGED FOR NON-
  15034 C     USE BY ANALYSIS)
  15035 C 2008-09-25  D. A. KEYSER -- UPPER LIMIT FOR STORING Q CHANGED FROM
  15036 C     32767 MG/KG TO 99999 MG/KG TO ENSURE THAT LEVELS WITH VERY
  15037 C     HIGH SPECIFIC HUMIDITY ARE PROCESSED (THE 32767 LIMIT WAS A
  15038 C     VESTIGE FROM THE OLD I*2 PREPDA DAYS); IF NEAREST INTEGER FOR Q
  15039 C     IS 0 MG/KG, IT IS RESET TO 1 MG/KG (.001 G/KG) TO ENSURE THAT
  15040 C     LEVELS WITH VERY LOW SPECIFIC HUMIDITY ARE PROCESSED (Q MUST BE >
  15041 C     0 TO BE PROCESSED)
  15042 C 2010-06-07  D. A. KEYSER -- NOW CHECKS FOR ALTIMETER Q.M. IN CODE
  15043 C     FIG. 20 OF CAT. 8 FOR METARS (AS WELL AS FOR MESONETS AS BEFORE)
  15044 C     SINCE IW3UNPBF IS ALSO MODIFIED HERE TO STORE THIS FOR METARS
  15045 C     (BUT ONLY IF Q.M. VALUE IS 12-REJECT or 14-PURGE); CORRECTED BUG
  15046 C     WHICH WAS NOT PROPERLY INTERPRETING ALTIMETER Q.M. IN CODE FIG.
  15047 C     20 OF CAT. 8 FOR MESONETS (MANY MESONET PRESS. Q.M.'S WERE SET TO
  15048 C     2 OR 15 WHEN THEY SHOULD HAVE BEEN SET TO 3 OR 13, RESP.) (NOTE
  15049 C     THAT MESONETS TO NOT REPORT PRESS. SO ALTIMETER SETTING IS USED
  15050 C     TO CALCULATE PRESS. AND THE ALTIMETER Q.M. IS TRANSFERRED TO
  15051 C     PRESS.)
  15052 C 2014-04-25  S. Melchior  --
  15053 C          - Added processing of Coast Guard tide gauge data (read from
  15054 C     SFCSHP dump, dump report type 534). A 12'th word added to
  15055 C     following namelist switches to account for these new reports:
  15056 C     FWINDO, JSURFM, JSURFW.
  15057 C          - Added new namelist switch NPKRPT, if TRUE all of the below
  15058 C     occurs: will process reports that would otherwise be tossed due
  15059 C     to their having a missing pstn; these reports estimate pstn from
  15060 C     the reported or U.S. std. atmosphere pmsl, the reported or U.S.
  15061 C     std. atmosphere sensible temperature, and the reported elevation
  15062 C     (only marine reports > 7.5 m can have a reported pmsl and fall
  15063 C     into this category); this estimated pstn (POB) is used to
  15064 C     estimate q (QOB); both POB and QOB are assigned minimum q.m.'s
  15065 C     (PQM, QQM) of 3; estimated POB is encoded into PREPBUFR file;
  15066 C     these reports are then assigned new PREPBUFR report types 192/292
  15067 C     (SYNOP), 193/293 (METAR), 194/294 (marine), 195/295 (mesonet);
  15068 C     ATLAS buoy wind reports which also have missing pstn and pmsl
  15069 C     will continue to be processed as before (PREPBUFR report type 282
  15070 C     - note: this means that if an ATLAS buoy ever had T,q info, its
  15071 C     mass piece would still be tossed rather than getting into
  15072 C     PREPBUFR file under report type 194 (may need to fix this logic
  15073 C     someday); MESONETS will no longer have "x" in character 8 of id,
  15074 C     instead they will get PREPBUFR report types 195/295 rather than
  15075 C     188/288.

Page 361         Source Listing                  GETPWATER
2017-04-18 11:09                                 prepdata.f

  15076 C          - Modified to trap reports whose wind information exceeds
  15077 C     the 32767 limit.  If the limit is exceeded, the entire report
  15078 C     will skip being encoded into the output PREPBUFR file.
  15079 C          - Modified to always encode wind speed obs in m/sec ("SOB")
  15080 C     and wind direction obs ("DDO") for all types of surface reports
  15081 C     (even if one or the other are missing but also if both are
  15082 C     present); removed old logic which encoded "SOB" only for METAR
  15083 C     reports when direction was missing and speed was .LE. 3 m/sec
  15084 C     (direction was never encoded in any situation for surface
  15085 C     reports), also removed encoding of "SQM" (wind speed quality
  15086 C     mark) for these types of METAR reports - all surface reports now
  15087 C     encode wind qm as "WQM" regardless of whether or not it also
  15088 C     encodes direction, speed, u-comp or v-comp.
  15089 C          - Report type 183 now stores moisture quality mark no lower
  15090 C     than 3 (suspect) (before type 183 stored observed moisture
  15091 C     quality mark read from the ADPSFC dump file).
  15092 C 2015-04-16  D. A. Keyser -- Call to subr. LNDCHK now uses new 16
  15093 C     point check for determining if marine reports in the N.H. are
  15094 C     over land or sea.
  15095 C
  15096 C USAGE:    CALL SFCDTA
  15097 C   INPUT FILES:
  15098 C          {FF IS UNIT NUMBER DEFINED AS IUNIT(6)  IN NAMELIST "&PARM"}
  15099 C          {EE IS UNIT NUMBER DEFINED AS IUNIT(5)  IN NAMELIST "&PARM"}
  15100 C     UNIT FF   - 'ADPSFC' BUFR DATA DUMP FILE {SYNOPTIC (INCL. WMO RES.
  15101 C                 40)/METAR LAND SFC)
  15102 C     UNIT FF+1 - 'SFCSHP' BUFR DATA DUMP FILE (MARINE SURFACE)
  15103 C     UNIT EE   - 'ADPUPA' BUFR DATA DUMP FILE (RAOB/PIBAL/DROPS/RECCOS)
  15104 C     UNIT FF+2 - 'SFCBOG' BUFR DATA DUMP FILE (MEAN SEA-LVL PRES BOGUS)
  15105 C     UNIT FF+3 - 'MSONET' BUFR DATA DUMP FILE (COOPERATIVE NETWORKS)
  15106 C
  15107 C   OUTPUT FILES:
  15108 C     UNIT 06  - STANDARD OUTPUT PRINT
  15109 C
  15110 C REMARKS: CALLED BY SUBROUTINE 'PREP'.  SIMILAR TO SUBROUTINE 'PREP'
  15111 C   BUT HANDLES ONLY SURFACE DATA.
  15112 C
  15113 C ATTRIBUTES:
  15114 C   LANGUAGE: FORTRAN 90
  15115 C   MACHINE:  NCEP WCOSS
  15116 C
  15117 C$$$
  15118       SUBROUTINE SFCDTA
  15119       PARAMETER (MXWRDH = 15)
  15120       PARAMETER (MXTYPV =  3)
  15121       PARAMETER (MXWRDL =  6)
  15122       PARAMETER (MXLVL = 600)
  15123       PARAMETER (MXBLVL = 255)
  15124       PARAMETER (MAXOBS = 3500)
  15125       PARAMETER (NUMOBS2 = 43)
  15126       CHARACTER*8   STNID,FILNAM(5),DSNAME,SUBSET_d
  15127       CHARACTER*41  NAME1
  15128       LOGICAL  LFM,MARLND,MSLBOG,ATLAS,PFRALT,SFLAND,SUBSKP,PFRALT_save,
  15129      $ npkrpt
  15130       INTEGER  IDATA(MAXOBS),NC(5),ISQNUM(3),NOBS3_SAVE(7)
  15131       INTEGER(8)  IDSDMP_8
  15132       REAL OBS2_SAVE(4:NUMOBS2),OBS3_SAVE(5,MXBLVL,7)

Page 362         Source Listing                  SFCDTA
2017-04-18 11:09                                 prepdata.f

  15133       REAL(8)  BMISS,obs8_8,alon_8,alat_8
  15134       COMMON/RUNSW/IRNMRK
  15135       COMMON/STRMSL/IPMSL(MXTYPV)
  15136       COMMON/STRMOB/MOBS(MXTYPV,MXWRDL,MXLVL)
  15137       COMMON/LNDSEA/GDSH(145,37),GDUS(362,91),GDNH(362,91)
  15138       COMMON/ADP/ISATOB,PMAND(23),RDATA(MAXOBS),IPRINT
  15139       COMMON/DATA/KOUNT,IDATE(4),IDAT10,MP_PROCESS,WRMISS
  15140       COMMON/RPTHDR/SUBSET_d,STNID,HDR(2:MXWRDH),alon_8,alat_8
  15141       COMMON/UNITNO/NFILE,IUNIT(28)
  15142       COMMON/LFMSFC/LFMAXI,LFMAXJ,FMESHL,FLONVT,FPOLEI,FPOLEJ,MARLND,
  15143      $ JSURFM(12),JSURFW(12),FWINDO(12),PFRALT,npkrpt(12)
  15144       COMMON/PARM4/ICODE
  15145       COMMON/SKPCNT/KSKPUA,KSKPSF,KMSGUA,KMSGSF,KBDYUA,KBDYSF,KTIMUA,
  15146      $ KTIMSF,KSKNSW,KSKREC,KNOATS,KNTUPA,KNTCAR,KNTAIR,KNTSWN,KNTPRO,
  15147      $ KNTVAD,KNTRAS,KNTDUM(3),KNTSSS(5),KSKSWN,KSKACF,KNDCDE(3),
  15148      $ KSKCLS,KSKTHN,KSKOMR(2),KSKALM(9),KSKAHM(9),KSKNOW(9),KSKDRP
  15149       COMMON/SFCBFR/ALTIMR,PRSS
  15150       COMMON/SKPSUB/SUBSKP(0:255,0:200)
  15151       COMMON/DIRECT/OBS3(5,MXBLVL,7),OBS2(NUMOBS2),NOBS3(7),RDATA2(25),
  15152      $ obs8_8(2)
  15153       common/pstnflg/ipstnflg
  15154       COMMON /BUFRLIB_MISSING/BMISS
  15155       EQUIVALENCE  (IDATA,RDATA)
  15156       DATA  NC/1,2,4,5,3/
  15157       DATA XMISS/99999./,YMISS/99998.8/,IMISS/99999/
  15158       DATA  FILNAM/'ADPSFC  ','SFCSHP  ','MSONET  ','ADPUPA  ',
  15159      $             'SFCBOG  '/
  15160 C FCN PR GETS PSTN FROM PMSL, TEMPERATURE AND ELEVATION (ELEV < 11000M)
  15161       PR(PMSL,TEMP,ELEV) =PMSL * (((TEMP - (.0065 * ELEV))/TEMP)**5.256)
  15162 C FCNS BELOW CONVERT TEMP/TD (K) & PRESS (MB) INTO SAT./ SPEC. HUM.(G/G)
  15163       ES(T) = 6.1078 * EXP((17.269 * (T - 273.16))/((T - 273.16)+237.3))
  15164       QFRMTP(T,P) = (0.622 * ES(T))/(P - (0.378 * ES(T)))
  15165 C FCN P_f_A GETS PSTN (MB) FROM ALTIMETER SETTING (MB) AND ELEVATION (M)
  15166       P_f_A(ALT,ELEV) = (ALT**0.190284 - (((1013.25**0.190284)*
  15167      $ 0.0065/288.15)*ELEV))**5.2553026
  15168 ccccc      P_f_A(ALT,ELEV) = (ALT**0.190284 - (((1013.25**0.190284)*
  15169 ccccc     $ 0.0065/288.15)*ELEV))**5.2553026 + 0.3
  15170       PRINT 8001
  15171  8001 FORMAT(//31X,21('-'),' ***** SURFACE DATA ***** ',21('-'))
  15172       IATLAS = 562  ! Atlas buoys have this dump report type (drifting)
  15173 C IQMLIM IS PREPBUFR TBL VAL. LIMIT FOR ACCEPTING REPORTS
  15174       IQMLIM = 16
  15175       NN = 1
  15176       ISQNUM = 0
  15177       MNDX = 1
  15178       PFRALT_save=PFRALT ! namelist switch PFRALT will be hardwired to
  15179                          !  true if mesonet reports (NN=3) are
  15180                          !  processed - save original value so it can
  15181                          !  be set back for subsequent sfc types (NN>3)
  15182   700 CONTINUE
  15183       IOPENED   = 0
  15184       DSNAME    = 'ZZZZZZZZ'
  15185       IDSDAT    = 0
  15186       IDSDMP_8  = 0
  15187       SUBSET_d  = 'XXXXXXXX'
  15188 C KNTALL COUNTS NO. OF REPORTS UNPACKED FROM FILE (ALL REPORTS)
  15189       KNTALL = 0

Page 363         Source Listing                  SFCDTA
2017-04-18 11:09                                 prepdata.f

  15190 C KOUNT COUNTS NO. OF REPORTS UNPACKED (& NOT SKIPPED) FROM FILE
  15191       KOUNT = 0
  15192 C NN WILL INDICATE WHICH SURFACE FILE IS BEING EXAMINED:
  15193 C    NN = 1 ===> ADPSFC (LAND SURFACE)
  15194 C    NN = 2 ===> SFCSHP (MARINE SHIP, BUOY, C-MAN, TIDE GAUGE)
  15195 C    NN = 3 ===> MESONET SURFACE (COOPERATIVE NETWORKS)
  15196 C    NN = 4 ===> ADPUPA (SPLASH-LEVEL REPORTS OVER WATER FROM EITHER
  15197 C                DROPWINSONDES OR RECCOS WITH PMSL OBS)
  15198 C    NN = 5 ===> SFCBOG (MEAN S-LVL PRESS. BOGUS OVER WATER -BOTH TYPES)
  15199       NNN = NC(NN)
  15200       IF(NN.EQ.1)  THEN
  15201 C CHECK TO SEE IF ANY BUFR MESSAGES CAN BE SKIPPED IN INPUT ADPSFC DUMP
  15202          IF(MIN(JSURFM(1),JSURFW(1)).EQ.9999)  THEN
  15203             SUBSKP(000,000) = .TRUE.
  15204             SUBSKP(000,001) = .TRUE.
  15205          END IF
  15206          IF(MIN(JSURFM(11),JSURFW(11)).EQ.9999) SUBSKP(000,002) = .TRUE.
  15207          IF(MIN(JSURFM(8), JSURFW(8)) .EQ.9999) SUBSKP(000,007) = .TRUE.
  15208 C CHECK TO SEE IF ADPSFC DATA SHOULD BE PROCESSED
  15209          IF(SUBSKP(000,000).AND.SUBSKP(000,001).AND.SUBSKP(000,002).AND.
  15210      $    SUBSKP(000,007))  GO TO 7008
  15211       ELSE  IF(NN.EQ.5)  THEN
  15212 C CHECK TO SEE IF SFCBOG DATA SHOULD BE PROCESSED
  15213          IF(MIN(JSURFM(3),JSURFM(7)).GT.0)  GO TO 7008
  15214       ELSE  IF(NN.EQ.3)  THEN
  15215          IF(MIN(JSURFM(10),JSURFW(10)).EQ.9999) GO TO 7008
  15216 C MESONET REPORTS ALWAYS GET PFRALT=.TRUE.
  15217          PFRALT=.TRUE.
  15218       ELSE  IF(NN.GT.3)  THEN
  15219          PFRALT=PFRALT_save ! set PFRALT back to its original value
  15220                             !  since it was hardwired as TRUE for
  15221                             !  mesonets
  15222       END IF
  15223 C OTHERWISE SET-UP PROPER UNIT NOS. TO READ IN FOR NN = 1-5
  15224       NFILE = NNN + IUNIT(6) - 1
  15225       IF(NN.EQ.4)  THEN
  15226 C CHECK TO SEE IF SPLASH-LEVEL REPORTS FROM DROPS OR RECCOS WITH PMSL
  15227 C  OBS (ADPUPA) SHOULD BE PROCESSED; OTHERWISE SET-UP UNIT NO. FOR NN=4
  15228          IF(JSURFM(5).NE.0)  GO TO 7008
  15229          NFILE = IUNIT(5)
  15230       END IF
  15231       IFLAG = 0
  15232       PRINT 5678, FILNAM(NN)
  15233  5678 FORMAT(/130('.')/15X,'Next Dataset should be ',A8/130('.')/)
  15234       GO TO 2100
  15235 C***********************************************************************
  15236 C***********************************************************************
  15237  2090 CONTINUE
  15238 C COUNT ALL SKIPPED REPORTS
  15239       KSKPSF = KSKPSF + 1
  15240 C***********************************************************************
  15241 C***********************************************************************
  15242  2100 CONTINUE
  15243 C initialize ipstnflg as 0 prior to unpacking each new report (will be
  15244 C  set to 1 if a report has missing pressure and it is to be kept,
  15245 C  i.e., npkrpt=T for the particular type)
  15246       ipstnflg = 0

Page 364         Source Listing                  SFCDTA
2017-04-18 11:09                                 prepdata.f

  15247 C CALL UNPREPBF TO UNPACK THE NEXT REPORT
  15248       CALL UNPREPBF(IFLAG,CYCLET,IOPENED,DSNAME,IDSDAT,IDSDMP_8,*7000)


ENTRY POINTS

  Name               
                     
 sfcdta_             


SYMBOL CROSS REFERENCE

 Name                       Object Declared Type            Bytes Dimen Elements Attributes       References                        
                                                                                                                                    
 11                         Label  16132                                                          16046                             
 1101                       Label  15610                                                          15609                             
 1102                       Label  15627                                                          15626                             
 1103                       Label  15635                                                          15634                             
 1104                       Label  15985                                                          15984                             
 111                        Label  15689                                                          15688                             
 1115                       Label  15744                                                          15742                             
 112                        Label  15617                                                          15616                             
 1490                       Label  15438                                                          15407,15416,15420,15428           
 15                         Label  16235                                                          16194,16204,16209,16216,16219     
 169                        Label  15752                                                          15751                             
 1762                       Label  15864                                                          15781                             
 1800                       Label  16001                                                          15966,15968,15971,15994           
 1862                       Label  15961                                                          15839,15854                       
 1918                       Label  15682                                                          15681                             
 1919                       Label  15531                                                          15530                             
 1968                       Label  15655                                                          15654                             
 1969                       Label  15647                                                          15646                             
 1970                       Label  15670                                                          15669                             
 1971                       Label  15663                                                          15662                             
 2090                       Label  15237                                                          15372,15404,15493,15522,15582,1558
                                                                                                  9,15620,15691,15754,15862,15878,15
                                                                                                  934,16042,16084,16170,16270       
 2100                       Label  15242                                                          15234,15283,15304,15365,16273     
 2115                       Label  15760                                                          15759                             
 2150                       Label  16010                                                          15536,16003                       
 2713                       Label  16035                                                          16034                             
 2872                       Label  15277                                                          15276                             
 2918                       Label  15696                                                          15695                             
 2957                       Label  15976                                                          15974                             
 3872                       Label  15281                                                          15280                             
 3954                       Label  15587                                                          15586                             
 3955                       Label  16080                                                          16079,16169                       
 5678                       Label  15233                                                          15232                             
 5679                       Label  16287                                                          16286                             
 592                        Label  16266                                                          16137,16139                       
 6713                       Label  16039                                                          16038                             
 679                        Label  15992                                                          15991                             
 700                        Label  15182                                                          16285                             
 7000                       Label  16276                                                          15248                             
 7005                       Label  15702                                                          15603                             
 7008                       Label  16283                                                          15210,15213,15215,15228           

Page 365         Source Listing                  SFCDTA
2017-04-18 11:09 Symbol Table                    prepdata.f

 Name                       Object Declared Type            Bytes Dimen Elements Attributes       References                        
                                                                                                                                    
 779                        Label  15477                                                          15470,15472                       
 8001                       Label  15171                                                          15170                             
 871                        Label  15253                                                          15252                             
 872                        Label  15271                                                          15269                             
 873                        Label  15262                                                          15257,15259,15261,15266           
 8759                       Label  15491                                                          15490                             
 8779                       Label  15520                                                          15519                             
 929                        Label  15433                                                          15432                             
 950                        Label  16278                                                          16277                             
 954                        Label  15580                                                          15579                             
 955                        Label  15859                                                          15857                             
 956                        Label  15931                                                          15929                             
 957                        Label  15940                                                          15938                             
 959                        Label  15592                                                          15591                             
 960                        Label  15876                                                          15875                             
 961                        Label  15881                                                          15880                             
 ABS                        Func   15380                                scalar                    15380                             
 ADP                        Common 15138                                14100                                                       
 ALAT_8                     Scalar 15133    R(8)            8           scalar   COM                                                
 ALON_8                     Scalar 15133    R(8)            8           scalar   COM                                                
 ALTIMR                     Scalar 15149    R(4)            4           scalar   COM              15454,15481,15705,15714           
 AMSLPR                     Local  15293    R(4)            4           scalar                    15293,15314,15557                 
 ATLAS                      Local  15128    L(4)            4           scalar                    15345,15806,15807,15809,15819,1602
                                                                                                  8,16074,16114,16139               
 BMISS                      Scalar 15133    R(8)            8           scalar   COM              15465,15479,16117,16118           
 BUFRLIB_MISSING            Common 15154                                8                                                           
 CHKREP                     Subr   15372                                                          15372                             
 CYCLET                     Local  15248    R(4)            4           scalar                    15248,15394                       
 DATA                       Common 15139                                32                                                          
 DIRECT                     Common 15151                                36016                                                       
 DP                         Local  16210    R(4)            4           scalar                    16210,16212,16214                 
 DPDP                       Local  15443    R(4)            4           scalar                    15443,15568,16004,16208,16210     
 DPVL                       Local  15524    R(4)            4           scalar                    15524,15526,15530,15676,15678,1568
                                                                                                  1                                 
 DSNAME                     Local  15126    CHAR            8           scalar                    15184,15248                       
 DVAL                       Local  15732    R(4)            4           scalar                    15732,15739,15743,15957           
 DVALMN                     Local  15737    R(4)            4           scalar                    15737,15738,15739                 
 ELEV                       Local  15495    R(4)            4           scalar                    15495,15530,15551,15560,15575,1559
                                                                                                  4,15595,15681,15695,15714,15732,15
                                                                                                  743,15759,15765,15833,15848,15874,
                                                                                                  15889,15930,15939,15950,15975,1617
                                                                                                  9                                 
 ES                         Local  15163    R(4)            4           scalar                    15164                             
 EXP                        Func   15163                                scalar                    15163                             
 FILLX                      Subr   16122                                                          16122,16255                       
 FILNAM                     Local  15126    CHAR            8     1     5                         15158,15232                       
 FLONVT                     Scalar 15142    R(4)            4           scalar   COM              15383                             
 FMESHL                     Scalar 15142    R(4)            4           scalar   COM              15383                             
 FPOLEI                     Scalar 15142    R(4)            4           scalar   COM              15385                             
 FPOLEJ                     Scalar 15142    R(4)            4           scalar   COM              15386                             
 FWINDO                     Scalar 15143    R(4)            4     1     12       COM              15257,15259,15261,15266,15269,1527
                                                                                                  0,15276,15280,15399,15400         
 GDNH                       Scalar 15137    R(4)            4     2     32942    COM              15426                             
 GDSH                       Scalar 15137    R(4)            4     2     5365     COM              15423                             
 GDUS                       Scalar 15137    R(4)            4     2     32942    COM                                                

Page 366         Source Listing                  SFCDTA
2017-04-18 11:09 Symbol Table                    prepdata.f

 Name                       Object Declared Type            Bytes Dimen Elements Attributes       References                        
                                                                                                                                    
 HDR                        Scalar 15140    R(4)            4     1     14       COM              15401,15504,15510,15595,15742,1585
                                                                                                  7,16053,16056,16063,16065,16067,16
                                                                                                  069,16071,16073,16075,16079,16113,
                                                                                                  16149,16156,16158,16160,16162,1616
                                                                                                  4,16166,16169,16247,16253         
 I                          Local  15309    I(4)            4           scalar                    15309,15461                       
 IATLAS                     Local  15172    I(4)            4           scalar                    15172,15808                       
 ICALLM                     Local  15289    I(4)            4           scalar                    15289,16256,16267                 
 ICALLW                     Local  15290    I(4)            4           scalar                    15290,16124,16267                 
 ICF352                     Local  15292    I(4)            4           scalar                    15292,15313,15555                 
 ICODE                      Scalar 15144    I(4)            4           scalar   COM              16281                             
 IDAT10                     Scalar 15139    I(4)            4           scalar   COM                                                
 IDATA                      Scalar 15130    I(4)            4     1     3500     COM              15302,15307,15308,15309,15322,1543
                                                                                                  2,15459,15460,15461,15488,15490,15
                                                                                                  515,15519,15530,15545,15563,15579,
                                                                                                  15586,15591,15609,15616,15626,1563
                                                                                                  4,15646,15654,15662,15669,15681,15
                                                                                                  688,15695,15742,15751,15759,15808,
                                                                                                  15858,15875,15880,15930,15939,1597
                                                                                                  5,15984,16034,16038,16062,16064,16
                                                                                                  066,16068,16070,16072,16074,16079,
                                                                                                  16155,16157,16159,16161,16163,1616
                                                                                                  5,16169                           
 IDATE                      Scalar 15139    I(4)            4     1     4        COM                                                
 IDSDAT                     Local  15185    I(4)            4           scalar                    15185,15248                       
 IDSDMP_8                   Local  15131    I(8)            8           scalar                    15186,15248                       
 IER                        Local  15401    I(4)            4           scalar                    15401,15402                       
 IERF                       Local  16122    I(4)            4           scalar                    16122,16123,16255,16256           
 IFLAG                      Local  15231    I(4)            4           scalar                    15231,15248,15249                 
 IFLSF                      Local  15343    I(4)            4           scalar                    15343,15435,15436,15943,15945,1609
                                                                                                  2,16182,16242                     
 IFLTH                      Local  15344    I(4)            4           scalar                    15344,15944,15974,15978,16092     
 IFOUND_20                  Local  15456    I(4)            4           scalar                    15456,15464,15485                 
 ILAND                      Local  15423    I(4)            4           scalar                    15423,15426,15428                 
 IM0                        Local  15447    I(4)            4           scalar                    15447,15506,15512,15528,15623,1562
                                                                                                  4,15625,15653,15668,15680,15687,15
                                                                                                  688,15693,15763,15772,15894,15896,
                                                                                                  15951,16242,16243                 
 IMA                        Local  15453    I(4)            4           scalar                    15453,15467,15468,15485,15715     
 IME                        Local  15455    I(4)            4           scalar                    15455,15602,15641,15646,15654,1565
                                                                                                  8,15662,15669                     
 IMISS                      Local  15157    I(4)            4           scalar                    15157,15455,16058,16088,16151,1617
                                                                                                  4,16227,16234                     
 IMM                        Local  15563    I(4)            4           scalar                    15563,15564,15565,15567,15568,1556
                                                                                                  9,15570                           
 IMP                        Local  15448    I(4)            4           scalar                    15448,15507,15513,15529,15558,1556
                                                                                                  5,15566,15631,15632,15633,15645,15
                                                                                                  661,15699,15715,15730,15741,15750,
                                                                                                  15751,15756,15772,15836,15838,1585
                                                                                                  0,15894,15896,15898,15951,15952,16
                                                                                                  091,16181,16183,16189,16247       
 IMPW                       Local  16091    I(4)            4           scalar                    16091,16093,16097                 
 IMQ                        Local  15450    I(4)            4           scalar                    15450,15570,15838,15952,16005,1600
                                                                                                  6,16008,16186,16192,16208         
 IMT                        Local  15449    I(4)            4           scalar                    15449,15569,15606,15607,15608,1561

Page 367         Source Listing                  SFCDTA
2017-04-18 11:09 Symbol Table                    prepdata.f

 Name                       Object Declared Type            Bytes Dimen Elements Attributes       References                        
                                                                                                                                    
                                                                                                  3,15616,16185,16191,16194         
 IMW                        Local  15451    I(4)            4           scalar                    15451,15981,15982,15983,15990,1599
                                                                                                  1,16094,16098,16099               
 IMZ                        Local  15452    I(4)            4           scalar                    15452,16181,16184,16190           
 INSTR                      Local  15351    I(4)            4           scalar                    15351,15352,15354,15356,15717,1582
                                                                                                  3,15885,15898,15956,16053,16149   
 INTQ                       Local  16227    I(4)            4           scalar                    16227,16229,16231,16234           
 IOPENED                    Local  15183    I(4)            4           scalar                    15183,15248                       
 IPMSL                      Scalar 15135    I(4)            4     1     3        COM              16088,16174,16241,16243           
 IPRINT                     Scalar 15138    I(4)            4           scalar   COM              15431,15857,15875,15929,15938,1597
                                                                                                  4                                 
 IPSTNFLG                   Scalar 15153    I(4)            4           scalar   COM              15246,15834,15927,16059,16152     
 IQMLIM                     Local  15174    I(4)            4           scalar                    15174,15613,15687,15750,15990,1599
                                                                                                  1,16194,16209                     
 IRNMRK                     Scalar 15134    I(4)            4           scalar   COM              15806,16033                       
 ISATOB                     Scalar 15138    I(4)            4           scalar   COM                                                
 ISQNUM                     Local  15130    I(4)            4     1     3                         15176,16021,16032,16113,16253,1626
                                                                                                  9                                 
 ISSEL                      Func   15322    I(4)            4           scalar                    15322                             
 ITYP                       Local  15291    I(4)            4           scalar                    15291,15315,15322,15347,15348,1535
                                                                                                  3,15355,15357,15399,15400,15416,15
                                                                                                  431,15457,15485,15488,15502,15552,
                                                                                                  15603,15716,15738,15765,15806,1582
                                                                                                  4,15840,15884,15926,15966,15971,16
                                                                                                  003,16018,16137,16247             
 IUNIT                      Scalar 15141    I(4)            4     1     28       COM              15224,15229                       
 JSURFM                     Scalar 15143    I(4)            4     1     12       COM              15202,15206,15207,15213,15215,1522
                                                                                                  8,15431,16137                     
 JSURFW                     Scalar 15143    I(4)            4     1     12       COM              15202,15206,15207,15215,15971     
 JT                         Local  16196    I(4)            4           scalar                    16196,16197,16200,16223,16225     
 KBDYSF                     Scalar 15145    I(4)            4           scalar   COM              15372                             
 KBDYUA                     Scalar 15145    I(4)            4           scalar   COM                                                
 KMSGSF                     Scalar 15145    I(4)            4           scalar   COM              15372                             
 KMSGUA                     Scalar 15145    I(4)            4           scalar   COM                                                
 KNDCDE                     Scalar 15147    I(4)            4     1     3        COM                                                
 KNOATS                     Scalar 15146    I(4)            4           scalar   COM                                                
 KNTAIR                     Scalar 15146    I(4)            4           scalar   COM                                                
 KNTALL                     Local  15189    I(4)            4           scalar                    15189,15286,16277                 
 KNTCAR                     Scalar 15146    I(4)            4           scalar   COM                                                
 KNTDUM                     Scalar 15147    I(4)            4     1     3        COM                                                
 KNTPRO                     Scalar 15146    I(4)            4           scalar   COM                                                
 KNTRAS                     Scalar 15147    I(4)            4           scalar   COM                                                
 KNTSSS                     Scalar 15147    I(4)            4     1     5        COM              16280                             
 KNTSWN                     Scalar 15146    I(4)            4           scalar   COM                                                
 KNTUPA                     Scalar 15146    I(4)            4           scalar   COM                                                
 KNTVAD                     Scalar 15147    I(4)            4           scalar   COM                                                
 KOUNT                      Scalar 15139    I(4)            4           scalar   COM              15191,16015,16031,16268,16280,1628
                                                                                                  1                                 
 KSKACF                     Scalar 15147    I(4)            4           scalar   COM                                                
 KSKAHM                     Scalar 15148    I(4)            4     1     9        COM                                                
 KSKALM                     Scalar 15148    I(4)            4     1     9        COM                                                
 KSKCLS                     Scalar 15148    I(4)            4           scalar   COM                                                
 KSKDRP                     Scalar 15148    I(4)            4           scalar   COM                                                
 KSKNOW                     Scalar 15148    I(4)            4     1     9        COM                                                
 KSKNSW                     Scalar 15146    I(4)            4           scalar   COM                                                

Page 368         Source Listing                  SFCDTA
2017-04-18 11:09 Symbol Table                    prepdata.f

 Name                       Object Declared Type            Bytes Dimen Elements Attributes       References                        
                                                                                                                                    
 KSKOMR                     Scalar 15148    I(4)            4     1     2        COM              15435                             
 KSKPSF                     Scalar 15145    I(4)            4           scalar   COM              15239                             
 KSKPUA                     Scalar 15145    I(4)            4           scalar   COM                                                
 KSKREC                     Scalar 15146    I(4)            4           scalar   COM                                                
 KSKSWN                     Scalar 15147    I(4)            4           scalar   COM                                                
 KSKTHN                     Scalar 15148    I(4)            4           scalar   COM              15943                             
 KTIMSF                     Scalar 15146    I(4)            4           scalar   COM              15403                             
 KTIMUA                     Scalar 15145    I(4)            4           scalar   COM                                                
 L                          Local  15515    I(4)            4           scalar                    15515,15516,15545,15605,15606,1562
                                                                                                  3,15631,15639,15640,15968,15981,15
                                                                                                  997,15999,16004,16006,16008,16022,
                                                                                                  16107,16109                       
 L8                         Local  15308    I(4)            4           scalar                    15308,15310,15311,15312,15314,1546
                                                                                                  0,15462,15463,15468               
 LFM                        Local  15128    L(4)            4           scalar                    15375,15387,15937,15973           
 LFMAXI                     Scalar 15142    I(4)            4           scalar   COM              15376,15387                       
 LFMAXJ                     Scalar 15142    I(4)            4           scalar   COM              15376,15388                       
 LFMSFC                     Common 15142                                224                                                         
 LNDCHK                     Subr   15423                                                          15423,15426                       
 LNDSEA                     Common 15137                                284996                                                      
 MARLND                     Scalar 15128    L(4)            4           scalar   COM              15407                             
 MAX                        Func   15772                                scalar                    15772,15836,15850,15894,15951,1599
                                                                                                  7,16008,16022,16100               
 MAXOBS                     Param  15124    I(4)            4           scalar                    15130,15138                       
 MIN                        Func   15202                                scalar                    15202,15206,15207,15213,15215,1596
                                                                                                  8,16022                           
 MNDX                       Local  15177    I(4)            4           scalar                    15177,16017,16019,16021,16032,1611
                                                                                                  3,16253,16269                     
 MOBS                       Scalar 15136    I(4)            4     3     10800    COM              16058,16090,16097,16098,16099,1610
                                                                                                  2,16104,16107,16109,16151,16177,16
                                                                                                  179,16189,16190,16191,16192,16200,
                                                                                                  16213,16225,16234                 
 MOD                        Func   16053                                scalar                    16053                             
 MP_PROCESS                 Scalar 15139    I(4)            4           scalar   COM                                                
 MSLBOG                     Local  15128    L(4)            4           scalar                    15348,15418,15431,15496,16149     
 MXBLVL                     Param  15123    I(4)            4           scalar                    15132,15151                       
 MXLVL                      Param  15122    I(4)            4           scalar                    15136                             
 MXTYPV                     Param  15120    I(4)            4           scalar                    15135,15136,16058,16151           
 MXWRDH                     Param  15119    I(4)            4           scalar                    15140                             
 MXWRDL                     Param  15121    I(4)            4           scalar                    15136,16058,16151                 
 NAME1                      Local  15127    CHAR            41          scalar                    15255,15257,15258,15259,15260,1526
                                                                                                  1,15265,15266                     
 NC                         Local  15130    I(4)            4     1     5                         15156,15199                       
 NFILE                      Scalar 15141    I(4)            4           scalar   COM              15224,15229,16282                 
 NINT                       Func   15311                                scalar                    15311,15380,15382,15418,15419,1542
                                                                                                  0,15422,15463,15468,15481,15495,15
                                                                                                  516,15551,15564,15565,15567,15568,
                                                                                                  15569,15570,15583,15584,15585,1560
                                                                                                  1,15602,15605,15606,15623,15631,15
                                                                                                  639,15640,15813,15814,15815,15816,
                                                                                                  15871,15872,15981,16004,16006,1600
                                                                                                  8,16090,16100,16102,16104,16107,16
                                                                                                  109,16177,16179,16196,16213,16223,
                                                                                                  16229,16240,16241                 
 NN                         Local  15175    I(4)            4           scalar                    15175,15199,15200,15211,15214,1521

Page 369         Source Listing                  SFCDTA
2017-04-18 11:09 Symbol Table                    prepdata.f

 Name                       Object Declared Type            Bytes Dimen Elements Attributes       References                        
                                                                                                                                    
                                                                                                  8,15225,15232,15254,15264,15268,15
                                                                                                  275,15279,15300,16281,16284,16285 
 NNN                        Local  15199    I(4)            4           scalar                    15199,15224,16280                 
 NOBS3                      Scalar 15151    I(4)            4     1     7        COM              15299,16119,16147                 
 NOBS3_SAVE                 Local  15130    I(4)            4     1     7                         15299,16147                       
 NPKRPT                     Scalar 15129    L(4)            4     1     12       COM              15824,15926                       
 NUMOBS2                    Param  15125    I(4)            4           scalar                    15132,15151,15297,16117,16145     
 OBS2                       Scalar 15151    R(4)            4     1     43       COM              15297,15465,15479,15481,16117,1614
                                                                                                  5                                 
 OBS2_SAVE                  Local  15132    R(4)            4     1     40                        15297,16145                       
 OBS3                       Scalar 15151    R(4)            4     3     8925     COM              15298,16118,16146                 
 OBS3_SAVE                  Local  15132    R(4)            4     3     8925                      15298,16146                       
 OBS8_8                     Scalar 15133    R(8)            8     1     2        COM                                                
 PARM4                      Common 15144                                4                                                           
 PFRALT                     Scalar 15128    L(4)            4           scalar   COM              15178,15217,15219,15466,15480     
 PFRALT_SAVE                Local  15128    L(4)            4           scalar                    15178,15219                       
 PMAND                      Scalar 15138    R(4)            4     1     23       COM                                                
 PMSL                       Local  15440    R(4)            4           scalar                    15440,15516,15517,15524,15535,1563
                                                                                                  9,15650,15666,15674,15676,15756,15
                                                                                                  765,15773,15781,15822,15899,15950,
                                                                                                  16236,16240,16241                 
 PR                         Local  15161    R(4)            4           scalar                    15732,15833,15848,15950           
 PRESS                      Local  16175    R(4)            4           scalar                    16175,16214                       
 PRSS                       Scalar 15149    R(4)            4           scalar   COM                                                
 PSTN                       Local  15441    R(4)            4           scalar                    15441,15535,15557,15564,15640,1564
                                                                                                  2,15659,15703,15714,15723,15732,15
                                                                                                  773,15833,15848,15899,15950,16090,
                                                                                                  16175,16177                       
 PSTNFLG                    Common 15153                                4                                                           
 P_F_A                      Local  15166    R(4)            4           scalar                    15714                             
 Q                          Local  16214    R(4)            4           scalar                    16214,16216,16218,16226,16229     
 QFRMTP                     Local  15164    R(4)            4           scalar                    16214                             
 RDATA                      Scalar 15138    R(4)            4     1     3500     COM              15311,15312,15314,15380,15381,1538
                                                                                                  3,15418,15419,15420,15422,15423,15
                                                                                                  426,15432,15463,15468,15490,15495,
                                                                                                  15516,15519,15530,15551,15564,1556
                                                                                                  5,15567,15568,15569,15570,15579,15
                                                                                                  583,15584,15585,15586,15591,15601,
                                                                                                  15602,15605,15606,15616,15623,1563
                                                                                                  1,15639,15640,15646,15654,15662,15
                                                                                                  669,15681,15688,15695,15742,15751,
                                                                                                  15759,15813,15814,15815,15816,1585
                                                                                                  7,15871,15872,15875,15880,15929,15
                                                                                                  938,15968,15974,15981,15997,15999,
                                                                                                  16004,16006,16008,16022,16034,1603
                                                                                                  8,16079,16107,16109,16169         
 RDATA2                     Scalar 15151    R(4)            4     1     25       COM                                                
 REAL                       Func   15387                                scalar                    15387,15388                       
 RPTHDR                     Common 15140                                88                                                          
 RPTLBL                     Subr   15394                                                          15394                             
 RUNSW                      Common 15134                                4                                                           
 SFCBFR                     Common 15149                                8                                                           
 SFCDTA                     Subr   15118                                                                                            
 SFLAND                     Local  15128    L(4)            4           scalar                    15347,15352,15416,15466,15480,1557
                                                                                                  8,15613,15873,15886,15896,15925,15

Page 370         Source Listing                  SFCDTA
2017-04-18 11:09 Symbol Table                    prepdata.f

 Name                       Object Declared Type            Bytes Dimen Elements Attributes       References                        
                                                                                                                                    
                                                                                                  973,16016,16247                   
 SKPCNT                     Common 15145                                252                                                         
 SKPSUB                     Common 15150                                205824                                                      
 STNID                      Scalar 15126    CHAR            8           scalar   COM              15432,15490,15519,15530,15579,1558
                                                                                                  6,15591,15609,15616,15626,15634,15
                                                                                                  646,15654,15662,15669,15681,15688,
                                                                                                  15695,15719,15742,15751,15759,1580
                                                                                                  9,15810,15811,15812,15853,15857,15
                                                                                                  875,15880,15929,15938,15974,15984,
                                                                                                  15991,16034,16038,16079,16169     
 STRMOB                     Common 15136                                43200                                                       
 STRMSL                     Common 15135                                12                                                          
 SUBSET_D                   Scalar 15126    CHAR            8           scalar   COM              15187                             
 SUBSKP                     Scalar 15128    L(4)            4     2     51456    COM              15203,15204,15206,15207,15209,1521
                                                                                                  0,15256,15259,15261               
 TEMP                       Local  15442    R(4)            4           scalar                    15442,15567,15605,15616,15831,1584
                                                                                                  6,15948,16194,16196,16202,16208,16
                                                                                                  210,16217                         
 TIMCHK                     Subr   15401                                                          15401                             
 TIMWIN_E                   Local  15399    R(4)            4           scalar                    15399,15401                       
 TIMWIN_L                   Local  15400    R(4)            4           scalar                    15400,15401                       
 TMPCEL                     Local  16212    R(4)            4           scalar                    16212,16213                       
 TT                         Local  15830    R(4)            4           scalar                    15830,15831,15833,15845,15846,1584
                                                                                                  8,15947,15948,15950,16217,16218   
 UCOMP                      Local  15444    R(4)            4           scalar                    15444,15999,16022,16100,16102     
 UNITNO                     Common 15141                                116                                                         
 UNPREPBF                   Subr   15248                                                          15248                             
 UV                         Subr   15999                                                          15999                             
 VCOMP                      Local  15445    R(4)            4           scalar                    15445,15999,16022,16100,16104     
 W3FB04                     Subr   15383                                                          15383                             
 WLON                       Local  15381    R(4)            4           scalar                    15381,15382,15383                 
 WRMISS                     Scalar 15139    R(4)            4           scalar   COM                                                
 X                          Local  16218    R(4)            4           scalar                    16218,16219,16223                 
 XFMI                       Local  15378    R(4)            4           scalar                    15378,15383,15385,15387           
 XMISS                      Local  15157    R(4)            4           scalar                    15157,15293,15440,15441,15442,1544
                                                                                                  3,15444,15445,15454,15517,15642,15
                                                                                                  650,15659,15666,15674,15703,15723,
                                                                                                  15756,15765,15781,15831,15846,1594
                                                                                                  8,15968,15997,16022,16023,16194,16
                                                                                                  202,16236                         
 YFMJ                       Local  15379    R(4)            4           scalar                    15379,15383,15386,15387,15388     
 YMISS                      Local  15157    R(4)            4           scalar                    15157,15312,15705                 

Page 371         Source Listing                  SFCDTA
2017-04-18 11:09                                 prepdata.f

  15249       IF(IFLAG.EQ.1)  THEN
  15250 C.......................................................................
  15251 C IFLAG = 1 RETURNS DATA SET INFO (ONLY) AFTER FIRST CALL
  15252          PRINT 871
  15253   871 FORMAT(/40X,'+++  TIME WINDOW  (+/- HRS X 100) ON REPORTS  +++',/)
  15254          IF(NN.EQ.1)  THEN
  15255             NAME1 = 'SFC SYNP LAND (FIXED) (INCL WMO RES 40) .'
  15256             IF(.NOT.SUBSKP(000,000) .OR. .NOT.SUBSKP(000,001))
  15257      $       PRINT 873, NAME1,FWINDO(1)
  15258             NAME1 = 'SURFACE SYNOPTIC LAND (MOBILE) ..........'
  15259             IF(.NOT.SUBSKP(000,002))  PRINT 873, NAME1,FWINDO(11)
  15260             NAME1 = 'SURFACE METAR LAND ......................'
  15261             IF(.NOT.SUBSKP(000,007))  PRINT 873, NAME1,FWINDO(8)
  15262   873 FORMAT(42X,A41,F5.0)
  15263             PRINT'(1X)'
  15264          ELSE  IF(NN.EQ.4)  THEN
  15265             NAME1 = 'SPLASH-LEVEL REPORTS (MASS) .............'
  15266             PRINT 873, NAME1,FWINDO(5)
  15267             PRINT'(1X)'
  15268          ELSE  IF(NN.EQ.2)  THEN
  15269             PRINT 872, FWINDO(2),FWINDO(4),FWINDO(6),FWINDO(9),
  15270      $                 fwindo(12)
  15271   872 FORMAT(42X,'SURFACE SHIP ',28('.'),F5.0/42X,'BUOY ',36('.'),F5.0/
  15272      $ 42X,'C-MAN PLATFORM ',26('.'),F5.0/42X,'AUTOMATED TIDE GAUGE ',
  15273      $ 'STATIONS ',11('.'),F5.0/42X,'COAST GUARD TIDE GAUGE STATIONS ',
  15274      $ 9('.'),F5.0/)
  15275          ELSE  IF(NN.EQ.5)  THEN
  15276             PRINT 2872, FWINDO(3),FWINDO(7)
  15277  2872 FORMAT(42X,'OPC/NOS POINT SEA-LEVEL PRESSURE BOGUS ..',F5.0,
  15278      $  /,42X,'AUSTRALIAN (PAOBS) SEA-LVL PRESS. BOGUS..',F5.0/)
  15279          ELSE  IF(NN.EQ.3)  THEN
  15280             PRINT 3872, FWINDO(10)
  15281  3872 FORMAT(42X,'MESONET COOPERATIVE NETWORK .............',F5.0/)
  15282          END IF
  15283          GO TO 2100
  15284 C.......................................................................
  15285       END IF
  15286       KNTALL = KNTALL + 1
  15287 C 'ICALLM' INDICATES WHETHER MASS PIECE STORED IN OUTPUT FILE (IF SO =1)
  15288 C 'ICALLW' INDICATES WHETHER WIND PIECE STORED IN OUTPUT FILE (IF SO =1)
  15289       ICALLM = 0
  15290       ICALLW = 0
  15291       ITYP = -99999
  15292       ICF352 = 0
  15293       AMSLPR = XMISS
  15294 C  SAVE OBS2 AND OBS3 VARIABLES SINCE THESE ARE NORMALLY ONLY ENCODED
  15295 C   WITH MASS REPORT {OBS2(1-3) - RSRD, EXPRSRD, ALSE NOT SAVED SINCE
  15296 C   THESE ARE ENCODED WITH BOTH MASS AND WIND REPORTS}
  15297       OBS2_SAVE(4:NUMOBS2) = OBS2(4:NUMOBS2)
  15298       OBS3_SAVE = OBS3
  15299       NOBS3_SAVE = NOBS3
  15300       IF(NN.EQ.4)  THEN
  15301 C EXAMINE REPORTS IN "ADPUPA" FILE ...
  15302          IF(IDATA(9).NE.31)  THEN
  15303 C  ... SIPHON OFF ANY NON-RECCO OR NON-DROPS
  15304             GO TO 2100
  15305          ELSE

Page 372         Source Listing                  SFCDTA
2017-04-18 11:09                                 prepdata.f

  15306 C  ... CHECK FOR RECCOS WITH PMSL OBS - VALID SPLASH-LVL REPORTS
  15307             IF(IDATA(27).GT.0)  THEN
  15308                L8 = IDATA(28) - 4
  15309                DO I = 1,IDATA(27)
  15310                   L8 = L8 + 4
  15311                   IF(NINT(RDATA(L8+1)).EQ.352)  THEN
  15312                      IF(RDATA(L8).LT.YMISS)  THEN
  15313                         ICF352 = 1
  15314                         AMSLPR = RDATA(L8)
  15315                         ITYP = 5
  15316                      END IF
  15317                   END IF
  15318                ENDDO
  15319             END IF
  15320          END IF
  15321       END IF
  15322       IF(ITYP.EQ.-99999)  ITYP = ISSEL(IDATA(9))
  15323 
  15324 C THE TYPE OF REPORT JUST UNPACKED IS INDICATED BY 'ITYP'
  15325 C   ITYP =  1 ===> SURFACE SYNOPTIC LAND STATION (FIXED)
  15326 C                  (INCLUDING WMO RESOLUTION 40)
  15327 C   ITYP =  2 ===> SHIP (FIXED AND MOVING)
  15328 C   ITYP =  3 ===> OPC/NOS POINT MEAN SEA-LEVEL PRESSURE BOGUS
  15329 C   ITYP =  4 ===> BUOY (FIXED AND DRIFTING))
  15330 C   ITYP =  5 ===> SPLASH-LEVEL MASS FROM DROPS/RECCO WITH PMSL OBS
  15331 C   ITYP =  6 ===> C-MAN PLATFORM
  15332 C   ITYP =  7 ===> AUSTRALIAN SEA-LEVEL PRESSURE BOGUS - PAOBS
  15333 C   ITYP =  8 ===> SURFACE METAR LAND
  15334 C   ITYP =  9 ===> AUTOMATED TIDE GAUGE STATION
  15335 C   ITYP = 10 ===> MESONET SURFACE (COOPERATIVE NETWORKS)
  15336 C   ITYP = 11 ===> SURFACE SYNOPTIC LAND STATION (MOBILE)
  15337 C   ITYP = 12 ===> COAST GUARD TIDE GAUGE STATION
  15338 C   ITYP = 13-19 > RESERVED FOR FUTURE TYPES
  15339 C   ITYP = 20 ===> RECCO/DROPWINSONDE WITH NO SPLASH-LEVEL MASS
  15340 C                  INFORMATION (INVALID TYPE)
  15341 C   ITYP = 30 ===> "OTHER" (INVALID TYPE)
  15342 
  15343       IFLSF = 0
  15344       IFLTH = 0
  15345       ATLAS = .FALSE.
  15346                                          ! Consider Mesonet as land here
  15347       SFLAND = (ITYP.EQ.1.OR.ITYP.EQ.8.OR.ITYP.EQ.10.OR.ITYP.EQ.11)
  15348       MSLBOG = (ITYP.EQ.3.OR.ITYP.EQ.7)
  15349 C FOR NON-BOGUS RPTS, 'INSTR' WILL SPECIFICALLY IDENTIFY THE LAST DIGIT
  15350 C  OF THE SFC R. TYPE - DEFAULT IS 0 ==> OCEANIC WITH VALID PSTN
  15351       INSTR = 0
  15352       IF(SFLAND)  INSTR = 1
  15353       IF(ITYP.EQ.5)  THEN
  15354          INSTR = 2
  15355       ELSE  IF(ITYP.EQ.10)  THEN
  15356          INSTR = 8
  15357       ELSE  IF(ITYP.GT.19)  THEN
  15358 C SKIP ALL INVALID SURFACE TYPES (WITH NO COUNT)
  15359 CCCCC    IF(ITYP.EQ.20)  PRINT 8755, STNID,RDATA(1),RDATA(2),IDATA(9)
  15360 C8755 FORMAT(' * * TOTAL REPORT TOSSED  -ID=',A8,', LAT=',F7.2,'N, ',
  15361 CCCCC$ 'LON=',F8.2,'E, RTYP',I4,' - RECCO/DROP, NOT SPLASH-LEVEL MASS')
  15362 CCCCC    IF(ITYP.EQ.30)  PRINT 8757, STNID,RDATA(1),RDATA(2),IDATA(9)

Page 373         Source Listing                  SFCDTA
2017-04-18 11:09                                 prepdata.f

  15363 C8757 FORMAT(' * * TOTAL REPORT TOSSED  -ID=',A8,', LAT=',F7.2,'N, ',
  15364 CCCCC$ 'LON=',F8.2,'E, RTYP',I4,' - NOT A VALID SURFACE REPORT')
  15365          GO TO 2100
  15366       END IF
  15367 C-----------------------------------------------------------------------
  15368 C BEGIN A SERIES OF CHECKS ON THE UNPACKED REPORT -- IF ANY ONE OF THEM
  15369 C               FAILS, THE REPORT WILL BE SKIPPED
  15370 C-----------------------------------------------------------------------
  15371 C CALL CHKREP TO CHECK FOR MSG LAT/LON & FOR REPORT OUTSIDE SEARCH AREA
  15372       CALL CHKREP(KMSGSF,KBDYSF,*2090)
  15373 C TEST FOR DATA THINNING OUTSIDE LFM GRID (BASED ON LFMAXI VALUE);
  15374 C  THINNING APPLIED LATER
  15375       LFM = .TRUE.
  15376       IF(LFMAXI.GT.0.AND.LFMAXJ.GT.0)  THEN
  15377 C DATA THINNING TURNED ON - LFM=T IF REPORT W/I LFM GRID (OTHERWISE = F)
  15378          XFMI = 0
  15379          YFMJ = 0
  15380          IF(ABS(NINT(RDATA(1)*100.)).LE.8999)  THEN
  15381             WLON = 360. - RDATA(2)
  15382             IF(NINT(WLON*100.).EQ.36000)  WLON = 0.
  15383             CALL W3FB04(RDATA(1),WLON,FMESHL,FLONVT,XFMI,YFMJ)
  15384          END IF
  15385          XFMI = XFMI + FPOLEI
  15386          YFMJ = YFMJ + FPOLEJ
  15387          LFM = (XFMI.GE.1.0.AND.XFMI.LE.REAL(LFMAXI).AND.YFMJ.GE.1.0
  15388      $    .AND.YFMJ.LE.REAL(LFMAXJ))
  15389       END IF
  15390 C-----------------------------------------------------------------------
  15391 C CALL SUBR. 'RPTLBL' TO STORE REPORT HEADER INTO HDR(4),HDR(5),HDR(7),
  15392 C                          HDR(9)-HDR(15), ALAT_8, ALON_8
  15393 C-----------------------------------------------------------------------
  15394       CALL RPTLBL(CYCLET)
  15395 C-----------------------------------------------------------------------
  15396 C        CALL SUBR. 'TIMCHK' TO CHECK IF REPORT IS W/I PROPER
  15397 C              TIME WINDOW OF CYCLE TIME (IER =1 TOSS RPT)
  15398 C-----------------------------------------------------------------------
  15399       TIMWIN_e = -FWINDO(ITYP) * .01
  15400       TIMWIN_l =  FWINDO(ITYP) * .01
  15401       CALL TIMCHK(HDR(4),TIMWIN_e,TIMWIN_l,IER)
  15402       IF(IER.EQ.1)  THEN
  15403          KTIMSF = KTIMSF + 1
  15404          GO TO 2090
  15405       END IF
  15406 C TEST FOR OVERLAND MARINE REPORTS
  15407       IF(MARLND)  GO TO 1490
  15408 C-----------------------------------------------------------------------
  15409 C TEST FOR ALL SURFACE MARINE TYPES EXCEPT C-MAN, AUTOMATED TIDE
  15410 C           GAUGE STNS, AND COAST GUARD TIDE GAUGE STNS
  15411 C                       FOR OVER LAND CRITERIA
  15412 C              IF MET SUCH RPTS ARE GIVEN PREPBUFR T.V.=15
  15413 C-----------------------------------------------------------------------
  15414 C EXCLUDE SFC LAND (+ MESONET), C-MAN, AUTOMATED TIDE GAUGE AND COAST
  15415 C  GUARD TIDE GAUGE STNS FROM TEST
  15416       IF(SFLAND.OR.ITYP.EQ.6.OR.ITYP.EQ.9.OR.ityp.EQ.12)  GO TO 1490
  15417 C EXCLUDE PMSL BOGUS REPORTS OVER GREENLAND FROM TEST
  15418       IF(MSLBOG.AND.NINT(RDATA(1)*100.).GE.6000.AND.
  15419      $ NINT(RDATA(1)*100.).LE.8500.AND.NINT(RDATA(2)*100.).GE.30000.AND.

Page 374         Source Listing                  SFCDTA
2017-04-18 11:09                                 prepdata.f

  15420      $ NINT(RDATA(2)*100.).LE.34000)  GO TO 1490
  15421 C OTHERWISE, CALL SUBR. LNDCHK, SEE IF RPT SATISFIES OVER LAND CRITERIA
  15422       IF(NINT(RDATA(1)*100.).LT.0)  THEN
  15423          CALL LNDCHK(RDATA(1),RDATA(2),1,4,1,GDSH,145,37,0.5,ILAND)
  15424       ELSE
  15425 ccccc    CALL LNDCHK(RDATA(1),RDATA(2),1, 4,1,GDNH,362,91,0.5,ILAND)
  15426          CALL LNDCHK(RDATA(1),RDATA(2),1,16,1,GDNH,362,91,0.5,ILAND)
  15427       END IF
  15428       IF(ILAND.EQ.0)  GO TO 1490
  15429 C REPORT SATISFIES OVER LAND CRITERIA PROCESS BUT FLAG ALL VARIABLES W/
  15430 C  PREPBUFR T.V. OF 15
  15431       IF((.NOT.MSLBOG.OR.(MSLBOG.AND.JSURFM(ITYP).NE.9999)).AND.IPRINT
  15432      $ .EQ.0)  PRINT 929, STNID,RDATA(1),RDATA(2),IDATA(9)
  15433   929 FORMAT(' + + TOTAL REPORT FLAGGED -ID=',A8,', LAT=',F7.2,'N, ',
  15434      $ 'LON=',F8.2,'E, RTYP',I4,' - OVER LAND MARINE REPORT')
  15435       IF(IFLSF.EQ.0)  KSKOMR(2) = KSKOMR(2) + 1
  15436       IFLSF = 1
  15437 C-----------------------------------------------------------------------
  15438  1490 CONTINUE
  15439 C FOR EVERY UNPACKED REPORT, INITIALIZE ALL STATE VARIABLES AS MISSING
  15440       PMSL = XMISS
  15441       PSTN = XMISS
  15442       TEMP = XMISS
  15443       DPDP = XMISS
  15444       UCOMP= XMISS
  15445       VCOMP= XMISS
  15446 C FOR ALL REPORTS, INITIALIZE ALL PREPBUFR TABLE VALUES = 15
  15447       IM0 = 15
  15448       IMP = 15
  15449       IMT = 15
  15450       IMQ = 15
  15451       IMW = 15
  15452       IMZ = 15
  15453       IMA = 15
  15454       ALTIMR = XMISS
  15455       IME = IMISS
  15456       IFOUND_20 = 0
  15457       IF(ITYP.EQ.10.OR.ITYP.EQ.8)  THEN
  15458 C MESONETS AND METARS STORE ALTIMETER TABLE VALUE IN CAT. 8, C.F. 20
  15459          IF(IDATA(27).GT.0)  THEN
  15460             L8 = IDATA(28) - 4
  15461             DO I = 1,IDATA(27)
  15462                L8 = L8 + 4
  15463                IF(NINT(RDATA(L8+1)).EQ.20)  THEN
  15464                   IFOUND_20 = 1
  15465                   IF(OBS2(3).LT.BMISS)  THEN
  15466                      IF(PFRALT.AND.SFLAND) THEN
  15467                         IMA = 2
  15468                         IF(NINT(RDATA(L8)).LT.16)  IMA = NINT(RDATA(L8))
  15469                      END IF
  15470                      GO TO 779
  15471                   END IF
  15472                   GO TO 779
  15473                END IF
  15474             ENDDO
  15475          END IF
  15476       END IF

Page 375         Source Listing                  SFCDTA
2017-04-18 11:09                                 prepdata.f

  15477   779 CONTINUE
  15478 C CHECK FOR VALID ALTIMETER SETTING IN OBS2(3), MAY STORE/USE IT LATER
  15479       IF(OBS2(3).LT.BMISS)  THEN
  15480          IF(PFRALT.AND.SFLAND) THEN
  15481             ALTIMR = NINT(OBS2(3)*0.1)
  15482                 ! Altimeter table value hardwired to 2 for non-mesonets,
  15483                 !  non-METARs, and METARs which did not have an altim.
  15484                 !  table value in cat,. 8, code figure 20
  15485             IF(ITYP.NE.10.AND.(ITYP.NE.8.OR.IFOUND_20.EQ.0))  IMA = 2
  15486          END IF
  15487       END IF
  15488       IF(IDATA(29).EQ.0.AND.ITYP.NE.5)  THEN
  15489 C ALL SURFACE TYPES EXCEPT SPLASH-LVL RPTS ARE EXPECTED TO BE IN CAT. 51
  15490          PRINT 8759, STNID,RDATA(1),RDATA(2),IDATA(9)
  15491  8759 FORMAT(' * * TOTAL REPORT TOSSED  -ID=',A8,', LAT=',F7.2,'N, ',
  15492      $ 'LON=',F8.2,'E, RTYP',I4,' - NO VALID DATA IN SFCDTA')
  15493          GO TO 2090
  15494       END IF
  15495       ELEV = NINT(RDATA(7))
  15496       IF(MSLBOG)  THEN
  15497 C***********************************************************************
  15498 C                MEAN SEA-LEVEL PRESSURE BOGUS REPORT
  15499 C            AUSTRALIAN (PAOBS) BOGUS IN DATA LEVEL CAT. 51
  15500 C               OPC/NOS POINT BOGUS IN DATA LEVEL CAT. 51
  15501 C***********************************************************************
  15502          IF(ITYP.EQ.7)  THEN
  15503 C PAOBS GET PREPBUFR REPORT TYPE 191
  15504             HDR(6) = 191
  15505 C SET PREPBUFR TABLE VALUES FOR BOTH PMSL AND PSTN TO 1 FOR PAOBS BOGUS
  15506             IM0 = 1
  15507             IMP = 1
  15508          ELSE
  15509 C POINT BOGUS GET PREPBUFR REPORT TYPE 190
  15510             HDR(6) = 190
  15511 C SET PREPBUFR TABLE VALUES FOR BOTH PMSL AND PSTN TO 0 FOR POINT BOGUS
  15512             IM0 = 0
  15513             IMP = 0
  15514          END IF
  15515          L = IDATA(30)
  15516          PMSL = NINT(RDATA(L))
  15517          IF(PMSL.GE.XMISS)  THEN
  15518 cfix?    IF(PMSL.GE.YMISS)  THEN
  15519             PRINT 8779, STNID,RDATA(1),RDATA(2),IDATA(9)
  15520  8779 FORMAT(' * * TOTAL REPORT TOSSED  -ID=',A8,', LAT=',F7.2,'N, ',
  15521      $ 'LON=',F8.2,'E, RTYP',I4,' - PMSL IS MISSING')
  15522             GO TO 2090
  15523          END IF
  15524          DPVL = (PMSL * 0.1) - 1013.25
  15525 C IF PMSL UNREASONABLE, FLAG PSTN AND PMSL PREPBUFR TABLE VALUE
  15526          IF(DPVL.LE.-75..OR.DPVL.GE.50.)  THEN
  15527           ! this should not be monitored by GSI!! (but is since qm=15)
  15528             IM0 = 15
  15529             IMP = 15
  15530             PRINT 1919, STNID,RDATA(1),RDATA(2),IDATA(9),DPVL,ELEV
  15531  1919 FORMAT(' + + PMSL BOGUS RPT FLAGGD-ID=',A8,', LAT=',F7.2,'N, ',
  15532      $ 'LON=',F8.2,'E, RTYP',I4,' - PMSL DVAL(',F7.1,') BAD, ELEV =',
  15533      $ F7.1)

Page 376         Source Listing                  SFCDTA
2017-04-18 11:09                                 prepdata.f

  15534          END IF
  15535          PSTN = PMSL
  15536          GO TO 2150
  15537       END IF
  15538 C***********************************************************************
  15539 C               ALL OTHER NON-BOGUS SURFACE REPORTS
  15540 C
  15541 C   ALL INPUT DATA ARE IN DATA LEVEL CAT.  51 EXCEPT FOR SPLASH-LEVEL
  15542 C  REPORTS WHICH ARE IN EITHER DATA LEVEL CAT. 8 (RECCOS WITH PMSL OBS)
  15543 C           OR DATA LEVEL CAT. 2 (DROPS) OF THE ADPUPA FILE
  15544 C***********************************************************************
  15545       L = IDATA(30)
  15546 C-----------------------------------------------------------------------
  15547 C              SPECIAL TESTS FOR SURFACE MASS REPORTS
  15548 C-----------------------------------------------------------------------
  15549 C CHECK ELEVATION -- THIS IS THE GEOPOTENTIAL OBSERVATION (NOTE: AN
  15550 C  ELEVATION > 10000 OR MISSING CAN NEVER GET THROUGH HERE!!)
  15551       ELEV = NINT(RDATA(7))  ! was this already set further above??
  15552       IF(ITYP.EQ.5)  THEN
  15553 C.......................................................................
  15554 C SPLASH-LEVEL REPORTS COME HERE ...
  15555          IF(ICF352.EQ.1)  THEN
  15556 C  ... THESE ARE THE RECCOS WITH PMSL OBS
  15557             PSTN = AMSLPR
  15558             IMP  = 2
  15559 C      MUST SET ELEVATION TO 0 BECAUSE RDATA(7) HOLDS P-ALTITUDE
  15560             ELEV = 0.
  15561          ELSE
  15562 C  ... THESE ARE THE DROPWINSONDES (HAVE NON-MISSING PSML & CAT. 2 DATA)
  15563             IMM = IDATA(16)
  15564             PSTN = NINT(RDATA(IMM))
  15565             IMP  = NINT(RDATA(IMM+3))
  15566             IF(IMP.LE.3)  THEN
  15567                TEMP = NINT(RDATA(IMM+1))
  15568                DPDP = NINT(RDATA(IMM+2))
  15569                IMT = NINT(RDATA(IMM+4))
  15570                IMQ = NINT(RDATA(IMM+5))
  15571             END IF
  15572          END IF
  15573       END IF
  15574 C.......................................................................
  15575       IF(ELEV.GT.10000.)  THEN
  15576 C WILL TOSS LAND OR GREAT LAKES REPORTS W/ MISSING OR STRANGE ELEVATION
  15577 C  BUT ALL OTHER MARINE REPORTS GET ELEVATION SET TO 0 IN THIS CASE
  15578          IF(SFLAND)  THEN
  15579             PRINT 954, STNID,RDATA(1),RDATA(2),IDATA(9)
  15580   954 FORMAT(' * * TOTAL REPORT TOSSED  -ID=',A8,', LAT=',F7.2,'N, ',
  15581      $ 'LON=',F8.2,'E, RTYP',I4,' - OVER LAND, MISSING ELEVATION ')
  15582             GO TO 2090
  15583          ELSE  IF(NINT(RDATA(1)*100.).GE.4100.AND.NINT(RDATA(1)*100.)
  15584      $    .LE.5000.AND.NINT(RDATA(2)*100.).GE.26700.AND.
  15585      $    NINT(RDATA(2)*100.).LE.28500)  THEN
  15586             PRINT 3954, STNID,RDATA(1),RDATA(2),IDATA(9)
  15587  3954 FORMAT(' * * TOTAL REPORT TOSSED  -ID=',A8,', LAT=',F7.2,'N, ',
  15588      $ 'LON=',F8.2,'E, RTYP',I4,' - OVER GREAT LAKES, MISSING ELEV')
  15589             GO TO 2090
  15590          ELSE

Page 377         Source Listing                  SFCDTA
2017-04-18 11:09                                 prepdata.f

  15591             PRINT 959, STNID,RDATA(1),RDATA(2),IDATA(9)
  15592   959 FORMAT(' > > MARINE ELEV. MISSING -ID=',A8,', LAT=',F7.2,'N, ',
  15593      $ 'LON=',F8.2,'E, RTYP',I4,' - ELEVATION SET TO 0.0 M')
  15594             ELEV = 0.0
  15595             HDR(10) = ELEV
  15596          END IF
  15597       END IF
  15598 C MOBILE SYNOPTIC LAND REPORTS CAN HAVE AN ELEVATION Q.M. (BUFR C. FIG.)
  15599 C  (IF IT'S POOR, SET PRESS Q.M. TO BAD; IF IT'S FAIR SET PRESS Q.M. TO
  15600 C   SUSPECT)
  15601       IF(NINT(RDATA(12)).GT.0.AND.NINT(RDATA(12)).LT.9)
  15602      $ IME = NINT(RDATA(12))
  15603       IF(ITYP.EQ.5)  GO TO 7005
  15604 C CHECK TEMP WILL NEED LATER TO HYDROSTATICALLY ADJUST LAND REPORTS
  15605       TEMP = NINT(RDATA(L+4))
  15606       IMT = NINT(RDATA(L+11))
  15607       IF(IMT.EQ.4)  THEN
  15608          IMT = 1
  15609          PRINT 1101, STNID,IDATA(9)
  15610  1101 FORMAT(' > > MARINE TEMP  - STNID = ',A8,'  TYPE = ',I4,' - ',
  15611      $ 'CORRECTED BY O.P.C. MANUAL Q. CONTROL, TEMP PREPBUFR TBL VAL=1',
  15612      $ ', ORIG Q.M. = 4')
  15613       ELSE  IF(SFLAND.AND.IMT.GE.IQMLIM)  THEN
  15614 C IF LAND REPORT AND TEMP IS BAD, SKIP THE ENTIRE REPORT (MASS AND WIND)
  15615 C  (CAN THIS EVER HAPPEN?)
  15616          PRINT 112, STNID,RDATA(1),RDATA(2),IDATA(9),TEMP,IMT
  15617   112 FORMAT(' * * TOTAL REPORT TOSSED  -ID=',A8,', LAT=',F7.2,'N, ',
  15618      $ 'LON=',F8.2,'E, RTYP',I4,' - BAD TEMP,',F7.2,'K PREPBUFR TABLE ',
  15619      $ 'VALUE = ',I2)
  15620          GO TO 2090
  15621       END IF
  15622 C GET PMSL AND PSTN PREPBUFR TABLE VALUES
  15623       IM0 = NINT(RDATA(L+8))
  15624       IF(IM0.EQ.4)  THEN
  15625          IM0 = 1
  15626          PRINT 1102, STNID,IDATA(9)
  15627  1102 FORMAT(' > > MARINE PMSL  - STNID = ',A8,'  TYPE = ',I4,' - ',
  15628      $ 'CORRECTED BY O.P.C. MANUAL Q. CONTROL, PMSL PREPBUFR TBL VAL=1',
  15629      $ ', ORIG Q.M. = 4')
  15630       END IF
  15631       IMP = NINT(RDATA(L+9))
  15632       IF(IMP.EQ.4)  THEN
  15633          IMP = 1
  15634          PRINT 1103, STNID,IDATA(9)
  15635  1103 FORMAT(' > > MARINE PSTN  - STNID = ',A8,'  TYPE = ',I4,' - ',
  15636      $ 'CORRECTED BY O.P.C. MANUAL Q. CONTROL, PSTN PREPBUFR TBL VAL=1',
  15637      $ ', ORIG Q.M. = 4')
  15638       END IF
  15639       PMSL = NINT(RDATA(L))
  15640       PSTN = NINT(RDATA(L+1))
  15641       IF(IME.EQ.4.OR.IME.EQ.8)  THEN
  15642          IF(PSTN.LT.XMISS)  THEN
  15643 cfix?    IF(PSTN.LT.YMISS)  THEN
  15644           ! this should not be monitored by GSI!! (but is since qm=15)
  15645             IMP = 15
  15646             PRINT 1969, STNID,RDATA(1),RDATA(2),IDATA(9),IME
  15647  1969 FORMAT(' + + REPORT PSTN FLAGGED  -ID=',A8,', LAT=',F7.2,'N, ',

Page 378         Source Listing                  SFCDTA
2017-04-18 11:09                                 prepdata.f

  15648      $ 'LON=',F8.2,'E, RTYP',I4,' - BUFR ELEV QM(',I2,') POOR')
  15649          END IF
  15650          IF(PMSL.LT.XMISS)  THEN
  15651 cfix?    IF(PMSL.LT.YMISS)  THEN
  15652           ! this should not be monitored by GSI!! (but is since qm=15)
  15653             IM0 = 15
  15654             PRINT 1968, STNID,RDATA(1),RDATA(2),IDATA(9),IME
  15655  1968 FORMAT(' + + REPORT PMSL FLAGGED  -ID=',A8,', LAT=',F7.2,'N, ',
  15656      $ 'LON=',F8.2,'E, RTYP',I4,' - BUFR ELEV QM(',I2,') POOR')
  15657          END IF
  15658       ELSE IF(IME.EQ.3.OR.IME.EQ.7)  THEN
  15659          IF(PSTN.LT.XMISS)  THEN
  15660 cfix?    IF(PSTN.LT.YMISS)  THEN
  15661             IMP =  3
  15662             PRINT 1971, STNID,RDATA(1),RDATA(2),IDATA(9),IME
  15663  1971 FORMAT(' + + REPORT PSTN SUSPECT  -ID=',A8,', LAT=',F7.2,'N, ',
  15664      $ 'LON=',F8.2,'E, RTYP',I4,' - BUFR ELEV QM(',I2,') FAIR')
  15665          END IF
  15666          IF(PMSL.LT.XMISS)  THEN
  15667 cfix?    IF(PMSL.LT.YMISS)  THEN
  15668             IM0 =  3
  15669             PRINT 1970, STNID,RDATA(1),RDATA(2),IDATA(9),IME
  15670  1970 FORMAT(' + + REPORT PMSL SUSPECT  -ID=',A8,', LAT=',F7.2,'N, ',
  15671      $ 'LON=',F8.2,'E, RTYP',I4,' - BUFR ELEV QM(',I2,') FAIR')
  15672          END IF
  15673       END IF
  15674       IF(PMSL.LT.XMISS)  THEN
  15675 cfix? IF(PMSL.LT.YMISS)  THEN
  15676          DPVL = (PMSL * 0.1) - 1013.25
  15677 C IF NON-MISSING PMSL UNREASONABLE, FLAG ITS PREPBUFR TBL VAL.
  15678          IF(DPVL.LE.-75..OR.DPVL.GE.50.)  THEN
  15679           ! this should not be monitored by GSI!! (but is since qm=15)
  15680             IM0 = 15
  15681             PRINT 1918, STNID,RDATA(1),RDATA(2),IDATA(9),DPVL,ELEV
  15682  1918 FORMAT(' + + REPORT PMSL FLAGGED  -ID=',A8,', LAT=',F7.2,'N, ',
  15683      $ 'LON=',F8.2,'E, RTYP',I4,' - PMSL DVAL(',F7.1,') BAD, ELEV =',
  15684      $ F7.1)
  15685          END IF
  15686 C TOSS REPORT IF PRESSURE IS MISSING (CAN THIS EVER HAPPEN?)
  15687          IF(IM0.GE.IQMLIM)  THEN
  15688             PRINT 111, STNID,RDATA(1),RDATA(2),IDATA(9),IM0
  15689   111 FORMAT(' * * TOTAL REPORT TOSSED  -ID=',A8,', LAT=',F7.2,'N, ',
  15690      $ 'LON=',F8.2,'E, RTYP',I4,' - BAD PMSL Q. MARK = ',I2.2)
  15691             GO TO 2090
  15692          END IF
  15693          IF(IM0.GT.3)  THEN
  15694 C FLAG THE PSTN PREPBUFR T.V. WITH 15 WHEN PMSL IS BAD
  15695             PRINT 2918, STNID,RDATA(1),RDATA(2),IDATA(9),ELEV
  15696  2918 FORMAT(' + + REPORT PSTN FLAGGED  -ID=',A8,', LAT=',F7.2,'N, ',
  15697      $ 'LON=',F8.2,'E, RTYP',I4,' - PMSL IS BAD, ELEV =',F7.1)
  15698           ! this should not be monitored by GSI!! (but is since qm=15)
  15699             IMP = 15
  15700          END IF
  15701       END IF
  15702  7005 CONTINUE
  15703       IF(PSTN.GE.XMISS)  THEN
  15704 cfix? IF(PSTN.GE.YMISS)  THEN

Page 379         Source Listing                  SFCDTA
2017-04-18 11:09                                 prepdata.f

  15705          IF(ALTIMR.LT.YMISS.AND.ALTIMR.GT.0)  THEN
  15706 C+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
  15707 C   REPORTS WITH MISSING PSTN BUT VALID ALTIMETER SETTING COME HERE
  15708 C+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
  15709 C IF OVER LAND AND PFRALT=T, CALCULATE PSTN FROM ALTIMETER AND ELEV
  15710 C  (THESE WILL GET PREPBUFR REPORT TYPE 187/287 UNLESS MESONETS WHICH
  15711 C  STILL GET 188/288 BUT ALSO GET AN 'a' STAMPED IN CHARACTER 8 OF
  15712 C  STNID) - THESE REPORTS NOW CONSIDERED TO HAVE A VALID PSTN; ALSO
  15713 C  SET PSTN TABLE VALUE TO THAT OF ALTIMETER
  15714             PSTN = P_f_A(ALTIMR*0.1,ELEV) * 10.
  15715             IMP = IMA
  15716             IF(ITYP.NE.10)  THEN
  15717                INSTR = 7
  15718             ELSE
  15719                STNID(8:8) = 'a'
  15720             END IF
  15721          END IF
  15722       END IF
  15723       IF(PSTN.LT.XMISS)  THEN
  15724 cfix? IF(PSTN.LT.YMISS)  THEN
  15725 C+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
  15726 C
  15727 C                   REPORTS WITH VALID PSTN COME HERE
  15728 C
  15729 C+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
  15730          IF(IMP.LT.10)  THEN
  15731 C USE VALID ELEVATION & U.S. STD. ATMOS. TO TEST PSTN VALUE
  15732             DVAL = (PSTN * 0.1) - PR(1013.25,288.15,ELEV)
  15733 C IF NON-MSG, NON-BAD PSTN UNREASONABLE, FLAG ITS PREPBUFR TBL VALUE;
  15734 C  (SPLASH-LVL REPORTS ARE GIVEN A LARGER ALLOWABLE MIN. PSTN IN ORDER
  15735 C  TO ACCOUNT FOR VERY LOW PRESS. IN HURRICANE SITUATIONS - SUBSEQ.
  15736 C  OIQC PROGRAM SHOULD FLAG IF DATA BAD)
  15737             DVALMN = -75.
  15738             IF(ITYP.EQ.5)  DVALMN = -215.
  15739             IF(DVAL.LE.DVALMN.OR.DVAL.GE.50.)  THEN
  15740           ! this should not be monitored by GSI!! (but is since qm=15)
  15741                IMP = 15
  15742                PRINT 1115, STNID,RDATA(1),RDATA(2),HDR(13),IDATA(9),
  15743      $          DVAL,ELEV
  15744  1115 FORMAT(' + + REPORT PSTN FLAGGED  -ID=',A8,', LAT=',F7.2,'N, ',
  15745      $ 'LON=',F8.2,'E, TIME',F11.5,'UTC, RTYP',I4,' - PSTN DVAL(',F7.1,
  15746      $ ') BAD, ELV=',F7.1)
  15747             END IF
  15748          END IF
  15749 C TOSS REPORT IF PRESSURE IS MISSING (CAN THIS EVER HAPPEN?)
  15750          IF(IMP.GE.IQMLIM)  THEN
  15751             PRINT 169, STNID,RDATA(1),RDATA(2),IDATA(9),IMP
  15752   169 FORMAT(' * * TOTAL REPORT TOSSED  -ID=',A8,', LAT=',F7.2,'N, ',
  15753      $ 'LON=',F8.2,'E, RTYP',I4,' - BAD PSTN Q. MARK = ',I2.2)
  15754             GO TO 2090
  15755          END IF
  15756          IF(IMP.GT.3.AND.PMSL.LT.XMISS)  THEN
  15757 cfix?    IF(IMP.GT.3.AND.PMSL.LT.YMISS)  THEN
  15758 C FLAG THE NON-MSG PMSL PREPBUFR T.V. WITH 15 WHEN PSTN IS BAD
  15759             PRINT 2115, STNID,RDATA(1),RDATA(2),IDATA(9),ELEV
  15760  2115 FORMAT(' + + REPORT PMSL FLAGGED  -ID=',A8,', LAT=',F7.2,'N, ',
  15761      $ 'LON=',F8.2,'E, RTYP',I4,'; PSTN IS BAD, ELEV =',F7.1)

Page 380         Source Listing                  SFCDTA
2017-04-18 11:09                                 prepdata.f

  15762           ! this should not be monitored by GSI!! (but is since qm=15)
  15763             IM0 = 15
  15764          END IF
  15765          IF(ITYP.NE.10.AND.PMSL.GE.XMISS.AND.ELEV.LE.7.5)  THEN
  15766 cfix?    IF(ITYP.NE.10.AND.PMSL.GE.YMISS.AND.ELEV.LE.7.5)  THEN
  15767 C.......................................................................
  15768 C     REPORTS WITH VALID PSTN BUT PMSL MISSING -- SET PMSL = PSTN IF
  15769 C               ELEVATION < 7.5 M (OTHERWISE KEEP MISSING)
  15770 C                  (DOES NOT APPLY TO MESONET REPORTS)
  15771 C.......................................................................
  15772             IM0 = MAX(2,IMP)
  15773             PMSL = PSTN
  15774          END IF
  15775       ELSE
  15776 C+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
  15777 C
  15778 C                  REPORTS WITH MISSING PSTN COME HERE
  15779 C
  15780 C+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
  15781          IF(PMSL.LT.XMISS)  GO TO 1762
  15782 cfix?    IF(PMSL.LT.YMISS)  GO TO 1762
  15783 C.......................................................................
  15784 C               REPORTS WITH MISSING PSTN AND MISSING PMSL
  15785 C.......................................................................
  15786 C DETERMINE IF REPORT IS AN ATLAS (PMEL) BUOY
  15787 C  IMPORTANT: FOR RAP (AND BEFORE THAT RUC2A) VERSION, ALL BUOYS
  15788 C             (MOORED OR DRIFTING) WITH MISSING PRESSURE BUT VALID WIND
  15789 C             DATA ARE PROCESSED AS IF THEY WERE ATLAS BUOYS (I.E.,
  15790 C             WILL BE PROCESSED W/ PREPBUFR REPORT TYPE 282, ETC.) -
  15791 C             ALL REFERENCES TO "ATLAS" BUOYS FROM HERE ON REFER TO
  15792 C             THESE BUOYS IN THE RAP (AND BEFORE THAT RUC2A) VERSION
  15793 C  Also important: ATLAS buoy processing is not affected by value of
  15794 C                  npkrpt.  Even if npkrpt=T, only a wind piece will be
  15795 C                  processed (as report type 282). This means that if
  15796 C                  an ATLAS buoy ever had T,q info, its mass piece
  15797 C                  would still be tossed rather than getting into
  15798 C                  PREPBUFR file under report type 194.  It is believed
  15799 C                  that most TRUE ATLAS buoys do not have T,q info, but
  15800 C                  that is not for certain.  However, note from point
  15801 C                  above that the RAP treats all buoys w/ missing pmsl
  15802 C                  & pstn as if they were ATLAS, so it could
  15803 C                  potentially lose a number of 194-type mass reports
  15804 C                  here.  LOOK INTO UPGRADING THIS LOGIC-??
  15805 
  15806          ATLAS = (IRNMRK.EQ.4.AND.ITYP.EQ.4)
  15807          IF(.NOT.ATLAS)  THEN
  15808             IF(IDATA(9).EQ.IATLAS) THEN
  15809                ATLAS = ((STNID(1:2).EQ.'32'.OR.STNID(1:2).EQ.'51'.OR.
  15810      $                   STNID(1:2).EQ.'52'.OR.STNID(1:5).EQ.'43001'.OR.
  15811      $                   STNID(1:5).EQ.'43301') .AND.
  15812      $                  (STNID(3:3).EQ.'0'.OR.STNID(3:3).EQ.'3') .AND.
  15813      $                  (NINT(RDATA(1)*100.).GE.-1000.AND.
  15814      $                   NINT(RDATA(1)).LE.1000.AND.
  15815      $                   NINT(RDATA(2)*100.).GE.12000.AND.
  15816      $                   NINT(RDATA(2)*100.).LE.28000))
  15817             END IF
  15818          END IF

Page 381         Source Listing                  SFCDTA
2017-04-18 11:09                                 prepdata.f

  15819          IF(ATLAS)  THEN
  15820 C ATLAS BUOYS ARE PROCESSED; SET PMSL=1013; INSTR WILL IDENTIFY
  15821 C  SPECIFIC R. TYPE (ONLY WIND IS ACTUALLY PROCESSED)
  15822             PMSL = 10130.
  15823             INSTR = 22
  15824          else  if(npkrpt(ityp)) then
  15825 C All other surface types are processed if NPKRPT is TRUE for that type
  15826 C Generate PSTN from standard atmosphere PMSL (1013.25 mb), observed
  15827 C  temperature and elevation (via fcn "PR") (use standard atmosphere
  15828 C  temperature if temperature missing (should use virt. temperature
  15829 C  here, but can't calculate it since pstn missing!)
  15830             tt = 288.15
  15831             if(temp.lt.xmiss) tt = (temp * 0.1) + 273.16
  15832 cfix?       if(temp.lt.ymiss) tt = (temp * 0.1) + 273.16
  15833             pstn = pr(1013.25,tt,elev) * 10
  15834             ipstnflg=1
  15835 c           pstn pb tbl val set to min of 3
  15836             imp = max(3,imp)
  15837 c           q pb tbl val set to min of 3
  15838             imq = imp
  15839             go to 1862
  15840          ELSE  IF(ITYP.EQ.10)  THEN
  15841 C OTHERWISE, IF MESONET GENERATE PSTN FROM STANDARD ATMOSPHERE PMSL
  15842 C  (1013.25 MB), OBSERVED TEMPERATURE AND ELEVATION (VIA FCN "PR") (USE
  15843 C  STANDARD ATMOSPHERE TEMPERATURE IF TEMPERATURE MISSING (SHOULD USE
  15844 C  VIRT. TEMPERATURE HERE, BUT CAN'T CALCULATE IT SINCE PSTN MISSING!)
  15845             TT = 288.15
  15846             IF(TEMP.LT.XMISS.AND.TEMP.GT.-1000.) TT= (TEMP * 0.1)+273.16
  15847 cfix?       IF(TEMP.LT.YMISS.AND.TEMP.GT.-1000.) TT= (TEMP * 0.1)+273.16
  15848             PSTN = PR(1013.25,TT,ELEV) * 10.
  15849 C PSTN PREPBUFR TABLE VALUE SET TO MINIMUM OF 3 HERE
  15850             IMP = MAX(3,IMP)
  15851 C CHARACTER 8 OF STNID SET TO 'x' TO IDENTIFY THESE (SINCE THEY STILL
  15852 C  GET PREPBUFR REPORT TYPE 188/288)
  15853             STNID(8:8) = 'x'
  15854             GO TO 1862
  15855          ELSE
  15856 C OTHERWISE, TOSS REPORT
  15857             IF(IPRINT.EQ.0)  PRINT 955, STNID,RDATA(1),RDATA(2),HDR(13),
  15858      $       IDATA(9)
  15859   955 FORMAT(' * * TOTAL REPORT TOSSED  -ID=',A8,', LAT=',F7.2,'N, ',
  15860      $ 'LON=',F8.2,'E, TIME',F11.5,'UTC, RTYP',I4,' - PMSL AND PSTN ',
  15861      $ 'MISSING  ')
  15862             GO TO 2090
  15863          END IF
  15864  1762    CONTINUE
  15865 C......................................................................
  15866 C             REPORTS WITH MISSING PSTN AND VALID PMSL
  15867 C               (Note: MESONETS CAN NEVER COME HERE!!)
  15868 C.......................................................................
  15869 C TEST FOR MARINE REPORTS OVER GREAT LAKES; IF ELEV = 0 TOSS REPORT;
  15870 C  OTHERWISE TREAT AS LAND REPORT WITH MISSING PSTN
  15871          IF(NINT(RDATA(1)*100.).GE.4100.AND.NINT(RDATA(1)*100.).LE.5000
  15872      $    .AND.NINT(RDATA(2)*100.).GE.26700.AND.NINT(RDATA(2)*100.).LE.
  15873      $    28500.AND..NOT.SFLAND)  THEN
  15874             IF(ELEV.LE.7.5)  THEN
  15875               IF(IPRINT.EQ.0) PRINT 960,STNID,RDATA(1),RDATA(2),IDATA(9)

Page 382         Source Listing                  SFCDTA
2017-04-18 11:09                                 prepdata.f

  15876   960 FORMAT(' * * TOTAL REPORT TOSSED  -ID=',A8,', LAT=',F7.2,'N, ',
  15877      $ 'LON=',F8.2,'E, RTYP',I4,' - ON GREAT LAKES WITH ELEV = 0')
  15878                GO TO 2090
  15879             ELSE
  15880                PRINT 961, STNID,RDATA(1),RDATA(2),IDATA(9)
  15881   961 FORMAT(' > > PSTN MISSING, G.LAKES-ID=',A8,', LAT=',F7.2,'N, ',
  15882      $ 'LON=',F8.2,'E, RTYP',I4,'-TREAT AS FIXED SYNOPTIC LAND, RTYP ',
  15883      $ '183/284')
  15884                ITYP = 1
  15885                INSTR = 1
  15886                SFLAND = .TRUE.
  15887             END IF
  15888          END IF
  15889          IF(ELEV.LE.7.5) THEN
  15890 C IF ELEV < 7.5M SET PSTN=PMSL
  15891 
  15892 C FOR NON-MARINE RPTS: PSTN PREPBUFR TBL VALUE SET TO GREATER OF 2 OR
  15893 C  PMSL PREPBUFR TABLE VALUE
  15894             IMP = MAX(2,IM0)
  15895 C FOR MARINE REPORTS, PSTN PREPBUFR TBL VALUE SET EQUAL TO PMSL TBL VAL.
  15896             IF(.NOT.SFLAND)  IMP = IM0
  15897 C FOR ATLAS BUOYS WHERE PSTN & PMSL ORIG. MSG, PSTN PREPBUFR TV SET TO 3
  15898             IF(INSTR.EQ.22)  IMP = 3
  15899             PSTN = PMSL
  15900          ELSE
  15901 C IF ELEV > 7.5 M:
  15902 C    For marine reports:
  15903 C         If npkrpt=F, SKIP
  15904 C         If npkrpt=T, RETAIN, estimate pstn (and use to get a value
  15905 C                      for q), will later set report type to 194/294,
  15906 C                      and will encode this estimated pstn into
  15907 C                      PREPBUFR file
  15908 C    For land reports:
  15909 C         RETAIN, estimate pstn, will later set report type to 183/
  15910 C          284, and will encode this estimated pstn into PREPBUFR
  15911 C          file
  15912 C
  15913 C    For either land or marine reports that are RETAINED:
  15914 C      --> If outside LFM grid and data thinning turned on (LFM=F) give
  15915 C           all variables PREPBUFR table value of 15
  15916 C      --> If inside LFM grid and data thinning turned off (LFM=T)
  15917 C           pressure and moisture PREPBUFR table values both set to a
  15918 C           minimum of 3
  15919 C
  15920 C      pstn is estimated from reported pmsl, sensible temperature (if
  15921 C        missing use std. atmos. temperature), and elevation via fcn PR
  15922 C        Note: Should use virtual temperature here but can't calculate
  15923 C              this since pstn is missing
  15924 
  15925             IF(.NOT.SFLAND)  THEN
  15926                if(npkrpt(ityp)) then
  15927                   ipstnflg=1
  15928                else
  15929                   IF(IPRINT.EQ.0) PRINT 956,STNID,RDATA(1),RDATA(2),
  15930      $             IDATA(9),ELEV
  15931   956 FORMAT(' * * TOTAL REPORT TOSSED  -ID=',A8,', LAT=',F7.2,'N, ',
  15932      $ 'LON=',F8.2,'E, RTYP',I4,' - MARINE WITH PSTN MISSING, ELEV=',

Page 383         Source Listing                  SFCDTA
2017-04-18 11:09                                 prepdata.f

  15933      $ F5.0,', > 7.5M')
  15934                   GO TO 2090
  15935                end if
  15936             END IF
  15937             IF(.NOT.LFM)  THEN
  15938                IF(IPRINT.EQ.0)  PRINT 957, STNID,RDATA(1),RDATA(2),
  15939      $          IDATA(9),ELEV
  15940   957 FORMAT(' + + TOTAL REPORT FLAGGED -ID=',A8,', LAT=',F7.2,'N, ',
  15941      $ 'LON=',F8.2,'E, RTYP',I4,' - PSTN MISSING, ELEV=',F5.0,', > ',
  15942      $ '7.5M, THINNED')
  15943                IF(IFLSF.EQ.0)  KSKTHN = KSKTHN + 1
  15944                IFLTH = 1
  15945                IFLSF = 1
  15946             END IF
  15947             TT = 288.15
  15948             IF(TEMP.LT.XMISS.AND.TEMP.GT.-1000.) TT= (TEMP * 0.1)+273.16
  15949 cfix?       IF(TEMP.LT.YMISS.AND.TEMP.GT.-1000.) TT= (TEMP * 0.1)+273.16
  15950             PSTN = PR(PMSL*0.1,TT,ELEV) * 10.
  15951             IMP = MAX(3,IM0)
  15952             imq = imp
  15953 C  report type: land get 183/284 via this change of INSTR to 3
  15954 C               marine remain 180/280 as INSTR stays 0 (default)
  15955 c                but will later be changed to 194/294
  15956             IF(INSTR.EQ.1.OR.INSTR.EQ.7)  INSTR = 3
  15957             DVAL = 0.0  ! is this needed??
  15958          END IF
  15959 C+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
  15960       END IF
  15961  1862 CONTINUE
  15962 C-----------------------------------------------------------------------
  15963 C               SPECIAL TESTS FOR SURFACE WIND REPORTS
  15964 C-----------------------------------------------------------------------
  15965 C SPLASH-LEVEL REPORTS CONTAIN ONLY MASS PART - SKIP WIND PART
  15966       IF(ITYP.EQ.5)  GO TO 1800
  15967 c If neither wind direction nor speed available, SKIP wind part
  15968       IF(min(RDATA(L+2),RDATA(L+3)).GE.XMISS)  GO TO 1800
  15969 cfix? IF(min(RDATA(L+2),RDATA(L+3)).GE.YMISS)  GO TO 1800
  15970 C SKIP PARTICULAR TYPE OF SURFACE WIND REPORT IF JSURFW(ITYP) = 9999
  15971       IF(JSURFW(ITYP).NE.0)  GO TO 1800
  15972 C FLAG ALL SFC LAND WINDS OUTSIDE LFM GRD IF THINNING HAS BEEN TURNED ON
  15973       IF(SFLAND.AND..NOT.LFM)  THEN
  15974       IF(IFLTH.EQ.0.AND.IPRINT.EQ.0) PRINT 2957,STNID,RDATA(1),RDATA(2),
  15975      $    IDATA(9),ELEV
  15976  2957 FORMAT(' + + WIND  REPORT FLAGGED -ID=',A8,', LAT=',F7.2,'N, ',
  15977      $ 'LON=',F8.2,'E, RTYP',I4,' - OVER LAND, ELEV=',F5.0,' - THINNED')
  15978          IFLTH = 1
  15979       END IF
  15980 C GET WIND PREPBUFR TABLE VALUE
  15981       IMW = NINT(RDATA(L+10))
  15982       IF(IMW.EQ.4)  THEN
  15983          IMW = 1
  15984          PRINT 1104, STNID,IDATA(9)
  15985  1104 FORMAT(' > > MARINE WIND  - STNID = ',A8,'  TYPE = ',I4,' - ',
  15986      $ 'CORRECTED BY O.P.C. MANUAL Q. CONTROL, WIND PREPBUFR TBL VAL=1',
  15987      $ ', ORIG Q.M. = 4')
  15988       END IF
  15989 C TOSS REPORT IF WIND IS MISSING (CAN THIS EVER HAPPEN?)

Page 384         Source Listing                  SFCDTA
2017-04-18 11:09                                 prepdata.f

  15990       IF(IMW.GE.IQMLIM)  THEN
  15991          PRINT 679, STNID,IMW,IQMLIM
  15992   679    FORMAT(15X,'* * * * *   SURFACE WIND REPORT TOSSED, ID = ',A8,
  15993      $   ', PREPBUFR TABLE VALUE IMW(=',I2,') .GE. ',I2,'   * * * * *')
  15994          GO TO 1800
  15995       END IF
  15996 C CONVERT WIND DIRECTION & SPEED TO U- AND V-COMPONENTS if BOTH present
  15997       IF(max(RDATA(L+2),RDATA(L+3)).lt.xmiss)
  15998 cfix? IF(max(RDATA(L+2),RDATA(L+3)).lt.ymiss)
  15999      $ CALL UV(RDATA(L+2),RDATA(L+3)*0.1,UCOMP,VCOMP)
  16000 C-----------------------------------------------------------------------
  16001  1800 CONTINUE
  16002 C DO SURFACE DEWPOINT DEPRESSION NEXT
  16003       IF(ITYP.EQ.5)  GO TO 2150
  16004       DPDP = NINT(RDATA(L+5))
  16005       if(imq.eq.15) then
  16006         IMQ = NINT(RDATA(L+12))
  16007       else
  16008         IMQ = max(imq,NINT(RDATA(L+12)))
  16009       endif
  16010  2150 CONTINUE
  16011 C***********************************************************************
  16012 C     SURFACE DATA IN BOTH DATA LEVEL CATEGORIES 8 AND 51 COME HERE
  16013 C              SPLASH-LEVEL REPORTS ALSO COME HERE
  16014 C***********************************************************************
  16015       KOUNT = KOUNT + 1
  16016       IF(.NOT.SFLAND)  THEN
  16017          MNDX = 2
  16018       ELSE IF(ITYP.EQ.10)  THEN
  16019          MNDX = 3
  16020       END IF
  16021       ISQNUM(MNDX) = ISQNUM(MNDX) + 1
  16022       IF(MAX(UCOMP,VCOMP).GE.XMISS.and.min(rdata(l+2),rdata(l+3)).ge.
  16023      $ xmiss)  THEN
  16024 cfix? IF(MAX(UCOMP,VCOMP).GE.YMISS.and.min(rdata(l+2),rdata(l+3)).ge.
  16025 cfix?$ ymiss)  THEN
  16026 C Come here if either u-comp or v-comp (or both) missing -- AND --
  16027 C  direction and speed BOTH missing
  16028          IF(ATLAS)  THEN
  16029 C .. ATLAS BUOY (MSG PSTN & PMSL) REPORTS COMPLETELY SKIPPED in this
  16030 C    case (there is no mass piece)
  16031             KOUNT = KOUNT - 1
  16032             ISQNUM(MNDX) = ISQNUM(MNDX) - 1
  16033             IF(IRNMRK.NE.4)  THEN
  16034                PRINT 2713, STNID,RDATA(1),RDATA(2),IDATA(9)
  16035  2713 FORMAT(' * * TOTAL REPORT TOSSED  -ID=',A8,', LAT=',F7.2,'N, ',
  16036      $ 'LON=',F8.2,'E, RTYP',I4,' - ATLAS BUOY WITH MISSING WIND')
  16037             ELSE
  16038                PRINT 6713, STNID,RDATA(1),RDATA(2),IDATA(9)
  16039  6713 FORMAT(' * * TOTAL REPORT TOSSED  -ID=',A8,', LAT=',F7.2,'N, ',
  16040      $ 'LON=',F8.2,'E, RTYP',I4,' - BUOY WITH MISSING PRESS & WIND')
  16041             END IF
  16042             GO TO 2090
  16043          else
  16044 C .. All other (non-ATLAS) reports skip wind processing in this case
  16045 C    (move on to mass piece processing)
  16046             GO TO 11

Page 385         Source Listing                  SFCDTA
2017-04-18 11:09                                 prepdata.f

  16047          END IF
  16048       END IF
  16049 C-----------------------------------------------------------------------
  16050 C      FILL IN WIND INFORMATION FOR SURFACE LAND OR MARINE REPORT
  16051 C-----------------------------------------------------------------------
  16052 C PREPBUFR REPORT TYPE IS BASED ON INSTR
  16053       HDR(6) = 280 + MOD(INSTR,20)
  16054 C RESET PREPBUFR REPORT TYPE 283 TO 284 (SSM/I W. SPEED WILL USE
  16055 C  PREPBUFR REPORT TYPE 283)
  16056       IF(HDR(6).EQ.283)  HDR(6) = 284
  16057 C INITIALIZE BOTTOM LEVEL OF MOBS ARRAY
  16058       MOBS(1:MXTYPV,1:MXWRDL,1:1) = IMISS
  16059       if(ipstnflg.eq.1) then
  16060 C For reports with missing pressure {ipstnflg=1 when npkrpt(ityp)=T},
  16061 C  assign new PREPBUFR report type based on dump report type
  16062          if(idata(9).eq.511.or.idata(9).eq.514) then
  16063             hdr(6) = 292  ! synoptic land (fixed or mobile)
  16064          else if(idata(9).eq.512) then
  16065             hdr(6) = 293  ! METAR
  16066          else if(idata(9)/10.eq.52) then
  16067             hdr(6) = 294  ! ship
  16068          else if(idata(9)/10.eq.53) then
  16069             hdr(6) = 294  ! Platform (C-MAN, tide gauge, Coast Guard)
  16070          else if(idata(9).eq.540) then
  16071             hdr(6) = 295  ! mesonet
  16072          else if(idata(9).eq.561) then
  16073             hdr(6) = 294  ! buoys arriving in WMO FM13 format (fixed)
  16074          else if(idata(9).eq.562.and..not.ATLAS) then
  16075             hdr(6) = 294  ! buoys arriving in WMO FM18 format (fixed or
  16076                           ! drifting - but EXCLUDING ATLAS
  16077          else
  16078 C ... would not expect to get here but just in case should trap report
  16079             print 3955, stnid,rdata(1),rdata(2),hdr(13),idata(9)
  16080  3955 FORMAT('--> should never see below print, due to ipstnflg=1 for ',
  16081      $ 'unrecongized T29 value:'/' * * TOTAL REPORT TOSSED  -ID=',A8,
  16082      $ ', LAT=',F7.2,'N, LON=',F8.2,'E, TIME',F11.5,'UTC, RTYP',I4,
  16083      $ ' - PMSL AND PSTN MISSING  ')
  16084             go to 2090
  16085          endif
  16086       endif
  16087 C INITIALIZE IPMSL ARRAY (WILL REMAIN MISSING FOR WIND REPORTS)
  16088       IPMSL = IMISS
  16089 C STORE STATION PRESSURE OBS (*10 MB) IN WORD 1 OF MOBS WIND LEVEL 1
  16090       MOBS(1,1,1) = NINT(PSTN)
  16091       IMPW = IMP
  16092       IF(IFLSF.EQ.1.OR.IFLTH.EQ.1)  THEN
  16093          IF(IMPW.LE.3.OR.IMPW.GT.15) IMPW = 15
  16094          IF(IMW .LE.3.OR.IMW .GT.15) IMW  = 15
  16095       END IF
  16096 C STORE P, W PREPBUFR TABLE VALUES IN WORDS 1,3,4 OF MOBS WIND LEVEL 1
  16097       MOBS(2,1,1) = IMPW
  16098       MOBS(2,3,1) = IMW
  16099       MOBS(2,4,1) = IMW
  16100       IF(MAX(NINT(UCOMP*100.),NINT(VCOMP*100.)).LT.32767)  THEN
  16101 C STORE U-COMP OBS (*100 M/SEC) IN WORD 3 OF MOBS WIND LEVEL 1
  16102          MOBS(1,3,1) = NINT((UCOMP * 100.0) + 0.005)
  16103 C STORE V-COMP OBS (*100 M/SEC) IN WORD 4 OF MOBS WIND LEVEL 1

Page 386         Source Listing                  SFCDTA
2017-04-18 11:09                                 prepdata.f

  16104          MOBS(1,4,1) = NINT((VCOMP * 100.0) + 0.005)
  16105       END IF
  16106 C store wind direction obs (degrees) in word 5 of mobs wind level 1
  16107       if(nint(rdata(l+2)).lt.32767)  mobs(1,5,1) = nint(rdata(l+2))
  16108 C store wind speed obs (*10 m/sec) in word 6 of mobs wind level 1
  16109       if(nint(rdata(l+3)).lt.32767)  mobs(1,6,1) = nint(rdata(l+3))
  16110 C SET REPORT SEQ. NUMBER TO "ISQNUM(1)" IF SURFACE LAND (EXCL.
  16111 C  MESONETS), TO "ISQNUM(2) IF SURFACE MARINE, OR TO "ISQNUM(3)" IF
  16112 C  MESONET AND STORE IN HDR(11)
  16113       HDR(11) = ISQNUM(MNDX)
  16114       IF(.NOT.ATLAS)  THEN
  16115 C  DO NOT ENCODE OBS2 OR OBS3 VARIABLES WITH WIND REPORT UNLESS IT IS
  16116 C   AN ATLAS BUOY {EXCEPTIONS: OBS2(1-3) - RSRD, EXPRSRD, ALSE}
  16117          OBS2(4:NUMOBS2) = BMISS
  16118          OBS3 = BMISS
  16119          NOBS3 = 0
  16120       END IF
  16121 C NOW CALL FILLX TO INITIATE PROCESS TO ENCODE RPT INTO PREPBUFR FILE
  16122       CALL FILLX(1,IERF)
  16123       IF(IERF.EQ.0)  THEN
  16124          ICALLW = 1
  16125 C+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
  16126 C OPTION TO PRINT LISTING OF ALL SFC WIND RPTS (NORMALLY COMMENTED OUT)
  16127 C        PRINT 9091, STNID,IDATA(9),NINT(HDR(6)),IMW
  16128 C9091 FORMAT(1X,'STN. ',A8,'  DUMP R. TYPE = ',I3,'  PREPBUFR REPORT ',
  16129 C    $ 'TYPE = ',I3,'  WIND PREPBUFR TBL VAL. = ',I2)
  16130 C+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
  16131       END IF
  16132    11 CONTINUE
  16133 C-----------------------------------------------------------------------
  16134 C  FILL IN MASS INFORMATION FOR SFC LAND, MARINE REPORT & PMSL BOGUS
  16135 C-----------------------------------------------------------------------
  16136 C SKIP PARTICULAR TYPE OF SURFACE MASS REPORT IF JSURFM(ITYP) = 9999
  16137       IF(JSURFM(ITYP).NE.0)  GO TO 592
  16138 C ONLY WIND IS PROCESSED FOR ATLAS BUOYS (MSG PMSL,PSTN)
  16139       IF(ATLAS)  GO TO 592
  16140 C  RESTORE OBS2 AND OBS3 VARIABLES SINCE THEY ARE ONLY ENCODED WITH
  16141 C   MASS REPORT (EXCEPT FOR ATLAS BUOYS WHICH ONLY HAVE A WIND REPORT)
  16142 C   {OBS2(1-3) - RSRD, EXPRSRD, ALSE ARE NOT RESTORED SINCE THEY WERE
  16143 C   NEVER SET TO MISSING IN WIND REPORT - THESE ARE ENCODED WITH BOTH
  16144 C   MASS AND WIND REPORTS}
  16145       OBS2(4:NUMOBS2) = OBS2_SAVE(4:NUMOBS2)
  16146       OBS3 = OBS3_SAVE
  16147       NOBS3 = NOBS3_SAVE
  16148 C FOR NON-BOGUS TYPES, PREPBUFR REPORT TYPE IS BASED ON INSTR
  16149       IF(.NOT.MSLBOG)  HDR(6) = 180 + INSTR
  16150 C INITIALIZE BOTTOM LEVEL OF MOBS ARRAY
  16151       MOBS(1:MXTYPV,1:MXWRDL,1:1) = IMISS
  16152       if(ipstnflg.eq.1) then
  16153 C For reports with missing pressure {ipstnflg=1 when npkrpt(ityp)=T},
  16154 C  assign new PREPBUFR report type based on dump report type
  16155          if(idata(9).eq.511.or.idata(9).eq.514) then
  16156             hdr(6) = 192  ! synoptic land (fixed or mobile)
  16157          else if(idata(9).eq.512) then
  16158             hdr(6) = 193  ! METAR
  16159          else if(idata(9)/10.eq.52) then
  16160             hdr(6) = 194  ! ship

Page 387         Source Listing                  SFCDTA
2017-04-18 11:09                                 prepdata.f

  16161          else if(idata(9)/10.eq.53) then
  16162             hdr(6) = 194  ! Platform (C-MAN, tide gauge, Coast Guard)
  16163          else if(idata(9).eq.540) then
  16164             hdr(6) = 195  ! mesonet
  16165          else if(idata(9)/10.eq.56) then
  16166             hdr(6) = 194  ! buoys (all types)
  16167          else
  16168 C ... would not expect to get here but just in case should trap report
  16169             print 3955, stnid,rdata(1),rdata(2),hdr(13),idata(9)
  16170             go to 2090
  16171          endif
  16172       endif
  16173 C INITIALIZE IPMSL ARRAY
  16174       IPMSL = IMISS
  16175       PRESS = PSTN * 0.1
  16176 C STORE STATION PRESSURE OBS (*10 MB) IN WORD 1 OF MOBS MASS LEVEL 1
  16177       MOBS(1,1,1) = NINT(PSTN)
  16178 C STORE GEOPOTENTIAL (ELEV) OBS (METERS) IN WORD 2 OF MOBS MASS LEVEL 1
  16179       MOBS(1,2,1) = NINT(ELEV)
  16180 C HGHT TBL. VAL. SET TO PSTN T.V. FOR ALL RPTS (LAND & MARINE)
  16181       IMZ = IMP
  16182       IF(IFLSF.EQ.1)  THEN
  16183          IF(IMP.LE.3.OR.IMP.GT.15) IMP = 15
  16184          IF(IMZ.LE.3.OR.IMZ.GT.15) IMZ = 15
  16185          IF(IMT.LE.3.OR.IMT.GT.15) IMT = 15
  16186          IF(IMQ.LE.3.OR.IMQ.GT.15) IMQ = 15
  16187       END IF
  16188 C STORE P, Z, T, Q PREPBUFR TBL VALUES IN WORDS 1-4 OF MOBS MASS LEVEL 1
  16189       MOBS(2,1,1) = IMP
  16190       MOBS(2,2,1) = IMZ
  16191       MOBS(2,3,1) = IMT
  16192       MOBS(2,4,1) = IMQ
  16193 C IF TEMP MISSING, SKIP PROCESSING OF TEMP AND MOISTURE
  16194       IF(TEMP.GE.XMISS.OR.IMT.GE.IQMLIM)  GO TO 15
  16195 cfix? IF(TEMP.GE.YMISS.OR.IMT.GE.IQMLIM)  GO TO 15
  16196       JT = NINT((TEMP/10.) * 100.0)
  16197       IF(JT.LT.32767)  THEN
  16198 C STORE "REPORTED" (SENSIBLE) TEMP OBS (*100 DEG. C) IN WORD 3 OF MOBS
  16199 C  MASS LEVEL 1
  16200          MOBS(1,3,1) = JT
  16201       ELSE
  16202          TEMP = XMISS + 0.5
  16203 cfix?    TEMP = YMISS + 0.5
  16204          GO TO 15
  16205       END IF
  16206 C IF MOISTURE MISSING OR GROSSLY BAD, OR TEMPERATURE GROSSLY BAD, SKIP
  16207 C  PROCESSING OF MOISTURE
  16208       IF(TEMP.LE.-1000..OR.DPDP.LT.0.0.OR.DPDP.GT.9999..OR.IMQ.GE.
  16209      $ IQMLIM)  GO TO 15
  16210       DP = ((TEMP - DPDP) * 0.1) + 273.16
  16211 C STORE DEWPOINT TEMP OBS (*100 DEG. C) IN WORD 6 OF MOBS MASS LEVEL 1
  16212       TMPCEL = (DP - 273.16) * 100.
  16213       IF(NINT(TMPCEL).LT.32767)  MOBS(1,6,1) = NINT(TMPCEL)
  16214       Q = QFRMTP(DP,PRESS)
  16215 C IF SPECIFIC HUMIDITY FROM QFRMTP .LT. 0 G/G  KEEP WORD 3 TEMP SENS.
  16216       IF(Q.LT.0.0)  GO TO 15
  16217       TT = (TEMP * 0.1) + 273.16

Page 388         Source Listing                  SFCDTA
2017-04-18 11:09                                 prepdata.f

  16218       X = 100.0 * ((TT * (1.0 + (.61*Q))) - 273.16)
  16219       IF(X.GT.2.1E09) GO TO 15 ! this is the limit for nint below with
  16220                                !  4 byte reals on WCOSS (if hit keep
  16221                                !  word 3 temperature sens. & Q missing,
  16222                                !  either dewpt or press or both bad)
  16223       JT = NINT(X)
  16224 C STORE VIRTUAL TEMPERATURE (*100 DEG. C) IN WORD 5 OF MOBS MASS LEVEL 1
  16225       IF(JT.LT.32767)  MOBS(1,5,1) = JT
  16226       IF(Q*1.E6.GT.99999) THEN
  16227          INTQ = IMISS
  16228       ELSE
  16229          INTQ = NINT(Q * 1.E6)
  16230       END IF
  16231       IF(INTQ.EQ.0)  INTQ = 1
  16232 C STORE SPECIFIC HUMIDITY (*10**6 G/G) IN WORD 4 OF MOBS MASS LEVEL 1;
  16233 C  MUST BE < IMISS (99999) AND > 0 - IF NOT SET TO MISSING
  16234       IF(INTQ.LT.IMISS.AND.INTQ.GT.0)  MOBS(1,4,1) = INTQ
  16235    15 CONTINUE
  16236       if(pmsl.lt.xmiss)  then
  16237 cfix? if(pmsl.lt.ymiss)  THEN
  16238 C IF PMSL VALID, STORE PMSL OBS (*10 MB) AND PREPBUFR TABLE VALUE IN
  16239 C  IPMSL ARRAY
  16240          IF(NINT(PMSL).LT.32767)  THEN
  16241             IPMSL(1) = NINT(PMSL)
  16242             IF(IFLSF.EQ.1.AND.(IM0.LE.3.OR.IM0.GT.15))  IM0 = 15
  16243             IPMSL(2) = IM0
  16244 C IF VALID PSTN FOR land RPT HAS PREPBUFR TBL VAL=3, CHG R.T. FROM 181
  16245 C  OR 187 TO 183 (AS IF CALC. FROM PMSL & ELEV. USING STD. ATMOS.)
  16246 C  (UNLESS MESONET)
  16247             IF(IMP.EQ.3.AND.ITYP.NE.10.and.sfland)  HDR(6) = 183
  16248          END IF
  16249       END IF
  16250 C SET REPORT SEQ. NUMBER TO "ISQNUM(1)" IF SURFACE LAND (EXCL.
  16251 C  MESONETS), TO "ISQNUM(2) IF SURFACE MARINE, OR TO "ISQNUM(3)" IF
  16252 C  MESONET AND STORE IN HDR(11)
  16253       HDR(11) = ISQNUM(MNDX)
  16254 C NOW CALL FILLX TO INITIATE PROCESS TO ENCODE RPT INTO PREPBUFR FILE
  16255       CALL FILLX(1,IERF)
  16256       IF(IERF.EQ.0)  ICALLM = 1
  16257 C     IF(ICALLM.EQ.1)  THEN
  16258 C+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
  16259 C OPTION TO PRINT LISTING OF ALL SFC MASS RPTS (NORMALLY COMMENTED OUT)
  16260 C        PRINT 9090, STNID,IDATA(9),NINT(HDR(6)),IM0,IMP
  16261 C9090 FORMAT(1X,'STN. ',A8,'  DUMP R. TYPE = ',I3,'  PREPBUFR REPORT ',
  16262 C    $ 'TYPE = ',I3,'  PMSL PREPBUFR T VAL = ',I2,'  PSTN PREPBUFR T ',
  16263 C    $ 'VAL = ',I2)
  16264 C+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
  16265 C     END IF
  16266   592 CONTINUE
  16267       IF(ICALLM.EQ.0.AND.ICALLW.EQ.0)  THEN
  16268          KOUNT = KOUNT - 1
  16269          ISQNUM(MNDX) = ISQNUM(MNDX) - 1
  16270          GO TO 2090
  16271       END IF
  16272 C GO BACK AND UNPACK NEXT REPORT
  16273       GO TO 2100
  16274 C-----------------------------------------------------------------------

Page 389         Source Listing                  SFCDTA
2017-04-18 11:09                                 prepdata.f

  16275 C HIT END-OF FILE - TIME TO LOOK AT NEXT IW3UNPBF FORMAT SURFACE FILE
  16276  7000 CONTINUE
  16277       PRINT 950, KNTALL
  16278   950 FORMAT(/,19X,'===>  A TOTAL OF ',I6,'  REPORTS WERE UNPACKED ',
  16279      $ 'FROM THIS FILE, WHETHER KEPT OR SKIPPED  <===',/)
  16280       KNTSSS(NNN) = KOUNT
  16281       IF(NN.EQ.1.AND.KOUNT.EQ.0)  ICODE = 4
  16282       REWIND NFILE
  16283  7008 CONTINUE
  16284       NN = NN + 1
  16285       IF(NN.LE.5)  GO TO 700
  16286       PRINT 5679
  16287  5679 FORMAT(/130('.')/130('.')/)
  16288 C YOU HAVE LOOKED AT ALL SFC DATA FILES, RETURN
  16289       RETURN
  16290       END
  16291 C$$$  SUBPROGRAM DOCUMENTATION BLOCK
  16292 C
  16293 C SUBPROGRAM:    ISSEL
  16294 C   PRGMMR: MELCHIOR/KEYSER  ORG: NP22       DATE: 2014-04-25
  16295 C
  16296 C ABSTRACT: FUNCTION -- TRANSLATES THE SURFACE DUMP REPORT TYPE TO AN
  16297 C   INTEGER VALUE USED BY SUBROUTINE SFCDTA TO DIFFERENTIATE TYPES OF
  16298 C   SURFACE REPORTS BEING PROCESSED {EITHER LAND (SYNOPTIC FIXED,
  16299 C   SYNOPTIC MOBILE, OR METAR), MARINE (SHIP, BUOY, SPLASH-LEVEL
  16300 C   DROPWINSONDE, C-MAN PLATFORM, AUTOMATED TIDE GAUGE, COAST GUARD
  16301 C   TIDE GAUGE), PMSL BOGUS (OPC/NOS POINT, AUSTRALIAN PAOBS), MESONET,
  16302 C   OR "OTHER" (DEFAULT, INVALID)}.
  16303 C
  16304 C PROGRAM HISTORY LOG:
  16305 C   UNKNOWN
  16306 C 1988-04-11  D. A. KEYSER -- DOCBLOCKING/COMMENTING
  16307 C 1988-09-14  D. A. KEYSER -- EXPANDED TO INCLUDE SPLASH-LEVEL DROPS
  16308 C 1988-12-22  D. A. KEYSER -- EXPANDED TO INCLUDE C-MAN PLATFORM
  16309 C 1989-02-03  D. A. KEYSER -- RECOGNIZES SAT. MOISTURE BOGUS AND RAOB/
  16310 C    PIBAL AND PUTS THEM IN ADDITIONAL "OTHER" CATEGORIES
  16311 C 1990-01-11  D. A. KEYSER -- CONVERTED TO VS FORTRAN(77), RESTRUCTURED
  16312 C 1991-01-03  D. A. KEYSER -- 3 PMSL BOGUS TYPES (POINT, PAOBS, DIGIT.)
  16313 C 1995-08-24  D. A. KEYSER -- R.TYPE 182'S NOW NOT PROCESSED IF CAT. 2
  16314 C    SFC PRESSURE MISSING (UNLESS CAT. 3 SFC PRESSURE AVAILABLE), OR IF
  16315 C    CAT. 2 SFC PRESSURE IS LESS THAN 1 MB
  16316 C 1998-06-09  D. A. KEYSER -- STREAMLINED PROCESSING
  16317 C 1999-08-04  D. A. KEYSER -- UPDATED LOGIC TO PROPERLY PROCESS
  16318 C    AUSTRALIAN SEA-LEVEL PRESSURE BOGUS DATA (PAOBS)
  16319 C 2000-09-22  D. A. KEYSER -- ADDED PROCESSING OF AUTOMATED TIDE GAUGE
  16320 C    STN DATA (READ FROM "SFCSHP" DUMP, DUMP REPORT TYPE 533)
  16321 C 2000-12-05  D. A. KEYSER -- CHANGED DUMP REPORT TYPE FOR SURFACE
  16322 C    MARINE AUTOMATED TIDE GAUGE REPORTS FROM 533 TO 532 SO THEY AGREE
  16323 C    WITH REPORT TYPE IN QUIPS PROCESSING
  16324 C 2004-09-09  D. A. KEYSER -- NOW CHECKS ACTUAL DUMP REPORT TYPE RATHER
  16325 C    THAN DUMP REPORT TYPE DIVIDED BY TEN; ADDED PROCESSING OF MESONET
  16326 C    DATA (READ FROM "MSONET" DUMP, DUMP REPORT TYPE 540); ADDED
  16327 C    PROCESSING OF MOBILE SURFACE SYNOPTIC LAND REPORTS (READ FROM
  16328 C    "ADPSFC" DUMP, DUMP REPORT TYPE 514)
  16329 C 2014-04-25  S. Melchior  -- Added processing of Coast Guard tide
  16330 C    gauge data (read from SFCSHP dump, dump report type 534).
  16331 C 2014-04-25  D. A. Keyser -- Invalid "other" (default) output "type"

Page 390         Source Listing                  SFCDTA
2017-04-18 11:09                                 prepdata.f

  16332 C    changed from 13 TO 30.  Invalid RECCO/DROPWINSONDE with no splash-
  16333 C    level mass output type changed from 12 to 20.
  16334 C
  16335 C USAGE:    XX = ISSEL(ITYPDMP)
  16336 C   INPUT ARGUMENT LIST:
  16337 C     ITYPDMP - DUMP REPORT TYPE
  16338 C
  16339 C REMARKS: CALLED BY SUBROUTINE 'SFCDTA'.
  16340 C   'ISSEL' RETURNED IS TRANSLATED INTEGER VALUE USED BY SUBROUTINE
  16341 C   SFCDTA TO DIFFERENTIATE TYPES OF SURFACE REPORTS BEING PROCESSED:
  16342 C         1 ..... SURFACE SYNOPTIC LAND STATION (FIXED)
  16343 C                 (INCLUDING WMO RESOLUTION 40)
  16344 C         2 ..... SHIP (FIXED AND MOVING)
  16345 C         3 ..... OPC/NOS POINT MEAN SEA-LEVEL PRESSURE BOGUS
  16346 C         4 ..... BUOY (FIXED AND DRIFTING))
  16347 C         5 ..... SPLASH-LEVEL MASS FROM DROPS/RECCO WITH PMSL OBS
  16348 C         6 ..... C-MAN PLATFORM
  16349 C         7 ..... AUSTRALIAN SEA-LEVEL PRESSURE BOGUS - PAOBS
  16350 C         8 ..... SURFACE METAR LAND
  16351 C         9 ..... AUTOMATED TIDE GAUGE STATION
  16352 C        10 ..... MESONET SURFACE (COOPERATIVE NETWORKS)
  16353 C        11 ..... SURFACE SYNOPTIC LAND STATION (MOBILE)
  16354 C        12 ..... COAST GUARD TIDE GAUGE STATION
  16355 C        13-19 .. RESERVED FOR FUTURE TYPES
  16356 C        20 ..... RECCO/DROPWINSONDE WITH NO SPLASH-LEVEL MASS
  16357 C                 INFORMATION (INVALID TYPE)
  16358 C        30 ..... "OTHER" (INVALID TYPE)
  16359 C
  16360 C ATTRIBUTES:
  16361 C   LANGUAGE: FORTRAN 90
  16362 C   MACHINE:  NCEP WCOSS
  16363 C
  16364 C$$$
  16365       FUNCTION ISSEL(ITYPDMP)
  16366       PARAMETER (MXWRDH = 15)
  16367       PARAMETER (MAXOBS = 3500)
  16368       INTEGER  JTYPE(31:562),IDATA(MAXOBS)
  16369       real(8)  alon_8,alat_8
  16370       CHARACTER*8  STNID,SUBSET_d
  16371       COMMON/ADP/ISATOB,PMAND(23),RDATA(MAXOBS),IPRINT
  16372       COMMON/RPTHDR/SUBSET_d,STNID,HDR(2:MXWRDH),alon_8,alat_8
  16373       COMMON/UPALIM/LEVPM,LEVST,LEVQQ,TDLIM,TDMAX,SPCIAL,ISQNUM_UPA
  16374       EQUIVALENCE  (IDATA,RDATA)
  16375 
  16376       DATA  JTYPE/
  16377 
  16378 C      31         511 512     514       522 523       531 532  --> RTYPE
  16379 C      --         --- ---     ---       --- ---       --- ---
  16380      $  5, 479*30,  1,  8, 30, 11, 7*30,  2,  2, 7*30,  6,  9,
  16381 
  16382 C          534        540        551         561 562  --> RTYPE
  16383 C          ---        ---        ---         --- ---
  16384      $ 30,  12, 5*30,  10, 10*30,  3, 9*30,    4,  4 /
  16385 
  16386       DATA  YMISS/99998.8/
  16387 
  16388       ISSEL0 = 30

Page 391         Source Listing                  ISSEL
2017-04-18 11:09                                 prepdata.f

  16389 
  16390       IF(ITYPDMP.GT.30.AND.ITYPDMP.LT.563)  ISSEL0 = JTYPE(ITYPDMP)
  16391 
  16392       IF(ISSEL0.EQ.3)  THEN
  16393 C AUSTRALIAN PAOBS RESET ISSEL0=7 (OPC/NOS POINT BOGUS RETAIN ISSEL0=3)
  16394          IF(STNID(1:1).EQ.'P')  ISSEL0 = 7
  16395       ELSE  IF(ISSEL0.EQ.5)  THEN
  16396 
  16397 C COME HERE FOR RECCOS/DROPS (EXCEPT FOR RECCOS WITH PMSL -
  16398 C                 THESE HAVE ALREADY BEEN EXAMINED)
  16399 C ------------------------------------------------------------------
  16400 
  16401          IF(IDATA(15).EQ.0)  THEN
  16402 C  ... IF NO CAT. 2 LEVELS, THEN NOT A SPLASH-LEVEL DROP, RESET ISSEL0=20
  16403             ISSEL0 = 20
  16404          ELSE  IF(NINT(RDATA(IDATA(16))).GE.32750.OR.
  16405      $    (NINT(RDATA(IDATA(16)))*0.1).LT.PMAND(LEVST))  THEN
  16406             IF(NINT(RDATA(IDATA(16))).GE.YMISS)  THEN
  16407                IF(IDATA(17).GT.0)  THEN
  16408                   IF(NINT(RDATA(IDATA(18))).LT.32750.AND.
  16409      $             (NINT(RDATA(IDATA(18)))*0.1).GE.PMAND(LEVST))  THEN
  16410                      RDATA(IDATA(16)) = RDATA(IDATA(18))
  16411                      RDATA(IDATA(16)+3) = RDATA(IDATA(18)+3)
  16412                      GO TO 999
  16413                   END IF
  16414                END IF
  16415             END IF
  16416 C  ... IF PRESS ON 1ST CAT. 2 LVL MISSING OR < PMAND(LEVST) RESET
  16417 C      ISSEL0 TO 20
  16418             ISSEL0 = 20
  16419          END IF
  16420       END IF
  16421 
  16422   999 CONTINUE
  16423 
  16424       ISSEL = ISSEL0
  16425 
  16426       RETURN
  16427       END

Page 392         Source Listing                  ISSEL
2017-04-18 11:09 Entry Points                    prepdata.f



ENTRY POINTS

  Name              
                    
 issel_             


SYMBOL CROSS REFERENCE

 Name                       Object Declared Type            Bytes Dimen Elements Attributes       References                        
                                                                                                                                    
 999                        Label  16422                                                          16412                             
 ADP                        Common 16371                                14100                                                       
 ALAT_8                     Scalar 16369    R(8)            8           scalar   COM                                                
 ALON_8                     Scalar 16369    R(8)            8           scalar   COM                                                
 HDR                        Scalar 16372    R(4)            4     1     14       COM                                                
 IDATA                      Scalar 16368    I(4)            4     1     3500     COM              16401,16404,16405,16406,16407,1640
                                                                                                  8,16409,16410,16411               
 IPRINT                     Scalar 16371    I(4)            4           scalar   COM                                                
 ISATOB                     Scalar 16371    I(4)            4           scalar   COM                                                
 ISQNUM_UPA                 Scalar 16373    I(4)            4           scalar   COM                                                
 ISSEL                      Func   16365    I(4)            4           scalar                    16424                             
 ISSEL0                     Local  16388    I(4)            4           scalar                    16388,16390,16392,16394,16395,1640
                                                                                                  3,16418,16424                     
 ISSEL@0                    Local  16365    I(4)            4           scalar                                                      
 ITYPDMP                    Dummy  16365    I(4)            4           scalar   ARG,INOUT        16390                             
 JTYPE                      Local  16368    I(4)            4     1     532                       16376,16390                       
 LEVPM                      Scalar 16373    I(4)            4           scalar   COM                                                
 LEVQQ                      Scalar 16373    I(4)            4           scalar   COM                                                
 LEVST                      Scalar 16373    I(4)            4           scalar   COM              16405,16409                       
 MAXOBS                     Param  16367    I(4)            4           scalar                    16368,16371                       
 MXWRDH                     Param  16366    I(4)            4           scalar                    16372                             
 NINT                       Func   16404                                scalar                    16404,16405,16406,16408,16409     
 PMAND                      Scalar 16371    R(4)            4     1     23       COM              16405,16409                       
 RDATA                      Scalar 16371    R(4)            4     1     3500     COM              16404,16405,16406,16408,16409,1641
                                                                                                  0,16411                           
 RPTHDR                     Common 16372                                88                                                          
 SPCIAL                     Scalar 16373    R(4)            4           scalar   COM                                                
 STNID                      Scalar 16370    CHAR            8           scalar   COM              16394                             
 SUBSET_D                   Scalar 16370    CHAR            8           scalar   COM                                                
 TDLIM                      Scalar 16373    R(4)            4           scalar   COM                                                
 TDMAX                      Scalar 16373    R(4)            4           scalar   COM                                                
 UPALIM                     Common 16373                                28                                                          
 YMISS                      Local  16386    R(4)            4           scalar                    16386,16406                       

Page 393         Source Listing                  ISSEL
2017-04-18 11:09                                 prepdata.f

  16428 C$$$  SUBPROGRAM DOCUMENTATION BLOCK
  16429 C
  16430 C SUBPROGRAM:    GETSMI
  16431 C   PRGMMR: D. A. KEYSER     ORG: NP22       DATE: 2001-06-19
  16432 C
  16433 C ABSTRACT: UNPACKS SSM/I (DMSP SATELLITE) REPORTS FROM ANY ONE OR
  16434 C   MORE OF THE FOLLOWING TYPES: WIND SPEED, TOTAL PRECIPITABLE WATER,
  16435 C   RAIN RATE OR 7-CHANNEL BRIGHTNESS TEMPERATURES FROM REPROCESSED
  16436 C   SSM/I BUFR FILE (SPSSMI) GENERATED BY PROGRAM PREPSSMI.  ALL ARE
  16437 C   UNPACKED FROM UNIQUE REPORTS ORIGINATING IN DATA LEVEL CATEGORY 8.
  16438 C   HANDLES ONE REPORT AT A TIME, PERFORMING SEVERAL CHECKS SUCH AS
  16439 C   WHETHER THE REPORT IS WITHIN THE TIME LIMIT OR THE DATA EXTRACTION
  16440 C   BOUNDARY.
  16441 C
  16442 C PROGRAM HISTORY LOG:
  16443 C   UNKNOWN
  16444 C 1990-10-25  D. A. KEYSER (W/NMC22)
  16445 C 1993-05-12  D. A. KEYSER -- SET-UP EXPANDED REPORT FORMAT, WORD 2 FOR
  16446 C     EACH MASS/WIND LVL IS PRESS. X 10MB, NEW WORD 5 FOR EACH LEVEL
  16447 C     CONTAINS 4 PACKED "PREPBUFR TBL VALUES" WHICH CAN RANGE FROM 0-15
  16448 C     AND CORRESPOND TO ON29 Q. MARKERS OR PREPRO-GENERATED Q. MARKERS;
  16449 C     ALL NON-MISSING DATA ARE NOW PACKED INTO PREPBUFR FILE
  16450 C 1993-05-31  D. A. KEYSER -- CHANGED DEF. VALUES & ORDER FOR NAMELIST
  16451 C     SWITCH "IUNIT"
  16452 C 1993-07-28  D. A. KEYSER -- N-LIST SWITCHES JPSSMI & XWINDO NOW 2-DIM
  16453 C     ARRAYS WITH 1ST ELEMENT INDICATING LATITUDE BAND (CAN PROCESS/NO
  16454 C     PROCESS FOR 6 LATITUDE BANDS); ADDED TABLE AT END WHICH
  16455 C     SUMMARIZES SSM/I COUNTS BY LAT. BAND
  16456 C 1995-07-12  D. A. KEYSER -- CAN NOW PROCESS SSM/I 7- CHANNEL
  16457 C     BRIGHTNESS TEMPERATURE REPORTS W/ R. TYPE=102
  16458 C 1999-08-04  D. A. KEYSER -- MODIFIED TO READ REPROCESSED SSM/I
  16459 C     (SPSSMI) DATA FROM "JACK WOOLLEN" BUFR FILES RATHER THAN FROM
  16460 C     ON29 FILES, REMOVED SUBR. UNPREP AND CALL TO IT, SUBR. IW3UNPBF
  16461 C     (VIA SUBR. UNPREPBF) MOD. TO HANDLE SSM/I REPROC. DATA IN "JACK"
  16462 C     BUFR
  16463 C 2001-04-06  D. A. KEYSER -- NOW PROCESSES SSM/I RAIN RATE UNDER R.TYP
  16464 C     150; SUBR. "GETSMI" STREAMLINED; SUBR. "PWATER" RENAMED TO
  16465 C     "GETPWATER", NOW RETURNS IERF=1 IF REPORT NOT ENCODED INTO
  16466 C     PREPBUFR FILE (INSTEAD OF MST=0); ACCOUNTS FOR SUBR. IW3UNPBF
  16467 C     OUTPUTTING SSM/I WIND SPEED IN M/SEC (PRECISE TO 10**1) RATHER
  16468 C     THAN M/SEC*10; ACCOUNTS FOR SUBR. IW3UNPBF OUTPUTTING SSM/I TPW
  16469 C     IN MM (PRECISE TO 10**1) RATHER THAN MM*10; ACCOUNTS FOR SUBR.
  16470 C     IW3UNPBF OUTPUTTING SSM/I BRIGHTNESS TEMPS IN K (PRECISE TO
  16471 C     10**2) RATHER THAN K*100; "RPTLBL" NOW HAS INPUT ARGS. "TIMWIN_e"
  16472 C     (EARLIEST TIME WINDOW) AND "TIMWIN_l" (LATEST TIME WINDOW) REPL.
  16473 C     "TIMWIN" (+/- TIME WINDOW) ("-" PRIOR TO CYCLE TIME, "+" AFTER
  16474 C     CYCLE TIME), ALLOWS THE 2 TO BE DIFFERENT
  16475 C 2001-06-19  D. A. KEYSER -- NEW SUBR. "TIMCHK" DOES TIME WINDOW CHECK
  16476 C     SEPARATE FROM "RPTLBL"
  16477 C
  16478 C USAGE:    CALL GETSMI
  16479 C   INPUT FILES:
  16480 C     UNIT FF+4 - 'SPSSMI' BUFR DATA DUMP FILE (REPROCESSED FROM
  16481 C                 ORIGINAL SSM/I DATA DUMP - USUALLY CONTAINS TOTAL
  16482 C                 PRECIP. WATER, WIND SPEED AND MAYBE ALSO RAIN RATE)
  16483 C     (FF IS UNIT NUMBER DEFINED AS IUNIT(6) IN NAMELIST "&PARM")
  16484 C

Page 394         Source Listing                  ISSEL
2017-04-18 11:09                                 prepdata.f

  16485 C   OUTPUT FILES:
  16486 C     UNIT 06  - STANDARD OUTPUT PRINT
  16487 C
  16488 C REMARKS: UNITS FOR INPUT DATA ARE: WIND SPEED - M/SEC (TO NEAREST
  16489 C     10**1 PRECISION); PRECIP. WATER - MM (TO NEAREST 10**1 PRECISION);
  16490 C     BRIGHTNESS TEMPERATURE - DEG. K TIMES 100.; RAIN RATE MM/SEC
  16491 C     (TO NEAREST 10**6 PRECISION).  CALLED BY SUBROUTINE 'PREP'.
  16492 C
  16493 C ATTRIBUTES:
  16494 C   LANGUAGE: FORTRAN 90
  16495 C   MACHINE:  NCEP WCOSS
  16496 C
  16497 C$$$
  16498       SUBROUTINE GETSMI
  16499       PARAMETER (MXWRDH = 15)
  16500       PARAMETER (MXTYPV =  3)
  16501       PARAMETER (MXWRDL =  6)
  16502       PARAMETER (MXLVL = 600)
  16503       PARAMETER (MAXOBS = 3500)
  16504       CHARACTER*8  STNID,DSNAME,SUBSET_d
  16505       CHARACTER*46 CTEXT(4)
  16506       INTEGER  KOUNT_MI(6,4),IDATA(MAXOBS),ITYP(189:198)
  16507       INTEGER(8)  IDSDMP_8
  16508       REAL  PHISMI(7)
  16509       real(8)  alon_8,alat_8
  16510       COMMON/STRMOB/MOBS(MXTYPV,MXWRDL,MXLVL)
  16511       COMMON/STRRRT/REQV
  16512       COMMON/ADP/ISATOB,PMAND(23),RDATA(MAXOBS),IPRINT
  16513       COMMON/DATA/KOUNT,IDATE(4),IDAT10,MP_PROCESS,WRMISS
  16514       COMMON/RPTHDR/SUBSET_d,STNID,HDR(2:MXWRDH),alon_8,alat_8
  16515       COMMON/UNITNO/NFILE,IUNIT(28)
  16516       COMMON/MISWCH/XWINDO(6,4),JPSSMI(6,4),SRAD(7),KNTSMI(4),KTIMM(4),
  16517      $ KSKPMI,KMSGMI,KBDYMI
  16518       COMMON/PWSWCH/PWT(5),IQMPW
  16519       EQUIVALENCE  (RDATA,IDATA)
  16520       DATA  PHISMI/-90.,-70.,-20.,0.,20.,70.,90./,YMISS/99998.8/,
  16521      $ XMISS/99999./,IMISS/99999/
  16522       DATA  CTEXT/'OCEANIC WIND SPEED (6 LAT BANDS) (- & +)      ',
  16523      $            'OCEANIC TOT. PREC. WATER (6 LAT BANDS) (- & +)',
  16524      $            'RAIN RATE (6 LAT BANDS) (- & +)               ',
  16525      $            '7-CHN. BRIGHTNESS TEMP. (6 LAT BANDS)  (- & +)'/
  16526 C DATA LEVEL CAT. 8 CODE FIGURE: 189-195 196 197 198
  16527       DATA  ITYP/       7*4,   1,  2,  3  /
  16528       IOPENED   = 0
  16529       DSNAME    = 'ZZZZZZZZ'
  16530       IDSDAT    = 0
  16531       IDSDMP_8  = 0
  16532       SUBSET_d  = 'XXXXXXXX'
  16533       PWT       = XMISS
  16534 C KNTALL COUNTS NO. OF REPORTS UNPACKED FROM FILE (ALL REPORTS)
  16535       KNTALL = 0
  16536 C KOUNT COUNTS TOTAL NO. OF RPTS UNPACKED (& NOT SKIPPED) FROM FILE
  16537       KOUNT = 0
  16538 C KOUNT_MI COUNTS NO. OF WIND SPEED (x,1), P. WATER (x,2), RAIN RATE
  16539 C  (x,3), AND BRT. TEMP (x,4) REPORTS UNPACKED (& NOT SKIPPED) FROM FILE
  16540       KOUNT_MI = 0
  16541 C IQMLIM IS PREPBUFR TBL VAL. LIMIT FOR ACCEPTING REPORTS

Page 395         Source Listing                  GETSMI
2017-04-18 11:09                                 prepdata.f

  16542       IQMLIM = 16
  16543       NFILE = IUNIT(6) + 4
  16544       IFLAG = 0
  16545       PRINT 5678
  16546  5678 FORMAT(/130('.')/15X,'Next Dataset should be SPSSMI  '/130('.')/)
  16547       GO TO 2100
  16548 C***********************************************************************
  16549 C***********************************************************************
  16550  2090 CONTINUE
  16551 C COUNT ALL SKIPPED REPORTS
  16552       KSKPMI = KSKPMI + 1
  16553 C***********************************************************************
  16554 C***********************************************************************
  16555  2100 CONTINUE
  16556 C INITIALIZE REQV AS MISSING
  16557       REQV   = XMISS
  16558 C CALL UNPREPBF TO UNPACK THE NEXT REPORT
  16559       CALL UNPREPBF(IFLAG,CYCLET,IOPENED,DSNAME,IDSDAT,IDSDMP_8,*7000)


ENTRY POINTS

  Name               
                     
 getsmi_             


SYMBOL CROSS REFERENCE

 Name                       Object Declared Type            Bytes Dimen Elements Attributes       References                        
                                                                                                                                    
 1701                       Label  16585                                                          16582                             
 2090                       Label  16550                                                          16597,16612,16688,16692           
 2100                       Label  16555                                                          16547,16571,16575,16589,16682,1672
                                                                                                  9                                 
 5678                       Label  16546                                                          16545                             
 7000                       Label  16731                                                          16559                             
 871                        Label  16564                                                          16563                             
 872                        Label  16569                                                          16568                             
 881                        Label  16737                                                          16736                             
 950                        Label  16748                                                          16747                             
 ADP                        Common 16512                                14100                                                       
 ALAT_8                     Scalar 16509    R(8)            8           scalar   COM                                                
 ALON_8                     Scalar 16509    R(8)            8           scalar   COM                                                
 CHKREP                     Subr   16597                                                          16597                             
 CTEXT                      Local  16505    CHAR            46    1     4                         16522,16568                       
 CYCLET                     Local  16559    R(4)            4           scalar                    16559,16602                       
 DATA                       Common 16513                                32                                                          
 DSNAME                     Local  16504    CHAR            8           scalar                    16529,16559                       
 FILLX                      Subr   16640                                                          16640,16656,16686                 
 GETPWATER                  Subr   16648                                                          16648                             
 GETSMI                     Subr   16498                                                                                            
 HDR                        Scalar 16514    R(4)            4     1     14       COM              16609,16625,16655,16685           
 I                          Local  16671    I(4)            4           scalar                    16671,16736                       
 IBAND                      Local  16580    I(4)            4           scalar                    16580,16581,16584,16591,16607,1660
                                                                                                  8,16694                           
 IDAT10                     Scalar 16513    I(4)            4           scalar   COM                                                

Page 396         Source Listing                  GETSMI
2017-04-18 11:09 Symbol Table                    prepdata.f

 Name                       Object Declared Type            Bytes Dimen Elements Attributes       References                        
                                                                                                                                    
 IDATA                      Scalar 16506    I(4)            4     1     3500     COM              16575,16577,16671                 
 IDATE                      Scalar 16513    I(4)            4     1     4        COM                                                
 IDSDAT                     Local  16530    I(4)            4           scalar                    16530,16559                       
 IDSDMP_8                   Local  16507    I(8)            8           scalar                    16531,16559                       
 IER                        Local  16609    I(4)            4           scalar                    16609,16610                       
 IERF                       Local  16640    I(4)            4           scalar                    16640,16648,16656,16686,16690     
 IFLAG                      Local  16544    I(4)            4           scalar                    16544,16559,16560                 
 IGOOD                      Local  16669    I(4)            4           scalar                    16669,16677,16680                 
 II                         Local  16568    I(4)            4           scalar                    16568                             
 IMISS                      Local  16521    I(4)            4           scalar                    16521,16627                       
 IMW                        Local  16620    I(4)            4           scalar                    16620,16635,16639                 
 INDX                       Local  16673    I(4)            4           scalar                    16673,16674,16676                 
 IOPENED                    Local  16528    I(4)            4           scalar                    16528,16559                       
 IPRINT                     Scalar 16512    I(4)            4           scalar   COM                                                
 IQMLIM                     Local  16542    I(4)            4           scalar                    16542                             
 IQMPW                      Scalar 16518    I(4)            4           scalar   COM              16643                             
 ISATOB                     Scalar 16512    I(4)            4           scalar   COM                                                
 ITYP                       Local  16506    I(4)            4     1     10                        16527,16587                       
 IUNIT                      Scalar 16515    I(4)            4     1     28       COM              16543                             
 J                          Local  16736    I(4)            4           scalar                    16736                             
 JPSSMI                     Scalar 16516    I(4)            4     2     24       COM              16566,16567,16591                 
 JTYP                       Local  16587    I(4)            4           scalar                    16587,16591,16607,16608,16611,1661
                                                                                                  8,16641,16649,16657,16694         
 K                          Local  16565    I(4)            4           scalar                    16565,16566,16567,16568           
 KBDYMI                     Scalar 16517    I(4)            4           scalar   COM              16597                             
 KMSGMI                     Scalar 16517    I(4)            4           scalar   COM              16597                             
 KNTALL                     Local  16535    I(4)            4           scalar                    16535,16578,16747                 
 KNTSMI                     Scalar 16516    I(4)            4     1     4        COM              16732                             
 KOUNT                      Scalar 16513    I(4)            4           scalar   COM              16537,16617,16681,16691           
 KOUNT_MI                   Local  16506    I(4)            4     2     24                        16540,16694,16732,16733,16736     
 KSKPMI                     Scalar 16517    I(4)            4           scalar   COM              16552                             
 KTIMM                      Scalar 16516    I(4)            4     1     4        COM              16611                             
 L                          Local  16577    I(4)            4           scalar                    16577,16586,16587,16623,16646,1665
                                                                                                  3,16670,16672,16673,16675,16676   
 MAXOBS                     Param  16503    I(4)            4           scalar                    16506,16512                       
 MIN                        Func   16566                                scalar                    16566                             
 MISWCH                     Common 16516                                264                                                         
 MOBS                       Scalar 16510    I(4)            4     3     10800    COM              16627,16630,16631,16634,16635,1663
                                                                                                  8,16639                           
 MP_PROCESS                 Scalar 16513    I(4)            4           scalar   COM                                                
 MXLVL                      Param  16502    I(4)            4           scalar                    16510                             
 MXTYPV                     Param  16500    I(4)            4           scalar                    16510,16627                       
 MXWRDH                     Param  16499    I(4)            4           scalar                    16514                             
 MXWRDL                     Param  16501    I(4)            4           scalar                    16510,16627                       
 NFILE                      Scalar 16515    I(4)            4           scalar   COM              16543,16734                       
 NINT                       Func   16581                                scalar                    16581,16586,16587,16638,16673     
 PHISMI                     Local  16508    R(4)            4     1     7                         16520,16581                       
 PMAND                      Scalar 16512    R(4)            4     1     23       COM                                                
 PWSWCH                     Common 16518                                24                                                          
 PWT                        Scalar 16518    R(4)            4     1     5        COM              16533,16646                       
 RDATA                      Scalar 16512    R(4)            4     1     3500     COM              16581,16586,16587,16623,16646,1665
                                                                                                  3,16673,16675,16676               
 REQV                       Scalar 16511    R(4)            4           scalar   COM              16557,16653                       
 RPTHDR                     Common 16514                                88                                                          
 RPTLBL                     Subr   16602                                                          16602                             

Page 397         Source Listing                  GETSMI
2017-04-18 11:09 Symbol Table                    prepdata.f

 Name                       Object Declared Type            Bytes Dimen Elements Attributes       References                        
                                                                                                                                    
 SRAD                       Scalar 16516    R(4)            4     1     7        COM              16676                             
 STNID                      Scalar 16504    CHAR            8           scalar   COM                                                
 STRMOB                     Common 16510                                43200                                                       
 STRRRT                     Common 16511                                4                                                           
 SUBSET_D                   Scalar 16504    CHAR            8           scalar   COM              16532                             
 TIMCHK                     Subr   16609                                                          16609                             
 TIMWIN_E                   Local  16607    R(4)            4           scalar                    16607,16609                       
 TIMWIN_L                   Local  16608    R(4)            4           scalar                    16608,16609                       
 UNITNO                     Common 16515                                116                                                         
 UNPREPBF                   Subr   16559                                                          16559                             
 WRMISS                     Scalar 16513    R(4)            4           scalar   COM                                                
 WSPD                       Local  16623    R(4)            4           scalar                    16623,16638                       
 XMISS                      Local  16521    R(4)            4           scalar                    16521,16533,16557                 
 XWINDO                     Scalar 16516    R(4)            4     2     24       COM              16568,16607,16608                 
 YMISS                      Local  16520    R(4)            4           scalar                    16520,16675                       

Page 398         Source Listing                  GETSMI
2017-04-18 11:09                                 prepdata.f

  16560       IF(IFLAG.EQ.1)  THEN
  16561 C.......................................................................
  16562 C IFLAG = 1 RETURNS DATA SET INFO (ONLY) AFTER FIRST CALL
  16563          PRINT 871
  16564   871 FORMAT(/42X,'+++  TIME WINDOW  (HRS X 100) ON REPORTS  +++',/)
  16565          DO  K = 1,4
  16566             IF(MIN(JPSSMI(1,K),JPSSMI(2,K),JPSSMI(3,K),JPSSMI(4,K),
  16567      $       JPSSMI(5,K),JPSSMI(6,K)).EQ.0)
  16568      $       PRINT 872, CTEXT(K),(XWINDO(II,K),II=1,6)
  16569   872       FORMAT(25X,A46,6F6.0)
  16570          END DO
  16571          GO TO 2100
  16572 C.......................................................................
  16573       END IF
  16574 C A REPORT WAS SUCCESSFULLY DECODED
  16575       IF(IDATA(27).LT.1)  GO TO 2100
  16576 C THE REPORT HAS DATA IN DATA LEVEL CATEGORY 8 OF UNPACKED IW3UNPBF FMT
  16577       L = IDATA(28)
  16578       KNTALL = KNTALL + 1
  16579 C IDENTIFY LATITUDE (PHISMI) BAND INDEX ---> IBAND
  16580       DO IBAND = 1,5
  16581          IF(NINT(RDATA(1)*100.).LT.(NINT(PHISMI(IBAND+1)*100.)-0.5))
  16582      $    GO TO 1701
  16583       ENDDO
  16584       IBAND = 6
  16585  1701 CONTINUE
  16586       IF(NINT(RDATA(L+1)).GT.188.AND.NINT(RDATA(L+1)).LT.199)  THEN
  16587          JTYP = ITYP(NINT(RDATA(L+1)))
  16588       ELSE
  16589          GO TO 2100
  16590       END IF
  16591       IF(JPSSMI(IBAND,JTYP).EQ.0)  THEN
  16592 C-----------------------------------------------------------------------
  16593 C                THE REPORT IS ONE OF THE TYPES WANTED
  16594 C BEGIN SERIES OF CHECKS ON UNPACKED REPORT -- IF ANY ONE FAILS SKIP IT
  16595 C-----------------------------------------------------------------------
  16596 C CALL CHKREP TO CHECK FOR MSG LAT/LON & FOR REPORT OUTSIDE SEARCH AREA
  16597          CALL CHKREP(KMSGMI,KBDYMI,*2090)
  16598 C-----------------------------------------------------------------------
  16599 C CALL SUBR. 'RPTLBL' TO STORE REPORT HEADER INTO HDR(4),HDR(5),HDR(7),
  16600 C                          HDR(9)-HDR(15), ALAT_8, ALON_8
  16601 C-----------------------------------------------------------------------
  16602          CALL RPTLBL(CYCLET)
  16603 C-----------------------------------------------------------------------
  16604 C        CALL SUBR. 'TIMCHK' TO CHECK IF REPORT IS W/I PROPER
  16605 C              TIME WINDOW OF CYCLE TIME (IER =1 TOSS RPT)
  16606 C-----------------------------------------------------------------------
  16607          TIMWIN_e = -XWINDO(IBAND,JTYP) * .01
  16608          TIMWIN_l =  XWINDO(IBAND,JTYP) * .01
  16609          CALL TIMCHK(HDR(4),TIMWIN_e,TIMWIN_l,IER)
  16610          IF(IER.EQ.1)  THEN
  16611             KTIMM(JTYP) = KTIMM(JTYP) + 1
  16612             GO TO 2090
  16613          END IF
  16614 C-----------------------------------------------------------------------
  16615 C THE UNPACKED REPORT HAS SUCCESSFULLY PASSED ALL CHECKS -- CONTINUE ON
  16616 C-----------------------------------------------------------------------

Page 399         Source Listing                  GETSMI
2017-04-18 11:09                                 prepdata.f

  16617          KOUNT = KOUNT + 1
  16618          IF(JTYP.EQ.1)  THEN
  16619 C RPT IS SFC WIND SPEED (JTYP=1), STORED IN DATA LEVEL CAT.8, C.F. 196
  16620             IMW = 2   ! PREPBUFR table value here is always default (2)
  16621 C WIND SPEED (WSPD) STORED HERE IN UNITS OF M/SEC (TO 10**1 PRECISION)
  16622 C  (NOTE: W. SPEED CAN NEVER BE MISSING, ELSE C. FIG.196 WOULDN'T EXIST)
  16623             WSPD = RDATA(L)
  16624 C PREPBUFR REPORT TYPE IS SET TO 283
  16625             HDR(6) = 283
  16626 C INITIALIZE BOTTOM LEVEL OF MOBS ARRAY
  16627             MOBS(1:MXTYPV,1:MXWRDL,1:1) = IMISS
  16628 C STORE PRESSURE OBS (*10 MB) (HARDWIRED TO 1013.0 MB) AND PREPBUFR
  16629 C  TABLE VALUE (HARDWIRED TO 2) IN WORD 1 OF MOBS WIND LEVEL 1
  16630             MOBS(1,1,1) = 1013 * 10
  16631             MOBS(2,1,1) = 2
  16632 C STORE U-COMP OBS (*100 M/SEC) (HARDWIRED TO 0.00 M/SEC) & PREPBUFR TBL
  16633 C  VALUE IN WORD 3 OF MOBS WIND LEVEL 1
  16634             MOBS(1,3,1) = 0
  16635             MOBS(2,3,1) = IMW
  16636 C STORE V-COMP OBS (*100 M/SEC) (= - WSPD) AND PREPBUFR TABLE VALUE IN
  16637 C  WORD 4 OF MOBS WIND LEVEL 1
  16638             MOBS(1,4,1) = NINT(-WSPD * 100.0)
  16639             MOBS(2,4,1) = IMW
  16640             CALL FILLX(1,IERF)
  16641          ELSE  IF(JTYP.EQ.2)  THEN
  16642 C RPT IS TOTAL COL. PWATER (JTYP=2), STORED IN DATA LVL CAT.8, C.F. 197
  16643             IQMPW = 2   ! PREPBUFR tbl value here is always default (2)
  16644 C TPW (PWT(1) STORED HERE IN UNITS OF MM (TO 10**1 PRECISION)
  16645 C  (NOTE: TPW CAN NEVER BE MISSING, ELSE C. FIG.197 WOULDN'T EXIST)
  16646             PWT(1) = RDATA(L)
  16647 C CALL GETPWATER TO PROCESS THE PWATER REPORT (GETS R. TYPE 152)
  16648             CALL GETPWATER(2,0,IERF)
  16649          ELSE  IF(JTYP.EQ.3)  THEN
  16650 C REPORT IS RAIN RATE (JTYP=3), STORED IN DATA LEVEL CAT.8, C.F. 198
  16651 C REQV STORED HERE IN UNITS OF MM/SEC (TO 10**6 PRECISION)
  16652 C  (NOTE: REQV CAN NEVER BE MISSING, ELSE C. FIG.198 WOULDN'T EXIST)
  16653             REQV = RDATA(L)
  16654 C PREPBUFR REPORT TYPE IS SET TO 150
  16655             HDR(6) = 150
  16656             CALL FILLX(-2,IERF)
  16657          ELSE  IF(JTYP.EQ.4)  THEN
  16658 C RPT IS 7-CHN B. TEMP (JTYP=4), STORED IN DATA LVL CAT.8, C.F. 189-195
  16659 C-----------------------------------------------------------------------
  16660 C   LOOP THROUGH THE 7-CHANNELS CONTAINING BRIGHTNESS TEMPERATURE
  16661 C               1 - 19GHZ-VERTICAL ANTENNA POLARIZATION
  16662 C               2 - 19GHZ-HORIZONTAL ANTENNA POLARIZATION
  16663 C               3 - 22GHZ-VERTICAL ANTENNA POLARIZATION
  16664 C               4 - 37GHZ-VERTICAL ANTENNA POLARIZATION
  16665 C               5 - 37GHZ-HORIZONTAL ANTENNA POLARIZATION
  16666 C               6 - 85GHZ-VERTICAL ANTENNA POLARIZATION
  16667 C               7 - 85GHZ-HORIZONTAL ANTENNA POLARIZATION
  16668 C-----------------------------------------------------------------------
  16669             IGOOD = 0
  16670             L = L - 4
  16671             DO I = 1,IDATA(27)
  16672                L = L + 4
  16673                INDX = -188 + NINT(RDATA(L+1))

Page 400         Source Listing                  GETSMI
2017-04-18 11:09                                 prepdata.f

  16674                IF(INDX.GT.7)  EXIT
  16675                IF(RDATA(L).LT.YMISS)  THEN
  16676                   SRAD(INDX) = RDATA(L)
  16677                   IGOOD = 1
  16678                END IF
  16679             ENDDO
  16680             IF(IGOOD.EQ.0)  THEN
  16681                KOUNT = KOUNT - 1
  16682                GO TO 2100
  16683             END IF
  16684 C PREPBUFR REPORT TYPE IS SET TO 102
  16685             HDR(6) = 102
  16686             CALL FILLX(-1,IERF)
  16687          ELSE
  16688             GO TO 2090
  16689          END IF
  16690          IF(IERF.EQ.1)  THEN
  16691             KOUNT = KOUNT - 1
  16692             GO TO 2090
  16693          END IF
  16694          KOUNT_MI(IBAND,JTYP) = KOUNT_MI(IBAND,JTYP) + 1
  16695 C+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
  16696 CCCCC    IF(JTYP.EQ.1)  THEN
  16697 C OPTION TO PRINT LISTING OF ALL SSM/I SFC WIND RPTS (NORM. COMM. OUT)
  16698 CCCCC PRINT 9091, STNID,IDATA(9),NINT(HDR(6)),MOBS(1,4,1),IMW
  16699 C9091 FORMAT(1X,'STN. ',A8,'  DUMP R. TYPE = ',I3,'  PREPBUFR REPORT ',
  16700 CCCCC$ 'TYPE = ',I3,'  W. SPD (M/S*100) =',I5,'  WIND PREPBUFR TBL ',
  16701 CCCCC$ 'VAL.=',I3)
  16702 CCCCC    END IF
  16703 C+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
  16704 CCCCC    IF(JTYP.EQ.2)  THEN
  16705 C OPTION TO PRINT LISTING OF ALL SSM/I P. WATER RPTS (NORM. COMM. OUT)
  16706 CCCCC PRINT 9090, STNID,IDATA(9),NINT(HDR(6)),PWT(1),IQMPW
  16707 C9090 FORMAT(1X,'STN. ',A8,'  DUMP R. TYPE = ',I3,'  PREPBUFR REPORT ',
  16708 CCCCC$ 'TYPE = ',I3,'  PRECIP. WATER(MM) =',F8.2,'  PW PREPBUFR TBL ',
  16709 CCCCC$ 'VAL.= ',I2)
  16710 CCCCC    END IF
  16711 C+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
  16712 CCCCC    IF(JTYP.EQ.3)  THEN
  16713 C OPTION TO PRINT LISTING OF ALL SSM/I RAIN RATE RPTS (NORM. COMM. OUT)
  16714 CCCCC PRINT 9090, STNID,IDATA(9),NINT(HDR(6)),REQV*3600.
  16715 C9090 FORMAT(1X,'STN. ',A8,'  DUMP R. TYPE = ',I3,'  PREPBUFR REPORT ',
  16716 CCCCC$ 'TYPE = ',I3,'  RAIN RATE(MM/HR) =',F8.3)
  16717 CCCCC    END IF
  16718 C+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
  16719 CCCCC    IF(JTYP.EQ.4)  THEN
  16720 C OPTION TO PRINT LISTING OF ALL SSM/I BBT RPTS (NORM. COMM. OUT)
  16721 CCCCC PRINT 9092, STNID,IDATA(9),NINT(HDR(6)),(SRAD(I),I=1,7)
  16722 C9092 FORMAT(1X,'STN. ',A8,'  DUMP R. TYPE = ',I3,'  PREPBUFR REPORT ',
  16723 CCCCC$ TYPE = ',I3,'  7-CHN BBTS (DEG.K*100) =',7F6.2)
  16724 CCCCC    END IF
  16725 C+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
  16726       END IF
  16727 C***********************************************************************
  16728 C GO BACK AND UNPACK NEXT REPORT
  16729       GO TO 2100
  16730 C HIT END-OF-FILE - ALL DONE

Page 401         Source Listing                  GETSMI
2017-04-18 11:09                                 prepdata.f

  16731  7000 CONTINUE
  16732       KNTSMI = KOUNT_MI(1,:) + KOUNT_MI(2,:) + KOUNT_MI(3,:) +
  16733      $         KOUNT_MI(4,:) + KOUNT_MI(5,:) + KOUNT_MI(6,:)
  16734       REWIND NFILE
  16735 C BRIEFLY SUMMARIZE
  16736       PRINT 881, ((KOUNT_MI(I,J),I=1,6),J=1,4)
  16737   881 FORMAT(/34X,'***** TABLE DETAILING THE USE OF SSM/I RETRIEVAL ',
  16738      $ 'DATUM *****'//20X,86('_')/43X,'||',19X,'COUNTS BY LATITUDE',
  16739      $ ' BAND',17X,'||'
  16740      $ /20X,'SSM/I RETRIEVAL PRODUCT|| 90S-70S | 70S-20S | 20S-EQ  |  ',
  16741      $ 'EQ-20N | 20N-70N | 70N-90N ||'/43X,'||',6(9X,'|'),'|'
  16742      $ /21X,'OCEANIC WIND SPEED    ||',6(I6,3X,'|'),'|'
  16743      $ /21X,'OCEANIC PRECIP. WATER ||',6(I6,3X,'|'),'|'
  16744      $ /21X,'RAIN RATE             ||',6(I6,3X,'|'),'|'
  16745      $ /21X,'7-CHN BRIGHTNESS TEMP ||',6(I6,3X,'|'),'|'
  16746      $ /20X,86('_')/)
  16747       PRINT 950, KNTALL
  16748   950 FORMAT(//19X,'===>  A TOTAL OF ',I6,'  REPORTS WERE UNPACKED ',
  16749      $ 'FROM THIS FILE, WHETHER KEPT OR SKIPPED  <===',/)
  16750       RETURN
  16751       END
  16752 C$$$  SUBPROGRAM DOCUMENTATION BLOCK
  16753 C
  16754 C SUBPROGRAM:    GETSCATT
  16755 C   PRGMMR: Keyser           ORG: NP22       DATE: 2016-11-30
  16756 C
  16757 C ABSTRACT: UNPACKS ERS, QUIKSCAT, WINDSAT OR ASCAT SCATTEROMETER WIND
  16758 C   PRODUCT REPORTS FROM BUFR FILE.  HANDLES ONE REPORT AT A TIME,
  16759 C   PERFORMING SEVERAL CHECKS SUCH AS WHETHER THE REPORT IS WITHIN THE
  16760 C   TIME LIMIT OR THE DATA EXTRACTION BOUNDARY.  STORES INTO MOBS ARRAY
  16761 C   FOR LATER ENCODING INTO OUTPUT PREPBUFR DATA SET.
  16762 C
  16763 C PROGRAM HISTORY LOG:
  16764 C   UNKNOWN
  16765 C 1996-10-28  D. A. KEYSER -- ORIGINAL AUTHOR
  16766 C 1999-08-04  D. A. KEYSER -- MODIFIED TO READ REPROCESSED ERS WIND
  16767 C    (ERSCAT) DATA FROM "JACK WOOLLEN" BUFR FILES RATHER THAN FROM WMO
  16768 C    BUFR FILES, REMOVED SUBR. W3ERSUNB AND CALL TO IT, SUBR. W3UNPKB7
  16769 C    MOD. TO HANDLE ERS REPROC. DATA IN "JACK" BUFR, INPUT TABLEB AND
  16770 C    TABLED FILES REMOVED
  16771 C 2000-09-22  D. A. KEYSER -- ADDED THE PROCESSING OF QUIKSCAT SCATTER-
  16772 C    OMETER WINDS (ALONG WITH NEW N-LIST SWITCHES "JPQKSD", "IQWNDO",
  16773 C    "IQKSLM" & "IQKSSP"), A TEMPORARY INSERTION IS THE THINNING OF
  16774 C    THE DATA BY PROCESSING ONLY EVERY-OTHER UNPACKED REPORT; SUBR.
  16775 C    GETERS CHANGED TO GETSCATT SINCE IT PROCESSES BOTH ERS AND
  16776 C    QUIKSCAT SCATTEROMETER REPORTS
  16777 C 2000-12-05  D. A. KEYSER -- RECOGNIZES ERS AND QUIKSCAT REPORTS WITH
  16778 C     NEW 8-CHAR. FORMAT
  16779 C 2001-04-06  D. A. KEYSER -- NAMELIST SWITCH IQKSLM NOW 2-WORD ARRAY
  16780 C     (WORD 2 - QUIKSCAT P.O.R. THESHOLD FOR SUSPECT Q.M.); "RPTLBL"
  16781 C     NOW HAS INPUT ARGS. "TIMWIN_e" (EARLIEST TIME WINDOW) AND
  16782 C     "TIMWIN_l" (LATEST TIME WINDOW) REPL. "TIMWIN" (+/- TIME WINDOW)
  16783 C     ("-" PRIOR TO CYCLE TIME, "+" AFTER CYCLE TIME), ALLOWS THE 2 TO
  16784 C     BE DIFFERENT
  16785 C 2001-06-19  D. A. KEYSER -- NEW SUBR. "TIMCHK" DOES TIME WINDOW CHECK
  16786 C     SEPARATE FROM "RPTLBL"
  16787 C 2001-10-10  D. A. KEYSER -- N-LIST SWITCHES "IQKSLM" AND "IQKSSP" NOu

Page 402         Source Listing                  GETSMI
2017-04-18 11:09                                 prepdata.f

  16788 C     LONGER READ AND REMOVED AS QUIKSCAT Q.C. WRT PROB. OF RAIN AND
  16789 C     SWATH EDGE NOW PERFORMED IN UPSTREAM PGM "WAVE_DCODQUIKSCAT";
  16790 C     RECOGNIZES QUIKSCAT SUPEROBS (NOW GENERATED IN
  16791 C     "WAVE_DCODQUIKSCAT") WITH "S" IN CHAR. 2 OF REPORT ID; NO LONGER
  16792 C     THINS DATA BY PROCESSING ONLY EVERY OTHER REPORT
  16793 C     ("WAVE_DCODQUIKSCAT" NOW HAS OPTION TO SUPEROB)
  16794 C 2004-09-09  D. A. KEYSER -- CORRECTED BUG IN QUIKSCAT PROCESSING
  16795 C     WHICH WOULD HAVE STORED ALONG-TRACK ROW NUMBER INTO INSTRUMENT
  16796 C     TYPE LOCATION (NOW STORES MISSING)
  16797 C 2007-09-14  D. A. KEYSER -- MODIFIED TO PROCESS WINDSAT SCATTEROMETER
  16798 C     REPORTS, READ FROM NEW "WDSATR" DUMP FILE (GETS PREPBUFR REPORT
  16799 C     TYPE 289 AND ENCODES NEW PARAMETERS MRWVC, MRLWC, WSST, MWD10,
  16800 C     MWS10, WSEQC1, CHSQ, PHER, SPDE, SSTE, CLDE AND VPRE IN PREPBUFR
  16801 C     FILE UNDER NEW MESSAGE TYPE "WDSATR); MODIFIED TO HANDLE RETURN
  16802 C     OF NEW ARGUMENT "RDATA2" FROM CALLS TO W3UNPKB7 [1-DIM 21-WORD
  16803 C     ARRAY WHICH HOLDS ADDITIONAL VALUES DECODED DIRECTLY FROM BUFR
  16804 C     (AND NOT IN "RDATA" ARRAY), FOR SOME PARAMETERS REPLACING WHAT
  16805 C     HAD BEEN RETURNED IN "RDATA" ARRAY (IN THE HEADER)]
  16806 C 2008-09-25  D. A. KEYSER -- CAN NOW PROCESS ASCAT SCATTEROMETER
  16807 C     WIND DATA READING FROM REPROCESSED DUMP FILE IN UNIT 39, ENCODING
  16808 C     INTO NEW PREPBUFR REPORT TYPE 290 UNDER NEW PREPBUFR MESSAGE TYPE
  16809 C     "ASCATW" VIA NEW NAMELIST SWITCHES "JPASCD" (DEF=6*9999) AND
  16810 C     IAWNDO (DEF=-3,+3) (1-DIM ARRAY RDATA2 RETURNED FROM W3UNPKB7
  16811 C     INCREASED FROM 21 TO 24 WORDS TO HANDLE NEW ANCILLARY INFO
  16812 C     ENCODED WITH ASCAT REPORTS)
  16813 C 2016-11-30  D. A. KEYSER -- Accounts for new output argument "OBS8_8"
  16814 C     returned from W3UNPKB7 for unpacked reports (REAL*8 2-word array
  16815 C     containing latitude and longitude of report).
  16816 C
  16817 C USAGE:    CALL GETSCATT(ISCTP)
  16818 C   INPUT ARGUMENT LIST:
  16819 C     ISCTP    - INDICATOR FOR TYPE OF SCATTEROMETER DATA (=1 - ERS;
  16820 C                =2 - QUIKSCAT; =3 - WINDSAT; =4 - ASCAT)
  16821 C
  16822 C   INPUT FILES:
  16823 C     UNIT FF+5 - 'ERS1DA' BUFR DATA DUMP FILE (REPROCESSED FROM
  16824 C                 ORIGINAL ERS SCATTEROMETER DATA DUMP - CONTAINS
  16825 C                 WIND INFORMATION)
  16826 C     UNIT FF+6 - 'QKSWND' BUFR DATA DUMP FILE (REPROCESSED FROM
  16827 C                 ORIGINAL QUIKSCAT SCATTEROMETER DATA DUMP -
  16828 C                 CONTAINS WIND INFORMATION)
  16829 C     UNIT FF+7 - 'WDSATR' BUFR DATA DUMP FILE (REPROCESSED FROM
  16830 C                 ORIGINAL WINDSAT SCATTEROMETER DATA DUMP - CONTAINS
  16831 C                 WIND, MOISTURE AND RAINRATE INFORMATION)
  16832 C     UNIT FF+8 - 'ASCATW' BUFR DATA DUMP FILE (REPROCESSED FROM
  16833 C                 ORIGINAL ASCAT SCATTEROMETER DATA DUMP - CONTAINS
  16834 C                 WIND INFORMATION)
  16835 C     (FF IS UNIT NUMBER DEFINED AS IUNIT(6) IN NAMELIST "&PARM")
  16836 C
  16837 C   OUTPUT FILES:
  16838 C     UNIT 06  - STANDARD OUTPUT PRINT
  16839 C
  16840 C REMARKS: CALLED BY SUBROUTINE 'PREP'.
  16841 C
  16842 C ATTRIBUTES:
  16843 C   LANGUAGE: FORTRAN 90
  16844 C   MACHINE:  NCEP WCOSS

Page 403         Source Listing                  GETSMI
2017-04-18 11:09                                 prepdata.f

  16845 C
  16846 C$$$
  16847       SUBROUTINE GETSCATT(ISCTP)
  16848       PARAMETER (MXWRDH = 15)
  16849       PARAMETER (MXTYPV =  3)
  16850       PARAMETER (MXWRDL =  6)
  16851       PARAMETER (MXLVL = 600)
  16852       PARAMETER (MXBLVL = 255)
  16853       PARAMETER (MAXOBS = 3500)
  16854       PARAMETER (NUMOBS2 = 43)
  16855       CHARACTER*6  NAME(4)
  16856       CHARACTER*8  STNID,STNPRT,DSNAME,DNAME(4),SUBSET_d
  16857       INTEGER  KOUNW(6),IDATA(MAXOBS),IBWNDO(2,4),MDATE(4),IRPTY(4)
  16858       INTEGER(8) IDSDMP_8
  16859       REAL  PHISCT(7)
  16860       REAL(8)  BMISS,obs8_8,alon_8,alat_8
  16861       COMMON/STRMOB/MOBS(MXTYPV,MXWRDL,MXLVL)
  16862       COMMON/ADP/ISATOB,PMAND(23),RDATA(MAXOBS),IPRINT
  16863       COMMON/DATA/KOUNT,IDATE(4),IDAT10,MP_PROCESS,WRMISS
  16864       COMMON/RPTHDR/SUBSET_d,STNID,HDR(2:MXWRDH),alon_8,alat_8
  16865       COMMON/UNITNO/NFILE,IUNIT(28)
  16866       COMMON/STRRRT/REQV
  16867       COMMON/PARM6/MODPRT,IFLUA,STNPRT(3)
  16868       COMMON/SCTWCH/IEWNDO(2),JPERSD(6),IQWNDO(2),JPQKSD(6),IWWNDO(2),
  16869      $ JPWDSD(6),KSKPSC(4),KMSGSC(4),KBDYSC(4),KTIMSC(4),KNTSCT(4),
  16870      $ JPASCD(6),IAWNDO(2)
  16871       COMMON/SKPSUB/SUBSKP(0:255,0:200)
  16872       COMMON/DIRECT/OBS3(5,MXBLVL,7),OBS2(NUMOBS2),NOBS3(7),RDATA2(25),
  16873      $ obs8_8(2)
  16874       COMMON /BUFRLIB_MISSING/BMISS
  16875       EQUIVALENCE  (RDATA,IDATA)
  16876       DATA  PHISCT/-90.,-70.,-20.,0.,20.,70.,90./,YMISS/99998.8/,
  16877      $ IRPTY/286,285,289,290/,XMISS/99999./,IMISS/99999/
  16878       DATA  NAME/'ERS1DA','QKSWND','WDSATR','ASCATW'/
  16879       DATA  DNAME/'  ERS   ','QUIKSCAT','WINDSAT ',' ASCAT  '/
  16880       IBWNDO(1,1) = IEWNDO(1)
  16881       IBWNDO(2,1) = IEWNDO(2)
  16882       IBWNDO(1,2) = IQWNDO(1)
  16883       IBWNDO(2,2) = IQWNDO(2)
  16884       IBWNDO(1,3) = IWWNDO(1)
  16885       IBWNDO(2,3) = IWWNDO(2)
  16886       IBWNDO(1,4) = IAWNDO(1)
  16887       IBWNDO(2,4) = IAWNDO(2)
  16888 C KNTALL COUNTS NO. OF REPORTS UNPACKED FROM FILE (ALL REPORTS)
  16889       KNTALL = 0
  16890 C KOUNT COUNTS TOTAL NO. OF RPTS UNPACKED (& NOT SKIPPED) FROM FILE
  16891       KOUNT = 0
  16892       KOUNW = 0
  16893       NFILE = IUNIT(6) + 4 + ISCTP
  16894       IFLAG = 0
  16895       PRINT 5678, NAME(ISCTP)
  16896  5678 FORMAT(/130('.')/15X,'Next Dataset should be ',A6,'  '/130('.')/)
  16897       GO TO 2100
  16898 C***********************************************************************
  16899 C***********************************************************************
  16900  2090 CONTINUE
  16901 C COUNT ALL SKIPPED REPORTS

Page 404         Source Listing                  GETSCATT
2017-04-18 11:09                                 prepdata.f

  16902       KSKPSC(ISCTP) = KSKPSC(ISCTP) + 1
  16903 C***********************************************************************
  16904 C***********************************************************************
  16905  2100 CONTINUE
  16906 C INITIALIZE REQV AS MISSING
  16907       REQV   = XMISS
  16908       IRET = 0
  16909 C CALL W3UNPKB7 TO READ/DECODE NEXT ERS, QUIKSCAT, WINDSAT OR ASCAT
  16910 C  WIND REPORT
  16911       OBS2   = BMISS  ! initialize obs2   array before reading any rpts
  16912       OBS3   = BMISS  ! initialize obs3   array before reading any rpts
  16913       NOBS3  = 0      ! initialize nobs3  array before reading any rpts
  16914       obs8_8 = bmiss  ! initialize obs8_8 array before reading any rpts
  16915       RDATA2 = BMISS  ! initialize rdata2 array before reading any rpts
  16916       CALL W3UNPKB7(IDATE,IBWNDO(1,ISCTP),IBWNDO(2,ISCTP),NFILE,RDATA,
  16917      $ STNID,DSNAME,RDATA2,obs8_8,IDSDAT,IDSDMP_8,SUBSET_d,SUBSKP,IRET)
  16918 C.......................................................................
  16919       IF(IRET.EQ.1)  THEN
  16920          IFLAG = 1
  16921 C IRET = 1 RETURNS DATA SET INFO (ONLY) AFTER FIRST CALL
  16922          PRINT 102, DSNAME,NFILE
  16923   102    FORMAT(//46X,'*****  ',A8,'  --  UNIT =',I3,'  *****')
  16924 C SPLIT CENTER DATE INTO COMPONENTS (MDATE)
  16925          MDATE(1) = IDSDAT/1000000
  16926          MDATE(2) = MOD((IDSDAT/10000),100)
  16927          MDATE(3) = MOD((IDSDAT/100),100)
  16928          MDATE(4) = MOD(IDSDAT,100)
  16929          PRINT 1101, DSNAME,MDATE,IDSDMP_8
  16930  1101 FORMAT(/20X,'DATASET NAME: ',A8,'  --  DATE: ',I4.4,2('-',I2.2),
  16931      $ 1X,I2.2,'Z  -- DUMP DATE (I12 FORMAT): ',I12.12/)
  16932 C DOES DATE FROM DATA SET MATCH NCEP PRODUCTION DATE?
  16933          IF(IDSDAT.NE.IDAT10)  THEN
  16934             PRINT 324
  16935   324 FORMAT(/13X,'>>>>>   P R O B L E M :   D A T E   D O E S   N O T',
  16936      $ '   M A T C H   P R O D U C T I O N   D A T E   <<<<<'/)
  16937             GO TO 7000
  16938          END IF
  16939 C CYCLET IS TIME THE ERS, QUIKSCAT, WINDSAT OR ASCAT WIND DATA IS
  16940 C  CENTERED ON (CYCLE TIME)
  16941          CYCLET = IDATE(4)
  16942          PRINT 871
  16943   871 FORMAT(/42X,'+++  TIME WINDOW  (HRS X 100) ON REPORTS  +++'/)
  16944          PRINT 875, DNAME(ISCTP),IBWNDO(1,ISCTP),IBWNDO(2,ISCTP)
  16945   875 FORMAT(42X,A8,' WIND DATA - .............',I4,'00. TO',I4,'00.'/)
  16946          GO TO 2100
  16947 C.......................................................................
  16948       ELSE  IF(IRET.GT.2)  THEN
  16949 C PROBLEM READING ERS, QUIKSCAT, WINDSAT OR ASCAT WIND RPT, GO ON TO
  16950 C  NEXT RPT
  16951          PRINT 912, DNAME(ISCTP)
  16952   912    FORMAT(/' * * ERROR READING ',A8,' SCATTEROMETER WIND REPORT'/)
  16953          GO TO 2090
  16954 C.......................................................................
  16955       ELSE  IF(IRET.EQ.2)  THEN
  16956 C IF IER = 2, HAVE HIT END-OF-FILE, ALL ERS, QUIKSCAT, WINDSAT OR ASCAT
  16957 C  WIND REPORTS PROCESSED
  16958          IF(IFLAG.LE.0)  THEN

Page 405         Source Listing                  GETSCATT
2017-04-18 11:09                                 prepdata.f

  16959             PRINT 8003, NFILE
  16960  8003       FORMAT(/' *** ERROR RETURNING DATA SET INFORMATION IN ',
  16961      $       'FIRST CALL TO FILE IN UNIT ',I3,' -- THIS MAY BE A NULL',
  16962      $       ' FILE -- GO TO NEXT FILE'/)
  16963          ELSE  IF(IFLAG.EQ.1)  THEN
  16964             PRINT 8002
  16965  8002    FORMAT(/' * * NO REPORTS CURRENTLY PRESENT IN THIS DATA FILE,',
  16966      $    ' GO TO NEXT FILE'/)
  16967          END IF
  16968          GO TO 7000
  16969 C.......................................................................
  16970       END IF
  16971       IF(IDATA(35).NE.1.OR.IDATA(36).EQ.0)  THEN
  16972          PRINT 919, DNAME(ISCTP)
  16973   919    FORMAT(/' * * ERROR: NO. OF "LEVELS" FOR ',A8,' SCATTEROMETER',
  16974      $    ' WIND REPORT .NE. 1'/)
  16975          GO TO 2090
  16976       END IF
  16977 C.......................................................................
  16978 C A REPORT WAS SUCCESSFULLY DECODED
  16979       IFLAG = 2
  16980       L = IDATA(36)
  16981       KNTALL = KNTALL + 1
  16982 C IDENTIFY LATITUDE (PHISCT) BAND INDEX ---> IBAND
  16983       DO IBAND = 1,5
  16984          IF(NINT(RDATA(1)*100.).LT.(NINT(PHISCT(IBAND+1)*100.)-0.5))
  16985      $    GO TO 1701
  16986       ENDDO
  16987       IBAND = 6
  16988  1701 CONTINUE
  16989 C CHECK TO SEE IF DATA IN THIS LATITUDE BAND IS REQUESTED FOR PROCESSING
  16990       IF(ISCTP.EQ.1)  THEN
  16991          IF(JPERSD(IBAND).NE.0)  GO TO 2100
  16992       ELSE IF(ISCTP.EQ.2)  THEN
  16993          IF(JPQKSD(IBAND).NE.0)  GO TO 2100
  16994       ELSE IF(ISCTP.EQ.3)  THEN
  16995          IF(JPWDSD(IBAND).NE.0)  GO TO 2100
  16996       ELSE IF(ISCTP.EQ.4)  THEN
  16997          IF(JPASCD(IBAND).NE.0)  GO TO 2100
  16998       END IF
  16999 C SKIP REPORT IF WIND IS MISSING
  17000       IF(MAX(RDATA(L+2),RDATA(L+3)).GE.YMISS)  GO TO 2090
  17001 C-----------------------------------------------------------------------
  17002 C BEGIN SERIES OF CHECKS ON UNPACKED REPORT - IF ANY FAIL, SKIP REPORT
  17003 C-----------------------------------------------------------------------
  17004 C CALL CHKREP TO CHECK FOR MSG LAT/LON & FOR REPORT OUTSIDE SEARCH AREA
  17005       CALL CHKREP(KMSGSC(ISCTP),KBDYSC(ISCTP),*2090)

Page 406         Source Listing                  GETSCATT
2017-04-18 11:09 Entry Points                    prepdata.f



ENTRY POINTS

  Name                 
                       
 getscatt_             


SYMBOL CROSS REFERENCE

 Name                       Object Declared Type            Bytes Dimen Elements Attributes       References                        
                                                                                                                                    
 102                        Label  16923                                                          16922                             
 1101                       Label  16930                                                          16929                             
 1701                       Label  16988                                                          16985                             
 2090                       Label  16900                                                          16953,16975,17000,17005,17021,1711
                                                                                                  1                                 
 2100                       Label  16905                                                          16897,16946,16991,16993,16995,1699
                                                                                                  7,17123                           
 324                        Label  16935                                                          16934                             
 5678                       Label  16896                                                          16895                             
 7000                       Label  17124                                                          16937,16968                       
 8002                       Label  16965                                                          16964                             
 8003                       Label  16960                                                          16959                             
 871                        Label  16943                                                          16942                             
 875                        Label  16945                                                          16944                             
 881                        Label  17130                                                          17129                             
 8890                       Label  17044                                                          17041                             
 8894                       Label  17051                                                          17050                             
 912                        Label  16952                                                          16951                             
 919                        Label  16973                                                          16972                             
 950                        Label  17137                                                          17136                             
 ADP                        Common 16862                                14100                                                       
 ALAT_8                     Scalar 16860    R(8)            8           scalar   COM                                                
 ALON_8                     Scalar 16860    R(8)            8           scalar   COM                                                
 BMISS                      Scalar 16860    R(8)            8           scalar   COM              16911,16912,16914,16915           
 BUFRLIB_MISSING            Common 16874                                8                                                           
 CHKREP                     Subr   17005                                                          17005                             
 CYCLET                     Local  16941    R(4)            4           scalar                    16941,17011                       
 DATA                       Common 16863                                32                                                          
 DATA4                      Local  17010    R(4)            4           scalar                    17010,17041                       
 DIRECT                     Common 16872                                36016                                                       
 DNAME                      Local  16856    CHAR            8     1     4                         16879,16944,16951,16972,17129     
 DSNAME                     Local  16856    CHAR            8           scalar                    16917,16922,16929                 
 FILLX                      Subr   17108                                                          17108                             
 GETSCATT                   Subr   16847                                                                                            
 HDR                        Scalar 16864    R(4)            4     1     14       COM              17018,17058,17105                 
 I                          Local  17129    I(4)            4           scalar                    17129                             
 IABS                       Func   17016                                scalar                    17016,17017                       
 IAWNDO                     Scalar 16870    I(4)            4     1     2        COM              16886,16887                       
 IBAND                      Local  16983    I(4)            4           scalar                    16983,16984,16987,16991,16993,1699
                                                                                                  5,16997,17113                     
 IBWNDO                     Local  16857    I(4)            4     2     8                         16880,16881,16882,16883,16884,1688
                                                                                                  5,16886,16887,16916,16944,17016,17
                                                                                                  017                               
 IDAT10                     Scalar 16863    I(4)            4           scalar   COM              16933                             

Page 407         Source Listing                  GETSCATT
2017-04-18 11:09 Symbol Table                    prepdata.f

 Name                       Object Declared Type            Bytes Dimen Elements Attributes       References                        
                                                                                                                                    
 IDATA                      Scalar 16857    I(4)            4     1     3500     COM              16971,16980,17041,17042           
 IDATE                      Scalar 16863    I(4)            4     1     4        COM              16916,16941                       
 IDSDAT                     Local  16917    I(4)            4           scalar                    16917,16925,16926,16927,16928,1693
                                                                                                  3                                 
 IDSDMP_8                   Local  16858    I(8)            8           scalar                    16917,16929                       
 IER                        Local  17018    I(4)            4           scalar                    17018,17019                       
 IERF                       Local  17108    I(4)            4           scalar                    17108,17109                       
 IEWNDO                     Scalar 16868    I(4)            4     1     2        COM              16880,16881                       
 IFLAG                      Local  16894    I(4)            4           scalar                    16894,16920,16958,16963,16979     
 IFLUA                      Scalar 16867    I(4)            4           scalar   COM                                                
 IMISS                      Local  16877    I(4)            4           scalar                    16877,17060                       
 IPRINT                     Scalar 16862    I(4)            4           scalar   COM                                                
 IQWNDO                     Scalar 16868    I(4)            4     1     2        COM              16882,16883                       
 IRET                       Local  16908    I(4)            4           scalar                    16908,16917,16919,16948,16955     
 IRPTY                      Local  16857    I(4)            4     1     4                         16877,17058                       
 ISATOB                     Scalar 16862    I(4)            4           scalar   COM                                                
 ISCTP                      Dummy  16847    I(4)            4           scalar   ARG,INOUT        16893,16895,16902,16916,16944,1695
                                                                                                  1,16972,16990,16992,16994,16996,17
                                                                                                  005,17016,17017,17020,17058,17090,
                                                                                                  17092,17098,17107,17126,17129     
 ISEQ                       Local  17091    I(4)            4           scalar                    17091,17094,17096,17100,17102,1710
                                                                                                  5                                 
 IUNIT                      Scalar 16865    I(4)            4     1     28       COM              16893                             
 IVM                        Local  17068    I(4)            4           scalar                    17068,17073,17077                 
 IWWNDO                     Scalar 16868    I(4)            4     1     2        COM              16884,16885                       
 JDD                        Local  17079    I(4)            4           scalar                    17079,17081,17083                 
 JFF                        Local  17080    I(4)            4           scalar                    17080,17081,17085                 
 JPASCD                     Scalar 16870    I(4)            4     1     6        COM              16997                             
 JPERSD                     Scalar 16868    I(4)            4     1     6        COM              16991                             
 JPQKSD                     Scalar 16868    I(4)            4     1     6        COM              16993                             
 JPWDSD                     Scalar 16869    I(4)            4     1     6        COM              16995                             
 K                          Local  17041    I(4)            4           scalar                    17041                             
 KBDYSC                     Scalar 16869    I(4)            4     1     4        COM              17005                             
 KMSGSC                     Scalar 16869    I(4)            4     1     4        COM              17005                             
 KNTALL                     Local  16889    I(4)            4           scalar                    16889,16981,17136                 
 KNTSCT                     Scalar 16869    I(4)            4     1     4        COM              17126                             
 KOUNT                      Scalar 16863    I(4)            4           scalar   COM              16891,17037,17087,17110,17126     
 KOUNW                      Local  16857    I(4)            4     1     6                         16892,17113,17129                 
 KSKPSC                     Scalar 16869    I(4)            4     1     4        COM              16902                             
 KTIMSC                     Scalar 16869    I(4)            4     1     4        COM              17020                             
 L                          Local  16980    I(4)            4           scalar                    16980,17000,17042,17043,17065,1707
                                                                                                  9,17080,17107                     
 MAX                        Func   17000                                scalar                    17000,17016,17017,17069,17081     
 MAXOBS                     Param  16853    I(4)            4           scalar                    16857,16862                       
 MDATE                      Local  16857    I(4)            4     1     4                         16925,16926,16927,16928,16929     
 MOBS                       Scalar 16861    I(4)            4     3     10800    COM              17060,17063,17064,17072,17073,1707
                                                                                                  6,17077,17083,17085               
 MOD                        Func   16926                                scalar                    16926,16927,16928,17037           
 MODKNT                     Local  17034    I(4)            4           scalar                    17034,17037,17039                 
 MODPRT                     Scalar 16867    I(4)            4           scalar   COM              17035,17036                       
 MPRINT                     Local  17031    I(4)            4           scalar                    17031,17033                       
 MP_PROCESS                 Scalar 16863    I(4)            4           scalar   COM                                                
 MXBLVL                     Param  16852    I(4)            4           scalar                    16872                             
 MXLVL                      Param  16851    I(4)            4           scalar                    16861                             
 MXTYPV                     Param  16849    I(4)            4           scalar                    16861,17060                       

Page 408         Source Listing                  GETSCATT
2017-04-18 11:09 Symbol Table                    prepdata.f

 Name                       Object Declared Type            Bytes Dimen Elements Attributes       References                        
                                                                                                                                    
 MXWRDH                     Param  16848    I(4)            4           scalar                    16864                             
 MXWRDL                     Param  16850    I(4)            4           scalar                    16861,17060                       
 NAME                       Local  16855    CHAR            6     1     4                         16878,16895                       
 NEWPRT                     Local  17036    I(4)            4           scalar                    17036,17037                       
 NFILE                      Scalar 16865    I(4)            4           scalar   COM              16893,16916,16922,16959,17127     
 NINT                       Func   16984                                scalar                    16984,17069,17072,17076,17079,1708
                                                                                                  0                                 
 NOBS3                      Scalar 16872    I(4)            4     1     7        COM              16913                             
 NUMOBS2                    Param  16854    I(4)            4           scalar                    16872                             
 OBS2                       Scalar 16872    R(4)            4     1     43       COM              16911                             
 OBS3                       Scalar 16872    R(4)            4     3     8925     COM              16912                             
 OBS8_8                     Scalar 16860    R(8)            8     1     2        COM              16914,16917                       
 PARM6                      Common 16867                                32                                                          
 PHISCT                     Local  16859    R(4)            4     1     7                         16876,16984                       
 PMAND                      Scalar 16862    R(4)            4     1     23       COM                                                
 RDATA                      Scalar 16862    R(4)            4     1     3500     COM              16916,16984,17000,17010,17041,1704
                                                                                                  2,17043,17065,17079,17080,17107   
 RDATA2                     Scalar 16872    R(4)            4     1     25       COM              16915,16917                       
 REQV                       Scalar 16866    R(4)            4           scalar   COM              16907,17107                       
 RPTHDR                     Common 16864                                88                                                          
 RPTLBL                     Subr   17011                                                          17011                             
 SCTWCH                     Common 16868                                208                                                         
 SKPSUB                     Common 16871                                205824                                                      
 STNID                      Scalar 16856    CHAR            8           scalar   COM              16917,17042,17091,17093,17094,1709
                                                                                                  6,17099,17100,17102               
 STNPRT                     Scalar 16856    CHAR            8     1     3        COM                                                
 STRMOB                     Common 16861                                43200                                                       
 STRRRT                     Common 16866                                4                                                           
 SUBSET_D                   Scalar 16856    CHAR            8           scalar   COM              16917                             
 SUBSKP                     Scalar 16871    R(4)            4     2     51456    COM              16917                             
 TIMCHK                     Subr   17018                                                          17018                             
 TIMWIN_E                   Local  17016    R(4)            4           scalar                    17016,17018                       
 TIMWIN_L                   Local  17017    R(4)            4           scalar                    17017,17018                       
 UCOMP                      Local  17065    R(4)            4           scalar                    17065,17069,17072                 
 UNITNO                     Common 16865                                116                                                         
 UV                         Subr   17065                                                          17065                             
 VCOMP                      Local  17065    R(4)            4           scalar                    17065,17069,17076                 
 W3UNPKB7                   Subr   16916                                                          16916                             
 WRMISS                     Scalar 16863    R(4)            4           scalar   COM                                                
 XMISS                      Local  16877    R(4)            4           scalar                    16877,16907                       
 YMISS                      Local  16876    R(4)            4           scalar                    16876,17000                       

Page 409         Source Listing                  GETSCATT
2017-04-18 11:09                                 prepdata.f

  17006 C-----------------------------------------------------------------------
  17007 C CALL SUBR. 'RPTLBL' TO STORE REPORT HEADER INTO HDR(4),HDR(5),HDR(7),
  17008 C                          HDR(9)-HDR(15), ALAT_8, ALON_8
  17009 C-----------------------------------------------------------------------
  17010       DATA4 = RDATA(4)
  17011       CALL RPTLBL(CYCLET)
  17012 C-----------------------------------------------------------------------
  17013 C        CALL SUBR. 'TIMCHK' TO CHECK IF REPORT IS W/I PROPER
  17014 C              TIME WINDOW OF CYCLE TIME (IER =1 TOSS RPT)
  17015 C-----------------------------------------------------------------------
  17016       TIMWIN_e = -MAX(IABS(IBWNDO(1,ISCTP)),IABS(IBWNDO(2,ISCTP)))
  17017       TIMWIN_l =  MAX(IABS(IBWNDO(1,ISCTP)),IABS(IBWNDO(2,ISCTP)))
  17018       CALL TIMCHK(HDR(4),TIMWIN_e,TIMWIN_l,IER)
  17019       IF(IER.EQ.1)  THEN
  17020          KTIMSC(ISCTP) = KTIMSC(ISCTP) + 1
  17021          GO TO 2090
  17022       END IF
  17023 C-----------------------------------------------------------------------
  17024 C UNPACKED REPORT HAS SUCCESSFULLY PASSED ALL CHECKS -- CONTINUE ON
  17025 C-----------------------------------------------------------------------
  17026 C.......................................................................
  17027 C   IF REQUESTED, PRINT CONTENTS OF "DECODED" ERS, QUIKSCAT, WINDSAT
  17028 C                     OR ASCAT SCATTEROMETER RPT HERE
  17029 C.......................................................................
  17030 CVVVVVTEMPORARY
  17031       MPRINT = 0
  17032 cdak  MPRINT = 1
  17033       IF(MPRINT.EQ.1)  THEN
  17034          MODKNT = -1
  17035          IF(MODPRT.GE.0)  THEN
  17036             NEWPRT = MODPRT/4
  17037             MODKNT = MOD((KOUNT),NEWPRT)
  17038          END IF
  17039          IF(MODKNT.EQ.0)  THEN
  17040 C PRINT OUT REPORT AS FOUND IN OUTPUT ARRAYS 'RDATA','IDATA' AND STNID
  17041             PRINT 8890,(IDATA(K),K=35,36),RDATA(1),RDATA(2),DATA4,
  17042      $       IDATA(5),RDATA(7),IDATA(9),STNID,RDATA(L+2),
  17043      $       RDATA(L+3)
  17044  8890 FORMAT(1X,'>> PRINTOUT OF OUTPUT RDATA/IDATA ARRAY:'//1X,'NO. ',
  17045      $ 'CAT. 10 LVLS=',I1,';  CAT. 10 DATA SUBSCRIPT=',I2/
  17046      $ '     LAT(DEG)       LON(DEG. E)        OBS.TIME(HRS)      YYYY',
  17047      $ 'MMDDHH     ELEV(M)   R.TYPE    STNID    WDIR   WSPD(*10M/S)'/
  17048      $ F10.2,12X,F6.2,11X,F8.5,10X,I10.10,4X,F8.2,2X,I5,5X,A8,
  17049      $ F7.0,F11.0)
  17050             PRINT 8894
  17051  8894       FORMAT(/)
  17052 C.......................................................................
  17053          END IF
  17054       END IF
  17055 CAAAAATEMPORARY
  17056 C PREPBUFR REPORT TYPE IS SET TO 286 FOR ERS, 285 FOR QUIKSCAT, 289 FOR
  17057 C  WINDSAT OR 290 FOR ASCAT REPORTS
  17058       HDR(6) = IRPTY(ISCTP)
  17059 C INITIALIZE BOTTOM LEVEL OF MOBS ARRAY
  17060       MOBS(1:MXTYPV,1:MXWRDL,1:1) = IMISS
  17061 C STORE PRESURE OBS (*10 MB) (HARDWIRED TO 1013.0 MB) AND PREPBUFR TABLE
  17062 C  VALUE (HARDWIRED TO 2) IN WORD 1 OF MOBS WIND LEVEL 1

Page 410         Source Listing                  GETSCATT
2017-04-18 11:09                                 prepdata.f

  17063       MOBS(1,1,1) = 1013 * 10
  17064       MOBS(2,1,1) = 2
  17065       CALL UV(RDATA(L+2),RDATA(L+3)*0.1,UCOMP,VCOMP)
  17066 C WIND PREPBUFR TBL VAL FOR ERS, QUIKSCAT, WINDSAT OR ASCAT RPTS
  17067 C  HARDWIRED TO 2
  17068       IVM = 2
  17069       IF(MAX(NINT(UCOMP*100.),NINT(VCOMP*100.)).LT.32767)  THEN
  17070 C STORE U-COMP OBS (*100 M/SEC) AND PREPBUFR TABLE VALUE IN WORD 3 OF
  17071 C  MOBS WIND LEVEL 1
  17072          MOBS(1,3,1) = NINT((UCOMP * 100.0) + 0.005)
  17073          MOBS(2,3,1) = IVM
  17074 C STORE V-COMP OBS (*100 M/SEC) AND PREPBUFR TABLE VALUE IN WORD 4 OF
  17075 C  MOBS WIND LEVEL 1
  17076          MOBS(1,4,1) = NINT((VCOMP * 100.0) + 0.005)
  17077          MOBS(2,4,1) = IVM
  17078       END IF
  17079       JDD = NINT(RDATA(L+2))
  17080       JFF = NINT(RDATA(L+3) * 0.19425)
  17081       IF(MAX(JDD,JFF).LT.32767)  THEN
  17082 C STORE WIND DIRECTION OBS (DEGREES) IN WORD 5 OF MOBS WIND LEVEL 1
  17083          MOBS(1,5,1) = JDD
  17084 C STORE WIND SPEED OBS (KNOTS) IN WORD 6 OF MOBS WIND LEVEL 1
  17085          MOBS(1,6,1) = JFF
  17086       END IF
  17087       KOUNT = KOUNT + 1
  17088 C SET REPORT SEQ. NUMBER TO NUMERIC KOUNT VALUE IN STNID AND STORE IN
  17089 C  HDR(11)
  17090       IF(ISCTP.EQ.1)  THEN
  17091          READ(STNID(1:7),'(I7)') ISEQ
  17092       ELSE IF(ISCTP.EQ.2)  THEN
  17093          IF(STNID(2:2).EQ.'S')  THEN
  17094             READ(STNID(3:7),'(I5)') ISEQ
  17095          ELSE
  17096             READ(STNID(2:7),'(I6)') ISEQ
  17097          END IF
  17098       ELSE IF(ISCTP.EQ.3.OR.ISCTP.EQ.4)  THEN
  17099          IF(STNID(1:1).EQ.'S')  THEN
  17100             READ(STNID(2:7),'(I6)') ISEQ
  17101          ELSE
  17102             READ(STNID(1:7),'(I7)') ISEQ
  17103          END IF
  17104       END IF
  17105       HDR(11) = ISEQ
  17106 C FOR WINDSAT REPORTS, STORE RAINFALL RATE
  17107       IF(ISCTP.EQ.3)  REQV = RDATA(L+6)
  17108       CALL FILLX(1,IERF)
  17109       IF(IERF.EQ.1)  THEN
  17110          KOUNT = KOUNT - 1
  17111          GO TO 2090
  17112       END IF
  17113       KOUNW(IBAND) = KOUNW(IBAND) + 1
  17114 C+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
  17115 C OPTION TO PRINT LISTING OF ALL ERS, QUIKSCAT, WINDSAT OR ASCAT
  17116 C  SCATTER. RPTS (NORMALLY COMMENTED OUT)
  17117 CCCCC PRINT 9091, STNID,IDATA(9),NINT(HDR(6)),MOBS(1,3,1),MOBS(1,4,1),
  17118 CCCCC$ IWM
  17119 C9091 FORMAT(1X,'STN. ',A8,'  DUMP R. TYPE = ',I3,'  RPT TYPE = ',I3,

Page 411         Source Listing                  GETSCATT
2017-04-18 11:09                                 prepdata.f

  17120 CCCCC$ '  W. U/V (M/S*100) =',2I6,'  WIND PREPBUFR TBL VAL.=',I3)
  17121 C+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
  17122 C GO BACK AND UNPACK NEXT REPORT
  17123       GO TO 2100
  17124  7000 CONTINUE
  17125 C HIT END-OF-FILE - ALL DONE
  17126       KNTSCT(ISCTP) = KOUNT
  17127       REWIND NFILE
  17128 C BRIEFLY SUMMARIZE
  17129       PRINT 881, DNAME(ISCTP),(KOUNW(I),I=1,6)
  17130   881 FORMAT(/34X,'***** TABLE DETAILING THE USE OF ',A8,
  17131      $ ' SCATTEROMETER DATUM *****'//,20X,86('_')/43X,'||',19X,'COUNTS',
  17132      $ ' BY LATITUDE BAND',17X,'||'/20X,'SCATTEROMETER WINDS    || ',
  17133      $ '90S-70S | 70S-20S | 20S-EQ  |  EQ-20N | 20N-70N | 70N-90N ||'
  17134      $ /43X,'||',6(9X,'|'),'|'/21X,'WIND SPEED/DIRECTION  ||',6(I6,3X,
  17135      $ '|'),'|'/20X,86('_')/)
  17136       PRINT 950, KNTALL
  17137   950 FORMAT(//19X,'===>  A TOTAL OF ',I6,'  REPORTS WERE UNPACKED ',
  17138      $ 'FROM THIS FILE, WHETHER KEPT OR SKIPPED  <===',/)
  17139       RETURN
  17140       END
  17141 C$$$  SUBPROGRAM DOCUMENTATION BLOCK
  17142 C
  17143 C SUBPROGRAM:    GETGPSIPW
  17144 C   PRGMMR: Keyser           ORG: NP22       DATE: 2016-11-30
  17145 C
  17146 C ABSTRACT: DECODES GLOBAL POSITIONING SATELLITE INTEGRATED PRECIPITABLE
  17147 C   WATER/ZENITH TOTAL DELAY (GPS-IPW/ZTD) DUMP FILE ("GPSIPW"),
  17148 C   PROCESSING ONE REPORT AT A TIME.  ACCUMULATES COUNT FOR VALID
  17149 C   REPORTS BEFORE CALLING SUBROUTINE TO ACTUALLY PROCESS REPORTS INTO
  17150 C   THE REQUESTED OUTPUT FORMAT.
  17151 C
  17152 C PROGRAM HISTORY LOG:
  17153 C   UNKNOWN
  17154 C 2004-09-09  D. A. KEYSER -- ORIGINAL AUTHOR
  17155 C 2007-09-14  D. A. KEYSER -- MODIFIED TO HANDLE RETURN OF NEW ARGUMENT
  17156 C     "RDATA2" FROM CALLS TO W3UNPKB7 [1-DIM 21-WORD ARRAY WHICH HOLDS
  17157 C     ADDITIONAL VALUES DECODED DIRECTLY FROM BUFR (AND NOT IN "RDATA"
  17158 C     ARRAY), FOR SOME PARAMETERS REPLACING WHAT HAD BEEN RETURNED IN
  17159 C     "RDATA" ARRAY (IN THE HEADER)]; NEW NAMELIST SWITCH "SKGP45",
  17160 C     WHEN TRUE SKIPS ALL GPS-IPW REPORTS WITH REPORT TIME MINUTES
  17161 C     GREATER THAN 30 (xx:45 REPORTS CONSIDERED TO BE OF POORER QUALITY
  17162 C     THAN xx:15 REPORTS)
  17163 C 2016-08-15 JWhiting -- Set SKGP45 to apply to reports with subset
  17164 C      NC012003 only;
  17165 C     Included trap to toss reports with precipitable water value zero
  17166 C      for all GPS data types;
  17167 C     Added logic to toss reports with subset NC012004 if they are from
  17168 C      a non-ENI provider (i.e., characters 5-8 of report id not being
  17169 C      "GPSS") as GSI may not be able to handle these properly at this
  17170 C      time. Controlled by new namelist switch SKGNSS = T (default).
  17171 C 2016-11-30  D. A. KEYSER -- Accounts for new output argument "OBS8_8"
  17172 C     returned from W3UNPKB7 for unpacked reports (REAL*8 2-word array
  17173 C     containing latitude and longitude of report).
  17174 C
  17175 C USAGE:    CALL GETGPSIPW
  17176 C   INPUT FILES:

Page 412         Source Listing                  GETSCATT
2017-04-18 11:09                                 prepdata.f

  17177 C     UNIT II   - 'GPSIPW' BUFR DUMP FILE (GPS INTEGR. PRECIP. WATER/
  17178 C                  ZENITH TOTAL DELAY)
  17179 C    (WHERE II IS UNIT NUMBER DEFINED AS IUNIT(9) IN NAMELIST "&PARM")
  17180 C
  17181 C   OUTPUT FILES:
  17182 C     UNIT 06  - STANDARD OUTPUT PRINT
  17183 C
  17184 C REMARKS: CALLED BY SUBROUTINE 'PREP'.
  17185 C
  17186 C ATTRIBUTES:
  17187 C   LANGUAGE: FORTRAN 90
  17188 C   MACHINE:  NCEP WCOSS
  17189 C
  17190 C$$$
  17191       SUBROUTINE GETGPSIPW
  17192       PARAMETER (MXWRDH = 15)
  17193       PARAMETER (MXBLVL = 255)
  17194       PARAMETER (MAXOBS = 3500)
  17195       PARAMETER (NUMOBS2 = 43)
  17196       CHARACTER*8  STNID,DSNAME,SUBSET_d
  17197       LOGICAL  SKGP45
  17198       LOGICAL  SKGNSS
  17199       INTEGER  IDATA(MAXOBS),KOUNG(6),MDATE(4)
  17200       INTEGER(8) IDSDMP_8
  17201       REAL  PHIIPW(7)
  17202       REAL(8)  BMISS,obs8_8,alon_8,alat_8
  17203       COMMON/UNITNO/NFILE,IUNIT(28)
  17204       COMMON/ADP/ISATOB,PMAND(23),RDATA(MAXOBS),IPRINT
  17205       COMMON/DATA/KOUNT,IDATE(4),IDAT10,MP_PROCESS,WRMISS
  17206       COMMON/DIRECT/OBS3(5,MXBLVL,7),OBS2(NUMOBS2),NOBS3(7),RDATA2(25),
  17207      $ obs8_8(2)
  17208       COMMON/RPTHDR/SUBSET_d,STNID,HDR(2:MXWRDH),alon_8,alat_8
  17209       COMMON/PWSWCH/PWT(5),IQMPW
  17210       COMMON/GPSWCH/JPGPSD(6),GWINDO,KNTGPS,KSKPGP,KMSGGP,KBDYGP,KTIMGP,
  17211      $ KMISGP,KT45GP,SKGP45,SKGNSS,KTGNSS
  17212       COMMON/SFCBFR/ALTIMR,PRSS
  17213       COMMON/SKPSUB/SUBSKP(0:255,0:200)
  17214       COMMON /BUFRLIB_MISSING/BMISS
  17215       EQUIVALENCE (RDATA,IDATA)
  17216       DATA  PHIIPW/-90.,-70.,-20.,0.,20.,70.,90./,YMISS/99998.8/,
  17217      $ XMISS/99999./
  17218 C KNTALL COUNTS NO. OF REPORTS UNPACKED FROM FILE (ALL REPORTS)
  17219       KNTALL = 0
  17220 C KOUNT COUNTS TOTAL NO. OF RPTS UNPACKED (& NOT SKIPPED) FROM FILE
  17221       KOUNT = 0
  17222       KOUNG = 0
  17223       NFILE = IUNIT(9)
  17224 C ASSUME THAT ALL MESSAGES IN BUFR DUMP FILE SHOULD BE READ AND DECODED
  17225 C  (TIME WINDOW CHECK LATER ON CAN FILTER REPORTS OUTSIDE OF
  17226 C  REQUESTED TIME LIMITS) -- SET RANGE TO - 3-HOURS + 2-HOURS
  17227       IETIME = -3
  17228       ILTIME = +2
  17229       IFLAG = 0
  17230       PRINT 5678
  17231  5678 FORMAT(/130('.')/15X,'Next Dataset should be GPSIPW  '/130('.')/)
  17232       GO TO 1400
  17233 C***********************************************************************

Page 413         Source Listing                  GETGPSIPW
2017-04-18 11:09                                 prepdata.f

  17234 C***********************************************************************
  17235  1410 CONTINUE
  17236 C KSKPGP WILL COUNT NO. OF DECODED REPORTS SKIPPED (VARIOUS REASONS)
  17237       KSKPGP = KSKPGP + 1
  17238 C***********************************************************************
  17239 C***********************************************************************
  17240  1400 CONTINUE
  17241 C INITIALIZE PRECIPITABLE WATER AS MISSING
  17242       PWT = XMISS
  17243       IRET = 0
  17244 C CALL W3UNPKB7 TO READ/DECODE THE NEXT GPS-IPW/ZTD REPORT
  17245       OBS2   = BMISS  ! initialize obs2   array before reading any rpts
  17246       OBS3   = BMISS  ! initialize obs3   array before reading any rpts
  17247       NOBS3  = 0      ! initialize nobs3  array before reading any rpts
  17248       obs8_8 = bmiss  ! initialize obs8_8 array before reading any rpts
  17249       RDATA2 = BMISS  ! initialize rdata2 array before reading any rpts
  17250       CALL W3UNPKB7(IDATE,IETIME,ILTIME,NFILE,RDATA,STNID,DSNAME,RDATA2,
  17251      $ obs8_8,IDSDAT,IDSDMP_8,SUBSET_d,SUBSKP,IRET)
  17252 C.......................................................................
  17253       IF(IRET.EQ.1)  THEN
  17254          IFLAG = 1
  17255 C IRET = 1 RETURNS DATA SET INFO (ONLY) AFTER FIRST CALL
  17256          PRINT 102, DSNAME,NFILE
  17257   102    FORMAT(//46X,'*****  ',A8,'  --  UNIT =',I3,'  *****')
  17258 C SPLIT CENTER DATE INTO COMPONENTS (MDATE)
  17259          MDATE(1) = IDSDAT/1000000
  17260          MDATE(2) = MOD((IDSDAT/10000),100)
  17261          MDATE(3) = MOD((IDSDAT/100),100)
  17262          MDATE(4) = MOD(IDSDAT,100)
  17263          PRINT 101, DSNAME,MDATE,IDSDMP_8
  17264   101    FORMAT(/19X,'DATASET NAME: ',A8,'  --  DATE: ',I4.4,2('-',
  17265      $    I2.2),1X,I2.2,'Z  -- DUMP DATE (I12 FORMAT): ',I12.12/)
  17266 C DOES DATE FROM DATA SET MATCH NCEP PRODUCTION DATE?
  17267          IF(IDSDAT.NE.IDAT10)  THEN
  17268             PRINT 324
  17269   324 FORMAT(/13X,'>>>>>   P R O B L E M :   D A T E   D O E S   N O T',
  17270      $ '   M A T C H   P R O D U C T I O N   D A T E   <<<<<'/)
  17271             GO TO 110
  17272          END IF
  17273 C CYCLET IS TIME THE GPS-IPW DATA IS CENTERED ON (CYCLE TIME)
  17274          CYCLET = IDATE(4)
  17275          PRINT 871
  17276   871 FORMAT(/42X,'+++  TIME WINDOW  (HRS X 100) ON REPORTS  +++'/)
  17277          PRINT 875, GWINDO
  17278   875 FORMAT(42X,'GLOBAL POS. SAT. - INTEG. PWATER/ZTD ...',F5.0/)
  17279       if(SKGNSS .and. SUBSET_d.eq.'NC012004') print 878
  17280   878 FORMAT(/34X,'+++++ SKGNSS=T - ALL NON-ENI PROVIDERS ARE TOSSED ',
  17281      $            '+++++'/)
  17282          GO TO 1400
  17283 C.......................................................................
  17284       ELSE  IF(IRET.GT.2)  THEN
  17285 C PROBLEM READING GPS-IPW/ZTD REPORT, GO ON TO NEXT REPORT
  17286          PRINT 572
  17287   572    FORMAT(/' * * ERROR READING GPS-IPW/ZTD REPORT'/)
  17288          GO TO 1410
  17289 C.......................................................................
  17290       ELSE  IF(IRET.EQ.2)  THEN

Page 414         Source Listing                  GETGPSIPW
2017-04-18 11:09                                 prepdata.f

  17291 C IF IER = 2, HAVE HIT END-OF-FILE, ALL GPS-IPW/ZTD REPORTS PROCESSED
  17292          IF(IFLAG.LE.0)  THEN
  17293             PRINT 8003, NFILE
  17294  8003       FORMAT(/' *** ERROR RETURNING DATA SET INFORMATION IN ',
  17295      $       'FIRST CALL TO FILE IN UNIT ',I3,' -- THIS MAY BE A NULL',
  17296      $       ' FILE'/)
  17297          ELSE  IF(IFLAG.EQ.1)  THEN
  17298             PRINT 8002
  17299  8002    FORMAT(/' * * NO REPORTS CURRENTLY PRESENT IN THIS DATA FILE'/)
  17300          END IF
  17301          GO TO 110
  17302       END IF
  17303 C.......................................................................
  17304 C A REPORT WAS SUCCESSFULLY DECODED
  17305       IFLAG = 2
  17306       L = IDATA(44)
  17307       KNTALL = KNTALL + 1
  17308 C IDENTIFY LATITUDE (PHIIPW) BAND INDEX ---> IBAND
  17309       DO IBAND = 1,5
  17310          IF(NINT(RDATA(1)*100.).LT.(NINT(PHIIPW(IBAND+1)*100.)-0.5))
  17311      $    GO TO 1701
  17312       ENDDO
  17313       IBAND = 6
  17314  1701 CONTINUE
  17315 C CHECK TO SEE IF DATA IN THIS LATITUDE BAND IS REQUESTED FOR PROCESSING
  17316       IF(JPGPSD(IBAND).NE.0)  GO TO 1400
  17317 C-----------------------------------------------------------------------
  17318 C BEGIN SERIES OF CHECKS ON UNPACKED REPORT - IF ANY FAIL, SKIP REPORT
  17319 C-----------------------------------------------------------------------
  17320 C CALL CHKREP TO CHECK FOR MSG LAT/LON & FOR REPORT OUTSIDE SEARCH AREA
  17321       CALL CHKREP(KMSGGP,KBDYGP,*1410)

Page 415         Source Listing                  GETGPSIPW
2017-04-18 11:09 Entry Points                    prepdata.f



ENTRY POINTS

  Name                  
                        
 getgpsipw_             


SYMBOL CROSS REFERENCE

 Name                       Object Declared Type            Bytes Dimen Elements Attributes       References                        
                                                                                                                                    
 101                        Label  17264                                                          17263                             
 102                        Label  17257                                                          17256                             
 110                        Label  17411                                                          17271,17301                       
 1400                       Label  17240                                                          17232,17282,17316,17409           
 1410                       Label  17235                                                          17288,17321,17340,17352,17363,1736
                                                                                                  8,17373,17385,17404               
 1701                       Label  17314                                                          17311                             
 324                        Label  17269                                                          17268                             
 5678                       Label  17231                                                          17230                             
 572                        Label  17287                                                          17286                             
 8002                       Label  17299                                                          17298                             
 8003                       Label  17294                                                          17293                             
 871                        Label  17276                                                          17275                             
 875                        Label  17278                                                          17277                             
 878                        Label  17280                                                          17279                             
 881                        Label  17417                                                          17416                             
 950                        Label  17424                                                          17423                             
 9987                       Label  17360                                                          17359                             
 9988                       Label  17366                                                          17365                             
 9989                       Label  17371                                                          17370                             
 9997                       Label  17336                                                          17335                             
 ADP                        Common 17204                                14100                                                       
 ALAT_8                     Scalar 17202    R(8)            8           scalar   COM                                                
 ALON_8                     Scalar 17202    R(8)            8           scalar   COM                                                
 ALTIMR                     Scalar 17212    R(4)            4           scalar   COM                                                
 BMISS                      Scalar 17202    R(8)            8           scalar   COM              17245,17246,17248,17249           
 BUFRLIB_MISSING            Common 17214                                8                                                           
 CHKREP                     Subr   17321                                                          17321                             
 CYCLET                     Local  17274    R(4)            4           scalar                    17274,17326                       
 DATA                       Common 17205                                32                                                          
 DIRECT                     Common 17206                                36016                                                       
 DSNAME                     Local  17196    CHAR            8           scalar                    17250,17256,17263                 
 GETGPSIPW                  Subr   17191                                                                                            
 GETPWATER                  Subr   17400                                                          17400                             
 GPSWCH                     Common 17210                                68                                                          
 GWINDO                     Scalar 17210    R(4)            4           scalar   COM              17277,17380,17381                 
 HDR                        Scalar 17208    R(4)            4     1     14       COM              17334,17335,17359,17365,17370,1738
                                                                                                  2                                 
 I                          Local  17416    I(4)            4           scalar                    17416                             
 IBAND                      Local  17309    I(4)            4           scalar                    17309,17310,17313,17316,17406     
 IDAT10                     Scalar 17205    I(4)            4           scalar   COM              17267                             
 IDATA                      Scalar 17199    I(4)            4     1     3500     COM              17306                             
 IDATE                      Scalar 17205    I(4)            4     1     4        COM              17250,17274                       
 IDSDAT                     Local  17251    I(4)            4           scalar                    17251,17259,17260,17261,17262,1726

Page 416         Source Listing                  GETGPSIPW
2017-04-18 11:09 Symbol Table                    prepdata.f

 Name                       Object Declared Type            Bytes Dimen Elements Attributes       References                        
                                                                                                                                    
                                                                                                  7                                 
 IDSDMP_8                   Local  17200    I(8)            8           scalar                    17251,17263                       
 IER                        Local  17382    I(4)            4           scalar                    17382,17383                       
 IERF                       Local  17400    I(4)            4           scalar                    17400,17401                       
 IETIME                     Local  17227    I(4)            4           scalar                    17227,17250                       
 IFLAG                      Local  17229    I(4)            4           scalar                    17229,17254,17292,17297,17305     
 ILTIME                     Local  17228    I(4)            4           scalar                    17228,17250                       
 IPRINT                     Scalar 17204    I(4)            4           scalar   COM                                                
 IQMPW                      Scalar 17209    I(4)            4           scalar   COM              17392                             
 IRET                       Local  17243    I(4)            4           scalar                    17243,17251,17253,17284,17290     
 ISATOB                     Scalar 17204    I(4)            4           scalar   COM                                                
 IUNIT                      Scalar 17203    I(4)            4     1     28       COM              17223                             
 JPGPSD                     Scalar 17210    I(4)            4     1     6        COM              17316                             
 KBDYGP                     Scalar 17210    I(4)            4           scalar   COM              17321                             
 KMISGP                     Scalar 17211    I(4)            4           scalar   COM              17362                             
 KMSGGP                     Scalar 17210    I(4)            4           scalar   COM              17321                             
 KNTALL                     Local  17219    I(4)            4           scalar                    17219,17307,17423                 
 KNTGPS                     Scalar 17210    I(4)            4           scalar   COM              17413                             
 KOUNG                      Local  17199    I(4)            4     1     6                         17222,17406,17416                 
 KOUNT                      Scalar 17205    I(4)            4           scalar   COM              17221,17396,17403,17413           
 KSKPGP                     Scalar 17210    I(4)            4           scalar   COM              17237                             
 KT45GP                     Scalar 17211    I(4)            4           scalar   COM              17339                             
 KTGNSS                     Scalar 17211    I(4)            4           scalar   COM              17351                             
 KTIMGP                     Scalar 17210    I(4)            4           scalar   COM              17384                             
 L                          Local  17306    I(4)            4           scalar                    17306,17358,17364,17369,17393,1739
                                                                                                  4                                 
 MAXOBS                     Param  17194    I(4)            4           scalar                    17199,17204                       
 MDATE                      Local  17199    I(4)            4     1     4                         17259,17260,17261,17262,17263     
 MOD                        Func   17260                                scalar                    17260,17261,17262,17334           
 MP_PROCESS                 Scalar 17205    I(4)            4           scalar   COM                                                
 MXBLVL                     Param  17193    I(4)            4           scalar                    17206                             
 MXWRDH                     Param  17192    I(4)            4           scalar                    17208                             
 NFILE                      Scalar 17203    I(4)            4           scalar   COM              17223,17250,17256,17293,17414     
 NINT                       Func   17310                                scalar                    17310,17334                       
 NOBS3                      Scalar 17206    I(4)            4     1     7        COM              17247                             
 NUMOBS2                    Param  17195    I(4)            4           scalar                    17206                             
 OBS2                       Scalar 17206    R(4)            4     1     43       COM              17245                             
 OBS3                       Scalar 17206    R(4)            4     3     8925     COM              17246                             
 OBS8_8                     Scalar 17202    R(8)            8     1     2        COM              17248,17251                       
 PHIIPW                     Local  17201    R(4)            4     1     7                         17216,17310                       
 PMAND                      Scalar 17204    R(4)            4     1     23       COM                                                
 PRSS                       Scalar 17212    R(4)            4           scalar   COM              17390,17394                       
 PWSWCH                     Common 17209                                24                                                          
 PWT                        Scalar 17209    R(4)            4     1     5        COM              17242,17393                       
 RDATA                      Scalar 17204    R(4)            4     1     3500     COM              17250,17310,17335,17358,17359,1736
                                                                                                  4,17365,17369,17370,17393,17394   
 RDATA2                     Scalar 17206    R(4)            4     1     25       COM              17249,17250                       
 RPTHDR                     Common 17208                                88                                                          
 RPTLBL                     Subr   17326                                                          17326                             
 SFCBFR                     Common 17212                                8                                                           
 SKGNSS                     Scalar 17198    L(4)            4           scalar   COM              17279,17347                       
 SKGP45                     Scalar 17197    L(4)            4           scalar   COM              17333                             
 SKPSUB                     Common 17213                                205824                                                      
 STNID                      Scalar 17196    CHAR            8           scalar   COM              17250,17335,17347,17359,17365,1737
                                                                                                  0                                 

Page 417         Source Listing                  GETGPSIPW
2017-04-18 11:09 Symbol Table                    prepdata.f

 Name                       Object Declared Type            Bytes Dimen Elements Attributes       References                        
                                                                                                                                    
 SUBSET_D                   Scalar 17196    CHAR            8           scalar   COM              17251,17279,17333,17347           
 SUBSKP                     Scalar 17213    R(4)            4     2     51456    COM              17251                             
 TIMCHK                     Subr   17382                                                          17382                             
 TIMWIN_E                   Local  17380    R(4)            4           scalar                    17380,17382                       
 TIMWIN_L                   Local  17381    R(4)            4           scalar                    17381,17382                       
 UNITNO                     Common 17203                                116                                                         
 W3UNPKB7                   Subr   17250                                                          17250                             
 WRMISS                     Scalar 17205    R(4)            4           scalar   COM                                                
 XMISS                      Local  17217    R(4)            4           scalar                    17217,17242,17390,17394           
 YMISS                      Local  17216    R(4)            4           scalar                    17216,17358                       

Page 418         Source Listing                  GETGPSIPW
2017-04-18 11:09                                 prepdata.f

  17322 C-----------------------------------------------------------------------
  17323 C CALL SUBR. 'RPTLBL' TO STORE REPORT HEADER INTO HDR(4),HDR(5),HDR(7),
  17324 C                          HDR(9)-HDR(15), ALAT_8, ALON_8
  17325 C-----------------------------------------------------------------------
  17326       CALL RPTLBL(CYCLET)
  17327 C-----------------------------------------------------------------------
  17328 C IF REPORT HAS SUBSET NC012003 AND SKGP45 = TRUE, CHECK TO SEE IF THIS
  17329 C  REPORT SHOULD BE SKIPPED BASED ON ITS OBSERVATION TIME (ALL REPORTS
  17330 C  WITH OBS TIME MINUTES GREATER THAN 30 ARE SKIPPED, ASSUMPTION IS THAT
  17331 C  xx:45 REPORTS ARE CONSIDERED TO BE OF POORER QUALITY THAN xx:15
  17332 C  REPORTS)
  17333       IF(SKGP45 .and. SUBSET_d.EQ.'NC012003') THEN
  17334          IF(MOD(NINT(HDR(13)*100.),100).GT.50)  THEN
  17335             PRINT 9997, STNID,RDATA(1),RDATA(2),HDR(13)
  17336  9997 FORMAT(' * * TOTAL REPORT TOSSED- STNID = ',A8,' AT LAT = ',F6.2,
  17337      $ ' N  LON = ',F7.2,' E, TIME',F11.5,'UTC -- OBS TIME MINUTES > ',
  17338      $ '30')
  17339             KT45GP = KT45GP + 1
  17340             GO TO 1410
  17341          END IF
  17342       END IF
  17343 
  17344 C IF REPORT HAS SUBSET NC012004 AND SKGNSS = TRUE, SKIP IT IF NOT FROM
  17345 C  U.S.-BASED ENI (BASED ON CHARACTERS 5-8 OF REPORT ID NOT BEING
  17346 C  "GPSS") - GSI MAY NOT BE ABLE TO HANDLE THESE PROPERLY AT THIS TIME
  17347       if(SKGNSS.and.SUBSET_d.eq.'NC012004'.and.stnid(5:8).ne.'GPSS')then
  17348 ccccc    PRINT 9990, STNID,RDATA(1),RDATA(2),HDR(13)
  17349 c9990 FORMAT(' * * TOTAL REPORT TOSSED- STNID = ',A8,' AT LAT = ',F6.2,
  17350 ccccc$' N  LON = ',F7.2,' E, TIME',F11.5,'UTC -- NON-ENI PROVIDER')
  17351          KTGNSS = KTGNSS + 1
  17352          GO TO 1410
  17353       end if
  17354 
  17355 C SKIP REPORT IF PRECIP. WATER IS MISSING OR NEGATIVE, or zero
  17356 C  (GSI may have problems; this may be updated once ZTD is used by GSI
  17357 C   since many rpts outside U.S. seems to have missing PW but valid ZTD)
  17358       IF(RDATA(L+3).GE.YMISS)  THEN
  17359          PRINT 9987, STNID,RDATA(1),RDATA(2),HDR(13)
  17360  9987 FORMAT(' * * TOTAL REPORT TOSSED- STNID = ',A8,' AT LAT = ',F6.2,
  17361      $ ' N  LON = ',F7.2,' E, TIME',F11.5,'UTC -- INPUT PWATER MISSING')
  17362          KMISGP = KMISGP + 1
  17363          GO TO 1410
  17364       ELSE  IF(RDATA(L+3).LT.0.)  THEN
  17365          PRINT 9988, STNID,RDATA(1),RDATA(2),HDR(13)
  17366  9988 FORMAT(' * * TOTAL REPORT TOSSED- STNID = ',A8,' AT LAT = ',F6.2,
  17367      $' N  LON = ',F7.2,' E, TIME',F11.5,'UTC -- INPUT PWATER NEGATIVE')
  17368          GO TO 1410
  17369       ELSE  IF(RDATA(L+3).eq.0.)  THEN
  17370          PRINT 9989, STNID,RDATA(1),RDATA(2),HDR(13)
  17371  9989 FORMAT(' * * TOTAL REPORT TOSSED- STNID = ',A8,' AT LAT = ',F6.2,
  17372      $' N  LON = ',F7.2,' E, TIME',F11.5,'UTC -- INPUT PWATER ZERO')
  17373          GO TO 1410
  17374       END IF
  17375 
  17376 C-----------------------------------------------------------------------
  17377 C        CALL SUBR. 'TIMCHK' TO CHECK IF REPORT IS W/I PROPER
  17378 C              TIME WINDOW OF CYCLE TIME (IER =1 TOSS RPT)

Page 419         Source Listing                  GETGPSIPW
2017-04-18 11:09                                 prepdata.f

  17379 C-----------------------------------------------------------------------
  17380       TIMWIN_e = -GWINDO * .01
  17381       TIMWIN_l =  GWINDO * .01
  17382       CALL TIMCHK(HDR(4),TIMWIN_e,TIMWIN_l,IER)
  17383       IF(IER.EQ.1)  THEN
  17384          KTIMGP = KTIMGP + 1
  17385          GO TO 1410
  17386       END IF
  17387 C-----------------------------------------------------------------------
  17388 C UNPACKED REPORT HAS SUCCESSFULLY PASSED ALL CHECKS -- CONTINUE ON
  17389 C-----------------------------------------------------------------------
  17390       PRSS = XMISS
  17391 C TPW (PWT(1) STORED HERE IN UNITS OF MM (TO 10**1 PRECISION)
  17392       IQMPW = 2 ! PREPBUFR tbl value here is always default
  17393       PWT(1) = RDATA(L+3)
  17394       IF(RDATA(L).LT.XMISS)  PRSS = RDATA(L)
  17395 cfix? IF(RDATA(L).LT.YMISS)  PRSS = RDATA(L)
  17396       KOUNT = KOUNT + 1
  17397 C CALL GETPWATER TO PROCESS THE PWATER REPORT (GETS R. TYPE 153)
  17398 C  (ZTD WILL BE ENCODED INTO PREPBUFR DIRECTLY FROM RDATA ARRAY LATER
  17399 C   IN SUBR. FIZZ01/W3FIZZ)
  17400       CALL GETPWATER(3,0,IERF)
  17401       IF(IERF.NE.0)  THEN
  17402 C PRECIPITABLE WATER REPORT NOT STORED
  17403          KOUNT = KOUNT - 1
  17404          GO TO 1410
  17405       END IF
  17406       KOUNG(IBAND) = KOUNG(IBAND) + 1
  17407 C+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
  17408 C GO BACK AND DECODE NEXT REPORT
  17409       GO TO 1400
  17410 C-----------------------------------------------------------------------
  17411   110 CONTINUE
  17412 C HIT END-OF-FILE - ALL DONE
  17413       KNTGPS = KOUNT
  17414       REWIND NFILE
  17415 C BRIEFLY SUMMARIZE
  17416       PRINT 881, (KOUNG(I),I=1,6)
  17417   881 FORMAT(/38X,'***** TABLE DETAILING THE USE OF GPS-IPW DATUM ',
  17418      $ '*****'//,20X,86('_')/43X,'||',19X,'COUNTS',
  17419      $ ' BY LATITUDE BAND',17X,'||'/43X,'|| ',
  17420      $ '90S-70S | 70S-20S | 20S-EQ  |  EQ-20N | 20N-70N | 70N-90N ||'
  17421      $ /43X,'||',6(9X,'|'),'|'/21X,'TOTAL PRECIP. WATER   ||',6(I6,3X,
  17422      $ '|'),'|'/20X,86('_')/)
  17423       PRINT 950, KNTALL
  17424   950 FORMAT(13X,'===>  A TOTAL OF ',I6,'  REPORTS WERE DECODED, ',
  17425      $ 'WHETHER KEPT OR SKIPPED  <===',/)
  17426       RETURN
  17427       END
  17428 C$$$  SUBPROGRAM DOCUMENTATION BLOCK
  17429 C
  17430 C SUBPROGRAM:    W3FIZZ
  17431 C   PRGMMR: Keyser           ORG: EMC        DATE: 2016-11-30
  17432 C
  17433 C ABSTRACT: INTERFACES BETWEEN A PREPROCESSED REPORT (IN "HDR/MOBS
  17434 C   IPMSL/PWAT/xRAD/REQV/CLTOP" ARRAYS) AND THE GENERALIZED BUFR
  17435 C   ENCODING PROGRAMS WRITTEN BY JACK WOOLLEN OF GSC.  EACH REPORT IS

Page 420         Source Listing                  GETGPSIPW
2017-04-18 11:09                                 prepdata.f

  17436 C   WRITTEN TO A PREPBUFR DATA SET.
  17437 C
  17438 C PROGRAM HISTORY LOG:
  17439 C 1993-09-14  J. WOOLLEN (GENERAL SCIENCES CORPORATION)
  17440 C 1993-11-02  D. A. KEYSER -- STREAMLINED CODE; MORE INPUTS PASSED VIA
  17441 C    COMMON BLOCKS; ORIGINAL TABLE A ENTRY 'PREPOB' BROKEN INTO
  17442 C    SEPARATE TABLE A ENTRIES BASED ON DATA TYPES; INPUT MNEMONIC
  17443 C    STRINGS SPECIFIC TO TABLE A ENTRY
  17444 C 1993-12-21  D. A. KEYSER -- ADDED CALL TO SUBROUTINE FIZZ02 TO MAKE
  17445 C    AN OLD 16-BIT PREPDA DATA SET FROM NOBS ARRAY
  17446 C 1994-08-11  D. A. KEYSER -- IF, UPON LAST CALL TO SUBR., ABSOLUTELY
  17447 C    NO DATA WERE PROCESSED THEN AN EMPTY 'ADPUPA' TABLE A ENTRY MSG IS
  17448 C    OPENED SO THE DATE IS AVAILABLE ON D-SET; ELEVATION AND REPORT
  17449 C    SEQUENCE NUMBER ENCODED INTO REPORT HEADER (ALONG W/ OTHER DATA
  17450 C    USED BY REANALYSIS PREPDATA ONLY); VIRTUAL/REPORTED/DEWPOINT
  17451 C    TEMP., WIND DIRECTION AND WIND SPEED ALL ENCODED INTO REPORT LVL;
  17452 C    RECEIPT TIME, REPORT SUB-TYPE AND QCACFT WIND SPEED INCR. Q.M.
  17453 C    (CONV'L/AMDAR AIRCFT WIND REPORTS ONLY) ENCODED INTO REPORT HEADER
  17454 C 1995-07-12  D. A. KEYSER -- CALLS BUFR.O SUBROUTINE 'UFBQMD' TO
  17455 C    GET PROGRAM CODE FOR PREPDATA; MNEMONICS ADDED TO ENCODE PROGRAM
  17456 C    CODE INTO BUFR/PREPDA FOR ALL OBS. TYPES; MNEMONICS ADDED TO
  17457 C    ENCODE 7-CHN SSM/I BRIGHT. TEMPS INTO BUFR/PREPDA; MNEMONICS ADDED
  17458 C    ENCODE GOES PRECIP. WATER IN FOUR LAYERS INTO BUFR/PREPDA; ADDED
  17459 C    OUTPUT ARG. 'IER' (RETURN CODE, SEE BELOW); MNEMONICS ADDED ENCODE
  17460 C    VAD (NEXRAD) WINDS INTO BUFR/PREPDA; MNEMONIC 'TSB' (REPORT SUB-
  17461 C    TYPE) NOW USED TO HOLD INDICATOR FOR MISSING PHASE OF FLIGHT FOR
  17462 C    AIRCRAFT AMDAR REPORTS
  17463 C 1996-09-03  D. A. KEYSER -- PROCESSING OF TOVS RADIANCES PARTIALLY
  17464 C    DONE (SWITCH "TOVRAD")
  17465 C 1996-10-24  D. A. KEYSER -- LOGIC ADDED TO ENCODE TOVS RADIANCES
  17466 C    AND OTHER RELATED INFORMATION INTO PREPBUFR FILE, NEW MEMONICS
  17467 C    ADDED TO ACCOMPLISH THIS; N-LIST SWITCHES "TOVRAD" AND "TOVRTV"
  17468 C    ADDED TO PROCESS RADIANCES AND RETRIEVALS RESP.; HARDWIRED TO NO
  17469 C    LONGER WRITE TO SEQ'L. 16-BIT PREPDA DATA SET; ADDED LOGIC TO
  17470 C    ENCODE ERS SCATTEROMETER WIND REPORTS (R.TYPE=286) IN PREPBUFR D-
  17471 C    SET (USED TO BE APPENDED LATER); CORRECTED ERROR IN ENCODING OF
  17472 C    INITIAL VALUES FOR HEADER MNEMONICS "RQM", "DUP", "PRG", "SRC",
  17473 C    AND "RUD" (ONLY USED FOR REANALYSIS VERSION)
  17474 C 1997-05-01  D. A. KEYSER -- REASON CODES ENCODED INTO PREPBUFR
  17475 C 1997-07-02  D. A. KEYSER -- ADDED LOGIC TO ENCODE GOES RADIANCES
  17476 C    INTO PREPBUFR FILE, USES SAME MNEMONICS AS TOVS RADIANCES (NEW N-
  17477 C    LIST SWITCH "GOESRD" ADDED TO SELECT PROCESSING OF GOES RADIANCES)
  17478 C 1997-07-22  D. A. KEYSER -- ESTABLISHED NEW BUFR TABLE A MESSAGE
  17479 C    TYPE "GOESND" TO HOLD GOES RADIANCES/RETRIEVALS (BEFORE THEY WERE
  17480 C    COMBINED WITH TOVS IN "SATEMP")
  17481 C 1997-09-18  D. A. KEYSER -- CAN ENCODE ALTIM. SETTING IN PREPBUFR
  17482 C    WHEN PROCESSING SFC LAND DATA; ENCODES SKIN TEMP., CLOUD AMT.,
  17483 C    SOLAR ZENITH ANG., AND SAT. ZENITH ANG. IN PREPBUFR WHEN
  17484 C    PROCESSING GOES RADIANCES
  17485 C 1997-10-06  D. A. KEYSER -- ENCODES FOV# AS 'ACAV' INTO PREPBUFR FOR
  17486 C    GOES REPORTS
  17487 C 1998-06-15  D. A. KEYSER -- ADDED CALL TO PREVENTS (MERGED IN PREVENTS
  17488 C    PROGRAM, NOW A SUBR.); REMOVED OBSOLETE R.H. MNEMONICS & 'SFCBOG'
  17489 C    TABLE A ENTRY; STREAMLINED TO NO LONGER SEPARATE SINGLE- & MULTI-
  17490 C    LVL TABLE A TYPES; ENCODES SOLAR & IR RAD. CORRECTION INDICATOR
  17491 C    INTO PREPBUFR FILE AS MNEMONIC 'SIRC' (FOR "ADPUPA" TYPES W/ VALID
  17492 C    INSTR. TYPE)

Page 421         Source Listing                  GETGPSIPW
2017-04-18 11:09                                 prepdata.f

  17493 C 1998-12-11  D. A. KEYSER -- NO LONGER ENCODES ERS SCATTEROMETER
  17494 C    INCIDENT ANGLE, AZIMUTH ANGLE, BACKSCATTER AND ERROR ESTIMATE IN
  17495 C    PREPBUFR FILE (WERE ALWAYS SET TO ZERO AND NEVER USED) - SAVES A
  17496 C    LOT OF SPACE IN THE PREPBUFR FILES
  17497 C 1999-08-04  D. A. KEYSER -- REMOVED ENCODING OF 'RQM', 'DUP', 'PRG',
  17498 C    'SRC', 'RUD' AS THEY WERE ALWAYS MISSING (REANALYSIS RELATED) AND
  17499 C    WASTED LOTS OF SPACE; ADDED ENCODING OF PHASE OF FLIGHT ('POAF')
  17500 C    FOR ALL ACFT TYPES AND DEGREE OF TURBULENCE (DGOT) FOR NON-MDCRS
  17501 C    ACFT TYPES; ADDED PROCESSING OF MDCRS MOISTURE DATA; RADIOSONDE
  17502 C    BALLOON DRIFT LAT/LON ON EACH LEVEL NOW ENCODED INTO PREPBUFR FILE
  17503 C    WITH MNEMONICS "YDR" AND "XDR"; REPLACED CALL TO SUBROUTINE
  17504 C    "PREVENTS" WITH CALL TO W3LIB ROUTINE "GBLEVENTS"
  17505 C 2000-02-17 D. A. KEYSER -- ADDED ENCODING OF NESDIS RECURSIVE FILTER
  17506 C    FLAG ('RFFL') FOR NESDIS (GOES) SATWND TYPES; UPDATED DEL-TIME ON
  17507 C    UPPER-AIR RAOB AND PIBAL LVLS (ALREADY CALC. BASED ON BALLOON
  17508 C    DRIFT) AND ENCODED INTO PREPBUFR FILE W/ MNEMONIC "HRDR"; ADDED
  17509 C    MNEMONICS "RPT" (ORIG. OBS. TIME) AND "TCOR" (IND. FOR CORRECTED
  17510 C    OBS. TIME IN"DHR") ENCODED INTO PREPBUFR FILE
  17511 C 2000-09-22  D. A. KEYSER -- ADDED THE PROCESSING OF QUIKSCAT SCATTER-
  17512 C     OMETER WINDS; ADDED ABILITY TO APPEND DATA TO AN EXISTING
  17513 C     PREPBUFR FILE VIA NEW N-LIST SWITCH "APPEND" (WHEN APPENDING,
  17514 C     THE INTERNAL BUFR MNEM. TBL. IN THE EXISTING PREPBUFR FILE IS
  17515 C     USED, NEW R.C.=30 VALID ONLY WHEN APPEND=T AND EXISTING FILE DATE
  17516 C     DOES NOT MATCH EXPECTED (PRODUCTION) DATE
  17517 C 2000-12-05  D. A. KEYSER -- METARS W/ PSTN CALC. FROM ALTIMETER GET
  17518 C     NEW R.T. 187/287; METARS W/ MISSING WDIR & WSPD .LE. 3M/SEC ENCODE
  17519 C     WSPD OBS/QM IN NEW MNEM. "SOB" AND "SQM"
  17520 C 2001-04-06  D. A. KEYSER -- NOW PROCESSES SSM/I RAIN RATE UNDER R.TYP
  17521 C     150; FOR ALL SATELLITE TYPES EXCEPT SSM/I SUPEROBED PRODUCTS, NOW
  17522 C     ENCODES SATELLITE ID AS "SAID" IN PREPBUFR FILE; ENCODES THE 4
  17523 C     MDCRS TURBULENCE INDECES INTO THE PREPBUFR FILE UNDER MNEMONICS
  17524 C     "TRBX10", "TRBX21", "TRBX32" AND "TRBX43"; ENCODES SURFACE
  17525 C     PRESSURE INTO PREPBUFR FILE UNDER MNEMONIC "PRSS" FOR GOES PW
  17526 C     RETR. REPORTS
  17527 C 2001-06-19  D. A. KEYSER -- CAN NOW PROCESS GOES 1x1 FOV CLOUD TOP
  17528 C     REPORTS INTO PREPBUFR FILE UNDER R.T. 151 (MNEMONICS ARE "CDTP"/
  17529 C     CLOUD TOP PRESSURE, "TOCC"/CLOUD COVER, "GCDTT"/CLOUD TOP TEMP.)
  17530 C 2001-10-10  D. A. KEYSER -- PROCESS NUMBER FROM THE MPI RUN (READ IN
  17531 C     VIA NAMELIST IN STDIN) ENCODED IN PREPBUFR UNDER MNEMONIC
  17532 C     "PROCN"; MODIFIED TO NOW PASS TWO SPANNING GLOBAL SIGMA GUESS
  17533 C     FILES INTO W3LIB ROUTINE GBLEVENTS IN SITUATIONS WHERE THE CENTER
  17534 C     DATE FOR THE PREPBUFR FILE HAS AN HOUR THAT IS NOT A MULTIPLE OF
  17535 C     3 (SEE 2001-10-10 CHANGES TO GBLEVENTS)
  17536 C 2002-01-28  D. A. KEYSER -- ENCODES PRECISION OF TEMP. OBS. INTO
  17537 C     PREPBUFR FILE UNDER MNEMONIC "PCAT" FOR MESSAGE TYPES "AIRCAR"
  17538 C     AND "AIRCFT" (ONLY AVAIL. FOR AMDAR AND MDCRS)
  17539 C 2003-07-10  D. A. KEYSER -- ENCODES "RESTRICTIONS ON
  17540 C     REDISTRIBUTION" (BUFR F.T. 0-35-200) AND "EXPIRATION OF
  17541 C     RESTRICTIONS ON REDISTRIBUTION" (HRS) INTO PREPBUFR FILE UNDER
  17542 C     NEW MNEMONICS "RSRD" AND "EXPRSRD", RESP.
  17543 C 2004-09-09  D. A. KEYSER -- ADDED PROCESSING OF MESONET DATA, READ
  17544 C     FROM "MSONET" DUMP FILE DUMP R. TYPE 540, GET PREPBUFR R. TYPE
  17545 C     188/288, PROCESSED INTO PREPBUFR FILE UNDER NEW TBL A ENTRY
  17546 C     "MSONET" {INCL, ENCODING OF ID STRINGS FOR PROVIDER (MNEMONIC
  17547 C     "PRVSTG") AND SUB-PROVIDER (MNEMONIC "SPRVSTG")}; ADDED
  17548 C     PROCESSING OF GPS-IPW DATA, READ FROM "GPSIPW" DUMP FILE DUMP R.
  17549 C     TYPE 74, GET PREPBUFR R. TYPE 153, PROCESSED BY NEW SUBR.

Page 422         Source Listing                  GETGPSIPW
2017-04-18 11:09                                 prepdata.f

  17550 C     "GETGPSIPW" INTO PREPBUFR FILE UNDER NEW TBL A ENTRY "GPSIPW";
  17551 C     ADDED PROCESSING OF NPN AND CAP RASS DATA READ FROM "RASSDA" DUMP
  17552 C     FILE IN NEW DATA LVL CAT. 15, DUMP R. TYPE 77, GET PREPBUFR R.
  17553 C     TYPE 126, PROCESSED INTO PREPBUFR FILE UNDER NEW TBL A ENTRY
  17554 C     "RASSDA"; NOW ENCODES MDCRS FLIGHT NUMBER (MNEMONIC "ACID") INTO
  17555 C     MDCRS REPORTS; ADDED PROCESSING OF COOPERATIVE AGENCY AND JAPANESE
  17556 C     WIND PROFILERS NOW POSSIBLY INCL. IN "PROFLR" DUMP FILE DUMP R.
  17557 C     TYPES 75 AND 76, RESP., GETS PREPBUFR R. TYPES 227 AND 228, RESP.,
  17558 C     PROCESSED INTO PREPBUFR FILE UNDER EXISTING TBL A ENTRY "PROFLR",
  17559 C     WIND PROFILER RPTS ORIGINATING FROM PILOT (PIBAL) BULLETINS NOW
  17560 C     GET A UNIQUE PREPBUFR R. TYPE OF 229; ADDED LOGIC (CURRENTLY NOT
  17561 C     INVOKED) TO SEPARATE METAR REPORTS INTO THEIR OWN MESSAGES IN THE
  17562 C     ADPSFC MESSAGE TYPE, BUT WITH A UNIQUE MESSAGE SUB-TYPE OF 7 (SEE
  17563 C     COMMENTS IN SUBROUTINE); SST AND SENSIBLE WEATHER ELEMENTS (IN
  17564 C     OBS2 AND OBS3 ARRAYS RETURNED FROM IW3UNPBF) ENCODED INTO PREPBUFR
  17565 C     FILE (MANY NEW MNEMONICS) BUT ONLY IN APPROPRIATE MESSAGE TYPES
  17566 C 2007-09-14  D. A. KEYSER -- MODIFIED TO ENCODE NEW PARAMTERS "TRBX"
  17567 C     AND "ROLF" INTO PREPBUFR FILE FOR TAMDAR AIRCRAFT REPORTS;
  17568 C     REPLACED CALL TO BUFRLIB ROUTINE OVRBS1 WITH CALL TO BUFRLIB
  17569 C     ROUTINE PKBS1 (OVRBS1 OBSOLETE WITH 1/31/2006 VERSION OF BUFRLIB)
  17570 C     (THIS IS CURRENTLY NEVER CALLED IN PREPDATA); INCREASED SIZE OF
  17571 C     COMMON BLOCK /BITBUF/ ARRAYS IBAY AND MBAY FROM (5000) AND
  17572 C     (5000,32) TO (12500) AND (12500,32), RESP. TO MATCH SIZES IN THIS
  17573 C     COMMON BLOCK IN 1/31/2006 VERSION OF BUFRLIB; MODIFIED TO ENCODE
  17574 C     NEW PARAMETERS MRWVC, MRLWC, WSST, MWD10, MWS10, WSEQC1, CHSQ,
  17575 C     PHER, SPDE, SSTE, CLDE AND VPRE IN PREPBUFR FILE FOR WINDSAT
  17576 C     SCATTEROMETER REPORTS, UNDER NEW MESSAGE TYPE "WDSATR"; MODIFIED
  17577 C     TO HANDLE RETURN OF NEW ARGUMENT "RDATA2" FROM CALLS TO W3UNPKB7
  17578 C     [1-DIM 21-WORD ARRAY WHICH HOLDS ADDITIONAL VALUES DECODED
  17579 C     DIRECTLY FROM BUFR (AND NOT IN "RDATA" ARRAY), FOR SOME
  17580 C     PARAMETERS REPLACING WHAT HAD BEEN RETURNED IN "RDATA" ARRAY (IN
  17581 C     THE HEADER)];  ADDED ENCODING OF PERCENT CONFIDENCE BASED ON -
  17582 C     EUMETSAT QUALITY INDEX WITH FORECAST CONSISTENCY TEST (MNEMONIC
  17583 C     "QIFY"), EUMETSAT QUALITY INDEX WITHOUT FORECAST CONSISTENCY TEST
  17584 C     (MNEMONIC "QIFN") AND NESDIS EXPECTED ERROR (MNEMONIC "EEQF") FOR
  17585 C     SATWND TYPES; EXPANDED ARRAYS OBS3 FROM (5,255,5) TO (5,255,7)
  17586 C     AND NOBS3 FROM (5) TO (7) (RETURNED OUT OF CALL TO IW3UNPBF) TO
  17587 C     ACCOUNT FOR PROCESSING OF ADDITIONAL MULTIPLE-LEVEL SENSIBLE
  17588 C     WEATHER ELEMENTS CONTAINING AIRFRAME ICING (RECCOS, PIREPS,
  17589 C     EAMDAR, CANADIAN AMDAR, TAMDAR), ENCODED INTO PREPBUFR FILE IN
  17590 C     NEW MNEMONICS "AFIC", "HBOI" AND "HTOI" (TYPE OF ICING, HEIGHT OF
  17591 C     BOTTOM AND TOP OF ICING LAYER), AND DEGREE OF TURBULENCE (RECCOS
  17592 C     AND ALL AIRCRAFT), ENCODED INTO PREPBUFR FILE IN EXISTING
  17593 C     MNEMONIC "DGOT" (DEGREE OF TURBULENCE) AND NEW MNEMONICS "HBOT"
  17594 C     AND "HTOT" (HEIGHT OF BOTTOM AND TOP OF TURBULENCE LAYER); ADDED
  17595 C     NEW N-LIST SWITCH WRMISS (DEF=T) - IF TRUE, REPORTS WITH NO VALID
  17596 C     OBS (WIND/TEMP) LEVELS AND NO VALID BRIT. TEMP. CHANNELS, BUT
  17597 C     WITH OTHER ANCILLARY INFO (E.G., SENSIBLE WX ELEMENTS) ARE NOW
  17598 C     ENCODED INTO PREPBUFR FILE - CURRENTLY APPLIES ONLY TO AIRCRAFT
  17599 C     REPORTS (MAINLY PIREPS WITH TURB, ICING, CLOUD BUT NO TEMP OR
  17600 C     WIND) - BEFORE SUCH OBS WITHOUT ANY DATA USED BY ASSIMILATION
  17601 C     WERE ALWAYS SKIPPED
  17602 C 2008-09-25  D. A. KEYSER -- CAN NOW PROCESS ASCAT SCATTEROMETER
  17603 C     WIND DATA READING FROM REPROCESSED DUMP FILE IN UNIT 39, ENCODING
  17604 C     INTO NEW PREPBUFR REPORT TYPE 290 UNDER NEW PREPBUFR MESSAGE TYPE
  17605 C     "ASCATW" VIA NEW NAMELIST SWITCHES "JPASCD" (DEF=6*9999) AND
  17606 C     IAWNDO (DEF=-3,+3) (1-DIM ARRAY RDATA2 RETURNED FROM W3UNPKB7

Page 423         Source Listing                  GETGPSIPW
2017-04-18 11:09                                 prepdata.f

  17607 C     INCREASED FROM 21 TO 24 WORDS TO HANDLE NEW ANCILLARY INFO
  17608 C     ENCODED WITH ASCAT REPORTS); CHANGES TO PREPBUFR ENCODING IN
  17609 C     PREPARATION FOR FUTURE DOWNSTREAM NRL AIRCRAFT Q.C. MODULE
  17610 C     (REPLACING CURRENT DOWNSTREAM PREPACQC AND ACARSQC MODULES) WHICH
  17611 C     WILL REPLICATE LEVEL DATA IN ITS GENERATION OF "PROFILES": SOME
  17612 C     MNEMONICS THAT WERE IN HEADER MOVED TO LEVEL INFO, CALL TO
  17613 C     BUFRLIB ROUTINE DRFINI TO ALLOW FOR POSSIBLE NESTED REPLICATION
  17614 C     OF LEVEL INFO SEQUENCES; MOISTURE QUALITY (CODE TABLE) FOR MDCRS
  17615 C     REPORTS, ENCODED INTO PREPBUFR FILE (MNEMONIC MSTQ) FOR USE BY
  17616 C     FUTURE DOWNSTREAM NRL AIRCRAFT Q.C. MODULE
  17617 C 2014-04-25  D. A. Keyser -- Satellite zenith angle (mnemonic SAZA,
  17618 C     degrees) encoded into PREPBUFR file for all SATWND types for use
  17619 C     by GSI (to possibly screen SATWNDS with high SAZA values).
  17620 C 2014-04-25  S. Melchior  --
  17621 C          - Recognizes new PREPBUFR report types 192/292 (SYNOP),
  17622 C     193/293 (METAR), 194/294 (marine) and 195/295 (mesonet) for
  17623 C     surface reports that have a missing pstn (only present if
  17624 C     namelist switch NPKRPT is TRUE for the surface type in question).
  17625 C          - Removed encoding of "SQM" (wind speed quality mark) for
  17626 C     certain METAR reports which had encoded "SOB" as all surface
  17627 C     reports now encode wind qm as "WQM" regardless of whether or not
  17628 C     they also encode DDO, SOB, UOB or VOB.
  17629 C          - Added new mnemonic "PMIN" (mean sea-level pressure
  17630 C     indicator) which is encoded with a value of zero for all surface
  17631 C     reports with an observed mean sea-level pressure encoded in
  17632 C     "PMO".  "PMIN" will be encoded with a value of 1 in w3emc routine
  17633 C     GBLEVENTS for cases where a mean sea-level pressure is derived
  17634 C     (see docblock in GBLEVENTS for more information).
  17635 C 2014-07-10  D. A. Keyser -- Added encoding of "DFQ" (wind dir/speed
  17636 C     quality mark) for all types that aleady encode "DDO" (wind dir)
  17637 C     and either "FFO" (wind speed kts) or "SOB" (wind speed m/s)
  17638 C     {"DFQ" will now be encoded with overall wind quality mark in both
  17639 C     cases when "UOB" and "VOB" are encoded (then "DFQ" same as "WQM")
  17640 C     and cases when, for surface reports, "UOB" and "VOB" are not
  17641 C     encoded because either dir or speed is missing}.  Prior to this,
  17642 C     "DFQ" was always missing and the overall wind quality mark was
  17643 C     always encoded in "WQM" even when, for surface reports, "UOB" and
  17644 C     "VOB" were missing but either wind dir or speed was not.  Now,
  17645 C     the entire "W__EVENT" sequence "[UOB VOB WQM WPC WRC]" is skipped
  17646 C     for surface reports when "UOB" and "VOB" are both missing.
  17647 C 2016-01-28 JWhiting - Added generation of new CEILING field in METAR
  17648 C     reports, derived from existing CLAM & HOCB values.
  17649 C 2016-08-15 JWhiting -- For all GPS data streams (i.e., NC012003-004),
  17650 C     encode into PREPBUFR file zenith total delay (when present) and
  17651 C     its error, represented by "atmospheric path delay in satellite
  17652 C     signal" (mnemonic APDS) (m) and "error in atmospheric path delay
  17653 C     in satellite signal" (m) (mnemonic APDE), resp., in association
  17654 C     with hardwired azimuth angle (mnemonic BEARAZ) of 0.0 (deg) and
  17655 C     hardwired elevation angle (mnemonic ELEV) of 90.0 (deg).
  17656 C 2016-11-25  D. A. Keyser --
  17657 C      - Encodes instantaneous altitude rate (IALR) into PREPBUFR file
  17658 C        for TAMDARB reports in report type 134/234 (returned from c.f.
  17659 C        932 in call to IW3UNPBF).
  17660 C      - Flight number (returned from header reserve character word 2 in
  17661 C        call to IW3UNPBF) is now encoded into PREPBUFR file as ACID for
  17662 C        AMDARB reports (if non-missing).
  17663 C 2016-11-30  D. A. Keyser --

Page 424         Source Listing                  GETGPSIPW
2017-04-18 11:09                                 prepdata.f

  17664 C      - Diagnostic output print statements formatted to accommodate
  17665 C        increased precision now in latitude and longitude.
  17666 C         - Replace machine length lat/lon {HDR(3), HDR(2)} with R*8
  17667 C           lat/lon (ALAT_8, ALON_8) in print statements.
  17668 C        BENEFIT: Values are now precise to 10**5 degrees.
  17669 C
  17670 C USAGE:    CALL W3FIZZ(IER)
  17671 C   OUTPUT ARGUMENT LIST:
  17672 C     IER      - RETURN CODE (=0 - REPORT ENCODED INTO PREPBUFR
  17673 C              - FILE; =1 - REPORT NOT ENCODED INTO PREPBUFR FILE)
  17674 C
  17675 C   INPUT FILES:
  17676 C     UNIT BB   - FILE CONTAINING PREPBUFR MNEMONIC TABLES A/B/D
  17677 C     (BB IS UNIT NUMBER DEFINED AS IUNIT(2) IN NAMELIST "&PARM")
  17678 C
  17679 C   OUTPUT FILES:
  17680 C     UNIT 06  - STANDARD OUTPUT PRINT
  17681 C     UNIT PP  - PREPBUFR DATA SET
  17682 C              - (WHERE PP IS UNIT NUMBER DEFINED AS IUNIT(16) IN
  17683 C              - NAMELIST "&PARM")
  17684 C
  17685 C REMARKS: CALLED BY MAIN PROGRAM AND SUBROUTINE FILLX.  WHEN INPUT
  17686 C   HDR(3) = IMISS (99999) THIS INDICATES THAT ALL PREPROCESSED REPORTS
  17687 C   HAVE BEEN ENCODED INTO THE PREPBUFR DATA SET.
  17688 C
  17689 C ATTRIBUTES:
  17690 C   LANGUAGE: FORTRAN 90
  17691 C   MACHINE:  NCEP WCOSS
  17692 C
  17693 C$$$
  17694       SUBROUTINE W3FIZZ(IER)
  17695       PARAMETER (MXWRDH = 15)
  17696       PARAMETER (NUMOBS2 = 43)
  17697       PARAMETER (MAXOBS = 3500)
  17698 
  17699 C PARAMETER NAME "MHDRWD"  THROUGHOUT PGM SETS MAXIMUM NO. OF REPORT
  17700 C  HEADER MNEMONICS THAT CAN BE PROCESSED
  17701 C PARAMETER NAME "MOBSWD"  THROUGHOUT PGM SETS MAXIMUM NO. OF REPORT
  17702 C  OBSERVATION MNEMONICS THAT CAN BE PROCESSED
  17703       PARAMETER (MXBLVL = 255, MHDRWD = 29, MOBSWD = 12, MOB2WD = 6)
  17704 C PARAMETER NAME "MQMSWD"  THROUGHOUT PGM SETS MAXIMUM NO. OF REPORT
  17705 C  QUALITY MARKER MNEMONICS THAT CAN BE PROCESSED
  17706       PARAMETER (MQMSWD =  9)
  17707 C PARAMETER NAME "MPGMWD"  THROUGHOUT PGM SETS MAXIMUM NO. OF REPORT
  17708 C  PROGRAM/REASON CODE MNEMONICS THAT CAN BE PROCESSED
  17709       PARAMETER (MPGMWD =  9)
  17710 C PARAMETER NAME "IBTBLA"  THROUGHOUT PGM SETS NUMBER OF PREPBUFR
  17711 C  TABLE-A MESSAGE TYPES
  17712       PARAMETER (IBTBLA = 19)
  17713 
  17714       COMMON/ADP/ISATOB,PMAND(23),RDATA(MAXOBS),IPRINT
  17715       COMMON/FIZZAA/PCODE,IUNITP,NLV,NBT,HDR_8(MHDRWD),
  17716      $ OBS(MOBSWD,MXBLVL),OB2(MOB2WD,MXBLVL),QMS(MQMSWD,MXBLVL),
  17717      $ PGM(MPGMWD,MXBLVL),RSN(MPGMWD,MXBLVL),BTO(2,MXBLVL),RAD(5),
  17718      $ IUNITG(2)
  17719       COMMON/UNITNO/NFILE,IUNIT(28)
  17720       COMMON/XTRHD2/CRES1,CRES2,CBULL

Page 425         Source Listing                  W3FIZZ
2017-04-18 11:09                                 prepdata.f

  17721       COMMON/DATA/DMY3,IDATE(4),IDAT10,MP_PROCESS,WRMISS
  17722       COMMON/RPTHDR/SUBSET_d,STNID,HDR(2:MXWRDH),alon_8,alat_8
  17723       COMMON/PREVSW/PREVEN
  17724       COMMON/APDNSW/APPEND
  17725       COMMON/DIRECT/OBS3(5,MXBLVL,7),OBS2(NUMOBS2),NOBS3(7),RDATA2(25),
  17726      $ obs8_8(2)
  17727 
  17728       COMMON /BUFRLIB_MISSING/BMISS
  17729 
  17730       common /bitbuf/ maxbyt,ibit,ibay(12500),mbyt(32),mbay(12500,32)
  17731       character*8  subset_d_last
  17732       CHARACTER*11 CBULL
  17733       data SUBSET_d_last/'XXXXXXXX'/
  17734       LOGICAL  SEPARATE_METARS
  17735 
  17736 
  17737       LOGICAL  SINGLE(IBTBLA),PREVEN,APPEND,WRMISS
  17738 
  17739       LOGICAL  db_ceiling
  17740 
  17741       DIMENSION  KTYP(100:299),AERS(12)
  17742 
  17743       CHARACTER*4   CTYPE
  17744       CHARACTER*8   SUBSET(IBTBLA),STNID,CHDR,CRES1,CRES2,CPRV(2),CACID,
  17745      $ SUBSET_d
  17746       CHARACTER*47  QMSSTR(IBTBLA),PGMSTR(IBTBLA),RSNSTR(IBTBLA)
  17747       CHARACTER*50  HEADR1,HEADR2,HEADR3
  17748       CHARACTER*55  OBSSTR1(IBTBLA),OBSSTR2(IBTBLA)
  17749 
  17750       REAL(8) HDR_8,OBS_8(MOBSWD,MXBLVL),OB2_8(MOB2WD,MXBLVL),
  17751      $ QMS_8(MQMSWD,MXBLVL),PGM_8(MPGMWD,MXBLVL),RSN_8(MPGMWD,MXBLVL),
  17752      $ BTO_8(2,MXBLVL),RAD_8(5),AERS_8(12),OBS2_8(NUMOBS2),
  17753      $ OBS3_8(5,MXBLVL,7),RPRV_8(2),RACID_8,RDATA2_8(25),obs8_8,
  17754      $ alon_8,alat_8
  17755 
  17756       REAL(8) cldamt_8, cldbas_8
  17757 
  17758       INTEGER  IDATA(MAXOBS)
  17759 
  17760       EQUIVALENCE (CHDR,HDR_8(1)),(CPRV,RPRV_8),(CACID,RACID_8),
  17761      $ (RDATA,IDATA)
  17762 
  17763 C SEE /nwprod/fix/prepobs_prep.bufrtable FOR THE DEFINITION OF THE
  17764 C  MNEMONICS PASSED INTO SUBROUTINE "UFBINT".
  17765 
  17766       SAVE
  17767 
  17768       DATA HEADR1/'SID  XOB YOB DHR NUL TYP T29 TSB ITP ELV SQN SIRC '/
  17769       DATA HEADR2/'NUL   NUL NUL RFFL RPT TCOR NUL  NUL  SAID        '/
  17770       DATA HEADR3/'PROCN NUL NUL NUL  NUL QIFY QIFN EEQF             '/
  17771 
  17772       DATA  OBSSTR1/
  17773        ! PROFLR vvvvv
  17774      $     'POB UOB  VOB  NUL NUL ZOB CAT NUL NUL DDO  FFO  NUL    ',
  17775        ! VADWND vvvvv
  17776      $     'POB UOB  VOB  NUL NUL ZOB CAT NUL NUL DDO  FFO  NUL    ',
  17777        ! ADPUPA vvvvv

Page 426         Source Listing                  W3FIZZ
2017-04-18 11:09                                 prepdata.f

  17778      $     'POB UOB  VOB  TOB QOB ZOB CAT TVO TDO DDO  FFO  XDR    ',
  17779        ! AIRCAR vvvvv
  17780      $     'POB UOB  VOB  TOB QOB ZOB CAT TVO TDO DDO  FFO  TRBX10 ',
  17781        ! AIRCFT vvvvv
  17782      $     'POB UOB  VOB  TOB QOB ZOB CAT TVO TDO DDO  FFO  RCT    ',
  17783        ! SATWND vvvvv
  17784      $     'POB UOB  VOB  TOB NUL ZOB CAT TVO NUL DDO  FFO  NUL    ',
  17785        ! SATEMP vvvvv
  17786      $     'POB NUL  NUL  TOB QOB ZOB CAT TVO TDO NUL  NUL  NUL    ',
  17787        ! SPSSMI vvvvv
  17788      $     'POB UOB  VOB  NUL NUL NUL CAT NUL NUL DDO  FFO  PWO    ',
  17789        ! ADPSFC vvvvv
  17790      $     'POB UOB  VOB  TOB QOB ZOB CAT TVO TDO DDO  SOB  NUL    ',
  17791        ! SFCSHP vvvvv
  17792      $     'POB UOB  VOB  TOB QOB ZOB CAT TVO TDO DDO  SOB  NUL    ',
  17793        ! SFCBOG vvvvv
  17794      $     'POB NUL  NUL  NUL NUL ZOB CAT NUL NUL NUL  NUL  NUL    ',
  17795        ! ERS1DA vvvvv
  17796      $     'POB UOB  VOB  NUL NUL NUL CAT NUL NUL DDO  FFO  NUL    ',
  17797        ! GOESND vvvvv
  17798      $     'POB PW1O PW2O TOB QOB ZOB CAT TVO TDO PW3O PW4O PRSS   ',
  17799        ! QKSWND vvvvv
  17800      $     'POB UOB  VOB  NUL NUL NUL CAT NUL NUL DDO  FFO  NUL    ',
  17801        ! MSONET vvvvv
  17802      $     'POB UOB  VOB  TOB QOB ZOB CAT TVO TDO DDO  SOB  NUL    ',
  17803        ! GPSIPW vvvvv
  17804      $     'NUL NUL  NUL  NUL NUL NUL CAT NUL NUL NUL  PRSS PWO    ',
  17805        ! RASSDA vvvvv
  17806      $     'POB NUL  NUL  TOB NUL ZOB CAT TVO NUL NUL  NUL  NUL    ',
  17807        ! WDSATR vvvvv
  17808      $     'POB UOB  VOB  NUL NUL NUL CAT NUL NUL DDO  FFO  NUL    ',
  17809        ! ASCATW vvvvv
  17810      $     'POB UOB  VOB  NUL NUL NUL CAT NUL NUL DDO  FFO  NUL    '/
  17811 
  17812       DATA  OBSSTR2/
  17813        ! PROFLR vvvvv
  17814      $     ' NUL    NUL  NUL   NUL    NUL    NUL                   ',
  17815        ! VADWND vvvvv
  17816      $     ' NUL    NUL  NUL   NUL    NUL    NUL                   ',
  17817        ! ADPUPA vvvvv
  17818      $     ' YDR    HRDR NUL   NUL    NUL    NUL                   ',
  17819        ! AIRCAR vvvvv
  17820      $     ' TRBX21 POAF PCAT  TRBX32 TRBX43 MSTQ                  ',
  17821        ! AIRCFT vvvvv
  17822      $     ' ROLF   POAF PCAT  TRBX   IALR   NUL                   ',
  17823        ! SATWND vvvvv
  17824      $     ' NUL    NUL  NUL   NUL    NUL    NUL                   ',
  17825        ! SATEMP vvvvv
  17826      $     ' NUL    NUL  NUL   NUL    NUL    NUL                   ',
  17827        ! SPSSMI vvvvv
  17828      $     ' REQV   NUL  NUL   NUL    NUL    NUL                   ',
  17829        ! ADPSFC vvvvv
  17830      $     ' PMO    ALSE PMIN  NUL    NUL    NUL                   ',
  17831        ! SFCSHP vvvvv
  17832      $     ' PMO    NUL  PMIN  NUL    NUL    NUL                   ',
  17833        ! SFCBOG vvvvv
  17834      $     ' NUL    NUL  NUL   NUL    NUL    NUL                   ',

Page 427         Source Listing                  W3FIZZ
2017-04-18 11:09                                 prepdata.f

  17835        ! ERS1DA vvvvv
  17836      $     ' NUL    NUL  NUL   NUL    NUL    NUL                   ',
  17837        ! GOESND vvvvv
  17838      $     ' CDTP   TOCC GCDTT NUL    NUL    NUL                   ',
  17839        ! QKSWND vvvvv
  17840      $     ' NUL    NUL  NUL   NUL    NUL    NUL                   ',
  17841        ! MSONET vvvvv
  17842      $     ' NUL    ALSE NUL   NUL    NUL    NUL                   ',
  17843        ! GPSIPW vvvvv
  17844      $     ' BEARAZ ELEV APDS  APDE   NUL    NUL                   ',
  17845        ! RASSDA vvvvv
  17846      $     ' NUL    NUL  NUL   NUL    NUL    NUL                   ',
  17847        ! WDSATR vvvvv
  17848      $     ' REQV   NUL  NUL   NUL    NUL    NUL                   ',
  17849        ! ASCATW vvvvv
  17850      $     ' NUL    NUL  NUL   NUL    NUL    NUL                   '/
  17851 
  17852       DATA  QMSSTR/
  17853        ! PROFLR vvvvv
  17854      $             'PQM WQM  NUL NUL ZQM NUL  NUL   DFQ   NUL   ',
  17855        ! VADWND vvvvv
  17856      $             'PQM WQM  NUL NUL ZQM NUL  NUL   DFQ   NUL   ',
  17857        ! ADPUPA vvvvv
  17858      $             'PQM WQM  TQM QQM ZQM NUL  NUL   DFQ   NUL   ',
  17859        ! AIRCAR vvvvv
  17860      $             'PQM WQM  TQM QQM ZQM NUL  NUL   DFQ   NUL   ',
  17861        ! AIRCFT vvvvv
  17862      $             'PQM WQM  TQM QQM ZQM NUL  NUL   DFQ   NUL   ',
  17863        ! SATWND vvvvv
  17864      $             'PQM WQM  TQM NUL ZQM NUL  NUL   DFQ   NUL   ',
  17865        ! SATEMP vvvvv
  17866      $             'PQM NUL  TQM QQM ZQM NUL  NUL   NUL   NUL   ',
  17867        ! SPSSMI vvvvv
  17868      $             'PQM WQM  NUL NUL NUL PWQ  RRTQM DFQ   NUL   ',
  17869        ! ADPSFC vvvvv
  17870      $             'PQM WQM  TQM QQM ZQM NUL  PMQ   DFQ   NUL   ',
  17871        ! SFCSHP vvvvv
  17872      $             'PQM WQM  TQM QQM ZQM NUL  PMQ   DFQ   NUL   ',
  17873        ! SFCBOG vvvvv
  17874      $             'PQM NUL  NUL NUL ZQM NUL  NUL   NUL   NUL   ',
  17875        ! ERS1DA vvvvv
  17876      $             'PQM WQM  NUL NUL NUL NUL  NUL   DFQ   NUL   ',
  17877        ! GOESND vvvvv
  17878      $             'PQM PW1Q TQM QQM ZQM PW2Q PW3Q  PW4Q  CTPQM ',
  17879        ! QKSWND vvvvv
  17880      $             'PQM WQM  NUL NUL NUL NUL  NUL   DFQ   NUL   ',
  17881        ! MSONET vvvvv
  17882      $             'PQM WQM  TQM QQM ZQM NUL  NUL   DFQ   NUL   ',
  17883        ! GPSIPW vvvvv
  17884      $             'NUL NUL  NUL NUL NUL PWQ  NUL   NUL   NUL   ',
  17885        ! RASSDA vvvvv
  17886      $             'PQM NUL  TQM NUL ZQM NUL  NUL   NUL   NUL   ',
  17887        ! WDSATR vvvvv
  17888      $             'PQM WQM  NUL NUL NUL NUL  NUL   DFQ   NUL   ',
  17889        ! ASCATW vvvvv
  17890      $             'PQM WQM  NUL NUL NUL NUL  NUL   DFQ   NUL   '/
  17891 

Page 428         Source Listing                  W3FIZZ
2017-04-18 11:09                                 prepdata.f

  17892       DATA  PGMSTR/
  17893        ! PROFLR vvvvv
  17894      $             'PPC ZPC WPC  DFP  NUL NUL NUL   NUL   NUL   ',
  17895        ! VADWND vvvvv
  17896      $             'PPC ZPC WPC  DFP  NUL NUL NUL   NUL   NUL   ',
  17897        ! ADPUPA vvvvv
  17898      $             'PPC ZPC WPC  DFP  TPC QPC NUL   NUL   NUL   ',
  17899        ! AIRCAR vvvvv
  17900      $             'PPC ZPC WPC  DFP  TPC QPC NUL   NUL   NUL   ',
  17901        ! AIRCFT vvvvv
  17902      $             'PPC ZPC WPC  DFP  TPC QPC NUL   NUL   NUL   ',
  17903        ! SATWND vvvvv
  17904      $             'PPC ZPC WPC  DFP  TPC NUL NUL   NUL   NUL   ',
  17905        ! SATEMP vvvvv
  17906      $             'PPC ZPC NUL  NUL  TPC QPC NUL   NUL   NUL   ',
  17907        ! SPSSMI vvvvv
  17908      $             'PPC NUL WPC  DFP  NUL NUL PWP   RRTPC NUL   ',
  17909        ! ADPSFC vvvvv
  17910      $             'PPC ZPC WPC  DFP  TPC QPC NUL   NUL   NUL   ',
  17911        ! SFCSHP vvvvv
  17912      $             'PPC ZPC WPC  DFP  TPC QPC NUL   NUL   NUL   ',
  17913        ! SFCBOG vvvvv
  17914      $             'PPC ZPC NUL  NUL  NUL NUL NUL   NUL   NUL   ',
  17915        ! ERS1DA vvvvv
  17916      $             'PPC NUL WPC  DFP  NUL NUL NUL   NUL   NUL   ',
  17917        ! GOESND vvvvv
  17918      $             'PPC ZPC PW1P PW2P TPC QPC PW3P  PW4P  CTPPC ',
  17919        ! QKSWND vvvvv
  17920      $             'PPC NUL WPC  DFP  NUL NUL NUL   NUL   NUL   ',
  17921        ! MSONET vvvvv
  17922      $             'PPC ZPC WPC  DFP  TPC QPC NUL   NUL   NUL   ',
  17923        ! GPSIPW vvvvv
  17924      $             'NUL NUL NUL  NUL  NUL NUL PWP   NUL   NUL   ',
  17925        ! RASSDA vvvvv
  17926      $             'PPC ZPC NUL  NUL  TPC NUL NUL   NUL   NUL   ',
  17927        ! WDSATR vvvvv
  17928      $             'PPC NUL WPC  DFP  NUL NUL NUL   NUL   NUL   ',
  17929        ! ASCATW vvvvv
  17930      $             'PPC NUL WPC  DFP  NUL NUL NUL   NUL   NUL   '/
  17931 
  17932       DATA  RSNSTR/
  17933        ! PROFLR vvvvv
  17934      $             'PRC ZRC WRC  DFR  NUL NUL NUL   NUL   NUL   ',
  17935        ! VADWND vvvvv
  17936      $             'PRC ZRC WRC  DFR  NUL NUL NUL   NUL   NUL   ',
  17937        ! ADPUPA vvvvv
  17938      $             'PRC ZRC WRC  DFR  TRC QRC NUL   NUL   NUL   ',
  17939        ! AIRCAR vvvvv
  17940      $             'PRC ZRC WRC  DFR  TRC QRC NUL   NUL   NUL   ',
  17941        ! AIRCFT vvvvv
  17942      $             'PRC ZRC WRC  DFR  TRC QRC NUL   NUL   NUL   ',
  17943        ! SATWND vvvvv
  17944      $             'PRC ZRC WRC  DFR  TRC NUL NUL   NUL   NUL   ',
  17945        ! SATEMP vvvvv
  17946      $             'PRC ZRC NUL  NUL  TRC QRC NUL   NUL   NUL   ',
  17947        ! SPSSMI vvvvv
  17948      $             'PRC NUL WRC  DFR  NUL NUL PWR   RRTRC NUL   ',

Page 429         Source Listing                  W3FIZZ
2017-04-18 11:09                                 prepdata.f

  17949        ! ADPSFC vvvvv
  17950      $             'PRC ZRC WRC  DFR  TRC QRC NUL   NUL   NUL   ',
  17951        ! SFCSHP vvvvv
  17952      $             'PRC ZRC WRC  DFR  TRC QRC NUL   NUL   NUL   ',
  17953        ! SFCBOG vvvvv
  17954      $             'PRC ZRC NUL  NUL  NUL NUL NUL   NUL   NUL   ',
  17955        ! ERS1DA vvvvv
  17956      $             'PRC NUL WRC  DFR  NUL NUL NUL   NUL   NUL   ',
  17957        ! GOESND vvvvv
  17958      $             'PRC ZRC PW1R PW2R TRC QRC PW3R  PW4R  CTPRC ',
  17959        ! QKSWND vvvvv
  17960      $             'PRC NUL WRC  DFR  NUL NUL NUL   NUL   NUL   ',
  17961        ! MSONET vvvvv
  17962      $             'PRC ZRC WRC  DFR  TRC QRC NUL   NUL   NUL   ',
  17963        ! GPSIPW vvvvv
  17964      $             'NUL NUL NUL  NUL  NUL NUL PWR   NUL   NUL   ',
  17965        ! RASSDA vvvvv
  17966      $             'PRC ZRC NUL  NUL  TRC NUL NUL   NUL   NUL   ',
  17967        ! WDSATR vvvvv
  17968      $             'PRC NUL WRC  DFR  NUL NUL NUL   NUL   NUL   ',
  17969        ! ASCATW vvvvv
  17970      $             'PRC NUL WRC  DFR  NUL NUL NUL   NUL   NUL   '/
  17971 
  17972       DATA SUBSET/'PROFLR  ','VADWND  ','ADPUPA  ','AIRCAR  ',
  17973      $            'AIRCFT  ','SATWND  ','SATEMP  ','SPSSMI  ',
  17974      $            'ADPSFC  ','SFCSHP  ','SFCBOG  ','ERS1DA  ',
  17975      $            'GOESND  ','QKSWND  ','MSONET  ','GPSIPW  ',
  17976      $            'RASSDA  ','WDSATR  ','ASCATW  '/
  17977 
  17978       DATA  ICALL/0/,SINGLE/3*.FALSE.,3*.TRUE.,.FALSE.,5*.TRUE.,
  17979      $ .FALSE.,3*.TRUE.,.FALSE.,2*.TRUE./,ITYPL/0/,ISUB/0/,ISUBT/0/,
  17980      $ IRECL/0/,AERS/12*0.0/
  17981       DATA YMISS/99998.8/,IMISS/99999/
  17982 
  17983       DATA  KTYP/
  17984 CCC              100-101  102  103-109   110-119
  17985      $              2*0 ,  8 ,    7*0 ,    10*0 ,
  17986 CCC              120  121  122  123-125  126  127-229
  17987      $            3 ,  0 ,  3 ,    3*0 , 17 ,    3*0 ,
  17988 CCC              130-131  132  133  134  135  136-139   140-149
  17989      $              2*5,   3 ,  4 ,  5 ,  5 ,    4*0 ,    10*6 ,
  17990 CCC              150  151  152  153  154  155  156-159
  17991      $            8 , 13 ,  8 , 16 ,  0 ,  0 ,    4*13,
  17992 CCC              160-163  164-165  166-169
  17993      $              4*7 ,    2*13,    4*0 ,
  17994 CCC              170-173  174-175  176-179
  17995      $              4*7 ,    2*13,    4*0 ,
  17996 CCC              180  181  182  183  184-186  187  188  189
  17997      $           10 ,  9 , 10 ,  9 ,    3*0 ,  9 , 15 ,  0 ,
  17998 CCC              190-191  192-193  194  195  196-199
  17999      $              2*11,   2*9,    10,  15,   4*0 ,
  18000 CCC              200-209   210-219
  18001      $             10*0 ,    10*0 ,
  18002 CCC              220-222  223  224  225  226  227  228  229
  18003      $              3*3 ,  1 ,  2 ,  0 ,  0 ,  1 ,  1 ,  1 ,
  18004 CCC              230-231  232  233  234  235  236-239
  18005      $              2*5,   3 ,  4 ,  5 ,  5 ,    4*0 ,

Page 430         Source Listing                  W3FIZZ
2017-04-18 11:09                                 prepdata.f

  18006 CCC              240-249   250-259   260-269   270-279
  18007      $             10*6 ,    10*6 ,    10*0 ,    10*0 ,
  18008 CCC              280  281  282  283  284  285  286  287  288  289
  18009      $           10 ,  9 , 10 ,  8 ,  9 , 14 , 12 ,  9 , 15 , 18 ,
  18010 CCC              290  291  292-293  294  295  296-299
  18011      $           19 ,  0,   2*9,     10,  15,   4*0 /
  18012 
  18013       IER = 1
  18014       IF(ICALL.EQ.0)  THEN
  18015 C-----------------------------------------------------------------------
  18016 C              COME HERE FIRST TIME INTO SUBROUTINE
  18017 C-----------------------------------------------------------------------
  18018          IUNITP    = IUNIT(16)
  18019          IUNITG(1) = IUNIT(4)
  18020          IUNITG(2) = IUNIT(4) + 1
  18021          CALL DATELEN(10)
  18022          IF(APPEND)  THEN
  18023 C IF APPEND=TRUE, OPEN EXISTING PREPBUFR FILE - NEW BUFR MESSAGES WILL
  18024 C  BE APPENDED TO IT BASED ON ITS INTERNAL BUFR MNEMONIC TABLES A/B/D
  18025             CALL DATEBF(IUNITP,MEAR,MMON,MDAY,MOUR,JDAT10)
  18026             CALL OPENBF(IUNITP,'APX',IUNITP)
  18027             PRINT 7100, IUNITP,JDAT10
  18028  7100 FORMAT(/8X,'===> EXISTING PREPBUFR DATA SET IN UNIT',I3,
  18029      $ ' SUCCESSFULLY OPENED FOR OUTPUT; NEW BUFR MESSAGES WILL BE ',
  18030      $ 'APPENDED TO'/13X,'IT BASED ON ITS INTERNAL BUFR MNEMONIC ',
  18031      $ 'TABLES A/B/D'/13X,'THIS DATA SET HAS THE DATE: ',I10/)
  18032 C DOES DATE FROM THE EXISTING PREPBUFR DATA SET MATCH THE EXPECTED
  18033 C  (NCEP PRODUCTION) DATE?
  18034             IF(JDAT10.NE.IDAT10)  THEN
  18035                PRINT 7789
  18036  7789 FORMAT(/5X,'######  THE DATE FOUND IN THE EXISTING PREPBUFR DATA',
  18037      $ ' SET DOES NOT MATCH THE EXPECTED (PRODUCTION) DATE FOR THIS ',
  18038      $ 'RUN, STOP 30'/)
  18039                CALL W3TAGE('PREPOBS_PREPDATA')
  18040                CALL ERREXIT(30)
  18041             END IF
  18042          ELSE
  18043 C IF APPEND=FALSE, OPEN NEW PREPBUFR FILE - WRITE OUT FIRST MESSAGE
  18044 C  (TABLE A, B, D ENTRIES) FROM INPUT FILE CONTAINING BUFR MNEMONIC
  18045 C  TABLES A/B/D
  18046             CALL OPENBF(IUNITP,'OUT',IUNIT(2))
  18047             PRINT 100, IUNITP,IUNIT(2)
  18048   100 FORMAT(/8X,'===> NEW PREPBUFR DATA SET IN UNIT',I3,
  18049      $ ' SUCCESSFULLY OPENED FOR OUTPUT; BUFR MNEMONIC TABLES A,B,D IN',
  18050      $ ' UNIT',I3/13X,'READ IN AND ENCODED INTO BEGINNING MESSAGES OF ',
  18051      $ 'OUTPUT DATA SET'/)
  18052          END IF
  18053 C GET THE "PROGRAM CODE" CORRESPONDING TO "PREPRO" (PREPDATA)
  18054          CALL UFBQCD(IUNITP,'PREPRO',PCODE)
  18055          PRINT 400, PCODE
  18056   400    FORMAT(/30X,'==> THIS PROGRAM IS "PREPRO" (PREPDATA) AND HAS ',
  18057      $    'A PROGRAM CODE',F5.0,' <=='/)
  18058          IF(.NOT.PREVEN)  THEN
  18059             PRINT 7300
  18060  7300 FORMAT(/1X,100('#')/' =====> W3EMC ROUTINE GBLEVENTS NOT INVOKED',
  18061      $ ' -- NAMELIST SWITCH "PREVEN" IS FALSE'/1X,100('#')/)
  18062             WRITE(IUNIT(17),7300)

Page 431         Source Listing                  W3FIZZ
2017-04-18 11:09                                 prepdata.f

  18063             WRITE(IUNIT(17),7301)
  18064  7301 FORMAT(130('#')//40X,'*** NO "PREVENT" EVENTS DATA FILTERING ***'
  18065      $ //)
  18066          END IF
  18067          ICALL = 1
  18068 C-----------------------------------------------------------------------
  18069       END IF
  18070       IF(HDR(3).EQ.IMISS)  THEN
  18071 C-----------------------------------------------------------------------
  18072 C COME HERE AFTER ALL REPORTS HAVE BEEN PROCESSED
  18073 
  18074          IF(ITYPL.EQ.0)  THEN
  18075             IF(.NOT.APPEND)  THEN
  18076 C IF NO DATA WAS WRITTEN TO DATA SET AND NOT APPENDING, THEN OPEN AN
  18077 C  EMPTY 'ADPUPA' TABLE A ENTRY MESSAGE SO THAT THE DATE IS AVAILABLE
  18078 C  ON THE DATA SET
  18079                CALL OPENMB(IUNITP,'ADPUPA  ',IDAT10)
  18080                PRINT 9105, IUNITP,IDAT10
  18081  9105 FORMAT(/' $$$$ NO DATA WRITTEN TO PREPBUFR DATA SET, WILL WRITE ',
  18082      $ 'A SINGLE MESSAGE WITH NO DATA IN ORDER TO STORE THE DATE'/
  18083      $ ' ===> NEW TABLE A MESSAGE OPENED IN PREPBUFR DATA SET IN UNIT',
  18084      $ I3,' -- TABLE A ENTRY IS "ADPUPA" AND DATE IS',I11/)
  18085             ELSE
  18086 C IF NO DATA WAS WRITTEN TO DATA SET AND APPENDING, PRINT A DIAGNOSTIC
  18087 C  WARNING
  18088                PRINT 9705
  18089  9705 FORMAT(/' $$$$ WARNING: NO NEW DATA APPENDED TO PREPBUFR DATA ',
  18090      $ 'SET'/)
  18091             END IF
  18092          END IF
  18093 C CLOSE PREPBUFR DATA SET
  18094          CALL UFBCNT(IUNITP,IREC,ISUB)
  18095          ISUBT = ISUBT + ISUB
  18096          PRINT 1253, IREC,ISUB,ISUBT
  18097  1253 FORMAT(/' --- WROTE BUFR DATA MSG NO.',I10,' WITH',I5,' REPORTS ',
  18098      $ '(TOTAL NO. REPORTS WRITTEN =',I7,')'/)
  18099          CALL CLOSBF(IUNITP)
  18100          PRINT 101, IUNITP
  18101   101 FORMAT(/5X,'===> PREPBUFR DATA SET IN UNIT',I3,' SUCCESSFULLY',
  18102      $ ' CLOSED'/)
  18103          WRITE(IUNIT(17),7302)
  18104  7302    FORMAT(/130('#')//)
  18105          GO TO 999
  18106 C-----------------------------------------------------------------------
  18107       END IF
  18108       KI  = HDR(6)/100
  18109       NI  = MOD((NINT(HDR(6))/10),10)
  18110       JI  = MOD(NINT(HDR(6)),10)
  18111       CTYPE = 'MASS'
  18112       IF(KI.EQ.2)  CTYPE = 'WIND'
  18113 C-----------------------------------------------------------------------
  18114 C     DETERMINE TABLE A ENTRY TO USE BASED ON PREPBUFR REPORT TYPE
  18115 C     (NOTE: IF INPUT FILE IS "SFCSHP", THEN FORCE ALL REPORTS TO GO
  18116 C            TO "SFCSHP" TABLE A ENTRY (NEEDED BECAUSE PREPBUFR REPORT
  18117 C            TYPES 183 AND 284 CAN APPEAR IN EITHER "ADPSFC" OR
  18118 C            "SFCSHP" INPUT FILE)
  18119 C-----------------------------------------------------------------------

Page 432         Source Listing                  W3FIZZ
2017-04-18 11:09                                 prepdata.f

  18120       ITYP = KTYP(NINT(HDR(6)))
  18121       IF(NFILE.EQ.IUNIT(6)+1)  ITYP = 10
  18122       IF(ITYP.LE.0)  THEN
  18123 C NOTE REPORTS WITH A PREPBUFR REPORT TYPE THAT IS NOT RECOGNIZED HERE
  18124 C  -- SKIP
  18125          PRINT 113, CTYPE,STNID,alat_8,alon_8,NINT(HDR(6))
  18126   113 FORMAT(' + + ',A4,' REPORT TOSSED   -ID=',A8,', LAT=',F10.5,'N, ',
  18127      $ 'LON=',F11.5,'E, RTYP',I4,' - NOT RECOGNIZED IN SUBROUTINE ',
  18128      $ 'W3FIZZ')
  18129          GO TO 999
  18130       END IF
  18131 C-----------------------------------------------------------------------
  18132 C  TEST PREPBUFR REPORT TYPE TO DETERMINE IF TABLE A ENTRY SHOULD CHANGE
  18133 C-----------------------------------------------------------------------
  18134       NEWTYP = 0
  18135 C IF 'ITYP' FOR THIS RPT DIFFERENT THAN FOR PREVIOUS RPT, SUBR. OPENMB
  18136 C  WILL OPEN A NEW BUFR MSG WITH THE NEW TABLE A ENTRY & RETURN A DATE
  18137       IF(ITYPL.GT.0)  THEN
  18138 C WILL NOT PRINT HERE IF THIS IS THE FIRST MESSAGE IN THE DATA SET
  18139          IF(ITYPL.NE.ITYP)  THEN
  18140             CALL UFBCNT(IUNITP,IREC,ISUB)
  18141             ISUBT = ISUBT + ISUB
  18142             PRINT 1253, IREC,ISUB,ISUBT
  18143          END IF
  18144       END IF
  18145       CALL OPENMB(IUNITP,SUBSET(ITYP),IDAT10)
  18146       IF(ITYPL.NE.ITYP)  THEN
  18147          PRINT 105, IUNITP,SUBSET(ITYP),IDAT10
  18148   105 FORMAT(/' ===> NEW TABLE A MESSAGE OPENED IN PREPBUFR DATA SET ',
  18149      $ 'IN UNIT',I3,' -- TABLE A ENTRY IS "',A8,'" AND DATE IS',I11/)
  18150          CALL UFBCNT(IUNITP,IRECL,ISUB)
  18151          NEWTYP = 1
  18152       END IF
  18153       ITYPL = ITYP
  18154 
  18155       SEPARATE_METARS = .FALSE.
  18156       IF(SEPARATE_METARS) THEN
  18157 
  18158 C This logic was designed to separate the METAR reports in the ADPSFC
  18159 C  message types being written out - they would never be combined with
  18160 C  non-METARS (i.e., SYNOPS) and their messages would be given a new
  18161 C  sub-type of 7 - this was going to be done in order to speed up the
  18162 C  subsequent REMOREST processing since only the non-METARs in the
  18163 C  ADPSFC really need to be checked (only the WMO Res. 40 SYNOPS
  18164 C  are restricted).
  18165 C
  18166 C The problem is that OIQCBUFR "reshuffles" messages in the same Table
  18167 C  A message type so there is no guarantee that METARS will remain
  18168 C  separate from SYNOPS in the final q.c.'d Global PREPBUFR file, and
  18169 C  there is no guarantee that the METAR messages will still have a
  18170 C  sub-type of 7.  The logic is kept in case we ever want to revisit
  18171 C  this issue (such as if OIQCBUFR ever goes away).
  18172 
  18173          if(subset(ityp).eq.'ADPSFC  ')  then
  18174 C IF THIS PREPBUFR TABLE A ENTRY IS ADPSFC, THEN ....
  18175 cppppp
  18176             print'(" %%% subset_d = ",A8,"; subset_d_last = ",A8)',

Page 433         Source Listing                  W3FIZZ
2017-04-18 11:09                                 prepdata.f

  18177      $       subset_d,subset_d_last
  18178 cppppp
  18179             if(subset_d.eq.'NC000007')  then
  18180 C .... IF THIS IS A METAR REPORT (I.E., IT COMES FROM A METAR TABLE A
  18181 C      MESSAGE IN THE INPUT ADPSFC DUMP FILE) ....
  18182                call status(iunitp,lun,idummy1,idummy2)
  18183                if(subset_d_last.ne.'NC000007'.and.newtyp.ne.1) then
  18184 C     .... IF THE PREVIOUS REPORT WAS NOT A METAR BUT IT WAS ANOTHER
  18185 C          TYPE IN PREPBUFR TABLE A ENTRY ADPSFC, THEN CLOSE CURRENT
  18186 C          PREPBUFR ADPSFC MESSAGE AND OPEN A NEW ONE WHERE THE MESSAGE
  18187 C          SUBTYPE IN SEC. 1 (NORMALLY HARDWIRED TO ZERO) IS
  18188 C          OVERWRITTEN WITH 7 TO UNIQUELY IDENTIFY THIS MESSAGE AS
  18189 C          CONTAINING ONLY METAR REPORTS (USEFUL FOR LATER PARSING OF
  18190 C          RESTRICTED RES. 40 SYNOPS WHICH WILL NEVER BE IN THESE METAR
  18191 C          SUBTYPE MESSAGES)
  18192                   call closmg(iunitp)
  18193                   call openmg(iunitp,subset(ityp),idat10)
  18194                   print'(" First METAR encountered, close last ",
  18195      $             "(SYNOP) message and open new message")'
  18196                end if
  18197                msbt = 7
  18198                call pkbs1(msbt,mbay(1,lun),'MSBT')
  18199             else
  18200 C .... IF THIS IS NOT A METAR REPORT (I.E., IT COMES FROM A TABLE A
  18201 C      MESSAGE OTHER THAN METAR IN THE INPUT ADPSFC DUMP FILE) ....
  18202                if(subset_d_last.eq.'NC000007') then
  18203 C     .... IF THE PREVIOUS REPORT WAS A METAR, THEN OVERWRITE THE
  18204 C          MESSAGE SUBTYPE IN SEC. 1 OF THE CURRENT OPEN MESSAGE WITH 7
  18205 C          TO UNIQUELY IDENTIFY THIS MESSAGE AS CONTAINING ONLY METAR
  18206 C          REPORTS (USEFUL FOR LATER PARSING OF RESTRICTED RES. 40
  18207 C          SYNOPS WHICH WILL NEVER BE IN THESE METAR SUBTYPE MESSAGES)
  18208 C          (NOTE: THIS IS MOST LIKELY REDUNDANT SINCE IT SHOULD ALREADY
  18209 C          HAVE BEEN OVERWRITTEN WHEN FIRST OPENED - SEE ABOVE), THEN
  18210 C          CLOSE THIS MESSAGE AND OPEN A NEW ONE TO WRITE THIS NON-
  18211 C          METAR REPORT INTO
  18212                   msbt = 7
  18213                   call pkbs1(msbt,mbay(1,lun),'MSBT')
  18214                   call closmg(iunitp)
  18215                   call openmg(iunitp,subset(ityp),idat10)
  18216                   print'(" First SYNOP encountered, close last ",
  18217      $             "(METAR) message and open new message")'
  18218                end if
  18219             end if
  18220             subset_d_last = subset_d
  18221          end if
  18222 CAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
  18223       ENDIF
  18224 
  18225 C-----------------------------------------------------------------------
  18226 C CALL SUBR. FIZZ01 TO PROCESS THE NEXT REPORT
  18227       CALL FIZZ01(KI,NI,JI,SUBSET(ITYP),SINGLE(ITYP))
  18228       NMOBS2 = 0
  18229       NMOBS3 = 0
  18230       NMHDR  = 0
  18231       IF(WRMISS) THEN
  18232          IF(MAX(NLV,NBT).EQ.0) THEN
  18233 C IF N-LIST SWITCH WRMISS IS TRUE AND NO VALID OBS LEVELS OR BRIGHTNESS

Page 434         Source Listing                  W3FIZZ
2017-04-18 11:09                                 prepdata.f

  18234 C  TEMP CHANNELS PRESENT FOR THIS BUFR SUBSET, CHECK FOR PRESENCE OF
  18235 C  ANY ANCILLARY INFORMATION (E.G., SENSIBLE WEATHER ELEMENTS) - IF
  18236 C  SOME IS FOUND, ENCODE SUBSET INTO PREPBUFR FILE (EVEN THOUGH THIS
  18237 C  INFO IS NOT DIRECTLY USED BY ASSIMILATION, IT MIGHT BE USEFUL FOR
  18238 C  VERIFICATION OR IN OTHER WAYS) {RIGHT NOW ONLY APPLIES TO AIRCRAFT
  18239 C  DATA (MAINLY PIREPS) BASED ON LOGIC IN SUBR. GETC06}
  18240             IF(MAX(NOBS3(1),NOBS3(2),NOBS3(3),NOBS3(4),NOBS3(5),
  18241      $       NOBS3(6),NOBS3(7)).EQ.0) THEN
  18242                DO I = 1,NUMOBS2
  18243                   IF(OBS2(I).LT.YMISS) THEN
  18244                      NMOBS2 = 1
  18245                      EXIT
  18246                   END IF
  18247                ENDDO
  18248                IF(NMOBS2.EQ.0) THEN
  18249                   DO I = 13,15
  18250                      IF(HDR_8(I).LT.YMISS) THEN
  18251                         NMHDR = 1
  18252                         EXIT
  18253                      END IF
  18254                   ENDDO
  18255                   IF(NMHDR.EQ.0) THEN
  18256                      DO I = 19,20
  18257                         IF(HDR_8(I).LT.YMISS) THEN
  18258                            NMHDR = 1
  18259                            EXIT
  18260                         END IF
  18261                      ENDDO
  18262                   END IF
  18263                   IF(NMHDR.EQ.0) THEN
  18264                      DO I = 23,26
  18265                         IF(HDR_8(I).LT.YMISS) THEN
  18266                            NMHDR = 1
  18267                            EXIT
  18268                         END IF
  18269                      ENDDO
  18270                   END IF
  18271                END IF
  18272             ELSE
  18273                NMOBS3 = 1
  18274             END IF
  18275          END IF
  18276       END IF
  18277       IF(MAX(NLV,NBT,NMOBS2,NMOBS3,NMHDR).GT.0) THEN
  18278 C-----------------------------------------------------------------------
  18279 C      ENCODE ALL VARIABLES/LEVELS MAKING UP THIS REPORT (SUBSET)
  18280 C-----------------------------------------------------------------------
  18281 C STORE THE STATION ID ("HDR_8" WORD 1)
  18282          CHDR = STNID
  18283          CALL UFBINT(IUNITP,HDR_8(1), 12,1,IRET,HEADR1)
  18284          CALL UFBINT(IUNITP,HDR_8(13), 9,1,IRET,HEADR2)
  18285          CALL UFBINT(IUNITP,HDR_8(22),MHDRWD-21,1,IRET,HEADR3)
  18286 C STORE VARIABLES THAT ARE IN SINGLE-LVL OBS2 & MULTI-LVL OBS3 ARRAYS
  18287          OBS2_8=OBS2
  18288          OBS3_8=OBS3
  18289          RDATA2_8=RDATA2
  18290          CALL UFBINT(IUNITP,OBS2_8,2,1,IRET,'RSRD EXPRSRD')

Page 435         Source Listing                  W3FIZZ
2017-04-18 11:09                                 prepdata.f

  18291 
  18292          IF(SUBSET(ITYP).EQ.'ADPSFC  ') THEN
  18293             CALL UFBINT(IUNITP,OBS2_8( 4),10,1,IRET,
  18294      $        'SST1 NUL MSST .REHOVI HOVI VTVI PSW1 PSW2 PKWDSP PKWDDR')
  18295             CALL UFBINT(IUNITP,OBS2_8(14),11,1,IRET,
  18296      $     '.DTMMXGS MXGS NUL TP01 TP03 TP06 TP12 TP24 TOSS TOCC HBLCS')
  18297             CALL UFBINT(IUNITP,OBS2_8(29),12,1,IRET,
  18298      $  '.DTHDOFS DOFS TOSD HOWV POWV HOWW POWW NUL NUL CHPT 3HPC 24PC')
  18299             CALL UFBINT(IUNITP,OBS2_8(41),1,1,IRET,'SSTQM')
  18300             IF(NOBS3(1).GT.0) CALL UFBINT(IUNITP,OBS3_8(1,1,1),5,
  18301      $                                    NOBS3(1),IRET,'.DTHTOPC TOPC')
  18302             IF(NOBS3(2).GT.0) CALL UFBINT(IUNITP,OBS3_8(1,1,2),5,
  18303      $                                             NOBS3(2),IRET,'PRWE')
  18304             IF(NOBS3(3).GT.0) CALL UFBINT(IUNITP,OBS3_8(1,1,3),5,
  18305      $                         NOBS3(3),IRET,'VSSO CLAM CLTP HOCB HOCT')
  18306 
  18307 
  18308 C Process CEILING data
  18309 c-----------
  18310 C  for METAR reports only, use cloud amount (CLAM) and cloud base (HOCB)
  18311 c  values to populate CEILING.
  18312 
  18313 c - method: Find lowest cloud layer that has an amount that is
  18314 c    "either Broken (6-9 tenths sky cover) or Overcast (10 tenths cover)"
  18315 c    otherwise, set CEILING to missing.
  18316 
  18317 c    for fog conditions (CLAM values of 9 or 10), use corresponding HOCB
  18318 c     as CEILING.
  18319 
  18320 c   if ob exists w/ less than broken (0 to 5 tenths) and non-fog conditions,
  18321 c    fill CEILING w/ arbitrarily high value (currently 20000m).
  18322 c-----------
  18323 
  18324 c  check for at least 1 cloud layer (nobs(3)>0) in METAR reports (TYP=512)
  18325       if(nobs3(3).gt.0 .and. int(hdr_8(7)).eq.512) then
  18326 
  18327 c-- debug of ceiling: available cloud amount & cloud base values
  18328 c---  DATA HEADR1/'SID  XOB YOB DHR NUL TYP T29 TSB ITP ELV SQN SIRC '/
  18329 c---  OBS3_8(5,MXBLVL,7)
  18330       db_ceiling=.false.  ! set to .true. to debug
  18331       if ( db_ceiling ) then
  18332         write(*,'(a,1x,a8,$)') 'db: ',stnid
  18333         write(*,'(3(1x,f6.2),$)') (hdr_8(i),i=2,4)
  18334         write(*,'(2(1x,i5),$)') (int(hdr_8(i)),i=6,7)
  18335         write(*,'(2x,a,i2)') "n= ",nobs3(3)
  18336 
  18337         do i=1,nobs3(3)
  18338           write(*,'(a,4x,i2,1x,":",3(2x,i3),2(3x,i5))') 'db: ',i,
  18339      $      (idint(obs3_8(j,i,3)),j=1,3),
  18340      $      (idint(obs3_8(j,i,3)),j=4,5)
  18341         enddo ! i=1,nobs3(3)
  18342        endif ! db_ceiling
  18343 c--
  18344 
  18345 c - loop thru available cloud layers, low to high
  18346         ndx_amt=0
  18347         ndx_bas=0

Page 436         Source Listing                  W3FIZZ
2017-04-18 11:09                                 prepdata.f

  18348         do i=1,nobs3(3)
  18349           cldamt_8=obs3_8(2,i,3)
  18350           cldbas_8=obs3_8(4,i,3)
  18351 
  18352 c - if cld amount missing or indiscernable, skip this level/layer
  18353           if ( ibfms(cldamt_8).eq.1 ) cycle                ! CLAM missing
  18354           if ( cldamt_8.eq.15. ) cycle               ! CLAM indiscernable
  18355 
  18356           ndx_amt=ndx_amt+1
  18357 
  18358 c - if cld base missing, skip this level/layer
  18359           if ( ibfms(cldbas_8).eq.1 ) cycle                ! HOCB missing
  18360 
  18361 c - check for sufficient cloud amount in this layer, break out of loop if found
  18362           if ( idnint(cldamt_8).eq.12 .or.
  18363      $       ( cldamt_8.ge.5. .and. cldamt_8.le.10. ) ) then  ! >5/10 or fog
  18364             ndx_bas=i
  18365             exit
  18366           endif ! if broken or betw 6-10 tenths cover
  18367 
  18368         enddo ! i=1,nobs3(3)
  18369 
  18370 c - specify infinite or missing ceiling values
  18371         if ( ndx_amt.ne.0 ) then                  ! some clouds found
  18372           if ( ndx_bas.eq.0 ) cldbas_8=20000.d0   ! no dense cloud found,
  18373 c                                                 !  ceiling infinite (20k)
  18374         else ! ndx_amt not 0
  18375           cldbas_8=bmiss
  18376 
  18377         endif ! ndx_amt not 0
  18378 
  18379 c - write out ceiling value
  18380           if (db_ceiling)
  18381      &      write(*,'(a,1x,i5)') 'db: ceil= ', idint(cldbas_8)
  18382           call UFBINT(iunitp,cldbas_8,1,1,iret,'CEILING')
  18383 
  18384       endif ! nobs3(3)>0 & hdr_8(7)=512 (metar)
  18385 c - end of CEILING processing
  18386 
  18387 
  18388             IF(NOBS3(4).GT.0) CALL UFBINT(IUNITP,OBS3_8(1,1,4),5,
  18389      $                      NOBS3(4),IRET,'.DTHMXTM MXTM .DTHMITM MITM')
  18390             IF(NOBS3(5).GT.0) CALL UFBINT(IUNITP,OBS3_8(1,1,5),5,
  18391      $                                   NOBS3(5),IRET,'DOSW HOSW POSW')
  18392 
  18393          ELSE IF(SUBSET(ITYP).EQ.'SFCSHP  ') THEN
  18394             CALL UFBINT(IUNITP,OBS2_8( 4),12,1,IRET,
  18395      $   'SST1 DBSS MSST NUL HOVI VTVI PSW1 PSW2 PKWDSP PKWDDR .DTMMXGS
  18396      $ MXGS')
  18397             CALL UFBINT(IUNITP,OBS2_8(23), 4,1,IRET,
  18398      $                                           'TOCC HBLCS XS10 XS20')
  18399             CALL UFBINT(IUNITP,OBS2_8(32),10,1,IRET,
  18400      $             'HOWV POWV HOWW POWW TDMP ASMP CHPT 3HPC 24PC SSTQM')
  18401             IF(NOBS3(2).GT.0) CALL UFBINT(IUNITP,OBS3_8(1,1,2),5,
  18402      $                                             NOBS3(2),IRET,'PRWE')
  18403             IF(NOBS3(3).GT.0) CALL UFBINT(IUNITP,OBS3_8(1,1,3),5,
  18404      $                          NOBS3(3),IRET,'VSSO CLAM CLTP HOCB NUL')

Page 437         Source Listing                  W3FIZZ
2017-04-18 11:09                                 prepdata.f

  18405             IF(NOBS3(5).GT.0) CALL UFBINT(IUNITP,OBS3_8(1,1,5),5,
  18406      $                                   NOBS3(5),IRET,'DOSW HOSW POSW')
  18407 
  18408          ELSE IF(SUBSET(ITYP).EQ.'MSONET  ') THEN
  18409             CALL UFBINT(IUNITP,OBS2_8(15), 2,1,IRET,'MXGS MXGD')
  18410             IF(NOBS3(1).GT.0) CALL UFBINT(IUNITP,OBS3_8(1,1,1),5,
  18411      $                                    NOBS3(1),IRET,'.DTHTOPC TOPC')
  18412 
  18413          ELSE IF(SUBSET(ITYP).EQ.'ADPUPA  ') THEN
  18414             CALL UFBINT(IUNITP,OBS2_8( 4), 1,1,IRET,'SST1')
  18415             CALL UFBINT(IUNITP,OBS2_8(24), 5,1,IRET,
  18416      $                                      'HBLCS NUL NUL WDIR1 WSPD1')
  18417             CALL UFBINT(IUNITP,OBS2_8(41), 1,1,IRET,'SSTQM')
  18418             IF(NOBS3(2).GT.0) CALL UFBINT(IUNITP,OBS3_8(1,1,2),5,
  18419      $                                             NOBS3(2),IRET,'PRWE')
  18420             IF(NOBS3(3).GT.0) CALL UFBINT(IUNITP,OBS3_8(1,1,3),5,
  18421      $                         NOBS3(3),IRET,'VSSO CLAM CLTP HOCB HOCT')
  18422             IF(NOBS3(6).GT.0) CALL UFBINT(IUNITP,OBS3_8(1,1,6),5,
  18423      $                                   NOBS3(6),IRET,'AFIC HBOI HTOI')
  18424             IF(NOBS3(7).GT.0) CALL UFBINT(IUNITP,OBS3_8(1,1,7),5,
  18425      $                                   NOBS3(7),IRET,'DGOT HBOT HTOT')
  18426 
  18427          ELSE IF(SUBSET(ITYP).EQ.'GOESND  ') THEN
  18428             CALL UFBINT(IUNITP,RDATA2_8(2), 1,1,IRET,'ACAV')
  18429          ELSE IF(SUBSET(ITYP).EQ.'QKSWND  ') THEN
  18430             CALL UFBINT(IUNITP,RDATA2_8(3), 2,1,IRET,'CTCN ATRN')
  18431             CALL UFBINT(IUNITP,RDATA2_8(8), 1,1,IRET,'SPRR')
  18432          ELSE IF(SUBSET(ITYP).EQ.'WDSATR  ') THEN
  18433             CALL UFBINT(IUNITP,RDATA2_8(2), 1,1,IRET,'ACAV')
  18434             CALL UFBINT(IUNITP,RDATA2_8(9), 8,1,IRET,
  18435      $       'SST1 MRWVC MRLWC WSST MWD10 MWS10 WSEQC1 CHSQ')
  18436             CALL UFBINT(IUNITP,RDATA2_8(17), 5,1,IRET,
  18437      $       'PHER SPDE SSTE CLDE VPRE ')
  18438          ELSE IF(SUBSET(ITYP).EQ.'ASCATW  ') THEN
  18439             CALL UFBINT(IUNITP,RDATA2_8(3) ,1,1,IRET,'CTCN')
  18440             CALL UFBINT(IUNITP,RDATA2_8(22),3,1,IRET,'WVCQ BSCD LKCS')
  18441          ELSE IF(SUBSET(ITYP).EQ.'SATWND  ') THEN
  18442             CALL UFBINT(IUNITP,OBS2_8(NUMOBS2), 1,1,IRET,'SAZA')
  18443          END IF
  18444 
  18445          IF(NLV.GT.0)  THEN
  18446             OBS_8=OBS
  18447             CALL UFBINT(IUNITP,OBS_8,MOBSWD,NLV,IRET,OBSSTR1(ITYP))
  18448             OB2_8=OB2
  18449             IF(SUBSET(ITYP)(1:3).EQ.'AIR'.OR.SUBSET(ITYP)(1:3).EQ.'ADP'
  18450      $    .OR. SUBSET(ITYP).EQ.'SPSSMI  '.OR.SUBSET(ITYP).EQ.'SFCSHP  '
  18451      $    .OR. SUBSET(ITYP).EQ.'GOESND  '.OR.SUBSET(ITYP).EQ.'MSONET  '
  18452      $    .OR. SUBSET(ITYP).EQ.'GPSIPW  '
  18453      $    .OR. SUBSET(ITYP).EQ.'WDSATR  ')
  18454      $       CALL UFBINT(IUNITP,OB2_8,MOB2WD,NLV,IRET,OBSSTR2(ITYP))
  18455             QMS_8=QMS
  18456             CALL UFBINT(IUNITP,QMS_8,MQMSWD,NLV,IRET,QMSSTR(ITYP))
  18457             PGM_8=PGM
  18458             CALL UFBINT(IUNITP,PGM_8,MPGMWD,NLV,IRET,PGMSTR(ITYP))
  18459             RSN_8=RSN
  18460             CALL UFBINT(IUNITP,RSN_8,MPGMWD,NLV,IRET,RSNSTR(ITYP))
  18461             IF(SUBSET(ITYP).EQ.'AIRCFT  '.AND.NLV.EQ.1)  THEN

Page 438         Source Listing                  W3FIZZ
2017-04-18 11:09                                 prepdata.f

  18462                IF(NOBS3(2).GT.0)  THEN
  18463     ! Tell BUFRLIB there are NOBS3(2) PREWXSEQ replications for this rpt
  18464                   CALL DRFINI(IUNITP,NOBS3(2),1,'{PREWXSEQ}')
  18465     ! Store PREWXSEQ replications for this rpt
  18466                   CALL UFBSEQ(IUNITP,OBS3_8(1,1,2),1,NOBS3(2),IRET,
  18467      $             'PREWXSEQ')
  18468 	       END IF
  18469                IF(NOBS3(3).GT.0)  THEN
  18470     ! Tell BUFRLIB there are NOBS3(3) CLOUDSEQ replications for this rpt
  18471                   CALL DRFINI(IUNITP,NOBS3(3),1,'{CLOUDSEQ}')
  18472     ! Store CLOUDSEQ replications for this rpt
  18473                   CALL UFBSEQ(IUNITP,OBS3_8(1,1,3),5,NOBS3(3),IRET,
  18474      $             'CLOUDSEQ')
  18475 	       END IF
  18476                IF(NOBS3(6).GT.0)  THEN
  18477     ! Tell BUFRLIB there are NOBS3(6) AFIC_SEQ replications for this rpt
  18478                   CALL DRFINI(IUNITP,NOBS3(6),1,'{AFIC_SEQ}')
  18479     ! Store AFIC_SEQ replications for this rpt
  18480                   CALL UFBSEQ(IUNITP,OBS3_8(1,1,6),3,NOBS3(6),IRET,
  18481      $             'AFIC_SEQ')
  18482 	       END IF
  18483                IF(NOBS3(7).GT.0)  THEN
  18484     ! Tell BUFRLIB there are NOBS3(7) TURB3SEQ replications for this rpt
  18485                   CALL DRFINI(IUNITP,NOBS3(7),1,'{TURB3SEQ}')
  18486     ! Store TURB3SEQ replications for this rpt
  18487                   CALL UFBSEQ(IUNITP,OBS3_8(1,1,7),3,NOBS3(7),IRET,
  18488      $             'TURB3SEQ')
  18489 	       END IF
  18490 	    END IF
  18491 cdak        IF(HDR(6).EQ.286)  THEN
  18492 C.......................................................................
  18493 C     ERS SCATTEROMETER WIND REPORTS ZERO OUT THE INCIDENT ANGLE,
  18494 C     AZIMUTH ANGLE, BACKSCATTER AND ERROR ESTIMATE FOR #1, 2, 3
  18495 C   NOTICE: These are not used by any code and are commented out
  18496 C           until such time as they are used (saves a lot of
  18497 C           space in the PREPBUFR files)
  18498 C.......................................................................
  18499 cdak           AERS_8=AERS
  18500 cdak           CALL UFBINT(IUNITP,AERS_8,12,1,IRET,
  18501 cdak $                            'A1 A2 A3 B1 B2 B3 S1 S2 S3 E1 E2 E3')
  18502 cdak        END IF
  18503             IF(HDR(6).EQ.188.OR.HDR(6).EQ.288
  18504      $     .or.hdr(6).eq.195.or.hdr(6).eq.295) THEN
  18505 C.......................................................................
  18506 C     MESONET SURFACE REPORTS ENCODE PROVIDER AND SUBPROVIDER ID
  18507 C                         CHARACTER STRINGS
  18508 C.......................................................................
  18509                CPRV(1) = CRES1
  18510                CPRV(2) = CRES2
  18511                CALL UFBINT(IUNITP,RPRV_8,2,1,IRET,'PRVSTG SPRVSTG')
  18512             END IF
  18513             IF((HDR(6).EQ.133.OR.HDR(6).EQ.233) .OR.
  18514      $        ((HDR(6).EQ.131.OR.HDR(6).EQ.231).AND.IDATA(10).eq.103))
  18515      $       THEN
  18516 C.......................................................................
  18517 C      MDCRS AND AMDARB REPORTS ENCODE FLIGHT NUMBER (CHARACTER*8)
  18518 C.......................................................................

Page 439         Source Listing                  W3FIZZ
2017-04-18 11:09                                 prepdata.f

  18519                CACID = CRES2
  18520                CALL UFBINT(IUNITP,RACID_8,1,1,IRET,'ACID')
  18521             END IF
  18522             IF((HDR(6).EQ.134.OR.HDR(6).EQ.234).AND.HDR(8).EQ.0)THEN
  18523 C.......................................................................
  18524 C    TAMDARM REPORTS ENCODE FLIGHT NUMBER (SAME AS STNID) (CHARACTER*8)
  18525 C.......................................................................
  18526                CACID = STNID
  18527                CALL UFBINT(IUNITP,RACID_8,1,1,IRET,'ACID')
  18528             END IF
  18529 C.......................................................................
  18530          END IF
  18531          IF(NBT.GT.0)  THEN
  18532             IF(NI.EQ.6.OR.NI.EQ.7)  THEN
  18533                RAD_8=RAD
  18534                CALL UFBINT(IUNITP,RAD_8,5,1,IRET,
  18535      $                                       'ELEV SOEL OZON TMSK CLAM')
  18536             END IF
  18537             BTO_8=BTO
  18538             CALL UFBINT(IUNITP,BTO_8,2,NBT,IRET,'CHNM TMBR')
  18539          END IF
  18540 C-----------------------------------------------------------------------
  18541 C CALL W3EMC ROUTINE GBLEVENTS TO ENCODE BACKGROUND EVENTS FOR THIS RPT
  18542          IF(PREVEN)  CALL GBLEVENTS(IDAT10,IUNITG,IUNIT(4)+2,IUNITP,
  18543      $                              IUNIT(17),SUBSET(ITYP),NEWTYP)
  18544 C WRITE THIS REPORT (SUBSET) INTO BUFR MESSAGE
  18545          CALL WRITSB(IUNITP)
  18546          IER = 0
  18547       ELSE
  18548 C NOTE THAT THIS REPORT (SUBSET) NOT PROCESSED DUE TO NO. LEVELS = 0
  18549          PRINT 213, CTYPE,STNID,alat_8,alon_8,NINT(HDR(6))
  18550   213 FORMAT(' + + ',A4,' REPORT TOSSED   -ID=',A8,', LAT=',F10.5,'N,',
  18551      $ ' LON=',F11.5,'E, RTYP',I4,' - ZERO LEVELS PROCESSED IN ',
  18552      $ 'SUBROUTINE W3FIZZ')
  18553       END IF
  18554       CALL UFBCNT(IUNITP,IREC,ISUBN)
  18555       IF(IREC.GT.IRECL)  THEN
  18556          IRECL = IREC
  18557          ISUBT = ISUBT + ISUB
  18558          PRINT 1254, IREC-1,ISUB,ISUBT
  18559  1254 FORMAT(/' --- THIS REPORT OPENS NEW MSG (SAME TABLE A): LAST MSG',
  18560      $ ' WAS NO.',I10,' (DATA) WITH',I5,' RPTS (TOTAL NO. RPTS ',
  18561      $ 'WRITTEN=',I7,')'/)
  18562       END IF
  18563       ISUB = ISUBN
  18564   999 CONTINUE
  18565       RETURN
  18566       END

Page 440         Source Listing                  W3FIZZ
2017-04-18 11:09 Entry Points                    prepdata.f



ENTRY POINTS

  Name               
                     
 w3fizz_             


SYMBOL CROSS REFERENCE

 Name                       Object Declared Type            Bytes Dimen Elements Attributes       References                        
                                                                                                                                    
 100                        Label  18048                                                          18047                             
 101                        Label  18101                                                          18100                             
 105                        Label  18148                                                          18147                             
 113                        Label  18126                                                          18125                             
 1253                       Label  18097                                                          18096,18142                       
 1254                       Label  18559                                                          18558                             
 213                        Label  18550                                                          18549                             
 400                        Label  18056                                                          18055                             
 7100                       Label  18028                                                          18027                             
 7300                       Label  18060                                                          18059,18062                       
 7301                       Label  18064                                                          18063                             
 7302                       Label  18104                                                          18103                             
 7789                       Label  18036                                                          18035                             
 9105                       Label  18081                                                          18080                             
 9705                       Label  18089                                                          18088                             
 999                        Label  18564                                                          18105,18129                       
 ADP                        Common 17714                                14100    SAVE                                               
 AERS                       Local  17741    R(4)            4     1     12       SAVE             17980                             
 AERS_8                     Local  17752    R(8)            8     1     12       SAVE                                               
 ALAT_8                     Scalar 17722    R(8)            8           scalar   COM              18125,18549                       
 ALON_8                     Scalar 17722    R(8)            8           scalar   COM              18125,18549                       
 APDNSW                     Common 17724                                4        SAVE                                               
 APPEND                     Scalar 17724    L(4)            4           scalar   COM              18022,18075                       
 BITBUF                     Common 17730                                1650136  SAVE                                               
 BMISS                      Scalar 17728    R(4)            4           scalar   COM              18375                             
 BTO                        Scalar 17717    R(4)            4     2     510      COM              18537                             
 BTO_8                      Local  17752    R(8)            8     2     510      SAVE             18537,18538                       
 BUFRLIB_MISSING            Common 17728                                4        SAVE                                               
 CACID                      Local  17744    CHAR            8           scalar   SAVE             18519,18526                       
 CBULL                      Scalar 17720    CHAR            11          scalar   COM                                                
 CHDR                       Scalar 17744    CHAR            8           scalar   COM              18282                             
 CLDAMT_8                   Local  17756    R(8)            8           scalar   SAVE             18349,18353,18354,18362,18363     
 CLDBAS_8                   Local  17756    R(8)            8           scalar   SAVE             18350,18359,18372,18375,18381,1838
                                                                                                  2                                 
 CLOSBF                     Subr   18099                                                          18099                             
 CLOSMG                     Subr   18192                                                          18192,18214                       
 CPRV                       Local  17744    CHAR            8     1     2        SAVE             18509,18510                       
 CRES1                      Scalar 17720    CHAR            8           scalar   COM              18509                             
 CRES2                      Scalar 17720    CHAR            8           scalar   COM              18510,18519                       
 CTYPE                      Local  17743    CHAR            4           scalar   SAVE             18111,18112,18125,18549           
 DATA                       Common 17721                                32       SAVE                                               
 DATEBF                     Subr   18025                                                          18025                             
 DATELEN                    Subr   18021                                                          18021                             
 DB_CEILING                 Local  17739    L(4)            4           scalar   SAVE             18330,18331,18380                 

Page 441         Source Listing                  W3FIZZ
2017-04-18 11:09 Symbol Table                    prepdata.f

 Name                       Object Declared Type            Bytes Dimen Elements Attributes       References                        
                                                                                                                                    
 DIRECT                     Common 17725                                36016    SAVE                                               
 DMY3                       Scalar 17721    R(4)            4           scalar   COM                                                
 DRFINI                     Subr   18464                                                          18464,18471,18478,18485           
 ERREXIT                    Subr   18040                                                          18040                             
 FIZZ01                     Subr   18227                                                          18227                             
 FIZZAA                     Common 17715                                48216    SAVE                                               
 GBLEVENTS                  Subr   18542                                                          18542                             
 HDR                        Scalar 17722    R(4)            4     1     14       COM              18070,18108,18109,18110,18120,1812
                                                                                                  5,18503,18504,18513,18514,18522,18
                                                                                                  549                               
 HDR_8                      Scalar 17715    R(8)            8     1     29       COM              18250,18257,18265,18283,18284,1828
                                                                                                  5,18325,18333,18334               
 HEADR1                     Local  17747    CHAR            50          scalar   SAVE             17768,18283                       
 HEADR2                     Local  17747    CHAR            50          scalar   SAVE             17769,18284                       
 HEADR3                     Local  17747    CHAR            50          scalar   SAVE             17770,18285                       
 I                          Local  18242    I(4)            4           scalar   SAVE             18242,18243,18249,18250,18256,1825
                                                                                                  7,18264,18265,18333,18334,18337,18
                                                                                                  338,18339,18340,18348,18349,18350,
                                                                                                  18364                             
 IBAY                       Scalar 17730    I(4)            4     1     12500    COM                                                
 IBFMS                      Func   18353    I(4)            4           scalar                    18353,18359                       
 IBIT                       Scalar 17730    I(4)            4           scalar   COM                                                
 IBTBLA                     Param  17712    I(4)            4           scalar                    17737,17744,17746,17748           
 ICALL                      Local  17978    I(4)            4           scalar   SAVE             17978,18014,18067                 
 IDAT10                     Scalar 17721    I(4)            4           scalar   COM              18034,18079,18080,18145,18147,1819
                                                                                                  3,18215,18542                     
 IDATA                      Scalar 17758    I(4)            4     1     3500     COM              18514                             
 IDATE                      Scalar 17721    I(4)            4     1     4        COM                                                
 IDINT                      Func   18339                                scalar                    18339,18340,18381                 
 IDNINT                     Func   18362                                scalar                    18362                             
 IDUMMY1                    Local  18182    I(4)            4           scalar   SAVE             18182                             
 IDUMMY2                    Local  18182    I(4)            4           scalar   SAVE             18182                             
 IER                        Dummy  17694    I(4)            4           scalar   ARG,INOUT        18013,18546                       
 IMISS                      Local  17981    I(4)            4           scalar   SAVE             17981,18070                       
 INT                        Func   18325                                scalar                    18325,18334                       
 IPRINT                     Scalar 17714    I(4)            4           scalar   COM                                                
 IREC                       Local  18094    I(4)            4           scalar   SAVE             18094,18096,18140,18142,18554,1855
                                                                                                  5,18556,18558                     
 IRECL                      Local  17980    I(4)            4           scalar   SAVE             17980,18150,18555,18556           
 IRET                       Local  18283    I(4)            4           scalar   SAVE             18283,18284,18285,18290,18293,1829
                                                                                                  5,18297,18299,18301,18303,18305,18
                                                                                                  382,18389,18391,18394,18397,18399,
                                                                                                  18402,18404,18406,18409,18411,1841
                                                                                                  4,18415,18417,18419,18421,18423,18
                                                                                                  425,18428,18430,18431,18433,18434,
                                                                                                  18436,18439,18440,18442,18447,1845
                                                                                                  4,18456,18458,18460,18466,18473,18
                                                                                                  480,18487,18511,18520,18527,18534,
                                                                                                  18538                             
 ISATOB                     Scalar 17714    I(4)            4           scalar   COM                                                
 ISUB                       Local  17979    I(4)            4           scalar   SAVE             17979,18094,18095,18096,18140,1814
                                                                                                  1,18142,18150,18557,18558,18563   
 ISUBN                      Local  18554    I(4)            4           scalar   SAVE             18554,18563                       
 ISUBT                      Local  17979    I(4)            4           scalar   SAVE             17979,18095,18096,18141,18142,1855
                                                                                                  7,18558                           

Page 442         Source Listing                  W3FIZZ
2017-04-18 11:09 Symbol Table                    prepdata.f

 Name                       Object Declared Type            Bytes Dimen Elements Attributes       References                        
                                                                                                                                    
 ITYP                       Local  18120    I(4)            4           scalar   SAVE             18120,18121,18122,18139,18145,1814
                                                                                                  6,18147,18153,18173,18193,18215,18
                                                                                                  227,18292,18393,18408,18413,18427,
                                                                                                  18429,18432,18438,18441,18447,1844
                                                                                                  9,18450,18451,18452,18453,18454,18
                                                                                                  456,18458,18460,18461,18543       
 ITYPL                      Local  17979    I(4)            4           scalar   SAVE             17979,18074,18137,18139,18146,1815
                                                                                                  3                                 
 IUNIT                      Scalar 17719    I(4)            4     1     28       COM              18018,18019,18020,18046,18047,1806
                                                                                                  2,18063,18103,18121,18542,18543   
 IUNITG                     Scalar 17718    I(4)            4     1     2        COM              18019,18020,18542                 
 IUNITP                     Scalar 17715    I(4)            4           scalar   COM              18018,18025,18026,18027,18046,1804
                                                                                                  7,18054,18079,18080,18094,18099,18
                                                                                                  100,18140,18145,18147,18150,18182,
                                                                                                  18192,18193,18214,18215,18283,1828
                                                                                                  4,18285,18290,18293,18295,18297,18
                                                                                                  299,18300,18302,18304,18382,18388,
                                                                                                  18390,18394,18397,18399,18401,1840
                                                                                                  3,18405,18409,18410,18414,18415,18
                                                                                                  417,18418,18420,18422,18424,18428,
                                                                                                  18430,18431,18433,18434,18436,1843
                                                                                                  9,18440,18442,18447,18454,18456,18
                                                                                                  458,18460,18464,18466,18471,18473,
                                                                                                  18478,18480,18485,18487,18511,1852
                                                                                                  0,18527,18534,18538,18542,18545,18
                                                                                                  554                               
 J                          Local  18339    I(4)            4           scalar   SAVE             18339,18340                       
 JDAT10                     Local  18025    I(4)            4           scalar   SAVE             18025,18027,18034                 
 JI                         Local  18110    I(4)            4           scalar   SAVE             18110,18227                       
 KI                         Local  18108    I(4)            4           scalar   SAVE             18108,18112,18227                 
 KTYP                       Local  17741    I(4)            4     1     200      SAVE             17983,18120                       
 LUN                        Local  18182    I(4)            4           scalar   SAVE             18182,18198,18213                 
 MAX                        Func   18232                                scalar                    18232,18240,18277                 
 MAXBYT                     Scalar 17730    I(4)            4           scalar   COM                                                
 MAXOBS                     Param  17697    I(4)            4           scalar                    17714,17758                       
 MBAY                       Scalar 17730    I(4)            4     2     400000   COM              18198,18213                       
 MBYT                       Scalar 17730    I(4)            4     1     32       COM                                                
 MDAY                       Local  18025    I(4)            4           scalar   SAVE             18025                             
 MEAR                       Local  18025    I(4)            4           scalar   SAVE             18025                             
 MHDRWD                     Param  17703    I(4)            4           scalar                    17715,18285                       
 MMON                       Local  18025    I(4)            4           scalar   SAVE             18025                             
 MOB2WD                     Param  17703    I(4)            4           scalar                    17716,17750,18454                 
 MOBSWD                     Param  17703    I(4)            4           scalar                    17716,17750,18447                 
 MOD                        Func   18109                                scalar                    18109,18110                       
 MOUR                       Local  18025    I(4)            4           scalar   SAVE             18025                             
 MPGMWD                     Param  17709    I(4)            4           scalar                    17717,17751,18458,18460           
 MP_PROCESS                 Scalar 17721    I(4)            4           scalar   COM                                                
 MQMSWD                     Param  17706    I(4)            4           scalar                    17716,17751,18456                 
 MSBT                       Local  18197    I(4)            4           scalar   SAVE             18197,18198,18212,18213           
 MXBLVL                     Param  17703    I(4)            4           scalar                    17716,17717,17725,17750,17751,1775
                                                                                                  2,17753                           
 MXWRDH                     Param  17695    I(4)            4           scalar                    17722                             
 NBT                        Scalar 17715    I(4)            4           scalar   COM              18232,18277,18531,18538           
 NDX_AMT                    Local  18346    I(4)            4           scalar   SAVE             18346,18356,18371                 
 NDX_BAS                    Local  18347    I(4)            4           scalar   SAVE             18347,18364,18372                 

Page 443         Source Listing                  W3FIZZ
2017-04-18 11:09 Symbol Table                    prepdata.f

 Name                       Object Declared Type            Bytes Dimen Elements Attributes       References                        
                                                                                                                                    
 NEWTYP                     Local  18134    I(4)            4           scalar   SAVE             18134,18151,18183,18543           
 NFILE                      Scalar 17719    I(4)            4           scalar   COM              18121                             
 NI                         Local  18109    I(4)            4           scalar   SAVE             18109,18227,18532                 
 NINT                       Func   18109                                scalar                    18109,18110,18120,18125,18549     
 NLV                        Scalar 17715    I(4)            4           scalar   COM              18232,18277,18445,18447,18454,1845
                                                                                                  6,18458,18460,18461               
 NMHDR                      Local  18230    I(4)            4           scalar   SAVE             18230,18251,18255,18258,18263,1826
                                                                                                  6,18277                           
 NMOBS2                     Local  18228    I(4)            4           scalar   SAVE             18228,18244,18248,18277           
 NMOBS3                     Local  18229    I(4)            4           scalar   SAVE             18229,18273,18277                 
 NOBS3                      Scalar 17725    I(4)            4     1     7        COM              18240,18241,18300,18301,18302,1830
                                                                                                  3,18304,18305,18325,18335,18337,18
                                                                                                  348,18388,18389,18390,18391,18401,
                                                                                                  18402,18403,18404,18405,18406,1841
                                                                                                  0,18411,18418,18419,18420,18421,18
                                                                                                  422,18423,18424,18425,18462,18464,
                                                                                                  18466,18469,18471,18473,18476,1847
                                                                                                  8,18480,18483,18485,18487         
 NUMOBS2                    Param  17696    I(4)            4           scalar                    17725,17752,18242,18442           
 OB2                        Scalar 17716    R(4)            4     2     1530     COM              18448                             
 OB2_8                      Local  17750    R(8)            8     2     1530     SAVE             18448,18454                       
 OBS                        Scalar 17716    R(4)            4     2     3060     COM              18446                             
 OBS2                       Scalar 17725    R(4)            4     1     43       COM              18243,18287                       
 OBS2_8                     Local  17752    R(8)            8     1     43       SAVE             18287,18290,18293,18295,18297,1829
                                                                                                  9,18394,18397,18399,18409,18414,18
                                                                                                  415,18417,18442                   
 OBS3                       Scalar 17725    R(4)            4     3     8925     COM              18288                             
 OBS3_8                     Local  17753    R(8)            8     3     8925     SAVE             18288,18300,18302,18304,18339,1834
                                                                                                  0,18349,18350,18388,18390,18401,18
                                                                                                  403,18405,18410,18418,18420,18422,
                                                                                                  18424,18466,18473,18480,18487     
 OBS8_8                     Scalar 17726    R(8)            8     1     2        COM                                                
 OBSSTR1                    Local  17748    CHAR            55    1     19       SAVE             17772,18447                       
 OBSSTR2                    Local  17748    CHAR            55    1     19       SAVE             17812,18454                       
 OBS_8                      Local  17750    R(8)            8     2     3060     SAVE             18446,18447                       
 OPENBF                     Subr   18026                                                          18026,18046                       
 OPENMB                     Subr   18079                                                          18079,18145                       
 OPENMG                     Subr   18193                                                          18193,18215                       
 PCODE                      Scalar 17715    R(4)            4           scalar   COM              18054,18055                       
 PGM                        Scalar 17717    R(4)            4     2     2295     COM              18457                             
 PGMSTR                     Local  17746    CHAR            47    1     19       SAVE             17892,18458                       
 PGM_8                      Local  17751    R(8)            8     2     2295     SAVE             18457,18458                       
 PKBS1                      Subr   18198                                                          18198,18213                       
 PMAND                      Scalar 17714    R(4)            4     1     23       COM                                                
 PREVEN                     Scalar 17723    L(4)            4           scalar   COM              18058,18542                       
 PREVSW                     Common 17723                                4        SAVE                                               
 QMS                        Scalar 17716    R(4)            4     2     2295     COM              18455                             
 QMSSTR                     Local  17746    CHAR            47    1     19       SAVE             17852,18456                       
 QMS_8                      Local  17751    R(8)            8     2     2295     SAVE             18455,18456                       
 RACID_8                    Local  17753    R(8)            8           scalar   SAVE             18520,18527                       
 RAD                        Scalar 17717    R(4)            4     1     5        COM              18533                             
 RAD_8                      Local  17752    R(8)            8     1     5        SAVE             18533,18534                       
 RDATA                      Scalar 17714    R(4)            4     1     3500     COM                                                
 RDATA2                     Scalar 17725    R(4)            4     1     25       COM              18289                             
 RDATA2_8                   Local  17753    R(8)            8     1     25       SAVE             18289,18428,18430,18431,18433,1843

Page 444         Source Listing                  W3FIZZ
2017-04-18 11:09 Symbol Table                    prepdata.f

 Name                       Object Declared Type            Bytes Dimen Elements Attributes       References                        
                                                                                                                                    
                                                                                                  4,18436,18439,18440               
 RPRV_8                     Local  17753    R(8)            8     1     2        SAVE             18511                             
 RPTHDR                     Common 17722                                88       SAVE                                               
 RSN                        Scalar 17717    R(4)            4     2     2295     COM              18459                             
 RSNSTR                     Local  17746    CHAR            47    1     19       SAVE             17932,18460                       
 RSN_8                      Local  17751    R(8)            8     2     2295     SAVE             18459,18460                       
 SEPARATE_METARS            Local  17734    L(4)            4           scalar   SAVE             18155,18156                       
 SINGLE                     Local  17737    L(4)            4     1     19       SAVE             17978,18227                       
 STATUS                     Subr   18182                                                          18182                             
 STNID                      Scalar 17722    CHAR            8           scalar   COM              18125,18282,18332,18526,18549     
 SUBSET                     Local  17744    CHAR            8     1     19       SAVE             17972,18145,18147,18173,18193,1821
                                                                                                  5,18227,18292,18393,18408,18413,18
                                                                                                  427,18429,18432,18438,18441,18449,
                                                                                                  18450,18451,18452,18453,18461,1854
                                                                                                  3                                 
 SUBSET_D                   Scalar 17722    CHAR            8           scalar   COM              18177,18179,18220                 
 SUBSET_D_LAST              Local  17731    CHAR            8           scalar   SAVE             17733,18177,18183,18202,18220     
 UFBCNT                     Subr   18094                                                          18094,18140,18150,18554           
 UFBINT                     Subr   18283                                                          18283,18284,18285,18290,18293,1829
                                                                                                  5,18297,18299,18300,18302,18304,18
                                                                                                  382,18388,18390,18394,18397,18399,
                                                                                                  18401,18403,18405,18409,18410,1841
                                                                                                  4,18415,18417,18418,18420,18422,18
                                                                                                  424,18428,18430,18431,18433,18434,
                                                                                                  18436,18439,18440,18442,18447,1845
                                                                                                  4,18456,18458,18460,18511,18520,18
                                                                                                  527,18534,18538                   
 UFBQCD                     Subr   18054                                                          18054                             
 UFBSEQ                     Subr   18466                                                          18466,18473,18480,18487           
 UNITNO                     Common 17719                                116      SAVE                                               
 W3FIZZ                     Subr   17694                                                                                            
 W3TAGE                     Subr   18039                                                          18039                             
 WRITSB                     Subr   18545                                                          18545                             
 WRMISS                     Scalar 17721    L(4)            4           scalar   COM              18231                             
 XTRHD2                     Common 17720                                27       SAVE                                               
 YMISS                      Local  17981    R(4)            4           scalar   SAVE             17981,18243,18250,18257,18265     

Page 445         Source Listing                  W3FIZZ
2017-04-18 11:09                                 prepdata.f

  18567 C$$$  SUBPROGRAM DOCUMENTATION BLOCK
  18568 C
  18569 C SUBPROGRAM:    FIZZ01
  18570 C   PRGMMR: Keyser           ORG: NP22       DATE: 2016-11-30
  18571 C
  18572 C ABSTRACT: PARSES THE "HDR/MOBS/IPMSL/PWAT/xRAD/REQV/CLTOP" ARRAYS
  18573 C   (HOLDING ONE PREPROCESSED REPORT) INTO THE APPROPRIATE ARRAYS
  18574 C   ASSOCIATED WITH THE MNEMONICS DEFINED FOR THE DATA TYPE'S BUFR
  18575 C   TABLE A ENTRY (MESSAGE TYPE).
  18576 C
  18577 C PROGRAM HISTORY LOG:
  18578 C 1993-09-14  J. WOOLLEN (GENERAL SCIENCES CORPORATION)
  18579 C 1993-11-02  D. A. KEYSER -- STREAMLINED CODE; MORE INPUTS PASSED VIA
  18580 C     COMMON BLOCKS; ORIGINAL TABLE A ENTRY 'PREPOB' BROKEN INTO
  18581 C     SEPARATE TABLE A ENTRIES BASED ON DATA TYPES; INPUT MNEMONIC
  18582 C     STRINGS SPECIFIC TO TABLE A ENTRY
  18583 C 1994-08-11  D. A. KEYSER -- ELEV. AND RPT SEQ. NUMBER ENCODED INTO
  18584 C     REPORT HEADER (ALONG W/ OTHER DATA USED BY REANALYSIS PREPDATA
  18585 C     ONLY); VIRTUAL/REPORTED/DEWPOINT TEMP., WIND DIRECTION AND WIND
  18586 C     SPEED ALL ENCODED INTO REPORT LVL; RECEIPT TIME, REPORT SUB-TYPE
  18587 C     AND QCACFT WIND SPEED INCR. Q.M. (CONV'L/AMDAR AIRCFT WIND
  18588 C     REPORTS ONLY) ENCODED INTO REPORT HEADER
  18589 C 1995-07-12  D. A. KEYSER -- CAN PROCESS RGL/BUFR PREPDA (TEMPORARILY
  18590 C     DIFFERENT THAN GBL/PREPDA); PROGRAM CODE NOW ENCODED INTO BUFR/
  18591 C     PREPDA FOR ALL OBS. TYPES; THE FOLLOWING TYPES CAN NOW BE ENCODED
  18592 C     INTO BUFR/PREPDA (IF REQ.): 7-CHANNEL SSM/I BRIGHTNESS TEMPS AND
  18593 C     GOES PRECIP. WATER IN FOUR LAYERS; GOES & TOVS(BUFR) NOW ENCODE
  18594 C     MOISTURE Q.M. DIRECTLY FROM 'NOBS' Q.M. VALUE FOR MOISTURE,
  18595 C     BEFORE THEY ENCODED TEMP. Q.M. VALUE INTO MOISTURE Q.M. POSITION
  18596 C     LIKE ALL OTHER DATA TYPES; MNEMONIC 'TSB' (REPORT SUB-TYPE) NOW
  18597 C     USED TO HOLD INDICATOR FOR MISSING PHASE OF FLIGHT FOR AIRCRAFT
  18598 C     AMDAR REPORTS
  18599 C 1996-09-03  D. A. KEYSER -- PROCESSING OF TOVS RADIANCES PARTIALLY
  18600 C     DONE (SWITCH "TOVRAD")
  18601 C 1996-10-24  D. A. KEYSER -- LOGIC ADDED TO ENCODE TOVS RADIANCES
  18602 C     AND OTHER RELATED INFORMATION INTO PREPBUFR FILE, NEW MEMONICS
  18603 C     ADDED TO ACCOMPLISH THIS; N-LIST SWITCHES "TOVRAD" AND "TOVRTV"
  18604 C     ADDED TO PROCESS RADIANCES AND RETRIEVALS RESP.; ADDED LOGIC TO
  18605 C     ENCODE ERS SCATTEROMETER WIND REPORTS (R.TYPE=286) IN PREPBUFR
  18606 C     D-SET (USED TO BE APPENDED LATER); CORRECTED ERROR IN ENCODING OF
  18607 C     INITIAL VALUES FOR HEADER MNEMONICS "RQM", "DUP", "PRG", "SRC",
  18608 C     AND "RUD" (ONLY USED FOR REANALYSIS VERSION)
  18609 C 1997-05-01  D. A. KEYSER -- REASON CODES ENCODED INTO PREPBUFR
  18610 C 1997-06-02  D. A. KEYSER -- BUFR MNEMONIC "DHR" (REPORT D-TIME) SCALE
  18611 C     CHGED FROM 10**2 TO 10**3 FOR MORE PRECISION IN RPT TIME; ADDED
  18612 C     N-LIST SWITCH "FLDMGS" TO FLAG MOISTURE DATA ON ALL LEVELS FOR
  18613 C     GULF STREAM DROPS (IF TRUE)
  18614 C 1997-07-02  D. A. KEYSER -- ADDED LOGIC TO ENCODE GOES RADIANCES
  18615 C     INTO PREPBUFR FILE, USES SAME MNEMONICS AS TOVS RADIANCES (NEW
  18616 C     N-LIST SWITCH "GOESRD" ADDED TO SELECT PROCESSING OF GOES
  18617 C     RADIANCES)
  18618 C 1997-09-18   D. A. KEYSER -- CAN ENCODE ALTIM. SETTING IN PREPBUFR
  18619 C     WHEN PROCESSING SFC LAND DATA; ENCODES SKIN TEMP., CLOUD AMT.,
  18620 C     SOLAR ZENITH ANG., AND SAT. ZENITH ANG. IN PREPBUFR WHEN
  18621 C     PROCESSING GOES RADIANCES
  18622 C 1997-10-06  D. A. KEYSER -- ENCODES FOV# AS 'ACAV' INTO PREPBUFR FOR
  18623 C     GOES REPORTS

Page 446         Source Listing                  W3FIZZ
2017-04-18 11:09                                 prepdata.f

  18624 C 1998-02-17  D. A. KEYSER -- RECEIPT TIME NOW READ FROM HDR(5)
  18625 C 1998-06-15  D. A. KEYSER -- ENCODES SOLAR & IR RAD. CORRECTION
  18626 C     INDICATOR INTO PREPBUFR FILE AS MNEMONIC 'SIRC' (FOR "ADPUPA"
  18627 C     TYPES W/ VALID INSTR. TYPE)
  18628 C 1998-12-11  D. A. KEYSER -- REPLACED CALL TO "ABORT" WITH CALL TO
  18629 C     "BORT" (BUFRLIB ROUTINE)
  18630 C 1999-01-20  D. A. KEYSER -- ADDED N-LIST SWITCH "FLDMAF" WHICH CAN
  18631 C     FLAG MOISTURE DATA ON ALL LEVELS FOR USAF DROPS (IF TRUE)
  18632 C 1999-08-04  D. A. KEYSER -- REMOVED ENCODING OF 'RQM', 'DUP', 'PRG',
  18633 C     'SRC', 'RUD' AS THEY WERE ALWAYS MISSING (REANALYSIS RELATED) AND
  18634 C     WASTED LOTS OF SPACE; ADDED ENCODING OF PHASE OF FLIGHT ('POAF')
  18635 C     FOR ALL ACFT TYPES AND DEGREE OF TURBULENCE (DGOT) FOR NON-MDCRS
  18636 C     ACFT TYPES; ADDED PROCESSING OF MDCRS MOISTURE DATA BUT THEY ARE
  18637 C     FLAGGED FOR ALL REPORTS; RADIOSONDE BALLOON DRIFT LAT/LON ON EACH
  18638 C     LEVEL NOW ENCODED INTO PREPBUFR FILE WITH MNEMONICS "YDR" AND
  18639 C     "XDR"
  18640 C 2000-02-17  D. A. KEYSER -- CAN NOW PROCESS ATOVS DATA; ADDED
  18641 C     ENCODING OF NESDIS RECURSIVE FILTER FLAG ('RFFL') FOR NESDIS
  18642 C     (GOES) SATWND TYPES; UPDATED DEL-TIME ON UPPER-AIR RAOB AND PIBAL
  18643 C     LVLS (ALREADY CALC. BASED ON BALLOON DRIFT) AND ENCODED INTO
  18644 C     PREPBUFR FILE W/ MNEMONIC "HRDR"; ADDED MNEMONICS "RPT" (ORIG.
  18645 C     OBS. TIME) AND "TCOR" (IND. FOR CORRECTED OBS. TIME IN "DHR")
  18646 C     ENCODED INTO PREPBUFR FILE
  18647 C 2000-12-05  D. A. KEYSER -- NEW N-LIST SWITCH "FLACMS", WHEN TRUE
  18648 C     (DEF.) FLAGS ALL MDCRS MOISTURE DATA (WAS HARDWIRED AS FLAGGED);
  18649 C     METARS W/ MISSING WDIR & WSPD .LE. 3M/S ENCODE WSPD OBS/QM IN NEW
  18650 C     MNEM. "SOB" AND "SQM"
  18651 C 2001-04-06  D. A. KEYSER -- NOW PROCESSES SSM/I RAIN RATE UNDER R.TYP
  18652 C     150; ACCOUNTS FOR SUBR. W3UNPKB7 OUTPUTTING GOES PWATER AS AS MM
  18653 C     (PRECISE TO 10**2) RATHER THAN MM*100;  ACCOUNTS FOR SUBR.
  18654 C     IW3UNPBF OUTPUTTING SSM/I TPW IN MM (PRECISE TO 10**1) RATHER
  18655 C     THAN MM*10; FOR ALL SATELLITE TYPES EXCEPT SSM/I SUPEROBED
  18656 C     PRODUCTS, NOW ENCODES SATELLITE ID AS "SAID" IN PREPBUFR FILE;
  18657 C     ENCODES THE 4 MDCRS TURBULENCE INDECES INTO THE PREPBUFR FILE
  18658 C     UNDER MNEMONICS "TRBX10", "TRBX21", "TRBX32" AND "TRBX43";
  18659 C     ENCODES SURFACE PRESSURE INTO PREPBUFR FILE UNDER MNEMONIC "PRSS"
  18660 C     FOR GOES PW RETR. REPORTS
  18661 C 2001-06-19  D. A. KEYSER -- CAN NOW PROCESS GOES 1x1 FOV CLOUD TOP
  18662 C     REPORTS INTO PREPBUFR FILE UNDER R.T. 151 (MNEMONICS ARE "CDTP"/
  18663 C     CLOUD TOP PRESSURE, "TOCC"/CLOUD COVER, "GCDTT"/CLOUD TOP TEMP.);
  18664 C     SET GOES PW REPORT REASON CODES TO 100 (WERE MISSING); SET SSM/I
  18665 C     PW REPORT REASON CODE TO 100 (WAS MISSING); SET SSM/I RAINFALL
  18666 C     RATE REASON CODE TO 100 (WAS MISSING)
  18667 C 2001-09-14  D. A. KEYSER -- CORRECTED AN ERROR IN CALCULATING
  18668 C     RADIOSONDE BALLOON DRIFT D-TIME ("HRDR") FOR WIND REPORT
  18669 C     PRESSURE LEVELS THAT ARE ALSO FOUND IN THE CORRESPONDING MASS
  18670 C     REPORT ("HRDR" IS CALCULATED CORRECTLY FOR THE MASS REPORT LEVELS)
  18671 C 2001-10-10  D. A. KEYSER -- PROCESS NUMBER FROM THE MPI RUN (READ IN
  18672 C     VIA NAMELIST IN STDIN) ENCODED IN PREPBUFR UNDER MNEMONIC "PROCN"
  18673 C 2002-01-14  D. A. KEYSER -- LEVELS WITH REPORTED/CALC. DWPT < "TDLIM"
  18674 C     VALUE NOW CALC./RETAIN SPEC. HUM AND RETAIN/CALC. DWPT BUT
  18675 C     MOISTURE PREPBUFR TABLE VALUE IS FLAGGED WITH Q.M.=15 (BEFORE,
  18676 C     SPEC. HUM. AND DWPT HAD BEEN SET TO MISSING IN PREV. SUBROUTINES)
  18677 C 2002-01-28  D. A. KEYSER -- ENCODES PRECISION OF TEMP. OBS. INTO
  18678 C     PREPBUFR FILE UNDER MNEMONIC "PCAT" FOR MESSAGE TYPES "AIRCAR"
  18679 C     AND "AIRCFT" (ONLY AVAIL. FOR AMDAR AND MDCRS)
  18680 C 2004-09-09  D. A. KEYSER -- ADDED PROCESSING OF MESONET DATA, READ

Page 447         Source Listing                  W3FIZZ
2017-04-18 11:09                                 prepdata.f

  18681 C     FROM "MSONET" DUMP FILE DUMP R. TYPE 540, GET PREPBUFR R. TYPE
  18682 C     188/288, PROCESSED INTO PREPBUFR FILE UNDER NEW TBL A ENTRY
  18683 C     "MSONET"; ADDED PROCESSING OF GPS-IPW DATA, READ FROM "GPSIPW"
  18684 C     DUMP FILE DUMP R. TYPE 74, GET PREPBUFR R. TYPE 153, PROCESSED BY
  18685 C     NEW SUBR. "GETGPSIPW" INTO PREPBUFR FILE UNDER NEW TBL A ENTRY
  18686 C     "GPSIPW"; ADDED PROCESSING OF NPN AND CAP RASS DATA READ FROM
  18687 C     "RASSDA" DUMP FILE IN NEW DATA LVL CAT. 15, DUMP R. TYPE 77, GET
  18688 C     PREPBUFR R. TYPE 126, PROCESSED INTO PREPBUFR FILE UNDER NEW TBL
  18689 C     A ENTRY "RASSDA"; REPLACED CALL TO BUFRLIB ROUTINE "BORT" WITH
  18690 C     CALL TO W3LIB ROUTINE ERREXIT, WITH CONDITION CODE 59 IF THERE
  18691 C     ARE MORE THAN "MXBLVL" LEVELS IN A REPORT AT THE TIME IT IS ABOUT
  18692 C     TO BE ENCODED INTO THE PREPBUFR FILE
  18693 C 2006-07-14  D. A. KEYSER -- NO LONGER FAILS IF LIMIT OF "MXBLVL"
  18694 C     OUTPUT LEVELS IN PREPBUFR REPORT IS HIT, NOW PROCESSES BOTTOM
  18695 C     "MXBLVL" LEVELS AND SENDS DIAGNOSTIC TO JOBLOG
  18696 C 2007-09-14  D. A. KEYSER -- MODIFIED TO ENCODE NEW PARAMETERS "TRBX"
  18697 C     AND "ROLF" INTO PREPBUFR FILE FOR TAMDAR AIRCRAFT REPORTS;
  18698 C     MODIFIED TO ENCODE NEW PARAMETERS MRWVC, MRLWC, WSST, MWD10,
  18699 C     MWS10, WSEQC1, CHSQ, PHER, SPDE, SSTE, CLDE AND VPRE IN PREPBUFR
  18700 C     FILE FOR WINDSAT SCATTEROMETER REPORTS, UNDER NEW MESSAGE TYPE
  18701 C     "WDSATR"; MODIFIED TO HANDLE RETURN OF NEW ARGUMENT "RDATA2" FROM
  18702 C     CALLS TO W3UNPKB7 [1-DIM 21-WORD ARRAY WHICH HOLDS ADDITIONAL
  18703 C     VALUES DECODED DIRECTLY FROM BUFR (AND NOT IN "RDATA" ARRAY), FOR
  18704 C     SOME PARAMETERS REPLACING WHAT HAD BEEN RETURNED IN "RDATA" ARRAY
  18705 C     (IN THE HEADER)]; ADDED ENCODING OF PERCENT CONFIDENCE BASED ON -
  18706 C     EUMETSAT QUALITY INDEX WITH FORECAST CONSISTENCY TEST (MNEMONIC
  18707 C     "QIFY"), EUMETSAT QUALITY INDEX WITHOUT FORECAST CONSISTENCY TEST
  18708 C     (MNEMONIC "QIFN") AND NESDIS EXPECTED ERROR (MNEMONIC "EEQF") FOR
  18709 C     SATWND TYPES; FIXED BUG WHICH STORED BALLOON DRIFT COORDINATES
  18710 C     FROM PREVIOUS RAOB/PIBAL REPORT INTO DROPWINSONDE REPORT (DROPS
  18711 C     SHOULD HAVE MISSING BALLOON DRIFT COORDINATES); CASES WHERE OBS
  18712 C     ARE SET TO QM=15 IN ORDER TO FLAG A REPORT FOR NON-USE BY
  18713 C     ANALYSIS (EVEN THOUGH OBS MAY NOT NECESSARILY BE BAD) NOW FIRST
  18714 C     CHECK TO MAKE SURE OBS QM ISN'T ALREADY "BAD" (> 3 AND < 15)
  18715 C     (PREVENTS GSI FROM MONITORING TRULY BAD OBS WHICH JUST HAPPEN TO
  18716 C     BE IN REPORT GROUPS FLAGGED FOR NON- USE BY ANALYSIS); CHANGED
  18717 C     PROCESSING OF DROPSONDE MOISTURE: ACFT USING SWITCH "FLDMGS" (ALL
  18718 C     NOAA, INCL. P-3 AND GULF STREAM) MORE PRECISELY DEFINED TO ENSURE
  18719 C     THAT ONLY NOAA ACFT ARE AFFECTED BY THIS SWITCH, SWITCH "FLDMAF"
  18720 C     NOW REFERS EXCLUSIVELY TO USAF ACFT (HAD REFERRED TO ALL NON-NOAA
  18721 C     ACFT), NEW SWITCH "FLDMFR" REFERS TO NON-US (NON-NOAA AND NON-
  18722 C     USAF) ACFT (DEFAULTS TO TRUE - FLAG MOISTURE DATA ON ALL LEVELS)
  18723 C 2008-09-25  D. A. KEYSER -- CHANGES TO PREPBUFR ENCODING IN
  18724 C     PREPARATION FOR FUTURE DOWNSTREAM NRL AIRCRAFT Q.C. MODULE
  18725 C     (REPLACING CURRENT DOWNSTREAM PREPACQC AND ACARSQC MODULES) WHICH
  18726 C     WILL REPLICATE LEVEL DATA IN ITS GENERATION OF "PROFILES": SOME
  18727 C     MNEMONICS THAT WERE IN HEADER MOVED TO LEVEL INFO;  MOISTURE
  18728 C     QUALITY (CODE TABLE) FOR MDCRS REPORTS, ENCODED INTO PREPBUFR
  18729 C     FILE (MNEMONIC MSTQ) FOR USE BY FUTURE DOWNSTREAM NRL AIRCRAFT
  18730 C     Q.C. MODULE
  18731 C 2012-11-27  D. A. KEYSER -- INCREASED MAXIMUM POSSIBLE VALUE FOR SQN
  18732 C     (SEQUENCE NUMBER) ENCODED INTO PREPBUFR FILE FROM 99998 TO 524286
  18733 C     (NEEDED BECAUSE THERE CAN NOW BE > 99998 MDCRS REPORTS IN A
  18734 C     MONOLITHIC "AIRCAR" DUMP FILE - THIS CAUSES PREPACQC TO FAIL IN
  18735 C     SERIAL PREPBUFR PROCESSING RUNS, E.G. IN SDMEDIT)
  18736 C 2014-04-25  S. Melchior  --
  18737 C          - Modified to always encode wind speed obs in m/sec ("SOB")

Page 448         Source Listing                  W3FIZZ
2017-04-18 11:09                                 prepdata.f

  18738 C     and wind direction obs ("DDO") for all types of surface reports
  18739 C     (even if one or the other are missing but also if both are
  18740 C     present); removed old logic which encoded "SOB" only for METAR
  18741 C     reports when direction was missing and speed was .LE. 3 m/sec
  18742 C     (direction was never encoded in any situation for surface
  18743 C     reports), also removed encoding of "SQM" (wind speed quality
  18744 C     mark) for these types of METAR reports - all surface reports now
  18745 C     encode wind qm as "WQM" regardless of whether or not it also
  18746 C     encodes direction, speed, u-comp or v-comp {note this change does
  18747 C     not affect non-surface reports which can still encode speed
  18748 C     in knots ("FFO") and direction ("DDO") when "UOB" and "VOB" are
  18749 C     also encoded.
  18750 C          - Added new mnemonic "PMIN" (mean sea-level pressure
  18751 C     indicator) which is encoded with a value of zero for all surface
  18752 C     reports with an observed mean sea-level pressure encoded in
  18753 C     "PMO".  "PMIN" will be encoded with a value of 1 in w3emc routine
  18754 C     GBLEVENTS for cases where a mean sea-level pressure is derived
  18755 C     (see docblock in GBLEVENTS for more information).
  18756 C          - Report type 183 now stores moisture quality mark no lower
  18757 C     than 3 (suspect) (before type 183 stored observed moisture
  18758 C     quality mark read from the ADPSFC dump file).
  18759 C 2014-07-10  D. A. Keyser --
  18760 C          - Added encoding of "DFQ" (wind dir/speed quality mark) for
  18761 C     all types that aleady encode "DDO" (wind dir) and either "FFO"
  18762 C     (wind speed kts) or "SOB" (wind speed m/s) {"DFQ" will now be
  18763 C     encoded with overall wind quality mark in both cases when "UOB"
  18764 C     and "VOB" are encoded (then "DFQ" same as "WQM") and cases when,
  18765 C     for surface reports, "UOB" and "VOB" are not encoded because
  18766 C     either dir or speed is missing}.  Prior to this, "DFQ" was always
  18767 C     missing and the overall wind quality mark was always encoded in
  18768 C     "WQM" even when, for surface reports, "UOB" and "VOB" were
  18769 C     missing but either wind dir or speed was not.  Now, the entire
  18770 C     "W__EVENT" sequence "[UOB VOB WQM WPC WRC]" is skipped for
  18771 C     surface reports when "UOB" and "VOB" are both missing.
  18772 C          - Added encoding of "DFP" (wind dir/speed program code) for
  18773 C     surface reports in both cases when "UOB" and "VOB" are encoded
  18774 C     (then "DFP" same as "WPC") and when "UOB" and "VOB" are not
  18775 C     encoded because either dir or speed is missing.  Prior to this,
  18776 C     "DFP" was always missing in this case.
  18777 C          - Added encoding of "DFR" (wind dir/speed reason code), if
  18778 C     it is non-missing, in both cases when "UOB" and "VOB" are encoded
  18779 C     (then "DFR" same as "WRC") and cases when, for surface reports,
  18780 C     "UOB" and "VOB" are not encoded because either dir or speed is
  18781 C     missing.  Prior to this, "DFR" was always missing in either case.
  18782 C 2014-07-10  S. Melchior  -- Added logic to reset longitude to 0.0
  18783 C     when it is very close to 360.0. This ensures that array
  18784 C     clobbering will not occur if a report (with high precision
  18785 C     native lat/lon) is right at Prime Meridian.
  18786 C 2015-04-10  D. A. Keyser -- New namelist switch TDMAX, defined as the
  18787 C     upper limit for acceptable dewpoint temperature obs (the moisture
  18788 C     on any level, for any report type, with dewpoint temperature on
  18789 C     that level > TDMAX will be flagged with QM=15 here and encoded in
  18790 C     the PREPBUFR file if it is not already flagged as bad).
  18791 C 2016-08-15 JWhiting -- For all GPS data streams (i.e., NC012003-004),
  18792 C     store zenith total delay (m) and its error (m), along with
  18793 C     hardwired azimuth (0.0 deg) and elevation (90.0 deg) angles into
  18794 C     holding arrays for subsequent output.

Page 449         Source Listing                  W3FIZZ
2017-04-18 11:09                                 prepdata.f

  18795 C 2016-09-01  D. A. Keyser -- New BUFRLIB routine NEMSPECS is
  18796 C     integrated into code.
  18797 C 2016-11-25  D. A. Keyser --
  18798 C      - Encodes instantaneous altitude rate (IALR) into PREPBUFR file
  18799 C        for TAMDARB reports in report type 134/234 (returned from c.f.
  18800 C        932 in call to IW3UNPBF).
  18801 C 2016-11-30  D. A. Keyser --
  18802 C      - Diagnostic output print statements formatted to accommodate
  18803 C        increased precision now in latitude and longitude.
  18804 C         - Replace machine length lat/lon {HDR(3), HDR(2)} with R*8
  18805 C           lat/lon (ALAT_8, ALON_8) in print statements.
  18806 C        BENEFIT: Values are now precise to 10**5 degrees.
  18807 C
  18808 C USAGE:    CALL FIZZ01(KI,NI,JI,SUBSET,SINGLE)
  18809 C   INPUT ARGUMENT LIST:
  18810 C     KI       - HUNDRED'S DIGIT OF RPT'S PREPBUFR REPORT TYPE (1-2)
  18811 C     NI       - TEN'S  DIGIT OF REPORT'S PREPBUFR REPORT TYPE (0-9)
  18812 C     JI       - UNIT'S DIGIT OF REPORT'S PREPBUFR REPORT TYPE (0-9)
  18813 C     SUBSET   - CHARACTER*8 TABLE A ENTRY (MESSAGE TYPE) FOR THIS
  18814 C              - PARTICULAR REPORT
  18815 C     SINGLE   - LOGICAL SWITCH DEFINING WHETHER THIS TABLE A ENTRY
  18816 C              - (MESSAGE TYPE) IS SINGLE-LEVEL
  18817 C
  18818 C REMARKS: CALLED BY SUBROUTINE W3FIZZ.
  18819 C
  18820 C ATTRIBUTES:
  18821 C   LANGUAGE: FORTRAN 90
  18822 C   MACHINE:  NCEP WCOSS
  18823 C
  18824 C$$$
  18825       SUBROUTINE FIZZ01(KI,NI,JI,SUBSET,SINGLE)
  18826 
  18827       PARAMETER (MXWRDH = 15)
  18828       PARAMETER (MXTYPV =  3)
  18829       PARAMETER (MXWRDL =  6)
  18830       PARAMETER (MXLVL = 600)
  18831       PARAMETER (MXPWT =  5)
  18832       PARAMETER (MXBLVL = 255, MHDRWD = 29, MOBSWD = 12, MOB2WD = 6)
  18833       PARAMETER (MQMSWD =  9)
  18834       PARAMETER (MPGMWD =  9)
  18835       PARAMETER (MAXOBS = 3500)
  18836 
  18837       DIMENSION IPWOBT(2:5),IPWQMT(2:5),IPWPCT(2:5)
  18838 
  18839       LOGICAL  CAT6,OUT,SINGLE,LMAND(0:1200),TOVRAD,FLAGM1,FLAGM2,
  18840      $ FLAGM3,FLAGM4,FLAGM5,FLAGM6,FLDMGS,FLDMAF,FLDMFR,FLACMS,GOESRD,
  18841      $ FLRECO
  18842 
  18843       REAL(8)  BMISS,alon_8,alat_8,hdr_8
  18844 
  18845       INTEGER  IDATA(MAXOBS)
  18846 
  18847       CHARACTER*5  CMXBLVL
  18848       CHARACTER*8  SUBSET,STNID,SUBSET_d
  18849 
  18850       COMMON/ADP/ISATOB,PMAND(23),RDATA(MAXOBS),IPRINT
  18851       COMMON/STRCTY/ICAT(MXLVL)

Page 450         Source Listing                  FIZZ01
2017-04-18 11:09                                 prepdata.f

  18852       COMMON/STRMOB/MOBS(MXTYPV,MXWRDL,MXLVL)
  18853       COMMON/STRMSL/IPMSL(MXTYPV)
  18854       COMMON/STRPWT/PWAT(MXTYPV,MXPWT)
  18855       COMMON/STRRRT/REQV
  18856       COMMON/FIZZAA/PCODE,IUNITP,NLV,NBT,HDR_8(MHDRWD),
  18857      $ OBS(MOBSWD,MXBLVL),OB2(MOB2WD,MXBLVL),QMS(MQMSWD,MXBLVL),
  18858      $ PGM(MPGMWD,MXBLVL),RSN(MPGMWD,MXBLVL),BTO(2,MXBLVL),RAD(5),
  18859      $ IUNITG(2)
  18860       COMMON/RPTHDR/SUBSET_d,STNID,HDR(2:MXWRDH),alon_8,alat_8
  18861       COMMON/LEVELS/MLEV
  18862       COMMON/PARM3/RECCON,RWINDO,UWINDO,RECSLM,FLRECO,VWINDO,VADWIN,
  18863      $ IVADFL,IVADSP,FLDMGS,FLDMAF,FLDMFR,DROPSN,DWINDO
  18864       COMMON/RADANC/RTRAD(35),GRAD(18),IGCHN(18),SOZANG,SAZANG,OZONE,
  18865      $ SKINT,CLDAMT,TOVRAD,TOVRTV,GOESRD(2)
  18866       COMMON/CLDTOP/CLTOP(2,3)
  18867       COMMON/ACFTSW/AWINDO(2,9),AIRLND(6,9),JAWIND(6,9),JAMASS(6,9),
  18868      $ IACFTL(9),IACFTH(9),PHIACF(7),KEPAC(6,9),AIFNOW(9),POAF,TRBX(5),
  18869      $ FLACMS(9),PCAT,ROLF,aMSTQ,RIALR
  18870       COMMON/SATSW3/PHISWN(7),SWNLND(6,8,10),SWINDO_e(6,8,10),
  18871      $ SWINDO_l(6,8,10),JSWIND(6,8,10),JSMASS(6,8,10),KEPSW(6,8,10),
  18872      $ KSKSWD(10),RFFL,QIFY,QIFN,EEQF
  18873       COMMON/MISWCH/XWINDO(6,4),JPSSMI(6,4),SRAD(7),KNTSMI(4),KTIMM(4),
  18874      $ KSKPMI,KMSGMI,KBDYMI
  18875       COMMON/SFCBFR/ALTIMR,PRSS
  18876       COMMON/UNITNO/NFILE,IUNIT(28)
  18877       COMMON/DRIFT/DFTLON(MXLVL),DFTLAT(MXLVL),DFTTIM(MXLVL)
  18878       COMMON/DATA/KOUNT,IDATE(4),IDAT10,MP_PROCESS,WRMISS
  18879       COMMON/UPALIM/LEVPM,LEVST,LEVQQ,TDLIM,TDMAX,SPCIAL,ISQNUM_UPA
  18880       COMMON /BUFRLIB_MISSING/BMISS
  18881 
  18882       EQUIVALENCE  (RDATA,IDATA)
  18883 
  18884       DATA  YMISS/99998.8/,IPWOBT/2,3,10,11/,IPWQMT/2,6,7,8/,
  18885      $ IPWPCT/3,4,7,8/,IMISS/99999/
  18886       DATA  LMAND/.FALSE.,3*.TRUE.,.FALSE.,.TRUE.,.FALSE.,.TRUE.,
  18887      $ 2*.FALSE.,.TRUE.,9*.FALSE.,.TRUE.,9*.FALSE.,.TRUE.,19*.FALSE.,
  18888      $ .TRUE.,19*.FALSE.,.TRUE.,29*.FALSE.,.TRUE.,49*.FALSE.,.TRUE.,
  18889      $ 49*.FALSE.,.TRUE.,49*.FALSE.,.TRUE.,49*.FALSE.,.TRUE.,99*.FALSE.,
  18890      $ .TRUE.,99*.FALSE.,.TRUE.,199*.FALSE.,.TRUE.,149*.FALSE.,.TRUE.,
  18891      $ 74*.FALSE.,.TRUE.,74*.FALSE.,.TRUE.,200*.FALSE./
  18892 
  18893       CAT6 = (SUBSET(1:3).EQ.'AIR'.OR.SUBSET.EQ.'SATWND  ')
  18894 
  18895 C INITIALIZE ARRAYS AS MISSING (BMISS), NUMBER OF LEVELS AS ZERO
  18896       HDR_8  = BMISS
  18897       OBS  = BMISS
  18898       OB2  = BMISS
  18899       QMS  = BMISS
  18900       PGM  = BMISS
  18901       RSN  = BMISS
  18902       BTO  = BMISS
  18903       RAD  = BMISS
  18904       PSFC = BMISS
  18905       NLV  = 0
  18906       NBT  = 0
  18907 
  18908 C STORE THE LON, LAT, REPORT D-TIME, PREPBUFR R. TYPE, DUMP R. TYPE,

Page 451         Source Listing                  FIZZ01
2017-04-18 11:09                                 prepdata.f

  18909 C  REPORT SUBTYPE, INSTRUMENT TYPE, ELEVATION, REPORT SEQUENCE NUMBER,
  18910 C  SOLAR AND INFRARED RADIATION CORRECTION INDICATOR, NESDIS RECURSIVE
  18911 C  FILTER FLAG {NUMERIC (SUBSET=SATWND ONLY)}, REPORTED OBSERVATION
  18912 C  TIME, INDICATOR FOR CORRECTED OBSERVATION TIME, SATELLITE ID
  18913 C  (SATELLITE DATA TYPES ONLY), PROCESS NUMBER FOR THIS MPI RUN,
  18914 C  {"HDR_8" WORDS 2-29 (NOTE: SOME WORDS HERE ARE SKIPPED)}
  18915 
  18916 C If reported lon is 360. (to PREPBUFR table precision), change it
  18917 C  to 0. . {Note: prior to BUFRLIB v11.0.0, the scaling for XOB in
  18918 C  the PREPBUFR table was 2 (0.01 precision), so this will be the
  18919 C  default - beginning with BUFRLIB v11.0.0 the scale in the PREPBUFR
  18920 C  table will be determined via a call to BUFRLIB routine NEMSPECS
  18921 C  (will allow for future increases in precision)}
  18922 
  18923       NSCL0 = 2
  18924       call NEMSPECS(iunitp,'XOB',1,NSCL, NREF, NBTS, IRET)
  18925       if(IRET.eq.0)  NSCL0 = NSCL
  18926       IF(NINT(alon_8*10**NSCL0).EQ.360*10**NSCL0) alon_8 = 0.0
  18927       HDR_8(2) = alon_8
  18928       HDR_8(3) = alat_8
  18929       HDR_8(4) = HDR(4)
  18930       IF(SUBSET.EQ.'SATWND  ')  THEN
  18931 C FOR SUBSET = SATWND .....
  18932          IF(RFFL.LT.YMISS)  HDR_8(16) = RFFL
  18933          IF(QIFY.LT.YMISS)  HDR_8(27) = QIFY
  18934          IF(QIFN.LT.YMISS)  HDR_8(28) = QIFN
  18935          IF(EEQF.LT.YMISS)  HDR_8(29) = EEQF
  18936       END IF
  18937       HDR_8(6) = HDR(6)
  18938       HDR_8(7) = HDR(7)
  18939       IF(HDR(8).LT.YMISS)  HDR_8(8) = HDR(8)
  18940       HDR_8(9) = HDR(9)
  18941       IF(HDR(10).LT.YMISS)  HDR_8(10) = HDR(10)
  18942 ccdak IF(HDR(11).LT.YMISS)  HDR_8(11) = HDR(11)
  18943                                        !SQN can now be > XMISS (99999.)
  18944       IF(HDR(11).LT.YMISS*10.) HDR_8(11)= HDR(11)
  18945       IF(HDR(12).LT.YMISS)  HDR_8(12) = HDR(12)
  18946       HDR_8(17) = HDR(13)
  18947       HDR_8(18) = HDR(14)
  18948       IF(HDR(15).LT.YMISS)  HDR_8(21) = HDR(15)
  18949       HDR_8(22) = MP_PROCESS
  18950 
  18951       IF(HDR(6).GT.151.AND.HDR(6).LT.160)  THEN
  18952 C***********************************************************************
  18953 C          PRECIPITABLE WATER & ZENITH TOTAL DELAY (LATTER GPS ONLY)
  18954 C                           PROCESSING COMES HERE
  18955 C   UNIQUE REPORTS - NOTHING ELSE WILL BE ENCODED INTO PREPBUFR FILE
  18956 C***********************************************************************
  18957 C STORE PRECIPITABLE WATER OBS., TABLE VALUE, PROGRAM CODE & REASON CODE
  18958 C DATA LEVEL CATEGORY IS STORED AS 6 (NOT DEFINED IN ICAT ARRAY)
  18959          OBS(7,1) = 6
  18960          IF(HDR(6).EQ.152.OR.HDR(6).EQ.153)  THEN
  18961 C   --> SSM/I OR GPS-IPW TOTAL COLUMN
  18962             IF(PWAT(1,1).LT.YMISS.AND.NINT(PWAT(1,1)*10.).GE.0)  THEN
  18963                OBS(12,1) = PWAT(1,1)
  18964                QMS(6,1)  = MIN(15,NINT(PWAT(2,1)))
  18965                PGM(7,1)  = PCODE

Page 452         Source Listing                  FIZZ01
2017-04-18 11:09                                 prepdata.f

  18966                RSN(7,1)  = 100.
  18967                NLV = 1
  18968                IF(HDR(6).EQ.153.AND.PRSS.LT.YMISS) OBS(11,1) =PRSS*100.
  18969             END IF
  18970 
  18971             IF(HDR(6).EQ.153)  THEN
  18972 C FOR GPS-IPW/ZTD REPORTS, STORE NON-MISSING ATMOSPHERIC PATH DELAY IN
  18973 C  SATELLITE SIGNAL (M) AND ITS ERROR (M) (from ZTD and Error in ZTD
  18974 C  previously read into cat 14 rdata array slots  5 & 6), ALONG WITH
  18975 C  HARDWIRED AZIMUTH ANGLE OF 0.0 (DEG) AND ELEVATION ANGLE OF 90.0
  18976 C  (DEG) - THESE WILL LATER BE OUTPUT IN SUBR. W3FIZZ
  18977                LL=idata(44)
  18978                if(idata(43).gt.0)  then
  18979                   if (rdata(LL+4).lt.ymiss) then
  18980                      ob2(3,1)=rdata(LL+4)                          !APDS
  18981                      if (rdata(LL+5).lt.ymiss) ob2(4,1)=rdata(LL+5)!APDE
  18982                      ob2(1,1) =  0.0                               !BEARAZ
  18983                      ob2(2,1) = 90.0                               !ELEV
  18984                   end if
  18985                end if
  18986             end if ! hdr(6) == 153
  18987          ELSE
  18988 C   --> GOES SIGMA LAYER (1. TO .9, .9 TO .7, .7 TO .3, AND .3 TO 0.)
  18989             DO IPWTYP = 2,5
  18990                IF(PWAT(1,IPWTYP).LT.YMISS.AND.NINT(PWAT(1,IPWTYP)*10.)
  18991      $          .GE.0)  THEN
  18992                   OBS(IPWOBT(IPWTYP),1) = PWAT(1,IPWTYP)
  18993                   QMS(IPWQMT(IPWTYP),1) = MIN(15,NINT(PWAT(2,IPWTYP)))
  18994                   PGM(IPWPCT(IPWTYP),1) = PCODE
  18995                   RSN(IPWPCT(IPWTYP),1) = 100.
  18996                   NLV = 1
  18997                END IF
  18998             ENDDO
  18999             IF(PRSS.LT.YMISS)  OBS(12,1) = PRSS * 100.
  19000          END IF
  19001 
  19002       ELSE  IF(HDR(6).EQ.150)  THEN
  19003 C***********************************************************************
  19004 C                SSM/I RAIN RATE PROCESSING COMES HERE
  19005 C    UNIQUE REPORTS - NOTHING ELSE WILL BE ENCODED INTO PREPBUFR FILE
  19006 C                (CAN NEVER BE MISSING FOR R.TYPE 150)
  19007 C***********************************************************************
  19008 C DATA LEVEL CATEGORY IS STORED AS 6 (NOT DEFINED IN ICAT ARRAY)
  19009          OBS(7,1) = 6
  19010 C STORE RAIN RATE OBS., TABLE VALUE, PROGRAM CODE AND REASON CODE
  19011          OB2(1,1) = REQV
  19012          QMS(7,1) = 2
  19013          PGM(8,1) = PCODE
  19014          RSN(8,1)  = 100.
  19015          NLV = 1
  19016 
  19017       ELSE  IF(HDR(6).EQ.151)  THEN
  19018 C***********************************************************************
  19019 C                GOES CLOUD TOP PROCESSING COMES HERE
  19020 C    UNIQUE REPORTS - NOTHING ELSE WILL BE ENCODED INTO PREPBUFR FILE
  19021 C        (CLOUD TOP PRESSURE CAN NEVER BE MISSING FOR R.TYPE 151)
  19022 C***********************************************************************

Page 453         Source Listing                  FIZZ01
2017-04-18 11:09                                 prepdata.f

  19023 C DATA LEVEL CATEGORY IS STORED AS 6 (NOT DEFINED IN ICAT ARRAY)
  19024          OBS(7,1) = 6
  19025 C STORE CLOUD TOP PRESSURE OBS., TABLE VALUE, PROGRAM CODE & REASON CODE
  19026          OB2(1,1) = CLTOP(1,1) * 100.
  19027          QMS(9,1)  = MIN(15,NINT(CLTOP(2,1)))
  19028          PGM(9,1)  = PCODE
  19029          RSN(9,1)  = 100.
  19030 C STORE TOTAL CLOUD COVER OBS. AND CLOUD TOP TEMPERATURE OBS. (THESE
  19031 C  CAN BE MISSING)
  19032          IF(CLTOP(1,2).LT.YMISS)  OB2(2,1) = CLTOP(1,2)
  19033          IF(CLTOP(1,3).LT.YMISS)  OB2(3,1) = CLTOP(1,3)
  19034          NLV = 1
  19035 
  19036       ELSE  IF(HDR(6).EQ.102)  THEN
  19037 C***********************************************************************
  19038 C          STORE SSM/I BRIGHTNESS TEMPERATURE FOR SEVEN CHANNELS
  19039 C    UNIQUE REPORTS - NOTHING ELSE WILL BE ENCODED INTO PREPBUFR FILE
  19040 C***********************************************************************
  19041          IRFLG = 0
  19042          DO LL = 1,7
  19043             NBT = NBT + 1
  19044             BTO(1,NBT) = LL
  19045             IF(SRAD(LL).LT.YMISS)  THEN
  19046                BTO(2,NBT) = SRAD(LL)
  19047                IRFLG = 1
  19048             END IF
  19049          ENDDO
  19050          IF(IRFLG.EQ.0)  NBT = 0
  19051 
  19052       ELSE
  19053 C***********************************************************************
  19054 C                     EVERYTHING ELSE COMES HERE
  19055 C (INCLUDING TRADITIONAL DATA STORED IN MOBS ARRAY, PLUS RTOVS OR ATOVS)
  19056 C                     RADIANCES, GOES RADIANCES)
  19057 C***********************************************************************
  19058 C-----------------------------------------------------------------------
  19059 C  MLEV = 0 MEANS THERE ARE NO DATA IN THE MOBS ARRAY FOR THIS REPORT
  19060 C THIS REPORT IS PROBABLY A RADIANCE REPORT, EITHER RTOVS, ATOVS OR GOES
  19061 C-----------------------------------------------------------------------
  19062 C   MLEV > 0 MEANS THERE ARE DATA IN THE MOBS ARRAY FOR THIS REPORT
  19063 C  THERE MAY ALSO BE RADIANCES FOR THIS REPORT IF IT IS AN RTOVS, ATOVS
  19064 C      OR GOES REPORT (THE SOUNDINGS AND RADIANCES ARE COMBINED
  19065 C       AS A SINGLE REPORT WITH A COMMON PREPBUFR REPORT TYPE)
  19066 C-----------------------------------------------------------------------
  19067          IF(MLEV.EQ.0)  GO TO 111
  19068 C-----------------------------------------------------------------------
  19069 C    LOOP THRU ALL LEVELS OF OBSERVATION - STORE APPROPRIATE DATA
  19070 C     (DOESN'T INCLUDE RTOVS, ATOVS AND GOES RADIANCE OBS- LATER)
  19071 C-----------------------------------------------------------------------
  19072          IFRST1 = 1
  19073          IFRST2 = 1
  19074          IFRST3 = 1
  19075          DO L = 1,MLEV
  19076 C PARSE OUT DATA IN MOBS ARRAY FOR THIS LEVEL
  19077             OBS1 = MOBS(1,1,L)
  19078 C IF PRESSURE ON THIS LEVEL IS MISSING, SKIP THIS LEVEL
  19079             IF(OBS1.GE.YMISS)  CYCLE

Page 454         Source Listing                  FIZZ01
2017-04-18 11:09                                 prepdata.f

  19080             QMS1 = MIN(15,MOBS(2,1,L))
  19081             RSN1 = MOBS(3,1,L)
  19082             OBS2 = MOBS(1,2,L)
  19083             QMS2 = MIN(15,MOBS(2,2,L))
  19084             RSN2 = MOBS(3,2,L)
  19085             OBS3 = MOBS(1,3,L)
  19086             QMS3 = MIN(15,MOBS(2,3,L))
  19087             RSN3 = MOBS(3,3,L)
  19088             OBS4 = MOBS(1,4,L)
  19089             QMS4 = MIN(15,MOBS(2,4,L))
  19090             RSN4 = MOBS(3,4,L)
  19091             OBS5 = MOBS(1,5,L)
  19092             OBS6 = MOBS(1,6,L)
  19093 C OUT=.TRUE. --> NO VALID DATA ON THIS LEVEL
  19094             OUT = (MIN(OBS2,OBS3,OBS4,OBS5,OBS6).GE.YMISS)
  19095             IF(L.EQ.1)  THEN
  19096 
  19097 C --> PROCESSING UNIQUE TO FIRST MOBS LEVEL
  19098 
  19099                IF(IPMSL(1).LT.YMISS)  THEN
  19100 C STORE MEAN SEA-LEVEL PRESSURE OBS., TABLE VALUE, and indicator
  19101 C  {CURRENTLY IPMSL(1) VALID ONLY FOR SURFACE MASS REPORTS}
  19102                   OB2(1,1) = IPMSL(1) * 0.1
  19103                   QMS(7,1)  = MIN(15,IPMSL(2))
  19104                   ob2(3,1) = 0.! indicator (PMIN) is 0 for observed PMSL
  19105                END IF
  19106                IF(MOBS(2,1,1).EQ.99.OR.NI.GE.8)  THEN
  19107 C RAOB, PIBAL, MULTI-LEVEL RECCOS, DROPS, CLASS, PROFILER, VAD WINDS,
  19108 C  RASS, ALL SAT. RETR. TYPES & ALL SFC TYPES HOLD SURFACE (STN)
  19109 C  PRESSURE IN FIRST LVL
  19110                   PSFC = OBS1
  19111                ELSE  IF((FLRECO.AND.ICAT(1).EQ.2).AND.SUBSET.EQ.
  19112      $          'ADPUPA  ')  THEN
  19113 C RECCOS WITH PMSL OBS ALSO HOLD SFC PRESSURE IN FIRST LVL
  19114                   PSFC = OBS1
  19115                END IF
  19116             END IF
  19117 
  19118 C IF NO VALID DATA ON THIS LEVEL, GO ON TO NEXT LEVEL
  19119             IF(OUT)  CYCLE
  19120 
  19121             IF(NLV+1.LE.MXBLVL) THEN
  19122                NLV = NLV + 1
  19123 C.......................................................................
  19124 C STORE LEVEL PRESSURE OBS, TABLE VALUE, PROGRAM CODE AND REASON CODE
  19125 C If ipstnflg=0, Pstn (OBS1) was never manipulated so encode original/
  19126 C current value. If ipstnflg=1, Pstn was estimated for surface reports
  19127 C with missing pressure that are set to be kept (npkrpt=T for the
  19128 C particular type) - this pstn is also encoded (q.m. is minimum of 3)
  19129 C (Note: ipstnflg is not passed into this subroutine as it is not used)
  19130                OBS(1,NLV) = OBS1 * 0.1
  19131                QMS(1,NLV) = QMS1
  19132                PGM(1,NLV) = PCODE
  19133                IF(RSN1.LT.YMISS)  RSN(1,NLV) = RSN1
  19134 C DATA LEVEL CATEGORY PROCESSING
  19135                IF(.NOT.SINGLE)  THEN
  19136 C FOR SINGLE = FALSE, THE DEFAULT DATA LEVEL CATEGORY IS SET TO 2

Page 455         Source Listing                  FIZZ01
2017-04-18 11:09                                 prepdata.f

  19137                   OBS(7,NLV) = 2
  19138                ELSE
  19139 C FOR SINGLE = TRUE, THE DEFAULT DATA LEVEL CATEGORY IS SET TO 6
  19140                   OBS(7,NLV) = 6
  19141                END IF
  19142                IF(ICAT(L).LT.IMISS)  THEN
  19143 C FOR THOSE TYPES WITH A VALID DATA LEVEL CATEGORY IN ICAT ARRAY
  19144 C  (SUBSET = PROFLR, ADPUPA, VADWND, RASSDA, AIRCAR, AIRCFT OR SATWND)
  19145 C  STORE THIS DIRECTLY
  19146                   OBS(7,NLV) = ICAT(L)
  19147                ELSE  IF(SUBSET.EQ.'SATEMP  '.OR.SUBSET.EQ.'GOESND  ')
  19148      $          THEN
  19149 C FOR SUBSET = SATEMP OR GOESND - IF PRESSURE IS MAND SET CAT. TO 1
  19150                   IF(MOD(MOBS(1,1,L),10).EQ.0)  THEN
  19151                      IF(LMAND(MOBS(1,1,L)/10))  OBS(7,NLV) = 1
  19152                   END IF
  19153                END IF
  19154 C.......................................................................
  19155                IF(SUBSET.EQ.'ADPSFC  '.OR.SUBSET.EQ.'MSONET  ')  THEN
  19156 C FOR SUBSET = ADPSFC OR MSONET, STORE ALTIMETER SETTING OBS. IF NON-
  19157 C  MISSING
  19158                   IF(ALTIMR.LT.YMISS)  OB2(2,NLV) = ALTIMR * 10.
  19159                ELSE  IF(HDR(6).EQ.120.OR.HDR(6).EQ.220.OR.
  19160      $                  HDR(6).EQ.221)  THEN
  19161 C FOR REPORT TYPES 120, 220 OR 221 (IN SUBSET = ADPUPA), STORE RAOB/
  19162 C  PIBAL BALLOON DRIFT LAT/LON AND TIME OBS. IF NON-MISSING
  19163                   IF(MAX(DFTLON(L),DFTLAT(L)).LT.YMISS) THEN
  19164                      OBS(12,NLV) = DFTLON(L)
  19165                      OB2( 1,NLV) = DFTLAT(L)
  19166                      IF(DFTTIM(L).LT.YMISS)  THEN
  19167                         D_DFTTIM = DFTTIM(L) - IDATE(4)
  19168                         IF(D_DFTTIM.GT. 12.)  D_DFTTIM = D_DFTTIM - 24.
  19169                         IF(D_DFTTIM.LT.-12.)  D_DFTTIM = D_DFTTIM + 24.
  19170                         OB2(2,NLV) = D_DFTTIM
  19171                      END IF
  19172                   END IF
  19173                ELSE IF(SUBSET.EQ.'AIRCFT  '.OR.SUBSET.EQ.'AIRCAR  ')THEN
  19174 C FOR SUBSET = AIRCFT or AIRCAR, STORE PHASE OF FLIGHT (NUMERIC) AND
  19175 C  PRECISION OF TEMPERATURE OBSERVATION, IF NON-MISSING
  19176                   IF(POAF.LT.YMISS)  OB2(2,NLV) = POAF
  19177                   IF(PCAT.LT.YMISS)  OB2(3,NLV) = PCAT
  19178                   IF(SUBSET.EQ.'AIRCFT  ')  THEN
  19179 C FOR SUBSET = AIRCFT, STORE THE RECEIPT TIME (HOURS), ROLL FLAG
  19180 C  (NUMERIC), TURBULENCE INDEX (NUMERIC), INSTANTANEOUS ALTITUDE RATE IF
  19181 C  NON-MISSING
  19182                      IF(HDR(5).LT.YMISS)  OBS(12,NLV) = HDR(5)
  19183                      IF(ROLF.LT.YMISS)     OB2( 1,NLV) = ROLF
  19184                      IF(TRBX(5).LT.YMISS)  OB2( 4,NLV) = TRBX(5)
  19185                      IF(RIALR.LT.YMISS)    OB2( 5,NLV) = RIALR
  19186                   ELSE
  19187 C FOR SUBSET = AIRCAR, STORE TURBULENCE INDEX-TIME BASED (NUMERIC) AND
  19188 C  MOISTURE QUALITY (CODE TABLE)
  19189                      IF(TRBX(1).LT.YMISS)  OBS(12,NLV) = TRBX(1)
  19190                      IF(TRBX(2).LT.YMISS)  OB2( 1,NLV) = TRBX(2)
  19191                      IF(TRBX(3).LT.YMISS)  OB2( 4,NLV) = TRBX(3)
  19192                      IF(TRBX(4).LT.YMISS)  OB2( 5,NLV) = TRBX(4)
  19193                      IF(aMSTQ  .LT.YMISS)  OB2( 6,NLV) = aMSTQ

Page 456         Source Listing                  FIZZ01
2017-04-18 11:09                                 prepdata.f

  19194                   END IF
  19195                END IF
  19196                IF(KI.EQ.2)  THEN
  19197 C-----------------------------------------------------------------------
  19198 C                    WIND PROCESSING COMES HERE
  19199 C-----------------------------------------------------------------------
  19200                   IF(RSN3.NE.RSN4)  THEN
  19201       PRINT'(" ~~ R.C. FOR U- AND V- WIND DO NOT AGREE FOR THIS STN -",
  19202      $ " USE LOWER OF 2 R.C. FOR WIND R.C. IN PREPBUFR FILE")'
  19203                      RSN4 = MIN(RSN3,RSN4)
  19204                   END IF
  19205                   IF(MAX(OBS3,OBS4).LT.YMISS) THEN
  19206 C STORE U- & V-COMP OBS; WIND TABLE VALUE, PROGRAM CODE AND REASON CODE
  19207                      OBS(2,NLV) = OBS3 * .01
  19208                      OBS(3,NLV) = OBS4 * .01
  19209                      IF(QMS3.NE.QMS4)  THEN
  19210       PRINT'(" ~~ Q.M. FOR U- AND V- WIND DO NOT AGREE FOR THIS STN -",
  19211      $ " USE HIGHER OF 2 Q.M. FOR WIND Q.M. IN PREPBUFR FILE")'
  19212                         QMS4 = MAX(QMS3,QMS4)
  19213                      END IF
  19214                      QMS(2,NLV) = QMS4
  19215                      PGM(3,NLV) = PCODE
  19216                      IF(RSN4.LT.YMISS)  RSN(3,NLV) = RSN4
  19217 C.......................................................................
  19218                      if(subset.ne.'ADPSFC'.and.subset.ne.'SFCSHP'.and.
  19219      $                  subset.ne.'MSONET') then
  19220                         IF(MAX(OBS5,OBS6).LT.YMISS) THEN
  19221 C For non-surface reports, STORE WIND DIRECTION AND SPEED (KNOTS) OBS
  19222 C  if BOTH are present - also store WIND direction/speed PROGRAM CODE
  19223 C  (note: this can only happen if u-comp and v-comp wind obs are also
  19224 C         BOTH present)
  19225                            OBS(10,NLV) = OBS5
  19226                            OBS(11,NLV) = OBS6
  19227                            qms(8,nlv)  = qms4
  19228                            PGM(4,NLV)  = PCODE
  19229                            if(rsn4.lt.ymiss)  rsn(4,nlv) = rsn4
  19230                         END IF
  19231                      end if
  19232 C.......................................................................
  19233                      IF(OBS2.LT.YMISS)  THEN
  19234 C IF SUBSET = AIRCAR, AIRCFT, OR SATWND (CAT. 6 LVLS) OR IF A CAT. 4
  19235 C  LVL (SUBSET = ADPUPA, PROFLR, OR VADWND) OR A CAT. 6 LVL (SUBSET
  19236 C  = ADPUPA FOR RECCOS), STORE PRESS-ALT. OBS, TABLE VALUE, PROGRAM CODE
  19237 C  AND REASON CODE
  19238                         IF(CAT6.OR.OBS(7,NLV).EQ.4.OR.OBS(7,NLV).EQ.6)
  19239      $                   THEN
  19240 C May need to fix above to next line after testing????
  19241 cdak                    IF(CAT6.OR.OBS(7,NLV).EQ.4.OR.(.NOT..SINGLE.AND.
  19242 cdak $                   OBS(7,NLV).EQ.6) THEN
  19243                            OBS(6,NLV) = OBS2
  19244                            QMS(5,NLV) = QMS2
  19245                            PGM(2,NLV) = PCODE
  19246                            IF(RSN2.LT.YMISS)  RSN(2,NLV) = RSN2
  19247                         END IF
  19248                      END IF
  19249 C.......................................................................
  19250 C FOR SUBSET = WDSATR, STORE RAIN RATE (MM/SEC) OBS

Page 457         Source Listing                  FIZZ01
2017-04-18 11:09                                 prepdata.f

  19251 C.......................................................................
  19252                      IF(SUBSET.EQ.'WDSATR  ')  OB2(1,NLV) = REQV
  19253                   end if
  19254                   if(subset.eq.'ADPSFC'.or.subset.eq.'SFCSHP'.or.
  19255      $                  subset.eq.'MSONET') then
  19256                      if(obs5.lt.ymiss)  then
  19257 C.......................................................................
  19258 C For surface reports, store wind direction obs if present (note: this
  19259 C  can happen even if u-comp wind, v-comp wind and/or wind speed obs
  19260 C  are missing) - also store wind table value in case not stored above
  19261 C.......................................................................
  19262                         obs(10,nlv) = obs5
  19263                         qms(8,nlv)  = qms4
  19264                         pgm(4,nlv)  = pcode
  19265                         if(rsn4.lt.ymiss)  rsn(4,nlv) = rsn4
  19266                      end if
  19267                      if(obs6.lt.ymiss)  then
  19268 C.......................................................................
  19269 C For surface reports, store wind speed obs (m/sec) if present (note:
  19270 C  this can happen even if u-comp wind, v-comp wind and/or wind
  19271 C  direction obs are missing) - also store wind table value in case not
  19272 C  stored above
  19273 C.......................................................................
  19274                         obs(11,nlv) = obs6 * 0.1
  19275                         qms(8,nlv)  = qms4
  19276                         pgm(4,nlv)  = pcode
  19277                         if(rsn4.lt.ymiss)  rsn(4,nlv) = rsn4
  19278                      end if
  19279                   end if
  19280                ELSE  IF(KI.EQ.1)  THEN
  19281 C-----------------------------------------------------------------------
  19282 C                    MASS PROCESSING COMES HERE
  19283 C-----------------------------------------------------------------------
  19284 C IF PRESSURE ON THIS LEVEL MATCHES VALUE STORED EARLIER IN "PSFC", SET
  19285 C  DATA LEVEL CATEGORY TO ZERO TO IDENTIFY THIS LEVEL AS THE SURFACE
  19286                   IF(NINT(PSFC).EQ.NINT(OBS1))  OBS(7,NLV) = 0
  19287 C.......................................................................
  19288                   IF(OBS2.LT.YMISS) THEN
  19289 C STORE GEOPOTENTIAL OBS, TABLE VALUE, PROGRAM CODE AND REASON CODE
  19290                      OBS(6,NLV) = OBS2
  19291                      QMS(5,NLV) = QMS2
  19292                      PGM(2,NLV) = PCODE
  19293                      IF(RSN2.LT.YMISS)  RSN(2,NLV) = RSN2
  19294                   END IF
  19295 C NO OTHER DATA IS PROCESSED FOR SUBSET = SFCBOG
  19296                   IF(SUBSET.EQ.'SFCBOG  ')  CYCLE
  19297 C.......................................................................
  19298                   IF(OBS3.LT.YMISS) THEN
  19299 C STORE REPORTED TEMPERATURE OBS, TABLE VALUE, PGM CODE AND REASON CODE
  19300                      OBS(4,NLV) = OBS3 * .01
  19301                      QMS(3,NLV) = QMS3
  19302                      PGM(5,NLV) = PCODE
  19303                      IF(RSN3.LT.YMISS)  RSN(5,NLV) = RSN3
  19304                   END IF
  19305 C.......................................................................
  19306 C STORE VIRTUAL TEMPERATURE OBS
  19307                   IF(OBS5.LT.YMISS)  OBS(8,NLV) = OBS5 * .01

Page 458         Source Listing                  FIZZ01
2017-04-18 11:09                                 prepdata.f

  19308 C NO OTHER DATA IS PROCESSED FOR SUBSET = SATWND OR RASSDA
  19309                   IF((CAT6.AND.SUBSET.NE.'AIRCAR  '.AND.SUBSET.NE.
  19310      $             'AIRCFT  ').OR.SUBSET.EQ.'RASSDA  ')  CYCLE
  19311 C.......................................................................
  19312 C STORE DEWPOINT TEMPERATURE OBSERVATION
  19313                   FLAGM4 = .FALSE.
  19314                   FLAGM6 = .FALSE.
  19315                   IF(OBS6.LT.YMISS)  THEN
  19316                      OBS(9,NLV) = OBS6 * .01
  19317                      FLAGM4 = (OBS(9,NLV)+273.16.LT.TDLIM)
  19318                      FLAGM6 = (OBS(9,NLV)+273.16.GT.TDMAX)
  19319                   END IF
  19320 C.......................................................................
  19321                   IF(OBS4.LT.YMISS)  THEN
  19322 C STORE SPECIFIC HUMIDITY OBS, TABLE VALUE PROGRAM CODE AND REASON CODE
  19323 C  (NOTE: IN SUBR. STOROB, ALL TYPES EXCEPT 40-LEVEL RTOVS, ATOVS AND
  19324 C         GOES SAT. SOUNDINGS COPY SPEC. HUM. TABLE VALUE FROM TEMP)
  19325 C. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .
  19326                      FLAGM1 = .FALSE.
  19327                      FLAGM2 = .FALSE.
  19328                      FLAGM3 = .FALSE.
  19329                      FLAGM5 = .FALSE.
  19330                      IF(HDR(6).EQ.132)  THEN
  19331                         IF(IDATA(10).EQ.2)  THEN
  19332                            IF(STNID(1:2).EQ.'AA'.AND.
  19333      $                        STNID(6:8).EQ.'A  ')  THEN
  19334                               IF((STNID(3:3).GE.'2'.AND.
  19335      $                            STNID(3:3).LE.'4').OR.
  19336      $                           STNID(3:3).EQ.'9') THEN
  19337 C  ... NOAA P-3 (NOAA2:"AA2xxA  ", NOAA3:"AA3xxA  ",
  19338 C                future NOAA4:"AA4xxA  ") or
  19339 C      NOAA Gulf Stream (G-IV) (NOAA9:"AA9xxA  ") DROPS COME HERE
  19340                                  FLAGM1 = (FLDMGS)
  19341                               END IF
  19342                            ELSE IF((STNID(1:1).GE.'0'.AND.
  19343      $                              STNID(1:1).LE.'9').AND.
  19344      $                             STNID(6:8).EQ.'A  ')  THEN
  19345                               IF((STNID(2:2).GE.'0'.AND.
  19346      $                            STNID(2:2).LE.'9').AND.
  19347      $                           (STNID(3:3).GE.'0'.AND.
  19348      $                            STNID(3:3).LE.'9'))  THEN
  19349 
  19350 C  ... USAF ("nnnxxA  ") DROPS COME HERE
  19351                                  FLAGM2 = (FLDMAF)
  19352                               END IF
  19353                            ELSE
  19354 C  ... NON-US OR UNKNOWN (UK:"xxxxAUK", OTHERS:"DRP99A  ") DROPS COME
  19355 C      HERE
  19356                               FLAGM5 = (FLDMFR)
  19357                            END IF
  19358                         END IF
  19359                      ELSE  IF(HDR(6).EQ.133)  THEN
  19360                         FLAGM3 = (FLACMS(4))
  19361                      ELSE  IF(HDR(6).EQ.134)  THEN
  19362                         FLAGM3 = (FLACMS(5))
  19363                      END IF
  19364                      IF(FLAGM1.OR.FLAGM2.OR.FLAGM5)   THEN

Page 459         Source Listing                  FIZZ01
2017-04-18 11:09                                 prepdata.f

  19365 C IF FLDMGS=T, NOAA (P-3 OR GULF STREAM) DROPS GET MOISTURE FLAGGED ON
  19366 C  ALL LEVELS
  19367 C IF FLDMAF=T, USAF DROPS GET MOISTURE FLAGGED ON ALL LEVELS
  19368 C IF FLDMFR=T, NON-US OR UNKNOWN DROPS GET MOISTURE FLAGGED ON ALL LVLS
  19369                         IF(QMS4.LE.3.OR.QMS4.GT.15) QMS4 = 15
  19370                         IF(FLAGM1)  THEN
  19371                            IF(IFRST1.EQ.1)
  19372      $                     PRINT 213,STNID,alat_8,alon_8,NINT(HDR(6))
  19373   213 FORMAT(' + + ALL Q LVLS FLAGGED   -ID=',A8,', LAT=',F10.5,'N, ',
  19374      $ 'LON=',F11.5,'E, RTYP',I4,' - NOAA (P-3 OR GULF STREAM) ',
  19375      $ 'DROPWINSONDE')
  19376                            IFRST1 = 0
  19377                         ELSE  IF(FLAGM2)  THEN
  19378                            IF(IFRST2.EQ.1)
  19379      $                     PRINT 293,STNID,alat_8,alon_8,NINT(HDR(6))
  19380   293 FORMAT(' + + ALL Q LVLS FLAGGED   -ID=',A8,', LAT=',F10.5,'N, ',
  19381      $ 'LON=',F11.5,'E, RTYP',I4,' - USAF DROPWINSONDE')
  19382                            IFRST2 = 0
  19383                         ELSE  IF(FLAGM5)  THEN
  19384                            IF(IFRST3.EQ.1)
  19385      $                     PRINT 294,STNID,alat_8,alon_8,NINT(HDR(6))
  19386   294 FORMAT(' + + ALL Q LVLS FLAGGED   -ID=',A8,', LAT=',F10.5,'N, ',
  19387      $ 'LON=',F11.5,'E, RTYP',I4,' - NON-US OR UNKNOWN DROPWINSONDE')
  19388                            IFRST3 = 0
  19389                         END IF
  19390                      ELSE  IF(FLAGM3)  THEN
  19391 C IF FLACMS(X)=T, AIRCRAFT REPORT (OF TYPE X, SEE NAC IN SUBR. GETC06)
  19392 C  GET MOISTURE FLAGGED
  19393                         IF(QMS4.LE.3.OR.QMS4.GT.15) QMS4 = 15
  19394                         PRINT 8213, STNID,alat_8,alon_8,NINT(HDR(6))
  19395  8213 FORMAT(' + + SP. HUMIDITY FLAGGED -ID=',A8,', LAT=',F10.5,'N, ',
  19396      $ 'LON=',F11.5,'E, RTYP',I4,' - AIRCRAFT')
  19397                      ELSE  IF(FLAGM4)  THEN
  19398 C IF DEWPOINT (K) .LT. TDLIM, MOISTURE FLAGGED FOR ALL DATA TYPES
  19399                         IF(QMS4.LE.3.OR.QMS4.GT.15) THEN
  19400                            QMS4 = 15
  19401                            IF(SUBSET.NE.'ADPUPA  ')  PRINT 8214, STNID,
  19402      $                      alat_8,alon_8,NINT(HDR(6)),OBS1*0.1,
  19403      $                      OBS(9,NLV)+273.16,TDLIM
  19404                         END IF
  19405 
  19406  8214 FORMAT(' + + SP. HUMIDITY FLAGGED -ID=',A8,', LAT=',F10.5,'N, ',
  19407      $ 'LON=',F11.5,'E, RTYP',I4,', PRES=',F7.2,'MB - TD (',F5.1,') <',
  19408      $ ' TDLIM (',F5.1,')')
  19409                      ELSE  IF(FLAGM6)  THEN
  19410 C IF DEWPOINT (K) .GT. TDMAX, MOISTURE FLAGGED FOR ALL DATA TYPES
  19411                         IF(QMS4.LE.3.OR.QMS4.GT.15) THEN
  19412                            QMS4 = 15
  19413                            PRINT 8215, STNID,alat_8,alon_8,
  19414      $                      NINT(HDR(6)),OBS1*0.1,OBS(9,NLV)+273.16,
  19415      $                      TDMAX
  19416                         END IF
  19417  8215 FORMAT(' + + SP. HUMIDITY FLAGGED -ID=',A8,', LAT=',F10.5,'N, ',
  19418      $ 'LON=',F11.5,'E, RTYP',I4,', PRES=',F7.2,'MB - TD (',F5.1,') >',
  19419      $ ' TDMAX (',F5.1,')')
  19420                      END IF
  19421 C. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .

Page 460         Source Listing                  FIZZ01
2017-04-18 11:09                                 prepdata.f

  19422                      OBS(5,NLV) = OBS4
  19423                      QMS(4,NLV) = QMS4
  19424                      PGM(6,NLV) = PCODE
  19425                      IF(RSN4.LT.YMISS)  RSN(6,NLV) = RSN4
  19426                   END IF
  19427                END IF
  19428             ELSE
  19429 C TOO MANY REPORT LEVELS -- PROCESS WHAT YOU HAVE, PRINT DIAGNOSTIC AND
  19430 C   MOVE ON TO NEXT REPORT
  19431                PRINT 102, MXBLVL,STNID,MXBLVL
  19432   102 FORMAT(/5X,'++++++ WARNING, TOO MANY REPORT LEVELS (> ',I4,') -',
  19433      $ 'ID=',A8,' -- PROCESS BOTTOM ',I4,' LEVELS'/)
  19434                WRITE(CMXBLVL,'(I5)') MXBLVL
  19435                CALL SYSTEM('[ -n "$jlogfile" ] && $DATA/postmsg'//
  19436      $          ' "$jlogfile" "***WARNING: TOO MANY REPORT LEVELS '//
  19437      $          '(> '//CMXBLVL//' ) -ID='//STNID//' -- PROCESS '//
  19438      $          'BOTTOM '//CMXBLVL//' LEVELS"')
  19439                EXIT
  19440             END IF
  19441          ENDDO
  19442   111    CONTINUE
  19443 C-----------------------------------------------------------------------
  19444 C       NEXT COME THE RTOVS, ATOVS OR GOES RADIANCES IF APROPRIATE
  19445 C-----------------------------------------------------------------------
  19446          IF(NI.EQ.6.OR.NI.EQ.7)  THEN
  19447             IF(JI.LT.4.AND.TOVRAD) THEN
  19448                IF(NFILE.EQ.IUNIT(7))  THEN
  19449 C-----------------------------------------------------------------------
  19450 C   STORE RTOVS RADIANCES (BRIGHTNESS TEMPERATURE) FOR 32 CHANNELS
  19451 C    ALSO STORE SOLAR ZENITH ANGLE, SATELLITE ZENITH ANGLE, OZONE,
  19452 C                      AND SKIN TEMPERATURE
  19453 C  (THESE ARE COMBINED WITH 40-LEVEL RETRIEVALS IF THEY WERE PROCESSED)
  19454 C-----------------------------------------------------------------------
  19455                   IRFLG = 0
  19456                   DO LL = 1,32
  19457                      NBT = NBT + 1
  19458                      BTO(1,NBT) = LL
  19459                      IF(RTRAD(LL).LT.YMISS)  THEN
  19460                         BTO(2,NBT) = RTRAD(LL)
  19461                         IRFLG = 1
  19462                      END IF
  19463                   ENDDO
  19464                   IF(IRFLG.EQ.0)  NBT = 0
  19465                   IF(NBT.GT.0)  THEN
  19466                      IF(SAZANG.LT.YMISS)  RAD(1) = SAZANG
  19467                      IF(SOZANG.LT.YMISS)  RAD(2) = SOZANG
  19468                      IF(OZONE .LT.YMISS)  RAD(3) = OZONE
  19469                      IF(SKINT .LT.YMISS)  RAD(4) = SKINT
  19470                   END IF
  19471                ELSE  IF(NFILE.EQ.IUNIT(7)+1)  THEN
  19472 C-----------------------------------------------------------------------
  19473 C   STORE ATOVS RADIANCES (BRIGHTNESS TEMPERATURE) FOR 35 CHANNELS
  19474 C    ALSO STORE SOLAR ZENITH ANGLE, SATELLITE ZENITH ANGLE, OZONE,
  19475 C                      AND SKIN TEMPERATURE
  19476 C  (THESE ARE COMBINED WITH 40-LEVEL RETRIEVALS IF THEY WERE PROCESSED)
  19477 C-----------------------------------------------------------------------
  19478                   IRFLG = 0

Page 461         Source Listing                  FIZZ01
2017-04-18 11:09                                 prepdata.f

  19479                   DO LL = 1,35
  19480                      NBT = NBT + 1
  19481                      BTO(1,NBT) = LL
  19482                      IF(RTRAD(LL).LT.YMISS)  THEN
  19483                         BTO(2,NBT) = RTRAD(LL)
  19484                         IRFLG = 1
  19485                      END IF
  19486                   ENDDO
  19487                   IF(IRFLG.EQ.0)  NBT = 0
  19488                   IF(NBT.GT.0)  THEN
  19489                      IF(SAZANG.LT.YMISS)  RAD(1) = SAZANG
  19490                      IF(SOZANG.LT.YMISS)  RAD(2) = SOZANG
  19491                      IF(OZONE .LT.YMISS)  RAD(3) = OZONE
  19492                      IF(SKINT .LT.YMISS)  RAD(4) = SKINT
  19493                   END IF
  19494                END IF
  19495             ELSE IF(JI.GT.3.AND.((GOESRD(1).AND.STNID(1:1).NE.'H').OR.
  19496      $                           (GOESRD(2).AND.STNID(1:1).EQ.'H')))THEN
  19497 C-----------------------------------------------------------------------
  19498 C      STORE GOES RADIANCES (BRIGHTNESS TEMPERATURE) FOR 18 CHANNELS
  19499 C          ALSO STORE SOLAR ZENITH ANGLE, SATELLITE ZENITH ANGLE,
  19500 C            SKIN TEMPERATURE, AND CLOUD AMOUNT BUFR CODE TABLE
  19501 C        (THESE ARE COMBINED WITH SOUNDINGS IF THEY WERE PROCESSED)
  19502 C-----------------------------------------------------------------------
  19503                IRFLG = 0
  19504                DO LL = 1,18
  19505                   NBT = NBT + 1
  19506                   BTO(1,NBT) = IGCHN(LL)
  19507                   IF(GRAD(LL).LT.YMISS)  THEN
  19508                      BTO(2,NBT) = GRAD(LL)
  19509                      IRFLG = 1
  19510                   END IF
  19511                ENDDO
  19512                IF(IRFLG.EQ.0)  NBT = 0
  19513                IF(NBT.GT.0)  THEN
  19514                   IF(SAZANG.LT.YMISS)  RAD(1) = SAZANG
  19515                   IF(SOZANG.LT.YMISS)  RAD(2) = SOZANG
  19516                   IF(SKINT .LT.YMISS)  RAD(4) = SKINT
  19517                   IF(CLDAMT.LT.YMISS)  RAD(5) = CLDAMT
  19518                END IF
  19519             END IF
  19520          END IF
  19521 C***********************************************************************
  19522       END IF
  19523       RETURN
  19524       END

Page 462         Source Listing                  FIZZ01
2017-04-18 11:09 Entry Points                    prepdata.f



ENTRY POINTS

  Name               
                     
 fizz01_             


SYMBOL CROSS REFERENCE

 Name                       Object Declared Type            Bytes Dimen Elements Attributes       References                        
                                                                                                                                    
 102                        Label  19432                                                          19431                             
 111                        Label  19442                                                          19067                             
 213                        Label  19373                                                          19372                             
 293                        Label  19380                                                          19379                             
 294                        Label  19386                                                          19385                             
 8213                       Label  19395                                                          19394                             
 8214                       Label  19406                                                          19401                             
 8215                       Label  19417                                                          19413                             
 ACFTSW                     Common 18867                                1148                                                        
 ADP                        Common 18850                                14100                                                       
 AIFNOW                     Scalar 18868    R(4)            4     1     9        COM                                                
 AIRLND                     Scalar 18867    R(4)            4     2     54       COM                                                
 ALAT_8                     Scalar 18843    R(8)            8           scalar   COM              18928,19372,19379,19385,19394,1940
                                                                                                  2,19413                           
 ALON_8                     Scalar 18843    R(8)            8           scalar   COM              18926,18927,19372,19379,19385,1939
                                                                                                  4,19402,19413                     
 ALTIMR                     Scalar 18875    R(4)            4           scalar   COM              19158                             
 AMSTQ                      Scalar 18869    R(4)            4           scalar   COM              19193                             
 AWINDO                     Scalar 18867    R(4)            4     2     18       COM                                                
 BMISS                      Scalar 18843    R(8)            8           scalar   COM              18896,18897,18898,18899,18900,1890
                                                                                                  1,18902,18903,18904               
 BTO                        Scalar 18858    R(4)            4     2     510      COM              18902,19044,19046,19458,19460,1948
                                                                                                  1,19483,19506,19508               
 BUFRLIB_MISSING            Common 18880                                8                                                           
 CAT6                       Local  18839    L(4)            4           scalar                    18893,19238,19309                 
 CLDAMT                     Scalar 18865    R(4)            4           scalar   COM              19517                             
 CLDTOP                     Common 18866                                24                                                          
 CLTOP                      Scalar 18866    R(4)            4     2     6        COM              19026,19027,19032,19033           
 CMXBLVL                    Local  18847    CHAR            5           scalar                    19434,19437,19438                 
 DATA                       Common 18878                                32                                                          
 DFTLAT                     Scalar 18877    R(4)            4     1     600      COM              19163,19165                       
 DFTLON                     Scalar 18877    R(4)            4     1     600      COM              19163,19164                       
 DFTTIM                     Scalar 18877    R(4)            4     1     600      COM              19166,19167                       
 DRIFT                      Common 18877                                7200                                                        
 DROPSN                     Scalar 18863    R(4)            4           scalar   COM                                                
 DWINDO                     Scalar 18863    R(4)            4           scalar   COM                                                
 D_DFTTIM                   Local  19167    R(4)            4           scalar                    19167,19168,19169,19170           
 EEQF                       Scalar 18872    R(4)            4           scalar   COM              18935                             
 FIZZ01                     Subr   18825                                                                                            
 FIZZAA                     Common 18856                                48216                                                       
 FLACMS                     Scalar 18840    L(4)            4     1     9        COM              19360,19362                       
 FLAGM1                     Local  18839    L(4)            4           scalar                    19326,19340,19364,19370           
 FLAGM2                     Local  18839    L(4)            4           scalar                    19327,19351,19364,19377           
 FLAGM3                     Local  18840    L(4)            4           scalar                    19328,19360,19362,19390           

Page 463         Source Listing                  FIZZ01
2017-04-18 11:09 Symbol Table                    prepdata.f

 Name                       Object Declared Type            Bytes Dimen Elements Attributes       References                        
                                                                                                                                    
 FLAGM4                     Local  18840    L(4)            4           scalar                    19313,19317,19397                 
 FLAGM5                     Local  18840    L(4)            4           scalar                    19329,19356,19364,19383           
 FLAGM6                     Local  18840    L(4)            4           scalar                    19314,19318,19409                 
 FLDMAF                     Scalar 18840    L(4)            4           scalar   COM              19351                             
 FLDMFR                     Scalar 18840    L(4)            4           scalar   COM              19356                             
 FLDMGS                     Scalar 18840    L(4)            4           scalar   COM              19340                             
 FLRECO                     Scalar 18841    L(4)            4           scalar   COM              19111                             
 GOESRD                     Scalar 18840    L(4)            4     1     2        COM              19495,19496                       
 GRAD                       Scalar 18864    R(4)            4     1     18       COM              19507,19508                       
 HDR                        Scalar 18860    R(4)            4     1     14       COM              18929,18937,18938,18939,18940,1894
                                                                                                  1,18944,18945,18946,18947,18948,18
                                                                                                  951,18960,18968,18971,19002,19017,
                                                                                                  19036,19159,19160,19182,19330,1935
                                                                                                  9,19361,19372,19379,19385,19394,19
                                                                                                  402,19414                         
 HDR_8                      Scalar 18843    R(8)            8     1     29       COM              18896,18927,18928,18929,18932,1893
                                                                                                  3,18934,18935,18937,18938,18939,18
                                                                                                  940,18941,18944,18945,18946,18947,
                                                                                                  18948,18949                       
 IACFTH                     Scalar 18868    I(4)            4     1     9        COM                                                
 IACFTL                     Scalar 18868    I(4)            4     1     9        COM                                                
 ICAT                       Scalar 18851    I(4)            4     1     600      COM              19111,19142,19146                 
 IDAT10                     Scalar 18878    I(4)            4           scalar   COM                                                
 IDATA                      Scalar 18845    I(4)            4     1     3500     COM              18977,18978,19331                 
 IDATE                      Scalar 18878    I(4)            4     1     4        COM              19167                             
 IFRST1                     Local  19072    I(4)            4           scalar                    19072,19371,19376                 
 IFRST2                     Local  19073    I(4)            4           scalar                    19073,19378,19382                 
 IFRST3                     Local  19074    I(4)            4           scalar                    19074,19384,19388                 
 IGCHN                      Scalar 18864    I(4)            4     1     18       COM              19506                             
 IMISS                      Local  18885    I(4)            4           scalar                    18885,19142                       
 IPMSL                      Scalar 18853    I(4)            4     1     3        COM              19099,19102,19103                 
 IPRINT                     Scalar 18850    I(4)            4           scalar   COM                                                
 IPWOBT                     Local  18837    I(4)            4     1     4                         18884,18992                       
 IPWPCT                     Local  18837    I(4)            4     1     4                         18885,18994,18995                 
 IPWQMT                     Local  18837    I(4)            4     1     4                         18884,18993                       
 IPWTYP                     Local  18989    I(4)            4           scalar                    18989,18990,18992,18993,18994,1899
                                                                                                  5                                 
 IRET                       Local  18924    I(4)            4           scalar                    18924,18925                       
 IRFLG                      Local  19041    I(4)            4           scalar                    19041,19047,19050,19455,19461,1946
                                                                                                  4,19478,19484,19487,19503,19509,19
                                                                                                  512                               
 ISATOB                     Scalar 18850    I(4)            4           scalar   COM                                                
 ISQNUM_UPA                 Scalar 18879    I(4)            4           scalar   COM                                                
 IUNIT                      Scalar 18876    I(4)            4     1     28       COM              19448,19471                       
 IUNITG                     Scalar 18859    I(4)            4     1     2        COM                                                
 IUNITP                     Scalar 18856    I(4)            4           scalar   COM              18924                             
 IVADFL                     Scalar 18863    I(4)            4           scalar   COM                                                
 IVADSP                     Scalar 18863    I(4)            4           scalar   COM                                                
 JAMASS                     Scalar 18867    I(4)            4     2     54       COM                                                
 JAWIND                     Scalar 18867    I(4)            4     2     54       COM                                                
 JI                         Dummy  18825    I(4)            4           scalar   ARG,INOUT        19447,19495                       
 JPSSMI                     Scalar 18873    I(4)            4     2     24       COM                                                
 JSMASS                     Scalar 18871    I(4)            4     3     480      COM                                                
 JSWIND                     Scalar 18871    I(4)            4     3     480      COM                                                
 KBDYMI                     Scalar 18874    I(4)            4           scalar   COM                                                

Page 464         Source Listing                  FIZZ01
2017-04-18 11:09 Symbol Table                    prepdata.f

 Name                       Object Declared Type            Bytes Dimen Elements Attributes       References                        
                                                                                                                                    
 KEPAC                      Scalar 18868    I(4)            4     2     54       COM                                                
 KEPSW                      Scalar 18871    I(4)            4     3     480      COM                                                
 KI                         Dummy  18825    I(4)            4           scalar   ARG,INOUT        19196,19280                       
 KMSGMI                     Scalar 18874    I(4)            4           scalar   COM                                                
 KNTSMI                     Scalar 18873    I(4)            4     1     4        COM                                                
 KOUNT                      Scalar 18878    I(4)            4           scalar   COM                                                
 KSKPMI                     Scalar 18874    I(4)            4           scalar   COM                                                
 KSKSWD                     Scalar 18872    I(4)            4     1     10       COM                                                
 KTIMM                      Scalar 18873    I(4)            4     1     4        COM                                                
 L                          Local  19075    I(4)            4           scalar                    19075,19077,19080,19081,19082,1908
                                                                                                  3,19084,19085,19086,19087,19088,19
                                                                                                  089,19090,19091,19092,19095,19142,
                                                                                                  19146,19150,19151,19163,19164,1916
                                                                                                  5,19166,19167                     
 LEVELS                     Common 18861                                4                                                           
 LEVPM                      Scalar 18879    I(4)            4           scalar   COM                                                
 LEVQQ                      Scalar 18879    I(4)            4           scalar   COM                                                
 LEVST                      Scalar 18879    I(4)            4           scalar   COM                                                
 LL                         Local  18977    I(4)            4           scalar                    18977,18979,18980,18981,19042,1904
                                                                                                  4,19045,19046,19456,19458,19459,19
                                                                                                  460,19479,19481,19482,19483,19504,
                                                                                                  19506,19507,19508                 
 LMAND                      Local  18839    L(4)            4     1     1201                      18886,19151                       
 MAX                        Func   19163                                scalar                    19163,19205,19212,19220           
 MAXOBS                     Param  18835    I(4)            4           scalar                    18845,18850                       
 MHDRWD                     Param  18832    I(4)            4           scalar                    18856                             
 MIN                        Func   18964                                scalar                    18964,18993,19027,19080,19083,1908
                                                                                                  6,19089,19094,19103,19203         
 MISWCH                     Common 18873                                264                                                         
 MLEV                       Scalar 18861    I(4)            4           scalar   COM              19067,19075                       
 MOB2WD                     Param  18832    I(4)            4           scalar                    18857                             
 MOBS                       Scalar 18852    I(4)            4     3     10800    COM              19077,19080,19081,19082,19083,1908
                                                                                                  4,19085,19086,19087,19088,19089,19
                                                                                                  090,19091,19092,19106,19150,19151 
 MOBSWD                     Param  18832    I(4)            4           scalar                    18857                             
 MOD                        Func   19150                                scalar                    19150                             
 MPGMWD                     Param  18834    I(4)            4           scalar                    18858                             
 MP_PROCESS                 Scalar 18878    I(4)            4           scalar   COM              18949                             
 MQMSWD                     Param  18833    I(4)            4           scalar                    18857                             
 MXBLVL                     Param  18832    I(4)            4           scalar                    18857,18858,19121,19431,19434     
 MXLVL                      Param  18830    I(4)            4           scalar                    18851,18852,18877                 
 MXPWT                      Param  18831    I(4)            4           scalar                    18854                             
 MXTYPV                     Param  18828    I(4)            4           scalar                    18852,18853,18854                 
 MXWRDH                     Param  18827    I(4)            4           scalar                    18860                             
 MXWRDL                     Param  18829    I(4)            4           scalar                    18852                             
 NBT                        Scalar 18856    I(4)            4           scalar   COM              18906,19043,19044,19046,19050,1945
                                                                                                  7,19458,19460,19464,19465,19480,19
                                                                                                  481,19483,19487,19488,19505,19506,
                                                                                                  19508,19512,19513                 
 NBTS                       Local  18924    I(4)            4           scalar                    18924                             
 NEMSPECS                   Subr   18924                                                          18924                             
 NFILE                      Scalar 18876    I(4)            4           scalar   COM              19448,19471                       
 NI                         Dummy  18825    I(4)            4           scalar   ARG,INOUT        19106,19446                       
 NINT                       Func   18926                                scalar                    18926,18962,18964,18990,18993,1902
                                                                                                  7,19286,19372,19379,19385,19394,19

Page 465         Source Listing                  FIZZ01
2017-04-18 11:09 Symbol Table                    prepdata.f

 Name                       Object Declared Type            Bytes Dimen Elements Attributes       References                        
                                                                                                                                    
                                                                                                  402,19414                         
 NLV                        Scalar 18856    I(4)            4           scalar   COM              18905,18967,18996,19015,19034,1912
                                                                                                  1,19122,19130,19131,19132,19133,19
                                                                                                  137,19140,19146,19151,19158,19164,
                                                                                                  19165,19170,19176,19177,19182,1918
                                                                                                  3,19184,19185,19189,19190,19191,19
                                                                                                  192,19193,19207,19208,19214,19215,
                                                                                                  19216,19225,19226,19227,19228,1922
                                                                                                  9,19238,19243,19244,19245,19246,19
                                                                                                  252,19262,19263,19264,19265,19274,
                                                                                                  19275,19276,19277,19286,19290,1929
                                                                                                  1,19292,19293,19300,19301,19302,19
                                                                                                  303,19307,19316,19317,19318,19403,
                                                                                                  19414,19422,19423,19424,19425     
 NREF                       Local  18924    I(4)            4           scalar                    18924                             
 NSCL                       Local  18924    I(4)            4           scalar                    18924,18925                       
 NSCL0                      Local  18923    I(4)            4           scalar                    18923,18925,18926                 
 OB2                        Scalar 18857    R(4)            4     2     1530     COM              18898,18980,18981,18982,18983,1901
                                                                                                  1,19026,19032,19033,19102,19104,19
                                                                                                  158,19165,19170,19176,19177,19183,
                                                                                                  19184,19185,19190,19191,19192,1919
                                                                                                  3,19252                           
 OBS                        Scalar 18857    R(4)            4     2     3060     COM              18897,18959,18963,18968,18992,1899
                                                                                                  9,19009,19024,19130,19137,19140,19
                                                                                                  146,19151,19164,19182,19189,19207,
                                                                                                  19208,19225,19226,19238,19243,1926
                                                                                                  2,19274,19286,19290,19300,19307,19
                                                                                                  316,19317,19318,19403,19414,19422 
 OBS1                       Local  19077    R(4)            4           scalar                    19077,19079,19110,19114,19130,1928
                                                                                                  6,19402,19414                     
 OBS2                       Local  19082    R(4)            4           scalar                    19082,19094,19233,19243,19288,1929
                                                                                                  0                                 
 OBS3                       Local  19085    R(4)            4           scalar                    19085,19094,19205,19207,19298,1930
                                                                                                  0                                 
 OBS4                       Local  19088    R(4)            4           scalar                    19088,19094,19205,19208,19321,1942
                                                                                                  2                                 
 OBS5                       Local  19091    R(4)            4           scalar                    19091,19094,19220,19225,19256,1926
                                                                                                  2,19307                           
 OBS6                       Local  19092    R(4)            4           scalar                    19092,19094,19220,19226,19267,1927
                                                                                                  4,19315,19316                     
 OUT                        Local  18839    L(4)            4           scalar                    19094,19119                       
 OZONE                      Scalar 18864    R(4)            4           scalar   COM              19468,19491                       
 PARM3                      Common 18862                                56                                                          
 PCAT                       Scalar 18869    R(4)            4           scalar   COM              19177                             
 PCODE                      Scalar 18856    R(4)            4           scalar   COM              18965,18994,19013,19028,19132,1921
                                                                                                  5,19228,19245,19264,19276,19292,19
                                                                                                  302,19424                         
 PGM                        Scalar 18858    R(4)            4     2     2295     COM              18900,18965,18994,19013,19028,1913
                                                                                                  2,19215,19228,19245,19264,19276,19
                                                                                                  292,19302,19424                   
 PHIACF                     Scalar 18868    R(4)            4     1     7        COM                                                
 PHISWN                     Scalar 18870    R(4)            4     1     7        COM                                                
 PMAND                      Scalar 18850    R(4)            4     1     23       COM                                                
 POAF                       Scalar 18868    R(4)            4           scalar   COM              19176                             
 PRSS                       Scalar 18875    R(4)            4           scalar   COM              18968,18999                       

Page 466         Source Listing                  FIZZ01
2017-04-18 11:09 Symbol Table                    prepdata.f

 Name                       Object Declared Type            Bytes Dimen Elements Attributes       References                        
                                                                                                                                    
 PSFC                       Local  18904    R(4)            4           scalar                    18904,19110,19114,19286           
 PWAT                       Scalar 18854    R(4)            4     2     15       COM              18962,18963,18964,18990,18992,1899
                                                                                                  3                                 
 QIFN                       Scalar 18872    R(4)            4           scalar   COM              18934                             
 QIFY                       Scalar 18872    R(4)            4           scalar   COM              18933                             
 QMS                        Scalar 18857    R(4)            4     2     2295     COM              18899,18964,18993,19012,19027,1910
                                                                                                  3,19131,19214,19227,19244,19263,19
                                                                                                  275,19291,19301,19423             
 QMS1                       Local  19080    R(4)            4           scalar                    19080,19131                       
 QMS2                       Local  19083    R(4)            4           scalar                    19083,19244,19291                 
 QMS3                       Local  19086    R(4)            4           scalar                    19086,19209,19212,19301           
 QMS4                       Local  19089    R(4)            4           scalar                    19089,19209,19212,19214,19227,1926
                                                                                                  3,19275,19369,19393,19399,19400,19
                                                                                                  411,19412,19423                   
 RAD                        Scalar 18858    R(4)            4     1     5        COM              18903,19466,19467,19468,19469,1948
                                                                                                  9,19490,19491,19492,19514,19515,19
                                                                                                  516,19517                         
 RADANC                     Common 18864                                320                                                         
 RDATA                      Scalar 18850    R(4)            4     1     3500     COM              18979,18980,18981                 
 RECCON                     Scalar 18862    R(4)            4           scalar   COM                                                
 RECSLM                     Scalar 18862    R(4)            4           scalar   COM                                                
 REQV                       Scalar 18855    R(4)            4           scalar   COM              19011,19252                       
 RFFL                       Scalar 18872    R(4)            4           scalar   COM              18932                             
 RIALR                      Scalar 18869    R(4)            4           scalar   COM              19185                             
 ROLF                       Scalar 18869    R(4)            4           scalar   COM              19183                             
 RPTHDR                     Common 18860                                88                                                          
 RSN                        Scalar 18858    R(4)            4     2     2295     COM              18901,18966,18995,19014,19029,1913
                                                                                                  3,19216,19229,19246,19265,19277,19
                                                                                                  293,19303,19425                   
 RSN1                       Local  19081    R(4)            4           scalar                    19081,19133                       
 RSN2                       Local  19084    R(4)            4           scalar                    19084,19246,19293                 
 RSN3                       Local  19087    R(4)            4           scalar                    19087,19200,19203,19303           
 RSN4                       Local  19090    R(4)            4           scalar                    19090,19200,19203,19216,19229,1926
                                                                                                  5,19277,19425                     
 RTRAD                      Scalar 18864    R(4)            4     1     35       COM              19459,19460,19482,19483           
 RWINDO                     Scalar 18862    R(4)            4           scalar   COM                                                
 SATSW3                     Common 18870                                11604                                                       
 SAZANG                     Scalar 18864    R(4)            4           scalar   COM              19466,19489,19514                 
 SFCBFR                     Common 18875                                8                                                           
 SINGLE                     Dummy  18825    L(4)            4           scalar   ARG,INOUT        19135                             
 SKINT                      Scalar 18865    R(4)            4           scalar   COM              19469,19492,19516                 
 SOZANG                     Scalar 18864    R(4)            4           scalar   COM              19467,19490,19515                 
 SPCIAL                     Scalar 18879    R(4)            4           scalar   COM                                                
 SRAD                       Scalar 18873    R(4)            4     1     7        COM              19045,19046                       
 STNID                      Scalar 18848    CHAR            8           scalar   COM              19332,19333,19334,19335,19336,1934
                                                                                                  2,19343,19344,19345,19346,19347,19
                                                                                                  348,19372,19379,19385,19394,19401,
                                                                                                  19413,19431,19437,19495,19496     
 STRCTY                     Common 18851                                2400                                                        
 STRMOB                     Common 18852                                43200                                                       
 STRMSL                     Common 18853                                12                                                          
 STRPWT                     Common 18854                                60                                                          
 STRRRT                     Common 18855                                4                                                           
 SUBSET                     Dummy  18825    CHAR            8           scalar   ARG,INOUT        18893,18930,19111,19147,19155,1917
                                                                                                  3,19178,19218,19219,19252,19254,19

Page 467         Source Listing                  FIZZ01
2017-04-18 11:09 Symbol Table                    prepdata.f

 Name                       Object Declared Type            Bytes Dimen Elements Attributes       References                        
                                                                                                                                    
                                                                                                  255,19296,19309,19310,19401       
 SUBSET_D                   Scalar 18848    CHAR            8           scalar   COM                                                
 SWINDO_E                   Scalar 18870    R(4)            4     3     480      COM                                                
 SWINDO_L                   Scalar 18871    R(4)            4     3     480      COM                                                
 SWNLND                     Scalar 18870    R(4)            4     3     480      COM                                                
 SYSTEM                     Subr   19435                                                          19435                             
 TDLIM                      Scalar 18879    R(4)            4           scalar   COM              19317,19403                       
 TDMAX                      Scalar 18879    R(4)            4           scalar   COM              19318,19415                       
 TOVRAD                     Scalar 18839    L(4)            4           scalar   COM              19447                             
 TOVRTV                     Scalar 18865    R(4)            4           scalar   COM                                                
 TRBX                       Scalar 18868    R(4)            4     1     5        COM              19184,19189,19190,19191,19192     
 UNITNO                     Common 18876                                116                                                         
 UPALIM                     Common 18879                                28                                                          
 UWINDO                     Scalar 18862    R(4)            4           scalar   COM                                                
 VADWIN                     Scalar 18862    R(4)            4           scalar   COM                                                
 VWINDO                     Scalar 18862    R(4)            4           scalar   COM                                                
 WRMISS                     Scalar 18878    R(4)            4           scalar   COM                                                
 XWINDO                     Scalar 18873    R(4)            4     2     24       COM                                                
 YMISS                      Local  18884    R(4)            4           scalar                    18884,18932,18933,18934,18935,1893
                                                                                                  9,18941,18944,18945,18948,18962,18
                                                                                                  968,18979,18981,18990,18999,19032,
                                                                                                  19033,19045,19079,19094,19099,1913
                                                                                                  3,19158,19163,19166,19176,19177,19
                                                                                                  182,19183,19184,19185,19189,19190,
                                                                                                  19191,19192,19193,19205,19216,1922
                                                                                                  0,19229,19233,19246,19256,19265,19
                                                                                                  267,19277,19288,19293,19298,19303,
                                                                                                  19307,19315,19321,19425,19459,1946
                                                                                                  6,19467,19468,19469,19482,19489,19
                                                                                                  490,19491,19492,19507,19514,19515,
                                                                                                  19516,19517                       

Page 468         Source Listing                  FIZZ01
2017-04-18 11:09                                 prepdata.f

  19525 C$$$  SUBPROGRAM DOCUMENTATION BLOCK
  19526 C
  19527 C SUBPROGRAM:    BLOCK DATA
  19528 C   PRGMMR: C. Hill          ORG: NP22       DATE: 2017-01-11
  19529 C
  19530 C ABSTRACT: INITIALIZES COMMON BLOCK PARAMETERS.
  19531 C
  19532 C PROGRAM HISTORY LOG:
  19533 C   UNKNOWN
  19534 C 1988-04-11  D. A. KEYSER -- DOCBLOCKING; STREAMLINED
  19535 C 2016-10-27  C. Hill -- Most recent updates to the sizes and default
  19536 C             values of arrays AWINDO, AIRLND, JAWIND, JAMASS, IACFTL,
  19537 C             IACFTH, AIFNOW, FLACMS, KSKALM, KSKAHM, KEPAC, and KSKNOW
  19538 C             to accommodate TAMDARB reports.
  19539 C 2017-01-11  C. Hill -- The default value for IACFTH(9) is changed from
  19540 C             3050 to 16500 meters to provide capability to process the
  19541 C             full vertical profile of TAMDARB reports (made available
  19542 C             by ARINC 01/17/2017). 
  19543 C
  19544 C REMARKS: THIS IS UPDATED AS NEEDED TO ACCOUNT FOR CHANGES IN COMMON
  19545 C   BLOCKS AND FOR NEW COMMON BLOCKS AS THEY ARE ADDED.  NO PROGRAM
  19546 C   HISTORY LOG IS MAINTAINED; REFER TO INDIVIDUAL SUBPROGRAM HISTORY
  19547 C   LOGS FOR CHANGES IN COMMON BLOCK VARIABLES.
  19548 C
  19549 C ATTRIBUTES:
  19550 C   LANGUAGE: FORTRAN 90
  19551 C   MACHINE:  NCEP WCOSS
  19552 C
  19553 C$$$
  19554       BLOCK DATA
  19555       PARAMETER (MXLVL = 600)
  19556       PARAMETER (MAXOBS = 3500)
  19557       PARAMETER (XMISS = 99999.)
  19558       PARAMETER (IMISS = 99999)
  19559       COMMON/DATA/DMY3,IDATE(4),IDAT10,MP_PROCESS,WRMISS
  19560       COMMON/ADP/ISATOB,PMAND(23),RDATA(MAXOBS),IPRINT
  19561       COMMON/LEVELS/MLEV
  19562       COMMON/UNITNO/NFILE,IUNIT(28)
  19563       COMMON/GRID/IGRD,JGRD,POLA,NORTH,ALONVT,POLEI,POLEJ,XMESHL,YNLIM,
  19564      $ YSLIM
  19565       COMMON/SATSW2/PHI(6),IRTRV(5,4,4),KTOP(5,4,4),IWINDO_e(5,4,4),
  19566      $ IWINDO_l(5,4,4),SATMST(5,4,4),ISATLS(5,4,4)
  19567       COMMON/SATSW3/PHISWN(7),SWNLND(6,8,10),SWINDO_e(6,8,10),
  19568      $ SWINDO_l(6,8,10),JSWIND(6,8,10),JSMASS(6,8,10),KEPSW(6,8,10),
  19569      $ KSKSWD(10),RFFL,QIFY,QIFN,EEQF
  19570       COMMON/ACFTSW/AWINDO(2,9),AIRLND(6,9),JAWIND(6,9),JAMASS(6,9),
  19571      $ IACFTL(9),IACFTH(9),PHIACF(7),KEPAC(6,9),AIFNOW(9),POAF,TRBX(5),
  19572      $ FLACMS(9),PCAT,ROLF,aMSTQ,RIALR
  19573       COMMON/TVSWCH/TOVEDS(2),TOVBFR(2),TR80KM,KNTTOV(2),
  19574      $ KSKPTV(2),KNOPTV(2),KIPTTV(2),KMSGTV(2),KBDYTV(2),KTIMTV(2),
  19575      $ KLNDTV(2),KSEATV(2),KREDTV(2),KJFLAG(2)
  19576       COMMON/GOSWCH/GOESND(2),GOESPW(2),GOESCT(2),KNTGIT,KNTGIS,KNTGIP,
  19577      $ KSKPGI,KNDCGI,KNOPGI,KMSGGI,KBDYGI,KTIMGI(3),KLNDGI(3),KSEAGI(3),
  19578      $ KNTGIC,KNOCTP
  19579       COMMON/LFMSFC/LFMAXI,LFMAXJ,FMESHL,FLONVT,FPOLEI,FPOLEJ,MARLND,
  19580      $ JSURFM(12),JSURFW(12),FWINDO(12),PFRALT,npkrpt(12)
  19581       COMMON/UPALIM/LEVPM,LEVST,LEVQQ,TDLIM,TDMAX,SPCIAL,ISQNUM_UPA

Page 469         Source Listing                  FIZZ01
2017-04-18 11:09                                 prepdata.f

  19582       COMMON/COUNT/KKTYPE(100:299)
  19583       COMMON/PARM2/PG4243,KTEMP,i2many_lvls
  19584       COMMON/PARM3/RECCON,RWINDO,UWINDO,RECSLM,FLRECO,VWINDO,VADWIN,
  19585      $ IVADFL,IVADSP,FLDMGS,FLDMAF,FLDMFR,DROPSN,DWINDO
  19586       COMMON/PARM4/ICODE
  19587       COMMON/PARM5/FILLZ,FILLT,FILLW,FILLM,LSWIND,LSMASS,CWINDO,NPZ
  19588       COMMON/PARM6/MODPRT,IFLUA,STNPRT(3)
  19589       COMMON/SFCBFR/ALTIMR,PRSS
  19590       COMMON/SKPCNT/KSKPUA,KSKPSF,KMSGUA,KMSGSF,KBDYUA,KBDYSF,KTIMUA,
  19591      $ KTIMSF,KSKNSW,KSKREC,KNOATS,KNTUPA,KNTCAR,KNTAIR,KNTSWN,KNTPRO,
  19592      $ KNTVAD,KNTRAS,KNTDUM(3),KNTSFC,KNTSHP,KNTSLP,KNTMSO,KNTSPL,
  19593      $ KSKSWN,KSKACF,KNDCDE(3),KSKCLS,KSKTHN,KSKOMR(2),KSKALM(9),
  19594      $ KSKAHM(9),KSKNOW(9),KSKDRP
  19595       COMMON/MISWCH/XWINDO(6,4),JPSSMI(6,4),SRAD(7),KNTSMI(4),KTIMM(4),
  19596      $ KSKPMI,KMSGMI,KBDYMI
  19597       COMMON/SCTWCH/IEWNDO(2),JPERSD(6),IQWNDO(2),JPQKSD(6),IWWNDO(2),
  19598      $ JPWDSD(6),KSKPSC(4),KMSGSC(4),KBDYSC(4),KTIMSC(4),KNTSCT(4),
  19599      $ JPASCD(6),IAWNDO(2)
  19600       COMMON/GPSWCH/JPGPSD(6),GWINDO,KNTGPS,KSKPGP,KMSGGP,KBDYGP,KTIMGP,
  19601      $ KMISGP,KT45GP,SKGP45,SKGNSS,KTGNSS
  19602       COMMON/RADANC/RTRAD(35),GRAD(18),IGCHN(18),SOZANG,SAZANG,OZONE,
  19603      $ SKINT,CLDAMT,TOVRAD,TOVRTV,GOESRD(2)
  19604       COMMON/CLDTOP/CLTOP(2,3)
  19605       COMMON/PREVSW/PREVEN
  19606       COMMON/APDNSW/APPEND
  19607       COMMON/SKPSUB/SUBSKP(0:255,0:200)
  19608       COMMON/LAUNCH/ALNCH
  19609       COMMON/PFSWCH/PRFLER(4),PWINDO(4),PROFILERinADPUPA
  19610       COMMON/RASSSW/RASS,TWINDO
  19611       COMMON/DRIFT/DFTLON(MXLVL),DFTLAT(MXLVL),DFTTIM(MXLVL)
  19612       COMMON/SBDRIFT/ZDRIFT(MXLVL),TDRIFT(MXLVL),TDRIFTLL(MXLVL),
  19613      $ UDRIFT(MXLVL),VDRIFT(MXLVL),XDRIFT(MXLVL),YDRIFT(MXLVL),
  19614      $ TDRIFT_LL(MXLVL),KFLAG(5),LFLAG(3),PLO,IFLTIM,JJ,II
  19615       common/pstnflg/ipstnflg
  19616       LOGICAL TOVEDS,GOESND,SATMST,MARLND,RECCON,SWNLND,AIRLND,DROPSN,
  19617      $ PG4243,SPCIAL,KTEMP,TR80KM,FILLZ,FILLT,FILLW,FILLM,PRFLER,
  19618      $ TOVBFR,RECSLM,GOESPW,VADWIN,TOVRAD,TOVRTV,PFRALT,AIFNOW,FLDMGS,
  19619      $ FLDMAF,FLDMFR,FLACMS,GOESRD,PREVEN,SUBSKP,APPEND,
  19620      $ PROFILERinADPUPA,GOESCT,RASS,WRMISS,SKGP45,npkrpt,SKGNSS
  19621       CHARACTER*8  STNPRT
  19622       DATA TOVEDS/2*.TRUE./,GOESND/2*.FALSE./,TOVBFR/2*.FALSE./,
  19623      $ SATMST/80*.FALSE./,MARLND/.FALSE./,RECCON/.TRUE./,
  19624      $ SWNLND/480*.TRUE./,AIRLND/54*.TRUE./,PG4243/.TRUE./,
  19625      $ SPCIAL/.FALSE./,KTEMP/.FALSE./,TR80KM/.FALSE./,FILLZ/.FALSE./,
  19626      $ FILLT/.FALSE./,FILLW/.FALSE./,FILLM/.FALSE./,PRFLER/4*.TRUE./,
  19627      $ GOESPW/2*.FALSE./,GOESCT/2*.FALSE./,STNPRT/3*'        '/,
  19628      $ RECSLM/.TRUE./,VADWIN/.FALSE./,TOVRAD/.FALSE./,PFRALT/.FALSE./,
  19629      $ TOVRTV/.FALSE./,AIFNOW/9*.TRUE./,FLDMGS/.TRUE./,
  19630      $ FLACMS/9*.TRUE./,GOESRD/2*.FALSE./,PREVEN/.FALSE./,
  19631      $ FLDMAF/.TRUE./,FLDMFR/.TRUE./,DROPSN/.TRUE./,
  19632      $ SUBSKP/51456*.FALSE./,APPEND/.FALSE./,PROFILERinADPUPA/.FALSE./,
  19633      $ RASS/.FALSE./,WRMISS/.TRUE./,SKGP45/.TRUE./,npkrpt/12*.false./
  19634       DATA  SKGNSS/.TRUE./
  19635       DATA  MODPRT/500/,IGRD/73/,JGRD/37/
  19636       DATA  PMAND/1000.,925.,850.,700.,500.,400.,300.,250.,200.,150.,
  19637      $  100.,70., 50., 30., 20., 10.,  7.,  5.,  3.,  2.,  1.,  .4,  .1/
  19638       DATA  PHI/-90.,-70.,-20.,20.,74.,90./

Page 470         Source Listing                  FIZZ01
2017-04-18 11:09                                 prepdata.f

  19639       DATA  PHISWN/-90.,-70.,-20.,0.,20.,70.,90./
  19640       DATA  PHIACF/-90.,-70.,-20.,0.,20.,70.,90./
  19641       DATA  IWINDO_e/20*-3,60*-300/,IWINDO_l/20*+3,60*+300/,
  19642      $ FWINDO/4*300.,600.,7*300./,RWINDO/300./,UWINDO/300./,
  19643      $ AWINDO/6*325.,2*325.,10*325./,SWINDO_e/12*-300.,6*-700.,
  19644      $ 6*-300.,12*-300.,12*-300.,12*-300.,6*-700.,6*-300.,12*-300.,
  19645      $ 12*-300.,12*-300.,6*-700.,6*-300.,12*-300.,12*-300.,336*-300./,
  19646      $ SWINDO_l/12*+300.,6*+700.,6*+300.,12*+300.,12*+300.,12*+300.,
  19647      $ 6*+700.,6*+300.,12*+300.,12*+300.,12*+300.,6*+700.,6*+300.,
  19648      $ 12*+300.,12*+300.,336*+300./,XWINDO/24*300./,JPSSMI/24*9999/,
  19649      $ IEWNDO/-3,3/,JPERSD/6*9999/,PWINDO/4*300./,JPQKSD/6*9999/,JPWDSD/
  19650      $ 6*9999/,IQWNDO/-3,3/,IWWNDO/-3,3/,CWINDO/300./,VWINDO/300./,
  19651      $ DWINDO/300./,JPGPSD/6*9999/,GWINDO/300./,TWINDO/300./,JPASCD/
  19652      $ 6*9999/,IAWNDO/-3,3/
  19653       DATA IRTRV/2*0,544,2*0,2*0,544,2*0,2*0,544,2*0,2*0,544,2*0,60*0/,
  19654      $ KTOP/80*16/,NPZ/0/
  19655       DATA  IUNIT/11,12,15,18,21,31,41,46,48,6*0,51,52,11*0/,NFILE/0/,
  19656      $ ISATOB/0/,IPRINT/0/,ISATLS/80*2/
  19657       DATA  JAWIND/54*0/,JAMASS/54*0/,JSURFM/12*0/,
  19658      $      JSURFW/2*0,9999,0,9999,0,9999,5*0/,
  19659      $      JSWIND/12*9999,6*9999,6*0,12*0,12*9999,
  19660      $             12*9999,6*9999,6*9999,12*9999,12*9999,
  19661      $             12*9999,6*9999,6*0,12*0,12*9999,
  19662      $             12*0,6*9999,6*9999,12*9999,12*9999,
  19663      $             12*9999,6*9999,6*9999,12*9999,12*9999,
  19664      $             12*0,6*9999,6*9999,12*9999,12*9999,
  19665      $             12*9999,6*9999,6*9999,12*9999,12*9999,
  19666      $             12*9999,6*9999,6*9999,12*9999,12*9999,
  19667      $             12*9999,6*9999,6*9999,12*9999,12*9999,
  19668      $             12*9999,6*9999,6*9999,12*9999,12*9999/,
  19669      $      JSMASS/480*9999/,KEPSW/480*0/,
  19670      $      RTRAD/35*XMISS/,GRAD/18*XMISS/,SRAD/7*XMISS/,
  19671      $      IACFTL/100,8*-200/,IACFTH/3*18000,16500,4*18000,16500/,
  19672      $      LSMASS/9999/,LSWIND/9999/,KEPAC/54*0/,IGCHN/18*IMISS/,
  19673      $      KKTYPE/200*0/,SOZANG/XMISS/,SAZANG/XMISS/,OZONE/XMISS/,
  19674      $      SKINT/XMISS/,CLDAMT/XMISS/,MLEV/0/,ALTIMR/XMISS/,IVADFL/5/,
  19675      $      IVADSP/2/,POAF/XMISS/,RFFL/XMISS/,ALNCH/XMISS/,
  19676      $      TRBX/5*XMISS/,PRSS/XMISS/,CLTOP/6*XMISS/,PCAT/XMISS/,
  19677      $      ROLF/XMISS/,RIALR/XMISS/,QIFY/XMISS/,QIFN/XMISS/,
  19678      $      EEQF/XMISS/,aMSTQ/XMISS/
  19679       DATA  LFMAXI/53/,LFMAXJ/45/,FMESHL/190.5/,FLONVT/105./,
  19680      $      FPOLEI/27./,FPOLEJ/49./,LEVPM/16/,LEVST/13/,LEVQQ/8/,
  19681      $      TDLIM/215./,TDMAX/999./,ISQNUM_UPA/0/
  19682       DATA  KSKPUA/0/,KSKPSF/0/,KTIMUA/0/,KTIMSF/0/,KBDYUA/0/,KBDYSF/0/,
  19683      $      KSKNSW/0/,KSKREC/0/,KMSGUA/0/,KMSGSF/0/,KNOATS/0/,KNTUPA/0/,
  19684      $      KNTAIR/0/,KNTSWN/0/,KNTCAR/0/,KNTSFC/0/,KNTSHP/0/,KNTSLP/0/,
  19685      $      KNTMSO/0/,KNTSPL/0/,KSKSWN/0/,KSKACF/0/,KSKPMI/0/,KMSGMI/0/,
  19686      $      KBDYMI/0/,KTIMM/4*0/,KNTSMI/4*0/,KNTVAD/0/,KNTDUM/3*0/,
  19687      $      KNTPRO/0/,KSKCLS/0/,KNTTOV/2*0/,KSKPTV/2*0/,KBDYTV/2*0/,
  19688      $      KTIMTV/2*0/,KMSGTV/2*0/,KNOPTV/2*0/,KREDTV/2*0/,KLNDTV/2*0/,
  19689      $      KIPTTV/2*0/,KSKTHN/0/,KJFLAG/2*0/,KSKOMR/2*0/,KSKALM/9*0/,
  19690      $      KMSGGI/0/,KSKPGI/0/,KLNDGI/3*0/,KNDCGI/0/,KNOPGI/0/,
  19691      $      KBDYGI/0/,KTIMGI/3*0/,KNTGIS/0/,KNTGIT/0/,KNTGIP/0/,
  19692      $      KNDCDE/3*0/,KSKPSC/4*0/,KMSGSC/4*0/,KBDYSC/4*0/,KTIMSC/4*0/,
  19693      $      KNTSCT/4*0/,KSKNOW/9*0/,KSKSWD/10*0/,KSEATV/2*0/,KNTGIC/0/,
  19694      $      KSEAGI/3*0/,KSKDRP/0/,KNOCTP/0/,KSKAHM/9*0/,KNTGPS/0/,
  19695      $      KSKPGP/0/,KMSGGP/0/,KBDYGP/0/,KTIMGP/0/,KMISGP/0/,KT45GP/0/,

Page 471         Source Listing                  FIZZ01
2017-04-18 11:09                                 prepdata.f

  19696      $      KTGNSS/0/
  19697       DATA  DFTLON/MXLVL*XMISS/,DFTLAT/MXLVL*XMISS/,DFTTIM/MXLVL*XMISS/,
  19698      $      ZDRIFT/MXLVL*XMISS/,TDRIFT/MXLVL*XMISS/,
  19699      $      TDRIFTLL/MXLVL*XMISS/,UDRIFT/MXLVL*XMISS/,
  19700      $      VDRIFT/MXLVL*XMISS/,XDRIFT/MXLVL*XMISS/,YDRIFT/MXLVL*XMISS/,
  19701      $      TDRIFT_LL/MXLVL*XMISS/,KFLAG/5*0/,LFLAG/3*0/,PLO/XMISS/,
  19702      $      IFLTIM/0/,JJ/0/,II/0/,ipstnflg/0/,i2many_lvls/0/
  19703       END

Page 472         Source Listing                  _unnamed_data$_
2017-04-18 11:09 Subprograms/Common Blocks       prepdata.f



SUBPROGRAMS/COMMON BLOCKS

 Name                       Object Declared Type            Bytes Dimen Elements Attributes       References                        
                                                                                                                                    
 <Block Data>                      19554                                                                                            
 ACFTSW                     Common 2859                                 1148                                                        
 ACFTSW                     Common 3803                                 1148                                                        
 ACFTSW                     Common 10577                                1148                                                        
 ACFTSW                     Common 11262                                1148                                                        
 ACFTSW                     Common 18867                                1148                                                        
 ACFTSW                     Common 19570                                1148                                                        
 ADP                        Common 2850                                 14100                                                       
 ADP                        Common 3795                                 14100                                                       
 ADP                        Common 4963                                 14100                                                       
 ADP                        Common 5279                                 14100                                                       
 ADP                        Common 5545                                 14100                                                       
 ADP                        Common 5943                                 14100                                                       
 ADP                        Common 6865                                 14100                                                       
 ADP                        Common 7624                                 14100                                                       
 ADP                        Common 8301                                 14100                                                       
 ADP                        Common 9522                                 14100                                                       
 ADP                        Common 10036                                14100                                                       
 ADP                        Common 10565                                14100                                                       
 ADP                        Common 11259                                14100                                                       
 ADP                        Common 12539                                14100                                                       
 ADP                        Common 12908                                14100                                                       
 ADP                        Common 13212                                14100                                                       
 ADP                        Common 13376                                14100                                                       
 ADP                        Common 13956                                14100                                                       
 ADP                        Common 14814                                14100                                                       
 ADP                        Common 15138                                14100                                                       
 ADP                        Common 16371                                14100                                                       
 ADP                        Common 16512                                14100                                                       
 ADP                        Common 16862                                14100                                                       
 ADP                        Common 17204                                14100                                                       
 ADP                        Common 17714                                14100    SAVE                                               
 ADP                        Common 18850                                14100                                                       
 ADP                        Common 19560                                14100                                                       
 APDNSW                     Common 2894                                 4                                                           
 APDNSW                     Common 17724                                4        SAVE                                               
 APDNSW                     Common 19606                                4                                                           
 BALLOON_DRIFT              Subr   10026                                                                                            
 BITBUF                     Common 17730                                1650136  SAVE                                               
 BUFRLIB_MISSING            Common 2899                                 8                                                           
 BUFRLIB_MISSING            Common 3839                                 8                                                           
 BUFRLIB_MISSING            Common 4973                                 8                                                           
 BUFRLIB_MISSING            Common 5287                                 8                                                           
 BUFRLIB_MISSING            Common 9535                                 8                                                           
 BUFRLIB_MISSING            Common 11281                                8                                                           
 BUFRLIB_MISSING            Common 12552                                8                                                           
 BUFRLIB_MISSING            Common 13390                                8                                                           
 BUFRLIB_MISSING            Common 13974                                8                                                           
 BUFRLIB_MISSING            Common 15154                                8                                                           
 BUFRLIB_MISSING            Common 16874                                8                                                           
 BUFRLIB_MISSING            Common 17214                                8                                                           

Page 473         Source Listing                  _unnamed_data$_
2017-04-18 11:09 Subprograms/Common Blocks       prepdata.f

 Name                       Object Declared Type            Bytes Dimen Elements Attributes       References                        
                                                                                                                                    
 BUFRLIB_MISSING            Common 17728                                4        SAVE                                               
 BUFRLIB_MISSING            Common 18880                                8                                                           
 CLDTOP                     Common 2892                                 24                                                          
 CLDTOP                     Common 10576                                24                                                          
 CLDTOP                     Common 13962                                24                                                          
 CLDTOP                     Common 18866                                24                                                          
 CLDTOP                     Common 19604                                24                                                          
 COUNT                      Common 2871                                 800                                                         
 COUNT                      Common 10585                                800                                                         
 COUNT                      Common 19582                                800                                                         
 DATA                       Common 2848                                 32                                                          
 DATA                       Common 3796                                 32                                                          
 DATA                       Common 4967                                 32                                                          
 DATA                       Common 5278                                 32                                                          
 DATA                       Common 5945                                 32                                                          
 DATA                       Common 9524                                 32                                                          
 DATA                       Common 10566                                32                                                          
 DATA                       Common 11260                                32                                                          
 DATA                       Common 12540                                32                                                          
 DATA                       Common 13382                                32                                                          
 DATA                       Common 13965                                32                                                          
 DATA                       Common 14812                                32                                                          
 DATA                       Common 15139                                32                                                          
 DATA                       Common 16513                                32                                                          
 DATA                       Common 16863                                32                                                          
 DATA                       Common 17205                                32                                                          
 DATA                       Common 17721                                32       SAVE                                               
 DATA                       Common 18878                                32                                                          
 DATA                       Common 19559                                32                                                          
 DIRECT                     Common 3837                                 36016                                                       
 DIRECT                     Common 4971                                 36016                                                       
 DIRECT                     Common 5285                                 36016                                                       
 DIRECT                     Common 9533                                 36016                                                       
 DIRECT                     Common 10587                                36016                                                       
 DIRECT                     Common 11279                                36016                                                       
 DIRECT                     Common 12550                                36016                                                       
 DIRECT                     Common 13388                                36016                                                       
 DIRECT                     Common 13972                                36016                                                       
 DIRECT                     Common 15151                                36016                                                       
 DIRECT                     Common 16872                                36016                                                       
 DIRECT                     Common 17206                                36016                                                       
 DIRECT                     Common 17725                                36016    SAVE                                               
 DRIFT                      Common 10039                                7200                                                        
 DRIFT                      Common 18877                                7200                                                        
 DRIFT                      Common 19611                                7200                                                        
 FILDPT                     Subr   9281                                                                                             
 FILLX                      Subr   10543                                                                                            
 FILWND                     Subr   9089                                                                                             
 FIZZ01                     Subr   18825                                                                                            
 FIZZAA                     Common 17715                                48216    SAVE                                               
 FIZZAA                     Common 18856                                48216                                                       
 GETC06                     Subr   11241                                                                                            
 GETGPSIPW                  Subr   17191                                                                                            
 GETPWATER                  Subr   14803                                                                                            
 GETSCATT                   Subr   16847                                                                                            

Page 474         Source Listing                  _unnamed_data$_
2017-04-18 11:09 Subprograms/Common Blocks       prepdata.f

 Name                       Object Declared Type            Bytes Dimen Elements Attributes       References                        
                                                                                                                                    
 GETSMI                     Subr   16498                                                                                            
 GETUPA                     Subr   5930                                                                                             
 GOESCHK                    Subr   14648                                                                                            
 GOESDG                     Subr   13913                                                                                            
 GOSWCH                     Common 2865                                 100                                                         
 GOSWCH                     Common 3809                                 100                                                         
 GOSWCH                     Common 12911                                100                                                         
 GOSWCH                     Common 13957                                100                                                         
 GOSWCH                     Common 14651                                100                                                         
 GOSWCH                     Common 19576                                100                                                         
 GPSWCH                     Common 2890                                 68                                                          
 GPSWCH                     Common 3812                                 68                                                          
 GPSWCH                     Common 17210                                68                                                          
 GPSWCH                     Common 19600                                68                                                          
 GRID                       Common 2846                                 40                                                          
 GRID                       Common 4965                                 40                                                          
 GRID                       Common 5143                                 40                                                          
 GRID                       Common 19563                                40                                                          
 HSTATS                     Subr   7621                                                                                             
 ISEL                       Func   5783     I(4)            4           scalar                    5791,5796                         
 ISSEL                      Func   16365    I(4)            4           scalar                    16424                             
 LAUNCH                     Common 5282                                 4                                                           
 LAUNCH                     Common 10040                                4                                                           
 LAUNCH                     Common 19608                                4                                                           
 LEVELS                     Common 10568                                4                                                           
 LEVELS                     Common 18861                                4                                                           
 LEVELS                     Common 19561                                4                                                           
 LFMSFC                     Common 2868                                 224                                                         
 LFMSFC                     Common 3822                                 224                                                         
 LFMSFC                     Common 9530                                 224                                                         
 LFMSFC                     Common 11276                                224                                                         
 LFMSFC                     Common 15142                                224                                                         
 LFMSFC                     Common 19579                                224                                                         
 LL2IJ                      Subr   5141                                                                                             
 LNDCHK                     Subr   5647                                                                                             
 LNDSEA                     Common 2845                                 284996                                                      
 LNDSEA                     Common 3821                                 284996                                                      
 LNDSEA                     Common 11258                                284996                                                      
 LNDSEA                     Common 13954                                284996                                                      
 LNDSEA                     Common 15137                                284996                                                      
 MISWCH                     Common 2883                                 264                                                         
 MISWCH                     Common 3828                                 264                                                         
 MISWCH                     Common 10583                                264                                                         
 MISWCH                     Common 16516                                264                                                         
 MISWCH                     Common 18873                                264                                                         
 MISWCH                     Common 19595                                264                                                         
 PARM2                      Common 2872                                 12                                                          
 PARM2                      Common 5948                                 12                                                          
 PARM2                      Common 9527                                 12                                                          
 PARM2                      Common 19583                                12                                                          
 PARM3                      Common 2873                                 56                                                          
 PARM3                      Common 3816                                 56                                                          
 PARM3                      Common 5949                                 56                                                          
 PARM3                      Common 11269                                56                                                          
 PARM3                      Common 18862                                56                                                          

Page 475         Source Listing                  _unnamed_data$_
2017-04-18 11:09 Subprograms/Common Blocks       prepdata.f

 Name                       Object Declared Type            Bytes Dimen Elements Attributes       References                        
                                                                                                                                    
 PARM3                      Common 19584                                56                                                          
 PARM4                      Common 2875                                 4                                                           
 PARM4                      Common 3818                                 4                                                           
 PARM4                      Common 15144                                4                                                           
 PARM4                      Common 19586                                4                                                           
 PARM5                      Common 2876                                 32                                                          
 PARM5                      Common 3819                                 32                                                          
 PARM5                      Common 5951                                 32                                                          
 PARM5                      Common 6868                                 32                                                          
 PARM5                      Common 7785                                 32                                                          
 PARM5                      Common 8305                                 32                                                          
 PARM5                      Common 9100                                 32                                                          
 PARM5                      Common 9528                                 32                                                          
 PARM5                      Common 19587                                32                                                          
 PARM6                      Common 2877                                 32                                                          
 PARM6                      Common 3820                                 32                                                          
 PARM6                      Common 5952                                 32                                                          
 PARM6                      Common 6869                                 32                                                          
 PARM6                      Common 9529                                 32                                                          
 PARM6                      Common 10570                                32                                                          
 PARM6                      Common 12549                                32                                                          
 PARM6                      Common 13385                                32                                                          
 PARM6                      Common 13968                                32                                                          
 PARM6                      Common 16867                                32                                                          
 PARM6                      Common 19588                                32                                                          
 PFSWCH                     Common 2896                                 36                                                          
 PFSWCH                     Common 3835                                 36                                                          
 PFSWCH                     Common 5283                                 36                                                          
 PFSWCH                     Common 9532                                 36                                                          
 PFSWCH                     Common 19609                                36                                                          
 PREP                       Subr   3770                                                                                             
 PREPOBS_PREPDATA           Prog   2785                                                                                             
 PREVSW                     Common 2893                                 4                                                           
 PREVSW                     Common 17723                                4        SAVE                                               
 PREVSW                     Common 19605                                4                                                           
 PSTNFLG                    Common 2898                                 4                                                           
 PSTNFLG                    Common 15153                                4                                                           
 PSTNFLG                    Common 19615                                4                                                           
 PWSWCH                     Common 3834                                 24                                                          
 PWSWCH                     Common 13969                                24                                                          
 PWSWCH                     Common 14815                                24                                                          
 PWSWCH                     Common 16518                                24                                                          
 PWSWCH                     Common 17209                                24                                                          
 RADANC                     Common 2888                                 320                                                         
 RADANC                     Common 3814                                 320                                                         
 RADANC                     Common 10574                                320                                                         
 RADANC                     Common 13386                                320                                                         
 RADANC                     Common 13960                                320                                                         
 RADANC                     Common 18864                                320                                                         
 RADANC                     Common 19602                                320                                                         
 RASSSW                     Common 2897                                 8                                                           
 RASSSW                     Common 3836                                 8                                                           
 RASSSW                     Common 19610                                8                                                           
 RPTHDR                     Common 2849                                 88                                                          
 RPTHDR                     Common 3797                                 88                                                          

Page 476         Source Listing                  _unnamed_data$_
2017-04-18 11:09 Subprograms/Common Blocks       prepdata.f

 Name                       Object Declared Type            Bytes Dimen Elements Attributes       References                        
                                                                                                                                    
 RPTHDR                     Common 4968                                 88                                                          
 RPTHDR                     Common 5280                                 88                                                          
 RPTHDR                     Common 5546                                 88                                                          
 RPTHDR                     Common 5946                                 88                                                          
 RPTHDR                     Common 6864                                 88                                                          
 RPTHDR                     Common 7783                                 88                                                          
 RPTHDR                     Common 8302                                 88                                                          
 RPTHDR                     Common 9099                                 88                                                          
 RPTHDR                     Common 9290                                 88                                                          
 RPTHDR                     Common 9526                                 88                                                          
 RPTHDR                     Common 10038                                88                                                          
 RPTHDR                     Common 10567                                88                                                          
 RPTHDR                     Common 11261                                88                                                          
 RPTHDR                     Common 12541                                88                                                          
 RPTHDR                     Common 13213                                88                                                          
 RPTHDR                     Common 13383                                88                                                          
 RPTHDR                     Common 13966                                88                                                          
 RPTHDR                     Common 14813                                88                                                          
 RPTHDR                     Common 15140                                88                                                          
 RPTHDR                     Common 16372                                88                                                          
 RPTHDR                     Common 16514                                88                                                          
 RPTHDR                     Common 16864                                88                                                          
 RPTHDR                     Common 17208                                88                                                          
 RPTHDR                     Common 17722                                88       SAVE                                               
 RPTHDR                     Common 18860                                88                                                          
 RPTLBL                     Subr   5268                                                                                             
 RUNSW                      Common 2851                                 4                                                           
 RUNSW                      Common 5953                                 4                                                           
 RUNSW                      Common 15134                                4                                                           
 SATBFR                     Subr   13343                                                                                            
 SATEDS                     Subr   12512                                                                                            
 SATSW2                     Common 2854                                 1944                                                        
 SATSW2                     Common 12547                                1944                                                        
 SATSW2                     Common 12909                                1944                                                        
 SATSW2                     Common 13380                                1944                                                        
 SATSW2                     Common 13963                                1944                                                        
 SATSW2                     Common 19565                                1944                                                        
 SATSW3                     Common 2856                                 11604                                                       
 SATSW3                     Common 3800                                 11604                                                       
 SATSW3                     Common 7401                                 11604                                                       
 SATSW3                     Common 10580                                11604                                                       
 SATSW3                     Common 11265                                11604                                                       
 SATSW3                     Common 18870                                11604                                                       
 SATSW3                     Common 19567                                11604                                                       
 SBDRIFT                    Common 10041                                19248                                                       
 SBDRIFT                    Common 19612                                19248                                                       
 SCTWCH                     Common 2885                                 208                                                         
 SCTWCH                     Common 3830                                 208                                                         
 SCTWCH                     Common 16868                                208                                                         
 SCTWCH                     Common 19597                                208                                                         
 SFCBFR                     Common 10586                                8                                                           
 SFCBFR                     Common 13970                                8                                                           
 SFCBFR                     Common 15149                                8                                                           
 SFCBFR                     Common 17212                                8                                                           
 SFCBFR                     Common 18875                                8                                                           

Page 477         Source Listing                  _unnamed_data$_
2017-04-18 11:09 Subprograms/Common Blocks       prepdata.f

 Name                       Object Declared Type            Bytes Dimen Elements Attributes       References                        
                                                                                                                                    
 SFCBFR                     Common 19589                                8                                                           
 SFCDTA                     Subr   15118                                                                                            
 SKPCNT                     Common 2878                                 252                                                         
 SKPCNT                     Common 3824                                 252                                                         
 SKPCNT                     Common 11271                                252                                                         
 SKPCNT                     Common 15145                                252                                                         
 SKPCNT                     Common 19590                                252                                                         
 SKPSUB                     Common 2895                                 205824                                                      
 SKPSUB                     Common 3833                                 205824                                                      
 SKPSUB                     Common 4970                                 205824                                                      
 SKPSUB                     Common 13971                                205824                                                      
 SKPSUB                     Common 15150                                205824                                                      
 SKPSUB                     Common 16871                                205824                                                      
 SKPSUB                     Common 17213                                205824                                                      
 SKPSUB                     Common 19607                                205824                                                      
 SMERGE                     Subr   6847                                                                                             
 SNDATA                     Common 2853                                 38400                                                       
 SNDATA                     Common 5944                                 38400                                                       
 SNDATA                     Common 6866                                 38400                                                       
 SNDATA                     Common 7784                                 38400                                                       
 SNDATA                     Common 8303                                 38400                                                       
 SNDATA                     Common 9523                                 38400                                                       
 SNDATA                     Common 10037                                38400                                                       
 SNDATA                     Common 13384                                38400                                                       
 SNDATA                     Common 13967                                38400                                                       
 SNDPRP                     Subr   13205                                                                                            
 SNDTBL                     Subr   12901                                                                                            
 STOROB                     Subr   9504                                                                                             
 STRCTY                     Common 3792                                 2400                                                        
 STRCTY                     Common 9519                                 2400                                                        
 STRCTY                     Common 10560                                2400                                                        
 STRCTY                     Common 11256                                2400                                                        
 STRCTY                     Common 18851                                2400                                                        
 STRMOB                     Common 3793                                 43200                                                       
 STRMOB                     Common 9520                                 43200                                                       
 STRMOB                     Common 10563                                43200                                                       
 STRMOB                     Common 11257                                43200                                                       
 STRMOB                     Common 15136                                43200                                                       
 STRMOB                     Common 16510                                43200                                                       
 STRMOB                     Common 16861                                43200                                                       
 STRMOB                     Common 18852                                43200                                                       
 STRMSL                     Common 3794                                 12                                                          
 STRMSL                     Common 10562                                12                                                          
 STRMSL                     Common 15135                                12                                                          
 STRMSL                     Common 18853                                12                                                          
 STRPWT                     Common 10561                                60                                                          
 STRPWT                     Common 14811                                60                                                          
 STRPWT                     Common 18854                                60                                                          
 STRRRT                     Common 10564                                4                                                           
 STRRRT                     Common 16511                                4                                                           
 STRRRT                     Common 16866                                4                                                           
 STRRRT                     Common 18855                                4                                                           
 SWNTBL                     Subr   7396                                                                                             
 TIMCHK                     Subr   5539                                                                                             
 TVSWCH                     Common 2862                                 108                                                         

Page 478         Source Listing                  _unnamed_data$_
2017-04-18 11:09 Subprograms/Common Blocks       prepdata.f

 Name                       Object Declared Type            Bytes Dimen Elements Attributes       References                        
                                                                                                                                    
 TVSWCH                     Common 3806                                 108                                                         
 TVSWCH                     Common 10571                                108                                                         
 TVSWCH                     Common 12544                                108                                                         
 TVSWCH                     Common 13377                                108                                                         
 TVSWCH                     Common 19573                                108                                                         
 UNITNO                     Common 2852                                 116                                                         
 UNITNO                     Common 3798                                 116                                                         
 UNITNO                     Common 4964                                 116                                                         
 UNITNO                     Common 5281                                 116                                                         
 UNITNO                     Common 9521                                 116                                                         
 UNITNO                     Common 10569                                116                                                         
 UNITNO                     Common 12543                                116                                                         
 UNITNO                     Common 13375                                116                                                         
 UNITNO                     Common 13955                                116                                                         
 UNITNO                     Common 15141                                116                                                         
 UNITNO                     Common 16515                                116                                                         
 UNITNO                     Common 16865                                116                                                         
 UNITNO                     Common 17203                                116                                                         
 UNITNO                     Common 17719                                116      SAVE                                               
 UNITNO                     Common 18876                                116                                                         
 UNITNO                     Common 19562                                116                                                         
 UNPREPBF                   Subr   4953                                                                                             
 UPALIM                     Common 2870                                 28                                                          
 UPALIM                     Common 3799                                 28                                                          
 UPALIM                     Common 5947                                 28                                                          
 UPALIM                     Common 6867                                 28                                                          
 UPALIM                     Common 8304                                 28                                                          
 UPALIM                     Common 9525                                 28                                                          
 UPALIM                     Common 11268                                28                                                          
 UPALIM                     Common 12542                                28                                                          
 UPALIM                     Common 13214                                28                                                          
 UPALIM                     Common 16373                                28                                                          
 UPALIM                     Common 18879                                28                                                          
 UPALIM                     Common 19581                                28                                                          
 UV                         Subr   6724                                                                                             
 W3FIZZ                     Subr   17694                                                                                            
 WNDBYP                     Subr   7770                                                                                             
 WNDBYZ                     Subr   8287                                                                                             
 WORD                       Common 2844                                 8                                                           
 WORD                       Common 6863                                 8                                                           
 WORD                       Common 7782                                 8                                                           
 WORD                       Common 8300                                 8                                                           
 XTRHD2                     Common 4969                                 27                                                          
 XTRHD2                     Common 5284                                 27                                                          
 XTRHD2                     Common 10589                                27                                                          
 XTRHD2                     Common 11278                                27                                                          
 XTRHD2                     Common 17720                                27       SAVE                                               

COMPILER OPTIONS BEING USED

       -align noall                          -align nonone
       -align nocommons                      -align nodcommons
       -align noqcommons                     -align nozcommons
       -align records                        -align nosequence
       -align norec1byte                     -align norec2byte

Page 479         Source Listing                  _unnamed_data$_
2017-04-18 11:09                                 prepdata.f

       -align norec4byte                     -align norec8byte
       -align norec16byte                    -align norec32byte
       -align norec64byte                    -align noarray8byte
       -align noarray16byte                  -align noarray32byte
       -align noarray64byte                  -align noarray128byte
       -align noarray256byte                 -altparam
       -assume accuracy_sensitive            -assume nobscc
       -assume nobuffered_io                 -assume nobuffered_stdout
       -assume nobyterecl                    -assume nocc_omp
       -assume nocstring                     -assume nodummy_aliases
       -assume nofpe_summary                 -assume noieee_fpe_flags
       -assume nominus0                      -assume noold_boz
       -assume old_complex_align             -assume old_unit_star
       -assume noold_ldout_format            -assume noold_logical_ldio
       -assume old_maxminloc                 -assume old_xor
       -assume noprotect_allocates           -assume protect_constants
       -assume noprotect_parens              -assume split_common
       -assume source_include                -assume nostd_intent_in
       -assume std_minus0_rounding           -assume nostd_mod_proc_name
       -assume std_value                     -assume norealloc_lhs
       -assume underscore                    -assume no2underscores
       -auto                            no   -auto_scalar
  no   -bintext                              -ccdefault default
       -check noargs                         -check noarg_temp_created
       -check noassume                       -check nobounds
       -check noformat                       -check nooutput_conversion
       -check nooverflow                     -check nopointers
       -check power                          -check noshape
       -check nostack                        -check nounderflow
       -check nouninitialized                -coarray-num-procs 0
  no   -coarray-config-file                  -convert big_endian
       -cross_reference                      -D __INTEL_COMPILER=1600
       -D __INTEL_COMPILER_UPDATE=3          -D __unix__
       -D __unix                             -D __linux__
       -D __linux                            -D __gnu_linux__
       -D unix                               -D linux
       -D __ELF__                            -D __x86_64
       -D __x86_64__                         -D __amd64
       -D __amd64__                          -D __INTEL_COMPILER_BUILD_DATE=20160415
       -D __INTEL_OFFLOAD                    -D __i686
       -D __i686__                           -D __pentiumpro
       -D __pentiumpro__                     -D __pentium4
       -D __pentium4__                       -D __tune_pentium4__
       -D __SSE2__                           -D __SSE2_MATH__
       -D __SSE__                            -D __SSE_MATH__
       -D __MMX__                            -double_size 64
  no   -d_lines                         no   -Qdyncom
       -error_limit 30                  no   -f66
  no   -f77rtl                          no   -fast
       -fpscomp nofilesfromcmd               -fpscomp nogeneral
       -fpscomp noioformat                   -fpscomp noldio_spacing
       -fpscomp nologicals                   -fixed
  no   -fpconstant                           -fpe3
       -fprm nearest                    no   -ftz
       -fp_model noprecise                   -fp_model fast
       -fp_model nostrict                    -fp_model nosource
       -fp_model nodouble                    -fp_model noextended

Page 480         Source Listing                  _unnamed_data$_
2017-04-18 11:09                                 prepdata.f

       -fp_model novery_fast                 -fp_model noexcept
       -fp_model nono_except                 -heap_arrays 0
  no   -threadprivate_compat                 -g2
       -iface nomixed_str_len_arg            -iface nono_mixed_str_len_arg
       -init noarrays                        -init noinf
       -init nonan                           -init nosnan
       -init nozero                     no   -intconstant
       -integer_size 32                 no   -mixed_str_len_arg
  no   -module                               -names lowercase
  no   -noinclude                            -offload-build=host
       -O2                              no   -pad_source
       -real_size 32                    no   -recursive
       -reentrancy none                 no   -sharable_localsaves
       -vec=simd                             -show noinclude
       -show map                             -show options
  no   -syntax_only                     no   -threadcom
  no   -U                               no   -vms
       -w noall                              -w nonone
       -w alignments                         -w noargument_checking
       -w nodeclarations                     -w general
       -w noignore_bounds                    -w noignore_loc
       -w nointerfaces                       -w notruncated_source
       -w uncalled                           -w uninitialized
       -w nounused                           -w usage
  no   -wrap-margins

       -includepath : /usrx/local/intel/2016SP3/daal/include/,/usr/include/,.FOR,./.FOR,/usrx/local/intel/2016SP3/ipp/include/.FOR,
           /usrx/local/intel/2016SP3/mkl/include/.FOR,/usrx/local/intel/2016SP3/tbb/include/.FOR,/usrx/local/intel/2016SP3/daal/include/.FOR,
           /gpfs/tp1/usrx/local/intel/2016SP3/compilers_and_libraries_2016.3.210/linux/compiler/include/intel64/.FOR,
           /gpfs/tp1/usrx/local/intel/2016SP3/compilers_and_libraries_2016.3.210/linux/compiler/include/.FOR,/usr/local/include/.FOR,
           /usr/lib/gcc/x86_64-redhat-linux/4.4.7/include/.FOR,/usr/include/.FOR,/usr/include/.FOR,/usr/include/.FOR
       -list filename : prepdata.lst
       -o    filename : none

COMPILER: Intel(R) Fortran 16.0-1633
