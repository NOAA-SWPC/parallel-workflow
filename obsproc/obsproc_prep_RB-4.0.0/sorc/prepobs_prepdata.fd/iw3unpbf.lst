Page 1           Source Listing                  IW3UNPBF
2017-04-18 11:09                                 iw3unpbf.f

      1 C$$$  SUBPROGRAM DOCUMENTATION BLOCK
      2 C
      3 C SUBPROGRAM:    IW3UNPBF
      4 C   PRGMMR: KEYSER           ORG: NP22       DATE: 2017-01-11
      5 C
      6 C ABSTRACT: READS AND UNPACKS ONE REPORT FROM INPUT NCEP BUFR DUMP
      7 C   FILE INTO SPECIFIED FORMAT.  FUNCTION RETURNS THE UNPACKED REPORT
      8 C   TO THE CALLING PROGRAM IN THE ARRAY 'OBS' AS WELL AS IN VARIABLES
      9 C   'STNID', 'CRES1', 'CRES2', 'OBS2', 'OBS3' AND 'OBS8_8'.  IT ALSO
     10 C   RETURNS INFORMATION ABOUT THE INPUT DATA SET ITSELF (NAME, CENTER
     11 C   DATE, DUMP TIME) AND THE BUFR MESSAGE TYPE.  VARIOUS CONTINGENCIES
     12 C   ARE COVERED BY RETURN VALUE OF THE FUNCTION AND PARAMETER 'IER' -
     13 C   FUNCTION AND IER HAVE SAME VALUE.  REPEATED CALLS OF FUNCTION WILL
     14 C   RETURN A SEQUENCE OF UNPACKED REPORTS.  THE CALLING PROGRAM MAY
     15 C   SWITCH TO A NEW 'NUNIT' AT ANY TIME, THAT DATASET WILL THEN BE READ
     16 C   IN SEQUENCE.  IF USER SWITCHES BACK TO A PREVIOUS 'NUNIT', THAT
     17 C   DATA SET WILL BE READ FROM THE BEGINNING, NOT FROM WHERE THE USER
     18 C   LEFT OFF (THIS IS A 'SOFTWARE TOOL', NOT AN ENTIRE I/O SYSTEM).
     19 C   ARGUMENT 'IER' IS ALSO CHECKED UPON INPUT THE FIRST TIME A NEW
     20 C   'NUNIT' IS PASSED IN. C   IF 'IER' IS -1 IN THIS CASE, THIS
     21 C   INDICATES THAT THE FILE ASSOCIATED WITH "NUNIT" HAS ALREADY BEEN
     22 C   OPENED BY THE CORRESPONDING INTERFACE SUBROUTINE W3UNPKB7 AND SOME
     23 C   REPORTS HAVE BEEN PROCESSED.  IN THIS CASE, THIS ROUTINE WILL
     24 C   CONTINUE READING AND PROCESSING REPORTS FROM 'NUNIT' (OTHERWISE IER
     25 C   SHOULD BE INPUT AS ZERO THE FIRST TIME A NEW 'NUNIT' IS PASSED IN).
     26 C
     27 C PROGRAM HISTORY LOG:
     28 C 1998-02-17  D. A. KEYSER -- ORIGINAL AUTHOR (ADAPTED FROM W3LIB
     29 C     ROUTINE IW3GAD)
     30 C 1998-03-16  D. A. KEYSER -- BUMPED UP ARRAY SIZE FOR UNPACKED
     31 C     REPORT IN "OBS" FROM 1608 TO 2500; SUBROUTINE NO LONGER RETURNS
     32 C     WITH IER=999 IF UNPACKED ARRAY SIZE IS EXCEEDED - RATHER IT SKIPS
     33 C     PROCESSING OF OFFENDING REPORT AND PRINTS A DIAGNOSTIC; BUMP UP
     34 C     MAXIMUM NUMBER OF LEVELS THAT CAN BE PROCESSED FOR A CATEGORY
     35 C     FROM 150 TO 160
     36 C 1998-06-15  D. A. KEYSER -- STREAMLINED THE PROCESSING OF FLIGHT-
     37 C     LEVEL RECONNAISSANCE REPORTS; REDEFINED UNITS FOR UNPACKED WORDS
     38 C     1 (LATITUDE), 2 (LONGITUDE), 4 (OBS. TIME) AND 11 (RECEIPT TIME)
     39 C     - ALL TO STREAMLINE PROCESSING IN PREPDATA PROGRAM; IN ADPUPA
     40 C     PROCESSING, REMOVED WRITING OF CAT. 8 C.F. 106, ADDED WRITING OF
     41 C     NEW CAT. 8 C.F. 353 (SOLAR AND INFRARED RADIATION CORRECTION
     42 C     INDICATOR) AND 354 (TRACKING TECHNIQUE/STATUS OF SYSTEM USED
     43 C     INDICATOR)
     44 C 1998-09-21  D. A. KEYSER -- SUBROUTINE NOW Y2K AND FORTRAN 90
     45 C     COMPLIANT
     46 C 1999-01-20 D. A. KEYSER -- INCORPORATED BOB KISTLER'S CHANGES NEEDED
     47 C     TO PORT THE CODE TO THE IBM SP; ADDED REPORT SUBTYPE 1 FOR RECCOS
     48 C     UNDER REPORT TYPE 31 AND SUBTYPE 2 FOR DROPS UNDER REPORT TYPE 31
     49 C 1999-02-25  D. A. KEYSER -- ADDED ABILITY TO READ REPROCESSED SSM/I
     50 C     NCEP BUFR DUMP FILE (SPSSMI); ADDED ABILITY TO READ MEAN SEA-
     51 C     LEVEL PRESSURE BOGUS (PAOBS) DATA SET (SFCBOG); ADDED PROCESSING
     52 C     OF MDCRS ACARS MOISTURE DATA (READ IN AS MIXING RATIO AND
     53 C     CONVERTED TO DEWPOINT DEPRESSION); MAND. LVLS WITH ONLY WIND NOW
     54 C     STORED AS CAT. 1 (USED TO STORE AS CAT. 3 LIKE OLD ON29); TROP.
     55 C     LVLS NOW STORED AS ONLY CAT. 5 (USED TO STORE AS BOTH CAT. 3 AND
     56 C     5); U.S. RAOBS NO LONGER TRUNCATE WIND-BY-HGT HGTS ABOVE 100 MB
     57 C     DOWN TO NEXT 10 METER LVL (THIS WAS AN OLD ON29 CONVENTION)

Page 2           Source Listing                  IW3UNPBF
2017-04-18 11:09                                 iw3unpbf.f

     58 C 1999-05-14  D. A. KEYSER -- MADE FURTHER CHANGES NECESSARY TO PORT
     59 C     THIS ROUTINE TO THE IBM SP
     60 C 1999-06-18  D. A. KEYSER -- CAN NOW PROCESS WATER VAPOR SATWNDS FROM
     61 C     FOREIGN PRODUCERS; STN. ID FOR FOREIGN SATWNDS NOW REPROCESSED IN
     62 C     SAME WAY AS FOR NESDIS/GOES SATWNDS, CHARACTER 1 OF STN. ID NOW
     63 C     DEFINES EVEN VS. ODD SATELLITE WHILE CHARACTER 6 OF STN. ID NOW
     64 C     DEFINES IR CLOUD-DRFT VS. VISIBLE CLOUD DRFT VS. WATER VAPOR
     65 C 1999-08-04  D. A. KEYSER -- UPDATED CALL TO ORDERS TO CORRECT ERROR
     66 C     SINCE ORDERS WAS RECENTLY UPDATED IN W3LIB (4-BYTE REAL MACHINE
     67 C     VERSION WAS PASSING 8-BYTE SORT KEYS WHICH CAUSED CAT. 2,3,4
     68 C     PRESSURE SORT AND CAT. 8 CODE FIG. SORT TO NO LONGER WORK
     69 C     PROPERLY); ADDED CALL TO SUBR. WORDLENGTH TO DETERMINE REAL AND
     70 C     INTEGER MACHINE WORDLENGTH SO PROPER SORT KEY WORD LENGTH IS
     71 C     ALWAYS PASSED INTO ORDERS; NOW FLAGS ALL VARIABLES (Q.M.=14) ON
     72 C     DUPLICATE PRESSURE LEVELS WHERE OTHER DATA DISAGREE
     73 C 1999-11-02  D. A. KEYSER -- CHANGES TO MAKE CODE MORE PORTABLE
     74 C 1999-11-04 D. A. KEYSER -- ADDED NEW INPUT ARGUMENT "SUBSKP" - SEE
     75 C     DESCRIPTION BELOW
     76 C 2000-01-24  D. A. KEYSER -- ADDED WRITING OF NEW CAT. 8 C.F. 355
     77 C     (NESDIS RECURSIVE FILTER FUNCTION) IN SATWND PROCESSING; MOVED
     78 C     GOES SATWND Q.M. ASSIGNMENT BASED ON RFFL FROM SATWND PROCESSING
     79 C     IN THIS SUBROUTINE TO SUBROUTINE GETC06 INLINE IN PREPDATA; THIS
     80 C     SUBROUTINE NOW ASSIGNS CHAR. 1 AND CHAR. 6 OF NESDIS SATWND
     81 C     REPORTS IN SATWND PROCESSING (HAD USED VALUES ASSIGNED BY INGEST
     82 C     PROGRAM); SATWND PROCESSING MODIFIED TO HANDLE FUTURE EXPANDED
     83 C     NESDIS SATWND FORMAT READ IN FROM NESDIS BUFR FILE
     84 C 2000-06-07  D. A. KEYSER -- SATWND PROCESSING FURTHER MODIFIED TO
     85 C     HANDLE NEW EXPANDED NESDIS SATWND FORMAT READ IN FROM NESDIS BUFR
     86 C     FILES
     87 C 2000-09-22  D. A. KEYSER -- ADDED NEW REPORT TYPE (RTP) OF 533 FOR
     88 C     SURFACE MARINE AUTOMATED TIDE GAUGE REPORTS; FURTHER
     89 C     MODIFICATIONS TO SATWND PROCESSING TO HANDLE NEW EXPANDED NESDIS
     90 C     SATWND FORMAT, IN PARTICULAR NESDIS WINDS GENERATED FROM THE GMS
     91 C     SATELLITE
     92 C 2000-12-05  D. A. KEYSER -- CHANGED REPORT TYPE (RTP) FOR SURFACE
     93 C     MARINE AUTOMATED TIDE GAUGE REPORTS FROM 533 TO 532 SO THEY AGREE
     94 C     WITH REPORT TYPE IN QUIPS PROCESSING; SATWND PROCESSING MODIFIED
     95 C     TO HANDLE OLD LO-DENSITY NESDIS FORMAT IN NC005001-NC005004 (FOR
     96 C     HISTORICAL RERUNS); SATWND PROCESSING MODIFIED TO NOT CREATE STN.
     97 C     ID IF IT HAS ALREADY BEEN CREATED BY BUFR_DUPSAT (OTHERWISE,
     98 C     MODIFIED TO CREATE AN 8-CHARACTER STN. ID); ALL CAT. 6 TYPES NOW
     99 C     STORE SPEC. HUMIDITY AS MOISTURE VARIABLE RATHER THAN DEWPOINT
    100 C     DEPR.; MDCRS ACARS AIRCRAFT NOW PROCESSES MOISTURE ONLY IF
    101 C     MOISTURE QUALITY IS "GOOD", IN THIS CASE IF MIXING RATIO IS FOUND
    102 C     IT IS USED OTHERWISE LOOKS FOR RELATIVE HUM. (BEFORE, MOISTURE
    103 C     QUALITY IND. WAS NOT EXAMINED AND ONLY MIXING RATIO WAS DECODED)
    104 C 2001-04-06  D. A. KEYSER -- MODIFIED TO HANDLE NEW BUFR EUMETSAT
    105 C     WINDS IN SUBSETS "NC005064", "NC005065" AND "NC005066"; NOW
    106 C     STORES SSM/I RAINFALL RATE (CAT. 8, C.F. 198) IN UNITS OF MM/SEC
    107 C     (STORED TO 10**6 PRECISION) (RATHER THAN WHOLE MM/HR), SSM/I
    108 C     SURFACE TEMP (CAT. 8, C.F. 199) IN UNITS OF K (STORED TO 10**2
    109 C     PRECISION) (RATHER THAN WHOLE K), SSM/I TPW (CAT. 8, C.F. 197) IN
    110 C     UNITS OF MM (STORED TO 10**1 PRECISION) (RATHER THAN MM*100), AND
    111 C     SSM/I WSPD (CAT. 8, C.F. 196) IN UNITS OF M/SEC (STORED TO 10**1
    112 C     PRECISION) (RATHER THAN M/SEC*10); NOW LOOKS FOR SSM/I RAINFALL
    113 C     RATE IN MNEMONIC "REQ6" FIRST, IF NOT FOUND LOOKS IN "REQV"
    114 C     (LATTER FOR HISTORICAL RERUNS); CAN NOW UNPACK SSM/I SEA-SURFACE

Page 3           Source Listing                  IW3UNPBF
2017-04-18 11:09                                 iw3unpbf.f

    115 C     TEMPERATURE PRODUCT (RTYP=577), STORES AS CAT. 8, C.F. 203; NOW
    116 C     READS INPUT VALUE FOR IER ON FIRST CALL FOR A "NUNIT", IF IER=-1
    117 C     ASSUMES THAT THE FILE ASSOCIATED WITH "NUNIT" HAS ALREADY BEEN
    118 C     OPENED BY SUBR. "W3UNPKB7" AND REPORTS HAVE BEEN PROCESSED, IN
    119 C     THIS CASE THIS ROUTINE WILL CONTINUE READING AND PROCESSING
    120 C     REPORTS FROM "NUNIT" (THE OUTPUT ARGUMENTS DSNAME, IDSDAT AND
    121 C     IDSDMP_8 ALSO BECOME INPUT ARGUMENTS IN THIS CASE) (CALLING
    122 C     PROGRAM SHOULD OTHERWISE SET IER=0 ON FIRST CALL FOR A NEW
    123 C     "NUNIT"); CAN NOW PROCESS WIND PROFILERS THAT ORIGINATE FROM
    124 C     PILOT (PIBAL) FORMAT BULLETINS, GET R. TYPE 073; CORRECTED A BUG
    125 C     WHICH MIGHT HAVE PREVENTED A DIAGNOSTIC PRINT FOR CASES WHEN
    126 C     'SUBSKP' IS PASSED IN AS TRUE FOR SOME BUFR TYPE/SUBTYPE; ADDED
    127 C     "SUBSET_r" (BUFR MESSAGE TYPE) AS AN INPUT/OUTPUT ARGUMENT (INPUT
    128 C     ONLY WHEN IER IS PASSED IN AS -1;  HEADER WORD 6 (WAS MISSING)
    129 C     NOW RETURNS SATELLITE ID FOR SATWIND AND SSM/I NON-SUPEROB
    130 C     REPORTS (FOR OTHERS IT'S STILL MISSING); NOW STORES SSM/I
    131 C     BRIGHTNESS TEMPS (CAT. 8, C.F. 189-195) IN UNITS OF K (STORED TO
    132 C     10**2 PRECISION) (RATHER THAN K*100); CAN NOW UNPACK 4 MDCRS
    133 C     ACARS TURBULENCE INDECES AND STORE AS CAT. 8, C.F. 926-929
    134 C 2001-06-03  D. A. KEYSER -- MODIFIED TO HANDLE EXPANDED Q.C. INFO
    135 C     FOR BUFR EUMETSAT WINDS IN SUBSETS "NC005064", "NC005065" AND
    136 C     "NC005066" IMPLEMENTED ON 6-4-2001 (NOW HAS Q.C. NOT BASED ON
    137 C     FIRST GUESS, ALONG WITH Q.C. BASED ON FIRST GUESS AS BEFORE, WE
    138 C     ONLY WANT THE LATTER FOR NOW)
    139 C 2001-06-19  D. A. KEYSER -- REMOVED A TEMPORARY FIX TO FORCE A
    140 C     "VSIG" OF 2 OR 64 FOR WIND PROFILERS THAT ORIGNATE FROM PILOT
    141 C     (PIBAL) FORMAT BULLETINS IN 002/009 - THIS HAS BEEN FIXED IN THE
    142 C     DECODER
    143 C 2002-01-28  D. A. KEYSER -- PRECISION OF TEMPERATURE OBS (AMDAR
    144 C     FORMAT AND MDCRS ACARS) NOW STORED AS DEG. K * 100 IN CAT. 8 C.F.
    145 C     915 SINCE IT IS STORED WITH 10**2 PRECISION IN DUMPS (WAS STORED
    146 C     AS DEG. K * 1 WITH INCORRECT COMMENTS THAT IT WAS A BUFR CODE
    147 C     TABLE 0-08-005, ACTUAL DESC. IS 0-02-005)
    148 C 2002-03-05  D. A. KEYSER -- ACCOUNTS FOR CHANGES IN INPUT ADPUPA,
    149 C     ADPSFC, AIRCFT AND AIRCAR BUFR DUMP FILES AFTER 5/2002: CAT. 7
    150 C     AND CAT. 51 USE MNEMONIC "HBLCS" TO GET HEIGHT OF CLOUD BASE IF
    151 C     MNEMONIC "HOCB" NOT AVAILABLE (AND IT WILL NOT BE FOR ALL CAT. 7
    152 C     AND SOME CAT. 51 REPORTS); MNEMONIC "TIWM" REPLACES "SUWS" IN
    153 C     HEADER FOR SURFACE DATA; MNEMONIC "BORG" REPLACES "ICLI" IN CAT.
    154 C     8 FOR AIRCRAFT DATA (WILL STILL WORK PROPERLY FOR INPUT ADPUPA,
    155 C     ADPSFC, AIRCFT AND AIRCAR DUMP FILES PRIOR TO 5/2002)
    156 C 2002-07-03  D. A. KEYSER -- ADDED ABILITY TO READ MESONET NCEP BUFR
    157 C     DUMP FILE (MSONET)
    158 C 2003-05-23  D. A. KEYSER -- GOES-9 (SAT. ID 253) WINDS WITH BUFR
    159 C     MESSAGE SUBTYPE 41-43 ALWAYS GET "P" IN 1ST CHAR. OF STN. ID AND
    160 C     "D" (PROCUCER = JMA) IN 2ND CHAR. OF STN. ID. (JMA BEGAN
    161 C     PRODUCING WINDS FROM GOES-9 IN PLACE OF FAILING GMS-5 ON 23 MAY
    162 C     2003), WHEN NESDIS PRODUCES WINDS FROM GOES-9 THE FIRST CHAR. IN
    163 C     THE STN. ID IS "C" (AS BEFORE)
    164 C 2003-07-10  D. A. KEYSER -- ADDED NEW ARRAY OBS2 WHICH RETURNS
    165 C     SINGLE-LEVEL REPORT DATA DIRECTLY FROM BUFR DUMP, INITALLY ONLY
    166 C     2-WORDS, FIRST WORD RETURNS BUFR FLAG TABLE FOR "RESTRICTIONS ON
    167 C     REDISTRIBUTION" (0-35-200) AND SECOND WORD RETURNS "EXPIRATION OF
    168 C     RESTRICTIONS ON REDISTRIBUTION" (HOURS)
    169 C 2004-01-09  D. A. KEYSER -- INPUT ARGUMENT SUBSKP SECOND DIMENSION
    170 C     CHANGED FROM 1:200 TO 0:200 TO ACCOUNT FOR REPORTS WITH BUFR
    171 C     SUBTYPE 000 (CURRENTLY ONLY WMO RES. 40 SYNOPS), DONE IN RESPONSE

Page 4           Source Listing                  IW3UNPBF
2017-04-18 11:09                                 iw3unpbf.f

    172 C     TO CHANGE IN CORRESPONDING CALLING PROGRAM(S)
    173 C 2004-02-02  D. A. KEYSER -- ADDED ABILITY TO PROCESS MOBILE SURFACE
    174 C     LAND SYNOPTIC REPORTS OUT OF ADPSFC DUMP FILE [INCL. STN. ELEV
    175 C     Q.M. WHICH IS STORED IN OUTPUT HEADER WORD 12 (PREV. MISSING AND
    176 C     IS STILL MISSING FOR ALL OTHER DATA TYPES)]; ADDED ABILITY TO
    177 C     PROCESS E-AMDAR AIRCRAFT REPORTS OUT OF THE AIRCFT DUMP FILE;
    178 C     ADDED INFO. NOT PREVIOUSLY DECODED FOR MESONET DATA FROM MSONET
    179 C     DUMP FILE {INCL. ID STRINGS FOR PROVIDER AND SUB-PROVIDER STORED
    180 C     IN RESERVE WORDS 1 AND 2, RESP. (CHARACTER)}; ACCOUNTS FOR
    181 C     TRANSITION OF MESONET REPORTS FROM LOW- TO HIGH-RESOLUTION LAT/
    182 C     LON IN EARLY 2004; ARRAY SUBSKP BUMPED UP FROM (0:12,0:200) TO
    183 C     (0:255,0:200); ACARS FLIGHT NUMBER NOW STORED IN RESERVE WORD 2
    184 C     (CHARACTER); LOGIC ADDED TO SELECT WHICH PRESSURE (HEIGHT
    185 C     ASSIGN.) AND WIND TO USE FOR GOES SATWND REPORTS (STILL HARDWIRED
    186 C     TO "FINAL" VALUE); ADDED LOGIC TO HANDLE FUTURE NASA/MODIS (AQUA/
    187 C     TERRA) POES WINDS
    188 C 2004-09-09  D. A. KEYSER -- CORRECTED THE DEFINITION OF "INSTRUMENT
    189 C     TYPE" (IT IS NOT BUFR CODE TBL 0-02-011 FOR NON-ADPUPA TYPE
    190 C     REPORTS) AND INITIALIZES IT AS MISSING INSTEAD OF "99"; SURFACE
    191 C     TYPES NOW ALWAYS STORE INSTRUMENT TYPE AS MISSING RATHER THAN
    192 C     PACKING IN SYNOPTIC FORMAT FLAG, AUTOMATED STATION TYPE, AND SHIP
    193 C     LOCATION FLAG; EXPANDED OBS2 FROM 2 TO 41-WORDS, ADDING RETURN OF
    194 C     ALTIMETER SETTING, SEA-SURFACE TEMPERATURE AND SINGLE-LEVEL
    195 C     SENSIBLE WEATHER ELEMENTS DIRECTLY FROM BUFR DUMP AND HARDWIRING
    196 C     OBS2(41) (SST Q.M.) TO 2 WHEN SST IS PRESENT (ELSE MISSING) (SEE
    197 C     REMARKS FOR CONTENT OF OBS2); ADDED NEW OUTPUT ARGUMENT OBS3
    198 C     {CURRENTLY 5,255,5)} WHICH RETURNS MULTIPLE-LEVEL SENSIBLE
    199 C     WEATHER ELEMENTS DIRECTLY FROM BUFR DUMP (SEE REMARKS FOR CONTENT
    200 C     OF OBS3); ADDED NEW OUTPUT ARGUMENT NOBS3 {CURRENTLY (5)} WHICH
    201 C     INDICATES THE NUMBER OF LEVELS OF DATA IN THE OBS3(X,Y,1),
    202 C     OBS3(X,Y,2), OBS3(X,Y,3), OBS3(X,Y,4) AND OBS3(X,Y,5) ARRAYS (SEE
    203 C     REMARKS); REMOVED ALL REFERENCES TO CAT. 7, 9 & 52 SINCE NO DATA
    204 C     IN THESE NOW (RETURNED IN OBS2 OR OBS3); REMOVED (SET TO MISSING)
    205 C     SOME INFO. THAT HAD BEEN RETURNED IN CAT. 51 & REDUCED NUMBER OF
    206 C     VALUES IN IT FROM 25 TO 13 (RETURNED IN OBS2 OR OBS3); REMOVED
    207 C     CAT. 8 CODE FIG. 001 (MAX. WIND SPD), 002 (MAX. WIND GUST DIR.),
    208 C     081 (CALENDAR DAY MAX. TEMP.), 082 (CALENDAR DAY MIN. TEMP.), 083
    209 C     (6-HR MAX. TEMP.), 084 (6-HR MIN. TEMP.), 085 (1-HR PRECIP.) AND
    210 C     098 (TOTAL SUNSHINE FOR CALENDAR DAY) (RETURNED IN OBS2 OR OBS3);
    211 C     CHANGED MEANING OF CAT. 8 CODE FIG. 005 FROM 1-HR PRECIP. (W/
    212 C     IND. 2 ITS Q.M.) TO Q.M. FOR 1-HR PRECIP. (IND. 2 NOW MISSING),
    213 C     006 FROM 24-HR PRECIP. (W/ IND. 2 ITS Q.M.) TO Q.M. FOR 24-HR
    214 C     PRECIP. (IND. 2 NOW MISSING) AND 020 FROM ALTIMETER SETTING (W/
    215 C     IND. 2 ITS Q.M.) TO Q.M. FOR ALTIMETER SETTING (IND. 2 NOW
    216 C     MISSING); TYPE OF HOURLY REPORT ("METAR", "SPECI" OR "LWIS"),
    217 C     DETERMINED FROM BUFR MNEMONIC THRPT, STORED IN BYTES 1-5 OF
    218 C     HEADER RESERVE CHARACTER WORD 2 (METAR REPORTS ONLY), CORRECTED
    219 C     REPORT INDICATOR ("CORN") STORED IN BYTE 8 OF HEADER RESERVE
    220 C     CHARACTER WORD 2 (METAR REPORTS ONLY); LOGIC MODIFIED TO
    221 C     TRANSITION FROM LOCAL TO WMO MNEMONICS FOR INPUT SSM/I DATA - NOW
    222 C     LOOKS FOR TOTAL PRECIP. WATER IN MNEMONIC "TPWT" FIRST, IF NOT
    223 C     FOUND LOOKS IN "PH2O", LOOKS FOR TOTAL SNOW DEPTH IN MNEMONIC
    224 C     "TOSD" FIRST, IF NOT FOUND LOOKS IN "SNDP", LOOKS FOR OCEAN
    225 C     SURFACE WIND SPEED IN MNEMONIC "WSPD" (WIND SPEED) FIRST, IF NOT
    226 C     FOUND LOOKS IN "WSOS" (THIS ALSO ALLOWS FOR HISTORICAL RERUNS);
    227 C     NON-MDCRS ACARS AIRFRAFT REPORTS NO LONGER GIVE ALL VARIABLES A
    228 C     KEEP OR PURGE FLAG IF EITHER TEMP OR WIND HAS KEEP OR PURGE FLAG

Page 5           Source Listing                  IW3UNPBF
2017-04-18 11:09                                 iw3unpbf.f

    229 C     - Q.M. REMAINS AS READ IN EXCEPT IF WIND Q.M. HAS PURGE FLAG,
    230 C     THEN TEMP Q.M. ALSO GETS PURGE FLAG
    231 C 2005-03-14  D. A. KEYSER (THIS FUNCTION IN PROGRAM BUFR_LISTDUMPS):
    232 C 2006-11-29  D. A. KEYSER (THIS FUNCTION IN PROGRAM PREPOBS_PREPDATA):
    233 C     MODIFIED TO HANDLE PREVIOUS CHANGE IN BUFR SUBSET STRUCTURE FOR
    234 C     MODIS WINDS IN NC005070-071 ("SWCM" INSTEAD OF "SWDL" USED TO
    235 C     DETERMINE CLOUD-TOP VS. DEEP-LAYER - BUG HAD LED TO ALL WV WINDS
    236 C     TAGGED AS CLOUD-TOP); MODIFIED TO HANDLE PREVIOUS CHANGE IN BUFR
    237 C     SUBSET STRUCTURE FOR EUMETSAT WINDS IN NC005064-066 (WILL STILL
    238 C     WORK WITH OLD BUFR SUBSET STRUCTURE); MODIFIED TO HANDLE FUTURE
    239 C     GTS GOES WINDS IN NC005015-018 AND FUTURE HI-DENSITY (FROM BUFR)
    240 C     JMA WINDS IN NC005044-046; STORES PERCENT CONFIDENCE BASED ON
    241 C     EUMETSAT QUALITY INDEX WITH FORECAST CONSISTENCY TEST (FOR
    242 C     SATELLITE WINDS) (BUFR CODE TABLE 0-33-197) IN CAT. 8 CODE FIGURE
    243 C     356; STORES PERCENT CONFIDENCE BASED ON EUMETSAT QUALITY INDEX
    244 C     WITHOUT FORECAST CONSISTENCY TEST (FOR SATELLITE WINDS) (BUFR
    245 C     CODE TABLE 0-33-198) IN CAT. 8 CODE FIGURE 357
    246 C 2005-03-14  D. A. KEYSER (THIS FUNCTION IN PROGRAM BUFR_LISTDUMPS):
    247 C 2007-09-14  D. A. KEYSER (THIS FUNCTION IN PROGRAM PREPOBS_PREPDATA):
    248 C     CHANGES IN SATWND PROCESSING IN RESPONSE TO NESDIS' CORRECTION OF
    249 C     AN ERROR (EFF. 3/10/2005) WHICH HAD STORED SIDP (SATELLITE
    250 C     INSTRUMENT USED IN DATA PROCESSING) AS A CODE TABLE VALUE RATHER
    251 C     THAN CORRECTLY AS A FLAG TABLE VALUE (THE CHANGE BY NESDIS
    252 C     RESULTED IN INSTRUMENT TYPE BEING STORED AS MISSING AND THE
    253 C     REPORT ID NOT BEING INDEXED) (WILL STILL WORK OK FOR HISTORICAL
    254 C     RUNS PRIOR TO NESDIS FIX) {NOTE: THE LOGIC CHANGED HERE IS
    255 C     ACTUALLY NEVER USED ANY MORE SINCE THE DUMP PROGRAM BUFR_DUPSAT
    256 C     NOW (SINCE 12/2000) CREATES THE STATION ID PRIOR TO THIS ROUTINE
    257 C     RUNNING AND THE INSTRUMENT TYPE IS NOW OBTAINED FROM THE STATION
    258 C     ID}
    259 C 2006-07-14  D. A. KEYSER -- BUMPED UP ARRAY SIZE FOR UNPACKED REPORT
    260 C     IN "OBS" FROM 2500 TO 3000; BUMPED UP MAXIMUM NUMBER OF LEVELS
    261 C     THAT CAN BE PROCESSED FOR A CATEGORY FROM 160 TO 200
    262 C 2006-07-14  D. A. KEYSER (THIS FUNCTION IN PROGRAM BUFR_LISTDUMPS):
    263 C 2007-09-14  D. A. KEYSER (THIS FUNCTION IN PROGRAM PREPOBS_PREPDATA):
    264 C     CHANGES TO HANDLE JMA'S SWITCH FROM GOES-9 (SAT. ID 253) TO NEW
    265 C     MTSAT-1R (SAT. ID 171, FIRST CHARACTER OF RPID IS "Q") FOR
    266 C     SATWINDS ON 7/15/2005; ADDED NEW CODE FIGURES 930 {TAMDAR
    267 C     TURBULENCE INDEX (BUFR CODE TABLE 0-11-235), INDICATOR 2 CONTAINS
    268 C     TURBULENCE INDEX QUALITY MARKER (0-15)}; AND 931 {TAMDAR ROLL
    269 C     ANGLE FLAG (BUFR CODE TABLE 0-02-199)}; FIXED BUG WHICH PREVENTED
    270 C     "PART" RECEIPT TIMES FROM BEING STORED PROPERLY FOR ADPUPA TYPES;
    271 C     MODIFIED TO PROCESS TAMDAR AND CANADIAN AMDAR AIRCRAFT DATA,
    272 C     LATTER PROCESSES MOISTURE; THE HIGHEST FSL QUALITY FLAGS FOR
    273 C     MESONET AND TAMDAR DATA NOW RESULT IN A PREPBUFR Q.M. OF 2
    274 C     (NEUTRAL) RATHER THAN 1 (GOOD); CHANGES TO HANDLE INDIAN SATWINDS
    275 C     FROM INSAT-3A (SAT. ID 470, FIRST CHARACTER OF RPID IS "V") AND
    276 C     KALPANA-1 (SAT. ID 440, FIRST CHARACTER OF RPID IS "K")
    277 C 2006-11-29  D. A. KEYSER (THIS FUNCTION IN PROGRAM PREPOBS_PREPDATA):
    278 C 2007-09-14  D. A. KEYSER (THIS FUNCTION IN PROGRAM BUFR_LISTDUMPS):
    279 C     FUNCTION R06UBF ACCOUNTS FOR EUMETSAT CLOUD WINDS NOW SENDING A
    280 C     THIRD REPLICATION OF QUALITY INFORMATION (NESDIS RFF, IN
    281 C     METEOSAT-MSG ONLY, BUT TESTED FOR ALL EUMETSAT SATELLITES)
    282 C 2007-09-14  D. A. KEYSER -- BUMPED UP ARRAY SIZE FOR UNPACKED REPORT
    283 C     IN "OBS" FROM 3000 TO 3500; BUMPED UP MAXIMUM NUMBER OF LEVELS
    284 C     THAT CAN BE PROCESSED FOR A CATEGORY FROM 200 TO 300; STORES
    285 C     PERCENT CONFIDENCE BASED ON NESDIS EXPECTED ERROR (FOR SATELLITE

Page 6           Source Listing                  IW3UNPBF
2017-04-18 11:09                                 iw3unpbf.f

    286 C     WINDS) (BUFR CODE TABLE 0-33-203) IN CAT. 8 CODE FIGURE 358;
    287 C     EXPANDED ARRAYS OBS3 FROM (5,255,5) TO (5,255,7) AND NOBS3 FROM
    288 C     (5) TO (7) TO ACCOUNT FOR PROCESSING OF ADDITIONAL MULTIPLE-LEVEL
    289 C     SENSIBLE WEATHER ELEMENTS CONTAINING AIRFRAME ICING (RECCOS,
    290 C     PIREPS, E-AMDAR, CANADIAN AMDAR, TAMDAR) AND DEGREE OF TURBULENCE
    291 C     (RECCOS AND ALL AIRCRAFT) INFORMATION (SEE REMARKS), THE LATTER
    292 C     REPLACES STORAGE OF SINGLE DEGREE OF TURBULENCE VALUE WHICH HAD
    293 C     BEEN IN CAT. 8, CODE FIGURE 916; ALL CALLS TO UFBINT TO RETURN
    294 C     OBS3 DATA NOW CHECK FOR ALL MISSING VALUES WHEN NUMBER OF
    295 C     "LEVELS" RETURNED IS 1 - IN SUCH CASES, THE NUMBER OF "LEVELS"
    296 C     RETURNED IS CHANGED TO 0 (UFBINT CAN RETURN 1 LEVEL EVEN IF ALL
    297 C     DATA ARE MISSING); ACCOUNTS FOR ARINC SCALING MIXR INCORRECTLY IN
    298 C     MDCRS ACARS REPORTS (10 TIMES TOO LARGE) BETWEEN 11/1/2006 AND
    299 C     10/1/2007 (COMPENSATES BY DIVIDING MIXR BY 10) - ON 10/2/2007
    300 C     ARINC MADE FIX, MIXR SET TO MISSING SINCE UNCERTAIN OF EXACT TIME
    301 C     OF FIX - FROM 10/1/2006 THROUGH 10/31/2006 MIXR ALSO SET TO
    302 C     MISSING SINCE THERE IS UNCERTAINTY AS TO WHEN SCALING ERROR WAS
    303 C     INTRODUCED DURING 10/2006 (NOTE: THIS CHANGE BENEFITS ONLY
    304 C     HISTORICAL RERUNS AND REANALYSIS RUNS SINCE CHANGE WILL NOT BE
    305 C     IMPLEMENTED UNTIL WELL AFTER 10/2/2007)
    306 C 2008-04-10  D. A. KEYSER -- CAN HANDLE RADIOSONDE TYPES > 99 WHICH
    307 C     WILL SOON BE INTRODUCED INTO THE BUFR DATABASE (BASED ON NOVEMBER
    308 C     2007 WMO BUFR UPDATE)
    309 C 2008-09-12  D. A. KEYSER -- MODIFIED TO RECOGNIZE THAT TAMDAR REPORTS
    310 C     CAN NOW APPEAR IN "aircft" DUMP MESSAGE TYPES NC004012 (PENAIR)
    311 C     AND NC004013 (CHAUTAUQUA) IN ADDITION TO MESSAGE TYPE NC004008
    312 C     (MESABA)
    313 C 2008-09-25  D. A. KEYSER -- ADDED FUNCTION TO CORRECTLY CALC.
    314 C     PRESSURE ALTITUDE FROM PRESSURE (VIA U.S. STD. ATMOS) FOR
    315 C     AIRCRAFT ABOVE 226 MB (BEFORE USED FUNCTION TO CALC. PRESSURE
    316 C     ALTITUDE FROM PRSSSURE BELOW 226 MB AT ALL LEVELS), THIS APPLIES
    317 C     ONLY TO MDCRS ACARS AND TAMDAR AIRCRAFT; THE Q.M. FOR MDCRS ACARS
    318 C     WIND IS NO LONGER SET TO 1 (GOOD) IF NOT PREVIOUSLY SET, INSTEAD
    319 C     IT IS SET TO 2 (NEUTRAL) (NEW NRL QC MODULE WILL DECIDE ON FINAL
    320 C     Q.M.); OUTPUT ARRAY OBS2 INCR. FROM 41 TO 42 WORDS, WORD 42
    321 C     CONTAINS MOISTURE QUALITY (CODE TABLE, ACARS REPORTS); EUMETSAT
    322 C     WIND REPORTS ARE NO LONGER FLAGGED WITH QM=13 BASED ON LOW "QI
    323 C     WITH FORECAST" VALUE OR HIGH MANUAL/AUTOMATIC Q.C. INDICATOR
    324 C 2010-06-07 D. A. KEYSER  -- NOW STORES Q.M. FOR ALTIMETER SETTING FOR
    325 C     METARS (JUST AS ALWAYS FOR MESONETS) IN CODE FIG. 20 OF CAT. 8,
    326 C     BUT ONLY IF METAR PRESSURE Q.M. WAS GIVEN A PURGE OR REJECT FLAG
    327 C     IN THE SDMEDIT FILE - IN THIS CASE ALTIMETER Q.M. IS SET TO SAME
    328 C     VALUE AS PRESSURE Q.M. (EITHER 12 OR 14) (THIS WILL ALLOW
    329 C     REJECTED OR PURGED PRESSURE Q.M. TO BE HONORED WHEN PSTN IS
    330 C     CALCULATED FROM ALTIMETER SETTING DOWNSTREAM in PREPDATA); IF
    331 C     PSTN OR PMSL ARE MISSING, WILL STILL STORE Q.M. READ IN FROM
    332 C     SDMEDIT FOR THEM; RECOGNIZES NEW OR SOON-TO-BE NEW UNRESTRICTED
    333 C     SHIP TANK NC001013; RECOGNIZES NEW AVHRR WIND TANK NC005080;
    334 C     CHANGES 1ST CHARACTER OF REPORT ID FROM "?" (IF FOUND) TO "R" FOR
    335 C     MTSAT-2 (SATELLITE ID 172) SAT-WIND REPORTS SO THAT THEY WILL BE
    336 C     PROPERLY RECOGNIZED FOR HISTORICAL RERUNS, ETC. (FROM ~ 11 AUG TO
    337 C     30 SEP 2010, BUFR_DUPSAT INCORRECTLY PLACED "?" IN 1ST CHARACTER
    338 C     OF THESE IDS)
    339 C 2012-11-27 D. A. KEYSER  -- ALLOW REPORT SEQUENCE NUMBER (CAT. 8,
    340 C     CODE FIG. 21) TO NOW BE AS LARGE AS 999990 (ALL OTHER CODE FIGS.
    341 C     UPPER LIMIT REMAINS 99999) (NEEDED BECAUSE THERE CAN NOW BE >
    342 C     99999 MDCRS REPORTS IN A MONOLITHIC "AIRCAR" DUMP FILE)

Page 7           Source Listing                  IW3UNPBF
2017-04-18 11:09                                 iw3unpbf.f

    343 C 2012-11-30  J. WOOLLEN   -- INITIAL PORT TO WCOSS; RESET BMISS TO
    344 C     A VALUE (10E08) WHICH WILL NOT CAUSE INTEGER OVERFLOW WHICH CAN
    345 C     BE UNPREDICTABLE (PRIOR BMISS VALUE WAS 10E10)
    346 C 2013-02-14  D. A. KEYSER -- FINAL CHANGES TO RUN ON WCOSS; OBTAIN
    347 C     VALUE OF BMISS SET IN CALLING PROGRAM VIA CALL TO BUFRLIB ROUTINE
    348 C     GETBMISS RATHER THAN HARDWIRING IT TO 10E08 (OR 10E10); USE
    349 C     BUFRLIB FUNCTION IBFMS TO DETERMINE IF A VARIABLE READ FROM BUFR
    350 C     FILE IS MISSING (I.E. RETURNED AS BMISS);  USE FORMATTED PRINT
    351 C     STATEMENTS WHERE PREVIOUSLY UNFORMATTED PRINT WAS USED (WCOSS
    352 C     SPLITS UNFORMATTED PRINT AT 80 CHARACTERS)
    353 C 2013-06-30  D. A. KEYSER -- ADDED ABILITY TO READ IN AND PROCESS
    354 C     PERCENT CONFIDENCE BASED ON EUMETSAT QUALITY INDICATOR WITH AND
    355 C     WITHOUT FORECAST FOR NESDIS GOES WINDS PULLED FROM NESDIS SERVER
    356 C     (WHICH ORIGINALLY STORED THEM IN DUMP FILE EXPLICITLY AS "QIFY"
    357 C     AND "QIFN" BUT LATER STORED THEM BOTH AS BEFORE AND AS REPLICATED
    358 C     "PCCF" VALUES AS WITH V10 BUFR, AND EVEN LATER STORED THEM ONLY
    359 C     AS REPLICATED "PCCF" VALUES AS WITH V10 BUFR) IF THEY ARE PRESENT
    360 C     (NOTE: AS NOTED, WILL ALSO WORK IF THESE ARE STORED IN REPLICATED
    361 C     "PCCF" VALUES AS WITH V10 BUFR, E.G., MODIS WINDS, AVHRR WINDS,
    362 C     JMA WINDS, EUMETSAT WINDS); ADDED ABILITY TO READ IN AND PROCESS
    363 C     PERCENT CONFIDENCE BASED ON NESDIS RECURSVE FILTER FUNCTION FOR
    364 C     TYPES WHICH MIGHT STORE IT IN DUMP FILE IN REPLICATED "PCCF"
    365 C     VALUES AS WITH V10 BUFR (IN THIS CASE NESDIS GOES WINDS, MODIS
    366 C     WINDS, AVHRR WINDS, JMA WINDS - ALREADY IN PLACE FOR EUMETSAT
    367 C     WINDS) IF IT IS PRESENT (NOTE: WILL STILL WORK IF THIS IS STORED
    368 C     EXPLICITLY AS "RFFL" AS ORIGINALLY WITH GOES WINDS PULLED FROM
    369 C     NESDIS SERVER); ADDED ABILITY TO READ IN AND PROCESS PERCENT
    370 C     CONFIDENCE BASED ON NESDIS EXPECTED ERROR FOR TYPES WHICH MIGHT
    371 C     STORE IT IN DUMP FILE IN REPLICATED "PCCF" VALUES AS WITH
    372 C     V10 BUFR (IN THIS CASE MODIS OR AVHRR WINDS) IF IT IS PRESENT
    373 C     (NOTE: WILL STILL WORK IF THIS IS STORED EXPLICITLY AS "EEQF" AS
    374 C     ORIGINALLY WITH GOES WINDS PULLED FROM NESDIS SERVER); NOW STORES
    375 C     CLOUD-TOP/DEEP-LAYER INDICATOR IN BYTE 3 OF HEADER RESERVE
    376 C     CHARACTER WORD 1 FOR FOREIGN-PRODUCED SATELLITE WINDS (AS ALREADY
    377 C     DONE FOR NESDIS-PRODUCED SATELLITE WINDS) - JMA AND EUMETSAT
    378 C     IMAGER WATER VAPOR WINDS CAN NOW BE OF BOTH TYPES, BEFORE THEY
    379 C     WERE ONLY CLOUD-TOP; OUTPUT ARRAY OBS2 INCR. FROM 42 TO 43 WORDS,
    380 C     WORD 43 CONTAINS SATELLITE ZENITH ANGLE (DEGREES, SATWND TYPES
    381 C     ONLY)
    382 C 2014-02-01  S. MELCHIOR  -- ADDED NEW REPORT TYPE (RTP) OF 534 FOR
    383 C     SURFACE MARINE COAST GUARD TIDE GAUGE REPORTS
    384 C 2015-01-30  D. A. KEYSER --  Added logic to handle new NASA/VIIRS
    385 C     (NPP) POES winds in tank NC005090 (e.g., recognizes that they now
    386 C     exist, counts of reports with flagged QI values, counts of
    387 C     reports by satellite number).  Added logic to properly handle
    388 C     GOES IR short-wave winds in tank NC005019 (e.g., new instrument
    389 C     type 19, process the quality information correctly). Added some
    390 C     missing logic which summarizes processing of NESDIS/AVHRR POES
    391 C     winds in tank NC005080 (e.g., counts of reports by satellite
    392 C     number).
    393 C 2015-03-09  D. A. KEYSER --  Now stores WMO bulletin header and
    394 C     originator in new output character*11 argument CBULL for aircraft
    395 C     data (only) (all blanks for all other data types for now). (Note:
    396 C     Previously, WMO bulletin originator had been stored in characters
    397 C     1-4 of header reserve character word 1 and bulletin header was
    398 C     not stored.)
    399 C 2016-02-09  S. MELCHIOR -- Adjusted code to accommodate the

Page 8           Source Listing                  IW3UNPBF
2017-04-18 11:09                                 iw3unpbf.f

    400 C     processing of two new aircraft data types: Korean AMDAR (BUFR)
    401 C     and Catch-All AMDAR (BUFR).  Either pre-version 7 BUFR or new
    402 C     version 7 BUFR for Catch-All AMDAR, MDCRS and E-AMDAR can be
    403 C     handled.  Adjustments are primarily in function R05UBF. Added two
    404 C     functions to estimate pressure using indicated altitude and U.S.
    405 C     Standard Atmosphere.  The pressure is used to estimate dew point
    406 C     temperature to perform a gross check on moisture data.  The
    407 C     estimated pressures are not considered reported pressure and
    408 C     remain missing in the encoded report. Details and clarification
    409 C     were added explaining how height information is obtained for
    410 C     different aircraft data types. Adjusted setting of report subtype
    411 C     (ISTP) to read the last three integers of the subset rather than
    412 C     the last two integers.  This preserves the difference between
    413 C     legacy TAC format AMDAR tank and new BUFR format "Catch-All" tank
    414 C     (e.g. 004003 and 004103). Phase of flight information for version
    415 C     7 BUFR data is stored in a different mnemonic (DPOF) than
    416 C     pre-version 7 BUFR version (POAF).  The values do not exactly
    417 C     correlate.  Logic was added to translate DPOF values into POAF
    418 C     values since downstream codes still expect POAF.  All references
    419 C     to E-ADAS have been changed to E-AMDAR.
    420 C     {Note: Some modifications made to handle new Panasonic (AirDAT)
    421 C            TAMDAR.  This needs further testing.}
    422 C 2016-07-28  C. Hill --
    423 C     Added capability to process BUFR(v4) TAMDAR data, as provided by
    424 C     Panasonic/AirDat since November 2015. HMSL (pressure altitude) is
    425 C     given precedence over FLVLST (GPS altitude) in defining flight
    426 C     level height (ELEV) and in calcuating pressure values, consistent
    427 C     with other aircraft data types and performed without adversely
    428 C     affecting ELEV assignment of the other aircraft data types.
    429 C     Quality marks for temperature and wind are derived from quality
    430 C     information provided by QMRKH fields in the reports. The quality
    431 C     mark for moisture is derived from the "percent confidence" (PCCF)
    432 C     field provided in the reports. {Additional fields of FLVLST and
    433 C     IALR (instantaneous altitude rate) are available and may be
    434 C     considered for future inclusion in PREPBUFR files.}
    435 C 2016-11-25  D. A. KEYSER --
    436 C     Changes in processing of TAMDAR data provided by Panasonic/AirDat
    437 C     (TAMDARB):
    438 C       - Stores instantaneous altitude rate (read from IALR) in cat.8
    439 C         c.f. 932 (.001 x m/sec).
    440 C       - Stores type of commercial aircraft (read from ACTP) in header
    441 C         reserve character (*8) word 2.
    442 C       - Stores observer identification (read from OBSVR) in bytes 1-4
    443 C         of header reserve character (*8) word 1.
    444 C       - Cleaned up logic which reads in BORG and BUHD (sets to all
    445 C         blanks since these are missing for TAMDARB data). Also store
    446 C         all blanks in output character (*11) CBULLX in this case.
    447 C       - Bug fixes, mostly minor.  Most serious one was logic not
    448 C         honoring incoming TQM/WQM/QQM other than 2 in transformation
    449 C         of TAMDAR QMRKH/PCCF into updated TQM/WQM/QQM (from 2016-07-28
    450 C         update).
    451 C       - Treat these like MDCRS in that an SDM purge on wind QM does
    452 C         NOT force a purge also on temperature QM (this is still done
    453 C         for all other aircraft types).
    454 C     Changes in processing of Catch-All AMDAR (BUFR) data:
    455 C       - Stores flight number (read from ACID) in header reserve
    456 C         character (*8) word 2 (if ACID is missing, stores all blanks

Page 9           Source Listing                  IW3UNPBF
2017-04-18 11:09                                 iw3unpbf.f

    457 C         here).
    458 C 2016-11-30  D. A. KEYSER --
    459 C     Added new output real, double-precision argument array OBS8_8 of
    460 C     length 2 to return full-precision latitude and longitude for a
    461 C     report.
    462 C     BENEFIT: Although lat and lon are returned in OBS(1:2) these are
    463 C              at machine precison, which is normally R*4.  Now that
    464 C              many reports in the dumps store lat/lon at 0.001 or even
    465 C              0.00001 degree precision, and now that PREPBUFR encodes
    466 C              YOB (lat) and XOB (lon) at 0.00001 degree precision, this
    467 C              change will ensure that lat/lon is always accurate to
    468 C              0.00001 degrees in all downstream processing.
    469 C 2017-01-11  C. Hill --
    470 C     For TAMDARB reports, always set moisture quality mark (QQM) to 13
    471 C     if temperature quality mark (TQM) was set to 13 earlier in subr.
    472 C     R05UBF .
    473 C              
    474 C
    475 C
    476 C USAGE:    II = IW3UNPBF(NUNIT, OBS, STNID, CRES1, CRES2, CBULL, OBS2,
    477 C                         OBS3, NOBS3, OBS8_8, DSNAME, IDSDAT, IDSDMP_8,
    478 C                         SUBSET_r, SUBSKP, IER)
    479 C   INPUT ARGUMENT LIST:
    480 C     NUNIT    - FORTRAN UNIT NUMBER FOR SEQUENTIAL DATA SET CONTAINING
    481 C                PACKED NCEP BUFR REPORTS (DUMP FILE)
    482 C     DSNAME   - CHARACTER*8 DATA SET NAME (ONLY READ WHEN INPUT ARG.
    483 C                IER = -1, SEE BELOW)
    484 C     IDSDAT   - INTEGER DATA SET CENTER DATE IN FORM YYYYMMDDHH (ONLY
    485 C                READ WHEN INPUT ARG. IER = -1, SEE BELOW)
    486 C     IDSDMP_8 - INTEGER DATA SET DUMP TIME IN FORM YYYYMMDDHHMM (ONLY
    487 C                READ WHEN INPUT ARG. IER = -1, SEE BELOW)
    488 C     SUBSKP   - TWO-DIMENSIONAL LOGICAL ARRAY WHERE ELEMENT 1 REFERS
    489 C                TO A PARTICULAR BUFR TYPE (RANGE 0-255) AND ELEMENT 2
    490 C                REFERS TO A PARTICULAR BUFR SUBTYPE (RANGE 0-200). IF
    491 C                SUBSKP IS SET TO TRUE FOR A PARTICULAR BUFR TYPE AND
    492 C                SUBTYPE, THEN ANY BUFR MESSAGE OF THIS TYPE READ IN
    493 C                WILL BE SKIPPED OVER {NO SUBSETS (REPORTS) WILL BE
    494 C                DECODED OUT OF IT AND RETURNED TO THE CALLING PROGRAM,
    495 C                INSTEAD THIS FUNCTION WILL MOVE ON TO READ THE NEXT
    496 C                BUFR MESSAGE IN THE FILE AND AGAIN USE SUBSKP TO SEE
    497 C                IF ANY SUBSETS SHOULD BE DECODED OUT OF IT}. THIS
    498 C                ALLOWS THIS FUNCTION TO QUICKLY PASS BY ANY BUFR
    499 C                MESSAGES WITH A TYPE/SUBTYPE THAT THE CALLING PROGRAM
    500 C                DOES NOT WANT DECODED.  THE LENGTH OF THIS ARRAY
    501 C                SHOULD ALWAYS BE HARDWIRED TO (0:255,0:200).
    502 C     SUBSET_r - CHARACTER*8 BUFR MESSAGE TYPE (ONLY READ WHEN INPUT
    503 C                ARG. IER = -1, SEE BELOW)
    504 C     IER      - PRIOR TO INITIAL CALL TO THIS SUBROUTINE WITH A NEW
    505 C                "NUNIT": IF =-1, INDICATES THAT THE FILE ASSOCIATED
    506 C                WITH "NUNIT" HAS ALREADY BEEN OPENED BY THE
    507 C                CORRESPONDING INTERFACE SUBROUTINE W3UNPKB7 AND
    508 C                REPORTS HAVE BEEN PROCESSED, THIS ROUTINE WILL
    509 C                CONTINUE READING AND PROCESSING REPORTS FROM "NUNIT";
    510 C                OTHERWISE IER SHOULD BE INPUT AS ZERO
    511 C
    512 C   OUTPUT ARGUMENT LIST:
    513 C     OBS      - ARRAY CONTAINING ONE REPORT IN SPECIFIED UNPACKED

Page 10          Source Listing                  IW3UNPBF
2017-04-18 11:09                                 iw3unpbf.f

    514 C                FORMAT.  FORMAT IS MIXED, USER MUST EQUIVALENCE
    515 C                INTEGER ARRAY TO THIS ARRAY (SEE REMARKS FOR UNPACKED
    516 C                FORMAT) THE LENGTH OF THE ARRAY SHOULD BE AT LEAST
    517 C                3500 (NOTE: DOES NOT INCLUDE STATION ID, CHARACTER
    518 C                RESERVE WORD 1, CHARACTER RESERVE WORD 2 AND CBULL)
    519 C     STNID    - CHARACTER*8 SINGLE REPORT STATION IDENTIFICATION (UP
    520 C                TO 8 CHARACTERS, LEFT-JUSTIFIED)
    521 C     CRES1    - CHARACTER*8 SINGLE REPORT CHARACTER RESERVE WORD 1
    522 C                (SEE DOCUMENTATION/COMMENTS IN THIS PROGRAM (VARIES BY
    523 C                TYPE OF DATA)
    524 C     CRES2    - CHARACTER*8 SINGLE REPORT CHARACTER RESERVE WORD 2
    525 C                (SEE DOCUMENTATION/COMMENTS IN THIS PROGRAM (VARIES BY
    526 C                TYPE OF DATA)
    527 C     CBULL    - CHARACTER*11 STRING HOLDING WMO BULLETIN HEADER (CHAR.
    528 C                1-6) AND ORIGINATOR (CHAR. 8-11) (CHAR. 7 IS BLANK)
    529 C                (Note: Currently only applies to aircraft reports,
    530 C                       this string is all blanks for all other types.)
    531 C     OBS2     - 43-WORD ARRAY CONTAINING ADDITIONAL REPORT DATA NOT
    532 C                PRESENT IN OBS ARRAY (DATA RESTRICTION INFO,
    533 C                ALTIMETER SETTING, SST, SINGLE-LEVEL SENSIBLE WEATHER
    534 C                ELEMENTS - STORED DIRECTLY FROM BUFR) (SEE REMARKS FOR
    535 C                CONTENT)
    536 C     OBS3     - (5,255,7)-WORD ARRAY CONTAINING ADDITIONAL REPORT DATA
    537 C                NOT PRESENT IN OBS ARRAY (MULTIPLE-LEVEL SENSIBLE
    538 C                WEATHER ELEMENTS STORED DIRECTLY FROM BUFR) (SEE
    539 C                REMARKS FOR CONTENT)
    540 C     NOBS3    - 7-WORD ARRAY CONTAINING NUMBER OF LEVELS OF DATA
    541 C                IN THE OBS3(X,Y,1), OBS3(X,Y,2), OBS3(X,Y,3),
    542 C                OBS3(X,Y,4), OBS3(X,Y,5), OBS3(X,Y,6) AND OBS3(X,Y,7)
    543 C                ARRAYS (SEE REMARKS)
    544 C     OBS8_8   - 2-WORD REAL*8 ARRAY CONTAINING ADDITIONAL REPORT DATA
    545 C                (LATITUDE AND LONGITUDE) (SEE REMARKS FOR CONTENT)
    546 C     DSNAME   - CHARACTER*8 DATA SET NAME (SAME FOR ALL REPORTS IN
    547 C                A COMMON INPUT DATA SET - SEE REMARKS FOR IER=1)
    548 C     IDSDAT   - INTEGER DATA SET CENTER DATE IN FORM YYYYMMDDHH (SAME
    549 C                FOR ALL REPORTS IN A COMMON INPUT DATA SET - SEE
    550 C                REMARKS FOR IER=1)
    551 C     IDSDMP_8 - INTEGER DATA SET DUMP TIME IN FORM YYYYMMDDHHMM (SAME
    552 C                FOR ALL REPORTS IN A COMMON INPUT DATA SET - SEE
    553 C                REMARKS FOR IER=1)
    554 C     SUBSET_r - CHARACTER*8 BUFR MESSAGE TYPE (SAME FOR ALL REPORTS
    555 C                IN A COMMON BUFR MESSAGE)
    556 C     IER      - RETURN FLAG (EQUAL TO FUNCTION VALUE) - SEE REMARKS
    557 C
    558 C   INPUT FILES:
    559 C     UNIT AA  - SEQUENTIAL NCEP BUFR DUMP FILE ("AA" IS UNIT NUMBER
    560 C                SPECIFIED BY INPUT ARGUMENT "NUNIT")
    561 C
    562 C   OUTPUT FILES:
    563 C     UNIT 06  - PRINTOUT
    564 C
    565 C   SUBPROGRAMS CALLED:
    566 C     UNIQUE:    - R01UBF   R02UBF   R03UBF   R04UBF   R05UBF
    567 C                  R06UBF   R07UBF   I02UBF   I04UBF   I05UBF
    568 C                  L01UBF   L02UBF   L03UBF   S01UBF   S02UBF
    569 C                  S03UBF   S04UBF   S05UBF   SE01UBF  MQMUBF
    570 C                  EQSUBF   EQMUBF   ERTUBF   C01UBF   WORDLENGTH

Page 11          Source Listing                  IW3UNPBF
2017-04-18 11:09                                 iw3unpbf.f

    571 C     LIBRARY:
    572 C       W3EMC    - ORDERS
    573 C       BUFRLIB  - OPENBF   CLOSBF   DATELEN  STATUS   DUMPBF
    574 C                  READMG   READSB   UFBINT   UFBREP   NMSUB
    575 C                  UFBSEQ   GETBMISS IBFMS    CBFMS    READLC
    576 C
    577 C REMARKS:
    578 C     THE RETURN FLAGS IN IER (AND FUNCTION IW3UNPBF ITSELF) ARE:
    579 C          =   0  OBSERVATION READ AND UNPACKED INTO LOCATIONS 'OBS',
    580 C                   'STNID', 'CRES1', 'CRES2', 'CBULL', 'OBS2', 'OBS3',
    581 C                   'OBS8_8', 'DSNAME', 'IDSDAT', AND 'IDSDMP_8'.  SEE
    582 C                   REMARKS BELOW FOR CONTENTS. NEXT CALL TO IW3UNPBF
    583 C                   WILL RETURN NEXT OBSERVATION IN DATA SET.
    584 C          =   1  INFORMATION ABOUT THE BUFR DATASET IS RETURNED IN
    585 C                   THE OUTPUT ARGUMENTS DSNAME, IDSDAT, IDSDMP_8 (SEE
    586 C                   OUTPUT ARGUMENT LIST ABOVE)
    587 C
    588 C                   THIS SHOULD ALWAYS OCCUR AFTER THE FIRST CALL TO
    589 C                   THIS SUBROUTINE.  NO REPORT IS UNPACKED AT THIS
    590 C                   POINT, AND ONLY DSNAME, IDSDAT, AND IDSDMP_8
    591 C                   CONTAIN INFORMATION.  ALL SUBSEQUENT CALLS TO
    592 C                   IW3UNPBF SHOULD RETURN THE OBSERVATIONS IN THIS
    593 C                   DATA SET, SEQUENTIALLY, (IER=0) UNTIL THE END OF
    594 C                   FILE IS ENCOUNTERED (IER=2 OR 3).  THE VALUES
    595 C                   STORED IN DSNAME, IDSDAT, AND IDSDMP_8 WILL
    596 C                   CONTINUE TO BE RETURNED ALONG WITH EACH REPORT
    597 C                   WHEN IER = 0.
    598 C          =   2  THE PHYSICAL END OF FILE IS ENCOUNTERED (THIS IS
    599 C                   FOR A VALID NCEP BUFR DUMP FILE CONTAINING
    600 C                   REPORTS).  ALL DONE.
    601 C          =   3  THIS IS AN EMPTY (NULL) FILE.  ALL DONE.
    602 C          = 999  ERROR: EITHER FILE IS NOT NCEP BUFR, ERROR READING
    603 C                        FILE, CENTER DATE DUMMY MESSAGE NOT FOUND AT
    604 C                        TOP OF NCEP BUFR DUMP FILE, OR SOME OTHER
    605 C                        PROBLEM IN DECODING ONE OR MORE REPORTS IN AN
    606 C                        NCEP BUFR DUMP FILE.
    607 C                  NO USEFUL INFORMATION IN 'OBS', 'STNID', 'CRES1',
    608 C                  'CRES2', 'CBULL', 'OBS2', 'OBS3', 'OBS8_8', 'DSNAME',
    609 C                  'IDSDAT', AND 'IDSDMP_8' ARRAYS.  CALLING PROGRAM
    610 C                  CAN CHOOSE TO STOP WITH NON-ZERO CONDITION CODE OR
    611 C                  RESET 'NUNIT' TO POINT TO A NEW DATA SET (IN WHICH
    612 C                  CASE NEXT CALL TO IW3UNPBF SHOULD RETURN WITH
    613 C                  IER=1).
    614 C
    615 CCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCC
    616 C
    617 C           CONTENTS OF AN UNPACKED REPORT IN THE "OBS" ARRAY
    618 C               {MISSING INTEGER DATA ARE SET TO IMISS (99999);
    619 C                MISSING REAL DATA ARE SET TO XMISS (99999.)}
    620 C
    621 C     (NOTE: DOES NOT INCLUDE STATION IDENTIFICATION, CHARACTER RESERVE
    622 C            WORD 1, CHARACTER RESERVE WORD 2, "CBULL", "OBS2" AND
    623 C            "OBS3" ARRAY OUTPUT; LATITUDE AND LONGITUDE IN OBS(1:2) ARE
    624 C            ALSO OUTPUT IN REAL*8 IN "OBS8_8"  - SEE OUTPUT ARGUMENTS
    625 C            "STNID", "CRES1", "CRES2" AND "CBULL" ABOVE AND "OBS2",
    626 C            "OBS3" AND "OBS8_8" CONTENTS BELOW)
    627 C

Page 12          Source Listing                  IW3UNPBF
2017-04-18 11:09                                 iw3unpbf.f

    628 C   ***************************************************************
    629 C   WORD   CONTENT                   UNIT                 FORMAT
    630 C   ----   ----------------------    -------------------  ---------
    631 C     1    LATITUDE                  DEGREES (N+,S-)      REAL
    632 C     2    LONGITUDE                 DEGREES EAST         REAL
    633 C     3    NOT USED                  MISSING              REAL
    634 C     4    OBSERVATION TIME          HOURS (UTC)          REAL
    635 C     5    NOT USED                  MISSING              REAL
    636 C     6    SATELLITE ID      (BUFR CODE TABLE 0-01-007)   INTEGER
    637 C                                    (SEE @)
    638 C     7    STATION ELEVATION         METERS               REAL
    639 C     8    INSTRUMENT TYPE           (SEE $)              INTEGER
    640 C     9    DUMP REPORT TYPE          (SEE &)              INTEGER
    641 C    10    DUMP REPORT SUBTYPE       (SEE %)              INTEGER
    642 C    11    RECEIPT TIME              HOURS (UTC)          REAL
    643 C    12    STATION ELEVATION (BUFR CODE TABLE 0-33-024)   REAL
    644 C          QUALITY MARK              (SEE #)             
    645 C
    646 C    13    CATEGORY  1, NO. LEVELS   COUNT                INTEGER
    647 C    14    CATEGORY  1, DATA INDEX   COUNT                INTEGER
    648 C    15    CATEGORY  2, NO. LEVELS   COUNT                INTEGER
    649 C    16    CATEGORY  2, DATA INDEX   COUNT                INTEGER
    650 C    17    CATEGORY  3, NO. LEVELS   COUNT                INTEGER
    651 C    18    CATEGORY  3, DATA INDEX   COUNT                INTEGER
    652 C    19    CATEGORY  4, NO. LEVELS   COUNT                INTEGER
    653 C    20    CATEGORY  4, DATA INDEX   COUNT                INTEGER
    654 C    21    CATEGORY  5, NO. LEVELS   COUNT                INTEGER
    655 C    22    CATEGORY  5, DATA INDEX   COUNT                INTEGER
    656 C    23    CATEGORY  6, NO. LEVELS   COUNT                INTEGER
    657 C    24    CATEGORY  6, DATA INDEX   COUNT                INTEGER
    658 C    25    reserved                      0                INTEGER
    659 C    26    reserved                      0                INTEGER
    660 C    27    CATEGORY  8, NO. LEVELS   COUNT                INTEGER
    661 C    28    CATEGORY  8, DATA INDEX   COUNT                INTEGER
    662 C    29    CATEGORY 51, NO. LEVELS   COUNT                INTEGER
    663 C    30    CATEGORY 51, DATA INDEX   COUNT                INTEGER
    664 C 31-52    ZEROED OUT - NOT USED                          INTEGER
    665 C
    666 C 53-END   UNPACKED DATA GROUPS      (SEE BELOW)          MIXED
    667 C
    668 C    @ - WORD  6, SATELLITE ID, IS CURRENTLY SET TO MISSING FOR
    669 C         ALL TYPES EXCEPT:
    670 C             SATELLITE WIND (DUMP REPORT TYPE 63)
    671 C             SSM/I (NON-SUPEROBED ONLY: ALL TYPES, DUMP REPORT
    672 C                     TYPES 65,66,68,69,571,573-577)
    673 C    $ - WORD  8, INSTRUMENT TYPE, IS CURRENTLY SET TO MISSING FOR
    674 C         ALL TYPES EXCEPT:
    675 C             UPPER-AIR (ADPUPA) (DUMP REPORT TYPES 11-13, 22, 23,
    676 C               31):
    677 C               Radiosonde type - see BUFR CODE TABLE 0-02-011
    678 C             SATELLITE-DERIVED WIND (SATWND) (DUMP REPORT TYPE 63):
    679 C               NESDIS satellite wind type
    680 C                 0       Reserved
    681 C                 1       IR (long-wave) automated winds (low density)
    682 C                 2       IR (long-wave) manual winds
    683 C                 3       Picture triplet (low density)
    684 C                 4       Water vapor automated (low density)

Page 13          Source Listing                  IW3UNPBF
2017-04-18 11:09                                 iw3unpbf.f

    685 C                 5       Visible manual
    686 C                 6       Visible automated (low density)
    687 C                 7       Gradient winds
    688 C                 8       Picture pair
    689 C                 9       Reserved
    690 C                10       AMSU/SSMI microwave winds
    691 C                11       Scatterometer
    692 C                12       Altimeter
    693 C                13       LAWS
    694 C                14       High-density water vapor sounder, channel 10
    695 C                15       High-density water vapor sounder, channel 11
    696 C                16       High-density IR (long-wave) imager automated winds
    697 C                17       High-density visible imager automated winds
    698 C                18       High-density water vapor imager
    699 C                19       High-density IR (short-wave) imager automated winds
    700 C             20-254      Reserved for future use
    701 C               255       Missing value
    702 C             AIRCRAFT (AIRCFT) (DUMP REPORT TYPE 41):
    703 C               0-96      Reserved
    704 C                97       Inertial navigation system
    705 C                98       OMEGA
    706 C             99-254      Reserved
    707 C               255       Missing value
    708 C    % - WORD 10, REPORT SUBTYPE, IS CURRENTLY SET TO MISSING FOR
    709 C         ALL TYPES EXCEPT:
    710 C             AIRCRAFT (DUMP REPORT TYPE 41), WHERE:
    711 C                 =  1 - AIREP FORMAT AIRCRAFT
    712 C                 =  2 - PIREP FORMAT AIRCRAFT
    713 C                 =  3 - AMDAR FORMAT ASDAR/ACARS AIRCRAFT
    714 C                 =  4 - MDCRS ACARS AIRCRAFT (ARINC -> NCEP)
    715 C                 =  6 - E-AMDAR AIRCRAFT {EUROPEAN AMDAR (ASDAR/ACARS)
    716 C                         DATA ORIGINALLY IN BUFR}
    717 C                 =  7 - MDCRS ACARS AIRCRAFT (ARINC -> AFWA -> NCEP)
    718 C                 =  8 - MADIS/TAMDAR-Mesaba AIRCRAFT
    719 C                 =  9 - CANADIAN AMDAR AIRCRAFT (ASDAR/ACARS DATA
    720 C                         ORIGINALLY IN BUFR)
    721 C                 = 10 - TAMDAR {FROM PANASONIC(AirDAT), DATA ORIGINALLY
    722 C                        IN BUFR}, HEREAFTER REFERRED TO AS TAMDARB
    723 C                 = 11 - KOREAN AMDAR AIRCRAFT (DATA ORIGINALLY IN BUFR)
    724 C                 = 12 - MADIS/TAMDAR-PenAir AIRCRAFT
    725 C                 = 13 - MADIS/TAMDAR-Chautauqua AIRCRAFT
    726 C                 = 103 - CATCH-ALL AMDAR AIRCRAFT (DATA ORIGINALLY IN
    727 C                         BUFR)
    728 C             RECONNAISSANCE/DROPWINSONDE (DUMP REPORT TYPE 31), WHERE:
    729 C                 =  1 - RECONNAISSANCE AIRCRAFT
    730 C                 =  2 - DROPWINSONDE
    731 C    # - WORD 12, STATION ELEVATION QUALITY MARK, IS CURRENTLY SET TO
    732 C         MISSING FOR ALL TYPES EXCEPT MOBILE LAND SURFACE (SYNOPTIC)
    733 C         (DUMP REPORT TYPE 514)
    734 C
    735 C    & - DUMP REPORT TYPES:
    736 C          011 - Fixed land RAOB and PIBAL by block and station
    737 C                 number
    738 C          012 - Fixed land RAOB and PIBAL by call letters
    739 C          013 - Mobile land RAOB, including CLAS soundings
    740 C          022 - Ship RAOB with name
    741 C          023 - Ship RAOB without name (report id set to "SHIP")

Page 14          Source Listing                  IW3UNPBF
2017-04-18 11:09                                 iw3unpbf.f

    742 C          031 - Reconnaissance aircraft or dropwinsonde
    743 C          041 - Aircraft flight-level (all types)
    744 C          063 - Satellite-derived winds
    745 C          065 - SSM/I total precipitable water (ocean)
    746 C          066 - SSM/I rain rate
    747 C          068 - SSM/I brightness temperatures
    748 C          069 - SSM/I cloud water (ocean)
    749 C          073 - Wind profiler originating from PILOT (PIBAL) format
    750 C                 bulletins (mainly tropical and European)
    751 C          511 - Fixed land surface by block and station number
    752 C                 (synoptic, both unrestricted & restricted WMO Res. 40)
    753 C          512 - Fixed land surface by call letters (METAR)
    754 C          514 - Mobile land surface (synoptic)
    755 C          522 - Ship with name
    756 C          523 - Ship without name (report id set to "SHIP")
    757 C          531 - C-MAN platform
    758 C          532 - Tide gauge
    759 C          534 - Coast Guard Tide gauge
    760 C          540 - Mesonet surface
    761 C          551 - Sea-level pressure bogus
    762 C          561 - Buoys arriving in WMO FM13 format (fixed)
    763 C          562 - Buoys arriving in WMO FM18 format (fixed or drifting)
    764 C          571 - SSM/I wind speed (ocean)
    765 C          573 - SSM/I soil moisture
    766 C          574 - SSM/I snow depth
    767 C          575 - SSM/I additional products (surface tag, ice
    768 C                 concentration, ice age, ice edge, calculated
    769 C                 surface type)
    770 C          576 - SSM/I surface (skin) temperature
    771 C          577 - SSM/I sea surface temperature
    772 C
    773 C
    774 C
    775 C
    776 C   ***************************************************************
    777 C
    778 C
    779 C     DATA ARE UNPACKED INTO FIXED LOCATIONS IN WORDS 1-12 AND INTO
    780 C     INDEXED LOCATIONS IN WORD 53 AND FOLLOWING.  THE VERTICAL
    781 C     SIGNIFICANCE DESCRIPTOR FOR EACH LEVEL IN THE BUFR REPORT IS
    782 C     USED TO UNPACK THE LEVEL INTO THE "DATA LEVEL CATEGORIES"
    783 C     DESCRIBED BELOW.  EACH DATA LEVEL CATEGORY HAS A LAYOUT IN
    784 C     LOCATIONS IN ARRAY OBS THAT MAY BE FOUND BY USING THE
    785 C     CORRESPONDING INDEX AMOUNT FROM WORDS 14, 16, ..., 34, IN
    786 C     ARRAY OBS.  FOR INSTANCE, IF A REPORT IS UNPACKED INTO ONE OR
    787 C     MORE CATEGORY 3 DATA LEVEL GROUPS (WIND DATA AT VARIABLE
    788 C     PRESSURE LEVELS) THAT DATA WILL BE SPECIFIED IN THE UNPACKED
    789 C     BINARY FORMAT AS DESCRIBED BELOW UNDER DATA LEVEL CATEGORY 3.
    790 C     THE NUMBER OF LEVELS WILL BE STORED IN WORD 17 OF OBS AND THE
    791 C     INDEX OF THE FIRST LEVEL OF UNPACKED DATA IN THE OUTPUT ARRAY
    792 C     WILL BE STORED IN WORD 18.  THE SECOND LEVEL, IF ANY, WILL BE
    793 C     STORED BEGINNING SIX WORDS FURTHER ON, AND SO FORTH UNTIL THE
    794 C     COUNT IN WORD 17 IS EXHAUSTED.  THE FIELD LAYOUT IN EACH DATA
    795 C     LEVEL CATEGORY IS GIVEN BELOW...
    796 C
    797 C     DATA LEVEL CATEGORY 1 - MANDATORY LEVEL DATA
    798 C     WORD   PARAMETER            UNITS               FORMAT

Page 15          Source Listing                  IW3UNPBF
2017-04-18 11:09                                 iw3unpbf.f

    799 C     ----   ---------            -----------------   -------------
    800 C       1    PRESSURE             0.1 MILLIBARS       REAL
    801 C       2    GEOPOTENTIAL         METERS              REAL
    802 C       3    TEMPERATURE          0.1 DEGREES C       REAL
    803 C       4    DEWPOINT DEPRESSION  0.1 DEGREES C       REAL
    804 C       5    WIND DIRECTION       DEGREES             REAL
    805 C       6    WIND SPEED           0.1 METERS/SEC      REAL
    806 C       7    PRES. QUALITY MARKER (SEE $)             REAL
    807 C       8    GEOP. QUALITY MARKER (SEE $)             REAL
    808 C       9    TEMP. QUALITY MARKER (SEE $)             REAL
    809 C      10    DDPR. QUALITY MARKER (SEE $)             REAL
    810 C      11    WIND  QUALITY MARKER (SEE $)             REAL
    811 C
    812 C     DATA LEVEL CATEGORY 2 - TEMPERATURE AT VARIABLE PRESSURE
    813 C     WORD   PARAMETER            UNITS               FORMAT
    814 C     ----   ---------            -----------------   -------------
    815 C       1    PRESSURE             0.1 MILLIBARS       REAL
    816 C       2    TEMPERATURE          0.1 DEGREES C       REAL
    817 C       3    DEWPOINT DEPRESSION  0.1 DEGREES C       REAL
    818 C       4    PRES. QUALITY MARKER (SEE $)             REAL
    819 C       5    TEMP. QUALITY MARKER (SEE $)             REAL
    820 C       6    DDPR. QUALITY MARKER (SEE $)             REAL
    821 C       7    SPECIAL INDICATOR    (SEE $$)            REAL
    822 C
    823 C     DATA LEVEL CATEGORY 3 - WINDS AT VARIABLE PRESSURE
    824 C     WORD   PARAMETER            UNITS               FORMAT
    825 C     ----   ---------            -----------------   -------------
    826 C       1    PRESSURE             0.1 MILLIBARS       REAL
    827 C       2    WIND DIRECTION       DEGREES             REAL
    828 C       3    WIND SPEED           0.1 METERS/SEC      REAL
    829 C       4    PRES. QUALITY MARKER (SEE $)             REAL
    830 C       5    WIND  QUALITY MARKER (SEE $)             REAL
    831 C       6    SPECIAL INDICATOR    (SEE $$$)           REAL
    832 C
    833 C     DATA LEVEL CATEGORY 4 - WINDS AT VARIABLE HEIGHTS
    834 C     WORD   PARAMETER            UNITS               FORMAT
    835 C     ----   ---------            -----------------   -------------
    836 C       1    GEOPOTENTIAL         METERS              REAL
    837 C       2    WIND DIRECTION       DEGREES             REAL
    838 C       3    WIND SPEED           0.1 METERS/SEC      REAL
    839 C       4    GEOP. QUALITY MARKER (SEE $)             REAL
    840 C       5    WIND  QUALITY MARKER (SEE $)             REAL
    841 C
    842 C     DATA LEVEL CATEGORY 5 - TROPOPAUSE DATA
    843 C     WORD   PARAMETER            UNITS               FORMAT
    844 C     ----   ---------            -----------------   -------------
    845 C       1    PRESSURE             0.1 MILLIBARS       REAL
    846 C       2    TEMPERATURE          0.1 DEGREES C       REAL
    847 C       3    DEWPOINT DEPRESSION  0.1 DEGREES C       REAL
    848 C       4    WIND DIRECTION       DEGREES             REAL
    849 C       5    WIND SPEED           0.1 METERS/SEC      REAL
    850 C       6    PRES. QUALITY MARKER (SEE $)             REAL
    851 C       7    TEMP. QUALITY MARKER (SEE $)             REAL
    852 C       8    DDPR. QUALITY MARKER (SEE $)             REAL
    853 C       9    WIND  QUALITY MARKER (SEE $)             REAL
    854 C
    855 C     DATA LEVEL CATEGORY 6 - CONSTANT-LEVEL DATA (AIRCRAFT,

Page 16          Source Listing                  IW3UNPBF
2017-04-18 11:09                                 iw3unpbf.f

    856 C                   SATELLITE-DERIVED WIND)
    857 C     WORD   PARAMETER            UNITS               FORMAT
    858 C     ----   ---------            -----------------   -------------
    859 C       1    PRESSURE             0.1 MILLIBARS       REAL
    860 C       2    PRESSURE ALTITUDE    METERS              REAL
    861 C       3    TEMPERATURE          0.1 DEGREES C       REAL
    862 C       4    SPECIFIC HUMIDITY    G/KG                REAL
    863 C       5    WIND DIRECTION       DEGREES             REAL
    864 C       6    WIND SPEED           0.1 METERS/SEC      REAL
    865 C       7    PRES. QUALITY MARKER (SEE $)             REAL
    866 C       8    P-ALT QUALITY MARKER (SEE $)             REAL
    867 C       9    TEMP. QUALITY MARKER (SEE $)             REAL
    868 C      10    S-HUM QUALITY MARKER (SEE $)             REAL
    869 C      11    WIND  QUALITY MARKER (SEE $)             REAL
    870 C
    871 C     DATA LEVEL CATEGORY 8 - ADDITIONAL DATA
    872 C     WORD   PARAMETER            UNITS               FORMAT
    873 C     ----   ---------            -----------------   -------------
    874 C       1    VARIABLE SPEPIFIED   (SEE &)             REAL
    875 C            BY CODE FIGURE
    876 C       2    CODE FIGURE          (SEE &)             REAL
    877 C       3    INDICATOR 1          (SEE &)             REAL    
    878 C       4    INDICATOR 2          (SEE &)             REAL    
    879 C
    880 C     DATA LEVEL CATEGORY 51 - SURFACE DATA
    881 C     WORD   PARAMETER            UNITS               FORMAT
    882 C     ----   ---------            -----------------   -------------
    883 C       1    SEA-LEVEL PRESSURE   0.1 MILLIBARS       REAL
    884 C       2    STATION PRESSURE     0.1 MILLIBARS       REAL
    885 C       3    WIND DIRECTION       DEGREES             REAL
    886 C       4    WIND SPEED           0.1 METERS/SEC      REAL
    887 C       5    AIR TEMPERATURE      0.1 DEGREES C       REAL
    888 C       6    DEWPOINT DEPRESSION  0.1 DEGREES C       REAL
    889 C       7    reserved             XMISS               REAL
    890 C       8    reserved             XMISS               REAL
    891 C       9    MSL-P QUALITY MARKER (SEE $)             REAL
    892 C      10    STN-P QUALITY MARKER (SEE $)             REAL
    893 C      11    WIND  QUALITY MARKER (SEE $)             REAL
    894 C      12    ATEMP QUALITY MARKER (SEE $)             REAL
    895 C      13    DDPR. QUALITY MARKER (SEE $)             REAL
    896 C
    897 C    $ - QUALITY MARKER CODE TABLE:
    898 C             0. - MONITOR KEEP
    899 C             1. - GOOD
    900 C             2. - NEUTRAL OR NOT CHECKED (DEFAULT)
    901 C             3. - SUSPECT
    902 C             4. - GOOD - CORRECTED BY O.P.C. (SURFACE MARINE ONLY)
    903 C            12. - REJECT LIST, DO NOT USE
    904 C            13. - FAILED AUTOMATIC Q.C. TESTS, DO NOT USE
    905 C            14. - MONITOR PURGE, DO NOT USE
    906 C
    907 C    $$  - DATA LEVEL CATEGORY 2 SPECIAL INDICATOR:
    908 C             0. - NOTHING INDICATED (DEFAULT)
    909 C             4. - LEVEL PRESSURE ESTIMATED
    910 C
    911 C    $$$ - DATA LEVEL CATEGORY 3 SPECIAL INDICATOR:
    912 C             0. - NOTHING INDICATED (DEFAULT)

Page 17          Source Listing                  IW3UNPBF
2017-04-18 11:09                                 iw3unpbf.f

    913 C             1. - TROPOPAUSE LEVEL
    914 C             2. - MAXIMUM WIND LEVEL
    915 C             3. - MAXIMUM WIND LEVEL AT TERMINATING LEVEL
    916 C             4. - LEVEL PRESSURE ESTIMATED
    917 C
    918 C    & - DATA LEVEL CATEGORY 8 CODE FIGURE:
    919 C           003 - DIFFUSE SOLAR RADIATION IN 100.*JOULE/M**2
    920 C                  INDICATOR 2 CONTAINS TIME PERIOD OVER WHICH
    921 C                   RADIATION WAS INTEGRATED (MINUTES)
    922 C           004 - DIRECT SOLAR RADIATION IN 100.*JOULE/M**2
    923 C                  INDICATOR 2 CONTAINS TIME PERIOD OVER WHICH
    924 C                   RADIATION WAS INTEGRATED (MINUTES)
    925 C           005 - QUALITY MARKER FOR TOTAL PRECIP. OVER  1-HR
    926 C                 (see $ above)
    927 C           006 - QUALITY MARKER FOR TOTAL PRECIP. OVER 24-HR
    928 C                 (see $ above)
    929 C           020 - QUALITY MARKER FOR ALTIMETER SETTING
    930 C                 (see $ above)
    931 C           021 - REPORT SEQUENCE NUMBER
    932 C           104 - RELEASE TIME IN .01*HR
    933 C           105 - RECEIPT TIME IN .01*HR
    934 C                  INDICATOR 1 CONTAINS RECEIPT TIME SIGNIFICANCE
    935 C                  (BUFR CODE TABLE 0-08-202, DEFINED IN THIS CODE)
    936 C           189 - SSM/I 19 GHZ V BRIGHT. TEMP (DEG K TO 10**2 PRECISION)
    937 C                  (FOR SUPEROBS THIS IS MEAN AND INDICATOR 1 IS
    938 C                   STANDARD DEVIATION IN SAME UNITS)
    939 C           190 - SSM/I 19 GHZ H BRIGHT. TEMP (DEG K TO 10**2 PRECISION)
    940 C                  (FOR SUPEROBS THIS IS MEAN AND INDICATOR 1 IS
    941 C                   STANDARD DEVIATION IN SAME UNITS)
    942 C           191 - SSM/I 22 GHZ V BRIGHT. TEMP (DEG K TO 10**2 PRECISION)
    943 C                  (FOR SUPEROBS THIS IS MEAN AND INDICATOR 1 IS
    944 C                   STANDARD DEVIATION IN SAME UNITS)
    945 C           192 - SSM/I 37 GHZ V BRIGHT. TEMP (DEG K TO 10**2 PRECISION)
    946 C                  (FOR SUPEROBS THIS IS MEAN AND INDICATOR 1 IS
    947 C                   STANDARD DEVIATION IN SAME UNITS)
    948 C           193 - SSM/I 37 GHZ H BRIGHT. TEMP (DEG K TO 10**2 PRECISION)
    949 C                  (FOR SUPEROBS THIS IS MEAN AND INDICATOR 1 IS
    950 C                   STANDARD DEVIATION IN SAME UNITS)
    951 C           194 - SSM/I 85 GHZ V BRIGHT. TEMP (DEG K TO 10**2 PRECISION)
    952 C                  (FOR SUPEROBS THIS IS MEAN AND INDICATOR 1 IS
    953 C                   STANDARD DEVIATION IN SAME UNITS)
    954 C           195 - SSM/I 85 GHZ H BRIGHT. TEMP (DEG K TO 10**2 PRECISION)
    955 C                  (FOR SUPEROBS THIS IS MEAN AND INDICATOR 1 IS
    956 C                   STANDARD DEVIATION IN SAME UNITS)
    957 C           196 - SSM/I OCEANIC WIND SPEED (M/SEC TO 10**1 PRECISION)
    958 C                  (FOR SUPEROBS THIS IS MEAN AND INDICATOR 1 IS
    959 C                   STANDARD DEVIATION IN SAME UNITS)
    960 C                  INDICATOR 2 IS RAIN FLAG (BUFR CODE TABLE 0-33-217)
    961 C           197 - SSM/I TOTAL PRECIPITABLE WATER (MM TO 10**1 PRECISION)
    962 C                  (FOR SUPEROBS THIS IS MEAN AND INDICATOR 1 IS
    963 C                   STANDARD DEVIATION IN SAME UNITS)
    964 C                  INDICATOR 2 IS RAIN FLAG (BUFR CODE TABLE 0-33-217)
    965 C           198 - RAINFALL RATE (MM/SEC, TO 10**6 PRECISION FOR SSM/I
    966 C                   AND TO 10**4 PRECISION FOR ALL OTHER DATA TYPES)
    967 C                  (FOR SSM/I SUPEROBS THIS IS MEAN AND INDICATOR 1 IS
    968 C                   STANDARD DEVIATION IN SAME UNITS)
    969 C                  INDICATOR 2 CONTAINS RAINFALL RATE QUALITY MARKER

Page 18          Source Listing                  IW3UNPBF
2017-04-18 11:09                                 iw3unpbf.f

    970 C           199 - SSM/I SURFACE TEMP. (DEG. KELVIN TO 10**2 PRECISION)
    971 C                  (FOR SUPEROBS THIS IS MEAN AND INDICATOR 1 IS
    972 C                   STANDARD DEVIATION IN SAME UNITS)
    973 C           200 - SSM/I CLOUD WATER (MM * 100)
    974 C                  (FOR SUPEROBS THIS IS MEAN AND INDICATOR 1 IS
    975 C                   STANDARD DEVIATION IN SAME UNITS)
    976 C           201 - SSM/I SOIL MOISTURE (MM)
    977 C                  (FOR SUPEROBS THIS IS MEAN AND INDICATOR 1 IS
    978 C                   STANDARD DEVIATION IN SAME UNITS)
    979 C           202 - SSM/I SNOW DEPTH (MM)
    980 C                  (FOR SUPEROBS THIS IS MEAN AND INDICATOR 1 IS
    981 C                   STANDARD DEVIATION IN SAME UNITS)
    982 C           203 - SSM/I SEA-SURFACE TEMP. (DEG. K TO 10**2 PRECISION)
    983 C                  (FOR SUPEROBS THIS IS MEAN AND INDICATOR 1 IS
    984 C                   STANDARD DEVIATION IN SAME UNITS)
    985 C           210 - SSM/I SURFACE TAG --
    986 C                         0 - land
    987 C                         1 - vegitation covered land
    988 C                         2 - near coast
    989 C                         3 - multiyear ice
    990 C                         4 - possible ice
    991 C                         5 - ocean
    992 C                         6 - coast
    993 C           211 - SSM/I ICE CONCENTRATION (PERCENT)
    994 C           212 - SSM/I ICE AGE --
    995 C                         0 - first year ice
    996 C                         1 - multiyear ice
    997 C           213 - SSM/I ICE EDGE --
    998 C                         0 - no edge present
    999 C                         1 - edge present
   1000 C           214 - SSM/I CALCULATED SURFACE TYPE --
   1001 C                         1 - vegetation
   1002 C                         2 - RESERVED
   1003 C                         3 - ice
   1004 C                         4 - RESERVED
   1005 C                         5 - ocean
   1006 C                         6 - coast
   1007 C                         7 - flooded condition
   1008 C                         8 - dense vegetation
   1009 C                         9 - dense agriculture crops
   1010 C                        10 - dry arable soil
   1011 C                        11 - moist soil
   1012 C                        12 - semi-arid surface
   1013 C                        13 - desert
   1014 C                        14 - precipitation over vegetation
   1015 C                        15 - precipitation over soil
   1016 C                        16 - composite vegetation-water
   1017 C                        17 - compostite soil-water-wet soil
   1018 C                        18 - dry snow
   1019 C                        19 - wet snow
   1020 C                        20 - refrozen snow
   1021 C           250-262 - RESERVED FOR W3UNPKB7
   1022 C           351 - GEOPOTENTIAL HEIGHT (METERS)
   1023 C                  INDICATOR 1 IS PRESSURE LEVEL (MB)
   1024 C                  INDICATOR 2 CONTAINS GEOPOTENTIAL QUALITY MARKER
   1025 C           352 - MEAN-SEA LEVEL PRESSURE IN 0.1*MB
   1026 C           353 - SOLAR AND INFRARED RADIATION CORRECTION INDICATOR

Page 19          Source Listing                  IW3UNPBF
2017-04-18 11:09                                 iw3unpbf.f

   1027 C                   (BUFR CODE TABLE 0-02-013)
   1028 C           354 - TRACKING TECHNIQUE/STATUS OF SYSTEM USED INDICATOR
   1029 C                   (BUFR CODE TABLE 0-02-014)
   1030 C           355 - PERCENT CONFIDENCE BASED ON NESDIS RECURSIVE FILTER
   1031 C                 FUNCTION (SATELLITE WINDS) (%)
   1032 C                   (BUFR CODE TABLE 0-33-196)
   1033 C           356 - PERCENT CONFIDENCE BASED ON EUMETSAT QUALITY INDEX
   1034 C                   WITH FORECAST CONSISTENCY TEST (SATELLITE WINDS)
   1035 C                   (%) (BUFR CODE TABLE 0-33-197)
   1036 C           357 - PERCENT CONFIDENCE BASED ON EUMETSAT QUALITY INDEX
   1037 C                   WITHOUT FORECAST CONSISTENCY TEST (SATELLITE WINDS)
   1038 C                   (%) (BUFR CODE TABLE 0-33-198)
   1039 C           358 - PERCENT CONFIDENCE BASED ON NESDIS EXPECTED ERROR
   1040 C                   (SATELLITE WINDS) (%) (BUFR CODE TABLE 0-33-203)
   1041 C           914 - AMDAR FORMAT, MDCRS ACARS, E-AMDAR OR CANADIAN AMDAR
   1042 C                    AIRCRAFT PHASE OF FLIGHT (BUFR CODE TABLE 0-08-004)
   1043 C           915 - AMDAR FORMAT, MDCRS ACARS. E-AMDAR OR CANADIAN AMDAR
   1044 C                    AIRCRAFT  PRECISION OF TEMPERATURE OBSERVATION IN
   1045 C                    0.01*DEG. K
   1046 C           926 - MDCRS ACARS TURBULENCE INDEX FOR PERIOD T-1 MINUTE TO
   1047 C                    T-0 MINUTES (BUFR CODE TABLE 0-11-236)
   1048 C           927 - MDCRS ACARS TURBULENCE INDEX FOR PERIOD T-2 MINUTE TO
   1049 C                    T-1 MINUTES (BUFR CODE TABLE 0-11-237)
   1050 C           928 - MDCRS ACARS TURBULENCE INDEX FOR PERIOD T-3 MINUTE TO
   1051 C                    T-2 MINUTES (BUFR CODE TABLE 0-11-238)
   1052 C           929 - MDCRS ACARS TURBULENCE INDEX FOR PERIOD T-4 MINUTE TO
   1053 C                    T-3 MINUTES (BUFR CODE TABLE 0-11-239)
   1054 C           930 - TAMDAR TURBULENCE INDEX (BUFR CODE TABLE 0-11-235)
   1055 C                  INDICATOR 2 CONTAINS TURBULENCE INDEX QUALITY MARKER
   1056 C                  (0-15)
   1057 C           931 - TAMDAR ROLL ANGLE FLAG (BUFR CODE TABLE 0-02-199)
   1058 C           932 - INSTANTANEOUS ALTITUDE RATE IN .001*METERS/SECOND
   1059 C
   1060 C
   1061 CCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCC
   1062 C
   1063 C           CONTENTS OF UNPACKED REPORT DATA IN THE "OBS2" ARRAY
   1064 C                       (ALL VALUES IN REAL FORMAT)
   1065 C                    (MISSING DATA ARE SET TO "BMISS")
   1066 C
   1067 C   ***************************************************************
   1068 C   WORD   CONTENT                            UNIT                 
   1069 C   ----   --------------------------------   -------------------
   1070 C     1    RESTRICTIONS ON REDISTRIBUTION     BUFR FLAG TBL "0 35 200"
   1071 C     2    EXPIRATION OF RESTRICTIONS ON      HOURS
   1072 C          REDISTRIBUTION
   1073 C     3    ALTIMETER SETTING                  PASCALS
   1074 C     4    SEA-SURFACE TEMPERATURE            KELVIN
   1075 C     5    DEPTH AT WHICH SEA-SURFACE         METERS
   1076 C          TEMPERATURE MEASURED
   1077 C     6    METHOD OF SEA SURFACE TEMPERATURE  BUFR CODE TBL "0 02 038"
   1078 C          MEASUREMENT 
   1079 C     7    RELATIONSHIP TO HORIZONTAL         BUFR CODE TBL "0 08 201"
   1080 C          VISIBILITY
   1081 C     8    HORIZONTAL VISIBILITY              METERS
   1082 C     9    VERTICAL VISIBILITY                METERS
   1083 C    10    PAST WEATHER - 1                   BUFR CODE TBL "0 20 004"

Page 20          Source Listing                  IW3UNPBF
2017-04-18 11:09                                 iw3unpbf.f

   1084 C    11    PAST WEATHER - 2                   BUFR CODE TBL "0 20 005"
   1085 C    12    PEAK WIND SPEED                    METERS/SEC
   1086 C    13    PEAK WIND DIRECTION                DEGREES
   1087 C    14    DURATION OF TIME FOR MAXIMUM       MINUTES
   1088 C          WIND SPEED (GUST)
   1089 C    15    MAXIMUM WIND SPEED (GUST)          METERS/SEC
   1090 C    16    MAXIMUM WIND GUST DIRECTION        DEGREES
   1091 C    17    TOTAL PRECIPITATION PAST  1-HR     KG/METERS**2
   1092 C    18    TOTAL PRECIPITATION PAST  3-HR     KG/METERS**2
   1093 C    19    TOTAL PRECIPITATION PAST  6-HR     KG/METERS**2
   1094 C    20    TOTAL PRECIPITATION PAST 12-HR     KG/METERS**2
   1095 C    21    TOTAL PRECIPITATION PAST 24-HR     KG/METERS**2
   1096 C    22    TOTAL SUNSHINE                     MINUTES
   1097 C    23    TOTAL CLOUD COVER                  PERCENT
   1098 C    24    HEIGHT ABOVE SURFACE OF BASE OF    BUFR CODE TBL "0 20 201"
   1099 C          LOWEST CLOUD SEEN
   1100 C    25    10 METER EXTRAPOLATED WIND SPEED   METERS/SEC
   1101 C    26    20 METER EXTRAPOLATED WIND SPEED   METERS/SEC
   1102 C    27    SURFACE WIND DIRECTION             DEGREES
   1103 C    28    SURFACE WIND SPEED                 METERS/SEC
   1104 C    29    DURATION OF TIME FOR DEPTH OF      HOURS
   1105 C          FRESH SNOW  
   1106 C    30    DEPTH OF FRESH SNOW                METERS
   1107 C    31    TOTAL SNOW DEPTH                   METERS
   1108 C    32    HEIGHT OF WAVES                    METERS
   1109 C    33    PERIOD OF WAVES                    SECONDS
   1110 C    34    HEIGHT OF WIND WAVES               METERS
   1111 C    35    PERIOD OF WIND WAVES               SECONDS
   1112 C    36    TRUE DIRECTION OF SHIP PAST 3-HRS  BUFR CODE TBL "0 01 193"
   1113 C    37    AVERAGE SPEED OF SHIP PAST 3-HRS   BUFR CODE TBL "0 01 200"
   1114 C    38    CHARACTERISTIC OF PRESSURE         BUFR CODE TBL "0 10 063"
   1115 C          TENDENCY
   1116 C    39    03-HOUR PRESSURE CHANGE            PASCALS
   1117 C    40    24-HOUR PRESSURE CHANGE            PASCALS
   1118 C    41    SEA-SURFACE TEMPERATURE Q. MARK    BUFR CODE TBL "0 22 246"
   1119 C                                             (HARDWIRED TO 2 IF SST
   1120 C                                             NON-MISSING, ELSE TO
   1121 C                                             MISSING IF SST MISSING)
   1122 C    42    MOISTURE QUALITY                   BUFR CODE TBL "0 33 026"
   1123 C    43    SATELLITE ZENITH ANGLE             DEGREES
   1124 C
   1125 C
   1126 CCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCC
   1127 C
   1128 C           CONTENTS OF UNPACKED REPORT DATA IN THE "OBS3" ARRAY
   1129 C                       (ALL VALUES IN REAL FORMAT)
   1130 C            (MISSING DATA OR UNUSED VALUES ARE SET TO "BMISS")
   1131 C
   1132 C   ***************************************************************
   1133 C
   1134 C             OBS3(X,Y,1) ON LEVELS ("Y") 1 THROUGH NOBS3(1)
   1135 C
   1136 C   WORD   CONTENT                            UNIT                 
   1137 C    (X)
   1138 C   ----   --------------------------------   -------------------
   1139 C     1    DURATION OF TIME FOR TOTAL         HOURS
   1140 C          PRECIPITATION MEASURMENT  

Page 21          Source Listing                  IW3UNPBF
2017-04-18 11:09                                 iw3unpbf.f

   1141 C     2    TOTAL PRECIPITATION MEASUREMENT    KG/METERS**2
   1142 C
   1143 C
   1144 C             OBS3(X,Y,2) ON LEVELS ("Y") 1 THROUGH NOBS3(2)
   1145 C
   1146 C   WORD   CONTENT                            UNIT                 
   1147 C    (X)
   1148 C   ----   --------------------------------   -------------------
   1149 C     1    PRESENT WEATHER                    BUFR CODE TBL "0 20 003"
   1150 C
   1151 C
   1152 C             OBS3(X,Y,3) ON LEVELS ("Y") 1 THROUGH NOBS3(3)
   1153 C
   1154 C   WORD   CONTENT                            UNIT                 
   1155 C    (X)
   1156 C   ----   --------------------------------   -------------------
   1157 C     1    VERTICAL SIGNIFICANCE (SURFACE     BUFR CODE TBL "0 08 002"
   1158 C          OBSERVATION)
   1159 C     2    CLOUD AMOUNT                       BUFR CODE TBL "0 20 011"
   1160 C     3    CLOUD TYPE                         BUFR CODE TBL "0 20 012"
   1161 C     4    HEIGHT OF BASE OF CLOUD            METERS
   1162 C     5    HEIGHT OF TOP OF CLOUD             METERS
   1163 C
   1164 C
   1165 C             OBS3(X,Y,4) ON LEVELS ("Y") 1 THROUGH NOBS3(4)
   1166 C
   1167 C   WORD   CONTENT                            UNIT                 
   1168 C    (X)
   1169 C   ----   --------------------------------   -------------------
   1170 C     1    DURATION OF TIME FOR MAXIMUM       HOURS
   1171 C          TEMPERATURE
   1172 C     2    MAXIMUM TEMPERATURE                KELVIN
   1173 C     3    DURATION OF TIME FOR MINIMUM       HOURS
   1174 C          TEMPERATURE
   1175 C     4    MINIMUM TEMPERATURE                KELVIN
   1176 C
   1177 C
   1178 C             OBS3(X,Y,5) ON LEVELS ("Y") 1 THROUGH NOBS3(5)
   1179 C
   1180 C   WORD   CONTENT                            UNIT                 
   1181 C    (X)
   1182 C   ----   --------------------------------   -------------------
   1183 C     1    DIRECTION OF SWELL WAVES           DEGREES
   1184 C     2    HEIGHT OF SWELL WAVES              METERS
   1185 C     3    PERIOD OF SWELL WAVES              SECONDS
   1186 C
   1187 C
   1188 C             OBS3(X,Y,6) ON LEVELS ("Y") 1 THROUGH NOBS3(6)
   1189 C
   1190 C   WORD   CONTENT                            UNIT                 
   1191 C    (X)
   1192 C   ----   --------------------------------   -------------------
   1193 C     1    AIRFRAME ICING                     BUFR CODE TBL "0 20 041"
   1194 C     2    HEIGHT OF BASE OF ICING            METERS
   1195 C     3    HEIGHT OF TOP OF ICING             METERS 
   1196 C
   1197 C

Page 22          Source Listing                  IW3UNPBF
2017-04-18 11:09                                 iw3unpbf.f

   1198 C             OBS3(X,Y,7) ON LEVELS ("Y") 1 THROUGH NOBS3(7)
   1199 C
   1200 C   WORD   CONTENT                            UNIT                 
   1201 C    (X)
   1202 C   ----   --------------------------------   -------------------
   1203 C     1    DEGREE OF TURBULENCE               BUFR CODE TBL "0 11 031"
   1204 C     2    HEIGHT OF BASE OF TURBULENCE       METERS
   1205 C     3    HEIGHT OF TOP OF TURBULENCE        METERS
   1206 C
   1207 C
   1208 CCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCC
   1209 C
   1210 C          CONTENTS OF UNPACKED REPORT DATA IN THE "OBS8_8" ARRAY
   1211 C                       (ALL VALUES IN REAL*8 FORMAT)
   1212 C                    (MISSING DATA ARE SET TO "BMISS")
   1213 C
   1214 C   ***************************************************************
   1215 C   WORD   CONTENT                            UNIT
   1216 C   ----   --------------------------------   -------------------
   1217 C     1    LATITUDE                           DEGREES (N+,S-)
   1218 C     2    LONGITUDE                          DEGREES (E+,W-)
   1219 C
   1220 C
   1221 CCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCC
   1222 C
   1223 C
   1224 C ATTRIBUTES:
   1225 C   LANGUAGE: FORTRAN 90
   1226 C   MACHINE:  NCEP WCOSS
   1227 C
   1228 C$$$
   1229       FUNCTION IW3UNPBF(LUNIT,OBS,STNID,CRES1,CRES2,CBULL,OBS2,OBS3,
   1230      $ NOBS3,obs8_8,DSNAME,IDSDAT,IDSDMP_8,SUBSET_r,SUBSKP,IER)
   1231  
   1232       PARAMETER (NUMCAT=8, LEVLIM=300)
   1233 
   1234       COMMON/IUBFAA/BMISS
   1235       COMMON/IUBFBB/KNDX,KSKACF(8),KSKUPA,KSKSFC,KSKSAT,KFLSAT(12),
   1236      $ KSKSMI
   1237       COMMON/IUBFCC/SUBSET
   1238       COMMON/IUBFDD/HDR(12),RCATS(50,LEVLIM,NUMCAT),IKAT(NUMCAT),
   1239      $ MCAT(NUMCAT),NCAT(NUMCAT),LVDX(NUMCAT)
   1240       COMMON/IUBFEE/ROBS(255,9)
   1241       COMMON/IUBFFF/QMS(255,5)
   1242       COMMON/IUBFGG/SFO(6)
   1243       COMMON/IUBFHH/SFQ(5)
   1244       COMMON/IUBFII/PWMIN
   1245       COMMON/IUBFJJ/ISET,MANLIN(1001)
   1246       COMMON/IUBFKK/KOUNT(499,18,2),KNTSAT(250:260),KNTMODIS(783:785),
   1247      $ KNTavhrr(3:224),KNTviirs(224:225),IFLSAT
   1248       COMMON/IUBFLL/Q8(255,2)
   1249       COMMON/IUBFMM/XIND(255)
   1250       COMMON/IUBFNN/STNIDX,CRES1X,CRES2X
   1251       COMMON/IUBFOO/DSNAMX,IDSDAX_8,IDSDMX_8
   1252       COMMON/IUBFPP/LWI,LWR
   1253       COMMON/IUBFQQ/NPRINT(0:255,0:200)
   1254       COMMON/IUBFRR/IDATEB

Page 23          Source Listing                  IW3UNPBF
2017-04-18 11:09                                 iw3unpbf.f

   1255       COMMON/IUBFSS/CBULLX
   1256  
   1257       DIMENSION    OBS(*),OBS2(43),OBS3(5,255,7),NOBS3(7),JWFILE(100)
   1258       dimension    istart(3),iend(3)
   1259 
   1260       CHARACTER*8  STNID,STNIDX,CRES1,CRES1X,CRES2,CRES2X,DSNAME,DSNAMX,
   1261      $ SUBSET_r,SUBSET
   1262       CHARACTER*11 CBULL,CBULLX
   1263 
   1264       INTEGER(8) IDSDMP_8,IDSDAX_8,IDSDMX_8
   1265 
   1266       REAL(8)  BMISS,GETBMISS,obs8_8(2)
   1267 
   1268       LOGICAL  SUBSKP(0:255,0:200)
   1269 
   1270       SAVE
   1271 
   1272       DATA JWFILE/100*0/,LASTF/0/,ITIMES/0/
   1273       data istart/3,200,223/,iend/5,209,223/
   1274 
   1275       IF(ITIMES.EQ.0)  THEN
   1276 
   1277 C  THE FIRST TIME IN, INITIALIZE SOME DATA
   1278 C  (NOTE: FORTRAN 77/90 STANDARD DOES NOT ALLOW COMMON BLOCK VARIABLES
   1279 C         TO BE INITIALIZED VIA DATA STATEMENTS, AND, FOR SOME REASON,
   1280 C         THE BLOCK DATA MAY NOT INITIALIZE DATA IN THE W3EMC/W3NCO
   1281 C         LIBRARIES
   1282 C         A V O I D   B L O C K   D A T A   I N   W 3 L I B )
   1283 C  --------------------------------------------------------------------
   1284 
   1285          ITIMES   =  1
   1286          KNDX     =  0
   1287          KSKACF   =  0
   1288          KSKUPA   =  0
   1289          KSKSFC   =  0
   1290          KSKSAT   =  0
   1291          KFLSAT   =  0
   1292          KSKSMI   =  0
   1293          KOUNT    =  0
   1294          KNTSAT   =  0
   1295          KNTMODIS =  0
   1296          KNTavhrr =  0
   1297          KNTviirs =  0
   1298          IFLSAT   =  0
   1299 
   1300 C  IKAT defines the category number
   1301 
   1302          IKAT(1)  =  1
   1303          IKAT(2)  =  2
   1304          IKAT(3)  =  3
   1305          IKAT(4)  =  4
   1306          IKAT(5)  =  5
   1307          IKAT(6)  =  6
   1308          IKAT(7)  = 51
   1309          IKAT(8)  =  8
   1310 
   1311 C  MCAT defines the number of parameters in a level for each category

Page 24          Source Listing                  IW3UNPBF
2017-04-18 11:09                                 iw3unpbf.f

   1312 C --> THIS NEEDS TO BE UPDATED WHEN ADDING MORE WORDS PER CAT LEVEL
   1313 
   1314          MCAT(1)  = 11  ! Cat.  1
   1315          MCAT(2)  =  7  ! Cat.  2
   1316          MCAT(3)  =  6  ! Cat.  3
   1317          MCAT(4)  =  5  ! Cat.  4
   1318          MCAT(5)  =  9  ! Cat.  5
   1319          MCAT(6)  = 11  ! Cat.  6
   1320          MCAT(7)  = 13  ! Cat. 51
   1321          MCAT(8)  =  4  ! Cat.  8
   1322 
   1323 C  LVDX defines location in UNP holding the no. of levels for each cat.
   1324 
   1325          LVDX(1)  = 13  ! Cat.  1
   1326          LVDX(2)  = 15  ! Cat.  2
   1327          LVDX(3)  = 17  ! Cat.  3
   1328          LVDX(4)  = 19  ! Cat.  4
   1329          LVDX(5)  = 21  ! Cat.  5
   1330          LVDX(6)  = 23  ! Cat.  6
   1331          LVDX(7)  = 29  ! Cat. 51
   1332          LVDX(8)  = 27  ! Cat.  8
   1333 
   1334          ISET  = 0
   1335       END IF
   1336 
   1337 C  UNIT NUMBER OUT OF RANGE RETURNS A 999
   1338 C  --------------------------------------
   1339 
   1340       IF(LUNIT.LT.1 .OR. LUNIT.GT.100)  THEN
   1341          PRINT'(" ##IW3UNPBF - UNIT NUMBER ",I0," OUT OF RANGE -- ",
   1342      $    "IER = 999")', LUNIT
   1343          GO TO 9999
   1344       END IF
   1345       IF(LASTF.NE.LUNIT .AND. LASTF.GT.0) THEN
   1346          CALL CLOSBF(LASTF)
   1347          JWFILE(LASTF) = 0
   1348       END IF
   1349       LASTF = LUNIT
   1350  
   1351    60 CONTINUE
   1352 
   1353 C  THE JWFILE INDICATOR: =0 IF UNOPENED; =2 IF OPENED AND NCEP BUFR
   1354 C  ----------------------------------------------------------------
   1355  
   1356       IF(JWFILE(LUNIT).EQ.0) THEN
   1357          PRINT'(" ===> IW3UNPBF - WCOSS VERSION: 01-11-2017")'
   1358 
   1359 C  DETERMINE MACHINE WORD LENGTH (BYTES) FOR BOTH INTEGERS AND REALS
   1360 C  -----------------------------------------------------------------
   1361 
   1362          CALL WORDLENGTH(LWI,LWR)
   1363          PRINT 2213, LWI,LWR
   1364  2213 FORMAT(/' ---> IW3UNPBF - MACHINE WORD LENGTH (BYTES) FOR ',
   1365      $ 'INTEGER WORDS IS ',I3/' ---> IW3UNPBF - MACHINE WORD LENGTH ',
   1366      $ '(BYTES) FOR   REAL  WORDS IS ',I3/)
   1367          NPRINT = 0
   1368 

Page 25          Source Listing                  IW3UNPBF
2017-04-18 11:09                                 iw3unpbf.f

   1369          BMISS = GETBMISS()
   1370          print'(1X)'
   1371          print'(" BUFRLIB value for missing passed into IW3UNPBF is: ",
   1372      $    G0)', bmiss
   1373          print'(1X)'
   1374 
   1375          IF(IER.EQ.-1)  THEN
   1376             IER = 0  
   1377             PRINT 4567, LUNIT
   1378  4567 FORMAT(/'##IW3UNPBF: UNIT NUMBER',I3,' HAS ALREADY BEEN OPENED ',
   1379      $ 'BY CORRESPONDING INTERFACE SUBROUTINE W3UNPKB7 AND REPORTS ',
   1380      $ 'HAVE BEEN'/12X,'PROCESSED - CONTINUE PROCESSING REPORTS HERE'/)
   1381             JWFILE(LUNIT) = 2
   1382             DSNAMX   = DSNAME
   1383             IDSDAX_8 = IDSDAT
   1384             IDSDMX_8 = IDSDMP_8
   1385             SUBSET   = SUBSET_r
   1386 
   1387   867       CONTINUE
   1388 
   1389             ISUB = NMSUB(LUNIT)
   1390             READ(SUBSET(3:5),'(I3)') IINDEX
   1391             READ(SUBSET(6:8),'(I3)') JINDEX
   1392             IF(IINDEX.LE.255 .AND. JINDEX.LE.200) THEN
   1393                IF(SUBSKP(IINDEX,JINDEX))  THEN
   1394                   IF(ISUB.GT.0.AND.NPRINT(IINDEX,JINDEX).EQ.0)  THEN
   1395 
   1396 C  There may be messages with no reports present (e.g., the center time
   1397 C   and dump time messages which may be present even if no reports are
   1398 C   present in subsequent messages), so key on the FIRST message of
   1399 C   this type/subtype with reports present for the diagnostic print
   1400 
   1401                      PRINT 1234, SUBSET
   1402  1234 FORMAT(/'IW3UNPBF/I02UBF - BUFR MESSAGE WITH TABLE ENTRY "',A8,
   1403      $ '" (AND CONTAINING SUBSETS) READ - ALL MESSAGES WITH THIS BUFR ',
   1404      $ 'TYPE/SUBTYPE'/20X,'ARE SKIPPED AS DIRECTED BY CALLING PROGRAM'/)
   1405                      NPRINT(IINDEX,JINDEX) = 1
   1406                   END IF
   1407                   CALL READMG(LUNIT,SUBSET,idateb,IRET)
   1408                   IF(IRET.NE.0)  THEN
   1409                      IER = 2
   1410                      IW3UNPBF = 2
   1411                      RETURN
   1412                   END IF
   1413                   GO TO 867
   1414                END IF
   1415             END IF
   1416             GO TO 60
   1417          END IF
   1418          IERR = I02UBF(LUNIT,OBS,OBS2,OBS3,NOBS3,obs8_8,SUBSKP,IER)
   1419          IF(IERR.EQ.1) THEN
   1420             PRINT'(" IW3UNPBF - OPENED AN NCEP BUFR FILE IN UNIT ",I0)',
   1421      $       LUNIT
   1422             JWFILE(LUNIT) = 2
   1423             KNDX = 0
   1424             KSKACF = 0
   1425             KSKUPA = 0

Page 26          Source Listing                  IW3UNPBF
2017-04-18 11:09                                 iw3unpbf.f

   1426             KSKSFC = 0
   1427             KSKSAT = 0
   1428             KFLSAT = 0
   1429             KSKSMI = 0
   1430             IFLSAT = 0
   1431             IER = 1
   1432             IW3UNPBF = 1
   1433          ELSE IF(IERR.NE.999) THEN
   1434             IER = 3
   1435             IW3UNPBF = 3                                
   1436          ELSE
   1437             IER = 999
   1438             IW3UNPBF = 999
   1439          END IF
   1440       ELSE IF(JWFILE(LUNIT).EQ.2) THEN
   1441          IF(I02UBF(LUNIT,OBS,OBS2,OBS3,NOBS3,obs8_8,SUBSKP,IER).NE.0)
   1442      $    JWFILE(LUNIT) = 0
   1443          IF(IER.GT.0) CALL CLOSBF(LUNIT)
   1444          IF(IER.EQ.2.OR.IER.EQ.3)  THEN
   1445             PRINT'(1X)'
   1446             IF(KSKACF(1).GT.0)  PRINT'(" IW3UNPBF - NO. OF AIRCFT/",
   1447      $       "AIRCAR REPORTS TOSSED DUE TO ZERO CAT. 6 LVLS = ",I0)',
   1448      $       KSKACF(1)
   1449             IF(KSKACF(8).GT.0)  PRINT'(" IW3UNPBF - NO. OF AIRCFT ",
   1450      $       "REPORTS TOSSED DUE TO BEING ""PHWR"" AIREP FORMAT = ",
   1451      $       I0)', KSKACF(8)
   1452             IF(KSKACF(3).GT.0)  PRINT'(" IW3UNPBF - NO. OF AMDAR ",
   1453      $       "FORMAT ASDAR/ACARS AIRCFT REPORTS TOSSED DUE TO BEING ",
   1454      $       "DISGUISED AS AIREP FORMAT REPORTS BY AFWA = ",I0)',
   1455      $       KSKACF(3)
   1456             IF(KSKACF(4).GT.0)  PRINT'(" IW3UNPBF - NO. OF MDCRS ACARS",
   1457      $       " AIRCFT REPORTS TOSSED DUE TO BEING DISGUISED AS ",
   1458      $       "AIREP FORMAT REPORTS BY AFWA = ",I0)', KSKACF(4)
   1459             IF(KSKACF(5).GT.0)  PRINT'(" IW3UNPBF - NO. OF AIRCFT/",
   1460      $       "AIRCAR REPORTS TOSSED DUE TO HAVING MISSING WIND = ",I0)',
   1461      $       KSKACF(5)
   1462             IF(KSKACF(1)+KSKACF(3)+KSKACF(4)+KSKACF(5)+KSKACF(8).GT.0)
   1463      $       PRINT'(" IW3UNPBF - TOTAL NO. OF AIRCFT/AIRCAR REPORTS ",
   1464      $        "TOSSED = ",I0)',
   1465      $        KSKACF(1)+KSKACF(3)+KSKACF(4)+KSKACF(5)+KSKACF(8)
   1466             IF(KSKUPA.GT.0)  PRINT'(" IW3UNPBF - TOTAL NO. OF ADPUPA ",
   1467      $       "REPORTS TOSSED = ",I0)', KSKUPA
   1468             IF(KSKSFC.GT.0)  PRINT'(" IW3UNPBF - TOTAL NO. OF ADPSFC/",
   1469      $       "SFCSHP/SFCBOG/MSONET REPORTS TOSSED = ",I0)', KSKSFC
   1470             IF(KSKSAT.GT.0)  PRINT'(" IW3UNPBF - TOTAL NO. OF SATWND ",
   1471      $       "REPORTS TOSSED = ",I0)', KSKSAT
   1472             IF(KFLSAT(1).GT.0)  PRINT'(" IW3UNPBF - TOTAL NO. OF ",
   1473      $       "EUMETSAT SATWND REPORTS FLAGGED WITH WQM=13 DUE TO QI ",
   1474      $       "CONFIDENCE FACTOR </= LIMqi % = ",I0)', KFLSAT(1)
   1475             IF(KFLSAT(2).GT.0)  PRINT'(" IW3UNPBF - TOTAL NO. OF ",
   1476      $       "EUMETSAT SATWND REPORTS FLAGGED WITH WQM=13 DUE TO QI ",
   1477      $       "MANUAL/AUTOMATIC Q.C. INDICATOR >/= LIMqc = ",I0)',
   1478      $       KFLSAT(2)
   1479             IF(KFLSAT(3).GT.0)  PRINT'(" IW3UNPBF - TOTAL NO. OF JMA ",
   1480      $       "SATWND REPORTS FLAGGED WITH WQM=13 DUE TO QI CONFIDENCE ",
   1481      $       "FACTOR </= LIMqi % = ",I0)', KFLSAT(3)
   1482             IF(KFLSAT(4).GT.0)  PRINT'(" IW3UNPBF - TOTAL NO. OF JMA ",

Page 27          Source Listing                  IW3UNPBF
2017-04-18 11:09                                 iw3unpbf.f

   1483      $       "SATWND REPORTS FLAGGED WITH WQM=13 DUE TO QI MANUAL/",
   1484      $       "AUTOMATIC Q.C. INDICATOR >/= LIMqc = ",I0)', KFLSAT(4)
   1485             IF(KFLSAT(5).GT.0)  PRINT'(" IW3UNPBF - TOTAL NO. OF GOES ",
   1486      $       "SATWND REPORTS FLAGGED WITH WQM=13 DUE TO QI CONFIDENCE ",
   1487      $       "FACTOR </= LIMqi % = ",I0)', KFLSAT(5)
   1488             IF(KFLSAT(6).GT.0)  PRINT'(" IW3UNPBF - TOTAL NO. OF GOES ",
   1489      $       "SATWND REPORTS FLAGGED WITH WQM=13 DUE TO QI MANUAL/",
   1490      $       "AUTOMATIC Q.C. INDICATOR >/= LIMqc = ",I0)', KFLSAT(6)
   1491             IF(KFLSAT(7).GT.0)  PRINT'(" IW3UNPBF - TOTAL NO. OF MODIS",
   1492      $       " POES SATWND REPORTS FLAGGED WITH WQM=13 DUE TO QI ",
   1493      $       "CONFIDENCE FACTOR </= LIMqi % = ",I0)', KFLSAT(7)
   1494             IF(KFLSAT(8).GT.0)  PRINT'(" IW3UNPBF - TOTAL NO. OF MODIS",
   1495      $       " POES SATWND REPORTS FLAGGED WITH WQM=13 DUE TO QI ",
   1496      $       "MANUAL/AUTOMATIC Q.C. INDICATOR >/= LIMqc = ",I0)',
   1497      $       KFLSAT(8)
   1498             IF(KFLSAT(9).GT.0)  PRINT *, 'IW3UNPBF - TOTAL NO. OF ',
   1499      $       'AVHRR POES SATWND REPORTS FLAGGED WITH WQM=13 DUE TO QI ',
   1500      $       'CONFIDENCE FACTOR </= LIMqi % = ',KFLSAT(9)
   1501             IF(KFLSAT(10).GT.0)  PRINT *, 'IW3UNPBF - TOTAL NO. OF ',
   1502      $       'AVHRR POES SATWND REPORTS FLAGGED WITH WQM=13 DUE TO QI ',
   1503      $       'MANUAL/AUTOMATIC Q.C. INDICATOR >/= LIMqc = ',KFLSAT(10)
   1504             IF(KFLSAT(11).GT.0)  PRINT *, 'IW3UNPBF - TOTAL NO. OF ',
   1505      $       'VIIRS POES SATWND REPORTS FLAGGED WITH WQM=13 DUE TO QI ',
   1506      $       'CONFIDENCE FACTOR </= LIMqi % = ',KFLSAT(11)
   1507             IF(KFLSAT(12).GT.0)  PRINT *, 'IW3UNPBF - TOTAL NO. OF ',
   1508      $       'VIIRS POES SATWND REPORTS FLAGGED WITH WQM=13 DUE TO QI ',
   1509      $       'MANUAL/AUTOMATIC Q.C. INDICATOR >/= LIMqc = ',KFLSAT(12)
   1510             IF(KSKSMI.GT.0)  PRINT'(" IW3UNPBF - TOTAL NO. OF SPSSMI ",
   1511      $       "REPORTS TOSSED = ",I0)', KSKSMI
   1512             IF(IFLSAT.EQ.1)  THEN
   1513                MFLAG = 0
   1514                PRINT 8102
   1515  8102 FORMAT(/' ---> IW3UNPBF: SUMMARY OF NESDIS GOES REPORT COUNTS ',
   1516      $ 'GROUPED BY SATELLITE ID (PRIOR TO ANY FILTERING BY CALLING ',
   1517      $ 'PROGRAM)'/)
   1518                DO  IDSAT = 250,259
   1519                   IF(KNTSAT(IDSAT).GT.0)  THEN
   1520                      PRINT 8103, IDSAT,KNTSAT(IDSAT)
   1521                      MFLAG = 1
   1522                   ENDIF
   1523                ENDDO
   1524  8103 FORMAT(15X,'NUMBER FROM SAT. ID',I4,4X,':',I6)
   1525                IF(KNTSAT(260).GT.0)  THEN
   1526                   PRINT 8104, KNTSAT(260)
   1527                   MFLAG = 1
   1528                ENDIF
   1529  8104 FORMAT(15X,'NUMBER FROM UNKNOWN SAT. ID:',I6)
   1530                IF(MFLAG.EQ.0)  PRINT 8110
   1531  8110 FORMAT(15X,'NO REPORTS OF THIS TYPE WERE READ')
   1532                PRINT 8105
   1533  8105          FORMAT(/)
   1534                MFLAG = 0
   1535                PRINT 8202
   1536  8202 FORMAT(/' ---> IW3UNPBF: SUMMARY OF NASA/MODIS POES REPORT ',
   1537      $ 'COUNTS GROUPED BY SATELLITE ID (PRIOR TO ANY FILTERING BY ',
   1538      $ 'CALLING PROGRAM)'/)
   1539                DO  IDSAT = 783,784

Page 28          Source Listing                  IW3UNPBF
2017-04-18 11:09                                 iw3unpbf.f

   1540                   IF(KNTMODIS(IDSAT).GT.0) THEN
   1541                      PRINT 8103, IDSAT,KNTMODIS(IDSAT)
   1542                      MFLAG = 1
   1543                   ENDIF
   1544                ENDDO
   1545                IF(KNTMODIS(785).GT.0)  THEN
   1546                   PRINT 8104, KNTMODIS(785)
   1547                   MFLAG = 1
   1548                ENDIF
   1549                IF(MFLAG.EQ.0)  PRINT 8110
   1550                PRINT 8105
   1551                MFLAG = 0
   1552                PRINT 8203
   1553  8203 FORMAT(/' ---> IW3UNPBF: SUMMARY OF NESDIS/AVHRR POES REPORT ',
   1554      $ 'COUNTS GROUPED BY SATELLITE ID (PRIOR TO ANY FILTERING BY ',
   1555      $ 'CALLING PROGRAM)'/)
   1556                do ii = 1,3
   1557                   DO  IDSAT = istart(ii),iend(ii)
   1558                      IF(KNTavhrr(IDSAT).GT.0) THEN
   1559                         PRINT 8103, IDSAT,KNTavhrr(IDSAT)
   1560                         MFLAG = 1
   1561                      ENDIF
   1562                   ENDDO
   1563                enddo
   1564                IF(KNTavhrr(224).GT.0)  THEN
   1565                   PRINT 8104, KNTavhrr(224)
   1566                   MFLAG = 1
   1567                ENDIF
   1568                IF(MFLAG.EQ.0)  PRINT 8110
   1569                PRINT 8105
   1570                MFLAG = 0
   1571                PRINT 8204
   1572  8204 FORMAT(/' ---> IW3UNPBF: SUMMARY OF NASA/VIIRS POES REPORT ',
   1573      $ 'COUNTS GROUPED BY SATELLITE ID (PRIOR TO ANY FILTERING BY ',
   1574      $ 'CALLING PROGRAM)'/)
   1575                DO  IDSAT = 224,224
   1576                   IF(KNTviirs(IDSAT).GT.0) THEN
   1577                      PRINT 8103, IDSAT,KNTviirs(IDSAT)
   1578                      MFLAG = 1
   1579                   ENDIF
   1580                ENDDO
   1581                IF(KNTviirs(225).GT.0)  THEN
   1582                   PRINT 8104, KNTviirs(225)
   1583                   MFLAG = 1
   1584                ENDIF
   1585                IF(MFLAG.EQ.0)  PRINT 8110
   1586                PRINT 8105
   1587             END IF
   1588             KNDX = 0
   1589             KSKACF = 0
   1590             KSKUPA = 0
   1591             KSKSFC = 0
   1592             KSKSAT = 0
   1593             KFLSAT = 0
   1594             KSKSMI = 0
   1595             IFLSAT = 0
   1596          END IF

Page 29          Source Listing                  IW3UNPBF
2017-04-18 11:09                                 iw3unpbf.f

   1597          IW3UNPBF = IER
   1598       END IF
   1599  
   1600       STNID    = STNIDX
   1601       CRES1    = CRES1X
   1602       CRES2    = CRES2X
   1603       CBULL    = CBULLX
   1604       DSNAME   = DSNAMX
   1605       IDSDAT   = IDSDAX_8
   1606       IDSDMP_8 = IDSDMX_8
   1607       SUBSET_r = SUBSET
   1608 
   1609       RETURN
   1610 
   1611  9999 CONTINUE
   1612       IER = 999
   1613       IW3UNPBF = 999
   1614       RETURN
   1615 
   1616       END


ENTRY POINTS

  Name                 
                       
 iw3unpbf_             


SYMBOL CROSS REFERENCE

 Name                       Object Declared Type            Bytes Dimen Elements Attributes       References                        
                                                                                                                                    
 1234                       Label  1402                                                           1401                              
 2213                       Label  1364                                                           1363                              
 4567                       Label  1378                                                           1377                              
 60                         Label  1351                                                           1416                              
 8102                       Label  1515                                                           1514                              
 8103                       Label  1524                                                           1520,1541,1559,1577               
 8104                       Label  1529                                                           1526,1546,1565,1582               
 8105                       Label  1533                                                           1532,1550,1569,1586               
 8110                       Label  1531                                                           1530,1549,1568,1585               
 8202                       Label  1536                                                           1535                              
 8203                       Label  1553                                                           1552                              
 8204                       Label  1572                                                           1571                              
 867                        Label  1387                                                           1413                              
 9999                       Label  1611                                                           1343                              
 BMISS                      Scalar 1234     R(8)            8           scalar   COM              1369,1372                         
 CBULL                      Dummy  1229     CHAR            11          scalar   ARG,INOUT        1603                              
 CBULLX                     Scalar 1255     CHAR            11          scalar   COM              1603                              
 CLOSBF                     Subr   1346                                                           1346,1443                         
 CRES1                      Dummy  1229     CHAR            8           scalar   ARG,INOUT        1601                              
 CRES1X                     Scalar 1250     CHAR            8           scalar   COM              1601                              
 CRES2                      Dummy  1229     CHAR            8           scalar   ARG,INOUT        1602                              
 CRES2X                     Scalar 1250     CHAR            8           scalar   COM              1602                              
 DSNAME                     Dummy  1230     CHAR            8           scalar   ARG,INOUT        1382,1604                         
 DSNAMX                     Scalar 1251     CHAR            8           scalar   COM              1382,1604                         

Page 30          Source Listing                  IW3UNPBF
2017-04-18 11:09 Symbol Table                    iw3unpbf.f

 Name                       Object Declared Type            Bytes Dimen Elements Attributes       References                        
                                                                                                                                    
 GETBMISS                   Func   1266     R(8)            8           scalar                    1369                              
 HDR                        Scalar 1238     R(4)            4     1     12       COM                                                
 I02UBF                     Func   1418     I(4)            4           scalar                    1418,1441                         
 IDATEB                     Scalar 1254     I(4)            4           scalar   COM              1407                              
 IDSAT                      Local  1518     I(4)            4           scalar   SAVE             1518,1519,1520,1539,1540,1541,1557
                                                                                                  ,1558,1559,1575,1576,1577         
 IDSDAT                     Dummy  1230     I(4)            4           scalar   ARG,INOUT        1383,1605                         
 IDSDAX_8                   Scalar 1251     I(8)            8           scalar   COM              1383,1605                         
 IDSDMP_8                   Dummy  1230     I(8)            8           scalar   ARG,INOUT        1384,1606                         
 IDSDMX_8                   Scalar 1251     I(8)            8           scalar   COM              1384,1606                         
 IEND                       Local  1258     I(4)            4     1     3        SAVE             1273,1557                         
 IER                        Dummy  1230     I(4)            4           scalar   ARG,INOUT        1375,1376,1409,1418,1431,1434,1437
                                                                                                  ,1441,1443,1444,1597,1612         
 IERR                       Local  1418     I(4)            4           scalar   SAVE             1418,1419,1433                    
 IFLSAT                     Scalar 1247     I(4)            4           scalar   COM              1298,1430,1512,1595               
 II                         Local  1556     I(4)            4           scalar   SAVE             1556,1557                         
 IINDEX                     Local  1390     I(4)            4           scalar   SAVE             1390,1392,1393,1394,1405          
 IKAT                       Scalar 1238     I(4)            4     1     8        COM              1302,1303,1304,1305,1306,1307,1308
                                                                                                  ,1309                             
 IRET                       Local  1407     I(4)            4           scalar   SAVE             1407,1408                         
 ISET                       Scalar 1245     I(4)            4           scalar   COM              1334                              
 ISTART                     Local  1258     I(4)            4     1     3        SAVE             1273,1557                         
 ISUB                       Local  1389     I(4)            4           scalar   SAVE             1389,1394                         
 ITIMES                     Local  1272     I(4)            4           scalar   SAVE             1272,1275,1285                    
 IUBFAA                     Common 1234                                 8        SAVE                                               
 IUBFBB                     Common 1235                                 100      SAVE                                               
 IUBFCC                     Common 1237                                 8        SAVE                                               
 IUBFDD                     Common 1238                                 480176   SAVE                                               
 IUBFEE                     Common 1240                                 9180     SAVE                                               
 IUBFFF                     Common 1241                                 5100     SAVE                                               
 IUBFGG                     Common 1242                                 24       SAVE                                               
 IUBFHH                     Common 1243                                 20       SAVE                                               
 IUBFII                     Common 1244                                 4        SAVE                                               
 IUBFJJ                     Common 1245                                 4008     SAVE                                               
 IUBFKK                     Common 1246                                 72812    SAVE                                               
 IUBFLL                     Common 1248                                 2040     SAVE                                               
 IUBFMM                     Common 1249                                 1020     SAVE                                               
 IUBFNN                     Common 1250                                 24       SAVE                                               
 IUBFOO                     Common 1251                                 24       SAVE                                               
 IUBFPP                     Common 1252                                 8        SAVE                                               
 IUBFQQ                     Common 1253                                 205824   SAVE                                               
 IUBFRR                     Common 1254                                 4        SAVE                                               
 IUBFSS                     Common 1255                                 11       SAVE                                               
 IW3UNPBF                   Func   1229     I(4)            4           scalar                    1410,1432,1435,1438,1597,1613     
 IW3UNPBF@0                 Local  1229     I(4)            4           scalar   SAVE                                               
 JINDEX                     Local  1391     I(4)            4           scalar   SAVE             1391,1392,1393,1394,1405          
 JWFILE                     Local  1257     I(4)            4     1     100      SAVE             1272,1347,1356,1381,1422,1440,1442
 KFLSAT                     Scalar 1235     I(4)            4     1     12       COM              1291,1428,1472,1474,1475,1478,1479
                                                                                                  ,1481,1482,1484,1485,1487,1488,149
                                                                                                  0,1491,1493,1494,1497,1498,1500,15
                                                                                                  01,1503,1504,1506,1507,1509,1593  
 KNDX                       Scalar 1235     I(4)            4           scalar   COM              1286,1423,1588                    
 KNTAVHRR                   Scalar 1247     I(4)            4     1     222      COM              1296,1558,1559,1564,1565          
 KNTMODIS                   Scalar 1246     I(4)            4     1     3        COM              1295,1540,1541,1545,1546          
 KNTSAT                     Scalar 1246     I(4)            4     1     11       COM              1294,1519,1520,1525,1526          

Page 31          Source Listing                  IW3UNPBF
2017-04-18 11:09 Symbol Table                    iw3unpbf.f

 Name                       Object Declared Type            Bytes Dimen Elements Attributes       References                        
                                                                                                                                    
 KNTVIIRS                   Scalar 1247     I(4)            4     1     2        COM              1297,1576,1577,1581,1582          
 KOUNT                      Scalar 1246     I(4)            4     3     17964    COM              1293                              
 KSKACF                     Scalar 1235     I(4)            4     1     8        COM              1287,1424,1446,1448,1449,1451,1452
                                                                                                  ,1455,1456,1458,1459,1461,1462,146
                                                                                                  5,1589                            
 KSKSAT                     Scalar 1235     I(4)            4           scalar   COM              1290,1427,1470,1471,1592          
 KSKSFC                     Scalar 1235     I(4)            4           scalar   COM              1289,1426,1468,1469,1591          
 KSKSMI                     Scalar 1236     I(4)            4           scalar   COM              1292,1429,1510,1511,1594          
 KSKUPA                     Scalar 1235     I(4)            4           scalar   COM              1288,1425,1466,1467,1590          
 LASTF                      Local  1272     I(4)            4           scalar   SAVE             1272,1345,1346,1347,1349          
 LEVLIM                     Param  1232     I(4)            4           scalar                    1238                              
 LUNIT                      Dummy  1229     I(4)            4           scalar   ARG,INOUT        1340,1342,1345,1349,1356,1377,1381
                                                                                                  ,1389,1407,1418,1421,1422,1440,144
                                                                                                  1,1442,1443                       
 LVDX                       Scalar 1239     I(4)            4     1     8        COM              1325,1326,1327,1328,1329,1330,1331
                                                                                                  ,1332                             
 LWI                        Scalar 1252     I(4)            4           scalar   COM              1362,1363                         
 LWR                        Scalar 1252     I(4)            4           scalar   COM              1362,1363                         
 MANLIN                     Scalar 1245     I(4)            4     1     1001     COM                                                
 MCAT                       Scalar 1239     I(4)            4     1     8        COM              1314,1315,1316,1317,1318,1319,1320
                                                                                                  ,1321                             
 MFLAG                      Local  1513     I(4)            4           scalar   SAVE             1513,1521,1527,1530,1534,1542,1547
                                                                                                  ,1549,1551,1560,1566,1568,1570,157
                                                                                                  8,1583,1585                       
 NCAT                       Scalar 1239     I(4)            4     1     8        COM                                                
 NMSUB                      Func   1389     I(4)            4           scalar                    1389                              
 NOBS3                      Dummy  1230     I(4)            4     1     7        ARG,INOUT        1418,1441                         
 NPRINT                     Scalar 1253     I(4)            4     2     51456    COM              1367,1394,1405                    
 NUMCAT                     Param  1232     I(4)            4           scalar                    1238,1239                         
 OBS                        Dummy  1229     R(4)            4     1     0        ARG,INOUT        1418,1441                         
 OBS2                       Dummy  1229     R(4)            4     1     43       ARG,INOUT        1418,1441                         
 OBS3                       Dummy  1229     R(4)            4     3     8925     ARG,INOUT        1418,1441                         
 OBS8_8                     Dummy  1230     R(8)            8     1     2        ARG,INOUT        1418,1441                         
 PWMIN                      Scalar 1244     R(4)            4           scalar   COM                                                
 Q8                         Scalar 1248     R(4)            4     2     510      COM                                                
 QMS                        Scalar 1241     R(4)            4     2     1275     COM                                                
 RCATS                      Scalar 1238     R(4)            4     3     120000   COM                                                
 READMG                     Subr   1407                                                           1407                              
 ROBS                       Scalar 1240     R(4)            4     2     2295     COM                                                
 SFO                        Scalar 1242     R(4)            4     1     6        COM                                                
 SFQ                        Scalar 1243     R(4)            4     1     5        COM                                                
 STNID                      Dummy  1229     CHAR            8           scalar   ARG,INOUT        1600                              
 STNIDX                     Scalar 1250     CHAR            8           scalar   COM              1600                              
 SUBSET                     Scalar 1237     CHAR            8           scalar   COM              1385,1390,1391,1401,1407,1607     
 SUBSET_R                   Dummy  1230     CHAR            8           scalar   ARG,INOUT        1385,1607                         
 SUBSKP                     Dummy  1230     L(4)            4     2     51456    ARG,INOUT        1393,1418,1441                    
 WORDLENGTH                 Subr   1362                                                           1362                              
 XIND                       Scalar 1249     R(4)            4     1     255      COM                                                

Page 32          Source Listing                  IW3UNPBF
2017-04-18 11:09                                 iw3unpbf.f

   1617 C***********************************************************************
   1618 C***********************************************************************
   1619 C***********************************************************************
   1620       FUNCTION I02UBF(LUNIT,OBS,OBS2,OBS3,NOBS3,obs8_8,SUBSKP,IER)
   1621  
   1622       PARAMETER (MAXOBS=3500)
   1623 
   1624       COMMON/IUBFCC/SUBSET
   1625       COMMON/IUBFOO/DSNAMX,IDSDAX_8,IDSDMX_8
   1626       COMMON/IUBFQQ/NPRINT(0:255,0:200)
   1627       COMMON/IUBFRR/IDATEB
   1628  
   1629       CHARACTER*8  SUBSET,DSNAMX,CBUFR
   1630       CHARACTER*6  C01UBF
   1631       DIMENSION    OBS(MAXOBS),OBS2(43),OBS3(5,255,7),NOBS3(7),JDATE(5),
   1632      $ JDUMP(5)
   1633       real(8)    obs8_8(2)
   1634       INTEGER(8) IDSDAX_8,IDSDMX_8,JDUMP_8(5)
   1635       LOGICAL  SUBSKP(0:255,0:200)
   1636  
   1637       SAVE
   1638 
   1639       JDATE = -1
   1640       JDUMP = -1
   1641 
   1642       CALL STATUS(LUNIT,LUN,IL,IM)
   1643 
   1644       IF(IL.EQ.0) THEN
   1645  
   1646 C  IF FILE IS CLOSED TRY TO OPEN IT AND RETURN INFORMATION ABOUT IT
   1647 C  IN DSNAMX, IDSDAX_8 AND IDSDMX_8
   1648 C  ----------------------------------------------------------------
   1649  
   1650          IRET = -1
   1651          I02UBF = 2
   1652          REWIND LUNIT
   1653          READ(LUNIT,END=11,ERR=12,FMT='(A8)') CBUFR
   1654          IF(CBUFR(1:4).EQ.'BUFR') THEN
   1655             PRINT'(" IW3UNPBF - INPUT FILE ON UNIT ",I0, " IS",
   1656      $      " UNBLOCKED NCEP BUFR"/)', LUNIT
   1657          ELSE  IF(CBUFR(5:8).EQ.'BUFR') THEN
   1658             PRINT'(" IW3UNPBF - INPUT FILE ON UNIT ",I0, " IS",
   1659      $      " BLOCKED NCEP BUFR"/)', LUNIT
   1660          ELSE
   1661             PRINT'(" ##IW3UNPBF/I02UBF - INPUT FILE ON UNIT ",I0, " IS",
   1662      $      " NOT NCEP BUFR -- IER = 999")', LUNIT
   1663             I02UBF = 999
   1664             GOTO 10
   1665          END IF
   1666          CALL DATELEN(10)
   1667          CALL DUMPBF(LUNIT,JDATE,JDUMP)
   1668          print'(" CENTER DATE (JDATE) = ",5(I0,1X))', jdate
   1669          print'(" DUMP DATE   (JDUMP) = ",5(I0,1X))', jdump
   1670          IF(JDATE(1).LE.0)  then
   1671             PRINT'(" ##IW3UNPBF/I02UBF - CENTER DATE COULD NOT BE ",
   1672      $       "OBTAINED FROM INPUT FILE ON UNIT ",I0," -- IER = 999")',
   1673      $       LUNIT

Page 33          Source Listing                  I02UBF
2017-04-18 11:09                                 iw3unpbf.f

   1674             I02UBF = 999
   1675             GO TO 10
   1676          END IF
   1677          IF(JDATE(1).LT.100)  THEN
   1678 
   1679 C IF 2-DIGIT YEAR RETURNED IN JDATE(1), MUST USE "WINDOWING" TECHNIQUE
   1680 C  TO CREATE A 4-DIGIT YEAR
   1681 
   1682 C IMPORTANT: IF DATELEN(10) IS CALLED, THE DATE HERE SHOULD ALWAYS
   1683 C            CONTAIN A 4-DIGIT YEAR, EVEN IF INPUT FILE IS NOT
   1684 C            Y2K COMPLIANT (BUFRLIB DOES THE WINDOWING HERE)
   1685 
   1686             PRINT'(" ##IW3UNPBF/I02UBF - THE FOLLOWING SHOULD NEVER ",
   1687      $       "HAPPEN!!!!!")'
   1688             PRINT'(" ##IW3UNPBF/I02UBF - 2-DIGIT YEAR IN JDATE(1) ",
   1689      $       "RETURNED FROM DUMPBF (JDATE IS: ",I0,") - USE WINDOWING ",
   1690      $       "TECHNIQUE TO OBTAIN 4-DIGIT YEAR")', JDATE
   1691             IF(JDATE(1).GT.20)  THEN
   1692                JDATE(1) = 1900 + JDATE(1)
   1693             ELSE
   1694                JDATE(1) = 2000 + JDATE(1)
   1695             ENDIF
   1696             PRINT'(" ##IW3UNPBF/I02UBF - CORRECTED JDATE(1) WITH 4-",
   1697      $       "DIGIT YEAR, JDATE NOW IS: ",I0)', JDATE
   1698          ENDIF
   1699          IDSDAX_8 =JDATE(1)*1000000+JDATE(2)*10000+JDATE(3)*100+JDATE(4)
   1700 
   1701          IF(JDUMP(1).LE.0)  THEN
   1702             IDSDMX_8 = 999999999999_8
   1703          ELSE
   1704             IF(JDUMP(1).LT.100)  THEN
   1705 
   1706 C IF 2-DIGIT YEAR RETURNED IN JDUMP(1), MUST USE "WINDOWING" TECHNIQUE
   1707 C  TO CREATE A 4-DIGIT YEAR
   1708 
   1709 C IMPORTANT: IF DATELEN(10) IS CALLED, THE DATE HERE SHOULD ALWAYS
   1710 C            CONTAIN A 4-DIGIT YEAR, EVEN IF INPUT FILE IS NOT
   1711 C            Y2K COMPLIANT (BUFRLIB DOES THE WINDOWING HERE)
   1712 
   1713                PRINT'(" ##IW3UNPBF/I02UBF - THE FOLLOWING SHOULD NEVER",
   1714      $          " HAPPEN!!!!!")'
   1715                PRINT'(" ##IW3UNPBF/I02UBF - 2-DIGIT YEAR IN JDUMP(1) ",
   1716      $          "RETURNED FROM DUMPBF (JDUMP IS: ",I0,") - USE ",
   1717      $          "WINDOWING TECHNIQUE TO OBTAIN 4-DIGIT YEAR")', JDUMP
   1718                IF(JDUMP(1).GT.20)  THEN
   1719                   JDUMP(1) = 1900 + JDUMP(1)
   1720                ELSE
   1721                   JDUMP(1) = 2000 + JDUMP(1)
   1722                ENDIF
   1723                PRINT'(" ##IW3UNPBF/I02UBF - CORRECTED JDUMP(1) WITH 4-",
   1724      $          "DIGIT YEAR, JDUMP NOW IS: ",I0)', JDUMP
   1725             END IF
   1726             JDUMP_8 = JDUMP
   1727             IDSDMX_8 = JDUMP_8(1)*100000000+JDUMP_8(2)*1000000+
   1728      $       JDUMP_8(3)*10000+JDUMP_8(4)*100+JDUMP_8(5)
   1729          ENDIF
   1730 

Page 34          Source Listing                  I02UBF
2017-04-18 11:09                                 iw3unpbf.f

   1731          CALL OPENBF(LUNIT,'IN',LUNIT)
   1732 ccccccc  CALL OPENBF(0,'QUIET',1) ! will generate diagnostic print if
   1733 ccccccc                           ! an embedded BUFR table is read
   1734 
   1735 C This next call, I believe, is needed only because SUBSET is not
   1736 C  returned in DUMPBF ...
   1737          call readmg(lunit,subset,idateb,iret)
   1738 
   1739          DSNAMX = C01UBF(SUBSET)//'  '
   1740 
   1741          I02UBF = 1
   1742          GO TO 10
   1743    11    CONTINUE
   1744          PRINT'(" ##IW3UNPBF/I02UBF - INPUT FILE ON UNIT ",I0," IS ",
   1745      $    "EMPTY (NULL) -- ALL DONE WITH THIS FILE (IER = 3)")', LUNIT
   1746          GO TO 10
   1747    12    CONTINUE
   1748          PRINT'(" ##IW3UNPBF/I02UBF - ERROR READING INPUT FILE ON UNIT",
   1749      $    1X,I0," -- IER = 999")', LUNIT
   1750          I02UBF = 999
   1751    10    CONTINUE
   1752          IER = I02UBF
   1753          RETURN
   1754 
   1755       ELSE IF(IL.LT.0) THEN
   1756  
   1757 C  IF THE FILE IS ALREADY OPENED FOR INPUT TRY TO READ THE NEXT SUBSET
   1758 C  -------------------------------------------------------------------
   1759  
   1760  7822    CONTINUE
   1761 
   1762 C  READ THE NEXT SUBSET IN THE BUFR FILE
   1763 C  -------------------------------------
   1764 
   1765     1    CONTINUE
   1766          CALL READSB(LUNIT,IRET)
   1767          IF(IRET.NE.0)  THEN
   1768    30       CONTINUE
   1769             CALL READMG(LUNIT,SUBSET,idateb,IRET)
   1770             IF(IRET.NE.0)  GO TO 20
   1771             ISUB = NMSUB(LUNIT)
   1772             READ(SUBSET(3:5),'(I3)') IINDEX
   1773             READ(SUBSET(6:8),'(I3)') JINDEX
   1774             IF(IINDEX.LE.255 .AND. JINDEX.LE.200) THEN
   1775                IF(SUBSKP(IINDEX,JINDEX))  THEN
   1776                   IF(ISUB.GT.0.AND.NPRINT(IINDEX,JINDEX).EQ.0)  THEN
   1777 
   1778 C  There may be messages with no reports present (e.g., the center time
   1779 C   and dump time messages which may be present even if no reports are
   1780 C   present in subsequent messages), so key on the FIRST message of
   1781 C   this type/subtype with reports present for the diagnostic print
   1782 
   1783                      PRINT 1234, SUBSET
   1784  1234 FORMAT(/'IW3UNPBF/I02UBF - BUFR MESSAGE WITH TABLE ENTRY "',A8,
   1785      $ '" (AND CONTAINING SUBSETS) READ - ALL MESSAGES WITH THIS BUFR ',
   1786      $ 'TYPE/SUBTYPE'/20X,'ARE SKIPPED AS DIRECTED BY CALLING PROGRAM'/)
   1787                   NPRINT(IINDEX,JINDEX) = 1

Page 35          Source Listing                  I02UBF
2017-04-18 11:09                                 iw3unpbf.f

   1788                   END IF
   1789                   GO TO 30
   1790                END IF
   1791             END IF
   1792             GO TO 1
   1793          END IF
   1794    20    CONTINUE
   1795          IF(IRET.EQ.0) I02UBF = R01UBF(SUBSET,LUNIT,OBS,OBS2,OBS3,NOBS3,
   1796      $    obs8_8)
   1797          IF(IRET.NE.0) I02UBF = 2
   1798          IF(I02UBF.EQ.-9999)  GO TO 7822
   1799          IER = I02UBF
   1800          RETURN
   1801       END IF
   1802  
   1803 C  FILE MUST BE OPEN FOR INPUT!
   1804 C  ----------------------------
   1805  
   1806       PRINT'(" ##IW3UNPBF/I02UBF - FILE ON UNIT ",I0," IS OPENED FOR ",
   1807      4 "OUTPUT -- IER = 999")', LUNIT
   1808       I02UBF = 999
   1809       IER = 999
   1810       RETURN
   1811  
   1812       END


ENTRY POINTS

  Name               
                     
 i02ubf_             

Page 36          Source Listing                  I02UBF
2017-04-18 11:09 Symbol Table                    iw3unpbf.f



SYMBOL CROSS REFERENCE

 Name                       Object Declared Type            Bytes Dimen Elements Attributes       References                        
                                                                                                                                    
 1                          Label  1765                                                           1792                              
 10                         Label  1751                                                           1664,1675,1742,1746               
 11                         Label  1743                                                           1653                              
 12                         Label  1747                                                           1653                              
 1234                       Label  1784                                                           1783                              
 20                         Label  1794                                                           1770                              
 30                         Label  1768                                                           1789                              
 7822                       Label  1760                                                           1798                              
 C01UBF                     Func   1630     CHAR            6           scalar                    1739                              
 CBUFR                      Local  1629     CHAR            8           scalar   SAVE             1653,1654,1657                    
 DATELEN                    Subr   1666                                                           1666                              
 DSNAMX                     Scalar 1625     CHAR            8           scalar   COM              1739                              
 DUMPBF                     Subr   1667                                                           1667                              
 I02UBF                     Func   1620     I(4)            4           scalar                    1651,1663,1674,1741,1750,1752,1795
                                                                                                  ,1797,1798,1799,1808              
 I02UBF@0                   Local  1620     I(4)            4           scalar   SAVE                                               
 IDATEB                     Scalar 1627     I(4)            4           scalar   COM              1737,1769                         
 IDSDAX_8                   Scalar 1625     I(8)            8           scalar   COM              1699                              
 IDSDMX_8                   Scalar 1625     I(8)            8           scalar   COM              1702,1727                         
 IER                        Dummy  1620     I(4)            4           scalar   ARG,INOUT        1752,1799,1809                    
 IINDEX                     Local  1772     I(4)            4           scalar   SAVE             1772,1774,1775,1776,1787          
 IL                         Local  1642     I(4)            4           scalar   SAVE             1642,1644,1755                    
 IM                         Local  1642     I(4)            4           scalar   SAVE             1642                              
 IRET                       Local  1650     I(4)            4           scalar   SAVE             1650,1737,1766,1767,1769,1770,1795
                                                                                                  ,1797                             
 ISUB                       Local  1771     I(4)            4           scalar   SAVE             1771,1776                         
 IUBFCC                     Common 1624                                 8        SAVE                                               
 IUBFOO                     Common 1625                                 24       SAVE                                               
 IUBFQQ                     Common 1626                                 205824   SAVE                                               
 IUBFRR                     Common 1627                                 4        SAVE                                               
 JDATE                      Local  1631     I(4)            4     1     5        SAVE             1639,1667,1668,1670,1677,1690,1691
                                                                                                  ,1692,1694,1697,1699              
 JDUMP                      Local  1632     I(4)            4     1     5        SAVE             1640,1667,1669,1701,1704,1717,1718
                                                                                                  ,1719,1721,1724,1726              
 JDUMP_8                    Local  1634     I(8)            8     1     5        SAVE             1726,1727,1728                    
 JINDEX                     Local  1773     I(4)            4           scalar   SAVE             1773,1774,1775,1776,1787          
 LUN                        Local  1642     I(4)            4           scalar   SAVE             1642                              
 LUNIT                      Dummy  1620     I(4)            4           scalar   ARG,INOUT        1642,1652,1653,1656,1659,1662,1667
                                                                                                  ,1673,1731,1737,1745,1749,1766,176
                                                                                                  9,1771,1795,1807                  
 MAXOBS                     Param  1622     I(4)            4           scalar                    1631                              
 NMSUB                      Func   1771     I(4)            4           scalar                    1771                              
 NOBS3                      Dummy  1620     I(4)            4     1     7        ARG,INOUT        1795                              
 NPRINT                     Scalar 1626     I(4)            4     2     51456    COM              1776,1787                         
 OBS                        Dummy  1620     R(4)            4     1     3500     ARG,INOUT        1795                              
 OBS2                       Dummy  1620     R(4)            4     1     43       ARG,INOUT        1795                              
 OBS3                       Dummy  1620     R(4)            4     3     8925     ARG,INOUT        1795                              
 OBS8_8                     Dummy  1620     R(8)            8     1     2        ARG,INOUT        1796                              
 OPENBF                     Subr   1731                                                           1731                              
 R01UBF                     Func   1795     R(4)            4           scalar                    1795                              
 READMG                     Subr   1737                                                           1737,1769                         

Page 37          Source Listing                  I02UBF
2017-04-18 11:09 Symbol Table                    iw3unpbf.f

 Name                       Object Declared Type            Bytes Dimen Elements Attributes       References                        
                                                                                                                                    
 READSB                     Subr   1766                                                           1766                              
 STATUS                     Subr   1642                                                           1642                              
 SUBSET                     Scalar 1624     CHAR            8           scalar   COM              1737,1739,1769,1772,1773,1783,1795
 SUBSKP                     Dummy  1620     L(4)            4     2     51456    ARG,INOUT        1775                              

Page 38          Source Listing                  I02UBF
2017-04-18 11:09                                 iw3unpbf.f

   1813 C***********************************************************************
   1814 C***********************************************************************
   1815 C***********************************************************************
   1816       FUNCTION C01UBF(SUBSET)
   1817  
   1818       CHARACTER*(*) SUBSET
   1819       CHARACTER*6   C01UBF
   1820  
   1821       SAVE
   1822  
   1823       C01UBF = 'NONE'
   1824  
   1825       IF(SUBSET(1:5).EQ.'NC000')  THEN
   1826          C01UBF = 'ADPSFC'
   1827       ELSE  IF(SUBSET(1:5).EQ.'NC001')  THEN
   1828          IF(SUBSET(6:8).NE.'006')  THEN
   1829             C01UBF = 'SFCSHP'
   1830          ELSE
   1831             C01UBF = 'SFCBOG'
   1832          END IF
   1833       ELSE  IF(SUBSET(1:5).EQ.'NC002')  THEN
   1834          C01UBF = 'ADPUPA'
   1835       ELSE  IF(SUBSET(1:5).EQ.'NC004')  THEN
   1836          IF(SUBSET(6:8).EQ.'004' .OR. SUBSET(6:8).EQ.'007')  THEN
   1837             C01UBF = 'AIRCAR'
   1838          ELSE  IF(SUBSET(6:8).EQ.'005')  THEN
   1839             C01UBF = 'ADPUPA'
   1840          ELSE
   1841             C01UBF = 'AIRCFT'
   1842          END IF
   1843       ELSE  IF(SUBSET(1:5).EQ.'NC005')  THEN
   1844          C01UBF = 'SATWND'
   1845       ELSE  IF(SUBSET(1:5).EQ.'NC012')  THEN
   1846          C01UBF = 'SPSSMI'
   1847       ELSE IF(SUBSET(1:5).EQ.'NC255')  THEN
   1848          C01UBF = 'MSONET'
   1849       END IF
   1850  
   1851       IF(C01UBF.EQ.'NONE') PRINT'(" ##IW3UNPBF/C01UBF - UNKNOWN SUBSET",
   1852      $ "(=",A,") -- CONTINUE~~")', SUBSET
   1853  
   1854       RETURN
   1855       END

Page 39          Source Listing                  C01UBF
2017-04-18 11:09 Entry Points                    iw3unpbf.f



ENTRY POINTS

  Name               
                     
 c01ubf_             


SYMBOL CROSS REFERENCE

 Name                       Object Declared Type            Bytes Dimen Elements Attributes       References                        
                                                                                                                                    
 C01UBF                     Func   1816     CHAR            6           scalar                    1823,1826,1829,1831,1834,1837,1839
                                                                                                  ,1841,1844,1846,1848,1851         
 C01UBF@0                   Local  1816     CHAR            6           scalar   SAVE                                               
 SUBSET                     Dummy  1816     CHAR                        scalar   ARG,INOUT        1825,1827,1828,1833,1835,1836,1838
                                                                                                  ,1843,1845,1847,1852              

Page 40          Source Listing                  C01UBF
2017-04-18 11:09                                 iw3unpbf.f

   1856 C***********************************************************************
   1857 C***********************************************************************
   1858 C***********************************************************************
   1859       FUNCTION R01UBF(SUBSET,LUNIT,OBS,OBS2,OBS3,NOBS3,obs8_8)
   1860  
   1861       CHARACTER*(*) SUBSET
   1862       CHARACTER*6   C01UBF,ADPSUB
   1863       DIMENSION     OBS(*),OBS2(43),OBS3(5,255,7),NOBS3(7)
   1864       real*8        obs8_8(2)
   1865 
   1866       SAVE
   1867  
   1868 C  FIND SPECIFIED UNPACKED DATA TYPE AND CALL A TRANSLATOR
   1869 C  -------------------------------------------------------
   1870  
   1871       R01UBF = 4
   1872       ADPSUB = C01UBF(SUBSET)
   1873       IF(ADPSUB .EQ. 'ADPUPA')  THEN
   1874          R01UBF = R03UBF(LUNIT,OBS,OBS2,OBS3,NOBS3,obs8_8)
   1875       ELSE  IF(ADPSUB(1:3).EQ.'AIR')  THEN
   1876          R01UBF = R05UBF(LUNIT,OBS,OBS2,OBS3,NOBS3,obs8_8)
   1877       ELSE  IF(ADPSUB .EQ. 'SATWND')  THEN
   1878          R01UBF = R06UBF(LUNIT,OBS,OBS2,OBS3,NOBS3,obs8_8)
   1879       ELSE  IF(ADPSUB .EQ. 'SPSSMI')  THEN
   1880          R01UBF = R07UBF(LUNIT,OBS,OBS2,OBS3,NOBS3,obs8_8)
   1881       ELSE
   1882          R01UBF = R04UBF(LUNIT,OBS,OBS2,OBS3,NOBS3,obs8_8)
   1883       END IF
   1884 
   1885       RETURN
   1886       END

Page 41          Source Listing                  R01UBF
2017-04-18 11:09 Entry Points                    iw3unpbf.f



ENTRY POINTS

  Name               
                     
 r01ubf_             


SYMBOL CROSS REFERENCE

 Name                       Object Declared Type            Bytes Dimen Elements Attributes       References                        
                                                                                                                                    
 ADPSUB                     Local  1862     CHAR            6           scalar   SAVE             1872,1873,1875,1877,1879          
 C01UBF                     Func   1862     CHAR            6           scalar                    1872                              
 LUNIT                      Dummy  1859     I(4)            4           scalar   ARG,INOUT        1874,1876,1878,1880,1882          
 NOBS3                      Dummy  1859     I(4)            4     1     7        ARG,INOUT        1874,1876,1878,1880,1882          
 OBS                        Dummy  1859     R(4)            4     1     0        ARG,INOUT        1874,1876,1878,1880,1882          
 OBS2                       Dummy  1859     R(4)            4     1     43       ARG,INOUT        1874,1876,1878,1880,1882          
 OBS3                       Dummy  1859     R(4)            4     3     8925     ARG,INOUT        1874,1876,1878,1880,1882          
 OBS8_8                     Dummy  1859     R(8)            8     1     2        ARG,INOUT        1874,1876,1878,1880,1882          
 R01UBF                     Func   1859     R(4)            4           scalar                    1871,1874,1876,1878,1880,1882     
 R01UBF@0                   Local  1859     R(4)            4           scalar   SAVE                                               
 R03UBF                     Func   1874     R(4)            4           scalar                    1874                              
 R04UBF                     Func   1882     R(4)            4           scalar                    1882                              
 R05UBF                     Func   1876     R(4)            4           scalar                    1876                              
 R06UBF                     Func   1878     R(4)            4           scalar                    1878                              
 R07UBF                     Func   1880     R(4)            4           scalar                    1880                              
 SUBSET                     Dummy  1859     CHAR                        scalar   ARG,INOUT        1872                              

Page 42          Source Listing                  R01UBF
2017-04-18 11:09                                 iw3unpbf.f

   1887 C***********************************************************************
   1888 C***********************************************************************
   1889 C***********************************************************************
   1890       SUBROUTINE S01UBF(SID,XOB,YOB,RHR,RCTIM,RSV1,RSV2,ELV,QMELV,ITP,
   1891      $ RTP,RSTP,IDS)
   1892 C     ---> PROCESSES HEADER
   1893  
   1894       PARAMETER (NUMCAT=8, LEVLIM=300)
   1895 
   1896       COMMON/IUBFAA/BMISS
   1897       COMMON/IUBFDD/HDR(12),RCATS(50,LEVLIM,NUMCAT),IKAT(NUMCAT),
   1898      $ MCAT(NUMCAT),NCAT(NUMCAT),LVDX(NUMCAT)
   1899       COMMON/IUBFNN/STNIDX,CRES1X,CRES2X
   1900  
   1901       CHARACTER*(*) RSV1,RSV2
   1902       CHARACTER*8   SID,STNIDX,CRES1X,CRES2X
   1903       REAL(8)       BMISS
   1904       DIMENSION     IHDR(12),RHDR(12)
   1905       EQUIVALENCE   (IHDR(1),RHDR(1))
   1906 
   1907       SAVE
   1908  
   1909       DATA XMISS/99999./,IMISS/99999/
   1910  
   1911 C  INITIALIZE THE UNPACK ARRAY TO MISSINGS
   1912 C  ---------------------------------------
   1913  
   1914 C  NCAT will hold the number of unpacked levels in each category
   1915       NCAT = 0
   1916       RCATS = IMISS
   1917  
   1918 C  STORE THE UNPACKED HEADER INFORMATION INTO UNP FORMAT
   1919 C  -----------------------------------------------------
   1920  
   1921       RHDR( 1) = MIN(YOB,XMISS)
   1922       IF(YOB.GE.BMISS)  print'(" ~~IW3UNPBF/S01UBF: ID ",A," has a ",
   1923      $ "missing LATITUDE - unpked hdr, word 1 is set to ",G0)',
   1924      $ sid,RHDR(1)
   1925 
   1926 C Important: According to BUFR Manual, CLON (0-06-002) - represented
   1927 C  here by "XOB" - should be in units of Degrees West - and East +
   1928 C  (-180.0 to +180.0); however some BUFR data sets (e.g., PREPBUFR) are
   1929 C  known to encode CLON in units of Degree East (0.0 to 359.99) -- So
   1930 C  we use the following conversion to work in either case ...
   1931       RHDR( 2) = XMISS
   1932       IF(XOB.LT.BMISS)  RHDR( 2) = 360. - MOD(720.-XOB,360.)
   1933       IF(RHDR(2).EQ.360.0)  RHDR(2) = 0.0
   1934       IF(XOB.GE.BMISS)  print'(" ~~IW3UNPBF/S01UBF: ID ",A," has a ",
   1935      $ "missing LONGITUDE - unpked hdr, word 2 is set to ",G0)',
   1936      $ sid,RHDR(2)
   1937       RHDR( 3) = XMISS
   1938       RHDR( 4) = MIN(RHR,XMISS)
   1939       IF(RHR.GE.BMISS)  print'(" ~~IW3UNPBF/S01UBF: ID ",A," has a ",
   1940      $ "missing OB TIME - unpked hdr, word 4 is set to ",G0)',
   1941      $ sid,RHDR(4)
   1942       RHDR( 5) = XMISS
   1943       IHDR( 6) = IDS

Page 43          Source Listing                  S01UBF
2017-04-18 11:09                                 iw3unpbf.f

   1944 cdak  RHDR( 7) = NINT(ELV)
   1945       RHDR( 7) = MIN(NINT(ELV),IMISS)
   1946       IHDR( 8) = ITP
   1947       IHDR( 9) = RTP
   1948       IHDR(10) = RSTP
   1949       RHDR(11) = XMISS
   1950       IF(RCTIM.LT.24.01.AND.RCTIM.GT.-.01)  RHDR(11) = RCTIM
   1951       RHDR(12) = QMELV
   1952       STNIDX = SID
   1953       CRES1X = RSV1
   1954       CRES2X = RSV2
   1955  
   1956 C  STORE THE HEADER INTO A HOLDING ARRAY
   1957 C  -------------------------------------
   1958  
   1959       HDR = RHDR
   1960  
   1961       RETURN
   1962       END


ENTRY POINTS

  Name               
                     
 s01ubf_             


SYMBOL CROSS REFERENCE

 Name                       Object Declared Type            Bytes Dimen Elements Attributes       References                        
                                                                                                                                    
 BMISS                      Scalar 1896     R(8)            8           scalar   COM              1922,1932,1934,1939               
 CRES1X                     Scalar 1899     CHAR            8           scalar   COM              1953                              
 CRES2X                     Scalar 1899     CHAR            8           scalar   COM              1954                              
 ELV                        Dummy  1890     R(4)            4           scalar   ARG,INOUT        1945                              
 HDR                        Scalar 1897     R(4)            4     1     12       COM              1959                              
 IDS                        Dummy  1891     I(4)            4           scalar   ARG,INOUT        1943                              
 IHDR                       Local  1904     I(4)            4     1     12       SAVE             1943,1946,1947,1948               
 IKAT                       Scalar 1897     I(4)            4     1     8        COM                                                
 IMISS                      Local  1909     I(4)            4           scalar   SAVE             1909,1916,1945                    
 ITP                        Dummy  1890     I(4)            4           scalar   ARG,INOUT        1946                              
 IUBFAA                     Common 1896                                 8        SAVE                                               
 IUBFDD                     Common 1897                                 480176   SAVE                                               
 IUBFNN                     Common 1899                                 24       SAVE                                               
 LEVLIM                     Param  1894     I(4)            4           scalar                    1897                              
 LVDX                       Scalar 1898     I(4)            4     1     8        COM                                                
 MCAT                       Scalar 1898     I(4)            4     1     8        COM                                                
 MIN                        Func   1921                                 scalar                    1921,1938,1945                    
 MOD                        Func   1932                                 scalar                    1932                              
 NCAT                       Scalar 1898     I(4)            4     1     8        COM              1915                              
 NINT                       Func   1945                                 scalar                    1945                              
 NUMCAT                     Param  1894     I(4)            4           scalar                    1897,1898                         
 QMELV                      Dummy  1890     R(4)            4           scalar   ARG,INOUT        1951                              
 RCATS                      Scalar 1897     R(4)            4     3     120000   COM              1916                              
 RCTIM                      Dummy  1890     R(4)            4           scalar   ARG,INOUT        1950                              
 RHDR                       Local  1904     R(4)            4     1     12       SAVE             1921,1924,1931,1932,1933,1936,1937

Page 44          Source Listing                  S01UBF
2017-04-18 11:09 Symbol Table                    iw3unpbf.f

 Name                       Object Declared Type            Bytes Dimen Elements Attributes       References                        
                                                                                                                                    
                                                                                                  ,1938,1941,1942,1945,1949,1950,195
                                                                                                  1,1959                            
 RHR                        Dummy  1890     R(4)            4           scalar   ARG,INOUT        1938,1939                         
 RSTP                       Dummy  1891     R(4)            4           scalar   ARG,INOUT        1948                              
 RSV1                       Dummy  1890     CHAR                        scalar   ARG,INOUT        1953                              
 RSV2                       Dummy  1890     CHAR                        scalar   ARG,INOUT        1954                              
 RTP                        Dummy  1891     R(4)            4           scalar   ARG,INOUT        1947                              
 S01UBF                     Subr   1890                                                                                             
 SID                        Dummy  1890     CHAR            8           scalar   ARG,INOUT        1924,1936,1941,1952               
 STNIDX                     Scalar 1899     CHAR            8           scalar   COM              1952                              
 XMISS                      Local  1909     R(4)            4           scalar   SAVE             1909,1921,1931,1937,1938,1942,1949
 XOB                        Dummy  1890     R(4)            4           scalar   ARG,INOUT        1932,1934                         
 YOB                        Dummy  1890     R(4)            4           scalar   ARG,INOUT        1921,1922                         

Page 45          Source Listing                  S01UBF
2017-04-18 11:09                                 iw3unpbf.f

   1963 C***********************************************************************
   1964 C***********************************************************************
   1965 C***********************************************************************
   1966       SUBROUTINE S02UBF(ICAT,N,*)
   1967 C     ---> PROCESSES DATA LEVEL CATEGORIES
   1968 
   1969       PARAMETER (NUMCAT=8, LEVLIM=300)
   1970 
   1971 C      Input argument ICAT - the category number (1,2,3,4,5,6,8,51)
   1972 C      Input argument N - level indicator (unless = 0, then signals
   1973 C                         subr. to write an empty cat. 2,3, or 4 level
   1974  
   1975       COMMON/IUBFDD/HDR(12),RCATS(50,LEVLIM,NUMCAT),IKAT(NUMCAT),
   1976      $ MCAT(NUMCAT),NCAT(NUMCAT),LVDX(NUMCAT)
   1977       COMMON/IUBFEE/POB(255),QOB(255),TOB(255),ZOB(255),DOB(255),
   1978      $              SOB(255),VSG(255),OB8(255),CF8(255)
   1979       COMMON/IUBFFF/PQM(255),QQM(255),TQM(255),ZQM(255),WQM(255)
   1980       COMMON/IUBFGG/PSL,STP,SDR,SSP,STM,DPD
   1981       COMMON/IUBFHH/PSQ,SPQ,SWQ,STQ,DDQ
   1982       COMMON/IUBFII/PWMIN
   1983       COMMON/IUBFLL/Q81(255),Q82(255)
   1984       COMMON/IUBFMM/XIND(255)
   1985       COMMON/IUBFNN/STNIDX,CRES1X,CRES2X
   1986 
   1987       CHARACTER*8 STNIDX,CRES1X,CRES2X
   1988       DIMENSION   RCAT(50),JCAT(50)
   1989       EQUIVALENCE (RCAT(1),JCAT(1))
   1990       LOGICAL     SURF
   1991 
   1992       SAVE
   1993  
   1994       DATA XMISS/99999./,IMISS/99999/
   1995  
   1996 cppppp-ID
   1997       iprint = 0
   1998 cc         iprint = 1
   1999 
   2000 c     if(stnidx.eq.'89571   ')  iprint = 1
   2001 c     if(stnidx.eq.'68906   ')  iprint = 1
   2002 c     if(stnidx.eq.'68842   ')  iprint = 1
   2003 c     if(stnidx.eq.'74794   ')  iprint = 1
   2004 c     if(stnidx.eq.'74389   ')  iprint = 1
   2005 c     if(stnidx.eq.'96801A  ')  iprint = 1
   2006 cppppp-ID
   2007 
   2008       SURF = .FALSE.
   2009       GOTO 1
   2010 
   2011 C  ENTRY POINT SE01UBF FORCES DATA INTO THE SURFACE (FIRST) LEVEL
   2012 C  --------------------------------------------------------------
   2013 
   2014       ENTRY SE01UBF(ICAT,N)
   2015 C     ---> PROCESSES DATA INTO SURFACE LEVEL
   2016       SURF = .TRUE.
   2017  
   2018 C  CHECK THE PARAMETERS COMING IN (KCAT IS INDEX IN IKAT, MCAT, NCAT
   2019 C   FOR A PARTICULAR CATEGORY)

Page 46          Source Listing                  S02UBF
2017-04-18 11:09                                 iw3unpbf.f

   2020 C  -----------------------------------------------------------------
   2021  
   2022 1     KCAT = 0
   2023       DO I = 1,NUMCAT
   2024          IF(ICAT.EQ.IKAT(I))  THEN
   2025             KCAT = I
   2026             EXIT
   2027          END IF
   2028       ENDDO
   2029 
   2030 C  PARAMETER ICAT (UNPACKED DATA LEVEL CATEGORY) OUT OF BOUNDS
   2031 C   RETURNS A 999
   2032 C  --------------------------------------------------------------
   2033 
   2034       IF(KCAT.EQ.0)  THEN
   2035          PRINT'(" ##IW3UNPBF/S02UBF - UNPACKED CATEGORY ",I0," OUT OF ",
   2036      $    "BOUNDS -- IER = 999")', ICAT
   2037          RETURN 1
   2038       END IF
   2039 
   2040 C  PARAMETER N (LEVEL INDEX) OUT OF BOUNDS RETURNS A 999
   2041 C  -----------------------------------------------------
   2042 
   2043       IF(N.GT.255)  THEN
   2044          PRINT'(" ##IW3UNPBF/S02UBF - LEVEL INDEX ",I0," EXCEEDS 255 ",
   2045      $    "-- IER = 999")', N
   2046          RETURN 1
   2047       END IF
   2048  
   2049 C  MAKE A MISSING LEVEL AND RETURN WHEN N=0 (NOT ALLOWED FOR CAT 01)
   2050 C   (NOTE: QUALITY MARKERS ARE SET TO 2 AND SPECIAL LEVEL INDICATORS
   2051 C          ARE SET TO 0)
   2052 C  -----------------------------------------------------------------
   2053  
   2054       IF(N.EQ.0) THEN
   2055          IF(ICAT.EQ.1) RETURN
   2056          NCAT(KCAT) = MIN(LEVLIM-1,NCAT(KCAT)+1)
   2057          if(iprint.eq.1)  then
   2058             print'(" To prepare for sfc. data, write all missings on ",
   2059      $       "lvl ",I0," for cat ",i0)', ncat(kcat),icat
   2060             print'("   also write default =2 for all q. markers")'
   2061             print'("   also write default =0 for special lvl ",
   2062      $       "indicators")'
   2063          end if
   2064          IF(ICAT.EQ.2)  THEN
   2065             RCATS(4:6,NCAT(KCAT),KCAT) = 2.
   2066             RCATS(7,NCAT(KCAT),KCAT)   = 0
   2067          ELSE  IF(ICAT.EQ.3)  THEN
   2068             RCATS(4:5,NCAT(KCAT),KCAT) = 2.
   2069             RCATS(6,NCAT(KCAT),KCAT)   = 0
   2070          ELSE  IF(ICAT.EQ.4)  THEN
   2071             RCATS(4:5,NCAT(KCAT),KCAT) = 2.
   2072          END IF
   2073          RETURN
   2074       END IF
   2075  
   2076 C  FIGURE OUT WHICH LEVEL TO UPDATE AND RESET THE LEVEL COUNTER

Page 47          Source Listing                  S02UBF
2017-04-18 11:09                                 iw3unpbf.f

   2077 C  ------------------------------------------------------------
   2078  
   2079       IF(ICAT.EQ.1) THEN
   2080          L = I04UBF(POB(N)*.1)
   2081 
   2082 C  MANDATORY LEVEL WITH NON-MANDATORY PRESSURE RETURNS A 999
   2083 C  ---------------------------------------------------------
   2084 
   2085          IF(L.LE.0)  THEN
   2086             PRINT'(" ##IW3UNPBF/S02UBF - MANDATORY LEVEL WITH NON-",
   2087      $       "MANDATORY PRESSURE (P = ",G0,"mb) -- IER = 999")',
   2088      $       POB(N)*.1
   2089             RETURN 1
   2090          END IF
   2091          NCAT(KCAT) = MAX(NCAT(KCAT),L)
   2092          if(iprint.eq.1)
   2093      $    print'(" Will write cat. 1 data on lvl ",I0," for cat ",I0,
   2094      $    ", - total no. cat. 1 lvls processed so far = ",I0)',
   2095      $    L,icat,ncat(kcat)
   2096       ELSEIF(SURF) THEN
   2097          L = 1
   2098          NCAT(KCAT) = MAX(NCAT(KCAT),1)
   2099          if(iprint.eq.1)
   2100      $    print'(" Will write cat. ",I0," SURFACE data on lvl ",I0,
   2101      $    ", - total no. cat. ",I0," lvls processed so far = ",I0)',
   2102      $    icat,L,icat,ncat(kcat)
   2103       ELSE
   2104          L = MIN(LEVLIM-1,NCAT(KCAT)+1)
   2105          IF(L.EQ.LEVLIM-1) THEN
   2106             print'(" ~~IW3UNPBF/S02UBF: ID ",A," - This cat. ",I0,
   2107      $       ", level cannot be processed because the limit of ",I0,
   2108      $       " has already been reached")', stnidx,icat,LEVLIM
   2109             RETURN
   2110          END IF
   2111          NCAT(KCAT) = L
   2112          if(iprint.eq.1)
   2113      $    print'(" Will write cat. ",I0," NON-SFC data on lvl ",I0,
   2114      $    ", - total no. cat. ",I0," lvls processed so far = ",I0)',
   2115      $    icat,L,icat,ncat(kcat)
   2116       END IF
   2117  
   2118 C  EACH DATA LEVEL CATEGORY NEEDS A SPECIFIC DATA ARRANGEMENT
   2119 C  ----------------------------------------------------------
   2120  
   2121       IF(ICAT.EQ.1) THEN
   2122          RCAT(1)  = MIN(NINT(POB(N)),NINT(RCATS( 1,L,KCAT)))
   2123          RCAT(2)  = MIN(NINT(ZOB(N)),NINT(RCATS( 2,L,KCAT)))
   2124          RCAT(3)  = MIN(NINT(TOB(N)),NINT(RCATS( 3,L,KCAT)))
   2125          RCAT(4)  = MIN(NINT(QOB(N)),NINT(RCATS( 4,L,KCAT)))
   2126          RCAT(5)  = MIN(NINT(DOB(N)),NINT(RCATS( 5,L,KCAT)))
   2127          RCAT(6)  = MIN(NINT(SOB(N)),NINT(RCATS( 6,L,KCAT)))
   2128          IF(RCATS(7,L,KCAT).LT.IMISS)  THEN
   2129             RCAT(7)  = MAX(NINT(PQM(N)),NINT(RCATS( 7,L,KCAT)))
   2130          ELSE
   2131             RCAT(7)  = NINT(PQM(N))
   2132          END IF
   2133          IF(RCATS(8,L,KCAT).LT.IMISS)  THEN

Page 48          Source Listing                  S02UBF
2017-04-18 11:09                                 iw3unpbf.f

   2134             RCAT(8)  = MAX(NINT(ZQM(N)),NINT(RCATS( 8,L,KCAT)))
   2135          ELSE
   2136             RCAT(8)  = NINT(ZQM(N))
   2137          END IF
   2138          IF(RCATS(9,L,KCAT).LT.IMISS)  THEN
   2139             RCAT(9)  = MAX(NINT(TQM(N)),NINT(RCATS( 9,L,KCAT)))
   2140          ELSE
   2141             RCAT(9)  = NINT(TQM(N))
   2142          END IF
   2143          IF(RCATS(10,L,KCAT).LT.IMISS)  THEN
   2144             RCAT(10) = MAX(NINT(QQM(N)),NINT(RCATS(10,L,KCAT)))
   2145          ELSE
   2146             RCAT(10) = NINT(QQM(N))
   2147          END IF
   2148          IF(RCATS(11,L,KCAT).LT.IMISS)  THEN
   2149             RCAT(11) = MAX(NINT(WQM(N)),NINT(RCATS(11,L,KCAT)))
   2150          ELSE
   2151             RCAT(11) = NINT(WQM(N))
   2152          END IF
   2153       ELSEIF(ICAT.EQ.2) THEN
   2154          RCAT(1) = MIN(NINT(POB(N)),IMISS)
   2155          RCAT(2) = MIN(NINT(TOB(N)),IMISS)
   2156          RCAT(3) = MIN(NINT(QOB(N)),IMISS)
   2157          RCAT(4) = NINT(PQM(N))
   2158          RCAT(5) = NINT(TQM(N))
   2159          RCAT(6) = NINT(QQM(N))
   2160          RCAT(7) = NINT(XIND(N))
   2161       ELSEIF(ICAT.EQ.3) THEN
   2162          RCAT(1) = MIN(NINT(POB(N)),IMISS)
   2163          RCAT(2) = MIN(NINT(DOB(N)),IMISS)
   2164          RCAT(3) = MIN(NINT(SOB(N)),IMISS)
   2165          RCAT(4) = NINT(PQM(N))
   2166          RCAT(5) = NINT(WQM(N))
   2167          IF(NINT(VSG(N)).EQ. 8)  THEN
   2168 
   2169 C  MARK THE MAXIMUM WIND LEVEL IN DATA LEVEL CATEGORY 3
   2170 
   2171             XIND(N) = 2
   2172             IF(NINT(POB(N)).EQ.NINT(PWMIN))  XIND(N) = 3
   2173          END IF
   2174          RCAT(6) = NINT(XIND(N))
   2175       ELSEIF(ICAT.EQ.4) THEN
   2176          RCAT(1) = MIN(NINT(ZOB(N)),IMISS)
   2177          RCAT(2) = MIN(NINT(DOB(N)),IMISS)
   2178          RCAT(3) = MIN(NINT(SOB(N)),IMISS)
   2179          RCAT(4) = NINT(ZQM(N))
   2180          RCAT(5) = NINT(WQM(N))
   2181       ELSEIF(ICAT.EQ.5) THEN
   2182          RCAT(1) = MIN(NINT(POB(N)),IMISS)
   2183          RCAT(2) = MIN(NINT(TOB(N)),IMISS)
   2184          RCAT(3) = MIN(NINT(QOB(N)),IMISS)
   2185          RCAT(4) = MIN(NINT(DOB(N)),IMISS)
   2186          RCAT(5) = MIN(NINT(SOB(N)),IMISS)
   2187          RCAT(6) = NINT(PQM(N))
   2188          RCAT(7) = NINT(TQM(N))
   2189          RCAT(8) = NINT(QQM(N))
   2190          RCAT(9) = NINT(WQM(N))

Page 49          Source Listing                  S02UBF
2017-04-18 11:09                                 iw3unpbf.f

   2191       ELSEIF(ICAT.EQ.6) THEN
   2192          RCAT(1)  = MIN(NINT(POB(N)),IMISS)
   2193          RCAT(2)  = MIN(NINT(ZOB(N)),IMISS)
   2194          RCAT(3)  = MIN(NINT(TOB(N)),IMISS)
   2195          RCAT(4)  = MIN(QOB(N),XMISS)
   2196          RCAT(5)  = MIN(NINT(DOB(N)),IMISS)
   2197          RCAT(6)  = MIN(NINT(SOB(N)),IMISS)
   2198          RCAT(7)  = NINT(PQM(N))
   2199          RCAT(8)  = NINT(ZQM(N))
   2200          RCAT(9)  = NINT(TQM(N))
   2201          RCAT(10) = NINT(QQM(N))
   2202          RCAT(11) = NINT(WQM(N))
   2203       ELSEIF(ICAT.EQ.8) THEN
   2204          RCAT(1) = MIN(OB8(N),XMISS)
   2205 C  Allow report sequence number (code fig. 21) to be as large as 999990
   2206          IF(NINT(CF8(N)).EQ.21) RCAT(1) = MIN(OB8(N),XMISS*10.)
   2207          RCAT(2) = MIN(NINT(CF8(N)),IMISS)
   2208          RCAT(3) = MIN(Q81(N),XMISS)
   2209          RCAT(4) = NINT(Q82(N))
   2210       ELSEIF(ICAT.EQ.51) THEN
   2211          RCAT( 1) = MIN(NINT(PSL),IMISS)
   2212          RCAT( 2) = MIN(NINT(STP),IMISS)
   2213          RCAT( 3) = MIN(NINT(SDR),IMISS)
   2214          RCAT( 4) = MIN(NINT(SSP),IMISS)
   2215          RCAT( 5) = MIN(NINT(STM),IMISS)
   2216          RCAT( 6) = MIN(NINT(DPD),IMISS)
   2217          RCAT( 7) = IMISS ! Reserved
   2218          RCAT( 8) = IMISS ! Reserved
   2219          RCAT( 9) = NINT(PSQ)
   2220          RCAT(10) = NINT(SPQ)
   2221          RCAT(11) = NINT(SWQ)
   2222          RCAT(12) = NINT(STQ)
   2223          RCAT(13) = NINT(DDQ)
   2224       ELSE
   2225 
   2226 C  UNSUPPORTED DATA LEVEL CATEGORY RETURNS A 999
   2227 C  ---------------------------------------------
   2228 
   2229          PRINT'(" ##IW3UNPBF/S02UBF - CATEGORY ",I0," NOT SUPPORTED ",
   2230      $    "-- IER = 999")', ICAT
   2231          RETURN 1
   2232       END IF
   2233  
   2234 C  TRANSFER THE LEVEL DATA INTO THE HOLDING ARRAY AND EXIT
   2235 C  -------------------------------------------------------
   2236  
   2237       RCATS(1:MCAT(KCAT),L,KCAT) = RCAT(1:MCAT(KCAT))
   2238  
   2239       RETURN
   2240       END

Page 50          Source Listing                  S02UBF
2017-04-18 11:09 Entry Points                    iw3unpbf.f



ENTRY POINTS

  Name                   Name                
                                             
 s02ubf_                se01ubf_             


SYMBOL CROSS REFERENCE

 Name                       Object Declared Type            Bytes Dimen Elements Attributes       References                        
                                                                                                                                    
 1                          Label  2022                                                           2009                              
 CF8                        Scalar 1978     R(4)            4     1     255      COM              2206,2207                         
 CRES1X                     Scalar 1985     CHAR            8           scalar   COM                                                
 CRES2X                     Scalar 1985     CHAR            8           scalar   COM                                                
 DDQ                        Scalar 1981     R(4)            4           scalar   COM              2223                              
 DOB                        Scalar 1977     R(4)            4     1     255      COM              2126,2163,2177,2185,2196          
 DPD                        Scalar 1980     R(4)            4           scalar   COM              2216                              
 HDR                        Scalar 1975     R(4)            4     1     12       COM                                                
 I                          Local  2023     I(4)            4           scalar   SAVE             2023,2024,2025                    
 I04UBF                     Func   2080     I(4)            4           scalar                    2080                              
 ICAT                       Dummy  1966     I(4)            4           scalar   ARG,INOUT        2024,2036,2055,2059,2064,2067,2070
                                                                                                  ,2079,2095,2102,2108,2115,2121,215
                                                                                                  3,2161,2175,2181,2191,2203,2210,22
                                                                                                  30                                
 IKAT                       Scalar 1975     I(4)            4     1     8        COM              2024                              
 IMISS                      Local  1994     I(4)            4           scalar   SAVE             1994,2128,2133,2138,2143,2148,2154
                                                                                                  ,2155,2156,2162,2163,2164,2176,217
                                                                                                  7,2178,2182,2183,2184,2185,2186,21
                                                                                                  92,2193,2194,2196,2197,2207,2211,2
                                                                                                  212,2213,2214,2215,2216,2217,2218 
 IPRINT                     Local  1997     I(4)            4           scalar   SAVE             1997,2057,2092,2099,2112          
 IUBFDD                     Common 1975                                 480176   SAVE                                               
 IUBFEE                     Common 1977                                 9180     SAVE                                               
 IUBFFF                     Common 1979                                 5100     SAVE                                               
 IUBFGG                     Common 1980                                 24       SAVE                                               
 IUBFHH                     Common 1981                                 20       SAVE                                               
 IUBFII                     Common 1982                                 4        SAVE                                               
 IUBFLL                     Common 1983                                 2040     SAVE                                               
 IUBFMM                     Common 1984                                 1020     SAVE                                               
 IUBFNN                     Common 1985                                 24       SAVE                                               
 JCAT                       Local  1988     I(4)            4     1     50       SAVE                                               
 KCAT                       Local  2022     I(4)            4           scalar   SAVE             2022,2025,2034,2056,2059,2065,2066
                                                                                                  ,2068,2069,2071,2091,2095,2098,210
                                                                                                  2,2104,2111,2115,2122,2123,2124,21
                                                                                                  25,2126,2127,2128,2129,2133,2134,2
                                                                                                  138,2139,2143,2144,2148,2149,2237 
 L                          Local  2080     I(4)            4           scalar   SAVE             2080,2085,2091,2095,2097,2102,2104
                                                                                                  ,2105,2111,2115,2122,2123,2124,212
                                                                                                  5,2126,2127,2128,2129,2133,2134,21
                                                                                                  38,2139,2143,2144,2148,2149,2237  
 LEVLIM                     Param  1969     I(4)            4           scalar                    1975,2056,2104,2105,2108          
 LVDX                       Scalar 1976     I(4)            4     1     8        COM                                                
 MAX                        Func   2091                                 scalar                    2091,2098,2129,2134,2139,2144,2149
 MCAT                       Scalar 1976     I(4)            4     1     8        COM              2237                              

Page 51          Source Listing                  S02UBF
2017-04-18 11:09 Symbol Table                    iw3unpbf.f

 Name                       Object Declared Type            Bytes Dimen Elements Attributes       References                        
                                                                                                                                    
 MIN                        Func   2056                                 scalar                    2056,2104,2122,2123,2124,2125,2126
                                                                                                  ,2127,2154,2155,2156,2162,2163,216
                                                                                                  4,2176,2177,2178,2182,2183,2184,21
                                                                                                  85,2186,2192,2193,2194,2195,2196,2
                                                                                                  197,2204,2206,2207,2208,2211,2212,
                                                                                                  2213,2214,2215,2216               
 N                          Dummy  1966     I(4)            4           scalar   ARG,INOUT        2043,2045,2054,2080,2088,2122,2123
                                                                                                  ,2124,2125,2126,2127,2129,2131,213
                                                                                                  4,2136,2139,2141,2144,2146,2149,21
                                                                                                  51,2154,2155,2156,2157,2158,2159,2
                                                                                                  160,2162,2163,2164,2165,2166,2167,
                                                                                                  2171,2172,2174,2176,2177,2178,2179
                                                                                                  ,2180,2182,2183,2184,2185,2186,218
                                                                                                  7,2188,2189,2190,2192,2193,2194,21
                                                                                                  95,2196,2197,2198,2199,2200,2201,2
                                                                                                  202,2204,2206,2207,2208,2209      
 NCAT                       Scalar 1976     I(4)            4     1     8        COM              2056,2059,2065,2066,2068,2069,2071
                                                                                                  ,2091,2095,2098,2102,2104,2111,211
                                                                                                  5                                 
 NINT                       Func   2122                                 scalar                    2122,2123,2124,2125,2126,2127,2129
                                                                                                  ,2131,2134,2136,2139,2141,2144,214
                                                                                                  6,2149,2151,2154,2155,2156,2157,21
                                                                                                  58,2159,2160,2162,2163,2164,2165,2
                                                                                                  166,2167,2172,2174,2176,2177,2178,
                                                                                                  2179,2180,2182,2183,2184,2185,2186
                                                                                                  ,2187,2188,2189,2190,2192,2193,219
                                                                                                  4,2196,2197,2198,2199,2200,2201,22
                                                                                                  02,2206,2207,2209,2211,2212,2213,2
                                                                                                  214,2215,2216,2219,2220,2221,2222,
                                                                                                  2223                              
 NUMCAT                     Param  1969     I(4)            4           scalar                    1975,1976,2023                    
 OB8                        Scalar 1978     R(4)            4     1     255      COM              2204,2206                         
 POB                        Scalar 1977     R(4)            4     1     255      COM              2080,2088,2122,2154,2162,2172,2182
                                                                                                  ,2192                             
 PQM                        Scalar 1979     R(4)            4     1     255      COM              2129,2131,2157,2165,2187,2198     
 PSL                        Scalar 1980     R(4)            4           scalar   COM              2211                              
 PSQ                        Scalar 1981     R(4)            4           scalar   COM              2219                              
 PWMIN                      Scalar 1982     R(4)            4           scalar   COM              2172                              
 Q81                        Scalar 1983     R(4)            4     1     255      COM              2208                              
 Q82                        Scalar 1983     R(4)            4     1     255      COM              2209                              
 QOB                        Scalar 1977     R(4)            4     1     255      COM              2125,2156,2184,2195               
 QQM                        Scalar 1979     R(4)            4     1     255      COM              2144,2146,2159,2189,2201          
 RCAT                       Local  1988     R(4)            4     1     50       SAVE             2122,2123,2124,2125,2126,2127,2129
                                                                                                  ,2131,2134,2136,2139,2141,2144,214
                                                                                                  6,2149,2151,2154,2155,2156,2157,21
                                                                                                  58,2159,2160,2162,2163,2164,2165,2
                                                                                                  166,2174,2176,2177,2178,2179,2180,
                                                                                                  2182,2183,2184,2185,2186,2187,2188
                                                                                                  ,2189,2190,2192,2193,2194,2195,219
                                                                                                  6,2197,2198,2199,2200,2201,2202,22
                                                                                                  04,2206,2207,2208,2209,2211,2212,2
                                                                                                  213,2214,2215,2216,2217,2218,2219,
                                                                                                  2220,2221,2222,2223,2237          
 RCATS                      Scalar 1975     R(4)            4     3     120000   COM              2065,2066,2068,2069,2071,2122,2123
                                                                                                  ,2124,2125,2126,2127,2128,2129,213

Page 52          Source Listing                  S02UBF
2017-04-18 11:09 Symbol Table                    iw3unpbf.f

 Name                       Object Declared Type            Bytes Dimen Elements Attributes       References                        
                                                                                                                                    
                                                                                                  3,2134,2138,2139,2143,2144,2148,21
                                                                                                  49,2237                           
 S02UBF                     Subr   1966                                                                                             
 SDR                        Scalar 1980     R(4)            4           scalar   COM              2213                              
 SE01UBF                    Subr   2014                                                                                             
 SOB                        Scalar 1978     R(4)            4     1     255      COM              2127,2164,2178,2186,2197          
 SPQ                        Scalar 1981     R(4)            4           scalar   COM              2220                              
 SSP                        Scalar 1980     R(4)            4           scalar   COM              2214                              
 STM                        Scalar 1980     R(4)            4           scalar   COM              2215                              
 STNIDX                     Scalar 1985     CHAR            8           scalar   COM              2108                              
 STP                        Scalar 1980     R(4)            4           scalar   COM              2212                              
 STQ                        Scalar 1981     R(4)            4           scalar   COM              2222                              
 SURF                       Local  1990     L(4)            4           scalar   SAVE             2008,2016,2096                    
 SWQ                        Scalar 1981     R(4)            4           scalar   COM              2221                              
 TOB                        Scalar 1977     R(4)            4     1     255      COM              2124,2155,2183,2194               
 TQM                        Scalar 1979     R(4)            4     1     255      COM              2139,2141,2158,2188,2200          
 VSG                        Scalar 1978     R(4)            4     1     255      COM              2167                              
 WQM                        Scalar 1979     R(4)            4     1     255      COM              2149,2151,2166,2180,2190,2202     
 XIND                       Scalar 1984     R(4)            4     1     255      COM              2160,2171,2172,2174               
 XMISS                      Local  1994     R(4)            4           scalar   SAVE             1994,2195,2204,2206,2208          
 ZOB                        Scalar 1977     R(4)            4     1     255      COM              2123,2176,2193                    
 ZQM                        Scalar 1979     R(4)            4     1     255      COM              2134,2136,2179,2199               

Page 53          Source Listing                  S02UBF
2017-04-18 11:09                                 iw3unpbf.f

   2241 C***********************************************************************
   2242 C***********************************************************************
   2243 C***********************************************************************
   2244       SUBROUTINE S03UBF(UNP,SUBSET,*,*,*)
   2245 C     ---> PACKS DATA INTO UNP ARRAY
   2246  
   2247       PARAMETER (NUMCAT=8, LEVLIM=300, MAXOBS=3500)
   2248 
   2249       COMMON/IUBFDD/HDR(12),RCATS(50,LEVLIM,NUMCAT),IKAT(NUMCAT),
   2250      $ MCAT(NUMCAT),NCAT(NUMCAT),LVDX(NUMCAT)
   2251       COMMON/IUBFNN/STNIDX,CRES1X,CRES2X
   2252  
   2253       CHARACTER*8 STNIDX,CRES1X,CRES2X,SUBSET
   2254       DIMENSION   RCAT(60),JCAT(60),UNP(*)
   2255       EQUIVALENCE (RCAT(1),JCAT(1))
   2256 
   2257       SAVE
   2258 
   2259 C  CALL TO SORT DATA LEVEL CATEGORIES 02, 03, 04, AND 08 LEVELS
   2260 C  ------------------------------------------------------------
   2261  
   2262       CALL S04UBF
   2263  
   2264 C  TRANSFER DATA FROM ALL DATA LEVEL CATEGORIES INTO UNP ARRAY
   2265 C   AND SET POINTERS
   2266 C  -----------------------------------------------------------
   2267  
   2268       INDX = 53
   2269       JCAT = 0
   2270       NLEVTO = 0
   2271       NLEVC8 = 0
   2272  
   2273       DO K = 1,NUMCAT
   2274          JCAT(LVDX(K)) = NCAT(K)
   2275          IF(IKAT(K).NE.8)  THEN
   2276             NLEVTO = NLEVTO + NCAT(K)
   2277          ELSE
   2278             NLEVC8 = NLEVC8 + NCAT(K)
   2279          END IF
   2280          IF(NCAT(K).GT.0) THEN
   2281             JCAT(LVDX(K)+1) = INDX
   2282          ELSE
   2283             JCAT(LVDX(K)+1) = 0
   2284          END IF
   2285          DO J = 1,NCAT(K)
   2286             DO I = 1,MCAT(K)
   2287 
   2288 C  UNPACKED REPORT CONTAINS MORE THAN MAXOBS WORDS - RETURNS A 999
   2289 C  -------------------------------------------------------------
   2290 
   2291                IF(INDX.GT.MAXOBS)  THEN
   2292                   PRINT'(" ~~IW3UNPBF/S03UBF: RPT with ID= ",A,
   2293      $             " TOSSED - CONTAINS ",I0," WORDS, > LIMIT OF ",I0)',
   2294      $             STNIDX,INDX,MAXOBS
   2295                   RETURN 3
   2296                END IF
   2297                UNP(INDX) = RCATS(I,J,K)

Page 54          Source Listing                  S03UBF
2017-04-18 11:09                                 iw3unpbf.f

   2298                INDX = INDX+1
   2299             ENDDO
   2300          ENDDO
   2301       ENDDO
   2302 
   2303 C  RETURN WITHOUT PROCESSING THIS REPORT IF NO DATA IN CAT. 1-6, 51
   2304 C   (UNLESS SSM/I REPORT, THEN DO NOT RETURN UNLESS ALSO NO CAT. 8 DATA)
   2305 C  ---------------------------------------------------------------------
   2306 
   2307       IF(NLEVTO.EQ.0)  THEN
   2308          IF(SUBSET(1:5).NE.'NC012')  THEN
   2309             RETURN 2
   2310          ELSE
   2311             IF(NLEVC8.EQ.0)  RETURN 2
   2312          END IF
   2313       END IF
   2314 
   2315 C  TRANSFER THE HEADER AND POINTER ARRAYS INTO UNP
   2316 C  -----------------------------------------------
   2317  
   2318       UNP(1:12)  = HDR
   2319       UNP(13:52) = RCAT(13:52)
   2320  
   2321       RETURN
   2322       END


ENTRY POINTS

  Name               
                     
 s03ubf_             

Page 55          Source Listing                  S03UBF
2017-04-18 11:09 Symbol Table                    iw3unpbf.f



SYMBOL CROSS REFERENCE

 Name                       Object Declared Type            Bytes Dimen Elements Attributes       References                        
                                                                                                                                    
 CRES1X                     Scalar 2251     CHAR            8           scalar   COM                                                
 CRES2X                     Scalar 2251     CHAR            8           scalar   COM                                                
 HDR                        Scalar 2249     R(4)            4     1     12       COM              2318                              
 I                          Local  2286     I(4)            4           scalar   SAVE             2286,2297                         
 IKAT                       Scalar 2249     I(4)            4     1     8        COM              2275                              
 INDX                       Local  2268     I(4)            4           scalar   SAVE             2268,2281,2291,2294,2297,2298     
 IUBFDD                     Common 2249                                 480176   SAVE                                               
 IUBFNN                     Common 2251                                 24       SAVE                                               
 J                          Local  2285     I(4)            4           scalar   SAVE             2285,2297                         
 JCAT                       Local  2254     I(4)            4     1     60       SAVE             2269,2274,2281,2283               
 K                          Local  2273     I(4)            4           scalar   SAVE             2273,2274,2275,2276,2278,2280,2281
                                                                                                  ,2283,2285,2286,2297              
 LEVLIM                     Param  2247     I(4)            4           scalar                    2249                              
 LVDX                       Scalar 2250     I(4)            4     1     8        COM              2274,2281,2283                    
 MAXOBS                     Param  2247     I(4)            4           scalar                    2291,2294                         
 MCAT                       Scalar 2250     I(4)            4     1     8        COM              2286                              
 NCAT                       Scalar 2250     I(4)            4     1     8        COM              2274,2276,2278,2280,2285          
 NLEVC8                     Local  2271     I(4)            4           scalar   SAVE             2271,2278,2311                    
 NLEVTO                     Local  2270     I(4)            4           scalar   SAVE             2270,2276,2307                    
 NUMCAT                     Param  2247     I(4)            4           scalar                    2249,2250,2273                    
 RCAT                       Local  2254     R(4)            4     1     60       SAVE             2319                              
 RCATS                      Scalar 2249     R(4)            4     3     120000   COM              2297                              
 S03UBF                     Subr   2244                                                                                             
 S04UBF                     Subr   2262                                                           2262                              
 STNIDX                     Scalar 2251     CHAR            8           scalar   COM              2294                              
 SUBSET                     Dummy  2244     CHAR            8           scalar   ARG,INOUT        2308                              
 UNP                        Dummy  2244     R(4)            4     1     0        ARG,INOUT        2297,2318,2319                    

Page 56          Source Listing                  S03UBF
2017-04-18 11:09                                 iw3unpbf.f

   2323 C***********************************************************************
   2324 C***********************************************************************
   2325 C***********************************************************************
   2326       SUBROUTINE S04UBF
   2327 C     ---> SORTS DATA LEVEL CATEGORIES
   2328  
   2329       PARAMETER (NUMCAT=8, LEVLIM=300)
   2330 
   2331       COMMON/IUBFAA/BMISS
   2332       COMMON/IUBFDD/HDR(12),RCATS(50,LEVLIM,NUMCAT),IKAT(NUMCAT),
   2333      $ MCAT(NUMCAT),NCAT(NUMCAT),LVDX(NUMCAT)
   2334       COMMON/IUBFNN/STNIDX,CRES1X,CRES2X
   2335       COMMON/IUBFPP/LWI,LWR
   2336 
   2337       CHARACTER*8 STNIDX,CRES1X,CRES2X
   2338  
   2339       REAL(8)     BMISS
   2340 
   2341       DIMENSION RCAT(50,LEVLIM),SCAT(50,LEVLIM),IORD(LEVLIM),
   2342      $ IWORK(65536),RCTL(3)
   2343       DIMENSION PMAND(21)
   2344 
   2345       SAVE
   2346 
   2347       DATA XMISS/99999./,PMAND/10000.,9250.,8500.,7000.,5000.,4000.,
   2348      $ 3000.,2500.,2000.,1500.,1000.,700.,500.,300.,200.,100.,70.,50.,
   2349      $ 30.,20.,10./
   2350  
   2351 C  INSERT DATA LEVEL CATEGORY 1 PRESSURE & DEF. Q.M.'S INTO THOSE LEVELS
   2352 C   WHERE MSSING
   2353 C  ---------------------------------------------------------------------
   2354 
   2355       DO I=1,NCAT(1)
   2356          IF(RCATS(1,I,1).GE.XMISS)  THEN
   2357             RCATS(1,I,1) = PMAND(I)
   2358             RCATS(7:11,I,1) = 2.0
   2359          END IF
   2360       ENDDO
   2361 
   2362 C  SORT DATA LEVEL CATEGORIES 2, 3, AND 4 - LEAVE THE FIRST LEVEL IN
   2363 C   EACH INTACT
   2364 C  ------------------------------------------------------------------
   2365  
   2366       DO K=2,4
   2367          IF(NCAT(K).GT.1) THEN
   2368             DO J=1,NCAT(K)-1
   2369                DO I=1,MCAT(K)
   2370                   SCAT(I,J) = RCATS(I,J+1,K)
   2371                ENDDO
   2372             ENDDO
   2373             CALL ORDERS(2,IWORK,SCAT(1,1),IORD,NCAT(K)-1,50,LWR,2)
   2374             RCTL = BMISS
   2375             DO J=1,NCAT(K)-1
   2376                IF(K.LT.4) JJ = IORD((NCAT(K)-1)-J+1)
   2377                IF(K.EQ.4) JJ = IORD(J)
   2378                DO I=1,MCAT(K)
   2379                   RCAT(I,J) = SCAT(I,JJ)

Page 57          Source Listing                  S04UBF
2017-04-18 11:09                                 iw3unpbf.f

   2380                ENDDO
   2381                IDUP = 0
   2382                IFLAG = 0
   2383                IF(NINT(RCAT(1,J)).EQ.NINT(RCTL(1)))  THEN
   2384                   IF(NINT(RCAT(2,J)).EQ.NINT(RCTL(2)).AND.
   2385      $               NINT(RCAT(3,J)).EQ.NINT(RCTL(3)))  THEN
   2386                      if(k.ne.4)  then
   2387                         print'(" ~~@@IW3UNPBF/S04UBF: ID ",A," has a ",
   2388      $                   "dupl. cat. ",I0," lvl (all data) at ",G0," ",
   2389      $                   "mb -- lvl will be excluded from processing")',
   2390      $                   stnidx,k,rcat(1,j)*.1
   2391                      else
   2392                         print'(" ~~@@IW3UNPBF/S04UBF: ID ",A," has a ",
   2393      $                   "dupl. cat. ",I0," lvl (all data) at ",G0," m",
   2394      $                   " -- lvl will be excluded from processing")',
   2395      $                   stnidx,k,rcat(1,j)
   2396                      end if
   2397                      IDUP = 1
   2398                   ELSE
   2399                      if(k.ne.4)  then
   2400                         print'(" ~~@@#IW3UNPBF/S04UBF: ID ",A," has a ",
   2401      $                   "dupl. cat. ",I0," press. lvl (data differ) ",
   2402      $                   "at ",G0," mb -- all q.m. will be FLAGGED")',
   2403      $                   stnidx,k,rcat(1,j)*.1
   2404                      else
   2405                         print'(" ~~@@#IW3UNPBF/S04UBF: ID ",A," has a ",
   2406      $                   "dupl. cat. ",I0," height lvl (data differ) ",
   2407      $                   "at ",G0," m -- all q.m. will be FLAGGED")',
   2408      $                   stnidx,k,rcat(1,j)
   2409                      end if
   2410                      IFLAG = 1
   2411                   END IF
   2412                END IF
   2413                RCTL = RCAT(1:3,J)
   2414                IF(IDUP.EQ.1)  THEN
   2415                   RCAT(1,J) = BMISS
   2416                ELSE IF(IFLAG.EQ.1)  THEN
   2417                   RCAT(4,J) = 14
   2418                   RCAT(5,J) = 14
   2419                   RCAT(4,J-1) = 14
   2420                   RCAT(5,J-1) = 14
   2421                END IF
   2422             ENDDO
   2423             JJJ = 1
   2424             LOOP1: DO J=2,NCAT(K)
   2425                IF(RCAT(1,J-1).GE.BMISS)  CYCLE LOOP1
   2426                JJJ = JJJ + 1
   2427                LOOP1n1: DO I=1,MCAT(K)
   2428                   RCATS(I,JJJ,K) = RCAT(I,J-1)
   2429                ENDDO LOOP1n1
   2430             ENDDO LOOP1
   2431             if(jjj.ne.NCAT(K))
   2432      $       print'(" ~~@@IW3UNPBF/S04UBF: ID ",A," has had ",I0,
   2433      $        " lvls removed due to their being duplicates")',
   2434      $        stnidx,NCAT(K)-jjj
   2435             ncat(k) = jjj
   2436          end if

Page 58          Source Listing                  S04UBF
2017-04-18 11:09                                 iw3unpbf.f

   2437          IF(NCAT(K).EQ.1)  THEN
   2438             IF(MIN(RCATS(1,1,K),RCATS(2,1,K),RCATS(3,1,K)).GT.99998.8)
   2439      $       NCAT(K) = 0
   2440          END IF
   2441       ENDDO
   2442  
   2443 C  SORT DATA LEVEL CATEGORY 08 BY CODE FIGURE
   2444 C  ------------------------------------------
   2445  
   2446       DO K=8,8
   2447          IF(NCAT(K).GT.1) THEN
   2448             CALL ORDERS(2,IWORK,RCATS(2,1,K),IORD,NCAT(K),50,LWR,2)
   2449             DO J=1,NCAT(K)
   2450                DO I=1,MCAT(K)
   2451                   RCAT(I,J) = RCATS(I,IORD(J),K)
   2452                ENDDO
   2453             ENDDO
   2454             DO J=1,NCAT(K)
   2455                DO I=1,MCAT(K)
   2456                   RCATS(I,J,K) = RCAT(I,J)
   2457                ENDDO
   2458             ENDDO
   2459          END IF
   2460       ENDDO
   2461  
   2462 C  NORMAL EXIT
   2463 C  -----------
   2464  
   2465       RETURN
   2466       END

Page 59          Source Listing                  S04UBF
2017-04-18 11:09 Entry Points                    iw3unpbf.f



ENTRY POINTS

  Name               
                     
 s04ubf_             


SYMBOL CROSS REFERENCE

 Name                       Object Declared Type            Bytes Dimen Elements Attributes       References                        
                                                                                                                                    
 BMISS                      Scalar 2331     R(8)            8           scalar   COM              2374,2415,2425                    
 CRES1X                     Scalar 2334     CHAR            8           scalar   COM                                                
 CRES2X                     Scalar 2334     CHAR            8           scalar   COM                                                
 HDR                        Scalar 2332     R(4)            4     1     12       COM                                                
 I                          Local  2355     I(4)            4           scalar   SAVE             2355,2356,2357,2358,2369,2370,2378
                                                                                                  ,2379,2427,2428,2450,2451,2455,245
                                                                                                  6                                 
 IDUP                       Local  2381     I(4)            4           scalar   SAVE             2381,2397,2414                    
 IFLAG                      Local  2382     I(4)            4           scalar   SAVE             2382,2410,2416                    
 IKAT                       Scalar 2332     I(4)            4     1     8        COM                                                
 IORD                       Local  2341     I(4)            4     1     300      SAVE             2373,2376,2377,2448,2451          
 IUBFAA                     Common 2331                                 8        SAVE                                               
 IUBFDD                     Common 2332                                 480176   SAVE                                               
 IUBFNN                     Common 2334                                 24       SAVE                                               
 IUBFPP                     Common 2335                                 8        SAVE                                               
 IWORK                      Local  2342     I(4)            4     1     65536    SAVE             2373,2448                         
 J                          Local  2368     I(4)            4           scalar   SAVE             2368,2370,2375,2376,2377,2379,2383
                                                                                                  ,2384,2385,2390,2395,2403,2408,241
                                                                                                  3,2415,2417,2418,2419,2420,2424,24
                                                                                                  25,2428,2449,2451,2454,2456       
 JJ                         Local  2376     I(4)            4           scalar   SAVE             2376,2377,2379                    
 JJJ                        Local  2423     I(4)            4           scalar   SAVE             2423,2426,2428,2431,2434,2435     
 K                          Local  2366     I(4)            4           scalar   SAVE             2366,2367,2368,2369,2370,2373,2375
                                                                                                  ,2376,2377,2378,2386,2390,2395,239
                                                                                                  9,2403,2408,2424,2427,2428,2431,24
                                                                                                  34,2435,2437,2438,2439,2446,2447,2
                                                                                                  448,2449,2450,2451,2454,2455,2456 
 LEVLIM                     Param  2329     I(4)            4           scalar                    2332,2341                         
 LOOP1                      Label  2424                                 scalar                    2425,2430                         
 LOOP1N1                    Label  2427                                 scalar                    2429                              
 LVDX                       Scalar 2333     I(4)            4     1     8        COM                                                
 LWI                        Scalar 2335     I(4)            4           scalar   COM                                                
 LWR                        Scalar 2335     I(4)            4           scalar   COM              2373,2448                         
 MCAT                       Scalar 2333     I(4)            4     1     8        COM              2369,2378,2427,2450,2455          
 MIN                        Func   2438                                 scalar                    2438                              
 NCAT                       Scalar 2333     I(4)            4     1     8        COM              2355,2367,2368,2373,2375,2376,2424
                                                                                                  ,2431,2434,2435,2437,2439,2447,244
                                                                                                  8,2449,2454                       
 NINT                       Func   2383                                 scalar                    2383,2384,2385                    
 NUMCAT                     Param  2329     I(4)            4           scalar                    2332,2333                         
 ORDERS                     Subr   2373                                                           2373,2448                         
 PMAND                      Local  2343     R(4)            4     1     21       SAVE             2347,2357                         
 RCAT                       Local  2341     R(4)            4     2     15000    SAVE             2379,2383,2384,2385,2390,2395,2403
                                                                                                  ,2408,2413,2415,2417,2418,2419,242

Page 60          Source Listing                  S04UBF
2017-04-18 11:09 Symbol Table                    iw3unpbf.f

 Name                       Object Declared Type            Bytes Dimen Elements Attributes       References                        
                                                                                                                                    
                                                                                                  0,2425,2428,2451,2456             
 RCATS                      Scalar 2332     R(4)            4     3     120000   COM              2356,2357,2358,2370,2428,2438,2448
                                                                                                  ,2451,2456                        
 RCTL                       Local  2342     R(4)            4     1     3        SAVE             2374,2383,2384,2385,2413          
 S04UBF                     Subr   2326                                                                                             
 SCAT                       Local  2341     R(4)            4     2     15000    SAVE             2370,2373,2379                    
 STNIDX                     Scalar 2334     CHAR            8           scalar   COM              2390,2395,2403,2408,2434          
 XMISS                      Local  2347     R(4)            4           scalar   SAVE             2347,2356                         

Page 61          Source Listing                  S04UBF
2017-04-18 11:09                                 iw3unpbf.f

   2467 C***********************************************************************
   2468 C***********************************************************************
   2469 C***********************************************************************
   2470       SUBROUTINE S05UBF
   2471 C     ---> INITIALIZES INPUT ARRAYS
   2472  
   2473       CHARACTER*8  STNIDX,CRES1X,CRES2X
   2474       CHARACTER*11 CBULLX
   2475       REAL(8)      BMISS
   2476 
   2477       COMMON/IUBFAA/BMISS
   2478       COMMON/IUBFEE/OBS(255,9)
   2479       COMMON/IUBFFF/QMS(255,5)
   2480       COMMON/IUBFGG/SFO(6)
   2481       COMMON/IUBFHH/SFQ(5)
   2482       COMMON/IUBFLL/Q8(255,2)
   2483       COMMON/IUBFMM/XIND(255)
   2484       COMMON/IUBFNN/STNIDX,CRES1X,CRES2X
   2485       COMMON/IUBFSS/CBULLX
   2486  
   2487       SAVE
   2488  
   2489       DATA IMISS/99999/
   2490  
   2491 C  SET THE INPUT OBS DATA ARRAYS TO MISSING, INPUT Q.M. DATA ARRAYS
   2492 C  TO 2, INPUT CAT. 8 INDICATORS TO IMISS AND INPUT SPECIAL LEVEL
   2493 C  INDICATORS TO 0
   2494 C  ----------------------------------------------------------------
   2495  
   2496       OBS  = BMISS
   2497       QMS  = 2
   2498       SFO  = BMISS
   2499       SFQ  = 2
   2500       XIND = 0
   2501       Q8   = IMISS
   2502       STNIDX = '        '
   2503       CRES1X = '        '
   2504       CRES2X = '        '
   2505       CBULLX = '           '
   2506  
   2507       RETURN
   2508       END

Page 62          Source Listing                  S05UBF
2017-04-18 11:09 Entry Points                    iw3unpbf.f



ENTRY POINTS

  Name               
                     
 s05ubf_             


SYMBOL CROSS REFERENCE

 Name                       Object Declared Type            Bytes Dimen Elements Attributes       References                        
                                                                                                                                    
 BMISS                      Scalar 2475     R(8)            8           scalar   COM              2496,2498                         
 CBULLX                     Scalar 2474     CHAR            11          scalar   COM              2505                              
 CRES1X                     Scalar 2473     CHAR            8           scalar   COM              2503                              
 CRES2X                     Scalar 2473     CHAR            8           scalar   COM              2504                              
 IMISS                      Local  2489     I(4)            4           scalar   SAVE             2489,2501                         
 IUBFAA                     Common 2477                                 8        SAVE                                               
 IUBFEE                     Common 2478                                 9180     SAVE                                               
 IUBFFF                     Common 2479                                 5100     SAVE                                               
 IUBFGG                     Common 2480                                 24       SAVE                                               
 IUBFHH                     Common 2481                                 20       SAVE                                               
 IUBFLL                     Common 2482                                 2040     SAVE                                               
 IUBFMM                     Common 2483                                 1020     SAVE                                               
 IUBFNN                     Common 2484                                 24       SAVE                                               
 IUBFSS                     Common 2485                                 11       SAVE                                               
 OBS                        Scalar 2478     R(4)            4     2     2295     COM              2496                              
 Q8                         Scalar 2482     R(4)            4     2     510      COM              2501                              
 QMS                        Scalar 2479     R(4)            4     2     1275     COM              2497                              
 S05UBF                     Subr   2470                                                                                             
 SFO                        Scalar 2480     R(4)            4     1     6        COM              2498                              
 SFQ                        Scalar 2481     R(4)            4     1     5        COM              2499                              
 STNIDX                     Scalar 2473     CHAR            8           scalar   COM              2502                              
 XIND                       Scalar 2483     R(4)            4     1     255      COM              2500                              

Page 63          Source Listing                  S05UBF
2017-04-18 11:09                                 iw3unpbf.f

   2509 C***********************************************************************
   2510 C***********************************************************************
   2511 C***********************************************************************
   2512       FUNCTION I04UBF(P)
   2513 C     ---> ASSIGNS NUMBER TO MANDATORY PRESSURE LEVEL
   2514  
   2515       COMMON/IUBFJJ/ISET,MANLIN(1001)
   2516 
   2517       SAVE
   2518  
   2519       IF(ISET.EQ.0) THEN
   2520          MANLIN = 0
   2521 
   2522          MANLIN(1000) =  1
   2523          MANLIN(925)  =  2
   2524          MANLIN(850)  =  3
   2525          MANLIN(700)  =  4
   2526          MANLIN(500)  =  5
   2527          MANLIN(400)  =  6
   2528          MANLIN(300)  =  7
   2529          MANLIN(250)  =  8
   2530          MANLIN(200)  =  9
   2531          MANLIN(150)  = 10
   2532          MANLIN(100)  = 11
   2533          MANLIN(70)   = 12
   2534          MANLIN(50)   = 13
   2535          MANLIN(30)   = 14
   2536          MANLIN(20)   = 15
   2537          MANLIN(10)   = 16
   2538          MANLIN(7)    = 17
   2539          MANLIN(5)    = 18
   2540          MANLIN(3)    = 19
   2541          MANLIN(2)    = 20
   2542          MANLIN(1)    = 21
   2543 
   2544          ISET = 1
   2545       END IF
   2546  
   2547       IP = NINT(P*10.)
   2548  
   2549       IF(IP.GT.10000 .OR. IP.LT.10 .OR. MOD(IP,10).NE.0) THEN
   2550          I04UBF = 0
   2551       ELSE
   2552          I04UBF = MANLIN(IP/10)
   2553       END IF
   2554  
   2555       RETURN
   2556 
   2557       END

Page 64          Source Listing                  I04UBF
2017-04-18 11:09 Entry Points                    iw3unpbf.f



ENTRY POINTS

  Name               
                     
 i04ubf_             


SYMBOL CROSS REFERENCE

 Name                       Object Declared Type            Bytes Dimen Elements Attributes       References                        
                                                                                                                                    
 I04UBF                     Func   2512     I(4)            4           scalar                    2550,2552                         
 I04UBF@0                   Local  2512     I(4)            4           scalar   SAVE                                               
 IP                         Local  2547     I(4)            4           scalar   SAVE             2547,2549,2552                    
 ISET                       Scalar 2515     I(4)            4           scalar   COM              2519,2544                         
 IUBFJJ                     Common 2515                                 4008     SAVE                                               
 MANLIN                     Scalar 2515     I(4)            4     1     1001     COM              2520,2522,2523,2524,2525,2526,2527
                                                                                                  ,2528,2529,2530,2531,2532,2533,253
                                                                                                  4,2535,2536,2537,2538,2539,2540,25
                                                                                                  41,2542,2552                      
 MOD                        Func   2549                                 scalar                    2549                              
 NINT                       Func   2547                                 scalar                    2547                              
 P                          Dummy  2512     R(4)            4           scalar   ARG,INOUT        2547                              

Page 65          Source Listing                  I04UBF
2017-04-18 11:09                                 iw3unpbf.f

   2558 C***********************************************************************
   2559 C***********************************************************************
   2560 C***********************************************************************
   2561       FUNCTION R02UBF()
   2562  
   2563       CHARACTER*8 QMARK,SUBSET,RPID
   2564       LOGICAL     L02UBF,L03UBF
   2565       REAL(8)     BMISS
   2566 
   2567       COMMON/IUBFAA/BMISS
   2568 
   2569       SAVE
   2570  
   2571       R02UBF = 0
   2572  
   2573       RETURN
   2574 
   2575 C+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
   2576 
   2577       ENTRY ERTUBF(SUBSET,RPID)
   2578          ERTUBF = BMISS
   2579          IF(SUBSET(1:5).EQ.'NC000')  THEN
   2580             IF(SUBSET(6:8).EQ.'002')  THEN
   2581 
   2582 C  LAND SYNOPTIC SURFACE - MOBILE
   2583 C  ------------------------------
   2584 
   2585                ERTUBF = 514
   2586             ELSE
   2587 
   2588 C  LAND SYNOPTIC SURFACE - FIXED (RESTRICTED WMO RES. 40 & UNRESTRICTED)
   2589 C  ---------------------------------------------------------------------
   2590 
   2591                IF(L02UBF(RPID))  ERTUBF = 511
   2592 
   2593 C  METAR SURFACE - FIXED
   2594 C  ---------------------
   2595 
   2596                IF(L03UBF(RPID))  ERTUBF = 512
   2597             END IF
   2598          ELSE  IF(SUBSET(1:5).EQ.'NC255')  THEN
   2599 
   2600 C  MESONET SURFACE
   2601 C  ---------------
   2602 
   2603             ERTUBF = 540
   2604          ELSE  IF(SUBSET(1:5).EQ.'NC001')  THEN
   2605             IF(SUBSET(6:8).EQ.'001'.OR.SUBSET(6:8).EQ.'013')  THEN
   2606                IF(RPID.NE.'SHIP')  THEN
   2607 
   2608 C  SHIP WITH NAME
   2609 C  --------------
   2610 
   2611                   ERTUBF = 522
   2612                ELSE
   2613 
   2614 C  SHIP WITHOUT NAME

Page 66          Source Listing                  R02UBF
2017-04-18 11:09                                 iw3unpbf.f

   2615 C  -----------------
   2616 
   2617                   ERTUBF = 523
   2618                END IF
   2619             ELSE  IF(SUBSET(6:8).EQ.'002') THEN
   2620 
   2621 C  BUOYS ARRIVING IN WMO FM18 FORMAT (FIXED OR DRIFTING)
   2622 C  -----------------------------------------------------
   2623 
   2624                ERTUBF = 562
   2625             ELSE  IF(SUBSET(6:8).EQ.'003') THEN
   2626 
   2627 C  BUOYS ARRIVING IN WMO FM13 FORMAT (FIXED)
   2628 C  -----------------------------------------
   2629 
   2630                ERTUBF = 561
   2631             ELSE  IF(SUBSET(6:8).EQ.'004') THEN
   2632 
   2633 C  C-MAN PLATFORM
   2634 C  --------------
   2635 
   2636                ERTUBF = 531
   2637             ELSE  IF(SUBSET(6:8).EQ.'005') THEN
   2638 
   2639 C  TIDE GAUGE
   2640 C  ----------
   2641 
   2642                ERTUBF = 532
   2643             ELSE  IF(SUBSET(6:8).EQ.'006') THEN
   2644 
   2645 C  SEA-LEVEL PRESSURE BOGUS
   2646 C  ------------------------
   2647 
   2648                ERTUBF = 551
   2649             ELSE  IF(SUBSET(6:8).EQ.'007') THEN
   2650 
   2651 C  COAST GUARD TIDE GAUGE
   2652 C  ----------------------
   2653 
   2654                ERTUBF = 534
   2655             END IF
   2656          ELSE  IF(SUBSET(1:5).EQ.'NC002')  THEN
   2657             IF(SUBSET(6:8).EQ.'001')  THEN
   2658 
   2659 C  LAND RADIOSONDE - FIXED
   2660 C  -----------------------
   2661 
   2662                ERTUBF = 011
   2663                IF(L03UBF(RPID)) ERTUBF = 012
   2664                IF(RPID(1:4).EQ.'CLAS') ERTUBF = 013
   2665             ELSE  IF(SUBSET(6:8).EQ.'002') THEN
   2666 
   2667 C  LAND RADIOSONDE - MOBILE
   2668 C  ------------------------
   2669 
   2670                ERTUBF = 013
   2671             ELSE  IF(SUBSET(6:8).EQ.'003') THEN

Page 67          Source Listing                  R02UBF
2017-04-18 11:09                                 iw3unpbf.f

   2672 
   2673 C  SHIP RADIOSONDE
   2674 C  ---------------
   2675 
   2676                ERTUBF = 022
   2677                IF(RPID(1:4).EQ.'SHIP') ERTUBF = 023
   2678             ELSE  IF(SUBSET(6:8).EQ.'004') THEN
   2679 
   2680 C  DROPWINSONDE
   2681 C  -------------
   2682 
   2683                ERTUBF = 031
   2684             ELSE  IF(SUBSET(6:8).EQ.'005') THEN
   2685 
   2686 C  PIBAL
   2687 C  -----
   2688 
   2689                ERTUBF = 011
   2690                IF(L03UBF(RPID)) ERTUBF = 012
   2691             ELSE  IF(SUBSET(6:8).EQ.'009') THEN
   2692 
   2693 C  WIND PROFILERS ORIGINATING FROM PILOT (PIBAL) FORMAT BULLETINS
   2694 C  --------------------------------------------------------------
   2695 
   2696                ERTUBF = 073
   2697             END IF
   2698 
   2699          ELSE  IF(SUBSET.EQ.'NC004005')  THEN
   2700 
   2701 C  RECCOS/DROPS
   2702 C  ------------
   2703 
   2704             ERTUBF = 031
   2705          END IF
   2706          RETURN
   2707 
   2708 C+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
   2709 
   2710       ENTRY MQMUBF(QMARK)
   2711          IF(QMARK(1:1).EQ.'S'.OR.QMARK(1:1).EQ.'V')  THEN
   2712 CCCCCCCCCCC MQMUBF =  1   ! good
   2713             MQMUBF =  2   ! good
   2714          ELSE  IF(QMARK(1:1).EQ.'Q')  THEN
   2715             MQMUBF =  3   ! suspect
   2716          ELSE  IF(QMARK(1:1).EQ.'X')  THEN
   2717             MQMUBF = 13   ! failed
   2718          ELSE  IF(QMARK(1:1).EQ.'Z'.OR.QMARK(1:1).EQ.'C')  THEN
   2719             MQMUBF =  2   ! neutral
   2720          ELSE
   2721             MQMUBF = 15   ! missing or unknown (make 15 for now
   2722                           !  for diag. checks, later change to 13)
   2723          END IF
   2724          RETURN
   2725 
   2726 C+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
   2727 
   2728       ENTRY EQMUBF(QMK)

Page 68          Source Listing                  R02UBF
2017-04-18 11:09                                 iw3unpbf.f

   2729          IF((NINT(QMK).GE.0 .AND. NINT(QMK).LT.4) .OR.
   2730      $      (NINT(QMK).GT.9 .AND. NINT(QMK).LT.15))  THEN
   2731             EQMUBF = NINT(QMK)
   2732          ELSE  IF(NINT(QMK).EQ.6)  THEN
   2733 C  To get around the 3-bit limit to SDMEDIT/QUIPS pressure q.m. mnemonic
   2734 C   "QMPR", purge or reject flag on pressure is changed from 12 or 14 to
   2735 C   6 to fit in 3-bits)
   2736             EQMUBF = 14
   2737          ELSE
   2738             EQMUBF = 2
   2739          END IF
   2740          RETURN
   2741 
   2742 C+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
   2743 
   2744       ENTRY EQSUBF(QMK)
   2745          IF(NINT(QMK).GE.0 .AND. NINT(QMK).LT.15)  THEN
   2746             EQSUBF = NINT(QMK)
   2747          ELSE
   2748             EQSUBF = 2
   2749          END IF
   2750 
   2751          IF(NINT(QMK).EQ.6)  THEN
   2752 C  (NOTE: Prior to mid-March 1999, a purge or reject flag on pressure
   2753 C         was set to 6 (instead of 14 or 12, resp.) to get around the
   2754 C         3-bit limit to SDMEDIT/QUIPS pressure q.m. mnemonic "QMPR".
   2755 C         The 3-bit limit on "QMPR" was changed to 4-bits with a decoder
   2756 C         change in February 1999.  However, the codes that write the
   2757 C         q.m.'s out (EDTBUFR and QUIPC) weren't changed to write out 14
   2758 C         or 12 for purge or reject until mid-March 1999.  In order to
   2759 C         allow old runs to work properly, a q.m. of 6 will be reset to
   2760 C         14.  This would have to change if q.m.=6 ever has a defined
   2761 C         meaning.)
   2762             EQSUBF = 14
   2763          END IF
   2764          RETURN
   2765       END

Page 69          Source Listing                  R02UBF
2017-04-18 11:09 Entry Points                    iw3unpbf.f



ENTRY POINTS

  Name                  Name                  Name                  Name                  Name               
                                                                                                             
 eqmubf_               eqsubf_               ertubf_               mqmubf_               r02ubf_             


SYMBOL CROSS REFERENCE

 Name                       Object Declared Type            Bytes Dimen Elements Attributes       References                        
                                                                                                                                    
 BMISS                      Scalar 2565     R(8)            8           scalar   COM              2578                              
 EQMUBF                     Func   2728     R(4)            4           scalar                    2731,2736,2738                    
 EQMUBF@0                   Local  2728     R(4)            4           scalar   SAVE                                               
 EQSUBF                     Func   2744     R(4)            4           scalar                    2746,2748,2762                    
 EQSUBF@0                   Local  2744     R(4)            4           scalar   SAVE                                               
 ERTUBF                     Func   2577     R(4)            4           scalar                    2578,2585,2591,2596,2603,2611,2617
                                                                                                  ,2624,2630,2636,2642,2648,2654,266
                                                                                                  2,2663,2664,2670,2676,2677,2683,26
                                                                                                  89,2690,2696,2704                 
 ERTUBF@0                   Local  2577     R(4)            4           scalar   SAVE                                               
 IUBFAA                     Common 2567                                 8        SAVE                                               
 L02UBF                     Func   2564     L(4)            4           scalar                    2591                              
 L03UBF                     Func   2564     L(4)            4           scalar                    2596,2663,2690                    
 MQMUBF                     Func   2710     I(4)            4           scalar                    2713,2715,2717,2719,2721          
 MQMUBF@0                   Local  2710     I(4)            4           scalar   SAVE                                               
 NINT                       Func   2729                                 scalar                    2729,2730,2731,2732,2745,2746,2751
 QMARK                      Dummy  2710     CHAR            8           scalar   ARG,INOUT        2711,2714,2716,2718               
 QMK                        Dummy  2728     R(4)            4           scalar   ARG,INOUT        2729,2730,2731,2732,2745,2746,2751
 R02UBF                     Func   2561     R(4)            4           scalar                    2571                              
 R02UBF@0                   Local  2561     R(4)            4           scalar   SAVE                                               
 RPID                       Dummy  2577     CHAR            8           scalar   ARG,INOUT        2591,2596,2606,2663,2664,2677,2690
 SUBSET                     Dummy  2577     CHAR            8           scalar   ARG,INOUT        2579,2580,2598,2604,2605,2619,2625
                                                                                                  ,2631,2637,2643,2649,2656,2657,266
                                                                                                  5,2671,2678,2684,2691,2699        

Page 70          Source Listing                  R02UBF
2017-04-18 11:09                                 iw3unpbf.f

   2766 C***********************************************************************
   2767 C***********************************************************************
   2768 C***********************************************************************
   2769       FUNCTION L01UBF()
   2770       CHARACTER*8 RPID
   2771       LOGICAL L01UBF,L02UBF,L03UBF
   2772 
   2773       SAVE
   2774 
   2775       L01UBF = .TRUE.
   2776 
   2777       RETURN
   2778 
   2779 C+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
   2780 
   2781       ENTRY L02UBF(RPID)
   2782          L02UBF = .FALSE.
   2783          READ(RPID,'(I5)',ERR=1) IBKS
   2784          L02UBF = .TRUE.
   2785 1        RETURN
   2786 
   2787 C+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
   2788 
   2789       ENTRY L03UBF(RPID)
   2790          L03UBF = .TRUE.
   2791          READ(RPID,'(I5)',ERR=2) IBKS
   2792          L03UBF = .FALSE.
   2793 2        RETURN
   2794       END

Page 71          Source Listing                  L01UBF
2017-04-18 11:09 Entry Points                    iw3unpbf.f



ENTRY POINTS

  Name                  Name                  Name               
                                                                 
 l01ubf_               l02ubf_               l03ubf_             


SYMBOL CROSS REFERENCE

 Name                       Object Declared Type            Bytes Dimen Elements Attributes       References                        
                                                                                                                                    
 1                          Label  2785                                                           2783                              
 2                          Label  2793                                                           2791                              
 IBKS                       Local  2783     I(4)            4           scalar   SAVE             2783,2791                         
 L01UBF                     Func   2769     L(4)            4           scalar                    2775                              
 L01UBF@0                   Local  2769     L(4)            4           scalar   SAVE                                               
 L02UBF                     Func   2771     L(4)            4           scalar                    2782,2784                         
 L03UBF                     Func   2771     L(4)            4           scalar                    2790,2792                         
 RPID                       Dummy  2781     CHAR            8           scalar   ARG,INOUT        2783,2791                         

Page 72          Source Listing                  L01UBF
2017-04-18 11:09                                 iw3unpbf.f

   2795 C***********************************************************************
   2796 C***********************************************************************
   2797 C***********************************************************************
   2798       FUNCTION R03UBF(LUNIT,OBS,OBS2,OBS3,NOBS3,obs8_8)
   2799 C     ---> PROCESSES ADPUPA DATA (002/*, 004/005)
   2800  
   2801       PARAMETER (NUMCAT=8, LEVLIM=300)
   2802 
   2803       COMMON/IUBFAA/BMISS
   2804       COMMON/IUBFBB/KNDX,KSKACF(8),KSKUPA,KSKSFC,KSKSAT,KFLSAT(12),
   2805      $ KSKSMI
   2806       COMMON/IUBFCC/SUBSET
   2807       COMMON/IUBFDD/HDR(12),RCATS(50,LEVLIM,NUMCAT),IKAT(NUMCAT),
   2808      $ MCAT(NUMCAT),NCAT(NUMCAT),LVDX(NUMCAT)
   2809       COMMON/IUBFEE/POB(255),QOB(255),TOB(255),ZOB(255),DOB(255),
   2810      $              SOB(255),VSG(255),OB8(255),CF8(255)
   2811       COMMON/IUBFFF/PQM(255),QQM(255),TQM(255),ZQM(255),WQM(255)
   2812       COMMON/IUBFII/PWMIN
   2813       COMMON/IUBFLL/Q81(255),Q82(255)
   2814       COMMON/IUBFMM/XIND(255)
   2815  
   2816       CHARACTER*80 HDSTR,LVSTR,QMSTR,RCSTR
   2817       CHARACTER*8  SUBSET,SID,RSV1,RSV2
   2818       REAL(8)  RID_8,HDR_8(12),VSG_8(255),OBS2_8(43),OBS3_8(5,255,7),
   2819      $ RCT_8(5,255),ARR_8(10,255),RAT_8(255),RMORE_8(4),RGP10_8(255),
   2820      $ PRGP10_8(255),RPMSL_8,RPSAL_8,BMISS,AMINIMUM_8,obs8_8(2)
   2821       DIMENSION  OBS(*),OBS2(43),OBS3(5,255,7),NOBS3(7),RCT(5,255),
   2822      $ ARR(10,255), RAT(255),RMORE(4),RGP10(255),PRGP10(255),P2(255),
   2823      $ P8(255),P16(255)
   2824 
   2825       EQUIVALENCE  (RID_8,SID)
   2826       LOGICAL      L02UBF
   2827 
   2828       SAVE
   2829  
   2830       DATA HDSTR/'NUL  CLON CLAT HOUR MINU SELV               '/
   2831       DATA LVSTR/'PRLC TMDP TMDB GP07 GP10 WDIR WSPD          '/
   2832       DATA QMSTR/'QMPR QMAT QMDD QMGP QMWN                    '/
   2833       DATA RCSTR/'RCHR RCMI RCTS                              '/
   2834  
   2835       DATA XMISS/99999./, IMISS/99999/, GRAV/9.8/
   2836  
   2837       PRS1(Z) = 1013.25 * (((288.15 - (.0065 * Z))/288.15)**5.256)
   2838       PRS2(Z) = 226.3 * EXP(1.576106E-4 * (11000. - Z))
   2839 
   2840 C  FCNS BELOW CONVERT TEMP/TD(K) & PRESS(MB) INTO SAT./SPEC. HUM.(KG/KG)
   2841 C  ---------------------------------------------------------------------
   2842 
   2843       ES(T) = 6.1078 * EXP((17.269 * (T - 273.16))/((T - 273.16)+237.3))
   2844       QFRMTP(T,P) = (0.622 * ES(T))/(P - (0.378 * ES(T)))
   2845 
   2846       R03UBF = 0
   2847  
   2848 C  STORE SINGLE LEVEL REPORT DATA DIRECTLY INTO OBS2 ARRAY AND
   2849 C   MULTIPLE LEVEL REPORT DATA DIRECTLY INTO OBS3,
   2850 C   DOUBLE-PRECISION SINGLE LEVEL REPORT DATA DIRECTLY INTO OBS8_8 ARRAY
   2851 C  ---------------------------------------------------------------------

Page 73          Source Listing                  R03UBF
2017-04-18 11:09                                 iw3unpbf.f

   2852 
   2853       OBS2_8 = BMISS
   2854       OBS3_8 = BMISS
   2855       NOBS3  = 0
   2856       obs8_8 = bmiss
   2857       CALL UFBINT(LUNIT,OBS2_8( 1),2,1,IRET,'RSRD EXPRSRD')
   2858       CALL UFBINT(LUNIT,OBS2_8( 4),1,1,IRET,'SST1')
   2859       IF(IBFMS(OBS2_8(4)).EQ.0)  OBS2_8(41) = 2.0
   2860       CALL UFBINT(LUNIT,OBS3_8(1,1,3),5,255,IRET,
   2861      $                                        'NUL CLAM CLTP HOCB HOCT')
   2862       IF(IRET.EQ.1) THEN ! reset iret from 1 to 0 if all obs missing
   2863                          !  (iret can be 1 even if all obs missing)
   2864          AMINIMUM_8 = MIN(OBS3_8(2,1,3),OBS3_8(3,1,3),OBS3_8(4,1,3),
   2865      $    OBS3_8(5,1,3))
   2866          IF(IBFMS(AMINIMUM_8).NE.0)  IRET = 0
   2867       END IF
   2868       NOBS3(3) = IRET
   2869 
   2870       IF(SUBSET.EQ.'NC004005') THEN                            ! RECCOs
   2871          CALL UFBINT(LUNIT,OBS3_8(1,1,2),5,255,IRET,'PRWE')
   2872          IF(IRET.EQ.1) THEN ! reset iret from 1 to 0 if all obs missing
   2873                             !  (iret can be 1 even if all obs missing)
   2874             IF(IBFMS(OBS3_8(1,1,2)).NE.0)  IRET = 0
   2875          END IF
   2876          NOBS3(2) = IRET
   2877          CALL UFBINT(LUNIT,OBS3_8(1,1,6),5,255,IRET,'AFIC HBOI HTOI')
   2878          IF(IRET.EQ.1) THEN ! reset iret from 1 to 0 if all obs missing
   2879                             !  (iret can be 1 even if all obs missing)
   2880             AMINIMUM_8 = MIN(OBS3_8(1,1,6),OBS3_8(2,1,6),OBS3_8(3,1,6))
   2881             IF(IBFMS(AMINIMUM_8).NE.0)  IRET = 0
   2882          END IF
   2883          NOBS3(6) = IRET
   2884          CALL UFBINT(LUNIT,OBS3_8(1,1,7),5,255,IRET,'DGOT HBOT HTOT')
   2885          IF(IRET.EQ.1) THEN ! reset iret from 1 to 0 if all obs missing
   2886                             !  (iret can be 1 even if all obs missing)
   2887             AMINIMUM_8 = MIN(OBS3_8(1,1,7),OBS3_8(2,1,7),OBS3_8(3,1,7))
   2888             IF(IBFMS(AMINIMUM_8).NE.0)  IRET = 0
   2889          END IF
   2890          NOBS3(7) = IRET
   2891          CALL UFBINT(LUNIT,OBS2_8(27),2,1,IRET,'WDIR1 WSPD1')
   2892       ELSE                                              ! RAOBs, PIBALs
   2893 c HBLCS is replicated for NC002* but is always missng on all but 1st lvl
   2894          CALL UFBINT(LUNIT,OBS2_8(24),1,1,IRET,'HBLCS')
   2895       END IF
   2896       OBS2 = OBS2_8
   2897       OBS3 = OBS3_8
   2898 
   2899       CALL S05UBF
   2900  
   2901 C  VERTICAL SIGNIFICANCE DESCRIPTOR TO ASSIGN UNPACKED DATA LEVEL
   2902 C   CATEGORY
   2903 C  --------------------------------------------------------------
   2904 
   2905 C NOTE: MNEMONIC "VSIG" 008001 IS DEFINED AS VERTICAL SOUNDING
   2906 C       SIGNIFICANCE -- CODE TABLE FOLLOWS:
   2907 C        64   Surface 
   2908 C              processed as unpacked category 2 and/or 3 and/or 4

Page 74          Source Listing                  R03UBF
2017-04-18 11:09                                 iw3unpbf.f

   2909 C        32   Standard (mandatory) level
   2910 C              processed as unpacked category 1
   2911 C        16   Tropopause level
   2912 C              processed as unpacked category 5
   2913 C         8   Maximum wind level
   2914 C              processed as unpacked category 3 or 4
   2915 C         4   Significant level, temperature
   2916 C              processed as unpacked category 2
   2917 C         2   Significant level, wind
   2918 C              processed as unpacked category 3 or 4
   2919 C
   2920 C NOTE: THIS SUBR. ASSIGNS VSIG=1 TO LEVELS THAT SHOULD BE
   2921 C       PROCESSED AS UNPACKED CATEGORY 6 (ONLY APPLIES TO
   2922 C       RECCOS)
   2923 C
   2924 C  anything else - the level is not processed
   2925  
   2926       CALL UFBINT(LUNIT,VSG_8,1,255,NLEV,'VSIG');VSG=VSG_8
   2927  
   2928 C  PUT THE HEADER INFORMATION INTO UNPACKED FORMAT
   2929 C  -----------------------------------------------
   2930  
   2931       CALL UFBINT(LUNIT,HDR_8,12,  1,IRET,HDSTR);HDR=HDR_8
   2932       IF(HDR(5).GE.BMISS) HDR(5) = 0
   2933       CALL UFBINT(LUNIT,RID_8,1,1,IRET,'RPID')
   2934 cccc  IF(IRET.NE.1.OR.(RID_8.GT.BMISS-5000..AND.RID_8.LT.BMISS+5000.))
   2935 cccc $  SID = 'MISSING '
   2936 cxxxx
   2937 cpppppppppp
   2938 cc    print'(" rid_8,icbfms(sid,8): ",G0,1X,I0)', rid_8,icbfms(sid,8)
   2939 cpppppppppp
   2940 
   2941 ccccc IF(ICBFMS(SID,8).NE.0)  SID = 'MISSING '
   2942 C above line not working right - may return 0 when missing, so use next
   2943 C  two lines below temporarily until this is fixed (readlc will return
   2944 C  all blanks for sid when mnemonic "RPID" not found) - dak 2/19/13
   2945          call readlc(lunit,sid,'RPID')
   2946 cpppppppppp
   2947 cc       print'(" sid = """,A,"""")', sid
   2948 cpppppppppp
   2949          if(sid.eq.'        ')  sid = 'MISSING '
   2950 cxxxx
   2951 cppppp-ID
   2952       iprint = 0
   2953 cc         iprint = 1
   2954 c     if(sid.eq.'89571   ')  iprint = 1
   2955 c     if(sid.eq.'68906   ')  iprint = 1
   2956 c     if(sid.eq.'68842   ')  iprint = 1
   2957 c     if(sid.eq.'59362   ')  iprint = 1
   2958 c     if(sid.eq.'57957   ')  iprint = 1
   2959 c     if(sid.eq.'74794   ')  iprint = 1
   2960 c     if(sid.eq.'74389   ')  iprint = 1
   2961 c     if(sid.eq.'96801A  ')  iprint = 1
   2962       if(iprint.eq.1)
   2963      $ print'(" @@@ START DIAGNOSTIC PRINTOUT FOR ID ",A)', sid
   2964 cppppp-ID
   2965 

Page 75          Source Listing                  R03UBF
2017-04-18 11:09                                 iw3unpbf.f

   2966       RGP10  = BMISS
   2967       PRGP10 = BMISS
   2968       CALL UFBINT(LUNIT,RPMSL_8,1,  1,IRET,'PMSL');RPMSL=RPMSL_8
   2969       IF(SUBSET.EQ.'NC004005')  THEN
   2970          CALL UFBINT(LUNIT,RGP10_8,1,255,NLEV,'GP10');RGP10=RGP10_8
   2971          CALL UFBINT(LUNIT,RPSAL_8,1,1,IRET,'PSAL');RPSAL=RPSAL_8
   2972          IF(NINT(VSG(1)).EQ.32.AND.RPMSL.GE.BMISS.AND.
   2973      $    MAX(RGP10(1),RPSAL).LT.BMISS)  THEN
   2974 cpppppppppp
   2975 cc          print'(" ~~IW3UNPBF/R03UBF: ID ",A," is a Cat. 6 type ",
   2976 cc   $       "RECCO with a mand-lvl GEOPOT")', sid
   2977 cpppppppppp
   2978             VSG(1) = 1
   2979             CALL UFBINT(LUNIT,PRGP10_8,1,255,NLEV,'PRLC')
   2980             PRGP10=PRGP10_8
   2981             HDR(6) = RPSAL + SIGN(0.0000001,RPSAL)
   2982          ELSE  IF(MIN(VSG(1),RPMSL,RGP10(1)).GE.BMISS.AND.RPSAL.LT.
   2983      $    BMISS)  THEN
   2984 cpppppppppp
   2985 cc          print'(" ~~IW3UNPBF/R03UBF: ID ",A," is a Cat. 6 type ",
   2986 cc   $       "RECCO")', sid
   2987 cpppppppppp
   2988             VSG(1) = 1
   2989             HDR(6) = RPSAL + SIGN(0.0000001,RPSAL)
   2990          ELSE  IF(MIN(VSG(1),RGP10(1)).GE.BMISS.AND.MAX(RPMSL,RPSAL)
   2991      $    .LT.BMISS)  THEN
   2992 cpppppppppp
   2993 cc          print'(" ~~IW3UNPBF/R03UBF: ID ",A," is a Cat. 6 type ",
   2994 cc   $       "RECCO with a valid PMSL")', sid
   2995 cpppppppppp
   2996             VSG(1) = 1
   2997             HDR(6) = RPSAL + SIGN(0.0000001,RPSAL)
   2998          ELSE
   2999             print'(" ~~IW3UNPBF/R03UBF: ID ",A," is currently an ",
   3000      $       "unknown type of RECCO - VSIG =",G0,"; PMSL =",G0,"; GP10",
   3001      $       " =",G0," -- SKIP IT for now")', sid,VSG(1),RPMSL,RGP10(1)
   3002             R03UBF = -9999
   3003             KSKUPA =KSKUPA + 1
   3004             RETURN
   3005          END IF
   3006       END IF
   3007 
   3008       obs8_8(1) = hdr_8(3)
   3009       obs8_8(2) = hdr_8(2)
   3010 
   3011       XOB = HDR(2)
   3012       YOB = HDR(3)
   3013 
   3014       RHR = BMISS
   3015       IF(HDR(4).LT.BMISS)  RHR = NINT(HDR(4))+NINT(HDR(5))/60.
   3016 
   3017       RCTIM = BMISS
   3018       RSV1 = '        '
   3019       RSV2 = '        '
   3020       ELV = HDR(6)
   3021       QMELV = XMISS
   3022      

Page 76          Source Listing                  R03UBF
2017-04-18 11:09                                 iw3unpbf.f

   3023       CALL UFBINT(LUNIT,RAT_8, 1,255,NLEV,'RATP');RAT=RAT_8
   3024       ITP = MIN(IMISS,NINT(RAT(1)))
   3025       RTP = ERTUBF(SUBSET,SID)
   3026       IDS = IMISS
   3027       IF(ELV.GE.BMISS)  THEN
   3028          IF((RTP.GT.20.AND.RTP.LT.24).OR.SUBSET.EQ.'NC002004')  THEN
   3029             print'(" IW3UNPBF/R03UBF: ID ",A," has a missing elev, so ",
   3030      $       "elevation set to ZERO")', sid
   3031             ELV = 0
   3032          ELSE
   3033             print'(" ~~IW3UNPBF/R03UBF: ID ",A," has a missing elev")',
   3034      $       sid
   3035          END IF
   3036       END IF
   3037 cdak  if(sid(5:5).eq.' ') print, sid
   3038       IF(L02UBF(SID).AND.SID(5:5).EQ.' ') SID = '0'//SID
   3039       RSTP = IMISS
   3040       IF(RTP.EQ.31)  THEN
   3041          IF(SUBSET.EQ.'NC004005')  THEN
   3042             RSTP = 1
   3043          ELSE
   3044             RSTP = 2
   3045          END IF
   3046       END IF
   3047       CALL S01UBF(SID,XOB,YOB,RHR,RCTIM,RSV1,RSV2,ELV,QMELV,ITP,RTP,
   3048      $ RSTP,IDS)
   3049  
   3050 C  PUT THE LEVEL DATA INTO SPECIFIED UNPACKED FORMAT
   3051 C  -------------------------------------------------
   3052  
   3053       CALL UFBINT(LUNIT,ARR_8,10,255,NLEV,LVSTR);ARR=ARR_8
   3054 
   3055       PWMIN = 999999.
   3056 
   3057       DO L=1,NLEV
   3058 
   3059          POB(L) = BMISS
   3060          IF(ARR(1,L).LT.BMISS)  POB(L) = NINT(ARR(1,L)*.1)
   3061          
   3062          IF(NINT(ARR(1,L)).LE.0) THEN
   3063             POB(L) =  BMISS
   3064             print'(" ~~@@IW3UNPBF/R03UBF: ID ",A," has a ZERO or ",
   3065      $       "negative reported pressure that is reset to missing")',
   3066      $       sid
   3067          END IF
   3068 
   3069          QOB(L) = BMISS
   3070          IF(ARR(2,L).LT.BMISS .AND. ARR(3,L).LT.BMISS)
   3071      $    QOB(L) = (ARR(3,L)-ARR(2,L))*10.
   3072 
   3073          TOB(L) = BMISS
   3074          IF(ARR(3,L).LT.BMISS) THEN
   3075             ITMP = NINT(ARR(3,L)*100.)
   3076             TOB(L) = NINT((ITMP-27315)*0.1)
   3077          END IF
   3078 
   3079          XXX = BMISS

Page 77          Source Listing                  R03UBF
2017-04-18 11:09                                 iw3unpbf.f

   3080          IF(ARR(4,L).LT.BMISS) XXX = (ARR(4,L)/GRAV)
   3081          YYY = BMISS
   3082          IF(ARR(5,L).LT.BMISS) YYY = (ARR(5,L)/GRAV)
   3083          ZOB(L) = MIN(XXX,YYY)
   3084 
   3085          DOB(L) = ARR(6,L)
   3086          SOB(L) = MIN(ARR(7,L)*10.,BMISS)
   3087          IF(NINT(DOB(L)).EQ.0.AND.NINT(SOB(L)).GT.0)  THEN
   3088             DOB(L) = 360
   3089          ELSE  IF(NINT(DOB(L)).EQ.360.AND.NINT(SOB(L)).EQ.0)  THEN
   3090             DOB(L) = 0
   3091          END IF
   3092          if(iprint.eq.1)  then
   3093             print'(" At lvl=",I0,"; VSG=",G0,"; POB = ",G0,"; QOB = ",
   3094      $       G0,"; TOB = ",G0,"; ZOB = ",G0,"; DOB = ",G0,"; SOB = ",
   3095      $       G0)', L,vsg(L),pob(L),qob(L),tob(L),zob(L),dob(L),sob(L)
   3096          end if
   3097          IF(MAX(POB(L),DOB(L),SOB(L)).LT.BMISS) PWMIN =MIN(PWMIN,POB(L))
   3098       ENDDO
   3099 
   3100       CALL UFBINT(LUNIT,ARR_8,10,255,NLEV,QMSTR);ARR=ARR_8
   3101 
   3102       DO L=1,NLEV
   3103          PQM(L) = EQMUBF(ARR(1,L))
   3104          TQM(L) = EQMUBF(ARR(2,L))
   3105          QQM(L) = EQMUBF(ARR(3,L))
   3106          ZQM(L) = EQMUBF(ARR(4,L))
   3107          WQM(L) = EQMUBF(ARR(5,L))
   3108       ENDDO
   3109 
   3110 C  SURFACE DATA MUST GO FIRST
   3111 C  --------------------------
   3112  
   3113       CALL S02UBF(2,0,*9999)

Page 78          Source Listing                  R03UBF
2017-04-18 11:09 Entry Points                    iw3unpbf.f



ENTRY POINTS

  Name               
                     
 r03ubf_             


SYMBOL CROSS REFERENCE

 Name                       Object Declared Type            Bytes Dimen Elements Attributes       References                        
                                                                                                                                    
 887                        Label  3442                                                           3441                              
 9997                       Label  3552                                                           3543                              
 9998                       Label  3549                                                           3543                              
 9999                       Label  3546                                                           3113,3114,3115,3258,3283,3290,3329
                                                                                                  ,3354,3377,3409,3425,3493,3503,351
                                                                                                  5,3522,3530,3537,3543             
 AMINIMUM_8                 Local  2820     R(8)            8           scalar   SAVE             2864,2866,2880,2881,2887,2888     
 ARR                        Local  2822     R(4)            4     2     2550     SAVE             3053,3060,3062,3070,3071,3074,3075
                                                                                                  ,3080,3082,3085,3086,3100,3103,310
                                                                                                  4,3105,3106,3107                  
 ARR_8                      Local  2819     R(8)            8     2     2550     SAVE             3053,3100                         
 BMISS                      Scalar 2803     R(8)            8           scalar   COM              2853,2854,2856,2932,2966,2967,2972
                                                                                                  ,2973,2982,2983,2990,2991,3014,301
                                                                                                  5,3017,3027,3059,3060,3063,3069,30
                                                                                                  70,3073,3074,3079,3080,3081,3082,3
                                                                                                  086,3097,3120,3121,3122,3129,3132,
                                                                                                  3133,3136,3137,3152,3160,3179,3190
                                                                                                  ,3206,3214,3246,3269,3297,3304,330
                                                                                                  5,3306,3307,3332,3333,3363,3364,33
                                                                                                  88,3411,3412,3491,3498,3506,3517,3
                                                                                                  525,3532                          
 CF8                        Scalar 2810     R(4)            4     1     255      COM              3488,3499,3511,3518,3526,3533     
 DOB                        Scalar 2809     R(4)            4     1     255      COM              3085,3087,3088,3089,3090,3095,3097
                                                                                                  ,3133,3136,3137,3160,3162,3190,319
                                                                                                  2,3214,3216,3246,3333,3364,3412,34
                                                                                                  47                                
 ELV                        Local  3020     R(4)            4           scalar   SAVE             3020,3027,3031,3047,3298          
 EQMUBF                     Func   3103     R(4)            4           scalar                    3103,3104,3105,3106,3107          
 ERTUBF                     Func   3025     R(4)            4           scalar                    3025                              
 ES                         Local  2843     R(4)            4           scalar                    2844                              
 EXP                        Func   2838                                 scalar                    2838,2843                         
 GRAV                       Local  2835     R(4)            4           scalar   SAVE             2835,3080,3082,3507               
 HDR                        Scalar 2807     R(4)            4     1     12       COM              2931,2932,2981,2989,2997,3011,3012
                                                                                                  ,3015,3020                        
 HDR_8                      Local  2818     R(8)            8     1     12       SAVE             2931,3008,3009                    
 HDSTR                      Local  2816     CHAR            80          scalar   SAVE             2830,2931                         
 I04UBF                     Func   3240     I(4)            4           scalar                    3240                              
 IBFMS                      Func   2859     I(4)            4           scalar                    2859,2866,2874,2881,2888          
 IDS                        Local  3026     I(4)            4           scalar   SAVE             3026,3048                         
 II                         Local  3151     I(4)            4           scalar   SAVE             3151,3152,3158,3160,3161,3162,3178
                                                                                                  ,3179,3185,3188,3189,3190,3191,319
                                                                                                  2,3205,3206,3212,3214,3215,3216,32
                                                                                                  68,3269,3275,3340,3341,3346,3395,3
                                                                                                  396,3401                          

Page 79          Source Listing                  R03UBF
2017-04-18 11:09 Symbol Table                    iw3unpbf.f

 Name                       Object Declared Type            Bytes Dimen Elements Attributes       References                        
                                                                                                                                    
 IKAT                       Scalar 2807     I(4)            4     1     8        COM                                                
 IMISS                      Local  2835     I(4)            4           scalar   SAVE             2835,3024,3026,3039,3490,3492,3501
                                                                                                  ,3502,3520,3521,3528,3529,3535,353
                                                                                                  6                                 
 INDX16                     Local  3119     I(4)            4           scalar   SAVE             3119,3229,3230,3267,3268,3339,3340
                                                                                                  ,3394,3395                        
 INDX2                      Local  3117     I(4)            4           scalar   SAVE             3117,3149,3177,3178               
 INDX8                      Local  3118     I(4)            4           scalar   SAVE             3118,3150,3151,3176,3204,3205     
 INT                        Func   3510                                 scalar                    3510                              
 IPRINT                     Local  2952     I(4)            4           scalar   SAVE             2952,2962,3092,3126,3129,3133,3138
                                                                                                  ,3154,3163,3181,3193,3208,3217,324
                                                                                                  7,3253,3263,3271,3286,3293,3334,33
                                                                                                  42,3356,3365,3379,3389,3397,3413,3
                                                                                                  427,3508                          
 IRET                       Local  2857     I(4)            4           scalar   SAVE             2857,2858,2860,2862,2866,2868,2871
                                                                                                  ,2872,2874,2876,2877,2878,2881,288
                                                                                                  3,2884,2885,2888,2890,2891,2894,29
                                                                                                  31,2933,2968,2971                 
 ITMP                       Local  3075     I(4)            4           scalar   SAVE             3075,3076                         
 ITP                        Local  3024     I(4)            4           scalar   SAVE             3024,3047                         
 IUBFAA                     Common 2803                                 8        SAVE                                               
 IUBFBB                     Common 2804                                 100      SAVE                                               
 IUBFCC                     Common 2806                                 8        SAVE                                               
 IUBFDD                     Common 2807                                 480176   SAVE                                               
 IUBFEE                     Common 2809                                 9180     SAVE                                               
 IUBFFF                     Common 2811                                 5100     SAVE                                               
 IUBFII                     Common 2812                                 4        SAVE                                               
 IUBFLL                     Common 2813                                 2040     SAVE                                               
 IUBFMM                     Common 2814                                 1020     SAVE                                               
 KFLSAT                     Scalar 2804     I(4)            4     1     12       COM                                                
 KNDX                       Scalar 2804     I(4)            4           scalar   COM                                                
 KSKACF                     Scalar 2804     I(4)            4     1     8        COM                                                
 KSKSAT                     Scalar 2804     I(4)            4           scalar   COM                                                
 KSKSFC                     Scalar 2804     I(4)            4           scalar   COM                                                
 KSKSMI                     Scalar 2805     I(4)            4           scalar   COM                                                
 KSKUPA                     Scalar 2804     I(4)            4           scalar   COM              3003,3554                         
 L                          Local  3057     I(4)            4           scalar   SAVE             3057,3059,3060,3062,3063,3069,3070
                                                                                                  ,3071,3073,3074,3075,3076,3080,308
                                                                                                  2,3083,3085,3086,3087,3088,3089,30
                                                                                                  90,3095,3097,3102,3103,3104,3105,3
                                                                                                  106,3107,3124,3125,3127,3129,3132,
                                                                                                  3133,3136,3137,3143,3144,3146,3147
                                                                                                  ,3148,3149,3152,3158,3161,3162,316
                                                                                                  6,3169,3174,3175,3176,3179,3185,31
                                                                                                  89,3191,3192,3196,3199,3206,3212,3
                                                                                                  215,3216,3220,3223,3228,3230,3238,
                                                                                                  3239,3240,3244,3246,3249,3251,3256
                                                                                                  ,3258,3259,3262,3265,3269,3275,327
                                                                                                  8,3283,3284,3285,3288,3290,3291,32
                                                                                                  92,3295,3297,3298,3305,3306,3307,3
                                                                                                  308,3309,3310,3312,3314,3316,3329,
                                                                                                  3330,3331,3332,3333,3337,3341,3346
                                                                                                  ,3349,3354,3359,3362,3363,3364,336
                                                                                                  8,3375,3377,3382,3385,3387,3388,33
                                                                                                  92,3396,3401,3404,3409,3410,3411,3

Page 80          Source Listing                  R03UBF
2017-04-18 11:09 Symbol Table                    iw3unpbf.f

 Name                       Object Declared Type            Bytes Dimen Elements Attributes       References                        
                                                                                                                                    
                                                                                                  412,3416,3423,3425,3430,3433,3440,
                                                                                                  3441,3447,3448,3487,3488,3489,3490
                                                                                                  ,3491,3492,3493                   
 L02UBF                     Func   2826     L(4)            4           scalar                    3038                              
 LEVLIM                     Param  2801     I(4)            4           scalar                    2807                              
 LL                         Local  3240     I(4)            4           scalar   SAVE             3240,3241                         
 LOOP1                      Label  3124                                 scalar                    3170,3200,3224,3232               
 LOOP1N1                    Label  3151                                 scalar                    3172                              
 LOOP1N2                    Label  3178                                 scalar                    3202                              
 LOOP1N3                    Label  3205                                 scalar                    3226                              
 LUNIT                      Dummy  2798     I(4)            4           scalar   ARG,INOUT        2857,2858,2860,2871,2877,2884,2891
                                                                                                  ,2894,2926,2931,2933,2945,2968,297
                                                                                                  0,2971,2979,3023,3053,3100,3467,34
                                                                                                  96                                
 LVDX                       Scalar 2808     I(4)            4     1     8        COM                                                
 LVSTR                      Local  2816     CHAR            80          scalar   SAVE             2831,3053                         
 MAX                        Func   2973                                 scalar                    2973,2990,3097,3137,3160,3190,3214
                                                                                                  ,3307,3333,3364,3412,3498,3506    
 MCAT                       Scalar 2808     I(4)            4     1     8        COM                                                
 MIN                        Func   2864                                 scalar                    2864,2880,2887,2982,2990,3024,3083
                                                                                                  ,3086,3097,3246                   
 MOD                        Func   3509                                 scalar                    3509                              
 NCAT                       Scalar 2808     I(4)            4     1     8        COM                                                
 NINT                       Func   2972                                 scalar                    2972,3015,3024,3060,3062,3075,3076
                                                                                                  ,3087,3089,3125,3147,3152,3174,317
                                                                                                  9,3189,3206,3228,3239,3262,3269,32
                                                                                                  85,3292,3309,3331,3341,3387,3396,3
                                                                                                  440,3441,3489,3491,3500,3507,3509,
                                                                                                  3512,3513,3519,3527,3534          
 NLEV                       Local  2926     I(4)            4           scalar   SAVE             2926,2970,2979,3023,3053,3057,3100
                                                                                                  ,3102,3124,3238                   
 NOBS3                      Dummy  2798     I(4)            4     1     7        ARG,INOUT        2855,2868,2876,2883,2890          
 NRCT                       Local  3467     I(4)            4           scalar   SAVE             3467,3487                         
 NRMORE                     Local  3496     I(4)            4           scalar   SAVE             3496                              
 NUMCAT                     Param  2801     I(4)            4           scalar                    2807,2808                         
 OB8                        Scalar 2810     R(4)            4     1     255      COM              3489,3500,3512,3519,3527,3534     
 OBS                        Dummy  2798     R(4)            4     1     0        ARG,INOUT        3543                              
 OBS2                       Dummy  2798     R(4)            4     1     43       ARG,INOUT        2896                              
 OBS2_8                     Local  2818     R(8)            8     1     43       SAVE             2853,2857,2858,2859,2891,2894,2896
 OBS3                       Dummy  2798     R(4)            4     3     8925     ARG,INOUT        2897                              
 OBS3_8                     Local  2818     R(8)            8     3     8925     SAVE             2854,2860,2864,2865,2871,2874,2877
                                                                                                  ,2880,2884,2887,2897              
 OBS8_8                     Dummy  2798     R(8)            8     1     2        ARG,INOUT        2856,3008,3009                    
 P                          Local  3310     R(4)            4           scalar   SAVE             3310,3312,3315                    
 P16                        Local  2823     R(4)            4     1     255      SAVE             3122,3230,3269,3341,3396          
 P2                         Local  2822     R(4)            4     1     255      SAVE             3120,3148,3179                    
 P8                         Local  2823     R(4)            4     1     255      SAVE             3121,3152,3175,3206               
 POB                        Scalar 2809     R(4)            4     1     255      COM              3059,3060,3063,3095,3097,3129,3132
                                                                                                  ,3133,3136,3148,3152,3175,3179,318
                                                                                                  9,3206,3230,3240,3244,3269,3297,33
                                                                                                  32,3341,3388,3396,3447            
 PQM                        Scalar 2811     R(4)            4     1     255      COM              3103                              
 PRGP10                     Local  2822     R(4)            4     1     255      SAVE             2967,2980,3506,3513               
 PRGP10_8                   Local  2820     R(8)            8     1     255      SAVE             2979,2980                         
 PRS1                       Local  2837     R(4)            4           scalar                    3310                              

Page 81          Source Listing                  R03UBF
2017-04-18 11:09 Symbol Table                    iw3unpbf.f

 Name                       Object Declared Type            Bytes Dimen Elements Attributes       References                        
                                                                                                                                    
 PRS2                       Local  2838     R(4)            4           scalar                    3312                              
 PWMIN                      Scalar 2812     R(4)            4           scalar   COM              3055,3097,3189                    
 Q81                        Scalar 2813     R(4)            4     1     255      COM              3490,3491,3501,3513,3520,3528,3535
 Q82                        Scalar 2813     R(4)            4     1     255      COM              3492,3502,3514,3521,3529,3536     
 QFRMTP                     Local  2844     R(4)            4           scalar                    3315                              
 QMELV                      Local  3021     R(4)            4           scalar   SAVE             3021,3047                         
 QMSTR                      Local  2816     CHAR            80          scalar   SAVE             2832,3100                         
 QOB                        Scalar 2809     R(4)            4     1     255      COM              3069,3071,3095,3305,3306,3316,3447
 QQ                         Local  3315     R(4)            4           scalar   SAVE             3315,3316                         
 QQM                        Scalar 2811     R(4)            4     1     255      COM              3105                              
 R03UBF                     Func   2798     R(4)            4           scalar                    2846,3002,3547,3553               
 R03UBF@0                   Local  2798     R(4)            4           scalar   SAVE                                               
 RAT                        Local  2822     R(4)            4     1     255      SAVE             3023,3024                         
 RAT_8                      Local  2819     R(8)            8     1     255      SAVE             3023                              
 RCATS                      Scalar 2807     R(4)            4     3     120000   COM                                                
 RCSTR                      Local  2816     CHAR            80          scalar   SAVE             2833,3467                         
 RCT                        Local  2821     R(4)            4     2     1275     SAVE             3467,3489,3491                    
 RCTIM                      Local  3017     R(4)            4           scalar   SAVE             3017,3047                         
 RCT_8                      Local  2819     R(8)            8     2     1275     SAVE             3467                              
 READLC                     Subr   2945                                                           2945                              
 RGP10                      Local  2822     R(4)            4     1     255      SAVE             2966,2970,2973,2982,2990,3001,3506
                                                                                                  ,3507,3508,3509,3510,3512         
 RGP10_8                    Local  2819     R(8)            8     1     255      SAVE             2970                              
 RHR                        Local  3014     R(4)            4           scalar   SAVE             3014,3015,3047                    
 RID_8                      Local  2818     R(8)            8           scalar   SAVE             2933                              
 RMORE                      Local  2822     R(4)            4     1     4        SAVE             3497,3498,3500,3525,3527,3532,3534
 RMORE_8                    Local  2819     R(8)            8     1     4        SAVE             3496,3497                         
 RPMSL                      Local  2968     R(4)            4           scalar   SAVE             2968,2972,2982,2990,3001,3517,3519
 RPMSL_8                    Local  2820     R(8)            8           scalar   SAVE             2968                              
 RPSAL                      Local  2971     R(4)            4           scalar   SAVE             2971,2973,2981,2982,2989,2990,2997
 RPSAL_8                    Local  2820     R(8)            8           scalar   SAVE             2971                              
 RSTP                       Local  3039     R(4)            4           scalar   SAVE             3039,3042,3044,3048               
 RSV1                       Local  2817     CHAR            8           scalar   SAVE             3018,3047                         
 RSV2                       Local  2817     CHAR            8           scalar   SAVE             3019,3047                         
 RTP                        Local  3025     R(4)            4           scalar   SAVE             3025,3028,3040,3047               
 S01UBF                     Subr   3047                                                           3047                              
 S02UBF                     Subr   3113                                                           3113,3114,3115,3258,3283,3290,3329
                                                                                                  ,3354,3377,3409,3425,3493,3503,351
                                                                                                  5,3522,3530,3537                  
 S03UBF                     Subr   3543                                                           3543                              
 S05UBF                     Subr   2899                                                           2899                              
 SE01UBF                    Subr   3132                                                           3132,3136,3144                    
 SID                        Local  2817     CHAR            8           scalar   SAVE             2945,2949,2963,3001,3025,3030,3034
                                                                                                  ,3038,3047,3066,3244,3441,3551    
 SIGN                       Func   2981                                 scalar                    2981,2989,2997                    
 SOB                        Scalar 2810     R(4)            4     1     255      COM              3086,3087,3089,3095,3097,3160,3161
                                                                                                  ,3190,3191,3214,3215,3333,3364,341
                                                                                                  2,3448                            
 SUBSET                     Scalar 2806     CHAR            8           scalar   COM              2870,2969,3025,3028,3041,3505,3543
 TD                         Local  3314     R(4)            4           scalar   SAVE             3314,3315                         
 TDD                        Local  3304     R(4)            4           scalar   SAVE             3304,3305,3307,3314               
 TOB                        Scalar 2809     R(4)            4     1     255      COM              3073,3076,3095,3129,3132,3246,3307
                                                                                                  ,3314,3447                        
 TQM                        Scalar 2811     R(4)            4     1     255      COM              3104                              
 UFBINT                     Subr   2857                                                           2857,2858,2860,2871,2877,2884,2891

Page 82          Source Listing                  R03UBF
2017-04-18 11:09 Symbol Table                    iw3unpbf.f

 Name                       Object Declared Type            Bytes Dimen Elements Attributes       References                        
                                                                                                                                    
                                                                                                  ,2894,2926,2931,2933,2968,2970,297
                                                                                                  1,2979,3023,3053,3100,3467,3496   
 VSG                        Scalar 2810     R(4)            4     1     255      COM              2926,2972,2978,2982,2988,2990,2996
                                                                                                  ,3001,3095,3125,3146,3147,3169,317
                                                                                                  4,3199,3223,3228,3239,3251,3259,32
                                                                                                  62,3284,3285,3291,3292,3330,3331,3
                                                                                                  362,3385,3387,3410,3433,3440,3441 
 VSG_8                      Local  2818     R(8)            8     1     255      SAVE             2926                              
 WQM                        Scalar 2811     R(4)            4     1     255      COM              3107                              
 XIND                       Scalar 2814     R(4)            4     1     255      COM              3188,3189,3278,3349,3404          
 XMISS                      Local  2835     R(4)            4           scalar   SAVE             2835,3021,3308                    
 XOB                        Local  3011     R(4)            4           scalar   SAVE             3011,3047                         
 XXX                        Local  3079     R(4)            4           scalar   SAVE             3079,3080,3083                    
 YOB                        Local  3012     R(4)            4           scalar   SAVE             3012,3047                         
 YYY                        Local  3081     R(4)            4           scalar   SAVE             3081,3082,3083                    
 ZOB                        Scalar 2809     R(4)            4     1     255      COM              3083,3095,3137,3246,3298,3308,3309
                                                                                                  ,3310,3312,3363,3411,3447         
 ZQM                        Scalar 2811     R(4)            4     1     255      COM              3106,3143,3375,3423               

Page 83          Source Listing                  R03UBF
2017-04-18 11:09                                 iw3unpbf.f

   3114       CALL S02UBF(3,0,*9999)
   3115       CALL S02UBF(4,0,*9999)
   3116 
   3117       INDX2  = 0
   3118       INDX8  = 0
   3119       INDX16 = 0
   3120       P2  = BMISS
   3121       P8  = BMISS
   3122       P16 = BMISS
   3123 
   3124       LOOP1: DO L=1,NLEV
   3125          IF(NINT(VSG(L)).EQ.64) THEN
   3126             if(iprint.eq.1)  then
   3127                print'(" Lvl=",I0," is a surface level")', L
   3128             end if
   3129             if(iprint.eq.1.and.POB(L).LT.BMISS.AND.TOB(L).LT.BMISS) then
   3130                print'(" --> valid cat. 2 sfc. lvl ")'
   3131             end if
   3132             IF(POB(L).LT.BMISS.AND.TOB(L).LT.BMISS)  CALL SE01UBF(2,L)
   3133             if(iprint.eq.1.and.POB(L).LT.BMISS.AND.DOB(L).LT.BMISS) then
   3134                print'(" --> valid cat. 3 sfc. lvl ")'
   3135             end if
   3136             IF(POB(L).LT.BMISS.AND.DOB(L).LT.BMISS)  CALL SE01UBF(3,L)
   3137             IF(MAX(ZOB(L),DOB(L)).LT.BMISS) THEN
   3138                if(iprint.eq.1)  print'(" --> valid cat. 4 sfc. lvl ")'
   3139 
   3140 C  DATA LEVEL CATEGORY 4 HEIGHT DOES NOT PASS ON A KEEP, PURGE, OR REJECT
   3141 C   LIST Q.M.
   3142 
   3143                ZQM(L) = 2
   3144                CALL SE01UBF(4,L)
   3145             END IF
   3146             VSG(L) = 0
   3147          ELSE  IF(NINT(VSG(L)).EQ.2)  THEN
   3148             P2(L) = POB(L)
   3149             INDX2 = L
   3150             IF(INDX8.GT.0)  THEN
   3151                LOOP1n1: DO II = 1,INDX8
   3152                   IF(NINT(POB(L)).EQ.NINT(P8(II)).AND.POB(L).LT.BMISS)
   3153      $             THEN
   3154                      if(iprint.eq.1)  then
   3155                         print'(" ## This cat. 3 level, on lvl ",I0,
   3156      $                   " will have already been processed as a cat. ",
   3157      $                   "3 MAX wind lvl (on lvl ",I0,") - skip this ",
   3158      $                   "Cat. 3 lvl")', L,II
   3159                      end if
   3160                      IF(MAX(SOB(II),DOB(II)).GE.BMISS)  THEN
   3161                         SOB(II) = SOB(L)
   3162                         DOB(II) = DOB(L)
   3163                         if(iprint.eq.1)  then
   3164                            print'("  ...... also on lvl ",I0," - ",
   3165      $                      "transfer wind data to dupl. MAX wind lvl ",
   3166      $                      "because its missing there")', L
   3167                         end if
   3168                      END IF
   3169                      VSG(L) = 0
   3170                      CYCLE LOOP1

Page 84          Source Listing                  R03UBF
2017-04-18 11:09                                 iw3unpbf.f

   3171                   END IF
   3172                ENDDO LOOP1n1
   3173             END IF
   3174          ELSE  IF(NINT(VSG(L)).EQ.8)  THEN
   3175             P8(L) = POB(L)
   3176             INDX8 = L
   3177             IF(INDX2.GT.0)  THEN
   3178                LOOP1n2: DO II = 1,INDX2
   3179                   IF(NINT(POB(L)).EQ.NINT(P2(II)).AND.POB(L).LT.BMISS)
   3180      $             THEN
   3181                      if(iprint.eq.1)  then
   3182                         print'("  ## This MAX wind level, on lvl ",I0,
   3183      $                   " will have already been processed as a cat. ",
   3184      $                   "3 lvl (on lvl ",I0,") - skip this MAX wind ",
   3185      $                   "lvl but set")', L,II
   3186                         print'("     cat. 3 lvl XIND to ""2""")'
   3187                      end if
   3188                      XIND(II) = 2
   3189                      IF(NINT(POB(L)).EQ.NINT(PWMIN))  XIND(II) = 3
   3190                      IF(MAX(SOB(II),DOB(II)).GE.BMISS)  THEN
   3191                         SOB(II) = SOB(L)
   3192                         DOB(II) = DOB(L)
   3193                         if(iprint.eq.1)  then
   3194                            print'(" ...... also on lvl ",I0," - ",
   3195      $                      "transfer wind data to dupl. cat. 3 lvl ",
   3196      $                      "because its missing there")', L
   3197                         end if
   3198                      END IF
   3199                      VSG(L) = 0
   3200                      CYCLE LOOP1
   3201                   END IF
   3202                ENDDO LOOP1n2
   3203             END IF
   3204             IF(INDX8-1.GT.0)  THEN
   3205                LOOP1n3: DO II = 1,INDX8-1
   3206                   IF(NINT(POB(L)).EQ.NINT(P8(II)).AND.POB(L).LT.BMISS)
   3207      $             THEN
   3208                      if(iprint.eq.1)  then
   3209                         print'(" ## This cat. 3 MAX wind lvl, on lvl ",
   3210      $                   I0," will have already been processed as a ",
   3211      $                   "cat. 3 MAX wind lvl (on lvl ",I0,") - skip ",
   3212      $                   "this Cat. 3 MAX wind lvl")', L,II
   3213                      end if
   3214                      IF(MAX(SOB(II),DOB(II)).GE.BMISS)  THEN
   3215                         SOB(II) = SOB(L)
   3216                         DOB(II) = DOB(L)
   3217                         if(iprint.eq.1)  then
   3218                            print'(" ...... also on lvl ",I0," - ",
   3219      $                      "transfer wind data to dupl. MAX wind lvl ",
   3220      $                      "because its missing there")', L
   3221                         end if
   3222                      END IF
   3223                      VSG(L) = 0
   3224                      CYCLE LOOP1
   3225                   END IF
   3226                ENDDO LOOP1n3
   3227             END IF

Page 85          Source Listing                  R03UBF
2017-04-18 11:09                                 iw3unpbf.f

   3228          ELSE  IF(NINT(VSG(L)).EQ.16)  THEN
   3229             INDX16 = INDX16 + 1
   3230             P16(INDX16) = POB(L)
   3231          END IF
   3232       ENDDO LOOP1
   3233  
   3234  
   3235 C  REST OF THE DATA
   3236 C  ----------------
   3237  
   3238       DO L=1,NLEV
   3239          IF(NINT(VSG(L)).EQ.32) THEN
   3240             LL = I04UBF(POB(L)*.1)
   3241             IF(LL.LE.0)  THEN
   3242                print'("~~IW3UNPBF/R03UBF: ID ",A," has VSG=32 for lvl ",
   3243      $          I0," but pressure (=",G0,"mb) not mand.!! --> this ",
   3244      $          "level not processed")', sid,L,POB(L)*.1
   3245             ELSE
   3246                IF(MIN(DOB(L),ZOB(L),TOB(L)).GE.BMISS)  THEN
   3247                   if(iprint.eq.1)  then
   3248                      print'(" ==> For lvl ",I0,"; VSG=32 & DOB,ZOB,TOB",
   3249      $                " all missing --> this level not processed")', L
   3250                   end if
   3251                   VSG(L) = 0
   3252                ELSE
   3253                   if(iprint.eq.1)  then
   3254                      print'(" ==> For lvl ",I0,"; VSG=32 & one or more",
   3255      $                " of ZOB,TOB,DOB non-missing --> valid cat. 1 ",
   3256      $                "lvl")', L
   3257                   end if
   3258                   CALL S02UBF(1,L,*9999)
   3259                   VSG(L) = 0
   3260                END IF
   3261             END IF
   3262          ELSE  IF(NINT(VSG(L)).EQ. 4) THEN
   3263             if(iprint.eq.1)  then
   3264                print'(" ==> For lvl ",I0,"; VSG= 4 --> valid cat. 2 ",
   3265      $          "lvl")', L
   3266             end if
   3267             IF(INDX16.GT.0)  THEN
   3268                DO II = 1,INDX16
   3269                   IF(NINT(POB(L)).EQ.NINT(P16(II)).AND.POB(L).LT.BMISS)
   3270      $             THEN
   3271                      if(iprint.eq.1)  then
   3272                         print'(" ## This cat. 2 level, on lvl ",I0,
   3273      $                   " is also the tropopause level, as its ",
   3274      $                   "pressure matches that of trop. lvl no. ",I0,
   3275      $                   " - set this cat. 2")', L,II
   3276                         print'("    lvl XIND to ""1""")'
   3277                      end if
   3278                      XIND(L) = 1
   3279                      EXIT
   3280                   END IF
   3281                ENDDO
   3282             END IF
   3283             CALL S02UBF(2,L,*9999)
   3284             VSG(L) = 0

Page 86          Source Listing                  R03UBF
2017-04-18 11:09                                 iw3unpbf.f

   3285          ELSEIF(NINT(VSG(L)).EQ.16) THEN
   3286             if(iprint.eq.1)  then
   3287                print'(" ==> For lvl ",I0,"; VSG=16 --> valid cat. 5 ",
   3288      $          "lvl")', L
   3289             end if
   3290             CALL S02UBF(5,L,*9999)
   3291             VSG(L) = 0
   3292          ELSEIF(NINT(VSG(L)).EQ. 1) THEN
   3293             if(iprint.eq.1)  then
   3294                print'(" ==> For lvl ",I0,"; VSG=1 --> valid cat. 6 lvl",
   3295      $          " - can only be a Recco")', L
   3296             end if
   3297             POB(L) = BMISS
   3298             ZOB(L) = ELV
   3299 
   3300 C  All data level category 6 reports store specific humidity (g/kg)
   3301 C   as moisture variable
   3302 C  ----------------------------------------------------------------
   3303 
   3304             TDD    = BMISS
   3305             IF(QOB(L).LT.BMISS)  TDD = QOB(L) * 0.1
   3306             QOB(L) = BMISS
   3307             IF(MAX(TOB(L),TDD).LT.BMISS.AND.TDD.GT.0)  THEN
   3308                IF(ZOB(L).LT.XMISS)  THEN
   3309                   IF(NINT(ZOB(L)).LE.11000)  THEN
   3310                      P = PRS1(ZOB(L))
   3311                   ELSE
   3312                      P = PRS2(ZOB(L))
   3313                   END IF
   3314                   TD = ((TOB(L) * 0.1) + 273.15) - TDD
   3315                   QQ = QFRMTP(TD,P)
   3316                   IF(QQ.GT.0.0)  QOB(L) = QQ * 1000.
   3317                END IF
   3318 cpppppppppp
   3319 cc    print'("~#~# For sid = ",A,", a valid tdd = ",G0,"C, a valid tob",
   3320 cc   $ " = ",G0,"C, and a valid zob = ",G0,"m")', sid,tdd,tob(L)*0.1,
   3321 cc   $ zob(L)
   3322 cc    print'("  -- calc. quantities: p = ",G0,"mb, td = ",G0,"K, qq = ",
   3323 cc   $ G0,"kg/kg, qob = ",G0,"g/kg")', p,td,qq,qob(L)
   3324 cpppppppppp
   3325             END IF
   3326 cpppppppppp
   3327 cc    print'("~#~# GOING INTO S02UFB, QOB(L) = ",G0)', qob(L)
   3328 cpppppppppp
   3329             CALL S02UBF(6,L,*9999)
   3330             VSG(L) = 0
   3331          ELSEIF(NINT(VSG(L)).EQ. 2)  THEN
   3332             IF(POB(L).LT.BMISS) THEN
   3333                IF(MAX(SOB(L),DOB(L)).LT.BMISS)  THEN
   3334                if(iprint.eq.1)  then
   3335                   print'(" ==> For lvl ",I0,"; VSG= 2 & POB .ne. ",
   3336      $             "missing --> valid cat. 3 lvl (expect that ZOB is ",
   3337      $             "missing)")', L
   3338                end if
   3339                IF(INDX16.GT.0)  THEN
   3340                   DO II = 1,INDX16
   3341                      IF(NINT(POB(L)).EQ.NINT(P16(II))) THEN

Page 87          Source Listing                  R03UBF
2017-04-18 11:09                                 iw3unpbf.f

   3342                         if(iprint.eq.1)  then
   3343                            print'(" ## This cat. 3 level, on lvl ",I0,
   3344      $                      " is also the tropopause level, as its ",
   3345      $                      "pressure matches that of trop. lvl no. ",
   3346      $                      I0," - set this cat. 3")', L,II
   3347                            print'("    lvl XIND to ""1""")'
   3348                         end if
   3349                         XIND(L) = 1
   3350                         EXIT
   3351                      END IF
   3352                   ENDDO
   3353                END IF
   3354                CALL S02UBF(3,L,*9999)
   3355             ELSE
   3356                if(iprint.eq.1)  then
   3357                   print'(" ==> For lvl ",I0,"; VSG= 2 & POB .ne. ",
   3358      $             "missing --> Cat. 3 level not processed - wind is ",
   3359      $             "missing")', L
   3360                end if
   3361                END IF
   3362                VSG(L) = 0
   3363             ELSE IF(ZOB(L).LT.BMISS) THEN
   3364                IF(MAX(SOB(L),DOB(L)).LT.BMISS)  THEN
   3365                   if(iprint.eq.1)  then
   3366                      print'(" ==> For lvl ",I0,"; VSG= 2 & ZOB .ne. ",
   3367      $                "missing --> valid cat. 4 lvl (POB must always ",
   3368      $                "be missing)")', L
   3369                   end if
   3370 
   3371 C  DATA LEVEL CATEGORY 4 HEIGHT DOES NOT PASS ON A KEEP, PURGE, OR
   3372 C   REJECT LIST Q.M.
   3373 C  ---------------------------------------------------------------
   3374 
   3375                   ZQM(L) = 2
   3376 
   3377                   CALL S02UBF(4,L,*9999)
   3378                ELSE
   3379                   if(iprint.eq.1)  then
   3380                      print'(" ==> For lvl ",I0,"; VSG= 2 & ZOB .ne. ",
   3381      $                "missing --> Cat. 4 level not processed - wind ",
   3382      $                "is missing")', L
   3383                   end if
   3384                END IF
   3385                VSG(L) = 0
   3386             END IF
   3387          ELSEIF(NINT(VSG(L)).EQ. 8)  THEN
   3388             IF(POB(L).LT.BMISS) THEN
   3389                if(iprint.eq.1)  then
   3390                   print'(" ==> For lvl ",I0,"; VSG= 8 & POB .ne. ",
   3391      $             "missing --> valid cat. 3 lvl (expect that ZOB ",
   3392      $             "is missing)")', L
   3393                end if
   3394                IF(INDX16.GT.0)  THEN
   3395                   DO II = 1,INDX16
   3396                      IF(NINT(POB(L)).EQ.NINT(P16(II))) THEN
   3397                         if(iprint.eq.1)  then
   3398                            print'(" ## This cat. 3 level, on lvl ",I0,

Page 88          Source Listing                  R03UBF
2017-04-18 11:09                                 iw3unpbf.f

   3399      $                      " is also the tropopause level, as its ",
   3400      $                      "pressure matches that of trop. lvl no. ",
   3401      $                      I0," - set this cat. 3")', L,II
   3402                            print'("    lvl XIND to ""1""")'
   3403                         end if
   3404                         XIND(L) = 1
   3405                         EXIT
   3406                      END IF
   3407                   ENDDO
   3408                END IF
   3409                CALL S02UBF(3,L,*9999)
   3410                VSG(L) = 0
   3411             ELSE  IF(ZOB(L).LT.BMISS) THEN
   3412                IF(MAX(SOB(L),DOB(L)).LT.BMISS)  THEN
   3413                   if(iprint.eq.1)  then
   3414                      print'(" ==> For lvl ",I0,"; VSG= 8 & ZOB .ne. ",
   3415      $                "missing --> valid cat. 4 lvl (POB must always ",
   3416      $                "be missing)")', L
   3417                   end if
   3418 
   3419 C  DATA LEVEL CATEGORY 4 HEIGHT DOES NOT PASS ON A KEEP, PURGE, OR
   3420 C   REJECT LIST Q.M.
   3421 C  ---------------------------------------------------------------
   3422 
   3423                   ZQM(L) = 2
   3424 
   3425                   CALL S02UBF(4,L,*9999)
   3426                ELSE
   3427                   if(iprint.eq.1)  then
   3428                      print'(" ==> For lvl ",I0,"; VSG= 8 & ZOB .ne. ",
   3429      $                "missing --> Cat. 4 level not processed - wind ",
   3430      $                "is missing")', L
   3431                   end if
   3432                END IF
   3433                VSG(L) = 0
   3434             END IF
   3435          END IF
   3436  
   3437 C  CHECK FOR LEVELS WHICH GOT LEFT OUT
   3438 C  -----------------------------------
   3439  
   3440          IF(NINT(VSG(L)).GT.0)  THEN
   3441             PRINT 887, L,SID,NINT(VSG(L))
   3442   887       FORMAT('##IW3UNPBF/R03UBF - ~~ON LVL',I4,' OF ID ',A8,
   3443      $       ', A VERTICAL SIGNIFICANCE OF',I3,' WAS NOT SUPPORTED - ',
   3444      $       'LEAVE THIS LEVEL OUT OF THE PROCESSING')
   3445             print'(" ..... at lvl=",I0,"; POB = ",G0,"; QOB = ",G0,
   3446      $       "; TOB = ",G0,"; ZOB = ",G0,"; DOB = ",G0,";")',
   3447      $        L,pob(L),qob(L),tob(L),zob(L),dob(L)
   3448             print'("                  SOB = ",G0)', sob(L)
   3449          END IF
   3450       ENDDO
   3451  
   3452 C  -----------------------------------------------------
   3453 C  MISC DATA GOES INTO DATA LEVEL CATEGORY 08
   3454 C  -----------------------------------------------------
   3455 C  CODE FIGURE 104 - RELEASE TIME IN .01*HR

Page 89          Source Listing                  R03UBF
2017-04-18 11:09                                 iw3unpbf.f

   3456 C  CODE FIGURE 105 - RECEIPT TIME IN .01*HR
   3457 C  CODE FIGURE 351 - GEOPOTENTIAL HEIGHT (METERS)
   3458 C                    INDICATOR 1 IS PRESSURE LEVEL (MB)
   3459 C                    INDICATOR 2 CONTAINS GEOPOTENTIAL QUALITY MARKER
   3460 C  CODE FIGURE 352 - MEAN-SEA LEVEL PRESSURE IN .1*MB
   3461 C  CODE FIGURE 353 - SOLAR AND INFRARED RADIATION CORRECTION
   3462 C                    INDICATOR
   3463 C  CODE FIGURE 354 - TRACKING TECHNIQUE/STATUS OF SYSTEM USED
   3464 C                    INDICATOR
   3465 C  -----------------------------------------------------------
   3466  
   3467       CALL UFBINT(LUNIT,RCT_8, 5,255,NRCT,RCSTR);RCT=RCT_8
   3468 
   3469 C NOTE: MNEMONIC "RCTS" 008202 IS A LOCAL DESCRIPTOR DEFINED AS
   3470 C       RECEIPT TIME SIGNIFICANCE - THIS IS STORED IN INDICATOR 1
   3471 C       FOR CATEGORY 8 CODE FIGURE 105 -- CODE TABLE FOLLOWS:
   3472 C         0   General decoder receipt time
   3473 C         1   NCEP receipt time
   3474 C         2   OSO  receipt time
   3475 C         3   ARINC ground station receipt time
   3476 C         4   Radiosonde TEMP AA part receipt time
   3477 C         5   Radiosonde TEMP BB part receipt time
   3478 C         6   Radiosonde TEMP CC part receipt time
   3479 C         7   Radiosonde TEMP DD part receipt time
   3480 C         8   Radiosonde PILOT AA part receipt time
   3481 C         9   Radiosonde PILOT BB part receipt time
   3482 C        10   Radiosonde PILOT CC part receipt time
   3483 C        11   Radiosonde PILOT DD part receipt time
   3484 C      12-62  Reserved for future use
   3485 C        63   Missing
   3486 
   3487       DO L=1,NRCT
   3488          CF8(L) = 105
   3489          OB8(L) = NINT((NINT(RCT(1,L))+NINT(RCT(2,L))/60.) * 100.)
   3490          Q81(L) = IMISS
   3491          IF(RCT(3,L).LT.BMISS)  Q81(L) = NINT(RCT(3,L))
   3492          Q82(L) = IMISS
   3493          CALL S02UBF(8,L,*9999)
   3494       ENDDO
   3495 
   3496       CALL UFBINT(LUNIT,RMORE_8,4,1,NRMORE,'SIRC TTSS UALNHR UALNMN')
   3497       RMORE=RMORE_8
   3498       IF(MAX(RMORE(3),RMORE(4)).LT.BMISS)  THEN
   3499          CF8(1) = 104
   3500          OB8(1) = NINT((RMORE(3)+RMORE(4)/60.) * 100.)
   3501          Q81(1) = IMISS
   3502          Q82(1) = IMISS
   3503          CALL S02UBF(8,1,*9999)
   3504       END IF
   3505       IF(SUBSET.EQ.'NC004005')  THEN
   3506          IF(MAX(PRGP10(1),RGP10(1)).LT.BMISS)  THEN
   3507             RGP10(1) = (NINT(RGP10(1))/GRAV)
   3508             if(iprint.eq.1)  print'(" orig. RGP10 = ",G0)', rgp10(1)
   3509             IF(MOD(NINT(RGP10(1)),10).NE.0)  RGP10(1) =
   3510      $       INT(RGP10(1)/10.) * 10
   3511             CF8(1) = 351
   3512             OB8(1) = NINT(RGP10(1))

Page 90          Source Listing                  R03UBF
2017-04-18 11:09                                 iw3unpbf.f

   3513             Q81(1) = NINT(PRGP10(1)/100.)
   3514             Q82(1) = 3
   3515             CALL S02UBF(8,1,*9999)
   3516          END IF
   3517          IF(RPMSL.LT.BMISS)  THEN
   3518             CF8(1) = 352
   3519             OB8(1) = NINT(RPMSL*.1)
   3520             Q81(1) = IMISS
   3521             Q82(1) = IMISS
   3522             CALL S02UBF(8,1,*9999)
   3523          END IF
   3524       END IF
   3525       IF(RMORE(1).LT.BMISS)  THEN
   3526          CF8(1) = 353
   3527          OB8(1) = NINT(RMORE(1))
   3528          Q81(1) = IMISS
   3529          Q82(1) = IMISS
   3530          CALL S02UBF(8,1,*9999)
   3531       END IF
   3532       IF(RMORE(2).LT.BMISS)  THEN
   3533          CF8(1) = 354
   3534          OB8(1) = NINT(RMORE(2))
   3535          Q81(1) = IMISS
   3536          Q82(1) = IMISS
   3537          CALL S02UBF(8,1,*9999)
   3538       END IF
   3539  
   3540 C  PUT THE UNPACKED REPORT INTO OBS
   3541 C  --------------------------------
   3542  
   3543       CALL S03UBF(OBS,SUBSET,*9999,*9998,*9997)
   3544  
   3545       RETURN
   3546  9999 CONTINUE
   3547       R03UBF = 999
   3548       RETURN
   3549  9998 CONTINUE
   3550       print'("IW3UNPBF/R03UBF: RPT with ID= ",A," TOSSED - ZERO ",
   3551      $ "CAT.1-6,51 LVLS")', SID
   3552  9997 CONTINUE
   3553       R03UBF = -9999
   3554       KSKUPA =KSKUPA + 1
   3555       RETURN
   3556       END
   3557 C***********************************************************************
   3558 C***********************************************************************
   3559 C***********************************************************************
   3560       FUNCTION R04UBF(LUNIT,OBS,OBS2,OBS3,NOBS3,obs8_8)
   3561 C     ---> PROCESSES SURFACE AND MESONET DATA (000/*, 001/*, 255/*)
   3562  
   3563       COMMON/IUBFAA/BMISS
   3564       COMMON/IUBFBB/KNDX,KSKACF(8),KSKUPA,KSKSFC,KSKSAT,KFLSAT(12),
   3565      $ KSKSMI
   3566       COMMON/IUBFCC/SUBSET
   3567       COMMON/IUBFEE/POB(255),QOB(255),TOB(255),ZOB(255),DOB(255),
   3568      $              SOB(255),VSG(255),OB8(255),CF8(255)
   3569       COMMON/IUBFGG/PSL,STP,SDR,SSP,STM,DPD

Page 91          Source Listing                  R04UBF
2017-04-18 11:09                                 iw3unpbf.f

   3570       COMMON/IUBFHH/PSQ,SPQ,SWQ,STQ,DDQ
   3571       COMMON/IUBFLL/Q81(255),Q82(255)
   3572  
   3573       CHARACTER*80 HDSTR,RCSTR
   3574       CHARACTER*8  SUBSET,SID,RSV1,RSV2,PRVSTG,SPRVSTG,QCD
   3575       INTEGER ITIWM(0:15)
   3576       REAL(8) RID_8,UFBINT_8,OBS2_8(43),OBS3_8(5,255,7),RRVSTG_8(255),
   3577      $ RPRVSTG_8(255),HDR_8(20),RCT_8(5,255),SOLR_8(3,255),
   3578      $ TOPC_8(5,255),RMSO_8(2),RQCD_8,BMISS,AMINIMUM_8,obs8_8(2)
   3579       DIMENSION  OBS(*),OBS2(43),OBS3(5,255,7),NOBS3(7),HDR(20),
   3580      $ RCT(5,255),RRSV(5),SOLR(3,255),TOPC(5,255)
   3581       EQUIVALENCE  (RID_8,SID),(RRVSTG_8,PRVSTG),(RPRVSTG_8,SPRVSTG),
   3582      $ (RQCD_8,QCD)
   3583 
   3584       SAVE
   3585  
   3586       DATA HDSTR/'RPID CLON CLAT HOUR MINU SELV QCEVR         '/
   3587       DATA RCSTR/'RCHR RCMI RCTS                              '/
   3588  
   3589       DATA IMISS/99999/
   3590       
   3591       DATA ITIWM/0,3*7,3,3*7,1,3*7,4,3*7/
   3592 
   3593       R04UBF = 0
   3594 
   3595 C  STORE SINGLE LEVEL REPORT DATA DIRECTLY INTO OBS2 ARRAY,
   3596 C   MULTIPLE LEVEL REPORT DATA DIRECTLY INTO OBS3 ARRAY AND
   3597 C   DOUBLE-PRECISION SINGLE LEVEL REPORT DATA DIRECTLY INTO OBS8_8 ARRAY
   3598 C  ---------------------------------------------------------------------
   3599 
   3600       OBS2_8 = BMISS
   3601       OBS3_8 = BMISS
   3602       NOBS3  = 0
   3603       obs8_8 = bmiss
   3604       CALL UFBINT(LUNIT,OBS2_8(1),2,1,IRET,'RSRD EXPRSRD')
   3605       CALL UFBINT(LUNIT,OBS2_8(4),1,1,IRET,'SST1')
   3606       IF(IBFMS(OBS2_8(4)).EQ.0)  OBS2_8(41) = 2.0
   3607       IF(SUBSET(1:5).EQ.'NC000')  THEN               ! All surface land
   3608          CALL UFBINT(LUNIT,OBS2_8( 8),2,1,IRET,'HOVI VTVI')
   3609          CALL UFBINT(LUNIT,OBS2_8(14),2,1,IRET,'.DTMMXGS MXGS')
   3610          CALL UFBINT(LUNIT,OBS2_8(17),3,1,IRET,'TP01 TP03 TP06')
   3611          CALL UFBINT(LUNIT,OBS2_8(21),1,1,IRET,'TP24')
   3612          CALL UFBINT(LUNIT,OBS2_8(30),2,1,IRET,'DOFS TOSD')
   3613          CALL UFBINT(LUNIT,OBS3_8(1,1,2),5,255,IRET,'PRWE')
   3614          IF(IRET.EQ.1) THEN ! reset iret from 1 to 0 if all obs missing
   3615                             !  (iret can be 1 even if all obs missing)
   3616             IF(IBFMS(OBS3_8(1,1,2)).NE.0)  IRET = 0
   3617          END IF
   3618          NOBS3(2) = IRET
   3619          CALL UFBINT(LUNIT,OBS3_8(1,1,3),5,255,IRET,
   3620      $                                       'VSSO CLAM CLTP HOCB HOCT')
   3621          IF(IRET.EQ.1) THEN ! reset iret from 1 to 0 if all obs missing
   3622                             !  (iret can be 1 even if all obs missing)
   3623             AMINIMUM_8 = MIN(OBS3_8(1,1,3),OBS3_8(2,1,3),OBS3_8(3,1,3),
   3624      $       OBS3_8(4,1,3),OBS3_8(5,1,3))
   3625             IF(IBFMS(AMINIMUM_8).NE.0)  IRET = 0
   3626          END IF

Page 92          Source Listing                  R04UBF
2017-04-18 11:09                                 iw3unpbf.f

   3627          NOBS3(3) = IRET
   3628          CALL UFBINT(LUNIT,OBS3_8(1,1,4),5,255,IRET,
   3629      $                                    '.DTHMXTM MXTM .DTHMITM MITM')
   3630          IF(IRET.EQ.1) THEN ! reset iret from 1 to 0 if all obs missing
   3631                             !  (iret can be 1 even if all obs missing)
   3632             AMINIMUM_8 = MIN(OBS3_8(1,1,4),OBS3_8(2,1,4),OBS3_8(3,1,4),
   3633      $       OBS3_8(4,1,4))
   3634             IF(IBFMS(AMINIMUM_8).NE.0)  IRET = 0
   3635          END IF
   3636          NOBS3(4) = IRET
   3637          IF(SUBSET(6:8).EQ.'007')  THEN                        ! METARs
   3638             CALL UFBINT(LUNIT,OBS2_8( 7),1,1,IRET,'.REHOVI')
   3639             CALL UFBINT(LUNIT,OBS2_8(12),2,1,IRET,'PKWDSP PKWDDR')
   3640             CALL UFBINT(LUNIT,OBS2_8(22),1,1,IRET,'TOSS')
   3641             CALL UFBINT(LUNIT,OBS2_8( 3),1,1,IRET,'ALSE')
   3642          ELSE                                                  ! SYNOPs
   3643             CALL UFBINT(LUNIT,OBS2_8(10),2,1,IRET,'PSW1 PSW2')
   3644             CALL UFBINT(LUNIT,OBS2_8(20),1,1,IRET,'TP12')
   3645             CALL UFBINT(LUNIT,OBS2_8(23),2,1,IRET,'TOCC HBLCS')
   3646             CALL UFBINT(LUNIT,OBS2_8(29),1,1,IRET,'.DTHDOFS')
   3647             CALL UFBINT(LUNIT,OBS2_8(32),4,1,IRET,'HOWV POWV HOWW POWW')
   3648             CALL UFBINT(LUNIT,OBS2_8(38),3,1,IRET,'CHPT 3HPC 24PC')
   3649             CALL UFBINT(LUNIT,OBS3_8(1,1,1),5,255,IRET,'.DTHTOPC TOPC')
   3650             IF(IRET.EQ.1) THEN ! reset iret from 1 to 0 if all obs msng
   3651                                !  (iret can be 1 even if all obs msng)
   3652                AMINIMUM_8 = MIN(OBS3_8(1,1,1),OBS3_8(2,1,1))
   3653                IF(IBFMS(AMINIMUM_8).NE.0)  IRET = 0
   3654             END IF
   3655             NOBS3(1) = IRET
   3656             CALL UFBINT(LUNIT,OBS3_8(1,1,5),5,255,IRET,'DOSW HOSW POSW')
   3657             IF(IRET.EQ.1) THEN ! reset iret from 1 to 0 if all obs msng
   3658                                !  (iret can be 1 even if all obs msng)
   3659                AMINIMUM_8 = MIN(OBS3_8(1,1,5),OBS3_8(2,1,5),
   3660      $          OBS3_8(3,1,5))
   3661                IF(IBFMS(AMINIMUM_8).NE.0)  IRET = 0
   3662             END IF
   3663             NOBS3(5) = IRET
   3664          END IF
   3665       ELSE IF(SUBSET(1:5).EQ.'NC001')  THEN        ! All surface marine
   3666          IF(IBFMS(OBS2_8(4)).NE.0) THEN
   3667 C DBUOYs store sub-sfc temp, use 1st lvl if SST1 msg (unless > 10m down)
   3668             CALL UFBINT(LUNIT,OBS2_8(4),2,1,IRET,'STMP DBSS')
   3669             IF(OBS2_8(5).GT.10.)  THEN
   3670                OBS2_8(4:5) = BMISS
   3671             END IF
   3672          END IF
   3673          IF(IBFMS(OBS2_8(4)).EQ.0)  OBS2_8(41) = 2.0
   3674          CALL UFBINT(LUNIT,OBS2_8( 6),1,1,IRET,'MSST')
   3675          CALL UFBINT(LUNIT,OBS2_8( 8),8,1,IRET,
   3676      $                'HOVI VTVI PSW1 PSW2 PKWDSP PKWDDR .DTMMXGS MXGS')
   3677          CALL UFBINT(LUNIT,OBS2_8(23),4,1,IRET,'TOCC HBLCS XS10 XS20')
   3678          CALL UFBINT(LUNIT,OBS2_8(32),4,1,IRET,'HOWV POWV HOWW POWW')
   3679          CALL UFBINT(LUNIT,OBS2_8(36),5,1,IRET,
   3680      $    'TDMP ASMP CHPT 3HPC 24PC')
   3681          CALL UFBINT(LUNIT,OBS3_8(1,1,2),5,255,IRET,'PRWE')
   3682          IF(IRET.EQ.1) THEN ! reset iret from 1 to 0 if all obs missing
   3683                             !  (iret can be 1 even if all obs missing)

Page 93          Source Listing                  R04UBF
2017-04-18 11:09                                 iw3unpbf.f

   3684             IF(IBFMS(OBS3_8(1,1,2)).NE.0)  IRET = 0
   3685          END IF
   3686          NOBS3(2) = IRET
   3687          CALL UFBINT(LUNIT,OBS3_8(1,1,3),5,255,IRET,
   3688      $    'VSSO CLAM CLTP HOCB')
   3689          IF(IRET.EQ.1) THEN ! reset iret from 1 to 0 if all obs missing
   3690                             !  (iret can be 1 even if all obs missing)
   3691             AMINIMUM_8 = MIN(OBS3_8(1,1,3),OBS3_8(2,1,3),OBS3_8(3,1,3),
   3692      $       OBS3_8(4,1,3))
   3693             IF(IBFMS(AMINIMUM_8).NE.0)  IRET = 0
   3694          END IF
   3695          NOBS3(3) = IRET
   3696          CALL UFBINT(LUNIT,OBS3_8(1,1,5),5,255,IRET,'DOSW HOSW POSW')
   3697          IF(IRET.EQ.1) THEN ! reset iret from 1 to 0 if all obs missing
   3698                             !  (iret can be 1 even if all obs missing)
   3699             AMINIMUM_8 = MIN(OBS3_8(1,1,5),OBS3_8(2,1,5),OBS3_8(3,1,5))
   3700             IF(IBFMS(AMINIMUM_8).NE.0)  IRET = 0
   3701          END IF
   3702          NOBS3(5) = IRET
   3703       ELSE IF(SUBSET(1:5).EQ.'NC255')  THEN              ! All Mesonets
   3704             CALL UFBINT(LUNIT,OBS2_8(15),2,1,IRET,'MXGS MXGD')
   3705             CALL UFBINT(LUNIT,OBS2_8( 3),1,1,IRET,'ALSE')
   3706             CALL UFBINT(LUNIT,OBS3_8(1,1,1),5,255,IRET,'TPHR TOPC')
   3707             IF(IRET.EQ.1) THEN ! reset iret from 1 to 0 if all obs msng
   3708                                !  (iret can be 1 even if all obs msng)
   3709                AMINIMUM_8 = MIN(OBS3_8(1,1,1),OBS3_8(2,1,1))
   3710                IF(IBFMS(AMINIMUM_8).NE.0)  IRET = 0
   3711             END IF
   3712             NOBS3(1) = IRET
   3713       END IF
   3714       OBS2 = OBS2_8
   3715       OBS3 = OBS3_8
   3716  
   3717       CALL S05UBF
   3718 
   3719 C  PUT THE HEADER INFORMATION INTO UNPACKED FORMAT
   3720 C  -----------------------------------------------
   3721  
   3722       CALL UFBINT(LUNIT,HDR_8,20,  1,IRET,HDSTR);HDR(2:)=HDR_8(2:)
   3723 
   3724 C  IN EARLY 2004, MESONETS WILL CONVERT TO HIGH-RESOLUTION LAT/LON
   3725 C  ---------------------------------------------------------------
   3726 
   3727       IF(HDR_8(2).GE.BMISS)  THEN
   3728          CALL UFBINT(LUNIT,UFBINT_8,1,1,IRET,'CLONH')
   3729          HDR_8(2)=UFBINT_8
   3730       END IF
   3731       IF(HDR_8(3).GE.BMISS)  THEN
   3732          CALL UFBINT(LUNIT,UFBINT_8,1,1,IRET,'CLATH')
   3733          HDR_8(3)=UFBINT_8
   3734       END IF
   3735       obs8_8(1) = hdr_8(3)
   3736       obs8_8(2) = hdr_8(2)
   3737 
   3738       CALL UFBINT(LUNIT,RCT_8, 5,255,NRCT,RCSTR);RCT=RCT_8
   3739       IF(HDR(5).GE.BMISS) HDR(5) = 0
   3740       RCTIM = NINT(RCT(1,1))+NINT(RCT(2,1))/60.

Page 94          Source Listing                  R04UBF
2017-04-18 11:09                                 iw3unpbf.f

   3741       RID_8 = HDR_8(1)
   3742       XOB   = HDR_8(2)
   3743       YOB   = HDR_8(3)
   3744       RHR   = BMISS
   3745       IF(HDR(4).LT.BMISS)  RHR = NINT(HDR(4))+NINT(HDR(5))/60.
   3746       ELV   = HDR(6)
   3747       QMELV = HDR(7)
   3748       ITP = IMISS
   3749       RTP = ERTUBF(SUBSET,SID)
   3750       IDS = IMISS
   3751 
   3752       RSV1 = '        '
   3753       RSV2 = '        '
   3754 
   3755       IF(SUBSET(1:5).NE.'NC255')  THEN
   3756 C---------------------------------------------------------------------
   3757 C                   MESONET REPORTS DO NOT COME HERE
   3758 C---------------------------------------------------------------------
   3759 
   3760 C  INDICATOR FOR PRECIPITATION (INCLUDED/EXCLUDED STORED IN BYTE 1 OF
   3761 C   HEADER RESERVE CHARACTER WORD 1
   3762 C  INDICATOR FOR WIND SPEED (SOURCE/UNITS) STORED IN BYTE 3 OF HEADER
   3763 C   RESERVE CHARACTER WORD 1
   3764 C         '0' - Wind speed estimated in m/s (uncertified instrument)
   3765 C         '1' - Wind speed obtained from anemometer in m/s (certified
   3766 C               instrument)
   3767 C         '3' - Wind speed estimated in knots (uncertified instrument)
   3768 C         '4' - Wind speed obtained from anemometer in knots (certified
   3769 C               instrument)
   3770 C         '7' - Missing
   3771 C  INDICATOR FOR STATION OPERATION/PAST WEATHER DATA STORED IN BYTE 5 OF
   3772 C   HEADER RESERVE CHARACTER WORD 1
   3773 
   3774          CALL UFBINT(LUNIT,UFBINT_8,1,1,NRSV,'INPC');RRSV(1)=UFBINT_8
   3775          CALL UFBINT(LUNIT,UFBINT_8,1,1,NRSV,'TIWM');TIWM=UFBINT_8
   3776          IF(TIWM.LT.BMISS)  THEN   ! Effective 5/2002
   3777             RRSV(2) = 7
   3778             IF(NINT(TIWM).LE.15)  RRSV(2) = ITIWM(NINT(TIWM))
   3779          ELSE                      ! Prior to 5/2002
   3780             CALL UFBINT(LUNIT,UFBINT_8,1,1,NRSV,'SUWS');RRSV(2)=UFBINT_8
   3781          END IF
   3782          CALL UFBINT(LUNIT,UFBINT_8,1,1,NRSV,'ITSO');RRSV(3)=UFBINT_8
   3783          J = -1
   3784          DO  I=1,3
   3785             J = J + 2
   3786             IF(RRSV(I).LT.BMISS)  WRITE(RSV1(J:J),'(I1)') NINT(RRSV(I))
   3787          ENDDO
   3788          IF(SUBSET(6:8).EQ.'007')  THEN                        ! METARs
   3789 C  TYPE OF HOURLY REPORT ("METAR", "SPECI" OR "LWIS") STORED IN BYTES
   3790 C   1-5 OF HEADER RESERVE CHARACTER WORD 2 (METAR REPORTS ONLY)
   3791             CALL UFBINT(LUNIT,UFBINT_8,1,1,NRSV,'THRPT')
   3792             RRSV(4)=UFBINT_8
   3793             IF(NINT(RRSV(4)).EQ.0)  THEN
   3794                RSV2(1:5) = 'METAR'
   3795             ELSE  IF(NINT(RRSV(4)).EQ.1)  THEN
   3796                RSV2(1:5) = 'SPECI'
   3797             ELSE  IF(NINT(RRSV(4)).EQ.2)  THEN

Page 95          Source Listing                  R04UBF
2017-04-18 11:09                                 iw3unpbf.f

   3798                RSV2(1:5) = 'LWIS '
   3799             ELSE
   3800                RSV2(1:5) = '?????'
   3801             END IF
   3802 C  CORRECTED REPORT INDICATOR ("CORN") STORED IN BYTE 8 OF HEADER
   3803 C   RESERVE CHARACTER WORD 2 (METAR REPORTS ONLY)
   3804 C         '0' - Not corrected
   3805 C         '1' - Corrected by report originator
   3806 C         '2' - Corrected by NCEP SDM
   3807 C         '3' to '6' - Reserved
   3808 C         '7' - Missing
   3809             CALL UFBINT(LUNIT,UFBINT_8,1,1,NRSV,'CORN');RRSV(5)=UFBINT_8
   3810             RSV2(8:8) = '7'
   3811             IF(RRSV(5).LT.BMISS)  WRITE(RSV2(8:8),'(I1)') NINT(RRSV(5))
   3812          END IF
   3813       ELSE
   3814 C---------------------------------------------------------------------
   3815 C                      MESONET REPORTS COME HERE
   3816 C---------------------------------------------------------------------
   3817 
   3818 C  MESONET PROVIDER ID STORED IN HEADER RESERVE CHARACTER WORD 1
   3819 C   (Note: Only first eight characters are stored)
   3820          CALL UFBINT(LUNIT,RRVSTG_8,1,255,IRET,'PRVSTG')
   3821 cccc     IF(IRET.NE.0.AND.(RRVSTG_8(1).LE.BMISS-5000..OR.RRVSTG_8(1)
   3822 cccc $    .GE.BMISS+5000.))  RSV1 = PRVSTG
   3823 cxxxx
   3824 cpppppppppp
   3825 cc    print'(" rrvstg_8(1),icbfms(prvstg,8): ",G0,1X,I0)',
   3826 cc   $ rrvstg_8(1),icbfms(prvstg,8)
   3827 cpppppppppp
   3828          IF(ICBFMS(PRVSTG,8).EQ.0) RSV1 = PRVSTG
   3829 C above line not working right - may return 0 when missing, so use next
   3830 C  two lines below temporarily until this is fixed (readlc will return
   3831 C  all blanks for prvstg when mnemonic "PRVSTG" not found) - dak 2/19/13
   3832          call readlc(lunit,prvstg,'PRVSTG')
   3833 cpppppppppp
   3834 cc       print'(" prvstg = """,A,"""")', prvstg
   3835 cpppppppppp
   3836          rsv1 = prvstg  ! will set rsv1 back to all blanks if readlc
   3837                         !  returns prvstg as all blanks (rsv1 may have
   3838                         !  been set to garbage above if ICBFMS
   3839                         !  incorrectly returned as zero when prvstg is
   3840                         !  actually missing) -- if prvstg is filled
   3841                         !  with a valid character string by readlc,
   3842                         !  this will also get translated into rsv1 here
   3843 cxxxx
   3844 C  MESONET SUBPROVIDER ID STORED IN HEADER RESERVE CHARACTER WORD 2
   3845 C   (Note: Only first eight characters are stored)
   3846          CALL UFBINT(LUNIT,RPRVSTG_8,1,255,IRET,'SPRVSTG')
   3847 cccc     IF(IRET.NE.0.AND.(RPRVSTG_8(1).LE.BMISS-5000..OR.RPRVSTG_8(1)
   3848 cccc $    .GE.BMISS+5000.))  RSV2 = SPRVSTG
   3849 cxxxx
   3850 cpppppppppp
   3851 cc    print'(" rprvstg_8(1),icbfms(sprvstg,8): ",G0,1X,I0)',
   3852 cc   $ rprvstg_8(1),icbfms(sprvstg,8)
   3853 cpppppppppp
   3854          IF(ICBFMS(SPRVSTG,8).EQ.0) RSV2 = SPRVSTG

Page 96          Source Listing                  R04UBF
2017-04-18 11:09                                 iw3unpbf.f

   3855 C above line not working right - may return 0 when missing, so use next
   3856 C  two lines below temporarily until this is fixed (readlc will return
   3857 C  all blanks for sprvstg when mnemonic "SPRVSTG" not found)-dak 2/19/13
   3858 CCC DAK 2/26/13: READLC puts out diag. print when mnemonic not located
   3859 CCC              (i.e., missing) so to avoid thousands of lines of
   3860 CCC              print, will only call readlc if IRET is > 0, i.e., if
   3861 CCC              IRET is ZERO assume it is missing (a good bet) and
   3862 CCC              don't call READLC
   3863                         if(IRET.gt.0) then
   3864          call readlc(lunit,sprvstg,'SPRVSTG')
   3865                         else
   3866                            sprvstg = '        '
   3867                         endif
   3868 cpppppppppp
   3869 cc    print'(" sprvstg = """,A,"""")', sprvstg
   3870 cpppppppppp
   3871          rsv2 = sprvstg ! will set rsv2 back to all blanks if readlc
   3872                         !  returns sprvstg as all blanks -- or IRET > 0
   3873                         !    and sprvstg forced to be all blanks --
   3874                         !  (rsv2 may have
   3875                         !  been set to garbage above if ICBFMS
   3876                         !  incorrectly returned as zero when sprvstg is
   3877                         !  actually missing) -- if sprvstg is filled
   3878                         !  with a valid character string by readlc,
   3879                         !  this will also get translated into rsv2 here
   3880 cxxxx
   3881 C---------------------------------------------------------------------
   3882       END IF
   3883 
   3884 C  READ THE DATA LEVEL CATEGORY 51 SURFACE DATA FROM BUFR
   3885 C  ------------------------------------------------------
   3886  
   3887       CALL UFBINT(LUNIT,UFBINT_8,1,1,IRET,'PMSL');PSL=UFBINT_8
   3888       CALL UFBINT(LUNIT,UFBINT_8,1,1,IRET,'PRES');STP=UFBINT_8
   3889       CALL UFBINT(LUNIT,UFBINT_8,1,1,IRET,'WDIR');SDR=UFBINT_8
   3890       CALL UFBINT(LUNIT,UFBINT_8,1,1,IRET,'WSPD');SSP=UFBINT_8
   3891       CALL UFBINT(LUNIT,UFBINT_8,1,1,IRET,'TMDB');STM=UFBINT_8
   3892       CALL UFBINT(LUNIT,UFBINT_8,1,1,IRET,'TMDP');DPD=UFBINT_8
   3893 
   3894       IF(SUBSET(1:5).NE.'NC255')  THEN
   3895 
   3896 C  Quality markers for all types except mesonets ....
   3897          CALL UFBINT(LUNIT,UFBINT_8,1,1,IRET,'QMPR');QSL=UFBINT_8
   3898          CALL UFBINT(LUNIT,UFBINT_8,1,1,IRET,'QMPR');QSP=UFBINT_8
   3899          CALL UFBINT(LUNIT,UFBINT_8,1,1,IRET,'QMWN');QMW=UFBINT_8
   3900          CALL UFBINT(LUNIT,UFBINT_8,1,1,IRET,'QMAT');QMT=UFBINT_8
   3901          CALL UFBINT(LUNIT,UFBINT_8,1,1,IRET,'QMDD');QMD=UFBINT_8
   3902          QPR = 2 ! precip. rate (no q. marker available, set to neutral)
   3903          QPT = 2 ! tot. precip. (no q. marker available, set to neutral)
   3904 
   3905          IF(SUBSET(6:8).EQ.'007')  THEN
   3906 
   3907 C  METARs transfer the quality marker from pstn to altimeter setting if
   3908 C   pstn q.m. was either a purge or reject value (pstn is missing for
   3909 C   METARS, so most will obtain this from altimeter setting in
   3910 C   PREPDATA and assign the pstn q.m. to be same as that of the
   3911 C   altimeter setting - the logic here ensures that a purge or reject

Page 97          Source Listing                  R04UBF
2017-04-18 11:09                                 iw3unpbf.f

   3912 C   flag on pressure in the sdmedit file will be honored)
   3913             QAL = BMISS
   3914             IF(NINT(QSP).EQ.14.OR.NINT(QSP).EQ.12) then
   3915                QAL = QSP
   3916             END IF
   3917          END IF
   3918       ELSE
   3919 
   3920 C  Quality markers for mesonets ....
   3921          QSL = BMISS           ! mean-sea lvl pressure (PMSL missing)
   3922          CALL UFBREP(LUNIT,RMSO_8,2,1,IRET,'PRES QCD')
   3923          RQCD_8 = RMSO_8(2)
   3924 cdak     print'(" PRES  QM is ",A)', QCD
   3925          QSP = MQMUBF(QCD)  ! station pressure
   3926          CALL UFBREP(LUNIT,RMSO_8,2,1,IRET,'ALSE QCD')
   3927          RQCD_8 = RMSO_8(2)
   3928 cdak     print'(" ALSE  QM is ",A)', QCD
   3929          QAL = MQMUBF(QCD)  ! altimeter
   3930          CALL UFBREP(LUNIT,RMSO_8,2,1,IRET,'TMDB QCD')
   3931          RQCD_8 = RMSO_8(2)
   3932 cdak     print'(" TMDB  QM is ",A)', QCD
   3933          QMT = MQMUBF(QCD)  ! temperature
   3934          CALL UFBREP(LUNIT,RMSO_8,2,1,IRET,'TMDP QCD')
   3935          RQCD_8 = RMSO_8(2)
   3936 cdak     print'(" TMDP  QM is ",A)', QCD
   3937          QMD = MQMUBF(QCD)  ! dewpoint
   3938          CALL UFBREP(LUNIT,RMSO_8,2,1,IRET,'WDIR QCD')
   3939          RQCD_8 = RMSO_8(2)
   3940 cdak     print'(" WDIR  QM is ",A)', QCD
   3941          QWD = MQMUBF(QCD)  ! wind direction
   3942          CALL UFBREP(LUNIT,RMSO_8,2,1,IRET,'WSPD QCD')
   3943          RQCD_8 = RMSO_8(2)
   3944 cdak     print'(" WSPD  QM is ",A)', QCD
   3945          QWS = MQMUBF(QCD)  ! wind speed
   3946          QMW = MAX(QWD,QWS)    ! wind (overall)
   3947          CALL UFBREP(LUNIT,RMSO_8,2,1,IRET,'REQV QCD')
   3948          RQCD_8 = RMSO_8(2)
   3949 cdak     print'(" REQV  QM is ",A)', QCD
   3950          QPR = MQMUBF(QCD)  ! precipitation rate
   3951          CALL UFBINT(LUNIT,TOPC_8,1,255,IRETU,'TOPC')
   3952          IRET = 0
   3953          IF(IRETU.GT.0)CALL UFBSEQ(LUNIT,TOPC_8,5,IRETU,IRET,'MNTOPCSQ')
   3954          QPT1  = BMISS
   3955          QPT24 = BMISS
   3956          IF(IRET.GT.0)  THEN
   3957             DO I = 1,IRET
   3958                IF(NINT(TOPC_8(1,I)).EQ.1)  THEN
   3959                   RQCD_8 = TOPC_8(3,I)
   3960 cdak              print'(" 1-hr total precip. QM is ",A)', QCD
   3961                   QPT1 = MQMUBF(QCD)   ! total precip. over 1-hr
   3962                ELSE  IF(NINT(TOPC_8(1,I)).EQ.24)  THEN
   3963                   RQCD_8 = TOPC_8(3,I)
   3964 cdak              print'(" 24-hr total precip. QM is ",A)', QCD
   3965                   QPT24 = MQMUBF(QCD)  ! total precip. over 24-hr
   3966                END IF
   3967             ENDDO
   3968          END IF

Page 98          Source Listing                  R04UBF
2017-04-18 11:09                                 iw3unpbf.f

   3969 
   3970       END IF
   3971  
   3972 C  PAOBS always have a missing elev, but we know they are at sea level
   3973       IF(SUBSET.EQ.'NC001006')  ELV = 0
   3974  
   3975 C  CALL FUNCTIONS TO TRANSFORM TO SPECIFIED UNPACKED FORMAT
   3976 C  --------------------------------------------------------
   3977 
   3978       PSQ = EQSUBF(QSL)
   3979       SPQ = EQSUBF(QSP)
   3980       SWQ = EQSUBF(QMW)
   3981       STQ = EQSUBF(QMT)
   3982       DDQ = EQSUBF(QMD)
   3983  
   3984       IF(PSL.LT.BMISS)  THEN
   3985          PSL = NINT(PSL*.1)
   3986       ELSE
   3987          IF(PSQ.NE.14.AND.PSQ.NE.12) PSQ = 2
   3988       END IF
   3989 
   3990 C  The following line needed because old QUIPC program always
   3991 C   corrected STP to be PSL value if PSL was corrected, even if
   3992 C   STP was orig. missing or at some elevation above sea-lvl
   3993 C   (this is now fixed in quipc but is left here for old runs)
   3994 C  ------------------------------------------------------------
   3995 
   3996       IF(SUBSET(1:5).EQ.'NC001'.AND.NINT(QSL).EQ.4)  STP = BMISS
   3997       IF(STP.LT.BMISS)  THEN
   3998          STP = NINT(STP*.1)
   3999       ELSE
   4000          IF(SPQ.NE.14.AND.SPQ.NE.12) SPQ = 2
   4001       END IF
   4002       SSP = MIN(SSP*10.,BMISS)
   4003       IF(NINT(SDR).EQ.0)   SDR = 360
   4004       IF(SDR.GE.BMISS.AND.NINT(SSP).EQ.0)   SDR = 360
   4005       IF(MIN(SDR,SSP).GE.BMISS)  SWQ = 2
   4006       IF(MAX(DPD,STM).LT.BMISS)  THEN
   4007          DPD = (STM-DPD)*10.
   4008       ELSE
   4009          DPD = BMISS
   4010 C - note this was not set before  & could make a bufr chg in checking
   4011          DDQ = 2
   4012       END IF
   4013       IF(STM.LT.BMISS)  THEN
   4014          ISTM = NINT(STM*100.)
   4015          STM = NINT((ISTM-27315)*0.1)
   4016       ELSE
   4017          STQ = 2
   4018       END IF
   4019 
   4020 C  MAKE THE UNPACKED REPORT INTO OBS
   4021 C  ---------------------------------
   4022  
   4023       RSTP = IMISS
   4024       CALL S01UBF(SID,XOB,YOB,RHR,RCTIM,RSV1,RSV2,ELV,QMELV,ITP,RTP,
   4025      $ RSTP,IDS)

Page 99          Source Listing                  R04UBF
2017-04-18 11:09                                 iw3unpbf.f

   4026       CALL S02UBF(51,1,*9999)


ENTRY POINTS

  Name               
                     
 r04ubf_             


SYMBOL CROSS REFERENCE

 Name                       Object Declared Type            Bytes Dimen Elements Attributes       References                        
                                                                                                                                    
 75                         Label  4099                                                           4096                              
 9997                       Label  4112                                                           4101                              
 9998                       Label  4109                                                           4101                              
 9999                       Label  4105                                                           4026,4052,4062,4072,4080,4087,4094
                                                                                                  ,4101                             
 AMINIMUM_8                 Local  3578     R(8)            8           scalar   SAVE             3623,3625,3632,3634,3652,3653,3659
                                                                                                  ,3661,3691,3693,3699,3700,3709,371
                                                                                                  0                                 
 BMISS                      Scalar 3563     R(8)            8           scalar   COM              3600,3601,3603,3670,3727,3731,3739
                                                                                                  ,3744,3745,3776,3786,3811,3913,392
                                                                                                  1,3954,3955,3984,3996,3997,4002,40
                                                                                                  04,4005,4006,4009,4013,4047,4057,4
                                                                                                  066,4071,4074,4079,4082,4089      
 CF8                        Scalar 3568     R(4)            4     1     255      COM              4049,4059,4068,4076,4084,4091     
 DDQ                        Scalar 3570     R(4)            4           scalar   COM              3982,4011                         
 DOB                        Scalar 3567     R(4)            4     1     255      COM                                                
 DPD                        Scalar 3569     R(4)            4           scalar   COM              3892,4006,4007,4009               
 ELV                        Local  3746     R(4)            4           scalar   SAVE             3746,3973,4024                    
 EQSUBF                     Func   3978     R(4)            4           scalar                    3978,3979,3980,3981,3982          
 ERTUBF                     Func   3749     R(4)            4           scalar                    3749                              
 HDR                        Local  3579     R(4)            4     1     20       SAVE             3722,3739,3745,3746,3747          
 HDR_8                      Local  3577     R(8)            8     1     20       SAVE             3722,3727,3729,3731,3733,3735,3736
                                                                                                  ,3741,3742,3743                   
 HDSTR                      Local  3573     CHAR            80          scalar   SAVE             3586,3722                         
 I                          Local  3784     I(4)            4           scalar   SAVE             3784,3786,3957,3958,3959,3962,3963
 IBFMS                      Func   3606     I(4)            4           scalar                    3606,3616,3625,3634,3653,3661,3666
                                                                                                  ,3673,3684,3693,3700,3710         
 ICBFMS                     Func   3828     I(4)            4           scalar                    3828,3854                         
 IDS                        Local  3750     I(4)            4           scalar   SAVE             3750,4025                         
 IMISS                      Local  3589     I(4)            4           scalar   SAVE             3589,3748,3750,4023,4050,4051,4060
                                                                                                  ,4069,4070,4077,4078,4085,4086,409
                                                                                                  2,4093                            
 IRET                       Local  3604     I(4)            4           scalar   SAVE             3604,3605,3608,3609,3610,3611,3612
                                                                                                  ,3613,3614,3616,3618,3619,3621,362
                                                                                                  5,3627,3628,3630,3634,3636,3638,36
                                                                                                  39,3640,3641,3643,3644,3645,3646,3
                                                                                                  647,3648,3649,3650,3653,3655,3656,
                                                                                                  3657,3661,3663,3668,3674,3675,3677
                                                                                                  ,3678,3679,3681,3682,3684,3686,368
                                                                                                  7,3689,3693,3695,3696,3697,3700,37
                                                                                                  02,3704,3705,3706,3707,3710,3712,3
                                                                                                  722,3728,3732,3820,3846,3863,3887,
                                                                                                  3888,3889,3890,3891,3892,3897,3898

Page 100         Source Listing                  R04UBF
2017-04-18 11:09 Symbol Table                    iw3unpbf.f

 Name                       Object Declared Type            Bytes Dimen Elements Attributes       References                        
                                                                                                                                    
                                                                                                  ,3899,3900,3901,3922,3926,3930,393
                                                                                                  4,3938,3942,3947,3952,3953,3956,39
                                                                                                  57,4056,4064                      
 IRETU                      Local  3951     I(4)            4           scalar   SAVE             3951,3953                         
 ISTM                       Local  4014     I(4)            4           scalar   SAVE             4014,4015                         
 ITIWM                      Local  3575     I(4)            4     1     16       SAVE             3591,3778                         
 ITP                        Local  3748     I(4)            4           scalar   SAVE             3748,4024                         
 IUBFAA                     Common 3563                                 8        SAVE                                               
 IUBFBB                     Common 3564                                 100      SAVE                                               
 IUBFCC                     Common 3566                                 8        SAVE                                               
 IUBFEE                     Common 3567                                 9180     SAVE                                               
 IUBFGG                     Common 3569                                 24       SAVE                                               
 IUBFHH                     Common 3570                                 20       SAVE                                               
 IUBFLL                     Common 3571                                 2040     SAVE                                               
 J                          Local  3783     I(4)            4           scalar   SAVE             3783,3785,3786                    
 KFLSAT                     Scalar 3564     I(4)            4     1     12       COM                                                
 KNDX                       Scalar 3564     I(4)            4           scalar   COM                                                
 KSKACF                     Scalar 3564     I(4)            4     1     8        COM                                                
 KSKSAT                     Scalar 3564     I(4)            4           scalar   COM                                                
 KSKSFC                     Scalar 3564     I(4)            4           scalar   COM              4114                              
 KSKSMI                     Scalar 3565     I(4)            4           scalar   COM                                                
 KSKUPA                     Scalar 3564     I(4)            4           scalar   COM                                                
 LUNIT                      Dummy  3560     I(4)            4           scalar   ARG,INOUT        3604,3605,3608,3609,3610,3611,3612
                                                                                                  ,3613,3619,3628,3638,3639,3640,364
                                                                                                  1,3643,3644,3645,3646,3647,3648,36
                                                                                                  49,3656,3668,3674,3675,3677,3678,3
                                                                                                  679,3681,3687,3696,3704,3705,3706,
                                                                                                  3722,3728,3732,3738,3774,3775,3780
                                                                                                  ,3782,3791,3809,3820,3832,3846,386
                                                                                                  4,3887,3888,3889,3890,3891,3892,38
                                                                                                  97,3898,3899,3900,3901,3922,3926,3
                                                                                                  930,3934,3938,3942,3947,3951,3953,
                                                                                                  4056,4064                         
 MAX                        Func   3946                                 scalar                    3946,4006                         
 MIN                        Func   3623                                 scalar                    3623,3632,3652,3659,3691,3699,3709
                                                                                                  ,4002,4005                        
 MQMUBF                     Func   3925     I(4)            4           scalar                    3925,3929,3933,3937,3941,3945,3950
                                                                                                  ,3961,3965                        
 NINT                       Func   3740                                 scalar                    3740,3745,3778,3786,3793,3795,3797
                                                                                                  ,3811,3914,3958,3962,3985,3996,399
                                                                                                  8,4003,4004,4014,4015,4067,4075   
 NOBS3                      Dummy  3560     I(4)            4     1     7        ARG,INOUT        3602,3618,3627,3636,3655,3663,3686
                                                                                                  ,3695,3702,3712                   
 NRCT                       Local  3738     I(4)            4           scalar   SAVE             3738                              
 NRSV                       Local  3774     I(4)            4           scalar   SAVE             3774,3775,3780,3782,3791,3809     
 OB8                        Scalar 3568     R(4)            4     1     255      COM              4048,4058,4067,4075,4083,4090     
 OBS                        Dummy  3560     R(4)            4     1     0        ARG,INOUT        4101                              
 OBS2                       Dummy  3560     R(4)            4     1     43       ARG,INOUT        3714                              
 OBS2_8                     Local  3576     R(8)            8     1     43       SAVE             3600,3604,3605,3606,3608,3609,3610
                                                                                                  ,3611,3612,3638,3639,3640,3641,364
                                                                                                  3,3644,3645,3646,3647,3648,3666,36
                                                                                                  68,3669,3670,3673,3674,3675,3677,3
                                                                                                  678,3679,3704,3705,3714           
 OBS3                       Dummy  3560     R(4)            4     3     8925     ARG,INOUT        3715                              
 OBS3_8                     Local  3576     R(8)            8     3     8925     SAVE             3601,3613,3616,3619,3623,3624,3628

Page 101         Source Listing                  R04UBF
2017-04-18 11:09 Symbol Table                    iw3unpbf.f

 Name                       Object Declared Type            Bytes Dimen Elements Attributes       References                        
                                                                                                                                    
                                                                                                  ,3632,3633,3649,3652,3656,3659,366
                                                                                                  0,3681,3684,3687,3691,3692,3696,36
                                                                                                  99,3706,3709,3715                 
 OBS8_8                     Dummy  3560     R(8)            8     1     2        ARG,INOUT        3603,3735,3736                    
 POB                        Scalar 3567     R(4)            4     1     255      COM                                                
 PRVSTG                     Local  3574     CHAR            8           scalar   SAVE             3828,3832,3836                    
 PSL                        Scalar 3569     R(4)            4           scalar   COM              3887,3984,3985                    
 PSQ                        Scalar 3570     R(4)            4           scalar   COM              3978,3987                         
 Q81                        Scalar 3571     R(4)            4     1     255      COM              4050,4060,4069,4077,4085,4092     
 Q82                        Scalar 3571     R(4)            4     1     255      COM              4051,4061,4070,4071,4078,4079,4086
                                                                                                  ,4093                             
 QAL                        Local  3913     R(4)            4           scalar   SAVE             3913,3915,3929,4047,4048          
 QCD                        Local  3574     CHAR            8           scalar   SAVE             3925,3929,3933,3937,3941,3945,3950
                                                                                                  ,3961,3965                        
 QMD                        Local  3901     R(4)            4           scalar   SAVE             3901,3937,3982                    
 QMELV                      Local  3747     R(4)            4           scalar   SAVE             3747,4024                         
 QMT                        Local  3900     R(4)            4           scalar   SAVE             3900,3933,3981                    
 QMW                        Local  3899     R(4)            4           scalar   SAVE             3899,3946,3980                    
 QOB                        Scalar 3567     R(4)            4     1     255      COM                                                
 QPR                        Local  3902     R(4)            4           scalar   SAVE             3902,3950,4061                    
 QPT                        Local  3903     R(4)            4           scalar   SAVE             3903                              
 QPT1                       Local  3954     R(4)            4           scalar   SAVE             3954,3961,4082,4083               
 QPT24                      Local  3955     R(4)            4           scalar   SAVE             3955,3965,4089,4090               
 QSL                        Local  3897     R(4)            4           scalar   SAVE             3897,3921,3978,3996               
 QSP                        Local  3898     R(4)            4           scalar   SAVE             3898,3914,3915,3925,3979          
 QWD                        Local  3941     R(4)            4           scalar   SAVE             3941,3946                         
 QWS                        Local  3945     R(4)            4           scalar   SAVE             3945,3946                         
 R04UBF                     Func   3560     R(4)            4           scalar                    3593,4106,4113                    
 R04UBF@0                   Local  3560     R(4)            4           scalar   SAVE                                               
 RCSTR                      Local  3573     CHAR            80          scalar   SAVE             3587,3738                         
 RCT                        Local  3580     R(4)            4     2     1275     SAVE             3738,3740                         
 RCTIM                      Local  3740     R(4)            4           scalar   SAVE             3740,4024                         
 RCT_8                      Local  3577     R(8)            8     2     1275     SAVE             3738                              
 READLC                     Subr   3832                                                           3832,3864                         
 REQV                       Local  4056     R(4)            4           scalar   SAVE             4056,4057,4058                    
 RHR                        Local  3744     R(4)            4           scalar   SAVE             3744,3745,4024                    
 RID_8                      Local  3576     R(8)            8           scalar   SAVE             3741                              
 RMSO_8                     Local  3578     R(8)            8     1     2        SAVE             3922,3923,3926,3927,3930,3931,3934
                                                                                                  ,3935,3938,3939,3942,3943,3947,394
                                                                                                  8                                 
 RPRVSTG_8                  Local  3577     R(8)            8     1     255      SAVE             3846                              
 RQCD_8                     Local  3578     R(8)            8           scalar   SAVE             3923,3927,3931,3935,3939,3943,3948
                                                                                                  ,3959,3963                        
 RRSV                       Local  3580     R(4)            4     1     5        SAVE             3774,3777,3778,3780,3782,3786,3792
                                                                                                  ,3793,3795,3797,3809,3811         
 RRVSTG_8                   Local  3576     R(8)            8     1     255      SAVE             3820                              
 RSTP                       Local  4023     R(4)            4           scalar   SAVE             4023,4025                         
 RSV1                       Local  3574     CHAR            8           scalar   SAVE             3752,3786,3828,3836,4024          
 RSV2                       Local  3574     CHAR            8           scalar   SAVE             3753,3794,3796,3798,3800,3810,3811
                                                                                                  ,3854,3871,4024                   
 RTP                        Local  3749     R(4)            4           scalar   SAVE             3749,4024                         
 S01UBF                     Subr   4024                                                           4024                              
 S02UBF                     Subr   4026                                                           4026,4052,4062,4072,4080,4087,4094
 S03UBF                     Subr   4101                                                           4101                              
 S05UBF                     Subr   3717                                                           3717                              

Page 102         Source Listing                  R04UBF
2017-04-18 11:09 Symbol Table                    iw3unpbf.f

 Name                       Object Declared Type            Bytes Dimen Elements Attributes       References                        
                                                                                                                                    
 SDR                        Scalar 3569     R(4)            4           scalar   COM              3889,4003,4004,4005               
 SID                        Local  3574     CHAR            8           scalar   SAVE             3749,4024,4111                    
 SOB                        Scalar 3568     R(4)            4     1     255      COM                                                
 SOLR                       Local  3580     R(4)            4     2     765      SAVE             4065,4066,4067,4071,4074,4075,4079
 SOLR_8                     Local  3577     R(8)            8     2     765      SAVE             4064,4065                         
 SPQ                        Scalar 3570     R(4)            4           scalar   COM              3979,4000                         
 SPRVSTG                    Local  3574     CHAR            8           scalar   SAVE             3854,3864,3866,3871               
 SSP                        Scalar 3569     R(4)            4           scalar   COM              3890,4002,4004,4005               
 STM                        Scalar 3569     R(4)            4           scalar   COM              3891,4006,4007,4013,4014,4015     
 STP                        Scalar 3569     R(4)            4           scalar   COM              3888,3996,3997,3998               
 STQ                        Scalar 3570     R(4)            4           scalar   COM              3981,4017                         
 SUBSET                     Scalar 3566     CHAR            8           scalar   COM              3607,3637,3665,3703,3749,3755,3788
                                                                                                  ,3894,3905,3973,3996,4046,4055,410
                                                                                                  1                                 
 SWQ                        Scalar 3570     R(4)            4           scalar   COM              3980,4005                         
 TIWM                       Local  3775     R(4)            4           scalar   SAVE             3775,3776,3778                    
 TOB                        Scalar 3567     R(4)            4     1     255      COM                                                
 TOPC                       Local  3580     R(4)            4     2     1275     SAVE                                               
 TOPC_8                     Local  3578     R(8)            8     2     1275     SAVE             3951,3953,3958,3959,3962,3963     
 UFBINT                     Subr   3604                                                           3604,3605,3608,3609,3610,3611,3612
                                                                                                  ,3613,3619,3628,3638,3639,3640,364
                                                                                                  1,3643,3644,3645,3646,3647,3648,36
                                                                                                  49,3656,3668,3674,3675,3677,3678,3
                                                                                                  679,3681,3687,3696,3704,3705,3706,
                                                                                                  3722,3728,3732,3738,3774,3775,3780
                                                                                                  ,3782,3791,3809,3820,3846,3887,388
                                                                                                  8,3889,3890,3891,3892,3897,3898,38
                                                                                                  99,3900,3901,3951,4056,4064       
 UFBINT_8                   Local  3576     R(8)            8           scalar   SAVE             3728,3729,3732,3733,3774,3775,3780
                                                                                                  ,3782,3791,3792,3809,3887,3888,388
                                                                                                  9,3890,3891,3892,3897,3898,3899,39
                                                                                                  00,3901,4056                      
 UFBREP                     Subr   3922                                                           3922,3926,3930,3934,3938,3942,3947
 UFBSEQ                     Subr   3953                                                           3953                              
 VSG                        Scalar 3568     R(4)            4     1     255      COM                                                
 XOB                        Local  3742     R(4)            4           scalar   SAVE             3742,4024                         
 YOB                        Local  3743     R(4)            4           scalar   SAVE             3743,4024                         
 ZOB                        Scalar 3567     R(4)            4     1     255      COM                                                

Page 103         Source Listing                  R04UBF
2017-04-18 11:09                                 iw3unpbf.f

   4027 
   4028 C  ------------------------------------------------------------------
   4029 C  MISC DATA GOES INTO DATA LEVEL CATEGORY 08
   4030 C  ------------------------------------------------------------------
   4031 C  CODE FIGURE 003 - DIFFUSE SOLAR RADIATION IN 100.*JOULE/M**2
   4032 C                    INDICATOR 2 CONTAINS TIME PERIOD OVER WHICH
   4033 C                     RADIATION WAS INTEGRATED (MINUTES)
   4034 C  CODE FIGURE 004 - DIRECT SOLAR RADIATION IN 100.*JOULE/M**2
   4035 C                    INDICATOR 2 CONTAINS TIME PERIOD OVER WHICH
   4036 C                     RADIATION WAS INTEGRATED (MINUTES)
   4037 C  CODE FIGURE 005 - QUALITY MARKER FOR TOTAL PRECIP. OVER  1-HR
   4038 C  CODE FIGURE 006 - QUALITY MARKER FOR TOTAL PRECIP. OVER 24-HR
   4039 C  CODE FIGURE 020 - QUALITY MARKER FOR ALTIMETER SETTING
   4040 C  CODE FIGURE 198 - RAINFALL RATE (MM/SEC, TO 10**6 PRECISION FOR
   4041 C                     SSM/I AND TO 10**4 PRECISION FOR ALL OTHER DATA
   4042 C                     TYPES)
   4043 C                    INDICATOR 2 CONTAINS RAINFALL RATE QUALITY MARKER
   4044 C  ------------------------------------------------------------------
   4045 
   4046       IF(SUBSET(1:5).EQ.'NC255'.OR.SUBSET.EQ.'NC000007')  THEN
   4047          IF(QAL.LT.BMISS)  THEN
   4048             OB8(1) = QAL
   4049             CF8(1) = 20 
   4050             Q81(1) = IMISS
   4051             Q82(1) = IMISS
   4052             CALL S02UBF(8,1,*9999)
   4053          END IF
   4054       END IF
   4055       IF(SUBSET(1:5).EQ.'NC255')  THEN
   4056          CALL UFBINT(LUNIT,UFBINT_8,1,1,IRET,'REQV');REQV=UFBINT_8
   4057          IF(REQV.LT.BMISS) THEN
   4058             OB8(1) =  REQV
   4059             CF8(1) = 198
   4060             Q81(1) = IMISS
   4061             Q82(1) = QPR
   4062             CALL S02UBF(8,1,*9999)
   4063          END IF
   4064          CALL UFBINT(LUNIT,SOLR_8,3,255,IRET,'DFSORD DRSORD TPMI')
   4065          SOLR=SOLR_8
   4066          IF(SOLR(1,1).LT.BMISS)  THEN
   4067             OB8(1) = NINT(SOLR(1,1)*0.01)
   4068             CF8(1) = 3
   4069             Q81(1) = IMISS
   4070             Q82(1) = IMISS
   4071             IF(SOLR(3,1).LT.BMISS)  Q82(1) = SOLR(3,1)
   4072             CALL S02UBF(8,1,*9999)
   4073          END IF
   4074          IF(SOLR(2,1).LT.BMISS)  THEN
   4075             OB8(1) = NINT(SOLR(2,1)*0.01)
   4076             CF8(1) = 4
   4077             Q81(1) = IMISS
   4078             Q82(1) = IMISS
   4079             IF(SOLR(3,1).LT.BMISS)  Q82(1) = SOLR(3,1)
   4080             CALL S02UBF(8,1,*9999)
   4081          END IF
   4082          IF(QPT1.LT.BMISS)  THEN
   4083             OB8(1) = QPT1

Page 104         Source Listing                  R04UBF
2017-04-18 11:09                                 iw3unpbf.f

   4084             CF8(1) = 5
   4085             Q81(1) = IMISS
   4086             Q82(1) = IMISS
   4087             CALL S02UBF(8,1,*9999)
   4088          END IF
   4089          IF(QPT24.LT.BMISS)  THEN
   4090             OB8(1) = QPT24
   4091             CF8(1) = 6
   4092             Q81(1) = IMISS
   4093             Q82(1) = IMISS
   4094             CALL S02UBF(8,1,*9999)
   4095          END IF
   4096          GO TO 75
   4097       END IF
   4098  
   4099   75  CONTINUE
   4100 
   4101       CALL S03UBF(OBS,SUBSET,*9999,*9998,*9997)
   4102  
   4103       RETURN
   4104 
   4105  9999 CONTINUE
   4106       R04UBF = 999
   4107       RETURN
   4108 
   4109  9998 CONTINUE
   4110       print'(" IW3UNPBF/R04UBF: RPT with ID= ",A," TOSSED - ZERO ",
   4111      $ "CAT.1-6,51 LVLS")', SID
   4112  9997 CONTINUE
   4113       R04UBF = -9999
   4114       KSKSFC =KSKSFC + 1
   4115       RETURN
   4116 
   4117       END
   4118 C***********************************************************************
   4119 C***********************************************************************
   4120 C***********************************************************************
   4121       FUNCTION R05UBF(LUNIT,OBS,OBS2,OBS3,NOBS3,obs8_8)
   4122 C     ---> PROCESSES AIRCRAFT DATA (004/001-004, 004/006-011, 004/103)
   4123 
   4124       COMMON/IUBFAA/BMISS
   4125       COMMON/IUBFBB/KNDX,KSKACF(8),KSKUPA,KSKSFC,KSKSAT,KFLSAT(12),
   4126      $ KSKSMI
   4127       COMMON/IUBFCC/SUBSET
   4128       COMMON/IUBFEE/POB(255),QOB(255),TOB(255),ZOB(255),DOB(255),
   4129      $              SOB(255),VSG(255),OB8(255),CF8(255)
   4130       COMMON/IUBFFF/PQM(255),QQM(255),TQM(255),ZQM(255),WQM(255)
   4131       COMMON/IUBFLL/Q81(255),Q82(255)
   4132       COMMON/IUBFRR/IDATEB
   4133       COMMON/IUBFSS/CBULLX
   4134  
   4135       CHARACTER*80 HDSTR,LVSTR,QMSTR,RCSTR,CRAWR
   4136       CHARACTER*500 CRAWRX
   4137       CHARACTER*11  CBULLX
   4138       CHARACTER*8  SUBSET,SID,RSV1,RSV2,CRAW(255),ACID,QCD,CBUHD,
   4139      $ CBORG,actp,obsvr
   4140       REAL(8) RID_8,UFBINT_8,RNS_8,OBS2_8(43),OBS3_8(5,255,7),

Page 105         Source Listing                  R05UBF
2017-04-18 11:09                                 iw3unpbf.f

   4141      $ RACID_8,RTAM_8(2),RTAM_WDIR_8,RQCD_8,BULL_8(2),RTAMB_8(7),
   4142      $ ractp_8,robsvr_8,obs8_8(2)
   4143       REAL(8) HDR_8(20),RCT_8(5,255),ARR_8(10,255),RAW_8(255),TRBX_8(5),
   4144      $ ROLF_8,BMISS,AMINIMUM_8,AMAXIMUM_8,rialr_8
   4145       DIMENSION    OBS(*),OBS2(43),OBS3(5,255,7),NOBS3(7),HDR(20),
   4146      $ RCT(5,255),ARR(10,255),TRBX(5)
   4147       EQUIVALENCE  (RID_8,SID),(RAW_8,CRAW),(RACID_8,ACID),
   4148      $ (RQCD_8,QCD),(BULL_8(1),CBORG),(BULL_8(2),CBUHD),(ractp_8,actp),
   4149      $ (robsvr_8,obsvr)
   4150 
   4151       SAVE
   4152  
   4153       DATA HDSTR/'RPID CLON CLAT HOUR MINU SECO               '/
   4154       DATA LVSTR/'PRLC MIXR TMDB WDIR WSPD REHU               '/
   4155       DATA QMSTR/'QMPR QMAT QMDD QMGP QMWN                    '/
   4156       DATA RCSTR/'RCHR RCMI RCTS                              '/
   4157  
   4158       DATA IMISS/99999/,XMISS/99999./
   4159 
   4160 C FCNS HGTF_HI, HGTF_LO CALC. Z FROM P < 226.3MB AND P > 226.3MB; RESP
   4161 C  (U.S. STANDARD ATMOSPHERE)
   4162 
   4163       HGTF_HI(P) = 11000 - ALOG(P/226.3)/1.576106E-4
   4164       HGTF_LO(P) = (1.-(P/1013.25)**(1./5.256))*(288.15/.0065)
   4165 
   4166 C  FCNS BELOW CONVERT SAT./SPEC. HUM.(KG/KG) & PRESS(MB) INTO TEMP/TD(K)
   4167 C  ---------------------------------------------------------------------
   4168 
   4169       AS(Q,P) = ALOG((Q * P)/(6.1078 * ((0.378 * Q) + 0.622)))
   4170       TFRMQP(Q,P) = ((237.3 * AS(Q,P))/(17.269 - AS(Q,P)) + 273.16)
   4171 
   4172 C  FCNS BELOW CONVERT TEMP/TD(K) & PRESS(MB) INTO SAT./SPEC. HUM.(KG/KG)
   4173 C  ---------------------------------------------------------------------
   4174 
   4175       ES(T) = 6.1078 * EXP((17.269 * (T - 273.16))/((T - 273.16)+237.3))
   4176       QFRMTP(T,P) = (0.622 * ES(T))/(P - (0.378 * ES(T)))
   4177 
   4178 C  Fcns below estimate pressure (mb) using indicated altitude (m) via
   4179 C  U.S. Std. Atmos. Est. for Z <= 11,000 and Z > 11,000 respectively
   4180 C  ------------------------------------------------------------------
   4181 
   4182       PR(Z) = 1013.25 * (((288.15 - (.0065 * Z))/288.15)**5.256)
   4183       PRS(Z) = 226.3 * EXP(1.576106E-4 * (11000. - Z))
   4184 
   4185       R05UBF = 0
   4186 
   4187 C  STORE SINGLE LEVEL REPORT DATA DIRECTLY INTO OBS2 ARRAY,
   4188 C   MULTIPLE LEVEL REPORT DATA DIRECTLY INTO OBS3 ARRAY AND
   4189 C   DOUBLE-PRECISION SINGLE LEVEL REPORT DATA DIRECTLY INTO OBS8_8 ARRAY
   4190 C  ---------------------------------------------------------------------
   4191 
   4192       OBS2_8 = BMISS
   4193       OBS3_8 = BMISS
   4194       NOBS3  = 0
   4195       obs8_8 = bmiss
   4196       CALL UFBINT(LUNIT,OBS2_8,2,1,IRET,'RSRD EXPRSRD')
   4197                                                          ! All AIRCRAFT

Page 106         Source Listing                  R05UBF
2017-04-18 11:09                                 iw3unpbf.f

   4198       CALL UFBINT(LUNIT,OBS3_8(1,1,7),5,255,IRET,'DGOT HBOT HTOT')
   4199       IF(IRET.EQ.1) THEN ! reset iret from 1 to 0 if all obs missing
   4200                          !  (iret can be 1 even if all obs missing)
   4201          AMINIMUM_8 = MIN(OBS3_8(1,1,7),OBS3_8(2,1,7),OBS3_8(3,1,7))
   4202          IF(IBFMS(AMINIMUM_8).NE.0) IRET = 0
   4203       END IF
   4204       NOBS3(7) = IRET
   4205       IF(SUBSET.EQ.'NC004002')  THEN                           ! PIREPs
   4206          CALL UFBINT(LUNIT,OBS3_8(1,1,2),5,255,IRET,'PRWE')
   4207          IF(IRET.EQ.1) THEN ! reset iret from 1 to 0 if all obs missing
   4208                             !  (iret can be 1 even if all obs missing)
   4209             IF(IBFMS(OBS3_8(1,1,2)).NE.0)  IRET = 0
   4210          END IF
   4211          NOBS3(2) = IRET
   4212          CALL UFBINT(LUNIT,OBS3_8(1,1,3),5,255,IRET,
   4213      $                                        'NUL CLAM CLTP HOCB HOCT')
   4214          IF(IRET.EQ.1) THEN ! reset iret from 1 to 0 if all obs missing
   4215                             !  (iret can be 1 even if all obs missing)
   4216             AMINIMUM_8 = MIN(OBS3_8(2,1,3),OBS3_8(3,1,3),OBS3_8(4,1,3),
   4217      $       OBS3_8(5,1,3))
   4218             IF(IBFMS(AMINIMUM_8).NE.0) IRET = 0
   4219          END IF
   4220          NOBS3(3) = IRET
   4221       ELSE IF(SUBSET.EQ.'NC004004')  THEN                !  MDCRS ACARS
   4222          CALL UFBINT(LUNIT,OBS2_8(42),1,1,IRET,'MSTQ')
   4223       END IF
   4224       IF(SUBSET.EQ.'NC004002'.OR.SUBSET.EQ.'NC004006'.OR.
   4225      $   SUBSET.EQ.'NC004009'.OR.SUBSET.EQ.'NC004010')  THEN
   4226                         ! PIREPs, E-AMDAR, Canadian AMDAR, TAMDARB
   4227          CALL UFBINT(LUNIT,OBS3_8(1,1,6),5,255,IRET,'AFIC HBOI HTOI')
   4228                                      ! For TAMDAR only AFIC is present
   4229                                      ! and only in older AirDAT
   4230          IF(IRET.EQ.1) THEN ! reset iret from 1 to 0 if all obs missing
   4231                             !  (iret can be 1 even if all obs missing)
   4232             AMINIMUM_8 = MIN(OBS3_8(1,1,6),OBS3_8(2,1,6),OBS3_8(3,1,6))
   4233             IF(IBFMS(AMINIMUM_8).NE.0) IRET = 0
   4234          END IF
   4235          NOBS3(6) = IRET
   4236       END IF
   4237       OBS2 = OBS2_8
   4238       OBS3 = OBS3_8
   4239 
   4240       CALL S05UBF
   4241  
   4242 C  PUT THE HEADER INFORMATION INTO UNPACKED FORMAT
   4243 C  -----------------------------------------------
   4244  
   4245       CALL UFBINT(LUNIT,HDR_8,20,  1,IRET,HDSTR);HDR(2:)=HDR_8(2:)
   4246 
   4247 C  If low res lat/lon missing, report likely contains hi res lat/lon
   4248 C  -----------------------------------------------------------------
   4249 
   4250       IF(HDR_8(2).GE.BMISS)  THEN
   4251          CALL UFBINT(LUNIT,UFBINT_8,1,1,IRET,'CLONH')
   4252          HDR_8(2)=UFBINT_8
   4253       END IF
   4254       IF(HDR_8(3).GE.BMISS)  THEN

Page 107         Source Listing                  R05UBF
2017-04-18 11:09                                 iw3unpbf.f

   4255          CALL UFBINT(LUNIT,UFBINT_8,1,1,IRET,'CLATH')
   4256          HDR_8(3)=UFBINT_8
   4257       END IF
   4258       obs8_8(1) = hdr_8(3)
   4259       obs8_8(2) = hdr_8(2)
   4260 
   4261       IF(IRET.EQ.0)  SID = '        '
   4262       CALL UFBINT(LUNIT,RCT_8, 5,255,NRCT,RCSTR);RCT=RCT_8
   4263       IF(HDR(5).GE.BMISS) HDR(5) = 0
   4264       IF(HDR(6).GE.BMISS) HDR(6) = 0
   4265       RCTIM = NINT(RCT(1,1))+NINT(RCT(2,1))/60.
   4266       RID_8 = HDR_8(1)
   4267       XOB   = HDR_8(2)
   4268       YOB   = HDR_8(3)
   4269       RHR   = BMISS
   4270       IF(HDR(4).LT.BMISS) RHR = (NINT(HDR(4)) + ((NINT(HDR(5)) * 60.) +
   4271 cvvvvvdak port
   4272 cdak $  NINT(HDR(6)))/3600.) + 0.0000000001  ! orig
   4273 cdak $  NINT(HDR(6)))/3600.) + 0.0001        ! then changed to this
   4274 caaaaadak port
   4275      $  NINT(HDR(6)))/3600.)   ! don't make this adjustment now that we
   4276                                ! store obs time to 10**5 in PREPBUFR
   4277  
   4278 C  TRY TO FIND THE FLIGHT LEVEL HEIGHT
   4279 C  -----------------------------------
   4280 
   4281       CALL UFBINT(LUNIT,HDR_8,20,1,IRET,
   4282      $ 'PSAL FLVL IALT PRLC HEIT HMSL FLVLST')
   4283       HDR=HDR_8
   4284  
   4285 C If this type reports pressure (PRLC) store it here -- PREPDATA uses
   4286 C  this for pressure (currently applies to pre-v7 BUFR MDCRS and MADIS/
   4287 C  TAMDAR only)
   4288 C   -- in this case PREPDATA uses a pressure-altitude derived from PRLC
   4289 C      via standard atmosphere function unless line
   4290 C           "IF(HDR(3).LT.BMISS)  ELEV = HDR(3)"
   4291 C      below is uncommented, in which case PREPDATA uses IALT (altitude)
   4292 C      (if reported) as pressure-altitude (IALT is the only height
   4293 C      type reported for MDCRS, both pre- and post-v7 BUFR; it is not
   4294 C      reported for MADIS/TAMDAR, in fact no height type is reported for
   4295 C      MADIS/TAMDAR)
   4296 C-----------------------------------------------------------------------
   4297 C Otherwise, if this type does not report pressure (PRLC) but does
   4298 C  report PSAL (pressure altitude), PREPDATA uses reported PSAL as
   4299 C  pressure-altitude (currently applies to AMDAR format only, both PSAL
   4300 C  and FLVL are included but in most cases FLVL is missing, PSAL is
   4301 C  never missing and where PSAL and FLVL are both non-missing they are
   4302 C  identical)
   4303 C  PREPDATA later derives pressure from PSAL via standard atmosphere
   4304 C  function
   4305 C-----------------------------------------------------------------------
   4306 C Otherwise, if this type does not report pressure (PRLC) but does
   4307 C  report FLVL (flight level), PREPDATA uses reported FLVL as pressure-
   4308 C  altitude (currently applies to AIREP/PIREP format only, both PSAL
   4309 C  and FLVL are included but only FLVL is non-missing)
   4310 C  PREPDATA later derives pressure from FLVL via standard atmosphere
   4311 C  function

Page 108         Source Listing                  R05UBF
2017-04-18 11:09                                 iw3unpbf.f

   4312 C-----------------------------------------------------------------------
   4313 C Otherwise, if this type does not report pressure (PRLC) but does
   4314 C  report FLVLST (flight level), PREPDATA uses reported FLVLST as
   4315 C  pressure-altitude {currently applies to Korean AMDAR, catch-all
   4316 C  AMDAR (from BUFR feed)}
   4317 C  PREPDATA later derives pressure from FLVLST via standard atmosphere
   4318 C  function
   4319 C
   4320 C  2016-07-27  C. Hill --
   4321 C         - PAC/AirDat has confirmed HMSL is pressure-altitude for
   4322 C           the TAMDAR dataset, and should be used to derive pressure
   4323 C           values. FLVLST is GPS altitude for TAMDAR.
   4324 C         - For the previous UFBINT statement, FLVLST is reordered after
   4325 C           PRLC, HEIT, and HMSL, as HEIT and HMSL are both missing for
   4326 C           Korean AMDAR and catch-all AMDAR, and are therefore skipped.
   4327 C         - The order of precedence in defining ELEV is:
   4328 C           PRLC, IALT, PSAL, FLVL, HEIT, HMSL, and FLVLST
   4329 C-----------------------------------------------------------------------
   4330 C Otherwise, if this type does not report pressure (PRLC) but does
   4331 C  report IALT (altitude), PREPDATA uses reported IALT as pressure-
   4332 C  altitude (currently applies to post-v7 BUFR MDCRS only)
   4333 C  PREPDATA later derives pressure from IALT via standard atmosphere
   4334 C  function
   4335 C-----------------------------------------------------------------------
   4336 C Otherwise, if this type does not report pressure (PRLC) but does
   4337 C  report HEIT (height), PREPDATA uses reported HEIT as pressure-
   4338 C  altitude (currently applies to no reports, HEIT is included in
   4339 C  E-AMDAR and Canadian AMDAR but is always missing)
   4340 C  PREPDATA later derives pressure from HEIT via standard atmosphere
   4341 C  function
   4342 C-----------------------------------------------------------------------
   4343 C Otherwise, if this type does not report pressure (PRLC) but does
   4344 C  report HMSL (altitude), PREPDATA uses reported HMSL as pressure-
   4345 C  altitude (currently applies to E-AMDAR and Canadian AMDAR, both HEIT
   4346 C  and HMSL are included but only HMSL is non-missing; HMSL is
   4347 C  non-missing for AirDAT/TAMDAR)
   4348 C  PREPDATA later derives pressure from HMSL via standard atmosphere
   4349 C  function
   4350 C-----------------------------------------------------------------------
   4351 
   4352       IF(HDR(4).LT.BMISS)  THEN
   4353 ! pressure is non-missing - initially get elev from pressure
   4354 !  pre-v7 BUFR MDCRS and MADIS/TAMDAR
   4355          IF(HDR(4).LT.22630) THEN
   4356             ELEV = HGTF_HI(HDR(4)*.01)
   4357          ELSE
   4358             ELEV = HGTF_LO(HDR(4)*.01)
   4359          END IF
   4360       ELSE IF (HDR(3).LT.BMISS) THEN
   4361          ELEV = HDR(3)        ! IALT (post-v7 BUFR MDCRS)
   4362       ELSE
   4363          ELEV = BMISS
   4364       ENDIF
   4365 
   4366 CCCC  ELSE
   4367 CCCC    ELEV = BMISS
   4368         IF(HDR(1).LT.BMISS) THEN

Page 109         Source Listing                  R05UBF
2017-04-18 11:09                                 iw3unpbf.f

   4369                               ! PSAL (AMDAR format)
   4370            ELEV = HDR(1) + SIGN(0.0000001,HDR(1))
   4371         ELSE  IF(HDR(2).LT.BMISS)  THEN
   4372                               ! FLVL (AIREP/PIREP format)
   4373            ELEV = HDR(2) + SIGN(0.0000001,HDR(2))
   4374   !! uncomment next 2 lines to obtain elev from IALT when PRLC
   4375   !!  non-missing (applies to pre-v7 BUFR MDCRS)
   4376 CCCC    ELSE  IF(HDR(3).LT.BMISS.AND.HDR(4).LT.BMISS)  THEN
   4377 CCCC       ELEV = HDR(3)
   4378         ELSE  IF(HDR(5).LT.BMISS)  THEN
   4379                               ! HEIT (none right now)
   4380            ELEV = HDR(5) + SIGN(0.0000001,HDR(5))
   4381         ELSE  IF(HDR(6).LT.BMISS)  THEN
   4382                               ! HMSL (E-AMDAR, Canadian AMDAR & TAMDARB)
   4383            ELEV = HDR(6) + SIGN(0.0000001,HDR(6))
   4384         ELSE  IF(HDR(7).LT.BMISS)  THEN
   4385                               ! FLVLST (Catch-all & Korean BUFR AMDAR)
   4386            ELEV = HDR(7) + SIGN(0.0000001,HDR(7))
   4387         END IF
   4388 CCCC  END IF
   4389 
   4390       ELV = ELEV
   4391       QMELV = XMISS
   4392 
   4393 C  ACFT NAVIGATION SYSTEM STORED IN INSTR. TYPE LOCATION (AS WITH ON29)
   4394 C  --------------------------------------------------------------------
   4395 
   4396       ITP = IMISS
   4397       CALL UFBINT(LUNIT,RNS_8,1,1,IRET,'ACNS');RNS=RNS_8
   4398       IF(RNS.LT.BMISS)  THEN
   4399          IF(NINT(RNS).EQ.0)  THEN
   4400             ITP = 97  ! Inertial Navigation System
   4401          ELSE  IF(NINT(RNS).EQ.1)  THEN
   4402             ITP = 98  ! OMEGA
   4403          END IF
   4404       END IF
   4405 
   4406       RTP = 041
   4407       READ(SUBSET(6:8),'(I3.3)')ISTP
   4408       RSTP=ISTP
   4409 
   4410       IDS = IMISS
   4411 
   4412       RSV1 = '        '
   4413       RSV2 = '        '
   4414 
   4415 C  BULLETIN HEADER AND ORIGINATOR STORED IN CBULLX
   4416 C  -----------------------------------------------
   4417 
   4418       CALL UFBINT(LUNIT,BULL_8,2,1,IRET,'BORG BUHD')
   4419 
   4420 cccc  IF(IRET.NE.0.AND.(BULL_8(1).LE.BMISS-5000..OR.
   4421 cccc $ BULL_8(1).GE.BMISS+5000.)) THEN
   4422 cxxxx
   4423 cpppppppppp
   4424 cc    print'(" bull_8(1),icbfms(CBORG,8): ",G0,1X,I0)', bull_8(1),
   4425 cc   $ icbfms(CBORG,8)

Page 110         Source Listing                  R05UBF
2017-04-18 11:09                                 iw3unpbf.f

   4426 cpppppppppp
   4427 ccccc IF(ICBFMS(CBORG,8).EQ.0) THEN
   4428 C above line not working right - may return 0 when missing, so use next
   4429 C  two lines below temporarily until this is fixed (readlc will return
   4430 C  all blanks for CBORG when mnemonic "BORG" not found) - dak 2/19/13
   4431 C   {Note: For Panasonic (AirDAT) TAMDAR, BORG and BUHD are always
   4432 C          missing, so set CBORG to all blanks and don't call READLC
   4433 C          because it will print out warning messages.}
   4434          if(subset.eq.'NC004010')  then
   4435             CBORG = '        '
   4436          else
   4437             call readlc(lunit,CBORG,'BORG')
   4438          end if
   4439 cpppppppppp
   4440 cc    print'(" CBORG = """,A,"""")', CBORG
   4441 cpppppppppp
   4442          if(CBORG.ne.'        ')  then
   4443 cxxxx
   4444          CBULLX = CBUHD(1:6)//' '//CBORG(1:4)
   4445       ELSE
   4446          CALL UFBINT(LUNIT,BULL_8,2,1,IRET,'ICLI')  ! Prior to  5/2002
   4447 cccc     IF(IRET.NE.0.AND.(BULL_8(1).LE.BMISS-5000..OR.
   4448 cccc $    BULL_8(1).GE.BMISS+5000.))  CBULLX = '       '//CBORG(1:4)
   4449 cxxxx
   4450 cpppppppppp
   4451 cc    print'(" bull_8(1),icbfms(CBORG,8): ",G0,1X,I0)', bull_8(1),
   4452 cc   $ icbfms(CBORG,8)
   4453 cpppppppppp
   4454          IF(ICBFMS(CBORG,8).EQ.0) CBULLX = '       '//CBORG(1:4)
   4455 C above line not working right - may return 0 when missing, so use next
   4456 C  two lines below temporarily until this is fixed (readlc will return
   4457 C  all blanks for CBORG when mnemonic "ICLI" not found) - dak 2/19/13
   4458 C   {Note: For Panasonic (AirDAT) TAMDAR, ICLI is always missing, so set
   4459 C          CBORG to all blanks and don't call READLC because it will
   4460 C          print out warning messages.}
   4461          if(subset.eq.'NC004010')  then
   4462             CBORG = '        '
   4463          else
   4464             call readlc(lunit,CBORG,'ICLI')
   4465          end if
   4466 cpppppppppp
   4467 cc    print'(" CBORG = """,A,"""")', CBORG
   4468 cpppppppppp
   4469          CBULLX = '       '//CBORG(1:4)
   4470                               ! will set CBULLX back to all blanks
   4471                               !  if readlc returns CBORG as all blanks
   4472                               !  {CBULLX may have been set to
   4473                               !  garbage above if ICBFMS incorrectly
   4474                               !  returned as zero when CBORG is
   4475                               !  actually missing) -- if CBORG is
   4476                               !  filled with a valid character string
   4477                               !  by readlc, this will also get
   4478                               !  translated into CBULLX here
   4479                               ! will also set CBULLX to all blanks if
   4480                               !  if Panasonic (AirDAT) TAMDAR
   4481 cxxxx
   4482       END IF

Page 111         Source Listing                  R05UBF
2017-04-18 11:09                                 iw3unpbf.f

   4483 
   4484       PCT   = BMISS
   4485       POF   = BMISS
   4486       TRBX  = BMISS
   4487       ROLF  = BMISS
   4488       RIALR = BMISS
   4489       QTRBX = IMISS
   4490 
   4491       IF(SUBSET.EQ.'NC004003')  THEN
   4492  
   4493 C  --------------------------------------
   4494 C  AMDAR FORMAT AIRCRAFT TYPE COME HERE
   4495 C  --------------------------------------
   4496 
   4497 C  AFWA (NEVER HAPPENS) INDICATOR STORED IN BYTE 1 OF HEADER RESERVE
   4498 C   CHARACTER WORD 2
   4499 C   (NOTE: NAS9000 ONLY ASSIGNED BULLETIN ORIGINATOR "KAWN" AS AFWA,
   4500 C          ALTHOUGH BULLETIN ORIGINATORS "PHWR" AND "EGWR" ARE
   4501 C          APPARENTLY ALSO AFWA)
   4502 C  -----------------------------------------------------------------
   4503 
   4504          IF(CBULLX(8:11).EQ.'KAWN')  RSV2(1:1) = 'C'
   4505 
   4506       ELSE IF(SUBSET.EQ.'NC004004') THEN
   4507  
   4508 C  -------------------------------------
   4509 C  MDCRS ACARS AIRCRAFT TYPE COME HERE
   4510 C  -------------------------------------
   4511  
   4512          CALL UFBINT(LUNIT,RID_8,1,1,IRET,'ACRN')
   4513 cccc     IF(IRET.EQ.0.OR.(RID_8.GT.BMISS-5000..AND.RID_8.LT.BMISS+
   4514 cccc $    5000.))  SID = 'ACARS   '
   4515 cxxxx
   4516 cpppppppppp
   4517 cc    print'(" rid_8,icbfms(sid,8): ",G0,1X,I0)', rid_8,icbfms(sid,8)
   4518 cpppppppppp
   4519 ccccc    IF(ICBFMS(SID,8).NE.0) SID = 'ACARS   '
   4520 C above line not working right - may return 0 when missing, so use next
   4521 C  two lines below temporarily until this is fixed (readlc will return
   4522 C  all blanks for sid when mnemonic "ACRN" not found) - dak 2/19/13
   4523          call readlc(lunit,sid,'ACRN')
   4524 cpppppppppp
   4525 cc    print'(" sid = """,A,"""")', sid
   4526 cpppppppppp
   4527          if(sid.eq.'        ')  sid = 'ACARS   '
   4528 cxxxx
   4529 
   4530 C  FLIGHT NUMBER STORED IN HEADER RESERVE CHARACTER WORD 2 (C*8)
   4531 C  -------------------------------------------------------------
   4532 
   4533          CALL UFBINT(LUNIT,RACID_8,1,1,IRET,'ACID')
   4534 cccc     IF(IRET.EQ.0.OR.(RACID_8.GT.BMISS-5000..AND.RACID_8.LT.BMISS+
   4535 cccc $    5000.))  ACID = '        '
   4536 cxxxx
   4537 cpppppppppp
   4538 cc    print'(" racid_8,icbfms(acid,8): ",G0,1X,I0)',
   4539 cc   $ racid_8,icbfms(acid,8)

Page 112         Source Listing                  R05UBF
2017-04-18 11:09                                 iw3unpbf.f

   4540 cpppppppppp
   4541 ccccc    IF(ICBFMS(ACID,8).NE.0) ACID = '        '
   4542 C above line not working right - may return 0 when missing, so use next
   4543 C  two lines below temporarily until this is fixed (readlc will return
   4544 C  all blanks for acid when mnemonic "ACID" not found) - dak 2/19/13
   4545          call readlc(lunit,acid,'ACID')
   4546 cpppppppppp
   4547 cc    print'(" acid = """,A,"""")', acid
   4548 cpppppppppp
   4549          if(acid.eq.'        ')  acid = '        ' ! kind of obvious!
   4550 cxxxx
   4551          RSV2 = ACID
   4552          KNDX = KNDX + 1
   4553 
   4554 C  GET TURBULENCE INDEX FOR LATER STORAGE INTO DATA LEVEL CATEGORY 8
   4555 C  -----------------------------------------------------------------
   4556 
   4557          CALL UFBINT(LUNIT,TRBX_8,4,1,IRET,
   4558      $    'TRBX10 TRBX21 TRBX32 TRBX43');TRBX(1:4)=TRBX_8(1:4)
   4559 
   4560       ELSE IF(SUBSET.EQ.'NC004006'.OR.SUBSET.EQ.'NC004009'.OR.
   4561      $        SUBSET.EQ.'NC004010') THEN
   4562  
   4563 C  ------------------------------------------------------------
   4564 C  E-AMDAR, CANADIAN AMDAR, and TAMDARB AIRCRAFT TYPE COME HERE
   4565 C  ------------------------------------------------------------
   4566  
   4567          CALL UFBINT(LUNIT,RID_8,1,1,IRET,'ACRN')
   4568 cccc     IF(IRET.EQ.0.OR.(RID_8.GT.BMISS-5000..AND.RID_8.LT.BMISS+
   4569 cccc $    5000.))  THEN
   4570 cxxxx
   4571 cpppppppppp
   4572 cc    print'(" rid_8,icbfms(sid,8): ",G0,1X,I0)', rid_8,icbfms(sid,8)
   4573 cpppppppppp
   4574 ccccc    IF(ICBFMS(SID,8).NE.0) THEN
   4575 C above line not working right - may return 0 when missing, so use next
   4576 C  two lines below temporarily until this is fixed (readlc will return
   4577 C  all blanks for sid when mnemonic "ACRN" not found) - dak 2/19/13
   4578          call readlc(lunit,sid,'ACRN')
   4579 cpppppppppp
   4580 cc    print'(" sid = """,A,"""")', sid
   4581 cpppppppppp
   4582          if(sid.eq.'        ')  then
   4583 cxxxx
   4584             IF(SUBSET.EQ.'NC004006')  THEN
   4585                SID = 'E-AMDAR '
   4586             ELSE IF(SUBSET.EQ.'NC004009') THEN
   4587                SID = 'CA-AMDAR'
   4588             ELSE
   4589                SID = 'TAMDARB '
   4590             END IF
   4591          END IF
   4592 
   4593          IF(SUBSET.EQ.'NC004010') THEN
   4594 
   4595 C     .................................................
   4596 C     PANASONIC (AirDAT) TAMDAR AIRCRAFT TYPE COME HERE

Page 113         Source Listing                  R05UBF
2017-04-18 11:09                                 iw3unpbf.f

   4597 C     .................................................
   4598 
   4599 C  GET INSTANTANEOUS ALTITUDE RATE FOR LATER STORAGE INTO DATA LEVEL
   4600 C   CATEGORY 8
   4601 C  -----------------------------------------------------------------
   4602 
   4603             CALL UFBINT(LUNIT,RIALR_8,1,1,IRET,'IALR');RIALR=RIALR_8
   4604 
   4605 C  TYPE OF COMMERCIAL AIRCRAFT STORED IN HEADER RESERVE CHARACTER
   4606 C   WORD 2 (C*8)
   4607 C  --------------------------------------------------------------
   4608 
   4609             CALL UFBINT(LUNIT,RACTP_8,1,1,IRET,'ACTP')
   4610             if(ibfms(RACTP_8).ne.0) ACTP = '        '
   4611             RSV2 = ACTP
   4612 
   4613 C  OBSERVER IDENTIFICATION STORED IN BYTES 1-4 OF HEADER RESERVE
   4614 C   CHARACTER WORD 1
   4615 C  -------------------------------------------------------------
   4616 
   4617             CALL UFBINT(LUNIT,ROBSVR_8,1,1,IRET,'OBSVR')
   4618             if(ibfms(ROBSVR_8).ne.0) OBSVR(1:4) = '    '
   4619             RSV1(1:4) = OBSVR(1:4)
   4620 
   4621          END IF
   4622 
   4623       else if(subset.eq.'NC004011'.or.subset.eq.'NC004103') then
   4624 
   4625 C  --------------------------------------------------------
   4626 C  KOREAN AMDAR AND CATCH-ALL AMDAR AIRCRAFT TYPE COME HERE
   4627 C  --------------------------------------------------------
   4628 
   4629          CALL UFBINT(LUNIT,RID_8,1,1,IRET,'ACRN')
   4630          CALL UFBINT(LUNIT,RACID_8,1,1,IRET,'ACID')
   4631 
   4632          if(ibfms(rid_8).eq.1) then ! ACRN missing; use ACID
   4633             rid_8 = racid_8
   4634             if(ibfms(rid_8).eq.1) then ! ACRN and ACID both missing
   4635                IF(SUBSET.EQ.'NC004011')  THEN
   4636                   SID = 'K-AMDAR '
   4637                ELSE
   4638                   SID = 'AMDAR-BF'
   4639                END IF
   4640             end if
   4641          end if
   4642 
   4643          if(ibfms(racid_8).eq.1) then
   4644             ACID = '        '
   4645          end if
   4646 
   4647 C  FLIGHT NUMBER STORED IN HEADER RESERVE CHARACTER WORD 2 (C*8)
   4648 C  -------------------------------------------------------------
   4649          if(subset.eq.'NC004103') RSV2 = ACID
   4650 
   4651       ELSE IF(SUBSET.EQ.'NC004008'.OR.SUBSET.EQ.'NC004012'.OR.
   4652      $        SUBSET.EQ.'NC004013') THEN
   4653  

Page 114         Source Listing                  R05UBF
2017-04-18 11:09                                 iw3unpbf.f

   4654 C  ------------------------------------
   4655 C  MADIS/TAMDAR AIRCRAFT TYPE COME HERE
   4656 C  ------------------------------------
   4657  
   4658          CALL UFBINT(LUNIT,RID_8,1,1,IRET,'ACID')
   4659 cccc     IF(IRET.EQ.0.OR.(RID_8.GT.BMISS-5000..AND.RID_8.LT.BMISS+
   4660 cccc $    5000.))  SID = 'TAMDAR-M'
   4661 cxxxx
   4662 cpppppppppp
   4663 cc    print'(" rid_8,icbfms(sid,8): ",G0,1X,I0)', rid_8,icbfms(sid,8)
   4664 cpppppppppp
   4665 ccccc    IF(ICBFMS(SID,8).NE.0)  SID = 'TAMDAR-M'
   4666 C above line not working right - may return 0 when missing, so use next
   4667 C  two lines below temporarily until this is fixed (readlc will return
   4668 C  all blanks for sid when mnemonic "ACID" not found) - dak 2/19/13
   4669          call readlc(lunit,sid,'ACID')
   4670 cpppppppppp
   4671 cc    print'(" sid = """,A,"""")', sid
   4672 cpppppppppp
   4673          if(sid.eq.'        ')  sid = 'TAMDAR-M'
   4674 cxxxx
   4675 
   4676 C  GET TURBULENCE INDEX FOR LATER STORAGE INTO DATA LEVEL CATEGORY 8
   4677 C  -----------------------------------------------------------------
   4678 
   4679          CALL UFBINT(LUNIT,TRBX_8(5),1,1,IRET,'TRBX');TRBX(5)=TRBX_8(5)
   4680 
   4681 C  GET ROLL ANGLE FLAG FOR LATER STORAGE INTO DATA LEVEL CATEGORY 8
   4682 C  ----------------------------------------------------------------
   4683 
   4684          CALL UFBINT(LUNIT,ROLF_8,1,1,IRET,'ROLF');ROLF=ROLF_8
   4685 
   4686       ELSE IF(SUBSET.EQ.'NC004001'.OR.SUBSET.EQ.'NC004002') THEN
   4687  
   4688 C  -----------------------------------------------
   4689 C  AIREP OR PIREP FORMAT AIRCRAFT TYPES COME HERE
   4690 C  -----------------------------------------------
   4691 
   4692 C  MAY POSSIBLY NEED TO MODIFY THE RPID HERE
   4693 C  (for later tests in prepacqc program)
   4694 C  -----------------------------------------
   4695 
   4696 cdak no more!IF(SID(6:6).EQ.'Z')  SID(6:6) = 'X'
   4697          IF(SID.EQ.'A       '.OR.SID.EQ.'        '.OR.SID(1:3).EQ.'ARP'
   4698      $    .OR.SID(1:3).EQ.'ARS')  SID = 'AIRCFT  '
   4699 
   4700 cvvvvv temporary?
   4701 C  Determined that Hickum AFB reports are much like AFWA - they have
   4702 C   problems!  They also are usually duplicates of either AFWA or
   4703 C   non-AFWA reports.  Apparently the old front-end processing filtered
   4704 C   them out (according to B. Ballish).  So, to make things match, we
   4705 C   will do the same here.
   4706 C   ACTUALLY, JEFF ATOR HAS REMOVED THESE FROM THE DECODER, SO WE
   4707 C    SHOULD NEVER EVEN SEE THEM IN THE DATABASE, but it won't hurt
   4708 C    anything to keep this in here.
   4709 C   (NOTE: These all have bulletin originator "PHWR".)
   4710 

Page 115         Source Listing                  R05UBF
2017-04-18 11:09                                 iw3unpbf.f

   4711          if(CBULLX(8:11).eq.'PHWR')  then
   4712 cpppppppppp
   4713 cc    print'(" IW3UNPBF/R05UBF: TOSS ""PHWR"" AIREP FORMAT with ID = ",
   4714 cc   $ A,"; CBORG = ",A)', SID,CBULLX(8:11)
   4715 cpppppppppp
   4716             R05UBF = -9999
   4717             kskacf(8) = kskacf(8) + 1
   4718             return
   4719          end if
   4720 caaaaa temporary?
   4721 
   4722 cvvvvv temporary?
   4723 C        1) AFWA converts ASDAR/ACARS reports originally in AMDAR
   4724 C      format into AIREP format.  Nearly all of them are duplicated as
   4725 C      ASDAR/ACARS in true AMDAR format.  The earlier version of the
   4726 C      aircraft dup-checker could not remove such duplicates; the new
   4727 C      verison now in operations can remove these. SO, WE HAVE
   4728 C      COMMENTED THIS OUT.
   4729 C
   4730 C      These disguised reports can be identified by the string
   4731 C      " Sxyz" in the raw report (beyond byte 40), where y is 0,1, or 2.
   4732 C      (NOTE: Apparently AFWA here applies to more bulletin originators
   4733 C             than just "KAWN", so report header is not even checked.)
   4734 
   4735 C        2) AFWA also converts MDCRS ACARS reports into AIREP format.
   4736 C      These MAY duplicate true reports in the MDCRS ACARS subtype.
   4737 C      The NAS9000 decoder always excluded this type (no dup-checking
   4738 C      was done).  All of these will be removed here. These disguised
   4739 C      reports can be identified by the string " Sxyz" in the raw
   4740 C      report (beyond byte 40), where y is 3 or greater.
   4741 C      (NOTE: Apparently AFWA here applies to more bulletin originators
   4742 C             than just "KAWN", so report header is not even checked.)
   4743 
   4744          crawrx = ' '
   4745          crawr = ' '
   4746          call ufbint(lunit,raw_8,1,255,nlev,'RRSTG')
   4747 cppppp
   4748 cc       print *, 'this report''s RRSTG has nlev = ',nlev
   4749 cc       ni = -7
   4750 cc       do mm = 1,nlev
   4751 cc          ni = ni + 8
   4752 cc          crawrx(ni:ni+7) = craw(mm)
   4753 cc          if(ni+8.gt.500.and.mm.lt.nlev)  print *, 'ni+8.gt.500'
   4754 cc          if(ni+8.gt.500)  exit
   4755 cc       enddo
   4756 cc       print *, 'BULLETIN:      "',crawrx(1:ni+7),'"'
   4757 cppppp
   4758          if(nlev.gt.5)  then
   4759             ni = -7
   4760             do mm = 6,nlev
   4761                ni = ni + 8
   4762                crawr(ni:ni+7) = craw(mm)
   4763 cppppp
   4764 cc             if(ni+8.gt.80.and.mm.lt.nlev)  print *, 'ni+8.gt.80'
   4765 cppppp
   4766                if(ni+8.gt.80)  exit
   4767             enddo

Page 116         Source Listing                  R05UBF
2017-04-18 11:09                                 iw3unpbf.f

   4768 cppppp
   4769 cc          print *, 'BULLETIN(41-): "                              ',
   4770 cc   $       '          ',crawr(1:ni+7),'"'
   4771 cppppp
   4772             do mm = 1,ni+7
   4773                if(crawr(mm:mm+1).eq.' S')  then
   4774                   if((crawr(mm+2:mm+2).ge.'0'.and.crawr(mm+2:mm+2).le.
   4775      $             '9').or.crawr(mm+2:mm+2).eq.'/')  then
   4776                      if((crawr(mm+3:mm+3).ge.'0'.and.crawr(mm+3:mm+3)
   4777      $                .le.'9').or.crawr(mm+3:mm+3).eq.'/')  then
   4778                         if((crawr(mm+4:mm+4).ge.'0'.and.
   4779      $                   crawr(mm+4:mm+4).le.'9').or.crawr(mm+4:mm+4)
   4780      $                   .eq.'/')  then
   4781 cpppppppppp
   4782 cc    print'(" IW3UNPBF/R05UBF: For ",A,", raw_8(",I0,") = ",G0)',
   4783 cc   $ SID,ni+7,crawr(1:ni+7)
   4784 cpppppppppp
   4785                            if(crawr(mm+3:mm+3).lt.'3')  then
   4786 
   4787 C  THIS IS AN AMDAR FORMAT ASDAR/ACARS REPORT DISGUISED AS AN AIREP
   4788 C   FORMAT REPORT BY AFWA --> THROW OUT
   4789 C   (NOT ANYMORE, DUP-CHECKER IS HANDLING THESE OKAY NOW)
   4790 C  ----------------------------------------------------------------
   4791 
   4792 cpppppppppp
   4793 cc    print'(" IW3UNPBF/R05UBF: Found a AFWA AMDAR in AIREP format ",
   4794 cc   $ "for ",A,"; CBORG = ",A)', SID,CBULLX(8:11)
   4795 cpppppppppp
   4796 cdak  R05UBF = -9999
   4797 cdak  KSKACF(3) = KSKACF(3) + 1
   4798 cdak  RETURN
   4799                            else
   4800 
   4801 C  THIS IS A MDCRS ACARS REPORT DISGUISED AS AN AIREP FORMAT REPORT
   4802 C   BY AFWA --> THROW OUT
   4803 C  ----------------------------------------------------------------
   4804 
   4805 cpppppppppp
   4806 cc    print'(" IW3UNPBF/R05UBF: Found a AFWA ACARS in AIREP format ",
   4807 cc   $ "for ",A,"; CBORG = ",A)', SID,CBULLX(8:11)
   4808 cpppppppppp
   4809       R05UBF = -9999
   4810       KSKACF(4) = KSKACF(4) + 1
   4811       RETURN
   4812 
   4813                            end if
   4814                         end if
   4815                      end if
   4816                   end if
   4817                end if
   4818                if(mm+5.gt.ni+7)  exit
   4819             enddo
   4820          END IF
   4821 caaaaa temporary?
   4822 
   4823 C  AFWA INDICATOR STORED IN BYTE 1 OF HEADER RESERVE CHARACTER WORD 2
   4824 C   (NOTE: NAS9000 ONLY ASSIGNED BULLETIN ORIGINATOR "KAWN" AS AFWA,

Page 117         Source Listing                  R05UBF
2017-04-18 11:09                                 iw3unpbf.f

   4825 C          ALTHOUGH BULLETIN ORIGINATORS "PHWR" AND "EGWR" ARE
   4826 C          APPARENTLY ALSO AFWA)
   4827 C  ------------------------------------------------------------------
   4828 
   4829          IF(CBULLX(8:11).EQ.'KAWN')  RSV2(1:1) = 'C'
   4830 
   4831       END IF
   4832  
   4833       IF(SUBSET.EQ.'NC004003'.OR.SUBSET.EQ.'NC004004'.OR.SUBSET.EQ.
   4834      $ 'NC004006'.OR.SUBSET.EQ.'NC004009'.OR.SUBSET.EQ.'NC004011'.OR.
   4835      $ SUBSET.EQ.'NC004103'.OR.SUBSET.EQ.'NC004010') THEN
   4836 
   4837 C  -----------------------------------------------------------------
   4838 C  AMDAR FORMAT, MDCRS ACARS, E-AMDAR, CANADIAN AMDAR, KOREAN AMDAR,
   4839 C   CATCH-ALL AMDAR OR TAMDARB AIRCRAFT TYPES COME HERE
   4840 C  -----------------------------------------------------------------
   4841 
   4842 C  GET PRECISION OF TEMPERATURE OBSERVATION FOR LATER STORAGE
   4843 C   INTO DATA LEVEL CATEGORY 8
   4844 C  ----------------------------------------------------------
   4845 
   4846          CALL UFBINT(LUNIT,UFBINT_8,1,1,IRET,'PCAT');PCT=UFBINT_8
   4847 
   4848 C  GET PHASE OF FLIGHT FOR LATER STORAGE INTO DATA LEVEL CAT. 8
   4849 C  ------------------------------------------------------------
   4850 
   4851          CALL UFBINT(LUNIT,UFBINT_8,1,1,IRET,'DPOF')
   4852          if(ibfms(ufbint_8).eq.0) then
   4853 C  Translate DPOF values into POAF values
   4854            if(int(ufbint_8).ge.7.and.int(ufbint_8).le.10) then
   4855              ufbint_8 = 5.
   4856            else if(int(ufbint_8).ge.11.and.int(ufbint_8).le.14) then
   4857              ufbint_8 = 6.
   4858            end if
   4859            pof=ufbint_8
   4860          else
   4861            CALL UFBINT(LUNIT,UFBINT_8,1,1,IRET,'POAF');POF=UFBINT_8
   4862          endif
   4863 
   4864       END IF
   4865 
   4866 C  ------------------------------
   4867 C  ALL AIRCRAFT TYPES COME HERE
   4868 C  ------------------------------
   4869 
   4870 C  PUT THE LEVEL DATA INTO SPECIFIED UNPACKED FORMAT
   4871 C  -------------------------------------------------
   4872  
   4873       CALL UFBINT(LUNIT,ARR_8,10,255,NLEV,LVSTR);ARR=ARR_8
   4874 
   4875       if(nlev.gt.0) then
   4876       DO L=1,NLEV
   4877 
   4878          POB(L) = BMISS
   4879          IF(ARR(1,L).LT.BMISS)  POB(L) =  NINT(ARR(1,L)*.1)
   4880 
   4881          TOB(L) = BMISS

Page 118         Source Listing                  R05UBF
2017-04-18 11:09                                 iw3unpbf.f

   4882          QOB(L) = BMISS
   4883          IF(SUBSET.EQ.'NC004010') THEN
   4884           IF(ARR(3,L).GE.BMISS)  THEN
   4885           CALL UFBINT(LUNIT,UFBINT_8,1,1,IRET,'TMDBST')
   4886           ARR(3,L)=UFBINT_8
   4887           END IF
   4888           IF(ARR(2,L).GE.BMISS.AND.ARR(6,L).GE.BMISS) THEN
   4889           CALL UFBINT(LUNIT,UFBINT_8,1,1,IRET,'RAWHU')
   4890           ARR(6,L)=UFBINT_8
   4891           END IF
   4892          ENDIF
   4893          IF(ARR(3,L).LT.BMISS)  THEN
   4894             ITMP = NINT(ARR(3,L)*100.)
   4895             TOB(L) = NINT((ITMP-27315)*0.1)
   4896             IF(OBS2(42).EQ.0.OR.(SUBSET.EQ.'NC004008'.OR.
   4897      $                           SUBSET.EQ.'NC004012'.OR.
   4898      $                           SUBSET.EQ.'NC004013'.OR.
   4899      $                           SUBSET.EQ.'NC004006'.OR.
   4900      $                           SUBSET.EQ.'NC004103'.OR.
   4901      $                           SUBSET.EQ.'NC004010')) THEN
   4902 
   4903 C  Process moisture (if present) if MADIS/TAMDAR (all types),
   4904 C   Panasonic(AirDAT)/TAMDAR, E-AMDAR, Catch-all AMDAR or MDCRS (but
   4905 C   for MDCRS only if MTSQ is zero)
   4906 C dak-- is this still the case, is MTSQ=0 for all MDCRS with valid
   4907 C       moisture even in v7 BUFR??!!)
   4908 C  ----------------------------------------------------------------
   4909 
   4910 C  All data level category 6 rpts store specific humidity (g/kg) as
   4911 C   moisture variable
   4912 C  ----------------------------------------------------------------
   4913 
   4914 C  If pressure is not reported, calculate it here via U.S. Std. Atmos.
   4915 C   Est. solely for the purpose for calculating Td to gross check the
   4916 C   moisture if it is reported (this pressure will not be considered
   4917 C   as a reported pressure - the reported pressure will remain missing)
   4918 C  --------------------------------------------------------------------
   4919 
   4920                if(pob(l).ge.bmiss) then
   4921                  if(nint(elev).le.11000) then
   4922                    p = pr(elev)
   4923                  else
   4924                    p = prs(elev)
   4925                  end if
   4926                else
   4927                    p = pob(l)*0.1
   4928                end if
   4929                QQ = -99999.
   4930                mtyp_q = 1
   4931                IF(SUBSET.EQ.'NC004004')  THEN
   4932 
   4933 C  From 10/1/2006 through 10/31/2006, inclusive, and on 10/2/2007,
   4934 C   MDCRS ACARS MIXR may or may not have been scaled incorrectly by
   4935 C   ARINC - set to missing
   4936 C  ----------------------------------------------------------------
   4937 
   4938                   IF((IDATEB.GE.2006100100.AND.IDATEB.LE.2006103123)

Page 119         Source Listing                  R05UBF
2017-04-18 11:09                                 iw3unpbf.f

   4939      $         .OR.  (IDATEB.GE.2007100200.AND.IDATEB.LE.2007100223))
   4940      $             ARR(2,L) = BMISS
   4941                END IF
   4942                IF(ARR(2,L).LT.BMISS)  THEN
   4943                   IF(SUBSET.EQ.'NC004004')  THEN
   4944 
   4945 C  From 11/1/2006 through 10/1/2007, inclusive, MDCRS ACARS MIXR was
   4946 C   scaled incorrectly by ARINC (10 times too large), compensate for
   4947 C   this error by dividing reported MIXR by 10
   4948 C  -----------------------------------------------------------------
   4949 
   4950                      IF(IDATEB.GE.2006110100.AND.
   4951      $                  IDATEB.LE.2007100123) ARR(2,L) = ARR(2,L)*0.1
   4952                   END IF
   4953                   QQ = ARR(2,L)/(1.0 + ARR(2,L))
   4954                ELSE  IF(ARR(6,L).LT.BMISS)  THEN
   4955                   QQSAT = QFRMTP(ARR(3,L),P)
   4956                   QQ = (ARR(6,L) * 0.01) * QQSAT
   4957                   mtyp_q = 0
   4958                END IF
   4959                IF(QQ.GT.0.0)  THEN
   4960                   TD = TFRMQP(QQ,P)
   4961                   IF(NINT(TD*10.).LE.NINT(ARR(3,L)*10.))  THEN
   4962                      QOB(L) = QQ * 1000.
   4963                      if(mtyp_q.eq.1)  then
   4964                        if(subset.ne.'NC004004'.and.
   4965      $                    subset.ne.'NC004006')
   4966      $ print'(" ^^^^^ valid aircraft mixing ratio ",G0," kg/kg stored ",
   4967      $ "as spec. humidity ",G0," g/kg - id ",A)', arr(2,L),qob(L),sid
   4968                      else
   4969                         if(subset.ne.'NC004010')
   4970      $ print'(" ^^^^^ valid aircraft relative humidity ",G0," % stored",
   4971      $ " as spec. humidity ",G0," g/kg - id ",A)', arr(6,L),qob(L),sid
   4972                      end if
   4973                   else
   4974                      if(mtyp_q.eq.1)  then
   4975       print'(" ^^^^^ INVALID aircraft mixing ratio ",G0," kg/kg - ",
   4976      $ "spec. humidity set to missing - id ",A)', arr(2,L),sid
   4977                      else
   4978       print'(" ^^^^^ INVALID aircraft relative humidity ",G0," % - ",
   4979      $ "spec. humidity set to missing - id ",A)', arr(6,L),sid
   4980                      end if
   4981                   END IF
   4982                END IF
   4983             END IF
   4984          END IF
   4985 
   4986          ZOB(L) = ELEV
   4987          DOB(L) = ARR(4,L)
   4988          SOB(L) = MIN(ARR(5,L)*10.,BMISS)
   4989       ENDDO
   4990       end if
   4991 
   4992       CALL UFBINT(LUNIT,ARR_8,10,255,NLEV,QMSTR);ARR=ARR_8
   4993 
   4994 C  -----------------------------------------------------------------
   4995 C  ALL AIRCRAFT TYPES COME HERE FOR QUALITY MARK ASSIGNMENT

Page 120         Source Listing                  R05UBF
2017-04-18 11:09                                 iw3unpbf.f

   4996 C  -----------------------------------------------------------------
   4997  
   4998       if(nlev.gt.0) then
   4999       DO L=1,NLEV
   5000          PQM(L) = EQMUBF(ARR(1,L))
   5001          TQM(L) = EQMUBF(ARR(2,L))
   5002          QQM(L) = EQMUBF(ARR(3,L))
   5003          ZQM(L) = EQMUBF(ARR(4,L))
   5004          WQM(L) = EQMUBF(ARR(5,L))
   5005       ENDDO
   5006       end if
   5007 
   5008       IF(SUBSET.EQ.'NC004008'.OR.SUBSET.EQ.'NC004012'.OR.
   5009      $   SUBSET.EQ.'NC004013') THEN
   5010 
   5011 C  Qual. markers for MADIS/TAMDAR (HONOR ALL BUT QM=2 FROM JUST ABOVE)
   5012 C  -------------------------------------------------------------------
   5013 
   5014          CALL UFBREP(LUNIT,RTAM_8,2,1,IRET,'PRLC QCD')
   5015          RQCD_8 = RTAM_8(2)
   5016 cdak     print'(" PRLC  QM is ",A)', QCD
   5017          IF(PQM(1).EQ.2.AND.IBFMS(RTAM_8(1)).EQ.0)  PQM(1) = MQMUBF(QCD)
   5018          CALL UFBREP(LUNIT,RTAM_8,2,1,IRET,'TMDB QCD')
   5019          RQCD_8 = RTAM_8(2)
   5020 cdak     print'(" TMDB  QM is ",A)', QCD
   5021          IF(TQM(1).EQ.2.AND.IBFMS(RTAM_8(1)).EQ.0)  TQM(1) = MQMUBF(QCD)
   5022          CALL UFBREP(LUNIT,RTAM_8,2,1,IRET,'REHU QCD')
   5023          RQCD_8 = RTAM_8(2)
   5024 cdak     print'(" REHU  QM is ",A)', QCD
   5025          IF(QQM(1).EQ.2.AND.IBFMS(RTAM_8(1)).EQ.0)  QQM(1) = MQMUBF(QCD)
   5026          CALL UFBREP(LUNIT,RTAM_8,2,1,IRET,'WDIR QCD')
   5027          RQCD_8 = RTAM_8(2)
   5028 cdak     print'(" WDIR  QM is ",A)', QCD
   5029          QWD = MQMUBF(QCD)  ! wind direction
   5030          RTAM_WDIR_8=RTAM_8(1)
   5031          CALL UFBREP(LUNIT,RTAM_8,2,1,IRET,'WSPD QCD')
   5032          RQCD_8 = RTAM_8(2)
   5033 cdak     print'(" WSPD  QM is ",A)', QCD
   5034          QWS = MQMUBF(QCD)  ! wind speed
   5035          AMAXIMUM_8 = MAX(RTAM_WDIR_8,RTAM_8(1))
   5036          IF(WQM(1).EQ.2.AND.IBFMS(AMAXIMUM_8).EQ.0) WQM(1) =MAX(QWD,QWS)
   5037          CALL UFBREP(LUNIT,RTAM_8,2,1,IRET,'TRBX QCD')
   5038          RQCD_8 = RTAM_8(2)
   5039 cdak     print'(" TRBX  QM is ",A)', QCD
   5040          QTRBX = MQMUBF(QCD)  ! turbulence index
   5041 
   5042       else if(subset.eq.'NC004010') then
   5043 
   5044 C  Quality markers for BUFR TAMDAR (2015 onward; assign QMs based on
   5045 C  the information from QMRKH/PCCF fields) (honor all but QM=2 from
   5046 C   just above)
   5047 C    transformation of TAMDAR QMRKH into PREPBUFR QM:
   5048 C              QMRKH           0   1   2   3    > 3 up to missing
   5049 C              --------------------------------------------------
   5050 C             (T/W)QM          2   3   3  13           13
   5051 C  -----------------------------------------------------------------
   5052 

Page 121         Source Listing                  R05UBF
2017-04-18 11:09                                 iw3unpbf.f

   5053          CALL UFBREP(LUNIT,RTAMB_8,1,7,IRET,'QMRKH')
   5054 CCC    print'(" RTAMB_8: ",4(1X,F7.2))',
   5055 CCC  & RTAMB_8(1), RTAMB_8(2), RTAMB_8(3), RTAMB_8(4)
   5056 !      Order of QMRKH array representation:
   5057 !  N = 1     2       3     4     5       6       7
   5058 !      SMMO, TMDBST, WDIR, WSPD, TRBXST, TOPEDR, AFIC
   5059 Cfuture call ufbint(lunit,ufbint_8,1,1,iret,'SMMO')
   5060 Cfuture if(ibfms(ufbint_8).eq.0) then
   5061 Cfuture   print'(" SMMO   (not stored) is ",g0)', ufbint_8
   5062 Cfuture   print'(" SMMO   QMRKH is ",g0)', rtamb_8(1)
   5063 Cfuture end if
   5064          DO N = 2,4
   5065           RQCD_8 = 0.0
   5066           IF(RTAMB_8(N).GE.3.0) THEN
   5067            RQCD_8 = 13.0
   5068           ELSE
   5069            IF (RTAMB_8(N).GE.1.0) RQCD_8 = 3.0
   5070            IF (RTAMB_8(N).EQ.0.0) RQCD_8 = 2.0
   5071           ENDIF
   5072           IF((N.EQ.2).AND.(TOB(1).LT.BMISS).AND.(TQM(1).EQ.2))
   5073      &     TQM(1)=RQCD_8 ! T quality information
   5074           IF((DOB(1).LT.BMISS).AND.(SOB(1).LT.BMISS).AND.(WQM(1).EQ.2))
   5075      &    THEN
   5076            IF(N.EQ.3) RTAM_WDIR_8=RQCD_8 ! WD quality
   5077            IF(N.EQ.4) WQM(1)=MAX(RTAM_WDIR_8,RQCD_8) ! Total wind quality
   5078           ENDIF
   5079          ENDDO
   5080 CCC      print'(" TQM WQM ",2(1X,F7.2))', TQM(1), WQM(1)
   5081          call UFBINT(LUNIT,RQCD_8,1,1,IRET,'PCCF')
   5082 !        PCCF = percent confidence of RH quality
   5083          IF((QOB(1).LT.BMISS).AND.(QQM(1).EQ.2)) THEN
   5084 ! Always set QQM to 13 if TQM was set to 13 above (regardless of PCCF)
   5085          IF((RQCD_8.LT.80.0).OR.(RQCD_8.GT.100.0)
   5086      &      .OR.(TQM(1).EQ.13.0)) THEN
   5087           QQM(1) = 13.0
   5088          ELSE
   5089           QQM(1) = 2.0
   5090          ENDIF
   5091          ENDIF
   5092 CCC      print'(" REHU  PCCF, QM ",2(1X,F5.1))', RQCD_8, QQM(1)
   5093 
   5094       END IF
   5095 
   5096       IF(SUBSET.NE.'NC004004' .and. SUBSET.NE.'NC004010') THEN
   5097 
   5098 C  -------------------------------------------------------------------
   5099 C  ALL AIRCRAFT TYPES EXCEPT MDCRS ACARS AND PANASONIC (AirDAT) TAMDAR
   5100 C   ALSO HAVE SPECIAL CASE:
   5101 C     IF PURGE FLAG ON WIND (14), TEMP Q.M. ALSO GETS PURGE FLAG (14)
   5102 C      (this is needed by PREPOBS_PREPACQC program)
   5103 C      (note: This should be moved to prepdata)
   5104 C  -------------------------------------------------------------------
   5105  
   5106          if(nlev.gt.0) then
   5107          DO L=1,NLEV
   5108             IF(WQM(L).EQ.14)  TQM(L) = 14
   5109          ENDDO

Page 122         Source Listing                  R05UBF
2017-04-18 11:09                                 iw3unpbf.f

   5110          end if
   5111 
   5112       END IF
   5113  
   5114 C  PUT THE UNPACKED REPORT INTO OBS
   5115 C  --------------------------------
   5116  
   5117       CALL S01UBF(SID,XOB,YOB,RHR,RCTIM,RSV1,RSV2,ELV,QMELV,ITP,RTP,
   5118      $ RSTP,IDS)
   5119       CALL S02UBF(6,1,*9999)


ENTRY POINTS

  Name               
                     
 r05ubf_             


SYMBOL CROSS REFERENCE

 Name                       Object Declared Type            Bytes Dimen Elements Attributes       References                        
                                                                                                                                    
 9997                       Label  5205                                                           5194                              
 9998                       Label  5202                                                           5194                              
 9999                       Label  5198                                                           5119,5153,5160,5167,5176,5184,5191
                                                                                                  ,5194                             
 ACID                       Local  4138     CHAR            8           scalar   SAVE             4545,4549,4551,4644,4649          
 ACTP                       Local  4139     CHAR            8           scalar   SAVE             4610,4611                         
 ALOG                       Func   4163                                 scalar                    4163,4169                         
 AMAXIMUM_8                 Local  4144     R(8)            8           scalar   SAVE             5035,5036                         
 AMINIMUM_8                 Local  4144     R(8)            8           scalar   SAVE             4201,4202,4216,4218,4232,4233     
 ARR                        Local  4146     R(4)            4     2     2550     SAVE             4873,4879,4884,4886,4888,4890,4893
                                                                                                  ,4894,4940,4942,4951,4953,4954,495
                                                                                                  5,4956,4961,4967,4971,4976,4979,49
                                                                                                  87,4988,4992,5000,5001,5002,5003,5
                                                                                                  004                               
 ARR_8                      Local  4143     R(8)            8     2     2550     SAVE             4873,4992                         
 AS                         Local  4169     R(4)            4           scalar                    4170                              
 BMISS                      Scalar 4124     R(8)            8           scalar   COM              4192,4193,4195,4250,4254,4263,4264
                                                                                                  ,4269,4270,4352,4360,4363,4368,437
                                                                                                  1,4378,4381,4384,4398,4484,4485,44
                                                                                                  86,4487,4488,4878,4879,4881,4882,4
                                                                                                  884,4888,4893,4920,4940,4942,4954,
                                                                                                  4988,5072,5074,5083,5155,5162,5170
                                                                                                  ,5179,5186                        
 BULL_8                     Local  4141     R(8)            8     1     2        SAVE             4418,4446                         
 CBORG                      Local  4139     CHAR            8           scalar   SAVE             4435,4437,4442,4444,4454,4462,4464
                                                                                                  ,4469                             
 CBUHD                      Local  4138     CHAR            8           scalar   SAVE             4444                              
 CBULLX                     Scalar 4133     CHAR            11          scalar   COM              4444,4454,4469,4504,4711,4829     
 CF8                        Scalar 4129     R(4)            4     1     255      COM              5150,5157,5164,5172,5181,5188     
 CRAW                       Local  4138     CHAR            8     1     255      SAVE             4762                              
 CRAWR                      Local  4135     CHAR            80          scalar   SAVE             4745,4762,4773,4774,4775,4776,4777
                                                                                                  ,4778,4779,4785                   
 CRAWRX                     Local  4136     CHAR            500         scalar   SAVE             4744                              
 DOB                        Scalar 4128     R(4)            4     1     255      COM              4987,5074                         

Page 123         Source Listing                  R05UBF
2017-04-18 11:09 Symbol Table                    iw3unpbf.f

 Name                       Object Declared Type            Bytes Dimen Elements Attributes       References                        
                                                                                                                                    
 ELEV                       Local  4356     R(4)            4           scalar   SAVE             4356,4358,4361,4363,4370,4373,4380
                                                                                                  ,4383,4386,4390,4921,4922,4924,498
                                                                                                  6                                 
 ELV                        Local  4390     R(4)            4           scalar   SAVE             4390,5117                         
 EQMUBF                     Func   5000     R(4)            4           scalar                    5000,5001,5002,5003,5004          
 ES                         Local  4175     R(4)            4           scalar                    4176                              
 EXP                        Func   4175                                 scalar                    4175,4183                         
 HDR                        Local  4145     R(4)            4     1     20       SAVE             4245,4263,4264,4270,4275,4283,4352
                                                                                                  ,4355,4356,4358,4360,4361,4368,437
                                                                                                  0,4371,4373,4378,4380,4381,4383,43
                                                                                                  84,4386                           
 HDR_8                      Local  4143     R(8)            8     1     20       SAVE             4245,4250,4252,4254,4256,4258,4259
                                                                                                  ,4266,4267,4268,4281,4283         
 HDSTR                      Local  4135     CHAR            80          scalar   SAVE             4153,4245                         
 HGTF_HI                    Local  4163     R(4)            4           scalar                    4356                              
 HGTF_LO                    Local  4164     R(4)            4           scalar                    4358                              
 I                          Local  5169     I(4)            4           scalar   SAVE             5169,5170,5171,5172,5175          
 IBFMS                      Func   4202     I(4)            4           scalar                    4202,4209,4218,4233,4610,4618,4632
                                                                                                  ,4634,4643,4852,5017,5021,5025,503
                                                                                                  6                                 
 ICBFMS                     Func   4454     I(4)            4           scalar                    4454                              
 IDATEB                     Scalar 4132     I(4)            4           scalar   COM              4938,4939,4950,4951               
 IDS                        Local  4410     I(4)            4           scalar   SAVE             4410,5118                         
 IMISS                      Local  4158     I(4)            4           scalar   SAVE             4158,4396,4410,4489,5151,5152,5158
                                                                                                  ,5159,5165,5166,5173,5174,5182,518
                                                                                                  3,5189,5190                       
 INT                        Func   4854                                 scalar                    4854,4856                         
 IRET                       Local  4196     I(4)            4           scalar   SAVE             4196,4198,4199,4202,4204,4206,4207
                                                                                                  ,4209,4211,4212,4214,4218,4220,422
                                                                                                  2,4227,4230,4233,4235,4245,4251,42
                                                                                                  55,4261,4281,4397,4418,4446,4512,4
                                                                                                  533,4557,4567,4603,4609,4617,4629,
                                                                                                  4630,4658,4679,4684,4846,4851,4861
                                                                                                  ,4885,4889,5014,5018,5022,5026,503
                                                                                                  1,5037,5053,5081                  
 ISTP                       Local  4407     I(4)            4           scalar   SAVE             4407,4408                         
 ITMP                       Local  4894     I(4)            4           scalar   SAVE             4894,4895                         
 ITP                        Local  4396     I(4)            4           scalar   SAVE             4396,4400,4402,5117               
 IUBFAA                     Common 4124                                 8        SAVE                                               
 IUBFBB                     Common 4125                                 100      SAVE                                               
 IUBFCC                     Common 4127                                 8        SAVE                                               
 IUBFEE                     Common 4128                                 9180     SAVE                                               
 IUBFFF                     Common 4130                                 5100     SAVE                                               
 IUBFLL                     Common 4131                                 2040     SAVE                                               
 IUBFRR                     Common 4132                                 4        SAVE                                               
 IUBFSS                     Common 4133                                 11       SAVE                                               
 KFLSAT                     Scalar 4125     I(4)            4     1     12       COM                                                
 KNDX                       Scalar 4125     I(4)            4           scalar   COM              4552,5149                         
 KSKACF                     Scalar 4125     I(4)            4     1     8        COM              4717,4810,5207                    
 KSKSAT                     Scalar 4125     I(4)            4           scalar   COM                                                
 KSKSFC                     Scalar 4125     I(4)            4           scalar   COM                                                
 KSKSMI                     Scalar 4126     I(4)            4           scalar   COM                                                
 KSKUPA                     Scalar 4125     I(4)            4           scalar   COM                                                
 L                          Local  4876     I(4)            4           scalar   SAVE             4876,4878,4879,4881,4882,4884,4886
                                                                                                  ,4888,4890,4893,4894,4895,4920,492

Page 124         Source Listing                  R05UBF
2017-04-18 11:09 Symbol Table                    iw3unpbf.f

 Name                       Object Declared Type            Bytes Dimen Elements Attributes       References                        
                                                                                                                                    
                                                                                                  7,4940,4942,4951,4953,4954,4955,49
                                                                                                  56,4961,4962,4967,4971,4976,4979,4
                                                                                                  986,4987,4988,4999,5000,5001,5002,
                                                                                                  5003,5004,5107,5108               
 LUNIT                      Dummy  4121     I(4)            4           scalar   ARG,INOUT        4196,4198,4206,4212,4222,4227,4245
                                                                                                  ,4251,4255,4262,4281,4397,4418,443
                                                                                                  7,4446,4464,4512,4523,4533,4545,45
                                                                                                  57,4567,4578,4603,4609,4617,4629,4
                                                                                                  630,4658,4669,4679,4684,4746,4846,
                                                                                                  4851,4861,4873,4885,4889,4992,5014
                                                                                                  ,5018,5022,5026,5031,5037,5053,508
                                                                                                  1                                 
 LVSTR                      Local  4135     CHAR            80          scalar   SAVE             4154,4873                         
 MAX                        Func   5035                                 scalar                    5035,5036,5077                    
 MIN                        Func   4201                                 scalar                    4201,4216,4232,4988               
 MM                         Local  4760     I(4)            4           scalar   SAVE             4760,4762,4772,4773,4774,4775,4776
                                                                                                  ,4777,4778,4779,4785,4818         
 MQMUBF                     Func   5017     I(4)            4           scalar                    5017,5021,5025,5029,5034,5040     
 MTYP_Q                     Local  4930     I(4)            4           scalar   SAVE             4930,4957,4963,4974               
 N                          Local  5064     I(4)            4           scalar   SAVE             5064,5066,5069,5070,5072,5076,5077
 NI                         Local  4759     I(4)            4           scalar   SAVE             4759,4761,4762,4766,4772,4818     
 NINT                       Func   4265                                 scalar                    4265,4270,4275,4399,4401,4879,4894
                                                                                                  ,4895,4921,4961,5156,5163,5171,518
                                                                                                  0,5187                            
 NLEV                       Local  4746     I(4)            4           scalar   SAVE             4746,4758,4760,4873,4875,4876,4992
                                                                                                  ,4998,4999,5106,5107              
 NOBS3                      Dummy  4121     I(4)            4     1     7        ARG,INOUT        4194,4204,4211,4220,4235          
 NRCT                       Local  4262     I(4)            4           scalar   SAVE             4262                              
 OB8                        Scalar 4129     R(4)            4     1     255      COM              5149,5156,5163,5171,5180,5187     
 OBS                        Dummy  4121     R(4)            4     1     0        ARG,INOUT        5194                              
 OBS2                       Dummy  4121     R(4)            4     1     43       ARG,INOUT        4237,4896                         
 OBS2_8                     Local  4140     R(8)            8     1     43       SAVE             4192,4196,4222,4237               
 OBS3                       Dummy  4121     R(4)            4     3     8925     ARG,INOUT        4238                              
 OBS3_8                     Local  4140     R(8)            8     3     8925     SAVE             4193,4198,4201,4206,4209,4212,4216
                                                                                                  ,4217,4227,4232,4238              
 OBS8_8                     Dummy  4121     R(8)            8     1     2        ARG,INOUT        4195,4258,4259                    
 OBSVR                      Local  4139     CHAR            8           scalar   SAVE             4618,4619                         
 P                          Local  4922     R(4)            4           scalar   SAVE             4922,4924,4927,4955,4960          
 PCT                        Local  4484     R(4)            4           scalar   SAVE             4484,4846,5155,5156               
 POB                        Scalar 4128     R(4)            4     1     255      COM              4878,4879,4920,4927               
 POF                        Local  4485     R(4)            4           scalar   SAVE             4485,4859,4861,5162,5163          
 PQM                        Scalar 4130     R(4)            4     1     255      COM              5000,5017                         
 PR                         Local  4182     R(4)            4           scalar                    4922                              
 PRS                        Local  4183     R(4)            4           scalar                    4924                              
 Q81                        Scalar 4131     R(4)            4     1     255      COM              5151,5158,5165,5173,5182,5189     
 Q82                        Scalar 4131     R(4)            4     1     255      COM              5152,5159,5166,5174,5175,5183,5190
 QCD                        Local  4138     CHAR            8           scalar   SAVE             5017,5021,5025,5029,5034,5040     
 QFRMTP                     Local  4176     R(4)            4           scalar                    4955                              
 QMELV                      Local  4391     R(4)            4           scalar   SAVE             4391,5117                         
 QMSTR                      Local  4135     CHAR            80          scalar   SAVE             4155,4992                         
 QOB                        Scalar 4128     R(4)            4     1     255      COM              4882,4962,4967,4971,5083          
 QQ                         Local  4929     R(4)            4           scalar   SAVE             4929,4953,4956,4959,4960,4962     
 QQM                        Scalar 4130     R(4)            4     1     255      COM              5002,5025,5083,5087,5089          
 QQSAT                      Local  4955     R(4)            4           scalar   SAVE             4955,4956                         
 QTRBX                      Local  4489     R(4)            4           scalar   SAVE             4489,5040,5175                    

Page 125         Source Listing                  R05UBF
2017-04-18 11:09 Symbol Table                    iw3unpbf.f

 Name                       Object Declared Type            Bytes Dimen Elements Attributes       References                        
                                                                                                                                    
 QWD                        Local  5029     R(4)            4           scalar   SAVE             5029,5036                         
 QWS                        Local  5034     R(4)            4           scalar   SAVE             5034,5036                         
 R05UBF                     Func   4121     R(4)            4           scalar                    4185,4716,4809,5199,5206          
 R05UBF@0                   Local  4121     R(4)            4           scalar   SAVE                                               
 RACID_8                    Local  4141     R(8)            8           scalar   SAVE             4533,4630,4633,4643               
 RACTP_8                    Local  4142     R(8)            8           scalar   SAVE             4609,4610                         
 RAW_8                      Local  4143     R(8)            8     1     255      SAVE             4746                              
 RCSTR                      Local  4135     CHAR            80          scalar   SAVE             4156,4262                         
 RCT                        Local  4146     R(4)            4     2     1275     SAVE             4262,4265                         
 RCTIM                      Local  4265     R(4)            4           scalar   SAVE             4265,5117                         
 RCT_8                      Local  4143     R(8)            8     2     1275     SAVE             4262                              
 READLC                     Subr   4437                                                           4437,4464,4523,4545,4578,4669     
 RHR                        Local  4269     R(4)            4           scalar   SAVE             4269,4270,5117                    
 RIALR                      Local  4488     R(4)            4           scalar   SAVE             4488,4603,5186,5187               
 RIALR_8                    Local  4144     R(8)            8           scalar   SAVE             4603                              
 RID_8                      Local  4140     R(8)            8           scalar   SAVE             4266,4512,4567,4629,4632,4633,4634
                                                                                                  ,4658                             
 RNS                        Local  4397     R(4)            4           scalar   SAVE             4397,4398,4399,4401               
 RNS_8                      Local  4140     R(8)            8           scalar   SAVE             4397                              
 ROBSVR_8                   Local  4142     R(8)            8           scalar   SAVE             4617,4618                         
 ROLF                       Local  4487     R(4)            4           scalar   SAVE             4487,4684,5179,5180               
 ROLF_8                     Local  4144     R(8)            8           scalar   SAVE             4684                              
 RQCD_8                     Local  4141     R(8)            8           scalar   SAVE             5015,5019,5023,5027,5032,5038,5065
                                                                                                  ,5067,5069,5070,5073,5076,5077,508
                                                                                                  1,5085                            
 RSTP                       Local  4408     R(4)            4           scalar   SAVE             4408,5118                         
 RSV1                       Local  4138     CHAR            8           scalar   SAVE             4412,4619,5117                    
 RSV2                       Local  4138     CHAR            8           scalar   SAVE             4413,4504,4551,4611,4649,4829,5117
 RTAMB_8                    Local  4141     R(8)            8     1     7        SAVE             5053,5066,5069,5070               
 RTAM_8                     Local  4141     R(8)            8     1     2        SAVE             5014,5015,5017,5018,5019,5021,5022
                                                                                                  ,5023,5025,5026,5027,5030,5031,503
                                                                                                  2,5035,5037,5038                  
 RTAM_WDIR_8                Local  4141     R(8)            8           scalar   SAVE             5030,5035,5076,5077               
 RTP                        Local  4406     R(4)            4           scalar   SAVE             4406,5117                         
 S01UBF                     Subr   5117                                                           5117                              
 S02UBF                     Subr   5119                                                           5119,5153,5160,5167,5176,5184,5191
 S03UBF                     Subr   5194                                                           5194                              
 S05UBF                     Subr   4240                                                           4240                              
 SID                        Local  4138     CHAR            8           scalar   SAVE             4261,4523,4527,4578,4582,4585,4587
                                                                                                  ,4589,4636,4638,4669,4673,4697,469
                                                                                                  8,4967,4971,4976,4979,5117,5204   
 SIGN                       Func   4370                                 scalar                    4370,4373,4380,4383,4386          
 SOB                        Scalar 4129     R(4)            4     1     255      COM              4988,5074                         
 SUBSET                     Scalar 4127     CHAR            8           scalar   COM              4205,4221,4224,4225,4407,4434,4461
                                                                                                  ,4491,4506,4560,4561,4584,4586,459
                                                                                                  3,4623,4635,4649,4651,4652,4686,48
                                                                                                  33,4834,4835,4883,4896,4897,4898,4
                                                                                                  899,4900,4901,4931,4943,4964,4965,
                                                                                                  4969,5008,5009,5042,5096,5148,5194
 TD                         Local  4960     R(4)            4           scalar   SAVE             4960,4961                         
 TFRMQP                     Local  4170     R(4)            4           scalar                    4960                              
 TOB                        Scalar 4128     R(4)            4     1     255      COM              4881,4895,5072                    
 TQM                        Scalar 4130     R(4)            4     1     255      COM              5001,5021,5072,5073,5086,5108     
 TRBX                       Local  4146     R(4)            4     1     5        SAVE             4486,4558,4679,5170,5171          
 TRBX_8                     Local  4143     R(8)            8     1     5        SAVE             4557,4558,4679                    

Page 126         Source Listing                  R05UBF
2017-04-18 11:09 Symbol Table                    iw3unpbf.f

 Name                       Object Declared Type            Bytes Dimen Elements Attributes       References                        
                                                                                                                                    
 UFBINT                     Subr   4196                                                           4196,4198,4206,4212,4222,4227,4245
                                                                                                  ,4251,4255,4262,4281,4397,4418,444
                                                                                                  6,4512,4533,4557,4567,4603,4609,46
                                                                                                  17,4629,4630,4658,4679,4684,4746,4
                                                                                                  846,4851,4861,4873,4885,4889,4992,
                                                                                                  5081                              
 UFBINT_8                   Local  4140     R(8)            8           scalar   SAVE             4251,4252,4255,4256,4846,4851,4852
                                                                                                  ,4854,4855,4856,4857,4859,4861,488
                                                                                                  5,4886,4889,4890                  
 UFBREP                     Subr   5014                                                           5014,5018,5022,5026,5031,5037,5053
 VSG                        Scalar 4129     R(4)            4     1     255      COM                                                
 WQM                        Scalar 4130     R(4)            4     1     255      COM              5004,5036,5074,5077,5108          
 XMISS                      Local  4158     R(4)            4           scalar   SAVE             4158,4391                         
 XOB                        Local  4267     R(4)            4           scalar   SAVE             4267,5117                         
 YOB                        Local  4268     R(4)            4           scalar   SAVE             4268,5117                         
 ZOB                        Scalar 4128     R(4)            4     1     255      COM              4986                              
 ZQM                        Scalar 4130     R(4)            4     1     255      COM              5003                              

Page 127         Source Listing                  R05UBF
2017-04-18 11:09                                 iw3unpbf.f

   5120  
   5121 C  ------------------------------------------------------------------
   5122 C  MISC DATA GOES INTO DATA LEVEL CATEGORY 08
   5123 C  ------------------------------------------------------------------
   5124 C  CODE FIGURE 021 - REPORT SEQUENCE NUMBER
   5125 C                     (CURRENTLY ONLY FOR MDCRS ACARS)
   5126 C  CODE FIGURE 914 - PHASE OF FLIGHT
   5127 C                     (CURRENTLY ONLY FOR AMDAR FORMAT, MDCRS ACARS,
   5128 C                      E-AMDAR OR CANADIAN AMDAR) (BUFR C. TBL 0-08-004)
   5129 C  CODE FIGURE 915 - PRECISION OF TEMPERATURE OBSERVATION IN
   5130 C                      0.01*DEG. K
   5131 C                     (CURRENTLY ONLY FOR AMDAR FORMAT, MDCRS ACARS,
   5132 C                      E-AMDAR OR CANADIAN AMDAR) (BUFR C. TBL 0-02-005)
   5133 C  CODE FIGURE 926 - MDCRS ACARS TURBULENCE INDEX FOR PERIOD T-1 MINUTE
   5134 C                     TO T-0 MINUTES (BUFR CODE TABLE 0-11-236)
   5135 C  CODE FIGURE 927 - MDCRS ACARS TURBULENCE INDEX FOR PERIOD T-2 MINUTE
   5136 C                     TO T-1 MINUTES (BUFR CODE TABLE 0-11-237)
   5137 C  CODE FIGURE 928 - MDCRS ACARS TURBULENCE INDEX FOR PERIOD T-3 MINUTE
   5138 C                     TO T-2 MINUTES (BUFR CODE TABLE 0-11-238)
   5139 C  CODE FIGURE 929 - MDCRS ACARS TURBULENCE INDEX FOR PERIOD T-4 MINUTE
   5140 C                     TO T-3 MINUTES (BUFR CODE TABLE 0-11-239)
   5141 C  CODE FIGURE 930 - TAMDAR TURBULENCE INDEX (BUFR CODE TABLE 0-11-239)
   5142 C                     INDICATOR 2 CONTAINS TURBULENCE INDEX QUALITY
   5143 C                     MARKER (0-15)
   5144 C  CODE FIGURE 931 - TAMDAR ROLL ANGLE FLAG (BUFR CODE TABLE 0-02-199)
   5145 C  CODE FIGURE 932 - INSTANTANEOUS ALTITUDE RATE IN .001*METERS/SECOND
   5146 C  ------------------------------------------------------------------
   5147 
   5148       IF(SUBSET.EQ.'NC004004') THEN
   5149          OB8(1) = KNDX
   5150          CF8(1) = 21
   5151          Q81(1) = IMISS
   5152          Q82(1) = IMISS
   5153          CALL S02UBF(8,1,*9999)
   5154       END IF
   5155       IF(PCT.LT.BMISS) THEN
   5156          OB8(1) = NINT(PCT*100.)
   5157          CF8(1) = 915
   5158          Q81(1) = IMISS
   5159          Q82(1) = IMISS
   5160          CALL S02UBF(8,1,*9999)
   5161       END IF
   5162       IF(POF.LT.BMISS) THEN
   5163          OB8(1) = NINT(POF)
   5164          CF8(1) = 914
   5165          Q81(1) = IMISS
   5166          Q82(1) = IMISS
   5167          CALL S02UBF(8,1,*9999)
   5168       END IF
   5169       DO I = 1,5
   5170          IF(TRBX(I).LT.BMISS) THEN
   5171             OB8(1) = NINT(TRBX(I))
   5172             CF8(1) = 925 + I
   5173             Q81(1) = IMISS
   5174             Q82(1) = IMISS
   5175             IF(I.EQ.5)  Q82(1) = QTRBX
   5176             CALL S02UBF(8,1,*9999)

Page 128         Source Listing                  R05UBF
2017-04-18 11:09                                 iw3unpbf.f

   5177          END IF
   5178       ENDDO
   5179       IF(ROLF.LT.BMISS) THEN
   5180          OB8(1) = NINT(ROLF)
   5181          CF8(1) = 931
   5182          Q81(1) = IMISS
   5183          Q82(1) = IMISS
   5184          CALL S02UBF(8,1,*9999)
   5185       END IF
   5186       IF(RIALR.LT.BMISS) THEN
   5187          OB8(1) = NINT(RIALR*1000)
   5188          CF8(1) = 932
   5189          Q81(1) = IMISS
   5190          Q82(1) = IMISS
   5191          CALL S02UBF(8,1,*9999)
   5192       END IF
   5193 
   5194       CALL S03UBF(OBS,SUBSET,*9999,*9998,*9997)
   5195  
   5196       RETURN
   5197 
   5198  9999 CONTINUE
   5199       R05UBF = 999
   5200       RETURN
   5201 
   5202  9998 CONTINUE
   5203       print'(" IW3UNPBF/R05UBF: RPT with ID= ",A," TOSSED - ZERO ",
   5204      $ "CAT.1-6,51 LVLS")', SID
   5205  9997 CONTINUE
   5206       R05UBF = -9999
   5207       KSKACF(1) = KSKACF(1) + 1
   5208       RETURN
   5209 
   5210       END
   5211 C***********************************************************************
   5212 C***********************************************************************
   5213 C***********************************************************************
   5214       FUNCTION R06UBF(LUNIT,OBS,OBS2,OBS3,NOBS3,obs8_8)
   5215 C     ---> PROCESSES SATWIND DATA (005/*)
   5216  
   5217       COMMON/IUBFAA/BMISS
   5218       COMMON/IUBFBB/KNDX,KSKACF(8),KSKUPA,KSKSFC,KSKSAT,KFLSAT(12),
   5219      $ KSKSMI
   5220       COMMON/IUBFCC/SUBSET
   5221       COMMON/IUBFEE/POB(255),QOB(255),TOB(255),ZOB(255),DOB(255),
   5222      $              SOB(255),VSG(255),OB8(255),CF8(255)
   5223       COMMON/IUBFFF/PQM(255),QQM(255),TQM(255),ZQM(255),WQM(255)
   5224       COMMON/IUBFKK/KOUNT(499,18,2),KNTSAT(250:260),KNTMODIS(783:785),
   5225      $ KNTavhrr(3:224),KNTviirs(224:225),IFLSAT
   5226       COMMON/IUBFLL/Q81(255),Q82(255)
   5227  
   5228       CHARACTER*80 HDSTR,LVSTR,QMSTR,RCSTR
   5229       CHARACTER*8  SUBSET,SID,RSV1,RSV2
   5230       CHARACTER*1  CSAT(499),CPROD(0:4),CPRDF(0:2),CPRDFN(51),C8(10)
   5231       INTEGER      IPRDF(0:2),ISWCM(5,9:10,2),ITP_C8(10),ISWDL(7)
   5232       REAL(8) RID_8,UFBINT_8,PCCF_8(2,12),GNAP_8(12),HDR_8(20),RCT_8(5),
   5233      $ ARR_8(10),OBS2_8(43),OBS3_8(5,255,7),WIND_8(2,5),PRLC_8(11),

Page 129         Source Listing                  R06UBF
2017-04-18 11:09                                 iw3unpbf.f

   5234      $ QFGU_8(8),BMISS,obs8_8(2)
   5235       DIMENSION    OBS(*),OBS2(43),OBS3(5,255,7),NOBS3(7),HDR(20),
   5236      $ RCT(5),ARR(10),PCCF(2,12),GNAP(12),WIND(2,5),PRLC(11),QFGU(8)
   5237       EQUIVALENCE  (RID_8,SID)
   5238 
   5239       SAVE
   5240 
   5241       DATA HDSTR/'RPID CLON CLAT HOUR MINU SAID               '/
   5242       DATA LVSTR/'TMDP TMDB CCST                              '/
   5243       DATA RCSTR/'RCHR RCMI RCTS                              '/
   5244       DATA IMISS/99999/,XMISS/99999./
   5245 
   5246 C=======================================================================
   5247 C Note: CSAT, CPROD, CPRDF, CPRDFN, IPRDF and ISWCM below are valid
   5248 C       only for input data dump files prior to Dec 2000 where report
   5249 C       id has not yet been constructed (these no longer need to be
   5250 C       updated for new satellites, etc. - after Dec 2000 this is
   5251 C       handled in BUFR_DUPSAT)
   5252 C=======================================================================
   5253 
   5254       DATA CSAT
   5255 C                           **  vestage from old days **
   5256 C ---------------  1    2    3    4
   5257      $           /'A', 'B', 'C', 'D',
   5258 
   5259 C --------------- spares (5-49)
   5260      $            45*'?',
   5261 C                           **  Meteosat  **
   5262 C ---------------  50   51   52   53   54   55   56   57   58   59
   5263      $            'Z', 'W', 'X', 'Y', 'Z', 'W', 'X', 'Y', 'Z', 'W',
   5264 C ---------------  spares (60-98)    99   spares (100-149)
   5265      $            39*  '?',         'X', 50*  '?',
   5266 C                              **  GMS **
   5267 C --------------- 150  151  152  153  154  155  156  157  158  159
   5268      $            'R', 'O', 'P', 'Q', 'R', 'O', 'P', 'Q', 'R', 'O',
   5269 C                             **  MTSAT **
   5270 C ---------------  spares (160-170)   171   spares (172-198)   199
   5271      $            11*  '?',           'Q', 27*  '?',           'Q',
   5272 C --------------- spares (200-249)
   5273      $            50*'?',
   5274 C                              **  GOES **
   5275 C --------------- 250 251 252 253 254 255 256 257 258
   5276      $            'D','A','B','C','D','A','B','C','D',
   5277 
   5278 C --------------- spares (259-439)
   5279      $            181*'?',
   5280 C                             **  Kalpana **
   5281 C --------------- 440
   5282      $            'K',
   5283 
   5284 C --------------- spares (441-469)
   5285      $            29*'?',
   5286 C                             **  Insat **
   5287 C --------------- 470   spares (471-498) 499
   5288      $            'V', 28*  '?',         'V'/
   5289 
   5290       DATA CPROD /'C','D','?','?','E'/

Page 130         Source Listing                  R06UBF
2017-04-18 11:09                                 iw3unpbf.f

   5291       DATA CPRDF /'V','C','B'/
   5292       DATA CPRDFN/'C','C','V','C','I','W','?','Z','P','I','W','Z','P',
   5293      $ 'T','I','W','V','T',31*'?','C','V'/
   5294       DATA IPRDF / 4 , 1 , 6 /
   5295 C                   **  High-Density Imager (+ low-dens. p. triplet)  **
   5296       DATA ISWCM / 16, 17, 18,  3, 18,
   5297 C                   **  High-Density Sounder  **
   5298      $             99, 99, 14, 99, 14,
   5299 C                   **  Low-Density Imager  **
   5300      $              1,  6,  4, 99,  4,
   5301 C                   **  Low-Density Sounder  **
   5302      $             99, 99, 99, 99, 99/
   5303 
   5304 C=======================================================================
   5305 C Note: C8 and ITP_C8 below are valid only for input data dump files
   5306 C       after Dec 2000 where report id has already beeen contructed by
   5307 C       BUFR_DUPSAT
   5308 C=======================================================================
   5309 
   5310 C  C8 is eighth character in report id, it determines instrument/
   5311 C  product type (ITP_C8 later stored into ITP) for all producers and is
   5312 C  defined a bit further below
   5313 
   5314       DATA      C8/'C','P','V','B','T','L','I','Z','W','S'/
   5315       DATA  ITP_C8/ 1 , 3 , 4 , 6 ,14 ,15, 16, 17, 18, 19/
   5316 
   5317 C=======================================================================
   5318 C Note: ISWDL below is valid for all input data dump files regardless
   5319 C       of their date
   5320 C=======================================================================
   5321 
   5322       DATA ISWDL / ! cloud top/deep-layer indicator for winds generated
   5323                    ! by NESDIS or NASA (meaning defined a bit further
   5324                    ! below)
   5325 
   5326 C -> Wind type:
   5327 C         IR(LW,SW)  VISIBLE   WV-CLTOP  PTRIPLET  WV-DPLYR  N/A
   5328 C         ---------  --------  --------  --------  --------  ---
   5329      $          2 ,       2 ,       2 ,    99999,       1 ,  2* 99999 /
   5330 
   5331 C=======================================================================
   5332 
   5333       HGTF(P) = (1.-(P/1013.25)**(1./5.256))*(288.15/.0065)
   5334 
   5335 C  FCNS BELOW CONVERT TEMP/TD(K) & PRESS(MB) INTO SAT./SPEC. HUM.(KG/KG)
   5336 C  ---------------------------------------------------------------------
   5337 
   5338       ES(T) = 6.1078 * EXP((17.269 * (T - 273.16))/((T - 273.16)+237.3))
   5339       QFRMTP(T,P) = (0.622 * ES(T))/(P - (0.378 * ES(T)))
   5340 
   5341       R06UBF = 0
   5342 
   5343 C  STORE SINGLE LEVEL REPORT DATA DIRECTLY INTO OBS2 ARRAY AND
   5344 C   DOUBLE-PRECISION SINGLE LEVEL REPORT DATA DIRECTLY INTO OBS8_8 ARRAY
   5345 C  ---------------------------------------------------------------------
   5346 
   5347       OBS2_8 = BMISS

Page 131         Source Listing                  R06UBF
2017-04-18 11:09                                 iw3unpbf.f

   5348       obs8_8 = bmiss
   5349       CALL UFBINT(LUNIT,OBS2_8,2,1,IRET,'RSRD EXPRSRD')
   5350       CALL UFBINT(LUNIT,OBS2_8(43),1,1,IRET,'SAZA')
   5351       OBS2 = OBS2_8
   5352 
   5353       IFLSAT = 1
   5354  
   5355       CALL S05UBF
   5356  
   5357 C  PUT THE HEADER INFORMATION INTO UNPACKED FORMAT
   5358 C  -----------------------------------------------
   5359  
   5360       CALL UFBINT(LUNIT,HDR_8,20,1,IRET,HDSTR);HDR(2:)=HDR_8(2:)
   5361       CALL UFBINT(LUNIT,RCT_8, 5,1,NRCT,RCSTR);RCT=RCT_8
   5362       obs8_8(1) = hdr_8(3)
   5363       obs8_8(2) = hdr_8(2)
   5364       IF(HDR(5).GE.BMISS) HDR(5) = 0
   5365       RCTIM = NINT(RCT(1))+NINT(RCT(2))/60.
   5366       RID_8 = HDR_8(1)
   5367       XOB   = HDR(2)
   5368       YOB   = HDR(3)
   5369       RHR   = BMISS
   5370       IF(HDR(4).LT.BMISS)  RHR = NINT(HDR(4))+NINT(HDR(5))/60.
   5371       RSV1  = '        '
   5372       RSV2  = '        '
   5373       IDS   = IMISS
   5374       IF(HDR(6).LT.BMISS)  IDS = NINT(HDR(6))
   5375 
   5376 C  SATWIND PRODUCER INDICATOR STORED IN BYTE 1 OF HEADER RESERVE
   5377 C   CHARACTER WORD 1
   5378 C  -------------------------------------------------------------
   5379 C   = 1 - USA/NOAA/NESDIS
   5380 C   = 4 - USA/NOAA.NWS
   5381 C   = 5 - USA/UNIVERSITY
   5382 C   = 6 - USA/COMMERCIAL
   5383 C   = 7 - USA/DOD/NAVY
   5384 C   = 8 - USA/DOD/USAF
   5385 C   = 9 - USA/NASA
   5386 C   =12 - ESA/METEOSAT
   5387 C   =13 - GMS/MSC
   5388 C   =14 - INDIA/INSAT
   5389 
   5390 
   5391 C  CLOUD TOP/DEEP LAYER INDICATOR STORED IN BYTE 3 OF HEADER RESERVE
   5392 C   CHARACTER WORD 1
   5393 C  ------------------------------------------------------------------
   5394 C   = 1 - DEEP LAYER
   5395 C   = 2 - CLOUD TOP (NORMAL CLOUD DRIFT)
   5396 C   = 9 - INDICATOR MISSING (REVERTS TO DEFAULT CLOUD TOP)
   5397 
   5398 C  THE INSTRUMENT TYPE INDICATES THE PRODUCT TYPE
   5399 C  ----------------------------------------------
   5400 C   = 1 - IR (LONG-WAVE) AUTOMATED WINDS (LOW DENSITY)
   5401 C   = 2 - IR (LONG-WAVE) MANUAL WINDS
   5402 C   = 3 - PICTURE TRIPLET (LOW DENSITY)
   5403 C   = 4 - WATER VAPOR AUTOMATED (LOW DENSITY)
   5404 C   = 5 - VISIBLE MANUAL

Page 132         Source Listing                  R06UBF
2017-04-18 11:09                                 iw3unpbf.f

   5405 C   = 6 - VISIBLE AUTOMATED (LOW DENSITY)
   5406 C   = 7 - GRADIENT WINDS
   5407 C   = 8 - PICTURE PAIR;
   5408 C   =10 - AMSU/SSMI MICROWAVE WINDS
   5409 C   =11 - SCATTEROMETER
   5410 C   =12 - ALTIMETER
   5411 C   =13 - LAWS
   5412 C   =14 - HIGH-DENSITY WATER VAPOR SOUNDER, CHN. 10
   5413 C   =15 - HIGH-DENSITY WATER VAPOR SOUNDER, CHN. 11
   5414 C   =16 - HIGH-DENSITY IR (LONG-WAVE) IMAGER AUTOMATED WINDS
   5415 C   =17 - HIGH-DENSITY VISIBLE IMAGER AUTOMATED WINDS
   5416 C   =18 - HIGH-DENSITY WATER VAPOR IMAGER
   5417 C   =19 - HIGH-DENSITY IR (SHORT-WAVE) IMAGER AUTOMATED WINDS
   5418 
   5419 
   5420       ITP = IMISS
   5421 
   5422       IF(SID(8:8).LT.'A'.OR.SID(8:8).GT.'Z')  THEN
   5423 
   5424 C***********************************************************************
   5425 C  IF THE EIGHTH CHARACTER OF THE INPUT STN. ID IS NOT "A" - "Z", THEN
   5426 C              THIS SUBROUTINE MUST CREATE THE STN. ID.
   5427 C       (INDICATES AN INPUT DATA DUMP FILE PRIOR TO DEC. 2000)
   5428 C***********************************************************************
   5429 
   5430 C    REPROCESSED CHAR 1 -----> GOES:     SAT. NO. 247,251,255   GET 'A'
   5431 C                                        SAT. NO. 248,252,256   GET 'B'
   5432 C                                        SAT. NO. 249,253,257   GET 'C'
   5433 C                                        SAT. NO. 250,254,258   GET 'D'
   5434 C                                        (Note: Sat. No. 253 gets 'P'
   5435 C                                               if producer is JMA)
   5436 C                       -----> METEOSAT: SAT. NO.  52, 56       GET 'X'
   5437 C                                        SAT. NO.  53, 57       GET 'Y'
   5438 C                                        SAT. NO.  50, 54, 58   GET 'Z'
   5439 C                                        SAT. NO.  51, 55, 59   GET 'W'
   5440 C                                        SAT. NO.  99 (UNKNOWN) GET 'X'
   5441 C                       -----> GMS(JA):  SAT. NO. 152,156,253   GET 'P'
   5442 C                                        SAT. NO. 153,157       GET 'Q'
   5443 C                                        SAT. NO. 150,154,158   GET 'R'
   5444 C                                        SAT. NO. 151,155,159   GET 'O'
   5445 C                                        (Note: Sat. No. 253 gets 'C'
   5446 C                                               if producer is NESDIS)
   5447 C                       -----> MTSAT:    SAT. NO. 171           GET 'Q'
   5448 C                                        SAT. NO. 199 (UNKNOWN) GET 'Q'
   5449 C                       -----> KALPANA:  SAT. NO. 440           GET 'K'
   5450 C                       -----> INSAT:    SAT. NO. 470           GET 'V'
   5451 C                                        SAT. NO. 499 (UNKNOWN) GET 'V'
   5452 C    REPROCESSED CHAR 2 -----> WINDS PRODUCED BY NESDIS:
   5453 C                               RETURNED VALUE IN BUFR FOR 'SWPR'
   5454 C                               (PRODUCER), IF NON-MISSING; OTHERWISE
   5455 C                               HARDWIRED TO '1'
   5456 C                       -----> WINDS PRODUCED BY FOREIGN PRODUCERS:
   5457 C                                SAT. PRODUCER -- ESA           GET 'C'
   5458 C                                              -- GMS/MTSAT     GET 'D'
   5459 C                                              -- INSAT/KALPANA GET 'E'
   5460 C    REPROCESSED CHAR 3-7 ---> SEQUENTIAL SERIAL INDEX (00001 - 99999)
   5461 C                              (UNIQUE FOR EACH NCEP BUFR CHAR 1/2/6

Page 133         Source Listing                  R06UBF
2017-04-18 11:09                                 iw3unpbf.f

   5462 C                               COMB.)
   5463 C    REPROCESSED CHAR 8 -----> WINDS PRODUCED BY NESDIS:
   5464 C                               OLD FORMAT, (GOES -LOW-DENSITY-OBSOLETE)
   5465 C                                     -- IR(LW)  CLOUD DRIFT     GET 'C'
   5466 C                                     -- VISIBLE CLOUD DRIFT     GET 'C'
   5467 C                                     -- PICTURE TRIPLET         GET 'C'
   5468 C                                     -- WATER VAPOR             GET 'V'
   5469 C                               NEW FORMAT (GOES - HIGH-DENSITY)
   5470 C                                     -- IR(LW) IMAGER CLD DRIFT GET 'I'
   5471 C                                     -- VIS IMAGER CLOUD DRIFT  GET 'Z'
   5472 C                                     -- WATER VAPOR IMAGER      GET 'W'
   5473 C                                     -- WATER VAPR SNDR, CHN 10 GET 'T'
   5474 C                                     -- WATER VAPR SNDR, CHN 11 GET 'L'
   5475 C                               NEW FORMAT (GMS  - LOW-DENSITY)
   5476 C                                     -- IR(LW) CLOUD DRIFT      GET 'C'
   5477 C                                     -- WATER VAPOR             GET 'V'
   5478 C                       -----> WINDS PRODUCED BY FOREIGN PRODUCERS:
   5479 C                                     -- IR(LW)  CLOUD DRIFT     GET 'C'
   5480 C                                     -- VISIBLE CLOUD DRIFT     GET 'B'
   5481 C                                     -- WATER VAPOR             GET 'V'
   5482 
   5483          SID = '????????'
   5484          IPRODUCER = 99
   5485          IDENSITY  = 99
   5486          IF(IDS.LT.500)  THEN
   5487             SID(1:1) = CSAT(IDS)
   5488 C     .... GOES-9 winds with BUFR message subtype 41-46 always get "P"
   5489 C          in 1st char. of stn. id (JMA began producing winds from
   5490 C          GOES-9 in place of failing GMS-5 on 23 May 2003, this lasted
   5491 C          until 15 July 2005 when MTSAT-1R replaced GOES-9)
   5492 C          (Note: When NESDIS produces winds from GOES-9, the first
   5493 C                 char. in the stn. id is "C", but that would cause
   5494 C                 problems in PREPOBS_PREPDATA in this case)
   5495             IF(IDS.EQ.253.AND.SUBSET(7:7).EQ.'4')  SID(1:1) = 'P'
   5496             IF((SID(1:1).GE.'A'.AND.SID(1:1).LE.'D') .OR.
   5497      $         (SUBSET(7:8).EQ.'50'.OR.SUBSET(7:8).EQ.'51')) THEN
   5498                IF(SUBSET(7:8).EQ.'50'.OR.SUBSET(7:8).EQ.'51')  THEN
   5499                   IDENSITY = 2
   5500                ELSE
   5501                   IDENSITY = 1
   5502                END IF
   5503 C  .. Satellite producer for winds generated by NESDIS
   5504                CALL UFBINT(LUNIT,UFBINT_8,1,1,IRET,'SWPR');SWPR=UFBINT_8
   5505                IF(SWPR.LT.BMISS) THEN
   5506                                    ! From NESDIS Binary Fmt (local)
   5507                                    !  (both lo- and hi- density)
   5508                   IF(NINT(SWPR).GT.0.AND.NINT(SWPR).LT.10)
   5509      $             WRITE(RSV1(1:1),'(I1)') NINT(SWPR)
   5510                   SID(2:2) = RSV1(1:1)
   5511                ELSE
   5512                   CALL UFBINT(LUNIT,UFBINT_8,1,1,IRET,'GCLONG')
   5513                   GCLONG=UFBINT_8
   5514                                    ! From NESDIS BUFR Fmt (WMO)
   5515                                    !  Should come in as 160 (NESDIS),
   5516                                    !  but irregardless hardwire here as
   5517                                    !  1
   5518                   RSV1(1:1) = '1'

Page 134         Source Listing                  R06UBF
2017-04-18 11:09                                 iw3unpbf.f

   5519                   SID(2:2) = RSV1(1:1)
   5520                END IF
   5521                IPRODUCER=1
   5522 C  .. Product type for winds generated by NESDIS
   5523                CALL UFBINT(LUNIT,UFBINT_8,1,1,IRET,'SWTP');SWTP=UFBINT_8
   5524                CALL UFBINT(LUNIT,UFBINT_8,1,1,IRET,'CMCM');CMCM=UFBINT_8
   5525                IF(SWTP.LT.BMISS) THEN
   5526                   ITP = NINT(SWTP) ! From NESDIS Binary Fmt (local)
   5527                                    !  (hi- density)
   5528                ELSE  IF(CMCM.LT.BMISS)  THEN
   5529                                    ! From NESDIS Binary Fmt (local)
   5530                                    !  (lo- density)
   5531                                    ! (Note: CMCM is non-missing in this
   5532                                    !        case but may not be correct!
   5533                   IF(SUBSET(7:8).EQ.'01')  THEN
   5534                      ITP = 1
   5535                   ELSE  IF(SUBSET(7:8).EQ.'02')  THEN
   5536                      ITP = 6
   5537                   ELSE  IF(SUBSET(7:8).EQ.'03')  THEN
   5538                      ITP = 4
   5539                   ELSE  IF(SUBSET(7:8).EQ.'04')  THEN
   5540                      ITP = 3
   5541                   END IF
   5542                ELSE
   5543                   CALL UFBINT(LUNIT,UFBINT_8,1,1,IRET,'SWCM')
   5544                   SWCM=UFBINT_8
   5545                   CALL UFBINT(LUNIT,UFBINT_8,1,1,IRET,'SIDP')
   5546                   SIDP=UFBINT_8
   5547 
   5548 C  Effective 3/10/2005 NESDIS fixed an error which had stored SIDP as
   5549 C   a code table value rather than correctly as a flag table value - in
   5550 C   response must redirect SIDP value back to original code table value
   5551 C   (will still work ok for historical runs prior to NESDIS fix)
   5552 C  --------------------------------------------------------------------
   5553 
   5554                   IF(NINT(SIDP).EQ.4194304) THEN
   5555                      SIDP =  9
   5556                   ELSE  IF(NINT(SIDP).EQ.2097152) THEN
   5557                      SIDP = 10
   5558                   ENDIF
   5559                   IF((NINT(SWCM).GT. 0.AND.NINT(SWCM).LT. 6).AND.
   5560      $               (NINT(SIDP).EQ. 9.OR. NINT(SIDP).EQ.10))
   5561                                    !From NESDIS BUFR Fmt (WMO)
   5562      $             ITP = ISWCM(NINT(SWCM),NINT(SIDP),IDENSITY)
   5563                   IF(ITP.EQ.14)  THEN
   5564                      CALL UFBINT(LUNIT,UFBINT_8,1,1,IRET,'SCCF')
   5565                      SCCF = UFBINT_8
   5566                      SCCF = SCCF*1E-11
   5567                      IF(INT(SCCF).EQ.405)  ITP = 15
   5568                   END IF
   5569                END IF
   5570                READ(SUBSET(7:8),'(I2)') INUM2
   5571                IF(INUM2.LT.52)  SID(8:8) = CPRDFN(INUM2)
   5572                IF(SID(8:8).EQ.'T')  THEN
   5573                   IF(ITP.EQ.15)  SID(8:8) = 'L'
   5574                END IF
   5575 C  .. Cloud top/deep-layer indicator for winds generated by NESDIS

Page 135         Source Listing                  R06UBF
2017-04-18 11:09                                 iw3unpbf.f

   5576                CALL UFBINT(LUNIT,UFBINT_8,1,1,IRET,'SWDL');SWDL=UFBINT_8
   5577             IF(SWDL.GE.BMISS) THEN ! NESDIS GTS (& eventually V10 server
   5578                                    !  too) & MODIS winds come here
   5579 
   5580                   IF(NINT(SWCM).GT.0.AND.NINT(SWCM).LT.8) THEN
   5581                      IF(ISWDL(NINT(SWCM)).LT.3) SWDL = ISWDL(NINT(SWCM))
   5582                   END IF
   5583                END IF
   5584                IF(NINT(SWDL).GT.-1.AND.NINT(SWDL).LT.10)
   5585      $          WRITE(RSV1(3:3),'(I1)') NINT(SWDL)
   5586             ELSE
   5587 C  .. Satellite producer for winds generated from foreign producers
   5588                SID(2:2) = CPROD(IDS/100)
   5589 C     .... GOES-9 winds with BUFR message subtype 41-46 are assumed to
   5590 C          be produced by JMA (JMA began producing winds from GOES-9
   5591 C          in place of failing GMS-5 on 23 May 2003, this lasted until
   5592 C          15 July 2005 when MTSAT-1R replaced GOES-9)
   5593                IF(IDS.EQ.253.AND.SUBSET(7:7).EQ.'4') SID(2:2)='D'
   5594                IPRODUCER=2
   5595                RSV1(1:1) = SID(2:2)
   5596                READ(SUBSET(8:8),'(I1)') INUM1
   5597 C  .. Product type for  winds generated from foreign producers
   5598                SID(8:8) = CPRDF(MOD(INUM1,3))
   5599                ITP = IPRDF(MOD(INUM1,3))
   5600 C  .. Cloud top/deep-layer indicator for winds generated from foreign
   5601 C      producers
   5602                CALL UFBINT(LUNIT,UFBINT_8,1,1,IRET,'SWCM')
   5603                SWCM=UFBINT_8
   5604                IF(NINT(SWCM).GT.0.AND.NINT(SWCM).LT.8) THEN
   5605                   IF(ISWDL(NINT(SWCM)).LT.3) SWDL = ISWDL(NINT(SWCM))
   5606                END IF
   5607                IF(NINT(SWDL).GT.-1.AND.NINT(SWDL).LT.10)
   5608      $          WRITE(RSV1(3:3),'(I1)') NINT(SWDL)
   5609             END IF
   5610          END IF
   5611          IF(IDS.LT.500.AND.ITP.LT.19.AND.IPRODUCER.LT.3)  THEN
   5612             KOUNT(IDS,ITP,IPRODUCER) =
   5613      $       MIN(KOUNT(IDS,ITP,IPRODUCER)+1,99999)
   5614             WRITE(SID(3:7),'(I5.5)')  KOUNT(IDS,ITP,IPRODUCER)
   5615          END IF
   5616       ELSE
   5617 
   5618 C***********************************************************************
   5619 C  IF THE EIGHTH CHARACTER OF THE INPUT STN. ID IS "A" - "Z", THEN
   5620 C   THE DUMP PROGRAM BUFR_DUPSAT HAS ALREADY CREATED THE STN. ID.
   5621 C         (INDICATES AN INPUT DATA DUMP FILE AFTER DEC. 2000)
   5622 C***********************************************************************
   5623 
   5624          RSV1(1:1) = SID(2:2)
   5625 
   5626          IF((SID(1:1).GE.'A'.AND.SID(1:1).LE.'D') .OR.
   5627      $    (SUBSET(7:8).EQ.'50'.OR.SUBSET(7:8).EQ.'51') .OR.
   5628      $    (SUBSET(7:8).EQ.'70'.OR.SUBSET(7:8).EQ.'71') .OR.
   5629      $    (SUBSET(7:8).EQ.'80') .OR.
   5630      $    (SUBSET(7:8).EQ.'90')) THEN
   5631 
   5632 C  .. Product type for winds generated by NESDIS/NASA

Page 136         Source Listing                  R06UBF
2017-04-18 11:09                                 iw3unpbf.f

   5633             CALL UFBINT(LUNIT,UFBINT_8,1,1,IRET,'SWTP');SWTP=UFBINT_8
   5634             CALL UFBINT(LUNIT,UFBINT_8,1,1,IRET,'CMCM');CMCM=UFBINT_8
   5635             IF(SWTP.LT.BMISS) THEN
   5636                ITP = NINT(SWTP) ! From NESDIS Binary Fmt (local)
   5637                                 !  (hi- density)
   5638             ELSE  IF(CMCM.LT.BMISS)  THEN
   5639                                 ! From NESDIS Binary Fmt (local)
   5640                                 !  (lo- density)
   5641                                 ! (Note: CMCM is non-missing in this
   5642                                 !        case but may not be correct!
   5643                IF(SUBSET(7:8).EQ.'01')  THEN
   5644                   ITP = 1
   5645                ELSE  IF(SUBSET(7:8).EQ.'02')  THEN
   5646                   ITP = 6
   5647                ELSE  IF(SUBSET(7:8).EQ.'03')  THEN
   5648                   ITP = 4
   5649                ELSE  IF(SUBSET(7:8).EQ.'04')  THEN
   5650                   ITP = 3
   5651                END IF
   5652             ELSE
   5653                                    !From NESDIS BUFR Fmt (WMO)
   5654                DO  K=1,10
   5655                   IF(SID(8:8).EQ.C8(K))  THEN
   5656                      ITP = ITP_C8(K)
   5657                      EXIT
   5658                   END IF
   5659                ENDDO
   5660             END IF
   5661 C  .. Cloud top/deep-layer indicator for winds generated by NESDIS or
   5662 C     NASA
   5663             CALL UFBINT(LUNIT,UFBINT_8,1,1,IRET,'SWDL');SWDL=UFBINT_8
   5664             IF(SWDL.GE.BMISS) THEN ! NESDIS GTS & MODIS/AVHRR/VIIRS
   5665                                    ! winds come here
   5666                CALL UFBINT(LUNIT,UFBINT_8,1,1,IRET,'SWCM')
   5667                SWCM=UFBINT_8
   5668                IF(NINT(SWCM).GT.0.AND.NINT(SWCM).LT.8) THEN
   5669                   IF(ISWDL(NINT(SWCM)).LT.3) SWDL = ISWDL(NINT(SWCM))
   5670                END IF
   5671             END IF
   5672             IF(NINT(SWDL).GT.-1.AND.NINT(SWDL).LT.10)
   5673      $       WRITE(RSV1(3:3),'(I1)') NINT(SWDL)
   5674          ELSE
   5675 C  .. Product type for  winds generated from foreign producers
   5676             DO  K=1,4
   5677                IF(SID(8:8).EQ.C8(K))  THEN
   5678                   ITP = ITP_C8(K)
   5679                   EXIT
   5680                END IF
   5681             ENDDO
   5682 C  .. Cloud top/deep-layer indicator for winds generated from foreign
   5683 C      producers
   5684             CALL UFBINT(LUNIT,UFBINT_8,1,1,IRET,'SWCM')
   5685             SWCM=UFBINT_8
   5686             IF(NINT(SWCM).GT.0.AND.NINT(SWCM).LT.8) THEN
   5687                IF(ISWDL(NINT(SWCM)).LT.3) SWDL = ISWDL(NINT(SWCM))
   5688             END IF
   5689             IF(NINT(SWDL).GT.-1.AND.NINT(SWDL).LT.10)

Page 137         Source Listing                  R06UBF
2017-04-18 11:09                                 iw3unpbf.f

   5690      $       WRITE(RSV1(3:3),'(I1)') NINT(SWDL)
   5691 
   5692 C  From approximately 11 August through 30 September 2010, BUFR_DUPSAT
   5693 C   incorrectly placed a "?" in character 1 of the generated report id
   5694 C   for JMA MTSAT-2 wind reports -- change this to the correct value of
   5695 C   "R" for historical reruns, etc.
   5696 C  --------------------------------------------------------------------
   5697 
   5698             IF(IDS.EQ.172.AND.SID(1:1).EQ.'?')  SID(1:1) = 'R'
   5699 
   5700          END IF
   5701 
   5702 C***********************************************************************
   5703 
   5704       END IF
   5705 
   5706       RTP = 63
   5707  
   5708 C  PUT THE SINGLE-LEVEL DATA INTO SPECIFIED UNPACKED FORMAT
   5709 C  --------------------------------------------------------
   5710  
   5711       POB(1) = BMISS
   5712       CALL UFBREP(LUNIT,PRLC_8,1,11,IRET,'PRLC');PRLC=PRLC_8
   5713 cpppppppppp
   5714 cc        print *,'IRET = ',iret
   5715 cc    do i=1,iret
   5716 cc       print'(" For I = ",I0,"; PRLC IS: ",G0)', I,PRLC(I)
   5717 cc    enddo
   5718 cpppppppppp
   5719 
   5720 C  Which pressure do you want:
   5721 C        JTP = 1 -- Final (observed)
   5722 C            = 2 -- Window channel height assignment
   5723 C            = 3 -- Histogram height assignment
   5724 C            = 4 -- H2O intercept height assignment
   5725 C            = 5 -- CO2 slicing height assignment
   5726 C            = 6 -- Original (primary height assignment)
   5727 C   Note: JTP = 1 always for non-GOES, or non-NESDIS GTS, or
   5728 C                 non-MODIS/AVHRR/VIIRS wind types
   5729 
   5730       IF(IRET.EQ.1)  THEN
   5731          JTP = 1
   5732       ELSE
   5733          JTP = 1  ! Here hardwired to be final for GOES, and NESDIS
   5734                   !  GTS, and MODIS/AVHRR/VIIRS wind types
   5735       ENDIF
   5736 
   5737       IF(PRLC(JTP).LT.BMISS)  POB(1) =  NINT(PRLC(JTP)*.1)
   5738 
   5739 C  GROSS CHECK ON PRESSURE
   5740 C  -----------------------
   5741 
   5742       IF(NINT(POB(1)).EQ.0)  THEN
   5743          print'(" ~~IW3UNPBF/R06UBF: RPT with ID= ",A," TOSSED - PRES.",
   5744      $    " IS ZERO MB")', SID
   5745          R06UBF = -9999
   5746          KSKSAT = KSKSAT + 1

Page 138         Source Listing                  R06UBF
2017-04-18 11:09                                 iw3unpbf.f

   5747          RETURN
   5748       END IF
   5749 
   5750 C  TRY TO FIND FIND THE HEIGHT ASSIGNMENT
   5751 C  --------------------------------------
   5752  
   5753       CALL UFBINT(LUNIT,UFBINT_8,1,1,IRET,'HGHT');HGHT=UFBINT_8
   5754       IF(HGHT.LT.BMISS)  THEN
   5755          ELV = HGHT
   5756       ELSE  IF(POB(1).LT.BMISS)  THEN
   5757          ELV = HGTF(POB(1)*.1)
   5758       ELSE
   5759          ELV = BMISS
   5760       END IF
   5761       QMELV = XMISS
   5762 
   5763       CALL UFBINT(LUNIT,ARR_8,10,1,IRET,LVSTR);ARR=ARR_8
   5764 
   5765       QOB(1) = BMISS
   5766       IF(MAX(ARR(1),ARR(2),POB(1)).LT.BMISS)  THEN
   5767 
   5768 C  All data level category 6 rpts store specific humidity (g/kg) as
   5769 C   moisture variable
   5770 C  ----------------------------------------------------------------
   5771 
   5772          QQ = QFRMTP(ARR(1),POB(1)*0.1)
   5773          IF(QQ.GT.0.0.AND.NINT(ARR(1)*10.).LE.NINT(ARR(2)*10.))
   5774      $    QOB(1) = QQ * 1000.
   5775       END IF
   5776 
   5777       TOB(1) = BMISS
   5778       IF(ARR(2).LT.BMISS)  THEN
   5779          ITMP = NINT(ARR(2)*100.)        ! From NESDIS binary FMT &
   5780          TOB(1) = NINT((ITMP-27315)*0.1) !  foreign pre-V10 BUFR,
   5781                                          !  temp in "TMDB"
   5782 
   5783       ELSE  IF(ARR(3).LT.BMISS)  THEN
   5784          ITMP = NINT(ARR(3)*100.)        ! From NESDIS BUFR Fmt &
   5785          TOB(1) = NINT((ITMP-27315)*0.1) !  foreign V10 BUFR, temp
   5786                                          !  in "CCST"
   5787       END IF
   5788 
   5789       ZOB(1) = ELV
   5790 
   5791       CALL UFBREP(LUNIT,WIND_8,2,5,IRET,'WDIR WSPD');WIND=WIND_8
   5792 cpppppppppp
   5793 cc    do i=1,iret
   5794 cc       print'(" For I = ",I0,"; WIND IS: ",2(G0,1X))',I,WIND(1,I),
   5795 cc   $    WIND(2,I)
   5796 cc    enddo
   5797 cpppppppppp
   5798 
   5799 C  Which wind speed and direction do you want:
   5800 C        KTP = 1 -- Final (observed)
   5801 C            = 2 -- First guess
   5802 C            = 3 -- Original
   5803 C            = 4 -- Image 1 to 2

Page 139         Source Listing                  R06UBF
2017-04-18 11:09                                 iw3unpbf.f

   5804 C            = 5 -- Image 2 to 3
   5805 C   Note: KTP = 1 always for non-GOES, or non-NESDIS GTS, or
   5806 C                 non-MODIS/AVHRR/VIIRS wind types
   5807 
   5808       IF(IRET.EQ.1)  THEN
   5809          KTP = 1
   5810       ELSE
   5811          KTP = 1  ! Here hardwired to be final for GOES, and NESDIS
   5812                   !  GTS, and MODIS/AVHRR/VIIRS wind types
   5813       ENDIF
   5814 
   5815       DOB(1) = WIND(1,KTP)
   5816       SOB(1) = MIN(WIND(2,KTP)*10.,BMISS)
   5817 
   5818       CALL UFBINT(LUNIT,UFBINT_8,1,1,IRET,'SWQM');SWQM=UFBINT_8
   5819 
   5820       IF(IRET.EQ.1)  THEN
   5821          WQM(1) = EQMUBF(SWQM)
   5822          PQM(1) = 2
   5823          TQM(1) = 2
   5824          QQM(1) = 2
   5825          ZQM(1) = 2
   5826       END IF
   5827 
   5828 CVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVV
   5829 CVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVV
   5830       QI_with       = BMISS
   5831       QC_QI_with    = BMISS
   5832       QI_without    = BMISS
   5833       QC_QI_without = BMISS
   5834       RFF           = BMISS
   5835       QC_RFF        = BMISS
   5836       EE            = BMISS
   5837       QC_EE         = BMISS
   5838 
   5839       IF((SUBSET(7:8).GE.'10'.AND.SUBSET(7:8).LE.'12') .OR.
   5840      $   SUBSET(7:8).EQ.'14'                           .OR.
   5841      $   (SUBSET(7:8).GE.'15'.AND.SUBSET(7:8).LE.'19') .OR.
   5842      $   (SUBSET(7:8).GE.'44'.AND.SUBSET(7:8).LE.'46') .OR.
   5843      $   (SUBSET(7:8).GE.'64'.AND.SUBSET(7:8).LE.'66') .OR.
   5844      $   (SUBSET(7:8).GE.'70'.AND.SUBSET(7:8).LE.'71') .OR.
   5845      $   (SUBSET(7:8).EQ.'80') .OR.
   5846      $   (SUBSET(7:8).EQ.'90')) THEN
   5847 
   5848          IF(SUBSET(7:8).GE.'64'.AND.SUBSET(7:8).LE.'66') THEN !EUMETSAT
   5849             INDX  =   1
   5850             IOFF  =   0
   5851             IVARS =   4 ! number of variables w/ quality info
   5852             IQI   =   1 ! value of GNAP for QI w/  forecast
   5853             IQIwo =   2 ! value of GNAP for QI w/o forecast
   5854             IRFF  =   3 ! value of GNAP for RFF (present after ?-?-2006)
   5855 ccccccccc   LIMqi =  80 ! if QI less than or equal to this - flag
   5856             LIMqi =   0 ! if QI less than or equal to this - flag
   5857 ccccccccc   LIMqc =   3 ! if Manual/automatic q.c. indicator greater
   5858 ccccccccc               !  than or equal to this - flag
   5859             LIMqc = 999 ! if Manual/automatic q.c. indicator greater
   5860                         !  than or equal to this - flag

Page 140         Source Listing                  R06UBF
2017-04-18 11:09                                 iw3unpbf.f

   5861          ELSE IF(SUBSET(7:8).GE.'44'.AND.SUBSET(7:8).LE.'46') THEN !JMA
   5862             INDX  =   3
   5863             IOFF  =   0
   5864             IVARS =   4 ! number of variables w/ quality info
   5865             IQI   = 101 ! value of GNAP for QI w/  forecast
   5866             IQIwo = 102 ! value of GNAP for QI w/o forecast
   5867             IRFF  = 103 ! value of GNAP for RFF
   5868             LIMqi =  80 ! if QI less than or equal to this - flag
   5869             LIMqc =   3 ! if Manual/automatic q.c. indicator greater
   5870                         !  than or equal to this - flag
   5871          ELSE IF(SUBSET(7:8).GE.'15'.AND.SUBSET(7:8).LE.'18') THEN
   5872                                                              !GOES-GTS
   5873             INDX  =   5
   5874             IVARS =   2 ! number of variables w/ quality info
   5875             IOFF  =   1
   5876             IQI   =   3 ! value of GNAP for QI w/ forecast
   5877             IQIwo =   1 ! value of GNAP for QI w/o forecast
   5878             IRFF  =   2 ! value of GNAP for RFF
   5879             LIMqi =  49 ! if QI less than or equal to this - flag
   5880             LIMqc =   3 ! if Manual/automatic q.c. indicator greater
   5881                         !  than or equal to this - flag
   5882          ELSE IF((SUBSET(7:8).GE.'10'.AND.SUBSET(7:8).LE.'12')  .OR.
   5883      $           (SUBSET(7:8).EQ.'14') .OR. (SUBSET(7:8).EQ.'19')) THEN
   5884                                                              !GOES-V10
   5885                                                              !  (server)
   5886             INDX  =   5
   5887             IVARS =   2 ! number of variables w/ quality info
   5888             IOFF  =   1
   5889             IQI   =   3 ! value of GNAP for QI w/ forecast
   5890             IQIwo =   1 ! value of GNAP for QI w/o forecast
   5891             IRFF  =   2 ! value of GNAP for RFF
   5892             IEE   =   4 ! value of GNAP for NESDIS Expected Error
   5893             LIMqi =  49 ! if QI less than or equal to this - flag
   5894             LIMqc =   3 ! if Manual/automatic q.c. indicator greater
   5895                         !  than or equal to this - flag
   5896          ELSE IF(SUBSET(7:8).GE.'70'.AND.SUBSET(7:8).LE.'71') THEN
   5897                                                              !MODIS POES
   5898             INDX  =   7
   5899             IVARS =   2 ! number of variables w/ quality info
   5900             IOFF  =   1
   5901             IQI   =   3 ! value of GNAP for QI w/ forecast
   5902             IQIwo =   1 ! value of GNAP for QI w/o forecast
   5903             IRFF  =   2 ! value of GNAP for RFF
   5904             IEE   =   4 ! value of GNAP for NESDIS Expected Error
   5905             LIMqi =  49 ! if QI less than or equal to this - flag
   5906             LIMqc =   3 ! if Manual/automatic q.c. indicator greater
   5907                         !  than or equal to this - flag
   5908          ELSE IF(SUBSET(7:8).EQ.'80') THEN !AVHRR POES
   5909             INDX  =   9
   5910             IVARS =   2 ! number of variables w/ quality info
   5911             IOFF  =   1
   5912             IQI   =   3 ! value of GNAP for QI w/ forecast
   5913             IQIwo =   1 ! value of GNAP for QI w/o forecast
   5914             IRFF  =   2 ! value of GNAP for RFF
   5915             IEE   =   4 ! value of GNAP for NESDIS Expected Error
   5916 ccccccccc   LIMqi =  49 ! if QI less than or equal to this - flag
   5917             LIMqi =   0 ! if QI less than or equal to this - flag

Page 141         Source Listing                  R06UBF
2017-04-18 11:09                                 iw3unpbf.f

   5918 ccccccccc   LIMqc =   3 ! if Manual/automatic q.c. indicator greater
   5919 ccccccccc               !  than or equal to this - flag
   5920             LIMqc = 999 ! if Manual/automatic q.c. indicator greater
   5921                         !  than or equal to this - flag
   5922          ELSE IF(SUBSET(7:8).EQ.'90') THEN !VIIRS POES
   5923             INDX  =  11
   5924             IVARS =   2 ! number of variables w/ quality info
   5925             IOFF  =   1
   5926             IQI   =   3 ! value of GNAP for QI w/ forecast
   5927             IQIwo =   1 ! value of GNAP for QI w/o forecast
   5928             IRFF  =   2 ! value of GNAP for RFF
   5929             IEE   =   4 ! value of GNAP for NESDIS Expected Error
   5930 ccccccccc   LIMqi =  49 ! if QI less than or equal to this - flag
   5931             LIMqi =   0 ! if QI less than or equal to this - flag
   5932 ccccccccc   LIMqc =   3 ! if Manual/automatic q.c. indicator greater
   5933 ccccccccc               !  than or equal to this - flag
   5934             LIMqc = 999 ! if Manual/automatic q.c. indicator greater
   5935                         !  than or equal to this - flag
   5936          END IF
   5937 
   5938          CALL UFBREP(LUNIT,GNAP_8, 1,12,IRET_GNAP,'GNAP');GNAP=GNAP_8
   5939          CALL UFBREP(LUNIT,PCCF_8, 2,12,IRET_PCCF,'PCCF MAQC')
   5940          PCCF=PCCF_8
   5941          CALL UFBREP(LUNIT,QFGU_8, 1, 8,IRET_QFGU,'QFGU');QFGU=QFGU_8
   5942 
   5943          IF(IRET_PCCF.GT.0 .AND. IRET_PCCF.LT.13)  THEN
   5944 
   5945 C  For EUMETSAT (BUFR), if only four replications of PCCF/MAQC are
   5946 C   found in a report, it is prior to 6-4-2001 when only one EUMETSAT
   5947 C   Quality Index was calculated {using a forecast (first guess)
   5948 C   consistency test} {Note: JMA (BUFR) did not exist at this time}
   5949 C
   5950 C  For EUMETSAT (BUFR) or JMA (BUFR), if eight (EUMETSAT prior to
   5951 C   ?-?-2006) or twelve (JMA all dates or EUMETSAT after ?/?/2006)
   5952 C   replications of PCCF/MAQC are found in a report, it is after
   5953 C   6-4-2001 when EUMETSAT Quality Index with forecast (first guess)
   5954 C   consistency test, EUMETSAT Quality Index without forecast (first
   5955 C   guess) consistency test, and (for JMA all dates and EUMETSAT after
   5956 C   ?-?-2006 only) NESDIS Recursive Filter Function were calculated
   5957 C  -------------------------------------------------------------------
   5958 
   5959             IF(IRET_QFGU.GT.0)  THEN
   5960 
   5961 C  For EUMETSAT (BUFR), during the period from 6-4-2001 through
   5962 C   3-14-2005, QFGU and not GNAP was used to define whether or not the
   5963 C   EUMETSAT Quality Index was calculated with or without the forecast
   5964 C   (first guess) consistency test - take this into account
   5965 C   {Note: JMA (BUFR) did not exist at this time}
   5966 C  -------------------------------------------------------------------
   5967 
   5968                IF(QFGU(1).LT.BMISS)   THEN
   5969                   DO I=1,2  !  assume QFGU(1),(3),(5),(7) are the same
   5970                             !  and    QFGU(2),(4),(6),(8) are the same
   5971                      IF(NINT(QFGU(I)).EQ.0)  THEN
   5972                         GNAP(I) = 1.
   5973                      ELSE IF(NINT(QFGU(I)).EQ.1)  THEN
   5974                         GNAP(I) = 2.

Page 142         Source Listing                  R06UBF
2017-04-18 11:09                                 iw3unpbf.f

   5975                      ELSE
   5976                         GNAP(I) = BMISS
   5977                      END IF
   5978                   ENDDO
   5979                END IF
   5980             END IF
   5981                
   5982             IEND = IRET_PCCF/IVARS
   5983 
   5984 C  Assumption: If IVARS = 4:
   5985 C                If IEND = 2:     GNAP(1),(3),(5),(7) are the same
   5986 C                             and GNAP(2),(4),(6),(8) are the same
   5987 C                If IEND = 3:     GNAP(1),(4),(7),(10) are the same
   5988 C                                 GNAP(2),(5),(8),(11) are the same
   5989 C                             and GNAP(3),(6),(9),(12) are the same
   5990 C              If IVARS = 2:
   5991 C                If IEND = 3:     GNAP(1),(4) are the same
   5992 C                                 GNAP(2),(5) are the same
   5993 C                             and GNAP(3),(6) are the same
   5994 C                If IEND = 4:     GNAP(1),(4) are the same
   5995 C                                 GNAP(2),(5) are the same
   5996 C                                 GNAP(3),(6) are the same
   5997 C                             and GNAP(4),(8) are the same
   5998 
   5999             DO J = 1,IEND
   6000                IF(NINT(GNAP(J)).EQ.IQI .OR. IEND.EQ.1) THEN
   6001                   IF(MAX(PCCF(1,(IEND+J)-(IOFF*IEND)),
   6002      $                   PCCF(1,(2*IEND+J)-(IOFF*IEND))).LT.BMISS)
   6003      $             QI_with   = MIN(PCCF(1,(IEND+J)-(IOFF*IEND)),
   6004      $                             PCCF(1,(2*IEND+J)-(IOFF*IEND)))
   6005                   QC_QI_with = MAX(PCCF(2,(IEND+J)-(IOFF*IEND)),
   6006      $                             PCCF(2,(2*IEND+J)-(IOFF*IEND)))
   6007                ELSE IF(NINT(GNAP(J)).EQ.IQIwo) THEN
   6008                   IF(MAX(PCCF(1,(IEND+J)-(IOFF*IEND)),
   6009      $                   PCCF(1,(2*IEND+J)-(IOFF*IEND))).LT.BMISS)
   6010      $             QI_without   = MIN(PCCF(1,(IEND+J)-(IOFF*IEND)),
   6011      $                                PCCF(1,(2*IEND+J)-(IOFF*IEND)))
   6012                   QC_QI_without = MAX(PCCF(2,(IEND+J)-(IOFF*IEND)),
   6013      $                                PCCF(2,(2*IEND+J)-(IOFF*IEND)))
   6014                ELSE IF(NINT(GNAP(J)).EQ.IRFF) THEN
   6015                   IF(MAX(PCCF(1,(IEND+J)-(IOFF*IEND)),
   6016      $                   PCCF(1,(2*IEND+J)-(IOFF*IEND))).LT.BMISS)
   6017      $             RFF   = MIN(PCCF(1,(IEND+J)-(IOFF*IEND)),
   6018      $                         PCCF(1,(2*IEND+J)-(IOFF*IEND)))
   6019                   QC_RFF = MAX(PCCF(2,(IEND+J)-(IOFF*IEND)),
   6020      $                         PCCF(2,(2*IEND+J)-(IOFF*IEND)))
   6021                ELSE IF(NINT(GNAP(J)).EQ.IEE) THEN
   6022                   IF(MAX(PCCF(1,(IEND+J)-(IOFF*IEND)),
   6023      $                   PCCF(1,(2*IEND+J)-(IOFF*IEND))).LT.BMISS)
   6024      $             EE    = MIN(PCCF(1,(IEND+J)-(IOFF*IEND)),
   6025      $                         PCCF(1,(2*IEND+J)-(IOFF*IEND)))
   6026                   QC_EE  = MAX(PCCF(2,(IEND+J)-(IOFF*IEND)),
   6027      $                         PCCF(2,(2*IEND+J)-(IOFF*IEND)))
   6028                END IF
   6029             ENDDO
   6030 
   6031 C  EUMETSAT QI with forecast must be > LIMqi % for EUMETSAT/JMA/GOES/

Page 143         Source Listing                  R06UBF
2017-04-18 11:09                                 iw3unpbf.f

   6032 C   POES (MODIS, AVHRR or VIIRS), else flag (note: This should be moved
   6033 C   to prepdata)  ==> MAY NO LONGER BE NEEDED FOR NETs WHOSE GSI READS
   6034 C   SATWND DUMP DIRECTLY, RATHER THAN GETTING SATWND REPORTS OUT OF
   6035 C   PREPBUFR FILE
   6036 C  --------------------------------------------------------------------
   6037 
   6038             IF(WQM(1).EQ.2.AND.QI_with.LT.BMISS)  THEN
   6039                IF(NINT(QI_with).LE.LIMqi)  THEN
   6040                   WQM(1) = 13
   6041                   PQM(1) = 13
   6042                   ZQM(1) = 13
   6043                   TQM(1) = 13
   6044                   QQM(1) = 13
   6045                   KFLSAT(INDX) = KFLSAT(INDX) + 1
   6046                END IF
   6047             END IF
   6048 
   6049 C  Manual/automatic q.c. indicator must be < LIMqc, else flag
   6050 C  (note: This should be moved to prepdata)  ==> MAY NO LONGER BE
   6051 C  NEEDED FOR NETs WHOSE GSI READS SATWND DUMP DIRECTLY, RATHER THAN
   6052 C  GETTING SATWND REPORTS OUT OF PREPBUFR FILE
   6053 C  -----------------------------------------------------------------
   6054 
   6055             IF(WQM(1).EQ.2.AND.QC_QI_with.LT.BMISS)  THEN
   6056                IF(NINT(QC_QI_with).GE.LIMqc)  THEN
   6057                   WQM(1) = 13
   6058                   PQM(1) = 13
   6059                   ZQM(1) = 13
   6060                   TQM(1) = 13
   6061                   QQM(1) = 13
   6062                   KFLSAT(INDX+1) = KFLSAT(INDX+1) + 1
   6063                END IF
   6064             END IF
   6065 
   6066          END IF
   6067 
   6068 cpppppppppp
   6069 cc       if(wqm(1).lt.13)print'(" SID, QI_with, QC_QI_with = "A,
   6070 cc   $    2(1X,I0))', sid,nint(QI_with),nint(QC_QI_with)
   6071 cpppppppppp
   6072       END IF
   6073 CAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
   6074 CAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
   6075 
   6076 C  PUT THE UNPACKED REPORT INTO OBS
   6077 C  --------------------------------
   6078  
   6079       RSTP = IMISS
   6080       CALL S01UBF(SID,XOB,YOB,RHR,RCTIM,RSV1,RSV2,ELV,QMELV,ITP,RTP,
   6081      $ RSTP,IDS)
   6082       CALL S02UBF(6,1,*9999)

Page 144         Source Listing                  R06UBF
2017-04-18 11:09 Entry Points                    iw3unpbf.f



ENTRY POINTS

  Name               
                     
 r06ubf_             


SYMBOL CROSS REFERENCE

 Name                       Object Declared Type            Bytes Dimen Elements Attributes       References                        
                                                                                                                                    
 9997                       Label  6221                                                           6152                              
 9998                       Label  6218                                                           6152                              
 9999                       Label  6214                                                           6082,6100,6117,6134,6149,6152     
 ARR                        Local  5236     R(4)            4     1     10       SAVE             5763,5766,5772,5773,5778,5779,5783
                                                                                                  ,5784                             
 ARR_8                      Local  5233     R(8)            8     1     10       SAVE             5763                              
 BMISS                      Scalar 5217     R(8)            8           scalar   COM              5347,5348,5364,5369,5370,5374,5505
                                                                                                  ,5525,5528,5577,5635,5638,5664,571
                                                                                                  1,5737,5754,5756,5759,5765,5766,57
                                                                                                  77,5778,5783,5816,5830,5831,5832,5
                                                                                                  833,5834,5835,5836,5837,5968,5976,
                                                                                                  6002,6009,6016,6023,6038,6055,6093
                                                                                                  ,6095,6108,6112,6125,6129,6141,614
                                                                                                  4                                 
 C8                         Local  5230     CHAR            1     1     10       SAVE             5314,5655,5677                    
 CF8                        Scalar 5222     R(4)            4     1     255      COM              6097,6114,6131,6146               
 CMCM                       Local  5524     R(4)            4           scalar   SAVE             5524,5528,5634,5638               
 CPRDF                      Local  5230     CHAR            1     1     3        SAVE             5291,5598                         
 CPRDFN                     Local  5230     CHAR            1     1     51       SAVE             5292,5571                         
 CPROD                      Local  5230     CHAR            1     1     5        SAVE             5290,5588                         
 CSAT                       Local  5230     CHAR            1     1     499      SAVE             5254,5487                         
 DOB                        Scalar 5221     R(4)            4     1     255      COM              5815                              
 EE                         Local  5836     R(4)            4           scalar   SAVE             5836,6024,6141                    
 EEQF                       Local  6140     R(4)            4           scalar   SAVE             6140,6141,6144,6145               
 ELV                        Local  5755     R(4)            4           scalar   SAVE             5755,5757,5759,5789,6080          
 EQMUBF                     Func   5821     R(4)            4           scalar                    5821                              
 ES                         Local  5338     R(4)            4           scalar                    5339                              
 EXP                        Func   5338                                 scalar                    5338                              
 GCLONG                     Local  5513     R(4)            4           scalar   SAVE             5513                              
 GNAP                       Local  5236     R(4)            4     1     12       SAVE             5938,5972,5974,5976,6000,6007,6014
                                                                                                  ,6021                             
 GNAP_8                     Local  5232     R(8)            8     1     12       SAVE             5938                              
 HDR                        Local  5235     R(4)            4     1     20       SAVE             5360,5364,5367,5368,5370,5374     
 HDR_8                      Local  5232     R(8)            8     1     20       SAVE             5360,5362,5363,5366               
 HDSTR                      Local  5228     CHAR            80          scalar   SAVE             5241,5360                         
 HGHT                       Local  5753     R(4)            4           scalar   SAVE             5753,5754,5755                    
 HGTF                       Local  5333     R(4)            4           scalar                    5757                              
 I                          Local  5969     I(4)            4           scalar   SAVE             5969,5971,5972,5973,5974,5976     
 IDENSITY                   Local  5485     I(4)            4           scalar   SAVE             5485,5499,5501,5562               
 IDS                        Local  5373     I(4)            4           scalar   SAVE             5373,5374,5486,5487,5495,5588,5593
                                                                                                  ,5611,5612,5613,5614,5698,6081,615
                                                                                                  9,6160,6161,6173,6174,6175,6187,61
                                                                                                  88,6189,6190,6191,6203,6204,6205  
 IEE                        Local  5892     I(4)            4           scalar   SAVE             5892,5904,5915,5929,6021          

Page 145         Source Listing                  R06UBF
2017-04-18 11:09 Symbol Table                    iw3unpbf.f

 Name                       Object Declared Type            Bytes Dimen Elements Attributes       References                        
                                                                                                                                    
 IEND                       Local  5982     I(4)            4           scalar   SAVE             5982,5999,6000,6001,6002,6003,6004
                                                                                                  ,6005,6006,6008,6009,6010,6011,601
                                                                                                  2,6013,6015,6016,6017,6018,6019,60
                                                                                                  20,6022,6023,6024,6025,6026,6027  
 IFLSAT                     Scalar 5225     I(4)            4           scalar   COM              5353                              
 IMISS                      Local  5244     I(4)            4           scalar   SAVE             5244,5373,5420,6079,6098,6099,6115
                                                                                                  ,6116,6132,6133,6147,6148,6159,617
                                                                                                  3,6187,6203                       
 INDX                       Local  5849     I(4)            4           scalar   SAVE             5849,5862,5873,5886,5898,5909,5923
                                                                                                  ,6045,6062                        
 INT                        Func   5567                                 scalar                    5567                              
 INUM1                      Local  5596     I(4)            4           scalar   SAVE             5596,5598,5599                    
 INUM2                      Local  5570     I(4)            4           scalar   SAVE             5570,5571                         
 IOFF                       Local  5850     I(4)            4           scalar   SAVE             5850,5863,5875,5888,5900,5911,5925
                                                                                                  ,6001,6002,6003,6004,6005,6006,600
                                                                                                  8,6009,6010,6011,6012,6013,6015,60
                                                                                                  16,6017,6018,6019,6020,6022,6023,6
                                                                                                  024,6025,6026,6027                
 IPRDF                      Local  5231     I(4)            4     1     3        SAVE             5294,5599                         
 IPRODUCER                  Local  5484     I(4)            4           scalar   SAVE             5484,5521,5594,5611,5612,5613,5614
 IQI                        Local  5852     I(4)            4           scalar   SAVE             5852,5865,5876,5889,5901,5912,5926
                                                                                                  ,6000                             
 IQIWO                      Local  5853     I(4)            4           scalar   SAVE             5853,5866,5877,5890,5902,5913,5927
                                                                                                  ,6007                             
 IRET                       Local  5349     I(4)            4           scalar   SAVE             5349,5350,5360,5504,5512,5523,5524
                                                                                                  ,5543,5545,5564,5576,5602,5633,563
                                                                                                  4,5663,5666,5684,5712,5730,5753,57
                                                                                                  63,5791,5808,5818,5820,6092,6107,6
                                                                                                  124,6140                          
 IRET_GNAP                  Local  5938     I(4)            4           scalar   SAVE             5938                              
 IRET_PCCF                  Local  5939     I(4)            4           scalar   SAVE             5939,5943,5982                    
 IRET_QFGU                  Local  5941     I(4)            4           scalar   SAVE             5941,5959                         
 IRFF                       Local  5854     I(4)            4           scalar   SAVE             5854,5867,5878,5891,5903,5914,5928
                                                                                                  ,6014                             
 ISWCM                      Local  5231     I(4)            4     3     20       SAVE             5296,5562                         
 ISWDL                      Local  5231     I(4)            4     1     7        SAVE             5322,5581,5605,5669,5687          
 ITMP                       Local  5779     I(4)            4           scalar   SAVE             5779,5780,5784,5785               
 ITP                        Local  5420     I(4)            4           scalar   SAVE             5420,5526,5534,5536,5538,5540,5562
                                                                                                  ,5563,5567,5573,5599,5611,5612,561
                                                                                                  3,5614,5636,5644,5646,5648,5650,56
                                                                                                  56,5678,6080                      
 ITP_C8                     Local  5231     I(4)            4     1     10       SAVE             5315,5656,5678                    
 IUBFAA                     Common 5217                                 8        SAVE                                               
 IUBFBB                     Common 5218                                 100      SAVE                                               
 IUBFCC                     Common 5220                                 8        SAVE                                               
 IUBFEE                     Common 5221                                 9180     SAVE                                               
 IUBFFF                     Common 5223                                 5100     SAVE                                               
 IUBFKK                     Common 5224                                 72812    SAVE                                               
 IUBFLL                     Common 5226                                 2040     SAVE                                               
 IVARS                      Local  5851     I(4)            4           scalar   SAVE             5851,5864,5874,5887,5899,5910,5924
                                                                                                  ,5982                             
 J                          Local  5999     I(4)            4           scalar   SAVE             5999,6000,6001,6002,6003,6004,6005
                                                                                                  ,6006,6007,6008,6009,6010,6011,601
                                                                                                  2,6013,6014,6015,6016,6017,6018,60
                                                                                                  19,6020,6021,6022,6023,6024,6025,6

Page 146         Source Listing                  R06UBF
2017-04-18 11:09 Symbol Table                    iw3unpbf.f

 Name                       Object Declared Type            Bytes Dimen Elements Attributes       References                        
                                                                                                                                    
                                                                                                  026,6027                          
 JTP                        Local  5731     I(4)            4           scalar   SAVE             5731,5733,5737                    
 K                          Local  5654     I(4)            4           scalar   SAVE             5654,5655,5656,5676,5677,5678     
 KFLSAT                     Scalar 5218     I(4)            4     1     12       COM              6045,6062                         
 KNDX                       Scalar 5218     I(4)            4           scalar   COM                                                
 KNTAVHRR                   Scalar 5225     I(4)            4     1     222      COM              6191,6193                         
 KNTMODIS                   Scalar 5224     I(4)            4     1     3        COM              6175,6177                         
 KNTSAT                     Scalar 5224     I(4)            4     1     11       COM              6161,6163                         
 KNTVIIRS                   Scalar 5225     I(4)            4     1     2        COM              6205,6207                         
 KOUNT                      Scalar 5224     I(4)            4     3     17964    COM              5612,5613,5614                    
 KSKACF                     Scalar 5218     I(4)            4     1     8        COM                                                
 KSKSAT                     Scalar 5218     I(4)            4           scalar   COM              5746,6223                         
 KSKSFC                     Scalar 5218     I(4)            4           scalar   COM                                                
 KSKSMI                     Scalar 5219     I(4)            4           scalar   COM                                                
 KSKUPA                     Scalar 5218     I(4)            4           scalar   COM                                                
 KTP                        Local  5809     I(4)            4           scalar   SAVE             5809,5811,5815,5816               
 LIMQC                      Local  5859     I(4)            4           scalar   SAVE             5859,5869,5880,5894,5906,5920,5934
                                                                                                  ,6056                             
 LIMQI                      Local  5856     I(4)            4           scalar   SAVE             5856,5868,5879,5893,5905,5917,5931
                                                                                                  ,6039                             
 LUNIT                      Dummy  5214     I(4)            4           scalar   ARG,INOUT        5349,5350,5360,5361,5504,5512,5523
                                                                                                  ,5524,5543,5545,5564,5576,5602,563
                                                                                                  3,5634,5663,5666,5684,5712,5753,57
                                                                                                  63,5791,5818,5938,5939,5941,6092,6
                                                                                                  107,6124,6140                     
 LVSTR                      Local  5228     CHAR            80          scalar   SAVE             5242,5763                         
 MAX                        Func   5766                                 scalar                    5766,6001,6005,6008,6012,6015,6019
                                                                                                  ,6022,6026                        
 MIN                        Func   5613                                 scalar                    5613,5816,6003,6010,6017,6024     
 MOD                        Func   5598                                 scalar                    5598,5599                         
 NINT                       Func   5365                                 scalar                    5365,5370,5374,5508,5509,5526,5554
                                                                                                  ,5556,5559,5560,5562,5580,5581,558
                                                                                                  4,5585,5604,5605,5607,5608,5636,56
                                                                                                  68,5669,5672,5673,5686,5687,5689,5
                                                                                                  690,5737,5742,5773,5779,5780,5784,
                                                                                                  5785,5971,5973,6000,6007,6014,6021
                                                                                                  ,6039,6056,6096,6113,6130,6145    
 NOBS3                      Dummy  5214     I(4)            4     1     7        ARG,INOUT                                          
 NRCT                       Local  5361     I(4)            4           scalar   SAVE             5361                              
 OB8                        Scalar 5222     R(4)            4     1     255      COM              6096,6113,6130,6145               
 OBS                        Dummy  5214     R(4)            4     1     0        ARG,INOUT        6152                              
 OBS2                       Dummy  5214     R(4)            4     1     43       ARG,INOUT        5351                              
 OBS2_8                     Local  5233     R(8)            8     1     43       SAVE             5347,5349,5350,5351               
 OBS3                       Dummy  5214     R(4)            4     3     8925     ARG,INOUT                                          
 OBS3_8                     Local  5233     R(8)            8     3     8925     SAVE                                               
 OBS8_8                     Dummy  5214     R(8)            8     1     2        ARG,INOUT        5348,5362,5363                    
 PCCF                       Local  5236     R(4)            4     2     24       SAVE             5940,6001,6002,6003,6004,6005,6006
                                                                                                  ,6008,6009,6010,6011,6012,6013,601
                                                                                                  5,6016,6017,6018,6019,6020,6022,60
                                                                                                  23,6024,6025,6026,6027            
 PCCF_8                     Local  5232     R(8)            8     2     24       SAVE             5939,5940                         
 POB                        Scalar 5221     R(4)            4     1     255      COM              5711,5737,5742,5756,5757,5766,5772
 PQM                        Scalar 5223     R(4)            4     1     255      COM              5822,6041,6058                    
 PRLC                       Local  5236     R(4)            4     1     11       SAVE             5712,5737                         
 PRLC_8                     Local  5233     R(8)            8     1     11       SAVE             5712                              

Page 147         Source Listing                  R06UBF
2017-04-18 11:09 Symbol Table                    iw3unpbf.f

 Name                       Object Declared Type            Bytes Dimen Elements Attributes       References                        
                                                                                                                                    
 Q81                        Scalar 5226     R(4)            4     1     255      COM              6098,6115,6132,6147               
 Q82                        Scalar 5226     R(4)            4     1     255      COM              6099,6116,6133,6148               
 QC_EE                      Local  5837     R(4)            4           scalar   SAVE             5837,6026                         
 QC_QI_WITH                 Local  5831     R(4)            4           scalar   SAVE             5831,6005,6055,6056               
 QC_QI_WITHOUT              Local  5833     R(4)            4           scalar   SAVE             5833,6012                         
 QC_RFF                     Local  5835     R(4)            4           scalar   SAVE             5835,6019                         
 QFGU                       Local  5236     R(4)            4     1     8        SAVE             5941,5968,5971,5973               
 QFGU_8                     Local  5234     R(8)            8     1     8        SAVE             5941                              
 QFRMTP                     Local  5339     R(4)            4           scalar                    5772                              
 QIFN                       Local  6124     R(4)            4           scalar   SAVE             6124,6125,6129,6130               
 QIFY                       Local  6107     R(4)            4           scalar   SAVE             6107,6108,6112,6113               
 QI_WITH                    Local  5830     R(4)            4           scalar   SAVE             5830,6003,6038,6039,6108          
 QI_WITHOUT                 Local  5832     R(4)            4           scalar   SAVE             5832,6010,6125                    
 QMELV                      Local  5761     R(4)            4           scalar   SAVE             5761,6080                         
 QMSTR                      Local  5228     CHAR            80          scalar   SAVE                                               
 QOB                        Scalar 5221     R(4)            4     1     255      COM              5765,5774                         
 QQ                         Local  5772     R(4)            4           scalar   SAVE             5772,5773,5774                    
 QQM                        Scalar 5223     R(4)            4     1     255      COM              5824,6044,6061                    
 R06UBF                     Func   5214     R(4)            4           scalar                    5341,5745,6215,6222               
 R06UBF@0                   Local  5214     R(4)            4           scalar   SAVE                                               
 RCSTR                      Local  5228     CHAR            80          scalar   SAVE             5243,5361                         
 RCT                        Local  5236     R(4)            4     1     5        SAVE             5361,5365                         
 RCTIM                      Local  5365     R(4)            4           scalar   SAVE             5365,6080                         
 RCT_8                      Local  5232     R(8)            8     1     5        SAVE             5361                              
 RFF                        Local  5834     R(4)            4           scalar   SAVE             5834,6017,6093                    
 RFFL                       Local  6092     R(4)            4           scalar   SAVE             6092,6093,6095,6096               
 RHR                        Local  5369     R(4)            4           scalar   SAVE             5369,5370,6080                    
 RID_8                      Local  5232     R(8)            8           scalar   SAVE             5366                              
 RSTP                       Local  6079     R(4)            4           scalar   SAVE             6079,6081                         
 RSV1                       Local  5229     CHAR            8           scalar   SAVE             5371,5509,5510,5518,5519,5585,5595
                                                                                                  ,5608,5624,5673,5690,6080         
 RSV2                       Local  5229     CHAR            8           scalar   SAVE             5372,6080                         
 RTP                        Local  5706     R(4)            4           scalar   SAVE             5706,6080                         
 S01UBF                     Subr   6080                                                           6080                              
 S02UBF                     Subr   6082                                                           6082,6100,6117,6134,6149          
 S03UBF                     Subr   6152                                                           6152                              
 S05UBF                     Subr   5355                                                           5355                              
 SCCF                       Local  5565     R(4)            4           scalar   SAVE             5565,5566,5567                    
 SID                        Local  5229     CHAR            8           scalar   SAVE             5422,5483,5487,5495,5496,5510,5519
                                                                                                  ,5571,5572,5573,5588,5593,5595,559
                                                                                                  8,5614,5624,5626,5655,5677,5698,57
                                                                                                  44,6080,6220                      
 SIDP                       Local  5546     R(4)            4           scalar   SAVE             5546,5554,5555,5556,5557,5560,5562
 SOB                        Scalar 5222     R(4)            4     1     255      COM              5816                              
 SUBSET                     Scalar 5220     CHAR            8           scalar   COM              5495,5497,5498,5533,5535,5537,5539
                                                                                                  ,5570,5593,5596,5627,5628,5629,563
                                                                                                  0,5643,5645,5647,5649,5839,5840,58
                                                                                                  41,5842,5843,5844,5845,5846,5848,5
                                                                                                  861,5871,5882,5883,5896,5908,5922,
                                                                                                  6152,6154,6168,6182,6198          
 SWCM                       Local  5544     R(4)            4           scalar   SAVE             5544,5559,5562,5580,5581,5603,5604
                                                                                                  ,5605,5667,5668,5669,5685,5686,568
                                                                                                  7                                 
 SWDL                       Local  5576     R(4)            4           scalar   SAVE             5576,5577,5581,5584,5585,5605,5607
                                                                                                  ,5608,5663,5664,5669,5672,5673,568

Page 148         Source Listing                  R06UBF
2017-04-18 11:09 Symbol Table                    iw3unpbf.f

 Name                       Object Declared Type            Bytes Dimen Elements Attributes       References                        
                                                                                                                                    
                                                                                                  7,5689,5690                       
 SWPR                       Local  5504     R(4)            4           scalar   SAVE             5504,5505,5508,5509               
 SWQM                       Local  5818     R(4)            4           scalar   SAVE             5818,5821                         
 SWTP                       Local  5523     R(4)            4           scalar   SAVE             5523,5525,5526,5633,5635,5636     
 TOB                        Scalar 5221     R(4)            4     1     255      COM              5777,5780,5785                    
 TQM                        Scalar 5223     R(4)            4     1     255      COM              5823,6043,6060                    
 UFBINT                     Subr   5349                                                           5349,5350,5360,5361,5504,5512,5523
                                                                                                  ,5524,5543,5545,5564,5576,5602,563
                                                                                                  3,5634,5663,5666,5684,5753,5763,58
                                                                                                  18,6092,6107,6124,6140            
 UFBINT_8                   Local  5232     R(8)            8           scalar   SAVE             5504,5512,5513,5523,5524,5543,5544
                                                                                                  ,5545,5546,5564,5565,5576,5602,560
                                                                                                  3,5633,5634,5663,5666,5667,5684,56
                                                                                                  85,5753,5818,6092,6107,6124,6140  
 UFBREP                     Subr   5712                                                           5712,5791,5938,5939,5941          
 VSG                        Scalar 5222     R(4)            4     1     255      COM                                                
 WIND                       Local  5236     R(4)            4     2     10       SAVE             5791,5815,5816                    
 WIND_8                     Local  5233     R(8)            8     2     10       SAVE             5791                              
 WQM                        Scalar 5223     R(4)            4     1     255      COM              5821,6038,6040,6055,6057          
 XMISS                      Local  5244     R(4)            4           scalar   SAVE             5244,5761                         
 XOB                        Local  5367     R(4)            4           scalar   SAVE             5367,6080                         
 YOB                        Local  5368     R(4)            4           scalar   SAVE             5368,6080                         
 ZOB                        Scalar 5221     R(4)            4     1     255      COM              5789                              
 ZQM                        Scalar 5223     R(4)            4     1     255      COM              5825,6042,6059                    

Page 149         Source Listing                  R06UBF
2017-04-18 11:09                                 iw3unpbf.f

   6083  
   6084 C  ------------------------------------------------------------------
   6085 C  MISC DATA GOES INTO DATA LEVEL CATEGORY 08
   6086 C  ------------------------------------------------------------------
   6087 
   6088 C  CODE FIGURE 355 - PERCENT CONFIDENCE BASED ON NESDIS RECURSIVE
   6089 C   FILTER FUNCTION
   6090 C  --------------------------------------------------------------
   6091 
   6092       CALL UFBINT(LUNIT,UFBINT_8,1,1,IRET,'RFFL');RFFL=UFBINT_8
   6093       IF(RFFL.GE.BMISS) RFFL = RFF  ! RFFL missing for all types except
   6094                                     !  NESDIS GOES winds from server
   6095       IF(RFFL.LT.BMISS) THEN
   6096          OB8(1) = NINT(RFFL)
   6097          CF8(1) = 355
   6098          Q81(1) = IMISS
   6099          Q82(1) = IMISS
   6100          CALL S02UBF(8,1,*9999)
   6101       END IF
   6102 
   6103 C  CODE FIGURE 356 - PERCENT CONFIDENCE BASED ON EUMETSAT QUALITY
   6104 C   INDEX WITH FCST CONSISTENCY TEST
   6105 C  --------------------------------------------------------------
   6106 
   6107       CALL UFBINT(LUNIT,UFBINT_8,1,1,IRET,'QIFY');QIFY=UFBINT_8
   6108       IF(QIFY.GE.BMISS) QIFY = QI_with ! QIFY missing for all types
   6109                                        ! except NESDIS GOES winds from
   6110                                        ! server and possibly MODIS
   6111                                        ! winds from server
   6112       IF(QIFY.LT.BMISS) THEN
   6113          OB8(1) = NINT(QIFY)
   6114          CF8(1) = 356
   6115          Q81(1) = IMISS
   6116          Q82(1) = IMISS
   6117          CALL S02UBF(8,1,*9999)
   6118       END IF
   6119 
   6120 C  CODE FIGURE 357 - PERCENT CONFIDENCE BASED ON EUMETSAT QUALITY
   6121 C   INDEX W/O FCST CONSISTENCY TEST
   6122 C  --------------------------------------------------------------
   6123 
   6124       CALL UFBINT(LUNIT,UFBINT_8,1,1,IRET,'QIFN');QIFN=UFBINT_8
   6125       IF(QIFN.GE.BMISS) QIFN = QI_without ! QIFN missing for all types
   6126                                           ! except NESDIS GOES winds
   6127                                           ! from server and possibly
   6128                                           ! MODIS winds from server
   6129       IF(QIFN.LT.BMISS) THEN
   6130          OB8(1) = NINT(QIFN)
   6131          CF8(1) = 357
   6132          Q81(1) = IMISS
   6133          Q82(1) = IMISS
   6134          CALL S02UBF(8,1,*9999)
   6135       END IF
   6136 
   6137 C  CODE FIGURE 358 - PERCENT CONFIDENCE BASED ON NESDIS EXPECTED ERROR
   6138 C  -------------------------------------------------------------------
   6139 

Page 150         Source Listing                  R06UBF
2017-04-18 11:09                                 iw3unpbf.f

   6140       CALL UFBINT(LUNIT,UFBINT_8,1,1,IRET,'EEQF');EEQF=UFBINT_8
   6141       IF(EEQF.GE.BMISS) EEQF = EE ! EEQF missing for all types except
   6142                                   ! NESDIS GOES winds from server and
   6143                                   ! possibly MODIS winds from server
   6144       IF(EEQF.LT.BMISS) THEN
   6145          OB8(1) = NINT(EEQF)
   6146          CF8(1) = 358
   6147          Q81(1) = IMISS
   6148          Q82(1) = IMISS
   6149          CALL S02UBF(8,1,*9999)
   6150       END IF
   6151 
   6152       CALL S03UBF(OBS,SUBSET,*9999,*9998,*9997)
   6153 
   6154       IF(SUBSET(7:8).LT.'21') THEN
   6155 
   6156 C  KEEP TRACK OF NESDIS GOES SATELLITE WIND COUNTS BY SATELLITE ID
   6157 C  ---------------------------------------------------------------
   6158 
   6159          IF(IDS.LT.IMISS)  THEN
   6160             IF(IDS.GT.249.AND.IDS.LT.260)  THEN
   6161                KNTSAT(IDS) = KNTSAT(IDS) + 1
   6162             ELSE
   6163                KNTSAT(260) = KNTSAT(260) + 1
   6164             END IF
   6165          END IF
   6166       END IF
   6167 
   6168       IF(SUBSET(7:8).EQ.'70'.OR.SUBSET(7:8).EQ.'71') THEN
   6169 
   6170 C  KEEP TRACK OF NASA/MODIS POES SATELLITE WIND COUNTS BY SATELLITE ID
   6171 C  -------------------------------------------------------------------
   6172 
   6173          IF(IDS.LT.IMISS)  THEN
   6174             IF(IDS.GT.782.AND.IDS.LT.785)  THEN
   6175                KNTMODIS(IDS) = KNTMODIS(IDS) + 1
   6176             ELSE
   6177                KNTMODIS(785) = KNTMODIS(785) + 1
   6178             END IF
   6179          END IF
   6180       END IF
   6181  
   6182       IF(SUBSET(7:8).EQ.'80') THEN
   6183 
   6184 C  KEEP TRACK OF NESDIS/AVHRR POES SATELLITE WIND COUNTS BY SATELLITE ID
   6185 C  ---------------------------------------------------------------------
   6186 
   6187          IF(IDS.LT.IMISS)  THEN
   6188             IF((IDS.GT.  2.AND.IDS.LT.  6) .OR.
   6189      $         (IDS.GT.199.AND.IDS.LT.210) .OR.
   6190      $         (IDS.EQ.223)) THEN
   6191                KNTavhrr(IDS) = KNTavhrr(IDS) + 1
   6192             ELSE
   6193                KNTavhrr(224) = KNTavhrr(224) + 1
   6194             END IF
   6195          END IF
   6196       END IF

Page 151         Source Listing                  R06UBF
2017-04-18 11:09                                 iw3unpbf.f

   6197  
   6198       IF(SUBSET(7:8).EQ.'90') THEN
   6199 
   6200 C  KEEP TRACK OF NASA/VIIRS POES SATELLITE WIND COUNTS BY SATELLITE ID
   6201 C  -------------------------------------------------------------------
   6202 
   6203          IF(IDS.LT.IMISS)  THEN
   6204             IF(IDS.EQ.224)  THEN
   6205                KNTviirs(IDS) = KNTviirs(IDS) + 1
   6206             ELSE
   6207                KNTviirs(225) = KNTviirs(225) + 1
   6208             END IF
   6209          END IF
   6210       END IF
   6211  
   6212       RETURN
   6213 
   6214  9999 CONTINUE
   6215       R06UBF = 999
   6216       RETURN
   6217 
   6218  9998 CONTINUE
   6219       print'(" IW3UNPBF/R06UBF: RPT with ID= ",A," TOSSED - ZERO ",
   6220      $ "CAT.1-6,51 LVLS")', SID
   6221  9997 CONTINUE
   6222       R06UBF = -9999
   6223       KSKSAT =KSKSAT + 1
   6224       RETURN
   6225 
   6226       END
   6227 C***********************************************************************
   6228 C***********************************************************************
   6229 C***********************************************************************
   6230       FUNCTION R07UBF(LUNIT,OBS,OBS2,OBS3,NOBS3,obs8_8)
   6231 C     ---> PROCESSES REPROCESSED SSM/I (SPSSMI) DATA (012/*)
   6232 
   6233       COMMON/IUBFAA/BMISS
   6234       COMMON/IUBFBB/KNDX,KSKACF(8),KSKUPA,KSKSFC,KSKSAT,KFLSAT(12),
   6235      $ KSKSMI
   6236       COMMON/IUBFCC/SUBSET
   6237       COMMON/IUBFEE/POB(255),QOB(255),TOB(255),ZOB(255),DOB(255),
   6238      $              SOB(255),VSG(255),OB8(255),CF8(255)
   6239       COMMON/IUBFLL/Q81(255),Q82(255)
   6240 
   6241       CHARACTER*80 HDSTR
   6242       CHARACTER*8  SUBSET,SID,RSV1,RSV2
   6243       REAL(8) RID_8,UFBINT_8,OBS2_8(43),OBS3_8(5,255,7),HDR_8(20),
   6244      $ PROD_8(2,2),ADDP_8(5),TMBRS_8(2,14),TMBR_8(7),BMISS,AMINIMUM_8,
   6245      $ obs8_8(2)
   6246       DIMENSION    OBS(*),OBS2(43),OBS3(5,255,7),NOBS3(7),HDR(20),
   6247      $ PROD(2,2),ADDP(5),TMBRS(2,14),TMBR(7)
   6248       EQUIVALENCE  (RID_8,SID)
   6249 
   6250       SAVE
   6251 
   6252       DATA HDSTR/'RPID CLON CLAT HOUR MINU SECO NMCT SAID ACAV'/
   6253 

Page 152         Source Listing                  R07UBF
2017-04-18 11:09                                 iw3unpbf.f

   6254       DATA IMISS/99999/,XMISS/99999./
   6255 
   6256       R07UBF = 0
   6257 
   6258 C  STORE SINGLE LEVEL REPORT DATA DIRECTLY INTO OBS2 ARRAY AND
   6259 C   DOUBLE-PRECISION SINGLE LEVEL REPORT DATA DIRECTLY INTO OBS8_8 ARRAY
   6260 C  ---------------------------------------------------------------------
   6261 
   6262       OBS2_8 = BMISS
   6263       obs8_8 = bmiss
   6264       CALL UFBINT(LUNIT,OBS2_8,2,1,IRET,'RSRD EXPRSRD');OBS2=OBS2_8
   6265 
   6266       CALL S05UBF
   6267 
   6268 C  PUT THE HEADER INFORMATION INTO UNPACKED FORMAT
   6269 C  -----------------------------------------------
   6270 
   6271       CALL UFBINT(LUNIT,HDR_8,20,  1,IRET,HDSTR);HDR(2:)=HDR_8(2:)
   6272       IF(HDR(5).GE.BMISS) HDR(5) = 0
   6273       IF(HDR(6).GE.BMISS) HDR(6) = 0
   6274       obs8_8(1) = hdr_8(3)
   6275       obs8_8(2) = hdr_8(2)
   6276       RID_8 = HDR_8(1)
   6277       XOB   = HDR(2)
   6278       YOB   = HDR(3)
   6279       RHR   = BMISS
   6280       IF(HDR(4).LT.BMISS) RHR = (NINT(HDR(4)) + ((NINT(HDR(5)) * 60.) +
   6281 cvvvvvdak port
   6282 cdak $  NINT(HDR(6)))/3600.) + 0.0000000001  ! orig
   6283 cdak $  NINT(HDR(6)))/3600.) + 0.0001        ! then changed to this
   6284 caaaaadak port
   6285      $  NINT(HDR(6)))/3600.)   ! don't make this adjustment now that we
   6286                                ! store obs time to 10**5 in PREPBUFR
   6287       RSV1  = '        '
   6288       RSV2  = '        '
   6289 
   6290 C  FOR SUPEROBS, THE NUMBER OF ORIGINAL RETRIEVALS THAT WENT INTO
   6291 C   MAKING THE SUPEROB IS STORED IN BYTES 1-3 OF HEADER RESERVE
   6292 C   CHARACTER WORD 1 (FOR NONSUPEROBS THE VALUE HERE IS ALWAYS 1)
   6293 C  --------------------------------------------------------------
   6294 
   6295       IF(HDR(9).LT.BMISS)  WRITE(RSV1(1:3),'(I3.3)')  NINT(HDR(9))
   6296 
   6297       ITP = IMISS
   6298       RTP = HDR(7)
   6299 
   6300 C  CHECK ON VALUE FOR SATELLITE ID TO DETERMINE IF THIS IS A SUPEROB
   6301 C   (SATELLITE ID IS MISSING FOR SUPEROBS)
   6302 C  -----------------------------------------------------------------
   6303 
   6304       ISUPOB = 1
   6305       IDS = IMISS
   6306       IF(HDR(8).LT.BMISS)  THEN
   6307          IDS = NINT(HDR(8))
   6308          ISUPOB = 0
   6309       END IF
   6310 

Page 153         Source Listing                  R07UBF
2017-04-18 11:09                                 iw3unpbf.f

   6311       RCTIM = BMISS
   6312       ELV   = BMISS
   6313       QMELV = XMISS
   6314       IF(RTP.EQ.571.OR.RTP.EQ.65..OR.RTP.EQ.66.OR.RTP.EQ.69)  ELV = 0
   6315       RSTP  = IMISS
   6316       CALL S01UBF(SID,XOB,YOB,RHR,RCTIM,RSV1,RSV2,ELV,QMELV,ITP,RTP,
   6317      $ RSTP,IDS)
   6318 
   6319 C  PUT THE SSM/I DATA INTO SPECIFIED UNPACKED DATA LEVEL CATEGORY 8 FMT
   6320 C    - INDICATOR 1 HOLDS STANDARD DEV. OF VALUE (FOR SUPEROBS)
   6321 C    - INDICATOR 2 HOLDS QUALITY MARKER OF VALUE (RAIN FLAG) (WSDP,TPW)
   6322 C  --------------------------------------------------------------------
   6323 
   6324       IF(RTP.EQ.571)  THEN
   6325 C  ---------------------------------------------------------------------
   6326 C        ** OCEAN SURFACE WIND SPEED PRODUCT -- DUMP REPORT TYPE 571 **
   6327 C  ---------------------------------------------------------------------
   6328 C  CODE FIGURE 196 - OCEANIC WIND SPEED (M/SEC TO 10**1 PRECISION)
   6329 C  ---------------------------------------------------------------------
   6330          CF8(1) = 196
   6331          IF(ISUPOB.EQ.1)  THEN
   6332             CALL UFBREP(LUNIT,PROD_8,2,2,IRET,'FOST WSPD')
   6333             AMINIMUM_8 = MIN(PROD_8(2,1),PROD_8(2,2))
   6334             IF(IBFMS(AMINIMUM_8).NE.0)
   6335      $       CALL UFBREP(LUNIT,PROD_8,2,2,IRET,'FOST WSOS')
   6336             PROD=PROD_8
   6337 C For SUPEROBs, replication is such that first WSPD/WSOS is always mean
   6338 C  value (FOST=4) and second WSPD/WSOS is always standard deviation
   6339 C  (FOST=10)
   6340             OB8(1) = PROD(2,1)
   6341             Q81(1) = PROD(2,2)
   6342          ELSE
   6343             CALL UFBINT(LUNIT,UFBINT_8,1,1,IRET,'WSPD')
   6344             IF(IBFMS(UFBINT_8).NE.0)
   6345      $       CALL UFBINT(LUNIT,UFBINT_8,1,1,IRET,'WSOS')
   6346             PRODN=UFBINT_8
   6347             OB8(1) = PRODN
   6348             CALL UFBINT(LUNIT,UFBINT_8,1,1,IRET,'RFLG');RFLG=UFBINT_8
   6349             Q82(1) = MIN(NINT(RFLG),IMISS)
   6350          END IF
   6351          CALL S02UBF(8,1,*9999)

Page 154         Source Listing                  R07UBF
2017-04-18 11:09 Entry Points                    iw3unpbf.f



ENTRY POINTS

  Name               
                     
 r07ubf_             


SYMBOL CROSS REFERENCE

 Name                       Object Declared Type            Bytes Dimen Elements Attributes       References                        
                                                                                                                                    
 9997                       Label  6577                                                           6568                              
 9998                       Label  6574                                                           6568                              
 9999                       Label  6571                                                           6351,6379,6401,6408,6427,6464,6482
                                                                                                  ,6500,6518,6544,6562,6568         
 ADDP                       Local  6247     R(4)            4     1     5        SAVE             6422,6424,6425                    
 ADDP_8                     Local  6244     R(8)            8     1     5        SAVE             6421,6422                         
 AMINIMUM_8                 Local  6244     R(8)            8           scalar   SAVE             6333,6334,6361,6362,6448,6449,6528
                                                                                                  ,6529                             
 BMISS                      Scalar 6233     R(8)            8           scalar   COM              6262,6263,6272,6273,6279,6280,6295
                                                                                                  ,6306,6311,6312,6424              
 CF8                        Scalar 6238     R(4)            4     1     255      COM              6330,6358,6399,6407,6426,6445,6471
                                                                                                  ,6489,6507,6525,6551              
 DOB                        Scalar 6237     R(4)            4     1     255      COM                                                
 ELV                        Local  6312     R(4)            4           scalar   SAVE             6312,6314,6316                    
 HDR                        Local  6246     R(4)            4     1     20       SAVE             6271,6272,6273,6277,6278,6280,6285
                                                                                                  ,6295,6298,6306,6307              
 HDR_8                      Local  6243     R(8)            8     1     20       SAVE             6271,6274,6275,6276               
 HDSTR                      Local  6241     CHAR            80          scalar   SAVE             6252,6271                         
 IBFMS                      Func   6334     I(4)            4           scalar                    6334,6344,6362,6372,6449,6459,6529
                                                                                                  ,6539                             
 IDS                        Local  6305     I(4)            4           scalar   SAVE             6305,6307,6317                    
 IMISS                      Local  6254     I(4)            4           scalar   SAVE             6254,6297,6305,6315,6349,6377     
 IRET                       Local  6264     I(4)            4           scalar   SAVE             6264,6271,6332,6335,6343,6345,6348
                                                                                                  ,6360,6363,6371,6373,6376,6393,642
                                                                                                  1,6447,6450,6458,6460,6473,6479,64
                                                                                                  91,6497,6509,6515,6527,6530,6538,6
                                                                                                  540,6553,6559                     
 ISUPOB                     Local  6304     I(4)            4           scalar   SAVE             6304,6308,6331,6359,6392,6446,6472
                                                                                                  ,6490,6508,6526,6552              
 ITP                        Local  6297     I(4)            4           scalar   SAVE             6297,6316                         
 IUBFAA                     Common 6233                                 8        SAVE                                               
 IUBFBB                     Common 6234                                 100      SAVE                                               
 IUBFCC                     Common 6236                                 8        SAVE                                               
 IUBFEE                     Common 6237                                 9180     SAVE                                               
 IUBFLL                     Common 6239                                 2040     SAVE                                               
 KFLSAT                     Scalar 6234     I(4)            4     1     12       COM                                                
 KNDX                       Scalar 6234     I(4)            4           scalar   COM                                                
 KSKACF                     Scalar 6234     I(4)            4     1     8        COM                                                
 KSKSAT                     Scalar 6234     I(4)            4           scalar   COM                                                
 KSKSFC                     Scalar 6234     I(4)            4           scalar   COM                                                
 KSKSMI                     Scalar 6235     I(4)            4           scalar   COM              6579                              
 KSKUPA                     Scalar 6234     I(4)            4           scalar   COM                                                
 LUNIT                      Dummy  6230     I(4)            4           scalar   ARG,INOUT        6264,6271,6332,6335,6343,6345,6348
                                                                                                  ,6360,6363,6371,6373,6376,6393,640

Page 155         Source Listing                  R07UBF
2017-04-18 11:09 Symbol Table                    iw3unpbf.f

 Name                       Object Declared Type            Bytes Dimen Elements Attributes       References                        
                                                                                                                                    
                                                                                                  4,6421,6447,6450,6458,6460,6473,64
                                                                                                  79,6491,6497,6509,6515,6527,6530,6
                                                                                                  538,6540,6553,6559                
 MIN                        Func   6333                                 scalar                    6333,6349,6361,6377,6448,6528     
 MINDX                      Local  6397     I(4)            4           scalar   SAVE             6397,6398,6400                    
 NADD                       Local  6423     I(4)            4           scalar   SAVE             6423,6424,6425,6426               
 NCHN                       Local  6396     I(4)            4           scalar   SAVE             6396,6397,6399,6405,6406,6407     
 NINT                       Func   6280                                 scalar                    6280,6285,6295,6307,6349,6377,6406
                                                                                                  ,6425,6494,6495,6498,6512,6513,651
                                                                                                  6,6535,6536,6542                  
 NLEV                       Local  6404     I(4)            4           scalar   SAVE             6404                              
 NOBS3                      Dummy  6230     I(4)            4     1     7        ARG,INOUT                                          
 OB8                        Scalar 6238     R(4)            4     1     255      COM              6340,6347,6368,6375,6398,6406,6425
                                                                                                  ,6455,6462,6476,6480,6494,6498,651
                                                                                                  2,6516,6535,6542,6556,6560        
 OBS                        Dummy  6230     R(4)            4     1     0        ARG,INOUT        6568                              
 OBS2                       Dummy  6230     R(4)            4     1     43       ARG,INOUT        6264                              
 OBS2_8                     Local  6243     R(8)            8     1     43       SAVE             6262,6264                         
 OBS3                       Dummy  6230     R(4)            4     3     8925     ARG,INOUT                                          
 OBS3_8                     Local  6243     R(8)            8     3     8925     SAVE                                               
 OBS8_8                     Dummy  6230     R(8)            8     1     2        ARG,INOUT        6263,6274,6275                    
 POB                        Scalar 6237     R(4)            4     1     255      COM                                                
 PROD                       Local  6247     R(4)            4     2     4        SAVE             6336,6340,6341,6364,6368,6369,6451
                                                                                                  ,6455,6456,6473,6476,6477,6491,649
                                                                                                  4,6495,6509,6512,6513,6531,6535,65
                                                                                                  36,6553,6556,6557                 
 PRODN                      Local  6346     R(4)            4           scalar   SAVE             6346,6347,6374,6375,6461,6462,6479
                                                                                                  ,6480,6497,6498,6515,6516,6541,654
                                                                                                  2,6559,6560                       
 PROD_8                     Local  6244     R(8)            8     2     4        SAVE             6332,6333,6335,6336,6360,6361,6363
                                                                                                  ,6364,6447,6448,6450,6451,6473,649
                                                                                                  1,6509,6527,6528,6530,6531,6553   
 Q81                        Scalar 6239     R(4)            4     1     255      COM              6341,6369,6400,6456,6477,6495,6513
                                                                                                  ,6536,6557                        
 Q82                        Scalar 6239     R(4)            4     1     255      COM              6349,6377                         
 QMELV                      Local  6313     R(4)            4           scalar   SAVE             6313,6316                         
 QOB                        Scalar 6237     R(4)            4     1     255      COM                                                
 R07UBF                     Func   6230     R(4)            4           scalar                    6256,6572,6578                    
 R07UBF@0                   Local  6230     R(4)            4           scalar   SAVE                                               
 RCTIM                      Local  6311     R(4)            4           scalar   SAVE             6311,6316                         
 RFLG                       Local  6348     R(4)            4           scalar   SAVE             6348,6349,6376,6377               
 RHR                        Local  6279     R(4)            4           scalar   SAVE             6279,6280,6316                    
 RID_8                      Local  6243     R(8)            8           scalar   SAVE             6276                              
 RSTP                       Local  6315     R(4)            4           scalar   SAVE             6315,6317                         
 RSV1                       Local  6242     CHAR            8           scalar   SAVE             6287,6295,6316                    
 RSV2                       Local  6242     CHAR            8           scalar   SAVE             6288,6316                         
 RTP                        Local  6298     R(4)            4           scalar   SAVE             6298,6314,6316,6324,6352,6380,6411
                                                                                                  ,6430,6465,6483,6501,6519,6545    
 S01UBF                     Subr   6316                                                           6316                              
 S02UBF                     Subr   6351                                                           6351,6379,6401,6408,6427,6464,6482
                                                                                                  ,6500,6518,6544,6562              
 S03UBF                     Subr   6568                                                           6568                              
 S05UBF                     Subr   6266                                                           6266                              
 SID                        Local  6242     CHAR            8           scalar   SAVE             6316,6576                         
 SOB                        Scalar 6238     R(4)            4     1     255      COM                                                

Page 156         Source Listing                  R07UBF
2017-04-18 11:09 Symbol Table                    iw3unpbf.f

 Name                       Object Declared Type            Bytes Dimen Elements Attributes       References                        
                                                                                                                                    
 SUBSET                     Scalar 6236     CHAR            8           scalar   COM              6568                              
 TMBR                       Local  6247     R(4)            4     1     7        SAVE             6404,6406                         
 TMBRS                      Local  6247     R(4)            4     2     28       SAVE             6393,6398,6400                    
 TMBRS_8                    Local  6244     R(8)            8     2     28       SAVE             6393                              
 TMBR_8                     Local  6244     R(8)            8     1     7        SAVE             6404                              
 TOB                        Scalar 6237     R(4)            4     1     255      COM                                                
 UFBINT                     Subr   6264                                                           6264,6271,6343,6345,6348,6371,6373
                                                                                                  ,6376,6404,6421,6458,6460,6479,649
                                                                                                  7,6515,6538,6540,6559             
 UFBINT_8                   Local  6243     R(8)            8           scalar   SAVE             6343,6344,6345,6346,6348,6371,6372
                                                                                                  ,6373,6374,6376,6458,6459,6460,646
                                                                                                  1,6479,6497,6515,6538,6539,6540,65
                                                                                                  41,6559                           
 UFBREP                     Subr   6332                                                           6332,6335,6360,6363,6393,6447,6450
                                                                                                  ,6473,6491,6509,6527,6530,6553    
 VSG                        Scalar 6238     R(4)            4     1     255      COM                                                
 XMISS                      Local  6254     R(4)            4           scalar   SAVE             6254,6313                         
 XOB                        Local  6277     R(4)            4           scalar   SAVE             6277,6316                         
 YOB                        Local  6278     R(4)            4           scalar   SAVE             6278,6316                         
 ZOB                        Scalar 6237     R(4)            4     1     255      COM                                                

Page 157         Source Listing                  R07UBF
2017-04-18 11:09                                 iw3unpbf.f

   6352       ELSE  IF(RTP.EQ.65)  THEN
   6353 C  ---------------------------------------------------------------------
   6354 C   ** OCEAN TOTAL PRECIPITABLE WATER PRODUCT -- DUMP REPORT TYPE 65 **
   6355 C  ---------------------------------------------------------------------
   6356 C  CODE FIGURE 197 - TOTAL PRECIPITABLE WATER (MM TO 10**1 PRECISION)
   6357 C  ---------------------------------------------------------------------
   6358          CF8(1) = 197
   6359          IF(ISUPOB.EQ.1)  THEN
   6360             CALL UFBREP(LUNIT,PROD_8,2,2,IRET,'FOST TPWT')
   6361             AMINIMUM_8 = MIN(PROD_8(2,1),PROD_8(2,2))
   6362             IF(IBFMS(AMINIMUM_8).NE.0)
   6363      $       CALL UFBREP(LUNIT,PROD_8,2,2,IRET,'FOST PH2O')
   6364             PROD=PROD_8
   6365 C For SUPEROBs, replication is such that first TPWT/PH2O is always mean
   6366 C  value (FOST=4) and second TPWT/PH2O is always standard deviation
   6367 C  (FOST=10)
   6368             OB8(1) = PROD(2,1)
   6369             Q81(1) = PROD(2,2)
   6370          ELSE
   6371             CALL UFBINT(LUNIT,UFBINT_8,1,1,IRET,'TPWT')
   6372             IF(IBFMS(UFBINT_8).NE.0)
   6373      $       CALL UFBINT(LUNIT,UFBINT_8,1,1,IRET,'PH2O')
   6374             PRODN = UFBINT_8
   6375             OB8(1) = PRODN
   6376             CALL UFBINT(LUNIT,UFBINT_8,1,1,IRET,'RFLG');RFLG=UFBINT_8
   6377             Q82(1) = MIN(NINT(RFLG),IMISS)
   6378          END IF
   6379          CALL S02UBF(8,1,*9999)
   6380       ELSE  IF(RTP.EQ.68)  THEN
   6381 C  ---------------------------------------------------------------------
   6382 C       ** 7-CHANNEL BRIGHTNESS TEMPERATURES -- DUMP REPORT TYPE 68 **
   6383 C  ---------------------------------------------------------------------
   6384 C  CODE FIGURE 189 - 19 GHZ V BRIGHTNESS TEMP (DEG K TO 10**2 PRECISION)
   6385 C  CODE FIGURE 190 - 19 GHZ H BRIGHTNESS TEMP (DEG K TO 10**2 PRECISION)
   6386 C  CODE FIGURE 191 - 22 GHZ V BRIGHTNESS TEMP (DEG K TO 10**2 PRECISION)
   6387 C  CODE FIGURE 192 - 37 GHZ V BRIGHTNESS TEMP (DEG K TO 10**2 PRECISION)
   6388 C  CODE FIGURE 193 - 37 GHZ H BRIGHTNESS TEMP (DEG K TO 10**2 PRECISION)
   6389 C  CODE FIGURE 194 - 85 GHZ V BRIGHTNESS TEMP (DEG K TO 10**2 PRECISION)
   6390 C  CODE FIGURE 195 - 85 GHZ H BRIGHTNESS TEMP (DEG K TO 10**2 PRECISION)
   6391 C  ---------------------------------------------------------------------
   6392          IF(ISUPOB.EQ.1)  THEN
   6393           CALL UFBREP(LUNIT,TMBRS_8,2,14,IRET,'FOST TMBR');TMBRS=TMBRS_8
   6394 C For SUPEROBs, replication is such that first TMBR is always mean
   6395 C  value (FOST=4) and second TMBR is always standard deviation (FOST=10)
   6396             DO  NCHN = 1,7
   6397                MINDX = (NCHN * 2) - 1
   6398                OB8(1) = TMBRS(2,MINDX  )
   6399                CF8(1) = 188 + NCHN
   6400                Q81(1) = TMBRS(2,MINDX+1)
   6401                CALL S02UBF(8,1,*9999)
   6402             ENDDO
   6403          ELSE
   6404             CALL UFBINT(LUNIT,TMBR_8,1,7,NLEV,'TMBR');TMBR=TMBR_8
   6405             DO  NCHN = 1,7
   6406                OB8(1) = NINT(TMBR(NCHN)*100.)
   6407                CF8(1) = 188 + NCHN
   6408                CALL S02UBF(8,1,*9999)

Page 158         Source Listing                  R07UBF
2017-04-18 11:09                                 iw3unpbf.f

   6409             ENDDO
   6410          END IF
   6411       ELSE  IF(RTP.EQ.575)  THEN
   6412 C  ---------------------------------------------------------------------
   6413 C          ** ADDITIONAL PRODUCTS -- DUMP REPORT TYPE 575 **
   6414 C  ---------------------------------------------------------------------
   6415 C  CODE FIGURE 210 - SURFACE TAG (RANGE: 0,1,3-6)
   6416 C  CODE FIGURE 211 - ICE CONCENTRATION (PERCENT)
   6417 C  CODE FIGURE 212 - ICE AGE (RANGE: 0,1)
   6418 C  CODE FIGURE 213 - ICE EDGE (RANGE: 0,1)
   6419 C  CODE FIGURE 214 - CALCULATED SURFACE TYPE (RANGE: 1-20)
   6420 C  ---------------------------------------------------------------------
   6421          CALL UFBINT(LUNIT,ADDP_8,5,1,IRET,'SFTG ICON ICAG ICED SFTP')
   6422          ADDP = ADDP_8
   6423          DO NADD = 1,5
   6424             IF(ADDP(NADD).LT.BMISS) THEN
   6425                OB8(1) = NINT(ADDP(NADD))
   6426                CF8(1) = 209 + NADD
   6427                CALL S02UBF(8,1,*9999)
   6428             END IF
   6429          ENDDO
   6430       ELSE  IF(RTP.EQ.66)  THEN
   6431 C  ---------------------------------------------------------------------
   6432 C      ** LAND/OCEAN RAINFALL RATE -- REPORT TYPE 66 **
   6433 C  ---------------------------------------------------------------------
   6434 C  CODE FIGURE 198 - RAINFALL RATE (MM/SEC TO 10**6 PRECISION)
   6435 C    Note: Prior to mid-2001, this was stored using standard descr.
   6436 C          mnemonic REQV (at the standard precision).  Then from mid-
   6437 C          2001 until ~9/2004 it was stored using local descr. mnemonic
   6438 C          REQ6 (at a higher precision).  After ~9/2004 it will again
   6439 C          be stored using standard descr. mnemonic REQV, but operator
   6440 C          descriptors in the BUFR table will allow it to be stored
   6441 C          with the same high precision as before.  The logic below
   6442 C          allows for all transitions from REQV to REQ6 and then back
   6443 C          again.
   6444 C  ---------------------------------------------------------------------
   6445          CF8(1) = 198
   6446          IF(ISUPOB.EQ.1)  THEN
   6447             CALL UFBREP(LUNIT,PROD_8,2,2,IRET,'FOST REQV')
   6448             AMINIMUM_8 = MIN(PROD_8(2,1),PROD_8(2,2))
   6449             IF(IBFMS(AMINIMUM_8).NE.0)
   6450      $       CALL UFBREP(LUNIT,PROD_8,2,2,IRET,'FOST REQ6')
   6451             PROD=PROD_8
   6452 C For SUPEROBs, replication is such that first REQV/REQ6 is always mean
   6453 C  value (FOST=4) and second REQV/REQ6 is always standard deviation
   6454 C  (FOST=10)
   6455             OB8(1) = PROD(2,1)
   6456             Q81(1) = PROD(2,2)
   6457          ELSE
   6458             CALL UFBINT(LUNIT,UFBINT_8,1,1,IRET,'REQV')
   6459             IF(IBFMS(UFBINT_8).NE.0)
   6460      $       CALL UFBINT(LUNIT,UFBINT_8,1,1,IRET,'REQ6')
   6461             PRODN=UFBINT_8
   6462             OB8(1) = PRODN
   6463          END IF
   6464          CALL S02UBF(8,1,*9999)
   6465       ELSE  IF(RTP.EQ.576)  THEN

Page 159         Source Listing                  R07UBF
2017-04-18 11:09                                 iw3unpbf.f

   6466 C  ---------------------------------------------------------------------
   6467 C      ** SURFACE TEMPERATURE -- DUMP REPORT TYPE 576 **
   6468 C  ---------------------------------------------------------------------
   6469 C  CODE FIGURE 199 - SURFACE TEMP. (DEG. KELVIN TO 10**2 PRECISION)
   6470 C  ---------------------------------------------------------------------
   6471          CF8(1) = 199
   6472          IF(ISUPOB.EQ.1)  THEN
   6473             CALL UFBREP(LUNIT,PROD_8,2,2,IRET,'FOST TMSK');PROD=PROD_8
   6474 C For SUPEROBs, replication is such that first TMSK is always mean
   6475 C  value (FOST=4) and second TMSK is always standard deviation (FOST=10)
   6476             OB8(1) = PROD(2,1)
   6477             Q81(1) = PROD(2,2)
   6478          ELSE
   6479             CALL UFBINT(LUNIT,UFBINT_8,1,1,IRET,'TMSK');PRODN=UFBINT_8
   6480             OB8(1) = PRODN
   6481          END IF
   6482          CALL S02UBF(8,1,*9999)
   6483       ELSE  IF(RTP.EQ.69)  THEN
   6484 C  ---------------------------------------------------------------------
   6485 C      ** OCEAN CLOUD WATER -- DUMP REPORT TYPE 69 **
   6486 C  ---------------------------------------------------------------------
   6487 C  CODE FIGURE 200 - CLOUD WATER (MM * 100)
   6488 C  ---------------------------------------------------------------------
   6489          CF8(1) = 200
   6490          IF(ISUPOB.EQ.1)  THEN
   6491             CALL UFBREP(LUNIT,PROD_8,2,2,IRET,'FOST CH2O');PROD=PROD_8
   6492 C For SUPEROBs, replication is such that first CH2O is always mean
   6493 C  value (FOST=4) and second CH2O is always standard deviation (FOST=10)
   6494             OB8(1) = NINT(PROD(2,1)*100.)
   6495             Q81(1) = NINT(PROD(2,2)*100.)
   6496          ELSE
   6497             CALL UFBINT(LUNIT,UFBINT_8,1,1,IRET,'CH2O');PRODN=UFBINT_8
   6498             OB8(1) = NINT(PRODN*100.)
   6499          END IF
   6500          CALL S02UBF(8,1,*9999)
   6501       ELSE  IF(RTP.EQ.573)  THEN
   6502 C  ---------------------------------------------------------------------
   6503 C      ** SOIL MOISTURE -- DUMP REPORT TYPE 573 **
   6504 C  ---------------------------------------------------------------------
   6505 C  CODE FIGURE 201 - SOIL MOISTURE (MM)
   6506 C  ---------------------------------------------------------------------
   6507          CF8(1) = 201
   6508          IF(ISUPOB.EQ.1)  THEN
   6509             CALL UFBREP(LUNIT,PROD_8,2,2,IRET,'FOST SMOI');PROD=PROD_8
   6510 C For SUPEROBs, replication is such that first SMOI is always mean
   6511 C  value (FOST=4) and second SMOI is always standard deviation (FOST=10)
   6512             OB8(1) = NINT(PROD(2,1)*1000.)
   6513             Q81(1) = NINT(PROD(2,2)*1000.)
   6514          ELSE
   6515             CALL UFBINT(LUNIT,UFBINT_8,1,1,IRET,'SMOI');PRODN=UFBINT_8
   6516             OB8(1) = NINT(PRODN*1000.)
   6517          END IF
   6518          CALL S02UBF(8,1,*9999)
   6519       ELSE  IF(RTP.EQ.574)  THEN
   6520 C  ---------------------------------------------------------------------
   6521 C      ** SNOW DEPTH -- DUMP REPORT TYPE 574 **
   6522 C  ---------------------------------------------------------------------

Page 160         Source Listing                  R07UBF
2017-04-18 11:09                                 iw3unpbf.f

   6523 C  CODE FIGURE 202 - SNOW DEPTH (MM)
   6524 C  ---------------------------------------------------------------------
   6525          CF8(1) = 202
   6526          IF(ISUPOB.EQ.1)  THEN
   6527             CALL UFBREP(LUNIT,PROD_8,2,2,IRET,'FOST TOSD')
   6528             AMINIMUM_8 = MIN(PROD_8(2,1),PROD_8(2,2))
   6529             IF(IBFMS(AMINIMUM_8).NE.0)
   6530      $       CALL UFBREP(LUNIT,PROD_8,2,2,IRET,'FOST SNDP')
   6531             PROD=PROD_8
   6532 C For SUPEROBs, replication is such that first TOSD/SNDP is always mean
   6533 C  value (FOST=4) and second TOSD/SNDP is always standard deviation
   6534 C  (FOST=10)
   6535             OB8(1) = NINT(PROD(2,1)*1000.)
   6536             Q81(1) = NINT(PROD(2,2)*1000.)
   6537          ELSE
   6538             CALL UFBINT(LUNIT,UFBINT_8,1,1,IRET,'TOSD')
   6539             IF(IBFMS(UFBINT_8).NE.0)
   6540      $       CALL UFBINT(LUNIT,UFBINT_8,1,1,IRET,'SNDP')
   6541             PRODN=UFBINT_8
   6542             OB8(1) = NINT(PRODN*1000.)
   6543          END IF
   6544          CALL S02UBF(8,1,*9999)
   6545       ELSE  IF(RTP.EQ.577)  THEN
   6546 C  ---------------------------------------------------------------------
   6547 C      ** SEA-SURFACE TEMPERATURE -- DUMP REPORT TYPE 577 **
   6548 C  ---------------------------------------------------------------------
   6549 C  CODE FIGURE 203 - SEA-SURFACE TEMP. (DEG. KELVIN TO 10**2 PRECISION)
   6550 C  ---------------------------------------------------------------------
   6551          CF8(1) = 203
   6552          IF(ISUPOB.EQ.1)  THEN
   6553             CALL UFBREP(LUNIT,PROD_8,2,2,IRET,'FOST SST1');PROD=PROD_8
   6554 C For SUPEROBs, replication is such that first SST1 is always mean
   6555 C  value (FOST=4) and second SST1 is always standard deviation (FOST=10)
   6556             OB8(1) = PROD(2,1)
   6557             Q81(1) = PROD(2,2)
   6558          ELSE
   6559             CALL UFBINT(LUNIT,UFBINT_8,1,1,IRET,'SST1');PRODN=UFBINT_8
   6560             OB8(1) = PRODN
   6561          END IF
   6562          CALL S02UBF(8,1,*9999)
   6563       END IF
   6564 
   6565 C  PUT THE UNPACKED REPORT INTO OBS
   6566 C  --------------------------------
   6567  
   6568       CALL S03UBF(OBS,SUBSET,*9999,*9998,*9997)
   6569 
   6570       RETURN
   6571  9999 CONTINUE
   6572       R07UBF = 999
   6573       RETURN
   6574  9998 CONTINUE
   6575       print'(" IW3UNPBF/R07UBF: RPT with ID= ",A," TOSSED - ZERO ",
   6576      $ "CAT.1-6,8,51 LVLS")', SID
   6577  9997 CONTINUE
   6578       R07UBF = -9999
   6579       KSKSMI = KSKSMI + 1

Page 161         Source Listing                  R07UBF
2017-04-18 11:09                                 iw3unpbf.f

   6580       RETURN
   6581       END
   6582 C$$$  SUBPROGRAM DOCUMENTATION BLOCK
   6583 C
   6584 C SUBPROGRAM:    I05UBF      FINDS LOCATION OF NEXT NUMERIC
   6585 C   PRGMMR: RAY CRAYTON      ORG: W/NMC41    DATE: 1989-07-07
   6586 C
   6587 C ABSTRACT: FINDS THE LOCATION OF THE NEXT NUMERIC CHARACTER
   6588 C           IN A STRING OF CHARACTERS.
   6589 C
   6590 C PROGRAM HISTORY LOG:
   6591 C 1989-07-07  RAY CRAYTON
   6592 C
   6593 C USAGE:    LOC=I05UBF(STRING,NUM,CHAR)
   6594 C   INPUT ARGUMENT LIST:
   6595 C     STRING   - CHARACTER ARRAY.
   6596 C     NUM      - NUMBER OF CHARACTERS TO SEARCH IN STRING.
   6597 C
   6598 C   OUTPUT ARGUMENT LIST:
   6599 C     I05UBF   - INTEGER*4 LOCATION OF ALPHANUMERIC CHARACTER.
   6600 C                = 0 IF NOT FOUND.
   6601 C     CHAR     - CHARACTER FOUND.
   6602 C
   6603 C REMARKS: NONE
   6604 C
   6605 C
   6606 C ATTRIBUTES:
   6607 C   LANGUAGE: FORTRAN 90
   6608 C   MACHINE:  NCEP WCOSS
   6609 C
   6610 C$$$
   6611       FUNCTION I05UBF(STRING,NUM,CHAR)
   6612       CHARACTER*1  STRING(1),CHAR
   6613 
   6614       SAVE
   6615 
   6616       DO I = 1,NUM
   6617          IF(STRING(I).GE.'0'.AND.STRING(I).LE.'9')  THEN
   6618             I05UBF = I
   6619             CHAR = STRING(I)
   6620             GO TO 200
   6621          END IF
   6622       ENDDO
   6623       I05UBF = 0
   6624       CHAR = '?'
   6625  200  CONTINUE
   6626       RETURN
   6627       END

Page 162         Source Listing                  I05UBF
2017-04-18 11:09 Entry Points                    iw3unpbf.f



ENTRY POINTS

  Name               
                     
 i05ubf_             


SYMBOL CROSS REFERENCE

 Name                       Object Declared Type            Bytes Dimen Elements Attributes       References                        
                                                                                                                                    
 200                        Label  6625                                                           6620                              
 CHAR                       Dummy  6611     CHAR            1           scalar   ARG,INOUT        6619,6624                         
 I                          Local  6616     I(4)            4           scalar   SAVE             6616,6617,6618,6619               
 I05UBF                     Func   6611     I(4)            4           scalar                    6618,6623                         
 I05UBF@0                   Local  6611     I(4)            4           scalar   SAVE                                               
 NUM                        Dummy  6611     I(4)            4           scalar   ARG,INOUT        6616                              
 STRING                     Dummy  6611     CHAR            1     1     1        ARG,INOUT        6617,6619                         

Page 163         Source Listing                  I05UBF
2017-04-18 11:09 Subprograms/Common Blocks       iw3unpbf.f



SUBPROGRAMS/COMMON BLOCKS

 Name                       Object Declared Type            Bytes Dimen Elements Attributes       References                        
                                                                                                                                    
 C01UBF                     Func   1816     CHAR            6           scalar                    1823,1826,1829,1831,1834,1837,1839
                                                                                                  ,1841,1844,1846,1848,1851         
 I02UBF                     Func   1620     I(4)            4           scalar                    1651,1663,1674,1741,1750,1752,1795
                                                                                                  ,1797,1798,1799,1808              
 I04UBF                     Func   2512     I(4)            4           scalar                    2550,2552                         
 I05UBF                     Func   6611     I(4)            4           scalar                    6618,6623                         
 IUBFAA                     Common 1234                                 8        SAVE                                               
 IUBFAA                     Common 1896                                 8        SAVE                                               
 IUBFAA                     Common 2331                                 8        SAVE                                               
 IUBFAA                     Common 2477                                 8        SAVE                                               
 IUBFAA                     Common 2567                                 8        SAVE                                               
 IUBFAA                     Common 2803                                 8        SAVE                                               
 IUBFAA                     Common 3563                                 8        SAVE                                               
 IUBFAA                     Common 4124                                 8        SAVE                                               
 IUBFAA                     Common 5217                                 8        SAVE                                               
 IUBFAA                     Common 6233                                 8        SAVE                                               
 IUBFBB                     Common 1235                                 100      SAVE                                               
 IUBFBB                     Common 2804                                 100      SAVE                                               
 IUBFBB                     Common 3564                                 100      SAVE                                               
 IUBFBB                     Common 4125                                 100      SAVE                                               
 IUBFBB                     Common 5218                                 100      SAVE                                               
 IUBFBB                     Common 6234                                 100      SAVE                                               
 IUBFCC                     Common 1237                                 8        SAVE                                               
 IUBFCC                     Common 1624                                 8        SAVE                                               
 IUBFCC                     Common 2806                                 8        SAVE                                               
 IUBFCC                     Common 3566                                 8        SAVE                                               
 IUBFCC                     Common 4127                                 8        SAVE                                               
 IUBFCC                     Common 5220                                 8        SAVE                                               
 IUBFCC                     Common 6236                                 8        SAVE                                               
 IUBFDD                     Common 1238                                 480176   SAVE                                               
 IUBFDD                     Common 1897                                 480176   SAVE                                               
 IUBFDD                     Common 1975                                 480176   SAVE                                               
 IUBFDD                     Common 2249                                 480176   SAVE                                               
 IUBFDD                     Common 2332                                 480176   SAVE                                               
 IUBFDD                     Common 2807                                 480176   SAVE                                               
 IUBFEE                     Common 1240                                 9180     SAVE                                               
 IUBFEE                     Common 1977                                 9180     SAVE                                               
 IUBFEE                     Common 2478                                 9180     SAVE                                               
 IUBFEE                     Common 2809                                 9180     SAVE                                               
 IUBFEE                     Common 3567                                 9180     SAVE                                               
 IUBFEE                     Common 4128                                 9180     SAVE                                               
 IUBFEE                     Common 5221                                 9180     SAVE                                               
 IUBFEE                     Common 6237                                 9180     SAVE                                               
 IUBFFF                     Common 1241                                 5100     SAVE                                               
 IUBFFF                     Common 1979                                 5100     SAVE                                               
 IUBFFF                     Common 2479                                 5100     SAVE                                               
 IUBFFF                     Common 2811                                 5100     SAVE                                               
 IUBFFF                     Common 4130                                 5100     SAVE                                               
 IUBFFF                     Common 5223                                 5100     SAVE                                               
 IUBFGG                     Common 1242                                 24       SAVE                                               
 IUBFGG                     Common 1980                                 24       SAVE                                               

Page 164         Source Listing                  I05UBF
2017-04-18 11:09 Subprograms/Common Blocks       iw3unpbf.f

 Name                       Object Declared Type            Bytes Dimen Elements Attributes       References                        
                                                                                                                                    
 IUBFGG                     Common 2480                                 24       SAVE                                               
 IUBFGG                     Common 3569                                 24       SAVE                                               
 IUBFHH                     Common 1243                                 20       SAVE                                               
 IUBFHH                     Common 1981                                 20       SAVE                                               
 IUBFHH                     Common 2481                                 20       SAVE                                               
 IUBFHH                     Common 3570                                 20       SAVE                                               
 IUBFII                     Common 1244                                 4        SAVE                                               
 IUBFII                     Common 1982                                 4        SAVE                                               
 IUBFII                     Common 2812                                 4        SAVE                                               
 IUBFJJ                     Common 1245                                 4008     SAVE                                               
 IUBFJJ                     Common 2515                                 4008     SAVE                                               
 IUBFKK                     Common 1246                                 72812    SAVE                                               
 IUBFKK                     Common 5224                                 72812    SAVE                                               
 IUBFLL                     Common 1248                                 2040     SAVE                                               
 IUBFLL                     Common 1983                                 2040     SAVE                                               
 IUBFLL                     Common 2482                                 2040     SAVE                                               
 IUBFLL                     Common 2813                                 2040     SAVE                                               
 IUBFLL                     Common 3571                                 2040     SAVE                                               
 IUBFLL                     Common 4131                                 2040     SAVE                                               
 IUBFLL                     Common 5226                                 2040     SAVE                                               
 IUBFLL                     Common 6239                                 2040     SAVE                                               
 IUBFMM                     Common 1249                                 1020     SAVE                                               
 IUBFMM                     Common 1984                                 1020     SAVE                                               
 IUBFMM                     Common 2483                                 1020     SAVE                                               
 IUBFMM                     Common 2814                                 1020     SAVE                                               
 IUBFNN                     Common 1250                                 24       SAVE                                               
 IUBFNN                     Common 1899                                 24       SAVE                                               
 IUBFNN                     Common 1985                                 24       SAVE                                               
 IUBFNN                     Common 2251                                 24       SAVE                                               
 IUBFNN                     Common 2334                                 24       SAVE                                               
 IUBFNN                     Common 2484                                 24       SAVE                                               
 IUBFOO                     Common 1251                                 24       SAVE                                               
 IUBFOO                     Common 1625                                 24       SAVE                                               
 IUBFPP                     Common 1252                                 8        SAVE                                               
 IUBFPP                     Common 2335                                 8        SAVE                                               
 IUBFQQ                     Common 1253                                 205824   SAVE                                               
 IUBFQQ                     Common 1626                                 205824   SAVE                                               
 IUBFRR                     Common 1254                                 4        SAVE                                               
 IUBFRR                     Common 1627                                 4        SAVE                                               
 IUBFRR                     Common 4132                                 4        SAVE                                               
 IUBFSS                     Common 1255                                 11       SAVE                                               
 IUBFSS                     Common 2485                                 11       SAVE                                               
 IUBFSS                     Common 4133                                 11       SAVE                                               
 IW3UNPBF                   Func   1229     I(4)            4           scalar                    1410,1432,1435,1438,1597,1613     
 L01UBF                     Func   2769     L(4)            4           scalar                    2775                              
 R01UBF                     Func   1859     R(4)            4           scalar                    1871,1874,1876,1878,1880,1882     
 R02UBF                     Func   2561     R(4)            4           scalar                    2571                              
 R03UBF                     Func   2798     R(4)            4           scalar                    2846,3002,3547,3553               
 R04UBF                     Func   3560     R(4)            4           scalar                    3593,4106,4113                    
 R05UBF                     Func   4121     R(4)            4           scalar                    4185,4716,4809,5199,5206          
 R06UBF                     Func   5214     R(4)            4           scalar                    5341,5745,6215,6222               
 R07UBF                     Func   6230     R(4)            4           scalar                    6256,6572,6578                    
 S01UBF                     Subr   1890                                                                                             
 S02UBF                     Subr   1966                                                                                             
 S03UBF                     Subr   2244                                                                                             

Page 165         Source Listing                  I05UBF
2017-04-18 11:09 Subprograms/Common Blocks       iw3unpbf.f

 Name                       Object Declared Type            Bytes Dimen Elements Attributes       References                        
                                                                                                                                    
 S04UBF                     Subr   2326                                                                                             
 S05UBF                     Subr   2470                                                                                             

COMPILER OPTIONS BEING USED

       -align noall                          -align nonone
       -align nocommons                      -align nodcommons
       -align noqcommons                     -align nozcommons
       -align records                        -align nosequence
       -align norec1byte                     -align norec2byte
       -align norec4byte                     -align norec8byte
       -align norec16byte                    -align norec32byte
       -align norec64byte                    -align noarray8byte
       -align noarray16byte                  -align noarray32byte
       -align noarray64byte                  -align noarray128byte
       -align noarray256byte                 -altparam
       -assume accuracy_sensitive            -assume nobscc
       -assume nobuffered_io                 -assume nobuffered_stdout
       -assume nobyterecl                    -assume nocc_omp
       -assume nocstring                     -assume nodummy_aliases
       -assume nofpe_summary                 -assume noieee_fpe_flags
       -assume nominus0                      -assume noold_boz
       -assume old_complex_align             -assume old_unit_star
       -assume noold_ldout_format            -assume noold_logical_ldio
       -assume old_maxminloc                 -assume old_xor
       -assume noprotect_allocates           -assume protect_constants
       -assume noprotect_parens              -assume split_common
       -assume source_include                -assume nostd_intent_in
       -assume std_minus0_rounding           -assume nostd_mod_proc_name
       -assume std_value                     -assume norealloc_lhs
       -assume underscore                    -assume no2underscores
       -auto                            no   -auto_scalar
  no   -bintext                              -ccdefault default
       -check noargs                         -check noarg_temp_created
       -check noassume                       -check nobounds
       -check noformat                       -check nooutput_conversion
       -check nooverflow                     -check nopointers
       -check power                          -check noshape
       -check nostack                        -check nounderflow
       -check nouninitialized                -coarray-num-procs 0
  no   -coarray-config-file                  -convert big_endian
       -cross_reference                      -D __INTEL_COMPILER=1600
       -D __INTEL_COMPILER_UPDATE=3          -D __unix__
       -D __unix                             -D __linux__
       -D __linux                            -D __gnu_linux__
       -D unix                               -D linux
       -D __ELF__                            -D __x86_64
       -D __x86_64__                         -D __amd64
       -D __amd64__                          -D __INTEL_COMPILER_BUILD_DATE=20160415
       -D __INTEL_OFFLOAD                    -D __i686
       -D __i686__                           -D __pentiumpro
       -D __pentiumpro__                     -D __pentium4
       -D __pentium4__                       -D __tune_pentium4__
       -D __SSE2__                           -D __SSE2_MATH__
       -D __SSE__                            -D __SSE_MATH__

Page 166         Source Listing                  I05UBF
2017-04-18 11:09                                 iw3unpbf.f

       -D __MMX__                            -double_size 64
  no   -d_lines                         no   -Qdyncom
       -error_limit 30                  no   -f66
  no   -f77rtl                          no   -fast
       -fpscomp nofilesfromcmd               -fpscomp nogeneral
       -fpscomp noioformat                   -fpscomp noldio_spacing
       -fpscomp nologicals                   -fixed
  no   -fpconstant                           -fpe3
       -fprm nearest                    no   -ftz
       -fp_model noprecise                   -fp_model fast
       -fp_model nostrict                    -fp_model nosource
       -fp_model nodouble                    -fp_model noextended
       -fp_model novery_fast                 -fp_model noexcept
       -fp_model nono_except                 -heap_arrays 0
  no   -threadprivate_compat                 -g2
       -iface nomixed_str_len_arg            -iface nono_mixed_str_len_arg
       -init noarrays                        -init noinf
       -init nonan                           -init nosnan
       -init nozero                     no   -intconstant
       -integer_size 32                 no   -mixed_str_len_arg
  no   -module                               -names lowercase
  no   -noinclude                            -offload-build=host
       -O2                              no   -pad_source
       -real_size 32                    no   -recursive
       -reentrancy none                 no   -sharable_localsaves
       -vec=simd                             -show noinclude
       -show map                             -show options
  no   -syntax_only                     no   -threadcom
  no   -U                               no   -vms
       -w noall                              -w nonone
       -w alignments                         -w noargument_checking
       -w nodeclarations                     -w general
       -w noignore_bounds                    -w noignore_loc
       -w nointerfaces                       -w notruncated_source
       -w uncalled                           -w uninitialized
       -w nounused                           -w usage
  no   -wrap-margins

       -includepath : /usrx/local/intel/2016SP3/daal/include/,/usr/include/,.FOR,./.FOR,/usrx/local/intel/2016SP3/ipp/include/.FOR,
           /usrx/local/intel/2016SP3/mkl/include/.FOR,/usrx/local/intel/2016SP3/tbb/include/.FOR,/usrx/local/intel/2016SP3/daal/include/.FOR,
           /gpfs/tp1/usrx/local/intel/2016SP3/compilers_and_libraries_2016.3.210/linux/compiler/include/intel64/.FOR,
           /gpfs/tp1/usrx/local/intel/2016SP3/compilers_and_libraries_2016.3.210/linux/compiler/include/.FOR,/usr/local/include/.FOR,
           /usr/lib/gcc/x86_64-redhat-linux/4.4.7/include/.FOR,/usr/include/.FOR,/usr/include/.FOR,/usr/include/.FOR
       -list filename : iw3unpbf.lst
       -o    filename : none

COMPILER: Intel(R) Fortran 16.0-1633
